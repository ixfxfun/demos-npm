{"version":3,"sources":["../node_modules/@lit-labs/ssr-dom-shim/src/lib/element-internals.ts","../node_modules/@lit-labs/ssr-dom-shim/src/index.ts","../node_modules/@lit/reactive-element/src/css-tag.ts","../node_modules/@lit/reactive-element/src/reactive-element.ts","../node_modules/lit-html/src/lit-html.ts","../node_modules/lit-element/src/lit-element.ts","../node_modules/@lit/reactive-element/src/decorators/custom-element.ts","../node_modules/@lit/reactive-element/src/decorators/property.ts","../node_modules/lit-html/src/directive-helpers.ts","../node_modules/lit-html/src/directive.ts","../node_modules/lit-html/src/async-directive.ts","../node_modules/lit-html/src/directives/ref.ts","../src/components/video-selector.ts","../src/util/drawing.ts","../node_modules/@mediapipe/tasks-vision/vision_bundle.mjs","../node_modules/ixfx/src/collections/Map/MapImmutableFns.ts","../node_modules/ixfx/src/collections/Map/Map.ts","../node_modules/ixfx/src/collections/Map/NumberMap.ts","../node_modules/ixfx/src/util/GuardThrowFromResult.ts","../node_modules/ixfx/src/util/GuardNumbers.ts","../node_modules/ixfx/src/numbers/Round.ts","../node_modules/ixfx/src/flow/IntervalType.ts","../node_modules/ixfx/src/util/ToString.ts","../node_modules/ixfx/src/util/IsEqual.ts","../node_modules/ixfx/dist/chunk-L5EJU35C.js","../node_modules/ixfx/src/Events.ts","../node_modules/ixfx/src/DefaultKeyer.ts","../node_modules/ixfx/src/collections/map/MapMultiFns.ts","../node_modules/ixfx/src/collections/map/MapOfSimpleBase.ts","../node_modules/ixfx/src/collections/map/MapOfSimpleMutable.ts","../node_modules/ixfx/src/random/Types.ts","../node_modules/ixfx/src/random/String.ts","../node_modules/ixfx/src/Text.ts","../node_modules/ixfx/src/data/arrays/GuardArray.ts","../node_modules/ixfx/src/iterables/sync/Slice.ts","../node_modules/ixfx/src/data/arrays/GuardIndex.ts","../node_modules/ixfx/src/data/arrays/Filter.ts","../node_modules/ixfx/src/numbers/MinMaxAvg.ts","../node_modules/ixfx/src/util/GuardFunction.ts","../node_modules/ixfx/src/util/GuardString.ts","../node_modules/ixfx/src/util/guards.ts","../node_modules/ixfx/src/util/GuardArrays.ts","../node_modules/ixfx/src/util/GuardEmpty.ts","../node_modules/ixfx/src/util/GuardObject.ts","../node_modules/ixfx/src/util/MapKeys.ts","../node_modules/ixfx/src/util/index.ts","../node_modules/ixfx/src/util/Comparers.ts","../node_modules/ixfx/src/util/IsEqualTrace.ts","../node_modules/ixfx/src/util/IsInteger.ts","../node_modules/ixfx/src/util/Platform.ts","../node_modules/ixfx/src/util/Results.ts","../node_modules/ixfx/src/util/KeyValue.ts","../node_modules/ixfx/src/data/maps/MapFns.ts","../node_modules/ixfx/src/collections/Map/index.ts","../node_modules/ixfx/src/collections/Map/ExpiringMap.ts","../node_modules/ixfx/src/collections/Map/MapMutable.ts","../node_modules/ixfx/src/collections/Map/MapOfMultiImpl.ts","../node_modules/ixfx/src/collections/Map/MapOfSetMutable.ts","../node_modules/ixfx/src/collections/CircularArray.ts","../node_modules/ixfx/src/collections/Map/MapOfCircularMutable.ts","../node_modules/ixfx/src/collections/Map/MapOfArrayMutable.ts","../node_modules/ixfx/src/iterables/Iterable.ts","../node_modules/ixfx/src/debug/GetErrorMessage.ts","../node_modules/ixfx/src/rx/Util.ts","../node_modules/ixfx/src/flow/Sleep.ts","../node_modules/ixfx/src/data/Resolve.ts","../node_modules/ixfx/src/flow/Repeat.ts","../node_modules/ixfx/src/data/maps/GetOrGenerate.ts","../node_modules/ixfx/src/debug/Logger.ts","../node_modules/ixfx/src/iterables/sync/AdditionalValues.ts","../node_modules/ixfx/src/data/arrays/Unique.ts","../node_modules/ixfx/src/random/WeightedIndex.ts","../node_modules/ixfx/src/data/arrays/Random.ts","../node_modules/ixfx/src/flow/StateMachine.ts","../node_modules/ixfx/src/flow/Execute.ts","../node_modules/ixfx/src/flow/StateMachineDriver.ts","../node_modules/ixfx/src/flow/Stopwatch.ts","../node_modules/ixfx/src/flow/StateMachineWithEvents.ts","../node_modules/ixfx/src/flow/Timeout.ts","../node_modules/ixfx/src/flow/RateMinimum.ts","../node_modules/ixfx/src/collections/queue/QueueFns.ts","../node_modules/ixfx/src/collections/queue/QueueMutable.ts","../node_modules/ixfx/src/numbers/Clamp.ts","../node_modules/ixfx/src/flow/Timer.ts","../node_modules/ixfx/src/flow/index.ts","../node_modules/ixfx/src/flow/BehaviourTree.ts","../node_modules/ixfx/src/flow/Continuously.ts","../node_modules/ixfx/src/flow/Debounce.ts","../node_modules/ixfx/src/flow/Delay.ts","../node_modules/ixfx/src/flow/DispatchList.ts","../node_modules/ixfx/src/flow/Every.ts","../node_modules/ixfx/src/flow/PromiseFromEvent.ts","../node_modules/ixfx/src/flow/PromiseWithResolvers.ts","../node_modules/ixfx/src/flow/RequestResponseMatch.ts","../node_modules/ixfx/src/flow/Retry.ts","../node_modules/ixfx/src/flow/RunOnce.ts","../node_modules/ixfx/src/flow/SyncWait.ts","../node_modules/ixfx/src/flow/TaskQueueMutable.ts","../node_modules/ixfx/src/flow/Throttle.ts","../node_modules/ixfx/src/flow/UpdateOutdated.ts","../node_modules/ixfx/src/flow/WaitFor.ts","../node_modules/ixfx/src/flow/WaitForValue.ts","../node_modules/ixfx/src/visual/Video.ts","../node_modules/ixfx/src/random/FloatSource.ts","../node_modules/ixfx/src/numbers/Count.ts","../node_modules/ixfx/src/modulation/Gaussian.ts","../node_modules/ixfx/src/modulation/ModulatorTimed.ts","../node_modules/ixfx/src/modulation/easing/index.ts","../node_modules/ixfx/src/modulation/easing/EasingsNamed.ts","../node_modules/ixfx/src/numbers/Wrap.ts","../node_modules/ixfx/src/numbers/Interpolate.ts","../node_modules/ixfx/src/numbers/Scale.ts","../node_modules/ixfx/src/numbers/Bipolar.ts","../node_modules/ixfx/src/numbers/Flip.ts","../node_modules/ixfx/src/data/arrays/ContainsDuplicateInstances.ts","../node_modules/ixfx/src/iterables/sync/Reduce.ts","../node_modules/ixfx/src/iterables/IterableSync.ts","../node_modules/ixfx/src/collections/stack/StackFns.ts","../node_modules/ixfx/src/collections/stack/StackMutable.ts","../node_modules/ixfx/src/collections/tree/TreeMutable.ts","../node_modules/ixfx/src/collections/tree/Compare.ts","../node_modules/ixfx/src/collections/tree/TraverseObject.ts","../node_modules/ixfx/src/IsPrimitive.ts","../node_modules/ixfx/src/collections/stack/StackImmutable.ts","../node_modules/ixfx/src/dom/ResolveEl.ts","../node_modules/ixfx/src/data/arrays/Pairwise.ts","../node_modules/ixfx/src/visual/Colour.ts","../node_modules/ixfx/node_modules/colorjs.io/src/multiply-matrices.js","../node_modules/ixfx/node_modules/colorjs.io/src/util.js","../node_modules/ixfx/node_modules/colorjs.io/src/hooks.js","../node_modules/ixfx/node_modules/colorjs.io/src/defaults.js","../node_modules/ixfx/node_modules/colorjs.io/src/adapt.js","../node_modules/ixfx/node_modules/colorjs.io/src/parse.js","../node_modules/ixfx/node_modules/colorjs.io/src/getColor.js","../node_modules/ixfx/node_modules/colorjs.io/src/space.js","../node_modules/ixfx/node_modules/colorjs.io/src/spaces/xyz-d65.js","../node_modules/ixfx/node_modules/colorjs.io/src/rgbspace.js","../node_modules/ixfx/node_modules/colorjs.io/src/getAll.js","../node_modules/ixfx/node_modules/colorjs.io/src/get.js","../node_modules/ixfx/node_modules/colorjs.io/src/setAll.js","../node_modules/ixfx/node_modules/colorjs.io/src/set.js","../node_modules/ixfx/node_modules/colorjs.io/src/spaces/xyz-d50.js","../node_modules/ixfx/node_modules/colorjs.io/src/spaces/lab.js","../node_modules/ixfx/node_modules/colorjs.io/src/angles.js","../node_modules/ixfx/node_modules/colorjs.io/src/spaces/lch.js","../node_modules/ixfx/node_modules/colorjs.io/src/deltaE/deltaE2000.js","../node_modules/ixfx/node_modules/colorjs.io/src/spaces/oklab.js","../node_modules/ixfx/node_modules/colorjs.io/src/deltaE/deltaEOK.js","../node_modules/ixfx/node_modules/colorjs.io/src/inGamut.js","../node_modules/ixfx/node_modules/colorjs.io/src/clone.js","../node_modules/ixfx/node_modules/colorjs.io/src/distance.js","../node_modules/ixfx/node_modules/colorjs.io/src/deltaE/deltaE76.js","../node_modules/ixfx/node_modules/colorjs.io/src/deltaE/deltaECMC.js","../node_modules/ixfx/node_modules/colorjs.io/src/spaces/xyz-abs-d65.js","../node_modules/ixfx/node_modules/colorjs.io/src/spaces/jzazbz.js","../node_modules/ixfx/node_modules/colorjs.io/src/spaces/jzczhz.js","../node_modules/ixfx/node_modules/colorjs.io/src/deltaE/deltaEJz.js","../node_modules/ixfx/node_modules/colorjs.io/src/spaces/ictcp.js","../node_modules/ixfx/node_modules/colorjs.io/src/deltaE/deltaEITP.js","../node_modules/ixfx/node_modules/colorjs.io/src/spaces/cam16.js","../node_modules/ixfx/node_modules/colorjs.io/src/spaces/hct.js","../node_modules/ixfx/node_modules/colorjs.io/src/deltaE/deltaEHCT.js","../node_modules/ixfx/node_modules/colorjs.io/src/deltaE/index.js","../node_modules/ixfx/node_modules/colorjs.io/src/toGamut.js","../node_modules/ixfx/node_modules/colorjs.io/src/to.js","../node_modules/ixfx/node_modules/colorjs.io/src/serialize.js","../node_modules/ixfx/node_modules/colorjs.io/src/spaces/rec2020-linear.js","../node_modules/ixfx/node_modules/colorjs.io/src/spaces/rec2020.js","../node_modules/ixfx/node_modules/colorjs.io/src/spaces/p3-linear.js","../node_modules/ixfx/node_modules/colorjs.io/src/spaces/srgb-linear.js","../node_modules/ixfx/node_modules/colorjs.io/src/keywords.js","../node_modules/ixfx/node_modules/colorjs.io/src/spaces/srgb.js","../node_modules/ixfx/node_modules/colorjs.io/src/spaces/p3.js","../node_modules/ixfx/node_modules/colorjs.io/src/display.js","../node_modules/ixfx/node_modules/colorjs.io/src/equals.js","../node_modules/ixfx/node_modules/colorjs.io/src/luminance.js","../node_modules/ixfx/node_modules/colorjs.io/src/contrast/WCAG21.js","../node_modules/ixfx/node_modules/colorjs.io/src/contrast/APCA.js","../node_modules/ixfx/node_modules/colorjs.io/src/contrast/Michelson.js","../node_modules/ixfx/node_modules/colorjs.io/src/contrast/Weber.js","../node_modules/ixfx/node_modules/colorjs.io/src/contrast/Lstar.js","../node_modules/ixfx/node_modules/colorjs.io/src/spaces/lab-d65.js","../node_modules/ixfx/node_modules/colorjs.io/src/contrast/deltaPhi.js","../node_modules/ixfx/node_modules/colorjs.io/src/contrast.js","../node_modules/ixfx/node_modules/colorjs.io/src/chromaticity.js","../node_modules/ixfx/node_modules/colorjs.io/src/deltaE.js","../node_modules/ixfx/node_modules/colorjs.io/src/variations.js","../node_modules/ixfx/node_modules/colorjs.io/src/interpolation.js","../node_modules/ixfx/node_modules/colorjs.io/src/spaces/hsl.js","../node_modules/ixfx/node_modules/colorjs.io/src/spaces/hsv.js","../node_modules/ixfx/node_modules/colorjs.io/src/spaces/hwb.js","../node_modules/ixfx/node_modules/colorjs.io/src/spaces/a98rgb-linear.js","../node_modules/ixfx/node_modules/colorjs.io/src/spaces/a98rgb.js","../node_modules/ixfx/node_modules/colorjs.io/src/spaces/prophoto-linear.js","../node_modules/ixfx/node_modules/colorjs.io/src/spaces/prophoto.js","../node_modules/ixfx/node_modules/colorjs.io/src/spaces/oklch.js","../node_modules/ixfx/node_modules/colorjs.io/src/spaces/luv.js","../node_modules/ixfx/node_modules/colorjs.io/src/spaces/lchuv.js","../node_modules/ixfx/node_modules/colorjs.io/src/spaces/hsluv.js","../node_modules/ixfx/node_modules/colorjs.io/src/spaces/hpluv.js","../node_modules/ixfx/node_modules/colorjs.io/src/spaces/rec2100-pq.js","../node_modules/ixfx/node_modules/colorjs.io/src/spaces/rec2100-hlg.js","../node_modules/ixfx/node_modules/colorjs.io/src/CATs.js","../node_modules/ixfx/node_modules/colorjs.io/src/spaces/acescg.js","../node_modules/ixfx/node_modules/colorjs.io/src/spaces/acescc.js","../node_modules/ixfx/node_modules/colorjs.io/src/color.js","../node_modules/ixfx/node_modules/colorjs.io/src/spaces/index.js","../node_modules/ixfx/node_modules/colorjs.io/src/space-accessors.js","../node_modules/ixfx/node_modules/colorjs.io/src/index.js","../node_modules/ixfx/src/data/arrays/InsertAt.ts","../node_modules/ixfx/src/data/arrays/Remove.ts","../node_modules/ixfx/src/iterables/CompareValues.ts","../node_modules/ixfx/src/data/Compare.ts","../node_modules/ixfx/src/rx/index.ts","../node_modules/ixfx/src/rx/sources/Function.ts","../node_modules/ixfx/src/iterables/IterableAsync.ts","../node_modules/ixfx/src/rx/sources/Iterator.ts","../node_modules/ixfx/src/rx/ResolveSource.ts","../node_modules/ixfx/src/rx/Cache.ts","../node_modules/ixfx/src/rx/InitStream.ts","../node_modules/ixfx/src/dom/SetProperty.ts","../node_modules/ixfx/src/rx/sinks/Dom.ts","../node_modules/ixfx/src/rx/ToReadable.ts","../node_modules/ixfx/src/rx/ops/Annotate.ts","../node_modules/ixfx/src/rx/ops/Chunk.ts","../node_modules/ixfx/src/rx/ops/Transform.ts","../node_modules/ixfx/src/rx/ops/CloneFromFields.ts","../node_modules/ixfx/src/rx/ops/CombineLatestToArray.ts","../node_modules/ixfx/src/data/Pathed.ts","../node_modules/ixfx/src/data/Util.ts","../node_modules/ixfx/src/rx/sources/Object.ts","../node_modules/ixfx/src/rx/ops/CombineLatestToObject.ts","../node_modules/ixfx/src/rx/ops/ComputeWithPrevious.ts","../node_modules/ixfx/src/rx/ops/Debounce.ts","../node_modules/ixfx/src/rx/ops/Elapsed.ts","../node_modules/ixfx/src/rx/ops/Field.ts","../node_modules/ixfx/src/rx/ops/Filter.ts","../node_modules/ixfx/src/rx/ops/Interpolate.ts","../node_modules/ixfx/src/data/BasicProcessors.ts","../node_modules/ixfx/src/rx/ops/Math.ts","../node_modules/ixfx/src/rx/ops/Pipe.ts","../node_modules/ixfx/src/rx/ops/SingleFromArray.ts","../node_modules/ixfx/src/rx/ops/Split.ts","../node_modules/ixfx/src/rx/ops/Switcher.ts","../node_modules/ixfx/src/rx/ops/SyncToArray.ts","../node_modules/ixfx/src/rx/ops/SyncToObject.ts","../node_modules/ixfx/src/data/Process.ts","../node_modules/ixfx/src/rx/ops/Tap.ts","../node_modules/ixfx/src/rx/ops/Throttle.ts","../node_modules/ixfx/src/rx/ops/TimeoutValue.ts","../node_modules/ixfx/src/rx/ops/TimeoutPing.ts","../node_modules/ixfx/src/rx/ops/ValueToPing.ts","../node_modules/ixfx/src/rx/ops/WithValue.ts","../node_modules/ixfx/src/collections/graphs/DirectedGraph.ts","../node_modules/ixfx/src/collections/queue/PriorityMutable.ts","../node_modules/ixfx/src/collections/Table.ts","../node_modules/ixfx/src/rx/Graph.ts","../node_modules/ixfx/src/rx/Types.ts","../node_modules/ixfx/src/rx/ToArray.ts","../node_modules/ixfx/src/rx/ToGenerator.ts","../node_modules/ixfx/src/data/MapObject.ts","../node_modules/ixfx/src/rx/Wrap.ts","../node_modules/ixfx/src/rx/Count.ts","../node_modules/ixfx/src/rx/Dom.ts","../node_modules/ixfx/src/text/Segments.ts","../node_modules/ixfx/src/rx/sources/index.ts","../node_modules/ixfx/src/rx/sources/Array.ts","../node_modules/ixfx/src/rx/sources/ArrayObject.ts","../node_modules/ixfx/src/rx/sources/Boolean.ts","../node_modules/ixfx/src/rx/sources/Colour.ts","../node_modules/ixfx/src/rx/sources/Derived.ts","../node_modules/ixfx/src/rx/sources/Event.ts","../node_modules/ixfx/src/rx/sources/Dom.ts","../node_modules/ixfx/src/rx/sources/Number.ts","../node_modules/ixfx/src/rx/sources/ObjectProxy.ts","../node_modules/ixfx/src/rx/sources/Observable.ts","../node_modules/ixfx/src/rx/sources/String.ts","../node_modules/ixfx/src/collections/queue/index.ts","../node_modules/ixfx/src/collections/queue/QueueImmutable.ts","../node_modules/ixfx/src/collections/queue/Responsive.ts","../node_modules/ixfx/src/dom/DomRx.ts","../node_modules/ixfx/src/dom/CanvasSizing.ts","../node_modules/ixfx/src/geometry/point/Guard.ts","../node_modules/ixfx/src/geometry/line/FromPoints.ts","../node_modules/ixfx/src/geometry/line/FromNumbers.ts","../node_modules/ixfx/src/visual/Svg.ts","../node_modules/ixfx/src/visual/SvgMarkers.ts","../node_modules/ixfx/src/visual/SvgElements.ts","../node_modules/ixfx/src/numbers/Quantise.ts","../node_modules/ixfx/src/numbers/LinearSpace.ts","../node_modules/ixfx/src/numbers/NumericArrays.ts","../node_modules/ixfx/src/collections/set/index.ts","../node_modules/ixfx/src/collections/set/SetMutable.ts","../node_modules/ixfx/src/collections/set/SetImmutable.ts","../node_modules/ixfx/src/collections/set/MassiveSet.ts","../node_modules/ixfx/src/data/arrays/Sort.ts","../node_modules/ixfx/src/geometry/index.ts","../node_modules/ixfx/src/geometry/Waypoint.ts","../node_modules/ixfx/src/geometry/line/JoinPointsToLines.ts","../node_modules/ixfx/src/geometry/line/Guard.ts","../node_modules/ixfx/src/geometry/line/GetPointsParameter.ts","../node_modules/ixfx/src/geometry/line/Length.ts","../node_modules/ixfx/src/geometry/line/Interpolate.ts","../node_modules/ixfx/src/geometry/line/Angles.ts","../node_modules/ixfx/src/geometry/line/Midpoint.ts","../node_modules/ixfx/src/geometry/line/index.ts","../node_modules/ixfx/src/geometry/rect/Guard.ts","../node_modules/ixfx/src/geometry/point/NormaliseByRect.ts","../node_modules/ixfx/src/geometry/point/GetPointParameter.ts","../node_modules/ixfx/src/geometry/point/Distance.ts","../node_modules/ixfx/src/geometry/line/Nearest.ts","../node_modules/ixfx/src/geometry/line/DistanceSingleLine.ts","../node_modules/ixfx/src/geometry/point/FindMinimum.ts","../node_modules/ixfx/src/geometry/rect/Max.ts","../node_modules/ixfx/src/geometry/point/Bbox.ts","../node_modules/ixfx/src/geometry/line/Bbox.ts","../node_modules/ixfx/src/geometry/point/Divider.ts","../node_modules/ixfx/src/geometry/line/Divide.ts","../node_modules/ixfx/src/geometry/line/FromFlatArray.ts","../node_modules/ixfx/src/geometry/Polar.ts","../node_modules/ixfx/src/geometry/Angles.ts","../node_modules/ixfx/src/geometry/point/Subtract.ts","../node_modules/ixfx/src/geometry/point/Empty.ts","../node_modules/ixfx/src/geometry/line/FromPivot.ts","../node_modules/ixfx/src/geometry/line/FromPointsToPath.ts","../node_modules/ixfx/src/geometry/point/IsEqual.ts","../node_modules/ixfx/src/geometry/line/IsEqual.ts","../node_modules/ixfx/src/geometry/point/index.ts","../node_modules/ixfx/src/geometry/point/Abs.ts","../node_modules/ixfx/src/geometry/point/Angle.ts","../node_modules/ixfx/src/geometry/point/Apply.ts","../node_modules/ixfx/src/geometry/point/Centroid.ts","../node_modules/ixfx/src/geometry/point/Clamp.ts","../node_modules/ixfx/src/geometry/point/Compare.ts","../node_modules/ixfx/src/geometry/point/ConvexHull.ts","../node_modules/ixfx/src/geometry/circle/Guard.ts","../node_modules/ixfx/src/geometry/circle/DistanceCenter.ts","../node_modules/ixfx/src/geometry/circle/DistanceFromExterior.ts","../node_modules/ixfx/src/geometry/circle/IsEqual.ts","../node_modules/ixfx/src/geometry/point/Sum.ts","../node_modules/ixfx/src/geometry/circle/Intersections.ts","../node_modules/ixfx/src/geometry/Intersects.ts","../node_modules/ixfx/src/geometry/rect/Intersects.ts","../node_modules/ixfx/src/geometry/rect/Center.ts","../node_modules/ixfx/src/geometry/point/PointType.ts","../node_modules/ixfx/src/geometry/rect/Distance.ts","../node_modules/ixfx/src/geometry/point/DistanceToCenter.ts","../node_modules/ixfx/src/geometry/point/DistanceToExterior.ts","../node_modules/ixfx/src/geometry/point/ToArray.ts","../node_modules/ixfx/src/geometry/point/DotProduct.ts","../node_modules/ixfx/src/geometry/point/From.ts","../node_modules/ixfx/src/geometry/point/Interpolate.ts","../node_modules/ixfx/src/geometry/point/Invert.ts","../node_modules/ixfx/src/geometry/point/Multiply.ts","../node_modules/ixfx/src/geometry/point/Magnitude.ts","../node_modules/ixfx/src/geometry/point/Most.ts","../node_modules/ixfx/src/geometry/point/Normalise.ts","../node_modules/ixfx/src/geometry/point/Pipeline.ts","../node_modules/ixfx/src/geometry/point/ProgressBetween.ts","../node_modules/ixfx/src/geometry/point/Project.ts","../node_modules/ixfx/src/geometry/point/Quantise.ts","../node_modules/ixfx/src/geometry/point/Random.ts","../node_modules/ixfx/src/geometry/point/Reduce.ts","../node_modules/ixfx/src/geometry/point/Relation.ts","../node_modules/ixfx/src/geometry/point/Rotate.ts","../node_modules/ixfx/src/geometry/point/RotatePointArray.ts","../node_modules/ixfx/src/geometry/point/Round.ts","../node_modules/ixfx/src/geometry/point/To.ts","../node_modules/ixfx/src/geometry/point/WithinRange.ts","../node_modules/ixfx/src/geometry/point/Wrap.ts","../node_modules/ixfx/src/geometry/line/Multiply.ts","../node_modules/ixfx/src/geometry/line/RelativePosition.ts","../node_modules/ixfx/src/geometry/line/Rotate.ts","../node_modules/ixfx/src/geometry/line/Subtract.ts","../node_modules/ixfx/src/geometry/line/Sum.ts","../node_modules/ixfx/src/geometry/line/ToString.ts","../node_modules/ixfx/src/geometry/line/ToPath.ts","../node_modules/ixfx/src/geometry/Layout.ts","../node_modules/ixfx/src/geometry/CirclePacking.ts","../node_modules/ixfx/src/geometry/shape/index.ts","../node_modules/ixfx/src/geometry/rect/Corners.ts","../node_modules/ixfx/src/geometry/rect/FromTopLeft.ts","../node_modules/ixfx/src/geometry/circle/IsContainedBy.ts","../node_modules/ixfx/src/geometry/circle/Intersecting.ts","../node_modules/ixfx/src/geometry/circle/Random.ts","../node_modules/ixfx/src/geometry/circle/Center.ts","../node_modules/ixfx/src/geometry/rect/Random.ts","../node_modules/ixfx/src/geometry/circle/index.ts","../node_modules/ixfx/src/geometry/circle/Area.ts","../node_modules/ixfx/src/geometry/rect/FromCenter.ts","../node_modules/ixfx/src/geometry/circle/Bbox.ts","../node_modules/ixfx/src/geometry/circle/ExteriorPoints.ts","../node_modules/ixfx/src/geometry/circle/InteriorPoints.ts","../node_modules/ixfx/src/geometry/circle/Perimeter.ts","../node_modules/ixfx/src/geometry/circle/Interpolate.ts","../node_modules/ixfx/src/geometry/circle/Multiply.ts","../node_modules/ixfx/src/geometry/circle/Svg.ts","../node_modules/ixfx/src/geometry/circle/ToPath.ts","../node_modules/ixfx/src/geometry/circle/ToPositioned.ts","../node_modules/ixfx/src/geometry/rect/index.ts","../node_modules/ixfx/src/geometry/rect/Area.ts","../node_modules/ixfx/src/geometry/rect/Apply.ts","../node_modules/ixfx/src/geometry/rect/Cardinal.ts","../node_modules/ixfx/src/geometry/rect/Edges.ts","../node_modules/ixfx/src/geometry/rect/Empty.ts","../node_modules/ixfx/src/geometry/rect/FromElement.ts","../node_modules/ixfx/src/geometry/rect/FromNumbers.ts","../node_modules/ixfx/src/geometry/rect/GetRectPositionedParameter.ts","../node_modules/ixfx/src/geometry/rect/IsEqual.ts","../node_modules/ixfx/src/geometry/rect/Lengths.ts","../node_modules/ixfx/src/geometry/rect/Multiply.ts","../node_modules/ixfx/src/geometry/rect/Divide.ts","../node_modules/ixfx/src/geometry/rect/Subtract.ts","../node_modules/ixfx/src/geometry/rect/Sum.ts","../node_modules/ixfx/src/geometry/rect/ToArray.ts","../node_modules/ixfx/src/geometry/path/index.ts","../node_modules/ixfx/src/geometry/bezier/Guard.ts","../node_modules/ixfx/src/geometry/Grid.ts","../node_modules/ixfx/src/geometry/bezier/index.ts","../node_modules/ixfx/node_modules/bezier-js/src/utils.js","../node_modules/ixfx/node_modules/bezier-js/src/poly-bezier.js","../node_modules/ixfx/node_modules/bezier-js/src/bezier.js","../node_modules/ixfx/src/geometry/path/CompoundPath.ts","../node_modules/ixfx/src/geometry/Ellipse.ts","../node_modules/ixfx/src/geometry/CurveSimplification.ts","../node_modules/ixfx/src/geometry/QuadTree.ts","../node_modules/ixfx/src/geometry/Scaler.ts","../node_modules/ixfx/src/geometry/rect/Placeholder.ts","../node_modules/ixfx/src/geometry/Convolve2d.ts","../node_modules/ixfx/src/visual/ImageDataGrid.ts","../node_modules/ixfx/src/geometry/arc/index.ts","../node_modules/ixfx/src/geometry/Vector.ts","../node_modules/ixfx/src/geometry/SurfacePoints.ts","../node_modules/ixfx/src/geometry/triangle/index.ts","../node_modules/ixfx/src/geometry/triangle/Guard.ts","../node_modules/ixfx/src/geometry/triangle/Edges.ts","../node_modules/ixfx/src/geometry/triangle/Area.ts","../node_modules/ixfx/src/geometry/triangle/Centroid.ts","../node_modules/ixfx/src/geometry/triangle/Perimeter.ts","../node_modules/ixfx/src/geometry/triangle/InnerCircle.ts","../node_modules/ixfx/src/geometry/triangle/OuterCircle.ts","../node_modules/ixfx/src/geometry/triangle/Rotate.ts","../node_modules/ixfx/src/geometry/triangle/Equilateral.ts","../node_modules/ixfx/src/geometry/triangle/Right.ts","../node_modules/ixfx/src/geometry/triangle/Isosceles.ts","../node_modules/ixfx/src/visual/index.ts","../node_modules/ixfx/src/visual/Drawing.ts","../node_modules/ixfx/src/visual/Plot2.ts","../node_modules/ixfx/src/visual/SceneGraph.ts","../node_modules/ixfx/src/geometry/rect/Clamp.ts","../node_modules/ixfx/src/visual/ScaleCanvas.ts","../node_modules/ixfx/src/visual/Palette.ts","../node_modules/ixfx/src/visual/BipolarView.ts","../node_modules/ixfx/src/visual/PlotOld.ts","../node_modules/ixfx/src/random/index.ts","../node_modules/ixfx/src/random/Chance.ts","../node_modules/ixfx/src/random/NonZero.ts","../node_modules/ixfx/src/random/Gaussian.ts","../node_modules/ixfx/src/random/Guid.ts","../node_modules/ixfx/src/random/Integer.ts","../node_modules/ixfx/src/random/Time.ts","../node_modules/ixfx/src/random/Weighted.ts","../node_modules/ixfx/src/random/WeightedInteger.ts","../src/components/pose-overlay.ts","../src/util/log.ts","../src/recorder.ts","../src/components/vision-element.ts","../src/components/rec-panel.ts","../src/components/video-source.ts","../src/processor-modes.ts","../src/components/model-element.ts","../src/mediapipe/pose-matcher.ts","../src/mediapipe/makeModelPath.ts","../src/mediapipe/pose-detector.ts","../src/mediapipe/object-detector.ts","../src/mediapipe/face-detector.ts","../src/mediapipe/hand-detector.ts","../src/processing.ts","../src/util/text.ts","../src/sources/camera-sources.ts","../src/sources/record-player.ts","../src/sources/recording-sources.ts","../src/sources/video-element-source.ts","../src/sources/index.ts","../node_modules/@clinth/remote/src/Util.ts","../node_modules/@clinth/remote/src/BroadcasterBase.ts","../node_modules/@clinth/remote/src/util/Log.ts","../node_modules/@clinth/remote/src/BcBroadcast.ts","../node_modules/@clinth/remote/src/Broadcast.ts","../node_modules/@clinth/remote/src/LogicalNode.ts","../node_modules/@clinth/remote/src/PeeringSession.ts","../node_modules/@clinth/remote/src/util/ExpiringMap.ts","../node_modules/@clinth/remote/src/Peering.ts","../node_modules/@clinth/remote/src/RtcChannelFactory.ts","../node_modules/@clinth/remote/src/util/StatusDisplay.ts","../node_modules/@clinth/remote/src/util/Events.ts","../node_modules/@clinth/remote/src/ReconnectingWebsocket.ts","../node_modules/@clinth/remote/src/WebsocketBroadcast.ts","../node_modules/@clinth/remote/src/Manager.ts","../node_modules/@clinth/remote/src/index.ts","../src/dispatcher.ts","../src/ml-vision.ts","../src/client.ts"],"sourcesContent":["/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\n\ntype ARIAAttributeMap = {\n  [K in keyof ARIAMixin]: string;\n};\n\n/**\n * Map of ARIAMixin properties to attributes\n */\nexport const ariaMixinAttributes: ARIAAttributeMap = {\n  ariaAtomic: 'aria-atomic',\n  ariaAutoComplete: 'aria-autocomplete',\n  ariaBrailleLabel: 'aria-braillelabel',\n  ariaBrailleRoleDescription: 'aria-brailleroledescription',\n  ariaBusy: 'aria-busy',\n  ariaChecked: 'aria-checked',\n  ariaColCount: 'aria-colcount',\n  ariaColIndex: 'aria-colindex',\n  ariaColSpan: 'aria-colspan',\n  ariaCurrent: 'aria-current',\n  ariaDescription: 'aria-description',\n  ariaDisabled: 'aria-disabled',\n  ariaExpanded: 'aria-expanded',\n  ariaHasPopup: 'aria-haspopup',\n  ariaHidden: 'aria-hidden',\n  ariaInvalid: 'aria-invalid',\n  ariaKeyShortcuts: 'aria-keyshortcuts',\n  ariaLabel: 'aria-label',\n  ariaLevel: 'aria-level',\n  ariaLive: 'aria-live',\n  ariaModal: 'aria-modal',\n  ariaMultiLine: 'aria-multiline',\n  ariaMultiSelectable: 'aria-multiselectable',\n  ariaOrientation: 'aria-orientation',\n  ariaPlaceholder: 'aria-placeholder',\n  ariaPosInSet: 'aria-posinset',\n  ariaPressed: 'aria-pressed',\n  ariaReadOnly: 'aria-readonly',\n  ariaRequired: 'aria-required',\n  ariaRoleDescription: 'aria-roledescription',\n  ariaRowCount: 'aria-rowcount',\n  ariaRowIndex: 'aria-rowindex',\n  ariaRowSpan: 'aria-rowspan',\n  ariaSelected: 'aria-selected',\n  ariaSetSize: 'aria-setsize',\n  ariaSort: 'aria-sort',\n  ariaValueMax: 'aria-valuemax',\n  ariaValueMin: 'aria-valuemin',\n  ariaValueNow: 'aria-valuenow',\n  ariaValueText: 'aria-valuetext',\n  role: 'role',\n};\n\ntype ElementInternalsInterface = ElementInternals;\n\n// Shim the global element internals object\n// Methods should be fine as noops and properties can generally\n// be while on the server.\nexport const ElementInternalsShim = class ElementInternals\n  implements ElementInternalsInterface\n{\n  ariaAtomic = '';\n  ariaAutoComplete = '';\n  ariaBrailleLabel = '';\n  ariaBrailleRoleDescription = '';\n  ariaBusy = '';\n  ariaChecked = '';\n  ariaColCount = '';\n  ariaColIndex = '';\n  ariaColSpan = '';\n  ariaCurrent = '';\n  ariaDescription = '';\n  ariaDisabled = '';\n  ariaExpanded = '';\n  ariaHasPopup = '';\n  ariaHidden = '';\n  ariaInvalid = '';\n  ariaKeyShortcuts = '';\n  ariaLabel = '';\n  ariaLevel = '';\n  ariaLive = '';\n  ariaModal = '';\n  ariaMultiLine = '';\n  ariaMultiSelectable = '';\n  ariaOrientation = '';\n  ariaPlaceholder = '';\n  ariaPosInSet = '';\n  ariaPressed = '';\n  ariaReadOnly = '';\n  ariaRequired = '';\n  ariaRoleDescription = '';\n  ariaRowCount = '';\n  ariaRowIndex = '';\n  ariaRowSpan = '';\n  ariaSelected = '';\n  ariaSetSize = '';\n  ariaSort = '';\n  ariaValueMax = '';\n  ariaValueMin = '';\n  ariaValueNow = '';\n  ariaValueText = '';\n  role = '';\n  __host: HTMLElement;\n  get shadowRoot() {\n    // Grab the shadow root instance from the Element shim\n    // to ensure that the shadow root is always available\n    // to the internals instance even if the mode is 'closed'\n    return (this.__host as HTMLElement & {__shadowRoot: ShadowRoot})\n      .__shadowRoot;\n  }\n  constructor(_host: HTMLElement) {\n    this.__host = _host;\n  }\n  checkValidity() {\n    // TODO(augustjk) Consider actually implementing logic.\n    // See https://github.com/lit/lit/issues/3740\n    console.warn(\n      '`ElementInternals.checkValidity()` was called on the server.' +\n        'This method always returns true.'\n    );\n    return true;\n  }\n  form = null;\n  labels = [] as unknown as NodeListOf<HTMLLabelElement>;\n  reportValidity() {\n    return true;\n  }\n  setFormValue(): void {}\n  setValidity(): void {}\n  states = new Set<string>();\n  validationMessage = '';\n  validity = {} as ValidityState;\n  willValidate = true;\n};\n\nconst ElementInternalsShimWithRealType =\n  ElementInternalsShim as object as typeof ElementInternals;\nexport {ElementInternalsShimWithRealType as ElementInternals};\n\nexport const HYDRATE_INTERNALS_ATTR_PREFIX = 'hydrate-internals-';\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\nimport {ElementInternalsShim} from './lib/element-internals.js';\n\nexport {\n  ariaMixinAttributes,\n  ElementInternals,\n  HYDRATE_INTERNALS_ATTR_PREFIX,\n} from './lib/element-internals.js';\n\nconst attributes = new WeakMap<\n  InstanceType<typeof HTMLElementShim>,\n  Map<string, string>\n>();\nconst attributesForElement = (\n  element: InstanceType<typeof HTMLElementShim>\n) => {\n  let attrs = attributes.get(element);\n  if (attrs === undefined) {\n    attributes.set(element, (attrs = new Map()));\n  }\n  return attrs;\n};\n\n// The typings around the exports below are a little funky:\n//\n// 1. We want the `name` of the shim classes to match the real ones at runtime,\n//    hence e.g. `class Element`.\n// 2. We can't shadow the global types with a simple class declaration, because\n//    then we can't reference the global types for casting, hence e.g.\n//    `const ElementShim = class Element`.\n// 3. We want to export the classes typed as the real ones, hence e.g.\n//    `const ElementShimWithRealType = ElementShim as object as typeof Element;`.\n// 4. We want the exported names to match the real ones, hence e.g.\n//    `export {ElementShimWithRealType as Element}`.\nconst ElementShim = class Element {\n  get attributes() {\n    return Array.from(attributesForElement(this)).map(([name, value]) => ({\n      name,\n      value,\n    }));\n  }\n  private __shadowRootMode: null | ShadowRootMode = null;\n  protected __shadowRoot: null | ShadowRoot = null;\n  protected __internals: null | ElementInternals = null;\n\n  get shadowRoot() {\n    if (this.__shadowRootMode === 'closed') {\n      return null;\n    }\n    return this.__shadowRoot;\n  }\n  get localName() {\n    return (this.constructor as NamedCustomHTMLElementConstructor).__localName;\n  }\n  get tagName() {\n    return this.localName?.toUpperCase();\n  }\n  setAttribute(name: string, value: unknown): void {\n    // Emulate browser behavior that silently casts all values to string. E.g.\n    // `42` becomes `\"42\"` and `{}` becomes `\"[object Object]\"\"`.\n    attributesForElement(this).set(name, String(value));\n  }\n  removeAttribute(name: string) {\n    attributesForElement(this).delete(name);\n  }\n  toggleAttribute(name: string, force?: boolean): boolean {\n    // Steps reference https://dom.spec.whatwg.org/#dom-element-toggleattribute\n    if (this.hasAttribute(name)) {\n      // Step 5\n      if (force === undefined || !force) {\n        this.removeAttribute(name);\n        return false;\n      }\n    } else {\n      // Step 4\n      if (force === undefined || force) {\n        // Step 4.1\n        this.setAttribute(name, '');\n        return true;\n      } else {\n        // Step 4.2\n        return false;\n      }\n    }\n    // Step 6\n    return true;\n  }\n  hasAttribute(name: string) {\n    return attributesForElement(this).has(name);\n  }\n  attachShadow(init: ShadowRootInit): ShadowRoot {\n    const shadowRoot = {host: this} as object as ShadowRoot;\n    this.__shadowRootMode = init.mode;\n    if (init && init.mode === 'open') {\n      this.__shadowRoot = shadowRoot;\n    }\n    return shadowRoot;\n  }\n  attachInternals(): ElementInternals {\n    if (this.__internals !== null) {\n      throw new Error(\n        `Failed to execute 'attachInternals' on 'HTMLElement': ` +\n          `ElementInternals for the specified element was already attached.`\n      );\n    }\n    const internals = new ElementInternalsShim(this as unknown as HTMLElement);\n    this.__internals = internals;\n    return internals as ElementInternals;\n  }\n  getAttribute(name: string) {\n    const value = attributesForElement(this).get(name);\n    return value ?? null;\n  }\n};\nconst ElementShimWithRealType = ElementShim as object as typeof Element;\nexport {ElementShimWithRealType as Element};\n\nconst HTMLElementShim = class HTMLElement extends ElementShim {};\nconst HTMLElementShimWithRealType =\n  HTMLElementShim as object as typeof HTMLElement;\nexport {HTMLElementShimWithRealType as HTMLElement};\n\ninterface CustomHTMLElementConstructor {\n  new (): HTMLElement;\n  observedAttributes?: string[];\n}\n\ninterface NamedCustomHTMLElementConstructor\n  extends CustomHTMLElementConstructor {\n  __localName: string;\n}\n\ntype CustomElementRegistration = {\n  ctor: {new (): HTMLElement};\n  observedAttributes: string[];\n};\n\nconst CustomElementRegistryShim = class CustomElementRegistry {\n  private __definitions = new Map<string, CustomElementRegistration>();\n\n  define(name: string, ctor: CustomHTMLElementConstructor) {\n    if (this.__definitions.has(name)) {\n      if (process.env.NODE_ENV === 'development') {\n        console.warn(\n          `'CustomElementRegistry' already has \"${name}\" defined. ` +\n            `This may have been caused by live reload or hot module ` +\n            `replacement in which case it can be safely ignored.\\n` +\n            `Make sure to test your application with a production build as ` +\n            `repeat registrations will throw in production.`\n        );\n      } else {\n        throw new Error(\n          `Failed to execute 'define' on 'CustomElementRegistry': ` +\n            `the name \"${name}\" has already been used with this registry`\n        );\n      }\n    }\n    // Provide tagName and localName for the component.\n    (ctor as NamedCustomHTMLElementConstructor).__localName = name;\n    this.__definitions.set(name, {\n      ctor,\n      // Note it's important we read `observedAttributes` in case it is a getter\n      // with side-effects, as is the case in Lit, where it triggers class\n      // finalization.\n      //\n      // TODO(aomarks) To be spec compliant, we should also capture the\n      // registration-time lifecycle methods like `connectedCallback`. For them\n      // to be actually accessible to e.g. the Lit SSR element renderer, though,\n      // we'd need to introduce a new API for accessing them (since `get` only\n      // returns the constructor).\n      observedAttributes: ctor.observedAttributes ?? [],\n    });\n  }\n\n  get(name: string) {\n    const definition = this.__definitions.get(name);\n    return definition?.ctor;\n  }\n};\nconst CustomElementRegistryShimWithRealType =\n  CustomElementRegistryShim as object as typeof CustomElementRegistry;\nexport {CustomElementRegistryShimWithRealType as CustomElementRegistry};\n\nexport const customElements = new CustomElementRegistryShimWithRealType();\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\n\nconst NODE_MODE = false;\n\n// Allows minifiers to rename references to globalThis\nconst global = globalThis;\n\n/**\n * Whether the current browser supports `adoptedStyleSheets`.\n */\nexport const supportsAdoptingStyleSheets: boolean =\n  global.ShadowRoot &&\n  (global.ShadyCSS === undefined || global.ShadyCSS.nativeShadow) &&\n  'adoptedStyleSheets' in Document.prototype &&\n  'replace' in CSSStyleSheet.prototype;\n\n/**\n * A CSSResult or native CSSStyleSheet.\n *\n * In browsers that support constructible CSS style sheets, CSSStyleSheet\n * object can be used for styling along side CSSResult from the `css`\n * template tag.\n */\nexport type CSSResultOrNative = CSSResult | CSSStyleSheet;\n\nexport type CSSResultArray = Array<CSSResultOrNative | CSSResultArray>;\n\n/**\n * A single CSSResult, CSSStyleSheet, or an array or nested arrays of those.\n */\nexport type CSSResultGroup = CSSResultOrNative | CSSResultArray;\n\nconst constructionToken = Symbol();\n\nconst cssTagCache = new WeakMap<TemplateStringsArray, CSSStyleSheet>();\n\n/**\n * A container for a string of CSS text, that may be used to create a CSSStyleSheet.\n *\n * CSSResult is the return value of `css`-tagged template literals and\n * `unsafeCSS()`. In order to ensure that CSSResults are only created via the\n * `css` tag and `unsafeCSS()`, CSSResult cannot be constructed directly.\n */\nexport class CSSResult {\n  // This property needs to remain unminified.\n  ['_$cssResult$'] = true;\n  readonly cssText: string;\n  private _styleSheet?: CSSStyleSheet;\n  private _strings: TemplateStringsArray | undefined;\n\n  private constructor(\n    cssText: string,\n    strings: TemplateStringsArray | undefined,\n    safeToken: symbol\n  ) {\n    if (safeToken !== constructionToken) {\n      throw new Error(\n        'CSSResult is not constructable. Use `unsafeCSS` or `css` instead.'\n      );\n    }\n    this.cssText = cssText;\n    this._strings = strings;\n  }\n\n  // This is a getter so that it's lazy. In practice, this means stylesheets\n  // are not created until the first element instance is made.\n  get styleSheet(): CSSStyleSheet | undefined {\n    // If `supportsAdoptingStyleSheets` is true then we assume CSSStyleSheet is\n    // constructable.\n    let styleSheet = this._styleSheet;\n    const strings = this._strings;\n    if (supportsAdoptingStyleSheets && styleSheet === undefined) {\n      const cacheable = strings !== undefined && strings.length === 1;\n      if (cacheable) {\n        styleSheet = cssTagCache.get(strings);\n      }\n      if (styleSheet === undefined) {\n        (this._styleSheet = styleSheet = new CSSStyleSheet()).replaceSync(\n          this.cssText\n        );\n        if (cacheable) {\n          cssTagCache.set(strings, styleSheet);\n        }\n      }\n    }\n    return styleSheet;\n  }\n\n  toString(): string {\n    return this.cssText;\n  }\n}\n\ntype ConstructableCSSResult = CSSResult & {\n  new (\n    cssText: string,\n    strings: TemplateStringsArray | undefined,\n    safeToken: symbol\n  ): CSSResult;\n};\n\nconst textFromCSSResult = (value: CSSResultGroup | number) => {\n  // This property needs to remain unminified.\n  if ((value as CSSResult)['_$cssResult$'] === true) {\n    return (value as CSSResult).cssText;\n  } else if (typeof value === 'number') {\n    return value;\n  } else {\n    throw new Error(\n      `Value passed to 'css' function must be a 'css' function result: ` +\n        `${value}. Use 'unsafeCSS' to pass non-literal values, but take care ` +\n        `to ensure page security.`\n    );\n  }\n};\n\n/**\n * Wrap a value for interpolation in a {@linkcode css} tagged template literal.\n *\n * This is unsafe because untrusted CSS text can be used to phone home\n * or exfiltrate data to an attacker controlled site. Take care to only use\n * this with trusted input.\n */\nexport const unsafeCSS = (value: unknown) =>\n  new (CSSResult as ConstructableCSSResult)(\n    typeof value === 'string' ? value : String(value),\n    undefined,\n    constructionToken\n  );\n\n/**\n * A template literal tag which can be used with LitElement's\n * {@linkcode LitElement.styles} property to set element styles.\n *\n * For security reasons, only literal string values and number may be used in\n * embedded expressions. To incorporate non-literal values {@linkcode unsafeCSS}\n * may be used inside an expression.\n */\nexport const css = (\n  strings: TemplateStringsArray,\n  ...values: (CSSResultGroup | number)[]\n): CSSResult => {\n  const cssText =\n    strings.length === 1\n      ? strings[0]\n      : values.reduce(\n          (acc, v, idx) => acc + textFromCSSResult(v) + strings[idx + 1],\n          strings[0]\n        );\n  return new (CSSResult as ConstructableCSSResult)(\n    cssText,\n    strings,\n    constructionToken\n  );\n};\n\n/**\n * Applies the given styles to a `shadowRoot`. When Shadow DOM is\n * available but `adoptedStyleSheets` is not, styles are appended to the\n * `shadowRoot` to [mimic spec behavior](https://wicg.github.io/construct-stylesheets/#using-constructed-stylesheets).\n * Note, when shimming is used, any styles that are subsequently placed into\n * the shadowRoot should be placed *before* any shimmed adopted styles. This\n * will match spec behavior that gives adopted sheets precedence over styles in\n * shadowRoot.\n */\nexport const adoptStyles = (\n  renderRoot: ShadowRoot,\n  styles: Array<CSSResultOrNative>\n) => {\n  if (supportsAdoptingStyleSheets) {\n    (renderRoot as ShadowRoot).adoptedStyleSheets = styles.map((s) =>\n      s instanceof CSSStyleSheet ? s : s.styleSheet!\n    );\n  } else {\n    for (const s of styles) {\n      const style = document.createElement('style');\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const nonce = (global as any)['litNonce'];\n      if (nonce !== undefined) {\n        style.setAttribute('nonce', nonce);\n      }\n      style.textContent = (s as CSSResult).cssText;\n      renderRoot.appendChild(style);\n    }\n  }\n};\n\nconst cssResultFromStyleSheet = (sheet: CSSStyleSheet) => {\n  let cssText = '';\n  for (const rule of sheet.cssRules) {\n    cssText += rule.cssText;\n  }\n  return unsafeCSS(cssText);\n};\n\nexport const getCompatibleStyle =\n  supportsAdoptingStyleSheets ||\n  (NODE_MODE && global.CSSStyleSheet === undefined)\n    ? (s: CSSResultOrNative) => s\n    : (s: CSSResultOrNative) =>\n        s instanceof CSSStyleSheet ? cssResultFromStyleSheet(s) : s;\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\n\n/**\n * Use this module if you want to create your own base class extending\n * {@link ReactiveElement}.\n * @packageDocumentation\n */\n\nimport {\n  getCompatibleStyle,\n  adoptStyles,\n  CSSResultGroup,\n  CSSResultOrNative,\n} from './css-tag.js';\nimport type {\n  ReactiveController,\n  ReactiveControllerHost,\n} from './reactive-controller.js';\n\n// In the Node build, this import will be injected by Rollup:\n// import {HTMLElement, customElements} from '@lit-labs/ssr-dom-shim';\n\nexport * from './css-tag.js';\nexport type {\n  ReactiveController,\n  ReactiveControllerHost,\n} from './reactive-controller.js';\n\n/**\n * Removes the `readonly` modifier from properties in the union K.\n *\n * This is a safer way to cast a value to a type with a mutable version of a\n * readonly field, than casting to an interface with the field re-declared\n * because it preserves the type of all the fields and warns on typos.\n */\ntype Mutable<T, K extends keyof T> = Omit<T, K> & {\n  -readonly [P in keyof Pick<T, K>]: P extends K ? T[P] : never;\n};\n\n// TODO (justinfagnani): Add `hasOwn` here when we ship ES2022\nconst {\n  is,\n  defineProperty,\n  getOwnPropertyDescriptor,\n  getOwnPropertyNames,\n  getOwnPropertySymbols,\n  getPrototypeOf,\n} = Object;\n\nconst NODE_MODE = false;\n\n// Lets a minifier replace globalThis references with a minified name\nconst global = globalThis;\n\nif (NODE_MODE) {\n  global.customElements ??= customElements;\n}\n\nconst DEV_MODE = true;\n\nlet issueWarning: (code: string, warning: string) => void;\n\nconst trustedTypes = (global as unknown as {trustedTypes?: {emptyScript: ''}})\n  .trustedTypes;\n\n// Temporary workaround for https://crbug.com/993268\n// Currently, any attribute starting with \"on\" is considered to be a\n// TrustedScript source. Such boolean attributes must be set to the equivalent\n// trusted emptyScript value.\nconst emptyStringForBooleanAttribute = trustedTypes\n  ? (trustedTypes.emptyScript as unknown as '')\n  : '';\n\nconst polyfillSupport = DEV_MODE\n  ? global.reactiveElementPolyfillSupportDevMode\n  : global.reactiveElementPolyfillSupport;\n\nif (DEV_MODE) {\n  // Ensure warnings are issued only 1x, even if multiple versions of Lit\n  // are loaded.\n  const issuedWarnings: Set<string | undefined> = (global.litIssuedWarnings ??=\n    new Set());\n\n  // Issue a warning, if we haven't already.\n  issueWarning = (code: string, warning: string) => {\n    warning += ` See https://lit.dev/msg/${code} for more information.`;\n    if (!issuedWarnings.has(warning)) {\n      console.warn(warning);\n      issuedWarnings.add(warning);\n    }\n  };\n\n  issueWarning(\n    'dev-mode',\n    `Lit is in dev mode. Not recommended for production!`\n  );\n\n  // Issue polyfill support warning.\n  if (global.ShadyDOM?.inUse && polyfillSupport === undefined) {\n    issueWarning(\n      'polyfill-support-missing',\n      `Shadow DOM is being polyfilled via \\`ShadyDOM\\` but ` +\n        `the \\`polyfill-support\\` module has not been loaded.`\n    );\n  }\n}\n\n/**\n * Contains types that are part of the unstable debug API.\n *\n * Everything in this API is not stable and may change or be removed in the future,\n * even on patch releases.\n */\n// eslint-disable-next-line @typescript-eslint/no-namespace\nexport namespace ReactiveUnstable {\n  /**\n   * When Lit is running in dev mode and `window.emitLitDebugLogEvents` is true,\n   * we will emit 'lit-debug' events to window, with live details about the update and render\n   * lifecycle. These can be useful for writing debug tooling and visualizations.\n   *\n   * Please be aware that running with window.emitLitDebugLogEvents has performance overhead,\n   * making certain operations that are normally very cheap (like a no-op render) much slower,\n   * because we must copy data and dispatch events.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-namespace\n  export namespace DebugLog {\n    export type Entry = Update;\n    export interface Update {\n      kind: 'update';\n    }\n  }\n}\n\ninterface DebugLoggingWindow {\n  // Even in dev mode, we generally don't want to emit these events, as that's\n  // another level of cost, so only emit them when DEV_MODE is true _and_ when\n  // window.emitLitDebugEvents is true.\n  emitLitDebugLogEvents?: boolean;\n}\n\n/**\n * Useful for visualizing and logging insights into what the Lit template system is doing.\n *\n * Compiled out of prod mode builds.\n */\nconst debugLogEvent = DEV_MODE\n  ? (event: ReactiveUnstable.DebugLog.Entry) => {\n      const shouldEmit = (global as unknown as DebugLoggingWindow)\n        .emitLitDebugLogEvents;\n      if (!shouldEmit) {\n        return;\n      }\n      global.dispatchEvent(\n        new CustomEvent<ReactiveUnstable.DebugLog.Entry>('lit-debug', {\n          detail: event,\n        })\n      );\n    }\n  : undefined;\n\n/*\n * When using Closure Compiler, JSCompiler_renameProperty(property, object) is\n * replaced at compile time by the munged name for object[property]. We cannot\n * alias this function, so we have to use a small shim that has the same\n * behavior when not compiling.\n */\n/*@__INLINE__*/\nconst JSCompiler_renameProperty = <P extends PropertyKey>(\n  prop: P,\n  _obj: unknown\n): P => prop;\n\n/**\n * Converts property values to and from attribute values.\n */\nexport interface ComplexAttributeConverter<Type = unknown, TypeHint = unknown> {\n  /**\n   * Called to convert an attribute value to a property\n   * value.\n   */\n  fromAttribute?(value: string | null, type?: TypeHint): Type;\n\n  /**\n   * Called to convert a property value to an attribute\n   * value.\n   *\n   * It returns unknown instead of string, to be compatible with\n   * https://github.com/WICG/trusted-types (and similar efforts).\n   */\n  toAttribute?(value: Type, type?: TypeHint): unknown;\n}\n\ntype AttributeConverter<Type = unknown, TypeHint = unknown> =\n  | ComplexAttributeConverter<Type>\n  | ((value: string | null, type?: TypeHint) => Type);\n\n/**\n * Defines options for a property accessor.\n */\nexport interface PropertyDeclaration<Type = unknown, TypeHint = unknown> {\n  /**\n   * When set to `true`, indicates the property is internal private state. The\n   * property should not be set by users. When using TypeScript, this property\n   * should be marked as `private` or `protected`, and it is also a common\n   * practice to use a leading `_` in the name. The property is not added to\n   * `observedAttributes`.\n   */\n  readonly state?: boolean;\n\n  /**\n   * Indicates how and whether the property becomes an observed attribute.\n   * If the value is `false`, the property is not added to `observedAttributes`.\n   * If true or absent, the lowercased property name is observed (e.g. `fooBar`\n   * becomes `foobar`). If a string, the string value is observed (e.g\n   * `attribute: 'foo-bar'`).\n   */\n  readonly attribute?: boolean | string;\n\n  /**\n   * Indicates the type of the property. This is used only as a hint for the\n   * `converter` to determine how to convert the attribute\n   * to/from a property.\n   */\n  readonly type?: TypeHint;\n\n  /**\n   * Indicates how to convert the attribute to/from a property. If this value\n   * is a function, it is used to convert the attribute value a the property\n   * value. If it's an object, it can have keys for `fromAttribute` and\n   * `toAttribute`. If no `toAttribute` function is provided and\n   * `reflect` is set to `true`, the property value is set directly to the\n   * attribute. A default `converter` is used if none is provided; it supports\n   * `Boolean`, `String`, `Number`, `Object`, and `Array`. Note,\n   * when a property changes and the converter is used to update the attribute,\n   * the property is never updated again as a result of the attribute changing,\n   * and vice versa.\n   */\n  readonly converter?: AttributeConverter<Type, TypeHint>;\n\n  /**\n   * Indicates if the property should reflect to an attribute.\n   * If `true`, when the property is set, the attribute is set using the\n   * attribute name determined according to the rules for the `attribute`\n   * property option and the value of the property converted using the rules\n   * from the `converter` property option.\n   */\n  readonly reflect?: boolean;\n\n  /**\n   * A function that indicates if a property should be considered changed when\n   * it is set. The function should take the `newValue` and `oldValue` and\n   * return `true` if an update should be requested.\n   */\n  hasChanged?(value: Type, oldValue: Type): boolean;\n\n  /**\n   * Indicates whether an accessor will be created for this property. By\n   * default, an accessor will be generated for this property that requests an\n   * update when set. If this flag is `true`, no accessor will be created, and\n   * it will be the user's responsibility to call\n   * `this.requestUpdate(propertyName, oldValue)` to request an update when\n   * the property changes.\n   */\n  readonly noAccessor?: boolean;\n\n  /**\n   * Whether this property is wrapping accessors. This is set by `@property`\n   * to control the initial value change and reflection logic.\n   *\n   * @internal\n   */\n  wrapped?: boolean;\n}\n\n/**\n * Map of properties to PropertyDeclaration options. For each property an\n * accessor is made, and the property is processed according to the\n * PropertyDeclaration options.\n */\nexport interface PropertyDeclarations {\n  readonly [key: string]: PropertyDeclaration;\n}\n\ntype PropertyDeclarationMap = Map<PropertyKey, PropertyDeclaration>;\n\ntype AttributeMap = Map<string, PropertyKey>;\n\n/**\n * A Map of property keys to values.\n *\n * Takes an optional type parameter T, which when specified as a non-any,\n * non-unknown type, will make the Map more strongly-typed, associating the map\n * keys with their corresponding value type on T.\n *\n * Use `PropertyValues<this>` when overriding ReactiveElement.update() and\n * other lifecycle methods in order to get stronger type-checking on keys\n * and values.\n */\n// This type is conditional so that if the parameter T is not specified, or\n// is `any`, the type will include `Map<PropertyKey, unknown>`. Since T is not\n// given in the uses of PropertyValues in this file, all uses here fallback to\n// meaning `Map<PropertyKey, unknown>`, but if a developer uses\n// `PropertyValues<this>` (or any other value for T) they will get a\n// strongly-typed Map type.\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport type PropertyValues<T = any> = T extends object\n  ? PropertyValueMap<T>\n  : Map<PropertyKey, unknown>;\n\n/**\n * Do not use, instead prefer {@linkcode PropertyValues}.\n */\n// This type must be exported such that JavaScript generated by the Google\n// Closure Compiler can import a type reference.\nexport interface PropertyValueMap<T> extends Map<PropertyKey, unknown> {\n  get<K extends keyof T>(k: K): T[K] | undefined;\n  set<K extends keyof T>(key: K, value: T[K]): this;\n  has<K extends keyof T>(k: K): boolean;\n  delete<K extends keyof T>(k: K): boolean;\n}\n\nexport const defaultConverter: ComplexAttributeConverter = {\n  toAttribute(value: unknown, type?: unknown): unknown {\n    switch (type) {\n      case Boolean:\n        value = value ? emptyStringForBooleanAttribute : null;\n        break;\n      case Object:\n      case Array:\n        // if the value is `null` or `undefined` pass this through\n        // to allow removing/no change behavior.\n        value = value == null ? value : JSON.stringify(value);\n        break;\n    }\n    return value;\n  },\n\n  fromAttribute(value: string | null, type?: unknown) {\n    let fromValue: unknown = value;\n    switch (type) {\n      case Boolean:\n        fromValue = value !== null;\n        break;\n      case Number:\n        fromValue = value === null ? null : Number(value);\n        break;\n      case Object:\n      case Array:\n        // Do *not* generate exception when invalid JSON is set as elements\n        // don't normally complain on being mis-configured.\n        // TODO(sorvell): Do generate exception in *dev mode*.\n        try {\n          // Assert to adhere to Bazel's \"must type assert JSON parse\" rule.\n          fromValue = JSON.parse(value!) as unknown;\n        } catch (e) {\n          fromValue = null;\n        }\n        break;\n    }\n    return fromValue;\n  },\n};\n\nexport interface HasChanged {\n  (value: unknown, old: unknown): boolean;\n}\n\n/**\n * Change function that returns true if `value` is different from `oldValue`.\n * This method is used as the default for a property's `hasChanged` function.\n */\nexport const notEqual: HasChanged = (value: unknown, old: unknown): boolean =>\n  !is(value, old);\n\nconst defaultPropertyDeclaration: PropertyDeclaration = {\n  attribute: true,\n  type: String,\n  converter: defaultConverter,\n  reflect: false,\n  hasChanged: notEqual,\n};\n\n/**\n * A string representing one of the supported dev mode warning categories.\n */\nexport type WarningKind =\n  | 'change-in-update'\n  | 'migration'\n  | 'async-perform-update';\n\nexport type Initializer = (element: ReactiveElement) => void;\n\n// Temporary, until google3 is on TypeScript 5.2\ndeclare global {\n  interface SymbolConstructor {\n    readonly metadata: unique symbol;\n  }\n}\n\n// Ensure metadata is enabled. TypeScript does not polyfill\n// Symbol.metadata, so we must ensure that it exists.\n(Symbol as {metadata: symbol}).metadata ??= Symbol('metadata');\n\ndeclare global {\n  // This is public global API, do not change!\n  // eslint-disable-next-line no-var\n  var litPropertyMetadata: WeakMap<\n    object,\n    Map<PropertyKey, PropertyDeclaration>\n  >;\n}\n\n// Map from a class's metadata object to property options\n// Note that we must use nullish-coalescing assignment so that we only use one\n// map even if we load multiple version of this module.\nglobal.litPropertyMetadata ??= new WeakMap<\n  object,\n  Map<PropertyKey, PropertyDeclaration>\n>();\n\n/**\n * Base element class which manages element properties and attributes. When\n * properties change, the `update` method is asynchronously called. This method\n * should be supplied by subclasses to render updates as desired.\n * @noInheritDoc\n */\nexport abstract class ReactiveElement\n  // In the Node build, this `extends` clause will be substituted with\n  // `(globalThis.HTMLElement ?? HTMLElement)`.\n  //\n  // This way, we will first prefer any global `HTMLElement` polyfill that the\n  // user has assigned, and then fall back to the `HTMLElement` shim which has\n  // been imported (see note at the top of this file about how this import is\n  // generated by Rollup). Note that the `HTMLElement` variable has been\n  // shadowed by this import, so it no longer refers to the global.\n  extends HTMLElement\n  implements ReactiveControllerHost\n{\n  // Note: these are patched in only in DEV_MODE.\n  /**\n   * Read or set all the enabled warning categories for this class.\n   *\n   * This property is only used in development builds.\n   *\n   * @nocollapse\n   * @category dev-mode\n   */\n  static enabledWarnings?: WarningKind[];\n\n  /**\n   * Enable the given warning category for this class.\n   *\n   * This method only exists in development builds, so it should be accessed\n   * with a guard like:\n   *\n   * ```ts\n   * // Enable for all ReactiveElement subclasses\n   * ReactiveElement.enableWarning?.('migration');\n   *\n   * // Enable for only MyElement and subclasses\n   * MyElement.enableWarning?.('migration');\n   * ```\n   *\n   * @nocollapse\n   * @category dev-mode\n   */\n  static enableWarning?: (warningKind: WarningKind) => void;\n\n  /**\n   * Disable the given warning category for this class.\n   *\n   * This method only exists in development builds, so it should be accessed\n   * with a guard like:\n   *\n   * ```ts\n   * // Disable for all ReactiveElement subclasses\n   * ReactiveElement.disableWarning?.('migration');\n   *\n   * // Disable for only MyElement and subclasses\n   * MyElement.disableWarning?.('migration');\n   * ```\n   *\n   * @nocollapse\n   * @category dev-mode\n   */\n  static disableWarning?: (warningKind: WarningKind) => void;\n\n  /**\n   * Adds an initializer function to the class that is called during instance\n   * construction.\n   *\n   * This is useful for code that runs against a `ReactiveElement`\n   * subclass, such as a decorator, that needs to do work for each\n   * instance, such as setting up a `ReactiveController`.\n   *\n   * ```ts\n   * const myDecorator = (target: typeof ReactiveElement, key: string) => {\n   *   target.addInitializer((instance: ReactiveElement) => {\n   *     // This is run during construction of the element\n   *     new MyController(instance);\n   *   });\n   * }\n   * ```\n   *\n   * Decorating a field will then cause each instance to run an initializer\n   * that adds a controller:\n   *\n   * ```ts\n   * class MyElement extends LitElement {\n   *   @myDecorator foo;\n   * }\n   * ```\n   *\n   * Initializers are stored per-constructor. Adding an initializer to a\n   * subclass does not add it to a superclass. Since initializers are run in\n   * constructors, initializers will run in order of the class hierarchy,\n   * starting with superclasses and progressing to the instance's class.\n   *\n   * @nocollapse\n   */\n  static addInitializer(initializer: Initializer) {\n    this.__prepare();\n    (this._initializers ??= []).push(initializer);\n  }\n\n  static _initializers?: Initializer[];\n\n  /*\n   * Due to closure compiler ES6 compilation bugs, @nocollapse is required on\n   * all static methods and properties with initializers.  Reference:\n   * - https://github.com/google/closure-compiler/issues/1776\n   */\n\n  /**\n   * Maps attribute names to properties; for example `foobar` attribute to\n   * `fooBar` property. Created lazily on user subclasses when finalizing the\n   * class.\n   * @nocollapse\n   */\n  private static __attributeToPropertyMap: AttributeMap;\n\n  /**\n   * Marks class as having been finalized, which includes creating properties\n   * from `static properties`, but does *not* include all properties created\n   * from decorators.\n   * @nocollapse\n   */\n  protected static finalized: true | undefined;\n\n  /**\n   * Memoized list of all element properties, including any superclass\n   * properties. Created lazily on user subclasses when finalizing the class.\n   *\n   * @nocollapse\n   * @category properties\n   */\n  static elementProperties: PropertyDeclarationMap;\n\n  /**\n   * User-supplied object that maps property names to `PropertyDeclaration`\n   * objects containing options for configuring reactive properties. When\n   * a reactive property is set the element will update and render.\n   *\n   * By default properties are public fields, and as such, they should be\n   * considered as primarily settable by element users, either via attribute or\n   * the property itself.\n   *\n   * Generally, properties that are changed by the element should be private or\n   * protected fields and should use the `state: true` option. Properties\n   * marked as `state` do not reflect from the corresponding attribute\n   *\n   * However, sometimes element code does need to set a public property. This\n   * should typically only be done in response to user interaction, and an event\n   * should be fired informing the user; for example, a checkbox sets its\n   * `checked` property when clicked and fires a `changed` event. Mutating\n   * public properties should typically not be done for non-primitive (object or\n   * array) properties. In other cases when an element needs to manage state, a\n   * private property set with the `state: true` option should be used. When\n   * needed, state properties can be initialized via public properties to\n   * facilitate complex interactions.\n   * @nocollapse\n   * @category properties\n   */\n  static properties: PropertyDeclarations;\n\n  /**\n   * Memoized list of all element styles.\n   * Created lazily on user subclasses when finalizing the class.\n   * @nocollapse\n   * @category styles\n   */\n  static elementStyles: Array<CSSResultOrNative> = [];\n\n  /**\n   * Array of styles to apply to the element. The styles should be defined\n   * using the {@linkcode css} tag function, via constructible stylesheets, or\n   * imported from native CSS module scripts.\n   *\n   * Note on Content Security Policy:\n   *\n   * Element styles are implemented with `<style>` tags when the browser doesn't\n   * support adopted StyleSheets. To use such `<style>` tags with the style-src\n   * CSP directive, the style-src value must either include 'unsafe-inline' or\n   * `nonce-<base64-value>` with `<base64-value>` replaced be a server-generated\n   * nonce.\n   *\n   * To provide a nonce to use on generated `<style>` elements, set\n   * `window.litNonce` to a server-generated nonce in your page's HTML, before\n   * loading application code:\n   *\n   * ```html\n   * <script>\n   *   // Generated and unique per request:\n   *   window.litNonce = 'a1b2c3d4';\n   * </script>\n   * ```\n   * @nocollapse\n   * @category styles\n   */\n  static styles?: CSSResultGroup;\n\n  /**\n   * Returns a list of attributes corresponding to the registered properties.\n   * @nocollapse\n   * @category attributes\n   */\n  static get observedAttributes() {\n    // Ensure we've created all properties\n    this.finalize();\n    // this.__attributeToPropertyMap is only undefined after finalize() in\n    // ReactiveElement itself. ReactiveElement.observedAttributes is only\n    // accessed with ReactiveElement as the receiver when a subclass or mixin\n    // calls super.observedAttributes\n    return (\n      this.__attributeToPropertyMap && [...this.__attributeToPropertyMap.keys()]\n    );\n  }\n\n  private __instanceProperties?: PropertyValues = undefined;\n\n  /**\n   * Creates a property accessor on the element prototype if one does not exist\n   * and stores a {@linkcode PropertyDeclaration} for the property with the\n   * given options. The property setter calls the property's `hasChanged`\n   * property option or uses a strict identity check to determine whether or not\n   * to request an update.\n   *\n   * This method may be overridden to customize properties; however,\n   * when doing so, it's important to call `super.createProperty` to ensure\n   * the property is setup correctly. This method calls\n   * `getPropertyDescriptor` internally to get a descriptor to install.\n   * To customize what properties do when they are get or set, override\n   * `getPropertyDescriptor`. To customize the options for a property,\n   * implement `createProperty` like this:\n   *\n   * ```ts\n   * static createProperty(name, options) {\n   *   options = Object.assign(options, {myOption: true});\n   *   super.createProperty(name, options);\n   * }\n   * ```\n   *\n   * @nocollapse\n   * @category properties\n   */\n  static createProperty(\n    name: PropertyKey,\n    options: PropertyDeclaration = defaultPropertyDeclaration\n  ) {\n    // If this is a state property, force the attribute to false.\n    if (options.state) {\n      (options as Mutable<PropertyDeclaration, 'attribute'>).attribute = false;\n    }\n    this.__prepare();\n    this.elementProperties.set(name, options);\n    if (!options.noAccessor) {\n      const key = DEV_MODE\n        ? // Use Symbol.for in dev mode to make it easier to maintain state\n          // when doing HMR.\n          Symbol.for(`${String(name)} (@property() cache)`)\n        : Symbol();\n      const descriptor = this.getPropertyDescriptor(name, key, options);\n      if (descriptor !== undefined) {\n        defineProperty(this.prototype, name, descriptor);\n      }\n    }\n  }\n\n  /**\n   * Returns a property descriptor to be defined on the given named property.\n   * If no descriptor is returned, the property will not become an accessor.\n   * For example,\n   *\n   * ```ts\n   * class MyElement extends LitElement {\n   *   static getPropertyDescriptor(name, key, options) {\n   *     const defaultDescriptor =\n   *         super.getPropertyDescriptor(name, key, options);\n   *     const setter = defaultDescriptor.set;\n   *     return {\n   *       get: defaultDescriptor.get,\n   *       set(value) {\n   *         setter.call(this, value);\n   *         // custom action.\n   *       },\n   *       configurable: true,\n   *       enumerable: true\n   *     }\n   *   }\n   * }\n   * ```\n   *\n   * @nocollapse\n   * @category properties\n   */\n  protected static getPropertyDescriptor(\n    name: PropertyKey,\n    key: string | symbol,\n    options: PropertyDeclaration\n  ): PropertyDescriptor | undefined {\n    const {get, set} = getOwnPropertyDescriptor(this.prototype, name) ?? {\n      get(this: ReactiveElement) {\n        return this[key as keyof typeof this];\n      },\n      set(this: ReactiveElement, v: unknown) {\n        (this as unknown as Record<string | symbol, unknown>)[key] = v;\n      },\n    };\n    if (DEV_MODE && get == null) {\n      if ('value' in (getOwnPropertyDescriptor(this.prototype, name) ?? {})) {\n        throw new Error(\n          `Field ${JSON.stringify(String(name))} on ` +\n            `${this.name} was declared as a reactive property ` +\n            `but it's actually declared as a value on the prototype. ` +\n            `Usually this is due to using @property or @state on a method.`\n        );\n      }\n      issueWarning(\n        'reactive-property-without-getter',\n        `Field ${JSON.stringify(String(name))} on ` +\n          `${this.name} was declared as a reactive property ` +\n          `but it does not have a getter. This will be an error in a ` +\n          `future version of Lit.`\n      );\n    }\n    return {\n      get(this: ReactiveElement) {\n        return get?.call(this);\n      },\n      set(this: ReactiveElement, value: unknown) {\n        const oldValue = get?.call(this);\n        set!.call(this, value);\n        this.requestUpdate(name, oldValue, options);\n      },\n      configurable: true,\n      enumerable: true,\n    };\n  }\n\n  /**\n   * Returns the property options associated with the given property.\n   * These options are defined with a `PropertyDeclaration` via the `properties`\n   * object or the `@property` decorator and are registered in\n   * `createProperty(...)`.\n   *\n   * Note, this method should be considered \"final\" and not overridden. To\n   * customize the options for a given property, override\n   * {@linkcode createProperty}.\n   *\n   * @nocollapse\n   * @final\n   * @category properties\n   */\n  static getPropertyOptions(name: PropertyKey) {\n    return this.elementProperties.get(name) ?? defaultPropertyDeclaration;\n  }\n\n  // Temporary, until google3 is on TypeScript 5.2\n  declare static [Symbol.metadata]: object & Record<PropertyKey, unknown>;\n\n  /**\n   * Initializes static own properties of the class used in bookkeeping\n   * for element properties, initializers, etc.\n   *\n   * Can be called multiple times by code that needs to ensure these\n   * properties exist before using them.\n   *\n   * This method ensures the superclass is finalized so that inherited\n   * property metadata can be copied down.\n   * @nocollapse\n   */\n  private static __prepare() {\n    if (\n      this.hasOwnProperty(JSCompiler_renameProperty('elementProperties', this))\n    ) {\n      // Already prepared\n      return;\n    }\n    // Finalize any superclasses\n    const superCtor = getPrototypeOf(this) as typeof ReactiveElement;\n    superCtor.finalize();\n\n    // Create own set of initializers for this class if any exist on the\n    // superclass and copy them down. Note, for a small perf boost, avoid\n    // creating initializers unless needed.\n    if (superCtor._initializers !== undefined) {\n      this._initializers = [...superCtor._initializers];\n    }\n    // Initialize elementProperties from the superclass\n    this.elementProperties = new Map(superCtor.elementProperties);\n  }\n\n  /**\n   * Finishes setting up the class so that it's ready to be registered\n   * as a custom element and instantiated.\n   *\n   * This method is called by the ReactiveElement.observedAttributes getter.\n   * If you override the observedAttributes getter, you must either call\n   * super.observedAttributes to trigger finalization, or call finalize()\n   * yourself.\n   *\n   * @nocollapse\n   */\n  protected static finalize() {\n    if (this.hasOwnProperty(JSCompiler_renameProperty('finalized', this))) {\n      return;\n    }\n    this.finalized = true;\n    this.__prepare();\n\n    // Create properties from the static properties block:\n    if (this.hasOwnProperty(JSCompiler_renameProperty('properties', this))) {\n      const props = this.properties;\n      const propKeys = [\n        ...getOwnPropertyNames(props),\n        ...getOwnPropertySymbols(props),\n      ] as Array<keyof typeof props>;\n      for (const p of propKeys) {\n        this.createProperty(p, props[p]);\n      }\n    }\n\n    // Create properties from standard decorator metadata:\n    const metadata = this[Symbol.metadata];\n    if (metadata !== null) {\n      const properties = litPropertyMetadata.get(metadata);\n      if (properties !== undefined) {\n        for (const [p, options] of properties) {\n          this.elementProperties.set(p, options);\n        }\n      }\n    }\n\n    // Create the attribute-to-property map\n    this.__attributeToPropertyMap = new Map();\n    for (const [p, options] of this.elementProperties) {\n      const attr = this.__attributeNameForProperty(p, options);\n      if (attr !== undefined) {\n        this.__attributeToPropertyMap.set(attr, p);\n      }\n    }\n\n    this.elementStyles = this.finalizeStyles(this.styles);\n\n    if (DEV_MODE) {\n      if (this.hasOwnProperty('createProperty')) {\n        issueWarning(\n          'no-override-create-property',\n          'Overriding ReactiveElement.createProperty() is deprecated. ' +\n            'The override will not be called with standard decorators'\n        );\n      }\n      if (this.hasOwnProperty('getPropertyDescriptor')) {\n        issueWarning(\n          'no-override-get-property-descriptor',\n          'Overriding ReactiveElement.getPropertyDescriptor() is deprecated. ' +\n            'The override will not be called with standard decorators'\n        );\n      }\n    }\n  }\n\n  /**\n   * Options used when calling `attachShadow`. Set this property to customize\n   * the options for the shadowRoot; for example, to create a closed\n   * shadowRoot: `{mode: 'closed'}`.\n   *\n   * Note, these options are used in `createRenderRoot`. If this method\n   * is customized, options should be respected if possible.\n   * @nocollapse\n   * @category rendering\n   */\n  static shadowRootOptions: ShadowRootInit = {mode: 'open'};\n\n  /**\n   * Takes the styles the user supplied via the `static styles` property and\n   * returns the array of styles to apply to the element.\n   * Override this method to integrate into a style management system.\n   *\n   * Styles are deduplicated preserving the _last_ instance in the list. This\n   * is a performance optimization to avoid duplicated styles that can occur\n   * especially when composing via subclassing. The last item is kept to try\n   * to preserve the cascade order with the assumption that it's most important\n   * that last added styles override previous styles.\n   *\n   * @nocollapse\n   * @category styles\n   */\n  protected static finalizeStyles(\n    styles?: CSSResultGroup\n  ): Array<CSSResultOrNative> {\n    const elementStyles = [];\n    if (Array.isArray(styles)) {\n      // Dedupe the flattened array in reverse order to preserve the last items.\n      // Casting to Array<unknown> works around TS error that\n      // appears to come from trying to flatten a type CSSResultArray.\n      const set = new Set((styles as Array<unknown>).flat(Infinity).reverse());\n      // Then preserve original order by adding the set items in reverse order.\n      for (const s of set) {\n        elementStyles.unshift(getCompatibleStyle(s as CSSResultOrNative));\n      }\n    } else if (styles !== undefined) {\n      elementStyles.push(getCompatibleStyle(styles));\n    }\n    return elementStyles;\n  }\n\n  /**\n   * Node or ShadowRoot into which element DOM should be rendered. Defaults\n   * to an open shadowRoot.\n   * @category rendering\n   */\n  readonly renderRoot!: HTMLElement | DocumentFragment;\n\n  /**\n   * Returns the property name for the given attribute `name`.\n   * @nocollapse\n   */\n  private static __attributeNameForProperty(\n    name: PropertyKey,\n    options: PropertyDeclaration\n  ) {\n    const attribute = options.attribute;\n    return attribute === false\n      ? undefined\n      : typeof attribute === 'string'\n      ? attribute\n      : typeof name === 'string'\n      ? name.toLowerCase()\n      : undefined;\n  }\n\n  // Initialize to an unresolved Promise so we can make sure the element has\n  // connected before first update.\n  private __updatePromise!: Promise<boolean>;\n\n  /**\n   * True if there is a pending update as a result of calling `requestUpdate()`.\n   * Should only be read.\n   * @category updates\n   */\n  isUpdatePending = false;\n\n  /**\n   * Is set to `true` after the first update. The element code cannot assume\n   * that `renderRoot` exists before the element `hasUpdated`.\n   * @category updates\n   */\n  hasUpdated = false;\n\n  /**\n   * Map with keys for any properties that have changed since the last\n   * update cycle with previous values.\n   *\n   * @internal\n   */\n  _$changedProperties!: PropertyValues;\n\n  /**\n   * Properties that should be reflected when updated.\n   */\n  private __reflectingProperties?: Set<PropertyKey>;\n\n  /**\n   * Name of currently reflecting property\n   */\n  private __reflectingProperty: PropertyKey | null = null;\n\n  /**\n   * Set of controllers.\n   */\n  private __controllers?: Set<ReactiveController>;\n\n  constructor() {\n    super();\n    this.__initialize();\n  }\n\n  /**\n   * Internal only override point for customizing work done when elements\n   * are constructed.\n   */\n  private __initialize() {\n    this.__updatePromise = new Promise<boolean>(\n      (res) => (this.enableUpdating = res)\n    );\n    this._$changedProperties = new Map();\n    // This enqueues a microtask that ust run before the first update, so it\n    // must be called before requestUpdate()\n    this.__saveInstanceProperties();\n    // ensures first update will be caught by an early access of\n    // `updateComplete`\n    this.requestUpdate();\n    (this.constructor as typeof ReactiveElement)._initializers?.forEach((i) =>\n      i(this)\n    );\n  }\n\n  /**\n   * Registers a `ReactiveController` to participate in the element's reactive\n   * update cycle. The element automatically calls into any registered\n   * controllers during its lifecycle callbacks.\n   *\n   * If the element is connected when `addController()` is called, the\n   * controller's `hostConnected()` callback will be immediately called.\n   * @category controllers\n   */\n  addController(controller: ReactiveController) {\n    (this.__controllers ??= new Set()).add(controller);\n    // If a controller is added after the element has been connected,\n    // call hostConnected. Note, re-using existence of `renderRoot` here\n    // (which is set in connectedCallback) to avoid the need to track a\n    // first connected state.\n    if (this.renderRoot !== undefined && this.isConnected) {\n      controller.hostConnected?.();\n    }\n  }\n\n  /**\n   * Removes a `ReactiveController` from the element.\n   * @category controllers\n   */\n  removeController(controller: ReactiveController) {\n    this.__controllers?.delete(controller);\n  }\n\n  /**\n   * Fixes any properties set on the instance before upgrade time.\n   * Otherwise these would shadow the accessor and break these properties.\n   * The properties are stored in a Map which is played back after the\n   * constructor runs. Note, on very old versions of Safari (<=9) or Chrome\n   * (<=41), properties created for native platform properties like (`id` or\n   * `name`) may not have default values set in the element constructor. On\n   * these browsers native properties appear on instances and therefore their\n   * default value will overwrite any element default (e.g. if the element sets\n   * this.id = 'id' in the constructor, the 'id' will become '' since this is\n   * the native platform default).\n   */\n  private __saveInstanceProperties() {\n    const instanceProperties = new Map<PropertyKey, unknown>();\n    const elementProperties = (this.constructor as typeof ReactiveElement)\n      .elementProperties;\n    for (const p of elementProperties.keys() as IterableIterator<keyof this>) {\n      if (this.hasOwnProperty(p)) {\n        instanceProperties.set(p, this[p]);\n        delete this[p];\n      }\n    }\n    if (instanceProperties.size > 0) {\n      this.__instanceProperties = instanceProperties;\n    }\n  }\n\n  /**\n   * Returns the node into which the element should render and by default\n   * creates and returns an open shadowRoot. Implement to customize where the\n   * element's DOM is rendered. For example, to render into the element's\n   * childNodes, return `this`.\n   *\n   * @return Returns a node into which to render.\n   * @category rendering\n   */\n  protected createRenderRoot(): HTMLElement | DocumentFragment {\n    const renderRoot =\n      this.shadowRoot ??\n      this.attachShadow(\n        (this.constructor as typeof ReactiveElement).shadowRootOptions\n      );\n    adoptStyles(\n      renderRoot,\n      (this.constructor as typeof ReactiveElement).elementStyles\n    );\n    return renderRoot;\n  }\n\n  /**\n   * On first connection, creates the element's renderRoot, sets up\n   * element styling, and enables updating.\n   * @category lifecycle\n   */\n  connectedCallback() {\n    // Create renderRoot before controllers `hostConnected`\n    (this as Mutable<typeof this, 'renderRoot'>).renderRoot ??=\n      this.createRenderRoot();\n    this.enableUpdating(true);\n    this.__controllers?.forEach((c) => c.hostConnected?.());\n  }\n\n  /**\n   * Note, this method should be considered final and not overridden. It is\n   * overridden on the element instance with a function that triggers the first\n   * update.\n   * @category updates\n   */\n  protected enableUpdating(_requestedUpdate: boolean) {}\n\n  /**\n   * Allows for `super.disconnectedCallback()` in extensions while\n   * reserving the possibility of making non-breaking feature additions\n   * when disconnecting at some point in the future.\n   * @category lifecycle\n   */\n  disconnectedCallback() {\n    this.__controllers?.forEach((c) => c.hostDisconnected?.());\n  }\n\n  /**\n   * Synchronizes property values when attributes change.\n   *\n   * Specifically, when an attribute is set, the corresponding property is set.\n   * You should rarely need to implement this callback. If this method is\n   * overridden, `super.attributeChangedCallback(name, _old, value)` must be\n   * called.\n   *\n   * See [using the lifecycle callbacks](https://developer.mozilla.org/en-US/docs/Web/Web_Components/Using_custom_elements#using_the_lifecycle_callbacks)\n   * on MDN for more information about the `attributeChangedCallback`.\n   * @category attributes\n   */\n  attributeChangedCallback(\n    name: string,\n    _old: string | null,\n    value: string | null\n  ) {\n    this._$attributeToProperty(name, value);\n  }\n\n  private __propertyToAttribute(name: PropertyKey, value: unknown) {\n    const elemProperties: PropertyDeclarationMap = (\n      this.constructor as typeof ReactiveElement\n    ).elementProperties;\n    const options = elemProperties.get(name)!;\n    const attr = (\n      this.constructor as typeof ReactiveElement\n    ).__attributeNameForProperty(name, options);\n    if (attr !== undefined && options.reflect === true) {\n      const converter =\n        (options.converter as ComplexAttributeConverter)?.toAttribute !==\n        undefined\n          ? (options.converter as ComplexAttributeConverter)\n          : defaultConverter;\n      const attrValue = converter.toAttribute!(value, options.type);\n      if (\n        DEV_MODE &&\n        (this.constructor as typeof ReactiveElement).enabledWarnings!.includes(\n          'migration'\n        ) &&\n        attrValue === undefined\n      ) {\n        issueWarning(\n          'undefined-attribute-value',\n          `The attribute value for the ${name as string} property is ` +\n            `undefined on element ${this.localName}. The attribute will be ` +\n            `removed, but in the previous version of \\`ReactiveElement\\`, ` +\n            `the attribute would not have changed.`\n        );\n      }\n      // Track if the property is being reflected to avoid\n      // setting the property again via `attributeChangedCallback`. Note:\n      // 1. this takes advantage of the fact that the callback is synchronous.\n      // 2. will behave incorrectly if multiple attributes are in the reaction\n      // stack at time of calling. However, since we process attributes\n      // in `update` this should not be possible (or an extreme corner case\n      // that we'd like to discover).\n      // mark state reflecting\n      this.__reflectingProperty = name;\n      if (attrValue == null) {\n        this.removeAttribute(attr);\n      } else {\n        this.setAttribute(attr, attrValue as string);\n      }\n      // mark state not reflecting\n      this.__reflectingProperty = null;\n    }\n  }\n\n  /** @internal */\n  _$attributeToProperty(name: string, value: string | null) {\n    const ctor = this.constructor as typeof ReactiveElement;\n    // Note, hint this as an `AttributeMap` so closure clearly understands\n    // the type; it has issues with tracking types through statics\n    const propName = (ctor.__attributeToPropertyMap as AttributeMap).get(name);\n    // Use tracking info to avoid reflecting a property value to an attribute\n    // if it was just set because the attribute changed.\n    if (propName !== undefined && this.__reflectingProperty !== propName) {\n      const options = ctor.getPropertyOptions(propName);\n      const converter =\n        typeof options.converter === 'function'\n          ? {fromAttribute: options.converter}\n          : options.converter?.fromAttribute !== undefined\n          ? options.converter\n          : defaultConverter;\n      // mark state reflecting\n      this.__reflectingProperty = propName;\n      this[propName as keyof this] = converter.fromAttribute!(\n        value,\n        options.type\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      ) as any;\n      // mark state not reflecting\n      this.__reflectingProperty = null;\n    }\n  }\n\n  /**\n   * Requests an update which is processed asynchronously. This should be called\n   * when an element should update based on some state not triggered by setting\n   * a reactive property. In this case, pass no arguments. It should also be\n   * called when manually implementing a property setter. In this case, pass the\n   * property `name` and `oldValue` to ensure that any configured property\n   * options are honored.\n   *\n   * @param name name of requesting property\n   * @param oldValue old value of requesting property\n   * @param options property options to use instead of the previously\n   *     configured options\n   * @category updates\n   */\n  requestUpdate(\n    name?: PropertyKey,\n    oldValue?: unknown,\n    options?: PropertyDeclaration\n  ): void {\n    // If we have a property key, perform property update steps.\n    if (name !== undefined) {\n      if (DEV_MODE && (name as unknown) instanceof Event) {\n        issueWarning(\n          ``,\n          `The requestUpdate() method was called with an Event as the property name. This is probably a mistake caused by binding this.requestUpdate as an event listener. Instead bind a function that will call it with no arguments: () => this.requestUpdate()`\n        );\n      }\n      options ??= (\n        this.constructor as typeof ReactiveElement\n      ).getPropertyOptions(name);\n      const hasChanged = options.hasChanged ?? notEqual;\n      const newValue = this[name as keyof this];\n      if (hasChanged(newValue, oldValue)) {\n        this._$changeProperty(name, oldValue, options);\n      } else {\n        // Abort the request if the property should not be considered changed.\n        return;\n      }\n    }\n    if (this.isUpdatePending === false) {\n      this.__updatePromise = this.__enqueueUpdate();\n    }\n  }\n\n  /**\n   * @internal\n   */\n  _$changeProperty(\n    name: PropertyKey,\n    oldValue: unknown,\n    options: PropertyDeclaration\n  ) {\n    // TODO (justinfagnani): Create a benchmark of Map.has() + Map.set(\n    // vs just Map.set()\n    if (!this._$changedProperties.has(name)) {\n      this._$changedProperties.set(name, oldValue);\n    }\n    // Add to reflecting properties set.\n    // Note, it's important that every change has a chance to add the\n    // property to `__reflectingProperties`. This ensures setting\n    // attribute + property reflects correctly.\n    if (options.reflect === true && this.__reflectingProperty !== name) {\n      (this.__reflectingProperties ??= new Set<PropertyKey>()).add(name);\n    }\n  }\n\n  /**\n   * Sets up the element to asynchronously update.\n   */\n  private async __enqueueUpdate() {\n    this.isUpdatePending = true;\n    try {\n      // Ensure any previous update has resolved before updating.\n      // This `await` also ensures that property changes are batched.\n      await this.__updatePromise;\n    } catch (e) {\n      // Refire any previous errors async so they do not disrupt the update\n      // cycle. Errors are refired so developers have a chance to observe\n      // them, and this can be done by implementing\n      // `window.onunhandledrejection`.\n      Promise.reject(e);\n    }\n    const result = this.scheduleUpdate();\n    // If `scheduleUpdate` returns a Promise, we await it. This is done to\n    // enable coordinating updates with a scheduler. Note, the result is\n    // checked to avoid delaying an additional microtask unless we need to.\n    if (result != null) {\n      await result;\n    }\n    return !this.isUpdatePending;\n  }\n\n  /**\n   * Schedules an element update. You can override this method to change the\n   * timing of updates by returning a Promise. The update will await the\n   * returned Promise, and you should resolve the Promise to allow the update\n   * to proceed. If this method is overridden, `super.scheduleUpdate()`\n   * must be called.\n   *\n   * For instance, to schedule updates to occur just before the next frame:\n   *\n   * ```ts\n   * override protected async scheduleUpdate(): Promise<unknown> {\n   *   await new Promise((resolve) => requestAnimationFrame(() => resolve()));\n   *   super.scheduleUpdate();\n   * }\n   * ```\n   * @category updates\n   */\n  protected scheduleUpdate(): void | Promise<unknown> {\n    const result = this.performUpdate();\n    if (\n      DEV_MODE &&\n      (this.constructor as typeof ReactiveElement).enabledWarnings!.includes(\n        'async-perform-update'\n      ) &&\n      typeof (result as unknown as Promise<unknown> | undefined)?.then ===\n        'function'\n    ) {\n      issueWarning(\n        'async-perform-update',\n        `Element ${this.localName} returned a Promise from performUpdate(). ` +\n          `This behavior is deprecated and will be removed in a future ` +\n          `version of ReactiveElement.`\n      );\n    }\n    return result;\n  }\n\n  /**\n   * Performs an element update. Note, if an exception is thrown during the\n   * update, `firstUpdated` and `updated` will not be called.\n   *\n   * Call `performUpdate()` to immediately process a pending update. This should\n   * generally not be needed, but it can be done in rare cases when you need to\n   * update synchronously.\n   *\n   * @category updates\n   */\n  protected performUpdate(): void {\n    // Abort any update if one is not pending when this is called.\n    // This can happen if `performUpdate` is called early to \"flush\"\n    // the update.\n    if (!this.isUpdatePending) {\n      return;\n    }\n    debugLogEvent?.({kind: 'update'});\n    if (!this.hasUpdated) {\n      // Create renderRoot before first update. This occurs in `connectedCallback`\n      // but is done here to support out of tree calls to `enableUpdating`/`performUpdate`.\n      (this as Mutable<typeof this, 'renderRoot'>).renderRoot ??=\n        this.createRenderRoot();\n      if (DEV_MODE) {\n        // Produce warning if any reactive properties on the prototype are\n        // shadowed by class fields. Instance fields set before upgrade are\n        // deleted by this point, so any own property is caused by class field\n        // initialization in the constructor.\n        const ctor = this.constructor as typeof ReactiveElement;\n        const shadowedProperties = [...ctor.elementProperties.keys()].filter(\n          (p) => this.hasOwnProperty(p) && p in getPrototypeOf(this)\n        );\n        if (shadowedProperties.length) {\n          throw new Error(\n            `The following properties on element ${this.localName} will not ` +\n              `trigger updates as expected because they are set using class ` +\n              `fields: ${shadowedProperties.join(', ')}. ` +\n              `Native class fields and some compiled output will overwrite ` +\n              `accessors used for detecting changes. See ` +\n              `https://lit.dev/msg/class-field-shadowing ` +\n              `for more information.`\n          );\n        }\n      }\n      // Mixin instance properties once, if they exist.\n      if (this.__instanceProperties) {\n        // TODO (justinfagnani): should we use the stored value? Could a new value\n        // have been set since we stored the own property value?\n        for (const [p, value] of this.__instanceProperties) {\n          this[p as keyof this] = value as this[keyof this];\n        }\n        this.__instanceProperties = undefined;\n      }\n      // Trigger initial value reflection and populate the initial\n      // changedProperties map, but only for the case of experimental\n      // decorators on accessors, which will not have already populated the\n      // changedProperties map. We can't know if these accessors had\n      // initializers, so we just set them anyway - a difference from\n      // experimental decorators on fields and standard decorators on\n      // auto-accessors.\n      // For context why experimentalDecorators with auto accessors are handled\n      // specifically also see:\n      // https://github.com/lit/lit/pull/4183#issuecomment-1711959635\n      const elementProperties = (this.constructor as typeof ReactiveElement)\n        .elementProperties;\n      if (elementProperties.size > 0) {\n        for (const [p, options] of elementProperties) {\n          if (\n            options.wrapped === true &&\n            !this._$changedProperties.has(p) &&\n            this[p as keyof this] !== undefined\n          ) {\n            this._$changeProperty(p, this[p as keyof this], options);\n          }\n        }\n      }\n    }\n    let shouldUpdate = false;\n    const changedProperties = this._$changedProperties;\n    try {\n      shouldUpdate = this.shouldUpdate(changedProperties);\n      if (shouldUpdate) {\n        this.willUpdate(changedProperties);\n        this.__controllers?.forEach((c) => c.hostUpdate?.());\n        this.update(changedProperties);\n      } else {\n        this.__markUpdated();\n      }\n    } catch (e) {\n      // Prevent `firstUpdated` and `updated` from running when there's an\n      // update exception.\n      shouldUpdate = false;\n      // Ensure element can accept additional updates after an exception.\n      this.__markUpdated();\n      throw e;\n    }\n    // The update is no longer considered pending and further updates are now allowed.\n    if (shouldUpdate) {\n      this._$didUpdate(changedProperties);\n    }\n  }\n\n  /**\n   * Invoked before `update()` to compute values needed during the update.\n   *\n   * Implement `willUpdate` to compute property values that depend on other\n   * properties and are used in the rest of the update process.\n   *\n   * ```ts\n   * willUpdate(changedProperties) {\n   *   // only need to check changed properties for an expensive computation.\n   *   if (changedProperties.has('firstName') || changedProperties.has('lastName')) {\n   *     this.sha = computeSHA(`${this.firstName} ${this.lastName}`);\n   *   }\n   * }\n   *\n   * render() {\n   *   return html`SHA: ${this.sha}`;\n   * }\n   * ```\n   *\n   * @category updates\n   */\n  protected willUpdate(_changedProperties: PropertyValues): void {}\n\n  // Note, this is an override point for polyfill-support.\n  // @internal\n  _$didUpdate(changedProperties: PropertyValues) {\n    this.__controllers?.forEach((c) => c.hostUpdated?.());\n    if (!this.hasUpdated) {\n      this.hasUpdated = true;\n      this.firstUpdated(changedProperties);\n    }\n    this.updated(changedProperties);\n    if (\n      DEV_MODE &&\n      this.isUpdatePending &&\n      (this.constructor as typeof ReactiveElement).enabledWarnings!.includes(\n        'change-in-update'\n      )\n    ) {\n      issueWarning(\n        'change-in-update',\n        `Element ${this.localName} scheduled an update ` +\n          `(generally because a property was set) ` +\n          `after an update completed, causing a new update to be scheduled. ` +\n          `This is inefficient and should be avoided unless the next update ` +\n          `can only be scheduled as a side effect of the previous update.`\n      );\n    }\n  }\n\n  private __markUpdated() {\n    this._$changedProperties = new Map();\n    this.isUpdatePending = false;\n  }\n\n  /**\n   * Returns a Promise that resolves when the element has completed updating.\n   * The Promise value is a boolean that is `true` if the element completed the\n   * update without triggering another update. The Promise result is `false` if\n   * a property was set inside `updated()`. If the Promise is rejected, an\n   * exception was thrown during the update.\n   *\n   * To await additional asynchronous work, override the `getUpdateComplete`\n   * method. For example, it is sometimes useful to await a rendered element\n   * before fulfilling this Promise. To do this, first await\n   * `super.getUpdateComplete()`, then any subsequent state.\n   *\n   * @return A promise of a boolean that resolves to true if the update completed\n   *     without triggering another update.\n   * @category updates\n   */\n  get updateComplete(): Promise<boolean> {\n    return this.getUpdateComplete();\n  }\n\n  /**\n   * Override point for the `updateComplete` promise.\n   *\n   * It is not safe to override the `updateComplete` getter directly due to a\n   * limitation in TypeScript which means it is not possible to call a\n   * superclass getter (e.g. `super.updateComplete.then(...)`) when the target\n   * language is ES5 (https://github.com/microsoft/TypeScript/issues/338).\n   * This method should be overridden instead. For example:\n   *\n   * ```ts\n   * class MyElement extends LitElement {\n   *   override async getUpdateComplete() {\n   *     const result = await super.getUpdateComplete();\n   *     await this._myChild.updateComplete;\n   *     return result;\n   *   }\n   * }\n   * ```\n   *\n   * @return A promise of a boolean that resolves to true if the update completed\n   *     without triggering another update.\n   * @category updates\n   */\n  protected getUpdateComplete(): Promise<boolean> {\n    return this.__updatePromise;\n  }\n\n  /**\n   * Controls whether or not `update()` should be called when the element requests\n   * an update. By default, this method always returns `true`, but this can be\n   * customized to control when to update.\n   *\n   * @param _changedProperties Map of changed properties with old values\n   * @category updates\n   */\n  protected shouldUpdate(_changedProperties: PropertyValues): boolean {\n    return true;\n  }\n\n  /**\n   * Updates the element. This method reflects property values to attributes.\n   * It can be overridden to render and keep updated element DOM.\n   * Setting properties inside this method will *not* trigger\n   * another update.\n   *\n   * @param _changedProperties Map of changed properties with old values\n   * @category updates\n   */\n  protected update(_changedProperties: PropertyValues) {\n    // The forEach() expression will only run when when __reflectingProperties is\n    // defined, and it returns undefined, setting __reflectingProperties to\n    // undefined\n    this.__reflectingProperties &&= this.__reflectingProperties.forEach((p) =>\n      this.__propertyToAttribute(p, this[p as keyof this])\n    ) as undefined;\n    this.__markUpdated();\n  }\n\n  /**\n   * Invoked whenever the element is updated. Implement to perform\n   * post-updating tasks via DOM APIs, for example, focusing an element.\n   *\n   * Setting properties inside this method will trigger the element to update\n   * again after this update cycle completes.\n   *\n   * @param _changedProperties Map of changed properties with old values\n   * @category updates\n   */\n  protected updated(_changedProperties: PropertyValues) {}\n\n  /**\n   * Invoked when the element is first updated. Implement to perform one time\n   * work on the element after update.\n   *\n   * ```ts\n   * firstUpdated() {\n   *   this.renderRoot.getElementById('my-text-area').focus();\n   * }\n   * ```\n   *\n   * Setting properties inside this method will trigger the element to update\n   * again after this update cycle completes.\n   *\n   * @param _changedProperties Map of changed properties with old values\n   * @category updates\n   */\n  protected firstUpdated(_changedProperties: PropertyValues) {}\n}\n// Assigned here to work around a jscompiler bug with static fields\n// when compiling to ES5.\n// https://github.com/google/closure-compiler/issues/3177\n(ReactiveElement as unknown as Record<string, unknown>)[\n  JSCompiler_renameProperty('elementProperties', ReactiveElement)\n] = new Map();\n(ReactiveElement as unknown as Record<string, unknown>)[\n  JSCompiler_renameProperty('finalized', ReactiveElement)\n] = new Map();\n\n// Apply polyfills if available\npolyfillSupport?.({ReactiveElement});\n\n// Dev mode warnings...\nif (DEV_MODE) {\n  // Default warning set.\n  ReactiveElement.enabledWarnings = [\n    'change-in-update',\n    'async-perform-update',\n  ];\n  const ensureOwnWarnings = function (ctor: typeof ReactiveElement) {\n    if (\n      !ctor.hasOwnProperty(JSCompiler_renameProperty('enabledWarnings', ctor))\n    ) {\n      ctor.enabledWarnings = ctor.enabledWarnings!.slice();\n    }\n  };\n  ReactiveElement.enableWarning = function (\n    this: typeof ReactiveElement,\n    warning: WarningKind\n  ) {\n    ensureOwnWarnings(this);\n    if (!this.enabledWarnings!.includes(warning)) {\n      this.enabledWarnings!.push(warning);\n    }\n  };\n  ReactiveElement.disableWarning = function (\n    this: typeof ReactiveElement,\n    warning: WarningKind\n  ) {\n    ensureOwnWarnings(this);\n    const i = this.enabledWarnings!.indexOf(warning);\n    if (i >= 0) {\n      this.enabledWarnings!.splice(i, 1);\n    }\n  };\n}\n\n// IMPORTANT: do not change the property name or the assignment expression.\n// This line will be used in regexes to search for ReactiveElement usage.\n(global.reactiveElementVersions ??= []).push('2.0.4');\nif (DEV_MODE && global.reactiveElementVersions.length > 1) {\n  issueWarning!(\n    'multiple-versions',\n    `Multiple versions of Lit loaded. Loading multiple versions ` +\n      `is not recommended.`\n  );\n}\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\n\n// IMPORTANT: these imports must be type-only\nimport type {Directive, DirectiveResult, PartInfo} from './directive.js';\nimport type {TrustedHTML, TrustedTypesWindow} from 'trusted-types/lib';\n\nconst DEV_MODE = true;\nconst ENABLE_EXTRA_SECURITY_HOOKS = true;\nconst ENABLE_SHADYDOM_NOPATCH = true;\nconst NODE_MODE = false;\n\n// Allows minifiers to rename references to globalThis\nconst global = globalThis;\n\n/**\n * Contains types that are part of the unstable debug API.\n *\n * Everything in this API is not stable and may change or be removed in the future,\n * even on patch releases.\n */\n// eslint-disable-next-line @typescript-eslint/no-namespace\nexport namespace LitUnstable {\n  /**\n   * When Lit is running in dev mode and `window.emitLitDebugLogEvents` is true,\n   * we will emit 'lit-debug' events to window, with live details about the update and render\n   * lifecycle. These can be useful for writing debug tooling and visualizations.\n   *\n   * Please be aware that running with window.emitLitDebugLogEvents has performance overhead,\n   * making certain operations that are normally very cheap (like a no-op render) much slower,\n   * because we must copy data and dispatch events.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-namespace\n  export namespace DebugLog {\n    export type Entry =\n      | TemplatePrep\n      | TemplateInstantiated\n      | TemplateInstantiatedAndUpdated\n      | TemplateUpdating\n      | BeginRender\n      | EndRender\n      | CommitPartEntry\n      | SetPartValue;\n    export interface TemplatePrep {\n      kind: 'template prep';\n      template: Template;\n      strings: TemplateStringsArray;\n      clonableTemplate: HTMLTemplateElement;\n      parts: TemplatePart[];\n    }\n    export interface BeginRender {\n      kind: 'begin render';\n      id: number;\n      value: unknown;\n      container: HTMLElement | DocumentFragment;\n      options: RenderOptions | undefined;\n      part: ChildPart | undefined;\n    }\n    export interface EndRender {\n      kind: 'end render';\n      id: number;\n      value: unknown;\n      container: HTMLElement | DocumentFragment;\n      options: RenderOptions | undefined;\n      part: ChildPart;\n    }\n    export interface TemplateInstantiated {\n      kind: 'template instantiated';\n      template: Template | CompiledTemplate;\n      instance: TemplateInstance;\n      options: RenderOptions | undefined;\n      fragment: Node;\n      parts: Array<Part | undefined>;\n      values: unknown[];\n    }\n    export interface TemplateInstantiatedAndUpdated {\n      kind: 'template instantiated and updated';\n      template: Template | CompiledTemplate;\n      instance: TemplateInstance;\n      options: RenderOptions | undefined;\n      fragment: Node;\n      parts: Array<Part | undefined>;\n      values: unknown[];\n    }\n    export interface TemplateUpdating {\n      kind: 'template updating';\n      template: Template | CompiledTemplate;\n      instance: TemplateInstance;\n      options: RenderOptions | undefined;\n      parts: Array<Part | undefined>;\n      values: unknown[];\n    }\n    export interface SetPartValue {\n      kind: 'set part';\n      part: Part;\n      value: unknown;\n      valueIndex: number;\n      values: unknown[];\n      templateInstance: TemplateInstance;\n    }\n\n    export type CommitPartEntry =\n      | CommitNothingToChildEntry\n      | CommitText\n      | CommitNode\n      | CommitAttribute\n      | CommitProperty\n      | CommitBooleanAttribute\n      | CommitEventListener\n      | CommitToElementBinding;\n\n    export interface CommitNothingToChildEntry {\n      kind: 'commit nothing to child';\n      start: ChildNode;\n      end: ChildNode | null;\n      parent: Disconnectable | undefined;\n      options: RenderOptions | undefined;\n    }\n\n    export interface CommitText {\n      kind: 'commit text';\n      node: Text;\n      value: unknown;\n      options: RenderOptions | undefined;\n    }\n\n    export interface CommitNode {\n      kind: 'commit node';\n      start: Node;\n      parent: Disconnectable | undefined;\n      value: Node;\n      options: RenderOptions | undefined;\n    }\n\n    export interface CommitAttribute {\n      kind: 'commit attribute';\n      element: Element;\n      name: string;\n      value: unknown;\n      options: RenderOptions | undefined;\n    }\n\n    export interface CommitProperty {\n      kind: 'commit property';\n      element: Element;\n      name: string;\n      value: unknown;\n      options: RenderOptions | undefined;\n    }\n\n    export interface CommitBooleanAttribute {\n      kind: 'commit boolean attribute';\n      element: Element;\n      name: string;\n      value: boolean;\n      options: RenderOptions | undefined;\n    }\n\n    export interface CommitEventListener {\n      kind: 'commit event listener';\n      element: Element;\n      name: string;\n      value: unknown;\n      oldListener: unknown;\n      options: RenderOptions | undefined;\n      // True if we're removing the old event listener (e.g. because settings changed, or value is nothing)\n      removeListener: boolean;\n      // True if we're adding a new event listener (e.g. because first render, or settings changed)\n      addListener: boolean;\n    }\n\n    export interface CommitToElementBinding {\n      kind: 'commit to element binding';\n      element: Element;\n      value: unknown;\n      options: RenderOptions | undefined;\n    }\n  }\n}\n\ninterface DebugLoggingWindow {\n  // Even in dev mode, we generally don't want to emit these events, as that's\n  // another level of cost, so only emit them when DEV_MODE is true _and_ when\n  // window.emitLitDebugEvents is true.\n  emitLitDebugLogEvents?: boolean;\n}\n\n/**\n * Useful for visualizing and logging insights into what the Lit template system is doing.\n *\n * Compiled out of prod mode builds.\n */\nconst debugLogEvent = DEV_MODE\n  ? (event: LitUnstable.DebugLog.Entry) => {\n      const shouldEmit = (global as unknown as DebugLoggingWindow)\n        .emitLitDebugLogEvents;\n      if (!shouldEmit) {\n        return;\n      }\n      global.dispatchEvent(\n        new CustomEvent<LitUnstable.DebugLog.Entry>('lit-debug', {\n          detail: event,\n        }),\n      );\n    }\n  : undefined;\n// Used for connecting beginRender and endRender events when there are nested\n// renders when errors are thrown preventing an endRender event from being\n// called.\nlet debugLogRenderId = 0;\n\nlet issueWarning: (code: string, warning: string) => void;\n\nif (DEV_MODE) {\n  global.litIssuedWarnings ??= new Set();\n\n  // Issue a warning, if we haven't already.\n  issueWarning = (code: string, warning: string) => {\n    warning += code\n      ? ` See https://lit.dev/msg/${code} for more information.`\n      : '';\n    if (!global.litIssuedWarnings!.has(warning)) {\n      console.warn(warning);\n      global.litIssuedWarnings!.add(warning);\n    }\n  };\n\n  issueWarning(\n    'dev-mode',\n    `Lit is in dev mode. Not recommended for production!`,\n  );\n}\n\nconst wrap =\n  ENABLE_SHADYDOM_NOPATCH &&\n  global.ShadyDOM?.inUse &&\n  global.ShadyDOM?.noPatch === true\n    ? (global.ShadyDOM!.wrap as <T extends Node>(node: T) => T)\n    : <T extends Node>(node: T) => node;\n\nconst trustedTypes = (global as unknown as TrustedTypesWindow).trustedTypes;\n\n/**\n * Our TrustedTypePolicy for HTML which is declared using the html template\n * tag function.\n *\n * That HTML is a developer-authored constant, and is parsed with innerHTML\n * before any untrusted expressions have been mixed in. Therefor it is\n * considered safe by construction.\n */\nconst policy = trustedTypes\n  ? trustedTypes.createPolicy('lit-html', {\n      createHTML: (s) => s,\n    })\n  : undefined;\n\n/**\n * Used to sanitize any value before it is written into the DOM. This can be\n * used to implement a security policy of allowed and disallowed values in\n * order to prevent XSS attacks.\n *\n * One way of using this callback would be to check attributes and properties\n * against a list of high risk fields, and require that values written to such\n * fields be instances of a class which is safe by construction. Closure's Safe\n * HTML Types is one implementation of this technique (\n * https://github.com/google/safe-html-types/blob/master/doc/safehtml-types.md).\n * The TrustedTypes polyfill in API-only mode could also be used as a basis\n * for this technique (https://github.com/WICG/trusted-types).\n *\n * @param node The HTML node (usually either a #text node or an Element) that\n *     is being written to. Note that this is just an exemplar node, the write\n *     may take place against another instance of the same class of node.\n * @param name The name of an attribute or property (for example, 'href').\n * @param type Indicates whether the write that's about to be performed will\n *     be to a property or a node.\n * @return A function that will sanitize this class of writes.\n */\nexport type SanitizerFactory = (\n  node: Node,\n  name: string,\n  type: 'property' | 'attribute',\n) => ValueSanitizer;\n\n/**\n * A function which can sanitize values that will be written to a specific kind\n * of DOM sink.\n *\n * See SanitizerFactory.\n *\n * @param value The value to sanitize. Will be the actual value passed into\n *     the lit-html template literal, so this could be of any type.\n * @return The value to write to the DOM. Usually the same as the input value,\n *     unless sanitization is needed.\n */\nexport type ValueSanitizer = (value: unknown) => unknown;\n\nconst identityFunction: ValueSanitizer = (value: unknown) => value;\nconst noopSanitizer: SanitizerFactory = (\n  _node: Node,\n  _name: string,\n  _type: 'property' | 'attribute',\n) => identityFunction;\n\n/** Sets the global sanitizer factory. */\nconst setSanitizer = (newSanitizer: SanitizerFactory) => {\n  if (!ENABLE_EXTRA_SECURITY_HOOKS) {\n    return;\n  }\n  if (sanitizerFactoryInternal !== noopSanitizer) {\n    throw new Error(\n      `Attempted to overwrite existing lit-html security policy.` +\n        ` setSanitizeDOMValueFactory should be called at most once.`,\n    );\n  }\n  sanitizerFactoryInternal = newSanitizer;\n};\n\n/**\n * Only used in internal tests, not a part of the public API.\n */\nconst _testOnlyClearSanitizerFactoryDoNotCallOrElse = () => {\n  sanitizerFactoryInternal = noopSanitizer;\n};\n\nconst createSanitizer: SanitizerFactory = (node, name, type) => {\n  return sanitizerFactoryInternal(node, name, type);\n};\n\n// Added to an attribute name to mark the attribute as bound so we can find\n// it easily.\nconst boundAttributeSuffix = '$lit$';\n\n// This marker is used in many syntactic positions in HTML, so it must be\n// a valid element name and attribute name. We don't support dynamic names (yet)\n// but this at least ensures that the parse tree is closer to the template\n// intention.\nconst marker = `lit$${Math.random().toFixed(9).slice(2)}$`;\n\n// String used to tell if a comment is a marker comment\nconst markerMatch = '?' + marker;\n\n// Text used to insert a comment marker node. We use processing instruction\n// syntax because it's slightly smaller, but parses as a comment node.\nconst nodeMarker = `<${markerMatch}>`;\n\nconst d =\n  NODE_MODE && global.document === undefined\n    ? ({\n        createTreeWalker() {\n          return {};\n        },\n      } as unknown as Document)\n    : document;\n\n// Creates a dynamic marker. We never have to search for these in the DOM.\nconst createMarker = () => d.createComment('');\n\n// https://tc39.github.io/ecma262/#sec-typeof-operator\ntype Primitive = null | undefined | boolean | number | string | symbol | bigint;\nconst isPrimitive = (value: unknown): value is Primitive =>\n  value === null || (typeof value != 'object' && typeof value != 'function');\nconst isArray = Array.isArray;\nconst isIterable = (value: unknown): value is Iterable<unknown> =>\n  isArray(value) ||\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  typeof (value as any)?.[Symbol.iterator] === 'function';\n\nconst SPACE_CHAR = `[ \\t\\n\\f\\r]`;\nconst ATTR_VALUE_CHAR = `[^ \\t\\n\\f\\r\"'\\`<>=]`;\nconst NAME_CHAR = `[^\\\\s\"'>=/]`;\n\n// These regexes represent the five parsing states that we care about in the\n// Template's HTML scanner. They match the *end* of the state they're named\n// after.\n// Depending on the match, we transition to a new state. If there's no match,\n// we stay in the same state.\n// Note that the regexes are stateful. We utilize lastIndex and sync it\n// across the multiple regexes used. In addition to the five regexes below\n// we also dynamically create a regex to find the matching end tags for raw\n// text elements.\n\n/**\n * End of text is: `<` followed by:\n *   (comment start) or (tag) or (dynamic tag binding)\n */\nconst textEndRegex = /<(?:(!--|\\/[^a-zA-Z])|(\\/?[a-zA-Z][^>\\s]*)|(\\/?$))/g;\nconst COMMENT_START = 1;\nconst TAG_NAME = 2;\nconst DYNAMIC_TAG_NAME = 3;\n\nconst commentEndRegex = /-->/g;\n/**\n * Comments not started with <!--, like </{, can be ended by a single `>`\n */\nconst comment2EndRegex = />/g;\n\n/**\n * The tagEnd regex matches the end of the \"inside an opening\" tag syntax\n * position. It either matches a `>`, an attribute-like sequence, or the end\n * of the string after a space (attribute-name position ending).\n *\n * See attributes in the HTML spec:\n * https://www.w3.org/TR/html5/syntax.html#elements-attributes\n *\n * \" \\t\\n\\f\\r\" are HTML space characters:\n * https://infra.spec.whatwg.org/#ascii-whitespace\n *\n * So an attribute is:\n *  * The name: any character except a whitespace character, (\"), ('), \">\",\n *    \"=\", or \"/\". Note: this is different from the HTML spec which also excludes control characters.\n *  * Followed by zero or more space characters\n *  * Followed by \"=\"\n *  * Followed by zero or more space characters\n *  * Followed by:\n *    * Any character except space, ('), (\"), \"<\", \">\", \"=\", (`), or\n *    * (\") then any non-(\"), or\n *    * (') then any non-(')\n */\nconst tagEndRegex = new RegExp(\n  `>|${SPACE_CHAR}(?:(${NAME_CHAR}+)(${SPACE_CHAR}*=${SPACE_CHAR}*(?:${ATTR_VALUE_CHAR}|(\"|')|))|$)`,\n  'g',\n);\nconst ENTIRE_MATCH = 0;\nconst ATTRIBUTE_NAME = 1;\nconst SPACES_AND_EQUALS = 2;\nconst QUOTE_CHAR = 3;\n\nconst singleQuoteAttrEndRegex = /'/g;\nconst doubleQuoteAttrEndRegex = /\"/g;\n/**\n * Matches the raw text elements.\n *\n * Comments are not parsed within raw text elements, so we need to search their\n * text content for marker strings.\n */\nconst rawTextElement = /^(?:script|style|textarea|title)$/i;\n\n/** TemplateResult types */\nconst HTML_RESULT = 1;\nconst SVG_RESULT = 2;\nconst MATHML_RESULT = 3;\n\ntype ResultType = typeof HTML_RESULT | typeof SVG_RESULT | typeof MATHML_RESULT;\n\n// TemplatePart types\n// IMPORTANT: these must match the values in PartType\nconst ATTRIBUTE_PART = 1;\nconst CHILD_PART = 2;\nconst PROPERTY_PART = 3;\nconst BOOLEAN_ATTRIBUTE_PART = 4;\nconst EVENT_PART = 5;\nconst ELEMENT_PART = 6;\nconst COMMENT_PART = 7;\n\n/**\n * The return type of the template tag functions, {@linkcode html} and\n * {@linkcode svg} when it hasn't been compiled by @lit-labs/compiler.\n *\n * A `TemplateResult` object holds all the information about a template\n * expression required to render it: the template strings, expression values,\n * and type of template (html or svg).\n *\n * `TemplateResult` objects do not create any DOM on their own. To create or\n * update DOM you need to render the `TemplateResult`. See\n * [Rendering](https://lit.dev/docs/components/rendering) for more information.\n *\n */\nexport type UncompiledTemplateResult<T extends ResultType = ResultType> = {\n  // This property needs to remain unminified.\n  ['_$litType$']: T;\n  strings: TemplateStringsArray;\n  values: unknown[];\n};\n\n/**\n * This is a template result that may be either uncompiled or compiled.\n *\n * In the future, TemplateResult will be this type. If you want to explicitly\n * note that a template result is potentially compiled, you can reference this\n * type and it will continue to behave the same through the next major version\n * of Lit. This can be useful for code that wants to prepare for the next\n * major version of Lit.\n */\nexport type MaybeCompiledTemplateResult<T extends ResultType = ResultType> =\n  | UncompiledTemplateResult<T>\n  | CompiledTemplateResult;\n\n/**\n * The return type of the template tag functions, {@linkcode html} and\n * {@linkcode svg}.\n *\n * A `TemplateResult` object holds all the information about a template\n * expression required to render it: the template strings, expression values,\n * and type of template (html or svg).\n *\n * `TemplateResult` objects do not create any DOM on their own. To create or\n * update DOM you need to render the `TemplateResult`. See\n * [Rendering](https://lit.dev/docs/components/rendering) for more information.\n *\n * In Lit 4, this type will be an alias of\n * MaybeCompiledTemplateResult, so that code will get type errors if it assumes\n * that Lit templates are not compiled. When deliberately working with only\n * one, use either {@linkcode CompiledTemplateResult} or\n * {@linkcode UncompiledTemplateResult} explicitly.\n */\nexport type TemplateResult<T extends ResultType = ResultType> =\n  UncompiledTemplateResult<T>;\n\nexport type HTMLTemplateResult = TemplateResult<typeof HTML_RESULT>;\n\nexport type SVGTemplateResult = TemplateResult<typeof SVG_RESULT>;\n\nexport type MathMLTemplateResult = TemplateResult<typeof MATHML_RESULT>;\n\n/**\n * A TemplateResult that has been compiled by @lit-labs/compiler, skipping the\n * prepare step.\n */\nexport interface CompiledTemplateResult {\n  // This is a factory in order to make template initialization lazy\n  // and allow ShadyRenderOptions scope to be passed in.\n  // This property needs to remain unminified.\n  ['_$litType$']: CompiledTemplate;\n  values: unknown[];\n}\n\nexport interface CompiledTemplate extends Omit<Template, 'el'> {\n  // el is overridden to be optional. We initialize it on first render\n  el?: HTMLTemplateElement;\n\n  // The prepared HTML string to create a template element from.\n  // The type is a TemplateStringsArray to guarantee that the value came from\n  // source code, preventing a JSON injection attack.\n  h: TemplateStringsArray;\n}\n\n/**\n * Generates a template literal tag function that returns a TemplateResult with\n * the given result type.\n */\nconst tag =\n  <T extends ResultType>(type: T) =>\n  (strings: TemplateStringsArray, ...values: unknown[]): TemplateResult<T> => {\n    // Warn against templates octal escape sequences\n    // We do this here rather than in render so that the warning is closer to the\n    // template definition.\n    if (DEV_MODE && strings.some((s) => s === undefined)) {\n      console.warn(\n        'Some template strings are undefined.\\n' +\n          'This is probably caused by illegal octal escape sequences.',\n      );\n    }\n    if (DEV_MODE) {\n      // Import static-html.js results in a circular dependency which g3 doesn't\n      // handle. Instead we know that static values must have the field\n      // `_$litStatic$`.\n      if (\n        values.some((val) => (val as {_$litStatic$: unknown})?.['_$litStatic$'])\n      ) {\n        issueWarning(\n          '',\n          `Static values 'literal' or 'unsafeStatic' cannot be used as values to non-static templates.\\n` +\n            `Please use the static 'html' tag function. See https://lit.dev/docs/templates/expressions/#static-expressions`,\n        );\n      }\n    }\n    return {\n      // This property needs to remain unminified.\n      ['_$litType$']: type,\n      strings,\n      values,\n    };\n  };\n\n/**\n * Interprets a template literal as an HTML template that can efficiently\n * render to and update a container.\n *\n * ```ts\n * const header = (title: string) => html`<h1>${title}</h1>`;\n * ```\n *\n * The `html` tag returns a description of the DOM to render as a value. It is\n * lazy, meaning no work is done until the template is rendered. When rendering,\n * if a template comes from the same expression as a previously rendered result,\n * it's efficiently updated instead of replaced.\n */\nexport const html = tag(HTML_RESULT);\n\n/**\n * Interprets a template literal as an SVG fragment that can efficiently render\n * to and update a container.\n *\n * ```ts\n * const rect = svg`<rect width=\"10\" height=\"10\"></rect>`;\n *\n * const myImage = html`\n *   <svg viewBox=\"0 0 10 10\" xmlns=\"http://www.w3.org/2000/svg\">\n *     ${rect}\n *   </svg>`;\n * ```\n *\n * The `svg` *tag function* should only be used for SVG fragments, or elements\n * that would be contained **inside** an `<svg>` HTML element. A common error is\n * placing an `<svg>` *element* in a template tagged with the `svg` tag\n * function. The `<svg>` element is an HTML element and should be used within a\n * template tagged with the {@linkcode html} tag function.\n *\n * In LitElement usage, it's invalid to return an SVG fragment from the\n * `render()` method, as the SVG fragment will be contained within the element's\n * shadow root and thus not be properly contained within an `<svg>` HTML\n * element.\n */\nexport const svg = tag(SVG_RESULT);\n\n/**\n * Interprets a template literal as MathML fragment that can efficiently render\n * to and update a container.\n *\n * ```ts\n * const num = mathml`<mn>1</mn>`;\n *\n * const eq = html`\n *   <math>\n *     ${num}\n *   </math>`;\n * ```\n *\n * The `mathml` *tag function* should only be used for MathML fragments, or\n * elements that would be contained **inside** a `<math>` HTML element. A common\n * error is placing a `<math>` *element* in a template tagged with the `mathml`\n * tag function. The `<math>` element is an HTML element and should be used\n * within a template tagged with the {@linkcode html} tag function.\n *\n * In LitElement usage, it's invalid to return an MathML fragment from the\n * `render()` method, as the MathML fragment will be contained within the\n * element's shadow root and thus not be properly contained within a `<math>`\n * HTML element.\n */\nexport const mathml = tag(MATHML_RESULT);\n\n/**\n * A sentinel value that signals that a value was handled by a directive and\n * should not be written to the DOM.\n */\nexport const noChange = Symbol.for('lit-noChange');\n\n/**\n * A sentinel value that signals a ChildPart to fully clear its content.\n *\n * ```ts\n * const button = html`${\n *  user.isAdmin\n *    ? html`<button>DELETE</button>`\n *    : nothing\n * }`;\n * ```\n *\n * Prefer using `nothing` over other falsy values as it provides a consistent\n * behavior between various expression binding contexts.\n *\n * In child expressions, `undefined`, `null`, `''`, and `nothing` all behave the\n * same and render no nodes. In attribute expressions, `nothing` _removes_ the\n * attribute, while `undefined` and `null` will render an empty string. In\n * property expressions `nothing` becomes `undefined`.\n */\nexport const nothing = Symbol.for('lit-nothing');\n\n/**\n * The cache of prepared templates, keyed by the tagged TemplateStringsArray\n * and _not_ accounting for the specific template tag used. This means that\n * template tags cannot be dynamic - they must statically be one of html, svg,\n * or attr. This restriction simplifies the cache lookup, which is on the hot\n * path for rendering.\n */\nconst templateCache = new WeakMap<TemplateStringsArray, Template>();\n\n/**\n * Object specifying options for controlling lit-html rendering. Note that\n * while `render` may be called multiple times on the same `container` (and\n * `renderBefore` reference node) to efficiently update the rendered content,\n * only the options passed in during the first render are respected during\n * the lifetime of renders to that unique `container` + `renderBefore`\n * combination.\n */\nexport interface RenderOptions {\n  /**\n   * An object to use as the `this` value for event listeners. It's often\n   * useful to set this to the host component rendering a template.\n   */\n  host?: object;\n  /**\n   * A DOM node before which to render content in the container.\n   */\n  renderBefore?: ChildNode | null;\n  /**\n   * Node used for cloning the template (`importNode` will be called on this\n   * node). This controls the `ownerDocument` of the rendered DOM, along with\n   * any inherited context. Defaults to the global `document`.\n   */\n  creationScope?: {importNode(node: Node, deep?: boolean): Node};\n  /**\n   * The initial connected state for the top-level part being rendered. If no\n   * `isConnected` option is set, `AsyncDirective`s will be connected by\n   * default. Set to `false` if the initial render occurs in a disconnected tree\n   * and `AsyncDirective`s should see `isConnected === false` for their initial\n   * render. The `part.setConnected()` method must be used subsequent to initial\n   * render to change the connected state of the part.\n   */\n  isConnected?: boolean;\n}\n\nconst walker = d.createTreeWalker(\n  d,\n  129 /* NodeFilter.SHOW_{ELEMENT|COMMENT} */,\n);\n\nlet sanitizerFactoryInternal: SanitizerFactory = noopSanitizer;\n\n//\n// Classes only below here, const variable declarations only above here...\n//\n// Keeping variable declarations and classes together improves minification.\n// Interfaces and type aliases can be interleaved freely.\n//\n\n// Type for classes that have a `_directive` or `_directives[]` field, used by\n// `resolveDirective`\nexport interface DirectiveParent {\n  _$parent?: DirectiveParent;\n  _$isConnected: boolean;\n  __directive?: Directive;\n  __directives?: Array<Directive | undefined>;\n}\n\nfunction trustFromTemplateString(\n  tsa: TemplateStringsArray,\n  stringFromTSA: string,\n): TrustedHTML {\n  // A security check to prevent spoofing of Lit template results.\n  // In the future, we may be able to replace this with Array.isTemplateObject,\n  // though we might need to make that check inside of the html and svg\n  // functions, because precompiled templates don't come in as\n  // TemplateStringArray objects.\n  if (!isArray(tsa) || !tsa.hasOwnProperty('raw')) {\n    let message = 'invalid template strings array';\n    if (DEV_MODE) {\n      message = `\n          Internal Error: expected template strings to be an array\n          with a 'raw' field. Faking a template strings array by\n          calling html or svg like an ordinary function is effectively\n          the same as calling unsafeHtml and can lead to major security\n          issues, e.g. opening your code up to XSS attacks.\n          If you're using the html or svg tagged template functions normally\n          and still seeing this error, please file a bug at\n          https://github.com/lit/lit/issues/new?template=bug_report.md\n          and include information about your build tooling, if any.\n        `\n        .trim()\n        .replace(/\\n */g, '\\n');\n    }\n    throw new Error(message);\n  }\n  return policy !== undefined\n    ? policy.createHTML(stringFromTSA)\n    : (stringFromTSA as unknown as TrustedHTML);\n}\n\n/**\n * Returns an HTML string for the given TemplateStringsArray and result type\n * (HTML or SVG), along with the case-sensitive bound attribute names in\n * template order. The HTML contains comment markers denoting the `ChildPart`s\n * and suffixes on bound attributes denoting the `AttributeParts`.\n *\n * @param strings template strings array\n * @param type HTML or SVG\n * @return Array containing `[html, attrNames]` (array returned for terseness,\n *     to avoid object fields since this code is shared with non-minified SSR\n *     code)\n */\nconst getTemplateHtml = (\n  strings: TemplateStringsArray,\n  type: ResultType,\n): [TrustedHTML, Array<string>] => {\n  // Insert makers into the template HTML to represent the position of\n  // bindings. The following code scans the template strings to determine the\n  // syntactic position of the bindings. They can be in text position, where\n  // we insert an HTML comment, attribute value position, where we insert a\n  // sentinel string and re-write the attribute name, or inside a tag where\n  // we insert the sentinel string.\n  const l = strings.length - 1;\n  // Stores the case-sensitive bound attribute names in the order of their\n  // parts. ElementParts are also reflected in this array as undefined\n  // rather than a string, to disambiguate from attribute bindings.\n  const attrNames: Array<string> = [];\n  let html =\n    type === SVG_RESULT ? '<svg>' : type === MATHML_RESULT ? '<math>' : '';\n\n  // When we're inside a raw text tag (not it's text content), the regex\n  // will still be tagRegex so we can find attributes, but will switch to\n  // this regex when the tag ends.\n  let rawTextEndRegex: RegExp | undefined;\n\n  // The current parsing state, represented as a reference to one of the\n  // regexes\n  let regex = textEndRegex;\n\n  for (let i = 0; i < l; i++) {\n    const s = strings[i];\n    // The index of the end of the last attribute name. When this is\n    // positive at end of a string, it means we're in an attribute value\n    // position and need to rewrite the attribute name.\n    // We also use a special value of -2 to indicate that we encountered\n    // the end of a string in attribute name position.\n    let attrNameEndIndex = -1;\n    let attrName: string | undefined;\n    let lastIndex = 0;\n    let match!: RegExpExecArray | null;\n\n    // The conditions in this loop handle the current parse state, and the\n    // assignments to the `regex` variable are the state transitions.\n    while (lastIndex < s.length) {\n      // Make sure we start searching from where we previously left off\n      regex.lastIndex = lastIndex;\n      match = regex.exec(s);\n      if (match === null) {\n        break;\n      }\n      lastIndex = regex.lastIndex;\n      if (regex === textEndRegex) {\n        if (match[COMMENT_START] === '!--') {\n          regex = commentEndRegex;\n        } else if (match[COMMENT_START] !== undefined) {\n          // We started a weird comment, like </{\n          regex = comment2EndRegex;\n        } else if (match[TAG_NAME] !== undefined) {\n          if (rawTextElement.test(match[TAG_NAME])) {\n            // Record if we encounter a raw-text element. We'll switch to\n            // this regex at the end of the tag.\n            rawTextEndRegex = new RegExp(`</${match[TAG_NAME]}`, 'g');\n          }\n          regex = tagEndRegex;\n        } else if (match[DYNAMIC_TAG_NAME] !== undefined) {\n          if (DEV_MODE) {\n            throw new Error(\n              'Bindings in tag names are not supported. Please use static templates instead. ' +\n                'See https://lit.dev/docs/templates/expressions/#static-expressions',\n            );\n          }\n          regex = tagEndRegex;\n        }\n      } else if (regex === tagEndRegex) {\n        if (match[ENTIRE_MATCH] === '>') {\n          // End of a tag. If we had started a raw-text element, use that\n          // regex\n          regex = rawTextEndRegex ?? textEndRegex;\n          // We may be ending an unquoted attribute value, so make sure we\n          // clear any pending attrNameEndIndex\n          attrNameEndIndex = -1;\n        } else if (match[ATTRIBUTE_NAME] === undefined) {\n          // Attribute name position\n          attrNameEndIndex = -2;\n        } else {\n          attrNameEndIndex = regex.lastIndex - match[SPACES_AND_EQUALS].length;\n          attrName = match[ATTRIBUTE_NAME];\n          regex =\n            match[QUOTE_CHAR] === undefined\n              ? tagEndRegex\n              : match[QUOTE_CHAR] === '\"'\n                ? doubleQuoteAttrEndRegex\n                : singleQuoteAttrEndRegex;\n        }\n      } else if (\n        regex === doubleQuoteAttrEndRegex ||\n        regex === singleQuoteAttrEndRegex\n      ) {\n        regex = tagEndRegex;\n      } else if (regex === commentEndRegex || regex === comment2EndRegex) {\n        regex = textEndRegex;\n      } else {\n        // Not one of the five state regexes, so it must be the dynamically\n        // created raw text regex and we're at the close of that element.\n        regex = tagEndRegex;\n        rawTextEndRegex = undefined;\n      }\n    }\n\n    if (DEV_MODE) {\n      // If we have a attrNameEndIndex, which indicates that we should\n      // rewrite the attribute name, assert that we're in a valid attribute\n      // position - either in a tag, or a quoted attribute value.\n      console.assert(\n        attrNameEndIndex === -1 ||\n          regex === tagEndRegex ||\n          regex === singleQuoteAttrEndRegex ||\n          regex === doubleQuoteAttrEndRegex,\n        'unexpected parse state B',\n      );\n    }\n\n    // We have four cases:\n    //  1. We're in text position, and not in a raw text element\n    //     (regex === textEndRegex): insert a comment marker.\n    //  2. We have a non-negative attrNameEndIndex which means we need to\n    //     rewrite the attribute name to add a bound attribute suffix.\n    //  3. We're at the non-first binding in a multi-binding attribute, use a\n    //     plain marker.\n    //  4. We're somewhere else inside the tag. If we're in attribute name\n    //     position (attrNameEndIndex === -2), add a sequential suffix to\n    //     generate a unique attribute name.\n\n    // Detect a binding next to self-closing tag end and insert a space to\n    // separate the marker from the tag end:\n    const end =\n      regex === tagEndRegex && strings[i + 1].startsWith('/>') ? ' ' : '';\n    html +=\n      regex === textEndRegex\n        ? s + nodeMarker\n        : attrNameEndIndex >= 0\n          ? (attrNames.push(attrName!),\n            s.slice(0, attrNameEndIndex) +\n              boundAttributeSuffix +\n              s.slice(attrNameEndIndex)) +\n            marker +\n            end\n          : s + marker + (attrNameEndIndex === -2 ? i : end);\n  }\n\n  const htmlResult: string | TrustedHTML =\n    html +\n    (strings[l] || '<?>') +\n    (type === SVG_RESULT ? '</svg>' : type === MATHML_RESULT ? '</math>' : '');\n\n  // Returned as an array for terseness\n  return [trustFromTemplateString(strings, htmlResult), attrNames];\n};\n\n/** @internal */\nexport type {Template};\nclass Template {\n  /** @internal */\n  el!: HTMLTemplateElement;\n\n  parts: Array<TemplatePart> = [];\n\n  constructor(\n    // This property needs to remain unminified.\n    {strings, ['_$litType$']: type}: UncompiledTemplateResult,\n    options?: RenderOptions,\n  ) {\n    let node: Node | null;\n    let nodeIndex = 0;\n    let attrNameIndex = 0;\n    const partCount = strings.length - 1;\n    const parts = this.parts;\n\n    // Create template element\n    const [html, attrNames] = getTemplateHtml(strings, type);\n    this.el = Template.createElement(html, options);\n    walker.currentNode = this.el.content;\n\n    // Re-parent SVG or MathML nodes into template root\n    if (type === SVG_RESULT || type === MATHML_RESULT) {\n      const wrapper = this.el.content.firstChild!;\n      wrapper.replaceWith(...wrapper.childNodes);\n    }\n\n    // Walk the template to find binding markers and create TemplateParts\n    while ((node = walker.nextNode()) !== null && parts.length < partCount) {\n      if (node.nodeType === 1) {\n        if (DEV_MODE) {\n          const tag = (node as Element).localName;\n          // Warn if `textarea` includes an expression and throw if `template`\n          // does since these are not supported. We do this by checking\n          // innerHTML for anything that looks like a marker. This catches\n          // cases like bindings in textarea there markers turn into text nodes.\n          if (\n            /^(?:textarea|template)$/i!.test(tag) &&\n            (node as Element).innerHTML.includes(marker)\n          ) {\n            const m =\n              `Expressions are not supported inside \\`${tag}\\` ` +\n              `elements. See https://lit.dev/msg/expression-in-${tag} for more ` +\n              `information.`;\n            if (tag === 'template') {\n              throw new Error(m);\n            } else issueWarning('', m);\n          }\n        }\n        // TODO (justinfagnani): for attempted dynamic tag names, we don't\n        // increment the bindingIndex, and it'll be off by 1 in the element\n        // and off by two after it.\n        if ((node as Element).hasAttributes()) {\n          for (const name of (node as Element).getAttributeNames()) {\n            if (name.endsWith(boundAttributeSuffix)) {\n              const realName = attrNames[attrNameIndex++];\n              const value = (node as Element).getAttribute(name)!;\n              const statics = value.split(marker);\n              const m = /([.?@])?(.*)/.exec(realName)!;\n              parts.push({\n                type: ATTRIBUTE_PART,\n                index: nodeIndex,\n                name: m[2],\n                strings: statics,\n                ctor:\n                  m[1] === '.'\n                    ? PropertyPart\n                    : m[1] === '?'\n                      ? BooleanAttributePart\n                      : m[1] === '@'\n                        ? EventPart\n                        : AttributePart,\n              });\n              (node as Element).removeAttribute(name);\n            } else if (name.startsWith(marker)) {\n              parts.push({\n                type: ELEMENT_PART,\n                index: nodeIndex,\n              });\n              (node as Element).removeAttribute(name);\n            }\n          }\n        }\n        // TODO (justinfagnani): benchmark the regex against testing for each\n        // of the 3 raw text element names.\n        if (rawTextElement.test((node as Element).tagName)) {\n          // For raw text elements we need to split the text content on\n          // markers, create a Text node for each segment, and create\n          // a TemplatePart for each marker.\n          const strings = (node as Element).textContent!.split(marker);\n          const lastIndex = strings.length - 1;\n          if (lastIndex > 0) {\n            (node as Element).textContent = trustedTypes\n              ? (trustedTypes.emptyScript as unknown as '')\n              : '';\n            // Generate a new text node for each literal section\n            // These nodes are also used as the markers for node parts\n            // We can't use empty text nodes as markers because they're\n            // normalized when cloning in IE (could simplify when\n            // IE is no longer supported)\n            for (let i = 0; i < lastIndex; i++) {\n              (node as Element).append(strings[i], createMarker());\n              // Walk past the marker node we just added\n              walker.nextNode();\n              parts.push({type: CHILD_PART, index: ++nodeIndex});\n            }\n            // Note because this marker is added after the walker's current\n            // node, it will be walked to in the outer loop (and ignored), so\n            // we don't need to adjust nodeIndex here\n            (node as Element).append(strings[lastIndex], createMarker());\n          }\n        }\n      } else if (node.nodeType === 8) {\n        const data = (node as Comment).data;\n        if (data === markerMatch) {\n          parts.push({type: CHILD_PART, index: nodeIndex});\n        } else {\n          let i = -1;\n          while ((i = (node as Comment).data.indexOf(marker, i + 1)) !== -1) {\n            // Comment node has a binding marker inside, make an inactive part\n            // The binding won't work, but subsequent bindings will\n            parts.push({type: COMMENT_PART, index: nodeIndex});\n            // Move to the end of the match\n            i += marker.length - 1;\n          }\n        }\n      }\n      nodeIndex++;\n    }\n\n    if (DEV_MODE) {\n      // If there was a duplicate attribute on a tag, then when the tag is\n      // parsed into an element the attribute gets de-duplicated. We can detect\n      // this mismatch if we haven't precisely consumed every attribute name\n      // when preparing the template. This works because `attrNames` is built\n      // from the template string and `attrNameIndex` comes from processing the\n      // resulting DOM.\n      if (attrNames.length !== attrNameIndex) {\n        throw new Error(\n          `Detected duplicate attribute bindings. This occurs if your template ` +\n            `has duplicate attributes on an element tag. For example ` +\n            `\"<input ?disabled=\\${true} ?disabled=\\${false}>\" contains a ` +\n            `duplicate \"disabled\" attribute. The error was detected in ` +\n            `the following template: \\n` +\n            '`' +\n            strings.join('${...}') +\n            '`',\n        );\n      }\n    }\n\n    // We could set walker.currentNode to another node here to prevent a memory\n    // leak, but every time we prepare a template, we immediately render it\n    // and re-use the walker in new TemplateInstance._clone().\n    debugLogEvent &&\n      debugLogEvent({\n        kind: 'template prep',\n        template: this,\n        clonableTemplate: this.el,\n        parts: this.parts,\n        strings,\n      });\n  }\n\n  // Overridden via `litHtmlPolyfillSupport` to provide platform support.\n  /** @nocollapse */\n  static createElement(html: TrustedHTML, _options?: RenderOptions) {\n    const el = d.createElement('template');\n    el.innerHTML = html as unknown as string;\n    return el;\n  }\n}\n\nexport interface Disconnectable {\n  _$parent?: Disconnectable;\n  _$disconnectableChildren?: Set<Disconnectable>;\n  // Rather than hold connection state on instances, Disconnectables recursively\n  // fetch the connection state from the RootPart they are connected in via\n  // getters up the Disconnectable tree via _$parent references. This pushes the\n  // cost of tracking the isConnected state to `AsyncDirectives`, and avoids\n  // needing to pass all Disconnectables (parts, template instances, and\n  // directives) their connection state each time it changes, which would be\n  // costly for trees that have no AsyncDirectives.\n  _$isConnected: boolean;\n}\n\nfunction resolveDirective(\n  part: ChildPart | AttributePart | ElementPart,\n  value: unknown,\n  parent: DirectiveParent = part,\n  attributeIndex?: number,\n): unknown {\n  // Bail early if the value is explicitly noChange. Note, this means any\n  // nested directive is still attached and is not run.\n  if (value === noChange) {\n    return value;\n  }\n  let currentDirective =\n    attributeIndex !== undefined\n      ? (parent as AttributePart).__directives?.[attributeIndex]\n      : (parent as ChildPart | ElementPart | Directive).__directive;\n  const nextDirectiveConstructor = isPrimitive(value)\n    ? undefined\n    : // This property needs to remain unminified.\n      (value as DirectiveResult)['_$litDirective$'];\n  if (currentDirective?.constructor !== nextDirectiveConstructor) {\n    // This property needs to remain unminified.\n    currentDirective?.['_$notifyDirectiveConnectionChanged']?.(false);\n    if (nextDirectiveConstructor === undefined) {\n      currentDirective = undefined;\n    } else {\n      currentDirective = new nextDirectiveConstructor(part as PartInfo);\n      currentDirective._$initialize(part, parent, attributeIndex);\n    }\n    if (attributeIndex !== undefined) {\n      ((parent as AttributePart).__directives ??= [])[attributeIndex] =\n        currentDirective;\n    } else {\n      (parent as ChildPart | Directive).__directive = currentDirective;\n    }\n  }\n  if (currentDirective !== undefined) {\n    value = resolveDirective(\n      part,\n      currentDirective._$resolve(part, (value as DirectiveResult).values),\n      currentDirective,\n      attributeIndex,\n    );\n  }\n  return value;\n}\n\nexport type {TemplateInstance};\n/**\n * An updateable instance of a Template. Holds references to the Parts used to\n * update the template instance.\n */\nclass TemplateInstance implements Disconnectable {\n  _$template: Template;\n  _$parts: Array<Part | undefined> = [];\n\n  /** @internal */\n  _$parent: ChildPart;\n  /** @internal */\n  _$disconnectableChildren?: Set<Disconnectable> = undefined;\n\n  constructor(template: Template, parent: ChildPart) {\n    this._$template = template;\n    this._$parent = parent;\n  }\n\n  // Called by ChildPart parentNode getter\n  get parentNode() {\n    return this._$parent.parentNode;\n  }\n\n  // See comment in Disconnectable interface for why this is a getter\n  get _$isConnected() {\n    return this._$parent._$isConnected;\n  }\n\n  // This method is separate from the constructor because we need to return a\n  // DocumentFragment and we don't want to hold onto it with an instance field.\n  _clone(options: RenderOptions | undefined) {\n    const {\n      el: {content},\n      parts: parts,\n    } = this._$template;\n    const fragment = (options?.creationScope ?? d).importNode(content, true);\n    walker.currentNode = fragment;\n\n    let node = walker.nextNode()!;\n    let nodeIndex = 0;\n    let partIndex = 0;\n    let templatePart = parts[0];\n\n    while (templatePart !== undefined) {\n      if (nodeIndex === templatePart.index) {\n        let part: Part | undefined;\n        if (templatePart.type === CHILD_PART) {\n          part = new ChildPart(\n            node as HTMLElement,\n            node.nextSibling,\n            this,\n            options,\n          );\n        } else if (templatePart.type === ATTRIBUTE_PART) {\n          part = new templatePart.ctor(\n            node as HTMLElement,\n            templatePart.name,\n            templatePart.strings,\n            this,\n            options,\n          );\n        } else if (templatePart.type === ELEMENT_PART) {\n          part = new ElementPart(node as HTMLElement, this, options);\n        }\n        this._$parts.push(part);\n        templatePart = parts[++partIndex];\n      }\n      if (nodeIndex !== templatePart?.index) {\n        node = walker.nextNode()!;\n        nodeIndex++;\n      }\n    }\n    // We need to set the currentNode away from the cloned tree so that we\n    // don't hold onto the tree even if the tree is detached and should be\n    // freed.\n    walker.currentNode = d;\n    return fragment;\n  }\n\n  _update(values: Array<unknown>) {\n    let i = 0;\n    for (const part of this._$parts) {\n      if (part !== undefined) {\n        debugLogEvent &&\n          debugLogEvent({\n            kind: 'set part',\n            part,\n            value: values[i],\n            valueIndex: i,\n            values,\n            templateInstance: this,\n          });\n        if ((part as AttributePart).strings !== undefined) {\n          (part as AttributePart)._$setValue(values, part as AttributePart, i);\n          // The number of values the part consumes is part.strings.length - 1\n          // since values are in between template spans. We increment i by 1\n          // later in the loop, so increment it by part.strings.length - 2 here\n          i += (part as AttributePart).strings!.length - 2;\n        } else {\n          part._$setValue(values[i]);\n        }\n      }\n      i++;\n    }\n  }\n}\n\n/*\n * Parts\n */\ntype AttributeTemplatePart = {\n  readonly type: typeof ATTRIBUTE_PART;\n  readonly index: number;\n  readonly name: string;\n  readonly ctor: typeof AttributePart;\n  readonly strings: ReadonlyArray<string>;\n};\ntype ChildTemplatePart = {\n  readonly type: typeof CHILD_PART;\n  readonly index: number;\n};\ntype ElementTemplatePart = {\n  readonly type: typeof ELEMENT_PART;\n  readonly index: number;\n};\ntype CommentTemplatePart = {\n  readonly type: typeof COMMENT_PART;\n  readonly index: number;\n};\n\n/**\n * A TemplatePart represents a dynamic part in a template, before the template\n * is instantiated. When a template is instantiated Parts are created from\n * TemplateParts.\n */\ntype TemplatePart =\n  | ChildTemplatePart\n  | AttributeTemplatePart\n  | ElementTemplatePart\n  | CommentTemplatePart;\n\nexport type Part =\n  | ChildPart\n  | AttributePart\n  | PropertyPart\n  | BooleanAttributePart\n  | ElementPart\n  | EventPart;\n\nexport type {ChildPart};\nclass ChildPart implements Disconnectable {\n  readonly type = CHILD_PART;\n  readonly options: RenderOptions | undefined;\n  _$committedValue: unknown = nothing;\n  /** @internal */\n  __directive?: Directive;\n  /** @internal */\n  _$startNode: ChildNode;\n  /** @internal */\n  _$endNode: ChildNode | null;\n  private _textSanitizer: ValueSanitizer | undefined;\n  /** @internal */\n  _$parent: Disconnectable | undefined;\n  /**\n   * Connection state for RootParts only (i.e. ChildPart without _$parent\n   * returned from top-level `render`). This field is unused otherwise. The\n   * intention would be clearer if we made `RootPart` a subclass of `ChildPart`\n   * with this field (and a different _$isConnected getter), but the subclass\n   * caused a perf regression, possibly due to making call sites polymorphic.\n   * @internal\n   */\n  __isConnected: boolean;\n\n  // See comment in Disconnectable interface for why this is a getter\n  get _$isConnected() {\n    // ChildParts that are not at the root should always be created with a\n    // parent; only RootChildNode's won't, so they return the local isConnected\n    // state\n    return this._$parent?._$isConnected ?? this.__isConnected;\n  }\n\n  // The following fields will be patched onto ChildParts when required by\n  // AsyncDirective\n  /** @internal */\n  _$disconnectableChildren?: Set<Disconnectable> = undefined;\n  /** @internal */\n  _$notifyConnectionChanged?(\n    isConnected: boolean,\n    removeFromParent?: boolean,\n    from?: number,\n  ): void;\n  /** @internal */\n  _$reparentDisconnectables?(parent: Disconnectable): void;\n\n  constructor(\n    startNode: ChildNode,\n    endNode: ChildNode | null,\n    parent: TemplateInstance | ChildPart | undefined,\n    options: RenderOptions | undefined,\n  ) {\n    this._$startNode = startNode;\n    this._$endNode = endNode;\n    this._$parent = parent;\n    this.options = options;\n    // Note __isConnected is only ever accessed on RootParts (i.e. when there is\n    // no _$parent); the value on a non-root-part is \"don't care\", but checking\n    // for parent would be more code\n    this.__isConnected = options?.isConnected ?? true;\n    if (ENABLE_EXTRA_SECURITY_HOOKS) {\n      // Explicitly initialize for consistent class shape.\n      this._textSanitizer = undefined;\n    }\n  }\n\n  /**\n   * The parent node into which the part renders its content.\n   *\n   * A ChildPart's content consists of a range of adjacent child nodes of\n   * `.parentNode`, possibly bordered by 'marker nodes' (`.startNode` and\n   * `.endNode`).\n   *\n   * - If both `.startNode` and `.endNode` are non-null, then the part's content\n   * consists of all siblings between `.startNode` and `.endNode`, exclusively.\n   *\n   * - If `.startNode` is non-null but `.endNode` is null, then the part's\n   * content consists of all siblings following `.startNode`, up to and\n   * including the last child of `.parentNode`. If `.endNode` is non-null, then\n   * `.startNode` will always be non-null.\n   *\n   * - If both `.endNode` and `.startNode` are null, then the part's content\n   * consists of all child nodes of `.parentNode`.\n   */\n  get parentNode(): Node {\n    let parentNode: Node = wrap(this._$startNode).parentNode!;\n    const parent = this._$parent;\n    if (\n      parent !== undefined &&\n      parentNode?.nodeType === 11 /* Node.DOCUMENT_FRAGMENT */\n    ) {\n      // If the parentNode is a DocumentFragment, it may be because the DOM is\n      // still in the cloned fragment during initial render; if so, get the real\n      // parentNode the part will be committed into by asking the parent.\n      parentNode = (parent as ChildPart | TemplateInstance).parentNode;\n    }\n    return parentNode;\n  }\n\n  /**\n   * The part's leading marker node, if any. See `.parentNode` for more\n   * information.\n   */\n  get startNode(): Node | null {\n    return this._$startNode;\n  }\n\n  /**\n   * The part's trailing marker node, if any. See `.parentNode` for more\n   * information.\n   */\n  get endNode(): Node | null {\n    return this._$endNode;\n  }\n\n  _$setValue(value: unknown, directiveParent: DirectiveParent = this): void {\n    if (DEV_MODE && this.parentNode === null) {\n      throw new Error(\n        `This \\`ChildPart\\` has no \\`parentNode\\` and therefore cannot accept a value. This likely means the element containing the part was manipulated in an unsupported way outside of Lit's control such that the part's marker nodes were ejected from DOM. For example, setting the element's \\`innerHTML\\` or \\`textContent\\` can do this.`,\n      );\n    }\n    value = resolveDirective(this, value, directiveParent);\n    if (isPrimitive(value)) {\n      // Non-rendering child values. It's important that these do not render\n      // empty text nodes to avoid issues with preventing default <slot>\n      // fallback content.\n      if (value === nothing || value == null || value === '') {\n        if (this._$committedValue !== nothing) {\n          debugLogEvent &&\n            debugLogEvent({\n              kind: 'commit nothing to child',\n              start: this._$startNode,\n              end: this._$endNode,\n              parent: this._$parent,\n              options: this.options,\n            });\n          this._$clear();\n        }\n        this._$committedValue = nothing;\n      } else if (value !== this._$committedValue && value !== noChange) {\n        this._commitText(value);\n      }\n      // This property needs to remain unminified.\n    } else if ((value as TemplateResult)['_$litType$'] !== undefined) {\n      this._commitTemplateResult(value as TemplateResult);\n    } else if ((value as Node).nodeType !== undefined) {\n      if (DEV_MODE && this.options?.host === value) {\n        this._commitText(\n          `[probable mistake: rendered a template's host in itself ` +\n            `(commonly caused by writing \\${this} in a template]`,\n        );\n        console.warn(\n          `Attempted to render the template host`,\n          value,\n          `inside itself. This is almost always a mistake, and in dev mode `,\n          `we render some warning text. In production however, we'll `,\n          `render it, which will usually result in an error, and sometimes `,\n          `in the element disappearing from the DOM.`,\n        );\n        return;\n      }\n      this._commitNode(value as Node);\n    } else if (isIterable(value)) {\n      this._commitIterable(value);\n    } else {\n      // Fallback, will render the string representation\n      this._commitText(value);\n    }\n  }\n\n  private _insert<T extends Node>(node: T) {\n    return wrap(wrap(this._$startNode).parentNode!).insertBefore(\n      node,\n      this._$endNode,\n    );\n  }\n\n  private _commitNode(value: Node): void {\n    if (this._$committedValue !== value) {\n      this._$clear();\n      if (\n        ENABLE_EXTRA_SECURITY_HOOKS &&\n        sanitizerFactoryInternal !== noopSanitizer\n      ) {\n        const parentNodeName = this._$startNode.parentNode?.nodeName;\n        if (parentNodeName === 'STYLE' || parentNodeName === 'SCRIPT') {\n          let message = 'Forbidden';\n          if (DEV_MODE) {\n            if (parentNodeName === 'STYLE') {\n              message =\n                `Lit does not support binding inside style nodes. ` +\n                `This is a security risk, as style injection attacks can ` +\n                `exfiltrate data and spoof UIs. ` +\n                `Consider instead using css\\`...\\` literals ` +\n                `to compose styles, and do dynamic styling with ` +\n                `css custom properties, ::parts, <slot>s, ` +\n                `and by mutating the DOM rather than stylesheets.`;\n            } else {\n              message =\n                `Lit does not support binding inside script nodes. ` +\n                `This is a security risk, as it could allow arbitrary ` +\n                `code execution.`;\n            }\n          }\n          throw new Error(message);\n        }\n      }\n      debugLogEvent &&\n        debugLogEvent({\n          kind: 'commit node',\n          start: this._$startNode,\n          parent: this._$parent,\n          value: value,\n          options: this.options,\n        });\n      this._$committedValue = this._insert(value);\n    }\n  }\n\n  private _commitText(value: unknown): void {\n    // If the committed value is a primitive it means we called _commitText on\n    // the previous render, and we know that this._$startNode.nextSibling is a\n    // Text node. We can now just replace the text content (.data) of the node.\n    if (\n      this._$committedValue !== nothing &&\n      isPrimitive(this._$committedValue)\n    ) {\n      const node = wrap(this._$startNode).nextSibling as Text;\n      if (ENABLE_EXTRA_SECURITY_HOOKS) {\n        if (this._textSanitizer === undefined) {\n          this._textSanitizer = createSanitizer(node, 'data', 'property');\n        }\n        value = this._textSanitizer(value);\n      }\n      debugLogEvent &&\n        debugLogEvent({\n          kind: 'commit text',\n          node,\n          value,\n          options: this.options,\n        });\n      (node as Text).data = value as string;\n    } else {\n      if (ENABLE_EXTRA_SECURITY_HOOKS) {\n        const textNode = d.createTextNode('');\n        this._commitNode(textNode);\n        // When setting text content, for security purposes it matters a lot\n        // what the parent is. For example, <style> and <script> need to be\n        // handled with care, while <span> does not. So first we need to put a\n        // text node into the document, then we can sanitize its content.\n        if (this._textSanitizer === undefined) {\n          this._textSanitizer = createSanitizer(textNode, 'data', 'property');\n        }\n        value = this._textSanitizer(value);\n        debugLogEvent &&\n          debugLogEvent({\n            kind: 'commit text',\n            node: textNode,\n            value,\n            options: this.options,\n          });\n        textNode.data = value as string;\n      } else {\n        this._commitNode(d.createTextNode(value as string));\n        debugLogEvent &&\n          debugLogEvent({\n            kind: 'commit text',\n            node: wrap(this._$startNode).nextSibling as Text,\n            value,\n            options: this.options,\n          });\n      }\n    }\n    this._$committedValue = value;\n  }\n\n  private _commitTemplateResult(\n    result: TemplateResult | CompiledTemplateResult,\n  ): void {\n    // This property needs to remain unminified.\n    const {values, ['_$litType$']: type} = result;\n    // If $litType$ is a number, result is a plain TemplateResult and we get\n    // the template from the template cache. If not, result is a\n    // CompiledTemplateResult and _$litType$ is a CompiledTemplate and we need\n    // to create the <template> element the first time we see it.\n    const template: Template | CompiledTemplate =\n      typeof type === 'number'\n        ? this._$getTemplate(result as UncompiledTemplateResult)\n        : (type.el === undefined &&\n            (type.el = Template.createElement(\n              trustFromTemplateString(type.h, type.h[0]),\n              this.options,\n            )),\n          type);\n\n    if ((this._$committedValue as TemplateInstance)?._$template === template) {\n      debugLogEvent &&\n        debugLogEvent({\n          kind: 'template updating',\n          template,\n          instance: this._$committedValue as TemplateInstance,\n          parts: (this._$committedValue as TemplateInstance)._$parts,\n          options: this.options,\n          values,\n        });\n      (this._$committedValue as TemplateInstance)._update(values);\n    } else {\n      const instance = new TemplateInstance(template as Template, this);\n      const fragment = instance._clone(this.options);\n      debugLogEvent &&\n        debugLogEvent({\n          kind: 'template instantiated',\n          template,\n          instance,\n          parts: instance._$parts,\n          options: this.options,\n          fragment,\n          values,\n        });\n      instance._update(values);\n      debugLogEvent &&\n        debugLogEvent({\n          kind: 'template instantiated and updated',\n          template,\n          instance,\n          parts: instance._$parts,\n          options: this.options,\n          fragment,\n          values,\n        });\n      this._commitNode(fragment);\n      this._$committedValue = instance;\n    }\n  }\n\n  // Overridden via `litHtmlPolyfillSupport` to provide platform support.\n  /** @internal */\n  _$getTemplate(result: UncompiledTemplateResult) {\n    let template = templateCache.get(result.strings);\n    if (template === undefined) {\n      templateCache.set(result.strings, (template = new Template(result)));\n    }\n    return template;\n  }\n\n  private _commitIterable(value: Iterable<unknown>): void {\n    // For an Iterable, we create a new InstancePart per item, then set its\n    // value to the item. This is a little bit of overhead for every item in\n    // an Iterable, but it lets us recurse easily and efficiently update Arrays\n    // of TemplateResults that will be commonly returned from expressions like:\n    // array.map((i) => html`${i}`), by reusing existing TemplateInstances.\n\n    // If value is an array, then the previous render was of an\n    // iterable and value will contain the ChildParts from the previous\n    // render. If value is not an array, clear this part and make a new\n    // array for ChildParts.\n    if (!isArray(this._$committedValue)) {\n      this._$committedValue = [];\n      this._$clear();\n    }\n\n    // Lets us keep track of how many items we stamped so we can clear leftover\n    // items from a previous render\n    const itemParts = this._$committedValue as ChildPart[];\n    let partIndex = 0;\n    let itemPart: ChildPart | undefined;\n\n    for (const item of value) {\n      if (partIndex === itemParts.length) {\n        // If no existing part, create a new one\n        // TODO (justinfagnani): test perf impact of always creating two parts\n        // instead of sharing parts between nodes\n        // https://github.com/lit/lit/issues/1266\n        itemParts.push(\n          (itemPart = new ChildPart(\n            this._insert(createMarker()),\n            this._insert(createMarker()),\n            this,\n            this.options,\n          )),\n        );\n      } else {\n        // Reuse an existing part\n        itemPart = itemParts[partIndex];\n      }\n      itemPart._$setValue(item);\n      partIndex++;\n    }\n\n    if (partIndex < itemParts.length) {\n      // itemParts always have end nodes\n      this._$clear(\n        itemPart && wrap(itemPart._$endNode!).nextSibling,\n        partIndex,\n      );\n      // Truncate the parts array so _value reflects the current state\n      itemParts.length = partIndex;\n    }\n  }\n\n  /**\n   * Removes the nodes contained within this Part from the DOM.\n   *\n   * @param start Start node to clear from, for clearing a subset of the part's\n   *     DOM (used when truncating iterables)\n   * @param from  When `start` is specified, the index within the iterable from\n   *     which ChildParts are being removed, used for disconnecting directives in\n   *     those Parts.\n   *\n   * @internal\n   */\n  _$clear(\n    start: ChildNode | null = wrap(this._$startNode).nextSibling,\n    from?: number,\n  ) {\n    this._$notifyConnectionChanged?.(false, true, from);\n    while (start && start !== this._$endNode) {\n      const n = wrap(start!).nextSibling;\n      (wrap(start!) as Element).remove();\n      start = n;\n    }\n  }\n  /**\n   * Implementation of RootPart's `isConnected`. Note that this method\n   * should only be called on `RootPart`s (the `ChildPart` returned from a\n   * top-level `render()` call). It has no effect on non-root ChildParts.\n   * @param isConnected Whether to set\n   * @internal\n   */\n  setConnected(isConnected: boolean) {\n    if (this._$parent === undefined) {\n      this.__isConnected = isConnected;\n      this._$notifyConnectionChanged?.(isConnected);\n    } else if (DEV_MODE) {\n      throw new Error(\n        'part.setConnected() may only be called on a ' +\n          'RootPart returned from render().',\n      );\n    }\n  }\n}\n\n/**\n * A top-level `ChildPart` returned from `render` that manages the connected\n * state of `AsyncDirective`s created throughout the tree below it.\n */\nexport interface RootPart extends ChildPart {\n  /**\n   * Sets the connection state for `AsyncDirective`s contained within this root\n   * ChildPart.\n   *\n   * lit-html does not automatically monitor the connectedness of DOM rendered;\n   * as such, it is the responsibility of the caller to `render` to ensure that\n   * `part.setConnected(false)` is called before the part object is potentially\n   * discarded, to ensure that `AsyncDirective`s have a chance to dispose of\n   * any resources being held. If a `RootPart` that was previously\n   * disconnected is subsequently re-connected (and its `AsyncDirective`s should\n   * re-connect), `setConnected(true)` should be called.\n   *\n   * @param isConnected Whether directives within this tree should be connected\n   * or not\n   */\n  setConnected(isConnected: boolean): void;\n}\n\nexport type {AttributePart};\nclass AttributePart implements Disconnectable {\n  readonly type:\n    | typeof ATTRIBUTE_PART\n    | typeof PROPERTY_PART\n    | typeof BOOLEAN_ATTRIBUTE_PART\n    | typeof EVENT_PART = ATTRIBUTE_PART;\n  readonly element: HTMLElement;\n  readonly name: string;\n  readonly options: RenderOptions | undefined;\n\n  /**\n   * If this attribute part represents an interpolation, this contains the\n   * static strings of the interpolation. For single-value, complete bindings,\n   * this is undefined.\n   */\n  readonly strings?: ReadonlyArray<string>;\n  /** @internal */\n  _$committedValue: unknown | Array<unknown> = nothing;\n  /** @internal */\n  __directives?: Array<Directive | undefined>;\n  /** @internal */\n  _$parent: Disconnectable;\n  /** @internal */\n  _$disconnectableChildren?: Set<Disconnectable> = undefined;\n\n  protected _sanitizer: ValueSanitizer | undefined;\n\n  get tagName() {\n    return this.element.tagName;\n  }\n\n  // See comment in Disconnectable interface for why this is a getter\n  get _$isConnected() {\n    return this._$parent._$isConnected;\n  }\n\n  constructor(\n    element: HTMLElement,\n    name: string,\n    strings: ReadonlyArray<string>,\n    parent: Disconnectable,\n    options: RenderOptions | undefined,\n  ) {\n    this.element = element;\n    this.name = name;\n    this._$parent = parent;\n    this.options = options;\n    if (strings.length > 2 || strings[0] !== '' || strings[1] !== '') {\n      this._$committedValue = new Array(strings.length - 1).fill(new String());\n      this.strings = strings;\n    } else {\n      this._$committedValue = nothing;\n    }\n    if (ENABLE_EXTRA_SECURITY_HOOKS) {\n      this._sanitizer = undefined;\n    }\n  }\n\n  /**\n   * Sets the value of this part by resolving the value from possibly multiple\n   * values and static strings and committing it to the DOM.\n   * If this part is single-valued, `this._strings` will be undefined, and the\n   * method will be called with a single value argument. If this part is\n   * multi-value, `this._strings` will be defined, and the method is called\n   * with the value array of the part's owning TemplateInstance, and an offset\n   * into the value array from which the values should be read.\n   * This method is overloaded this way to eliminate short-lived array slices\n   * of the template instance values, and allow a fast-path for single-valued\n   * parts.\n   *\n   * @param value The part value, or an array of values for multi-valued parts\n   * @param valueIndex the index to start reading values from. `undefined` for\n   *   single-valued parts\n   * @param noCommit causes the part to not commit its value to the DOM. Used\n   *   in hydration to prime attribute parts with their first-rendered value,\n   *   but not set the attribute, and in SSR to no-op the DOM operation and\n   *   capture the value for serialization.\n   *\n   * @internal\n   */\n  _$setValue(\n    value: unknown | Array<unknown>,\n    directiveParent: DirectiveParent = this,\n    valueIndex?: number,\n    noCommit?: boolean,\n  ) {\n    const strings = this.strings;\n\n    // Whether any of the values has changed, for dirty-checking\n    let change = false;\n\n    if (strings === undefined) {\n      // Single-value binding case\n      value = resolveDirective(this, value, directiveParent, 0);\n      change =\n        !isPrimitive(value) ||\n        (value !== this._$committedValue && value !== noChange);\n      if (change) {\n        this._$committedValue = value;\n      }\n    } else {\n      // Interpolation case\n      const values = value as Array<unknown>;\n      value = strings[0];\n\n      let i, v;\n      for (i = 0; i < strings.length - 1; i++) {\n        v = resolveDirective(this, values[valueIndex! + i], directiveParent, i);\n\n        if (v === noChange) {\n          // If the user-provided value is `noChange`, use the previous value\n          v = (this._$committedValue as Array<unknown>)[i];\n        }\n        change ||=\n          !isPrimitive(v) || v !== (this._$committedValue as Array<unknown>)[i];\n        if (v === nothing) {\n          value = nothing;\n        } else if (value !== nothing) {\n          value += (v ?? '') + strings[i + 1];\n        }\n        // We always record each value, even if one is `nothing`, for future\n        // change detection.\n        (this._$committedValue as Array<unknown>)[i] = v;\n      }\n    }\n    if (change && !noCommit) {\n      this._commitValue(value);\n    }\n  }\n\n  /** @internal */\n  _commitValue(value: unknown) {\n    if (value === nothing) {\n      (wrap(this.element) as Element).removeAttribute(this.name);\n    } else {\n      if (ENABLE_EXTRA_SECURITY_HOOKS) {\n        if (this._sanitizer === undefined) {\n          this._sanitizer = sanitizerFactoryInternal(\n            this.element,\n            this.name,\n            'attribute',\n          );\n        }\n        value = this._sanitizer(value ?? '');\n      }\n      debugLogEvent &&\n        debugLogEvent({\n          kind: 'commit attribute',\n          element: this.element,\n          name: this.name,\n          value,\n          options: this.options,\n        });\n      (wrap(this.element) as Element).setAttribute(\n        this.name,\n        (value ?? '') as string,\n      );\n    }\n  }\n}\n\nexport type {PropertyPart};\nclass PropertyPart extends AttributePart {\n  override readonly type = PROPERTY_PART;\n\n  /** @internal */\n  override _commitValue(value: unknown) {\n    if (ENABLE_EXTRA_SECURITY_HOOKS) {\n      if (this._sanitizer === undefined) {\n        this._sanitizer = sanitizerFactoryInternal(\n          this.element,\n          this.name,\n          'property',\n        );\n      }\n      value = this._sanitizer(value);\n    }\n    debugLogEvent &&\n      debugLogEvent({\n        kind: 'commit property',\n        element: this.element,\n        name: this.name,\n        value,\n        options: this.options,\n      });\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    (this.element as any)[this.name] = value === nothing ? undefined : value;\n  }\n}\n\nexport type {BooleanAttributePart};\nclass BooleanAttributePart extends AttributePart {\n  override readonly type = BOOLEAN_ATTRIBUTE_PART;\n\n  /** @internal */\n  override _commitValue(value: unknown) {\n    debugLogEvent &&\n      debugLogEvent({\n        kind: 'commit boolean attribute',\n        element: this.element,\n        name: this.name,\n        value: !!(value && value !== nothing),\n        options: this.options,\n      });\n    (wrap(this.element) as Element).toggleAttribute(\n      this.name,\n      !!value && value !== nothing,\n    );\n  }\n}\n\ntype EventListenerWithOptions = EventListenerOrEventListenerObject &\n  Partial<AddEventListenerOptions>;\n\n/**\n * An AttributePart that manages an event listener via add/removeEventListener.\n *\n * This part works by adding itself as the event listener on an element, then\n * delegating to the value passed to it. This reduces the number of calls to\n * add/removeEventListener if the listener changes frequently, such as when an\n * inline function is used as a listener.\n *\n * Because event options are passed when adding listeners, we must take case\n * to add and remove the part as a listener when the event options change.\n */\nexport type {EventPart};\nclass EventPart extends AttributePart {\n  override readonly type = EVENT_PART;\n\n  constructor(\n    element: HTMLElement,\n    name: string,\n    strings: ReadonlyArray<string>,\n    parent: Disconnectable,\n    options: RenderOptions | undefined,\n  ) {\n    super(element, name, strings, parent, options);\n\n    if (DEV_MODE && this.strings !== undefined) {\n      throw new Error(\n        `A \\`<${element.localName}>\\` has a \\`@${name}=...\\` listener with ` +\n          'invalid content. Event listeners in templates must have exactly ' +\n          'one expression and no surrounding text.',\n      );\n    }\n  }\n\n  // EventPart does not use the base _$setValue/_resolveValue implementation\n  // since the dirty checking is more complex\n  /** @internal */\n  override _$setValue(\n    newListener: unknown,\n    directiveParent: DirectiveParent = this,\n  ) {\n    newListener =\n      resolveDirective(this, newListener, directiveParent, 0) ?? nothing;\n    if (newListener === noChange) {\n      return;\n    }\n    const oldListener = this._$committedValue;\n\n    // If the new value is nothing or any options change we have to remove the\n    // part as a listener.\n    const shouldRemoveListener =\n      (newListener === nothing && oldListener !== nothing) ||\n      (newListener as EventListenerWithOptions).capture !==\n        (oldListener as EventListenerWithOptions).capture ||\n      (newListener as EventListenerWithOptions).once !==\n        (oldListener as EventListenerWithOptions).once ||\n      (newListener as EventListenerWithOptions).passive !==\n        (oldListener as EventListenerWithOptions).passive;\n\n    // If the new value is not nothing and we removed the listener, we have\n    // to add the part as a listener.\n    const shouldAddListener =\n      newListener !== nothing &&\n      (oldListener === nothing || shouldRemoveListener);\n\n    debugLogEvent &&\n      debugLogEvent({\n        kind: 'commit event listener',\n        element: this.element,\n        name: this.name,\n        value: newListener,\n        options: this.options,\n        removeListener: shouldRemoveListener,\n        addListener: shouldAddListener,\n        oldListener,\n      });\n    if (shouldRemoveListener) {\n      this.element.removeEventListener(\n        this.name,\n        this,\n        oldListener as EventListenerWithOptions,\n      );\n    }\n    if (shouldAddListener) {\n      // Beware: IE11 and Chrome 41 don't like using the listener as the\n      // options object. Figure out how to deal w/ this in IE11 - maybe\n      // patch addEventListener?\n      this.element.addEventListener(\n        this.name,\n        this,\n        newListener as EventListenerWithOptions,\n      );\n    }\n    this._$committedValue = newListener;\n  }\n\n  handleEvent(event: Event) {\n    if (typeof this._$committedValue === 'function') {\n      this._$committedValue.call(this.options?.host ?? this.element, event);\n    } else {\n      (this._$committedValue as EventListenerObject).handleEvent(event);\n    }\n  }\n}\n\nexport type {ElementPart};\nclass ElementPart implements Disconnectable {\n  readonly type = ELEMENT_PART;\n\n  /** @internal */\n  __directive?: Directive;\n\n  // This is to ensure that every Part has a _$committedValue\n  _$committedValue: undefined;\n\n  /** @internal */\n  _$parent!: Disconnectable;\n\n  /** @internal */\n  _$disconnectableChildren?: Set<Disconnectable> = undefined;\n\n  options: RenderOptions | undefined;\n\n  constructor(\n    public element: Element,\n    parent: Disconnectable,\n    options: RenderOptions | undefined,\n  ) {\n    this._$parent = parent;\n    this.options = options;\n  }\n\n  // See comment in Disconnectable interface for why this is a getter\n  get _$isConnected() {\n    return this._$parent._$isConnected;\n  }\n\n  _$setValue(value: unknown): void {\n    debugLogEvent &&\n      debugLogEvent({\n        kind: 'commit to element binding',\n        element: this.element,\n        value,\n        options: this.options,\n      });\n    resolveDirective(this, value);\n  }\n}\n\n/**\n * END USERS SHOULD NOT RELY ON THIS OBJECT.\n *\n * Private exports for use by other Lit packages, not intended for use by\n * external users.\n *\n * We currently do not make a mangled rollup build of the lit-ssr code. In order\n * to keep a number of (otherwise private) top-level exports mangled in the\n * client side code, we export a _$LH object containing those members (or\n * helper methods for accessing private fields of those members), and then\n * re-export them for use in lit-ssr. This keeps lit-ssr agnostic to whether the\n * client-side code is being used in `dev` mode or `prod` mode.\n *\n * This has a unique name, to disambiguate it from private exports in\n * lit-element, which re-exports all of lit-html.\n *\n * @private\n */\nexport const _$LH = {\n  // Used in lit-ssr\n  _boundAttributeSuffix: boundAttributeSuffix,\n  _marker: marker,\n  _markerMatch: markerMatch,\n  _HTML_RESULT: HTML_RESULT,\n  _getTemplateHtml: getTemplateHtml,\n  // Used in tests and private-ssr-support\n  _TemplateInstance: TemplateInstance,\n  _isIterable: isIterable,\n  _resolveDirective: resolveDirective,\n  _ChildPart: ChildPart,\n  _AttributePart: AttributePart,\n  _BooleanAttributePart: BooleanAttributePart,\n  _EventPart: EventPart,\n  _PropertyPart: PropertyPart,\n  _ElementPart: ElementPart,\n};\n\n// Apply polyfills if available\nconst polyfillSupport = DEV_MODE\n  ? global.litHtmlPolyfillSupportDevMode\n  : global.litHtmlPolyfillSupport;\npolyfillSupport?.(Template, ChildPart);\n\n// IMPORTANT: do not change the property name or the assignment expression.\n// This line will be used in regexes to search for lit-html usage.\n(global.litHtmlVersions ??= []).push('3.2.0');\nif (DEV_MODE && global.litHtmlVersions.length > 1) {\n  issueWarning!(\n    'multiple-versions',\n    `Multiple versions of Lit loaded. ` +\n      `Loading multiple versions is not recommended.`,\n  );\n}\n\n/**\n * Renders a value, usually a lit-html TemplateResult, to the container.\n *\n * This example renders the text \"Hello, Zoe!\" inside a paragraph tag, appending\n * it to the container `document.body`.\n *\n * ```js\n * import {html, render} from 'lit';\n *\n * const name = \"Zoe\";\n * render(html`<p>Hello, ${name}!</p>`, document.body);\n * ```\n *\n * @param value Any [renderable\n *   value](https://lit.dev/docs/templates/expressions/#child-expressions),\n *   typically a {@linkcode TemplateResult} created by evaluating a template tag\n *   like {@linkcode html} or {@linkcode svg}.\n * @param container A DOM container to render to. The first render will append\n *   the rendered value to the container, and subsequent renders will\n *   efficiently update the rendered value if the same result type was\n *   previously rendered there.\n * @param options See {@linkcode RenderOptions} for options documentation.\n * @see\n * {@link https://lit.dev/docs/libraries/standalone-templates/#rendering-lit-html-templates| Rendering Lit HTML Templates}\n */\nexport const render = (\n  value: unknown,\n  container: HTMLElement | DocumentFragment,\n  options?: RenderOptions,\n): RootPart => {\n  if (DEV_MODE && container == null) {\n    // Give a clearer error message than\n    //     Uncaught TypeError: Cannot read properties of null (reading\n    //     '_$litPart$')\n    // which reads like an internal Lit error.\n    throw new TypeError(`The container to render into may not be ${container}`);\n  }\n  const renderId = DEV_MODE ? debugLogRenderId++ : 0;\n  const partOwnerNode = options?.renderBefore ?? container;\n  // This property needs to remain unminified.\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  let part: ChildPart = (partOwnerNode as any)['_$litPart$'];\n  debugLogEvent &&\n    debugLogEvent({\n      kind: 'begin render',\n      id: renderId,\n      value,\n      container,\n      options,\n      part,\n    });\n  if (part === undefined) {\n    const endNode = options?.renderBefore ?? null;\n    // This property needs to remain unminified.\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    (partOwnerNode as any)['_$litPart$'] = part = new ChildPart(\n      container.insertBefore(createMarker(), endNode),\n      endNode,\n      undefined,\n      options ?? {},\n    );\n  }\n  part._$setValue(value);\n  debugLogEvent &&\n    debugLogEvent({\n      kind: 'end render',\n      id: renderId,\n      value,\n      container,\n      options,\n      part,\n    });\n  return part as RootPart;\n};\n\nif (ENABLE_EXTRA_SECURITY_HOOKS) {\n  render.setSanitizer = setSanitizer;\n  render.createSanitizer = createSanitizer;\n  if (DEV_MODE) {\n    render._testOnlyClearSanitizerFactoryDoNotCallOrElse =\n      _testOnlyClearSanitizerFactoryDoNotCallOrElse;\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\n\n/**\n * The main LitElement module, which defines the {@linkcode LitElement} base\n * class and related APIs.\n *\n * LitElement components can define a template and a set of observed\n * properties. Changing an observed property triggers a re-render of the\n * element.\n *\n * Import {@linkcode LitElement} and {@linkcode html} from this module to\n * create a component:\n *\n *  ```js\n * import {LitElement, html} from 'lit-element';\n *\n * class MyElement extends LitElement {\n *\n *   // Declare observed properties\n *   static get properties() {\n *     return {\n *       adjective: {}\n *     }\n *   }\n *\n *   constructor() {\n *     this.adjective = 'awesome';\n *   }\n *\n *   // Define the element's template\n *   render() {\n *     return html`<p>your ${adjective} template here</p>`;\n *   }\n * }\n *\n * customElements.define('my-element', MyElement);\n * ```\n *\n * `LitElement` extends {@linkcode ReactiveElement} and adds lit-html\n * templating. The `ReactiveElement` class is provided for users that want to\n * build their own custom element base classes that don't use lit-html.\n *\n * @packageDocumentation\n */\nimport {PropertyValues, ReactiveElement} from '@lit/reactive-element';\nimport {render, RenderOptions, noChange, RootPart} from 'lit-html';\nexport * from '@lit/reactive-element';\nexport * from 'lit-html';\n\nimport {LitUnstable} from 'lit-html';\nimport {ReactiveUnstable} from '@lit/reactive-element';\n\n/**\n * Contains types that are part of the unstable debug API.\n *\n * Everything in this API is not stable and may change or be removed in the future,\n * even on patch releases.\n */\n// eslint-disable-next-line @typescript-eslint/no-namespace\nexport namespace Unstable {\n  /**\n   * When Lit is running in dev mode and `window.emitLitDebugLogEvents` is true,\n   * we will emit 'lit-debug' events to window, with live details about the update and render\n   * lifecycle. These can be useful for writing debug tooling and visualizations.\n   *\n   * Please be aware that running with window.emitLitDebugLogEvents has performance overhead,\n   * making certain operations that are normally very cheap (like a no-op render) much slower,\n   * because we must copy data and dispatch events.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-namespace\n  export namespace DebugLog {\n    export type Entry =\n      | LitUnstable.DebugLog.Entry\n      | ReactiveUnstable.DebugLog.Entry;\n  }\n}\n/*\n * When using Closure Compiler, JSCompiler_renameProperty(property, object) is\n * replaced at compile time by the munged name for object[property]. We cannot\n * alias this function, so we have to use a small shim that has the same\n * behavior when not compiling.\n */\n/*@__INLINE__*/\nconst JSCompiler_renameProperty = <P extends PropertyKey>(\n  prop: P,\n  _obj: unknown\n): P => prop;\n\nconst DEV_MODE = true;\n\nlet issueWarning: (code: string, warning: string) => void;\n\nif (DEV_MODE) {\n  // Ensure warnings are issued only 1x, even if multiple versions of Lit\n  // are loaded.\n  const issuedWarnings: Set<string | undefined> =\n    (globalThis.litIssuedWarnings ??= new Set());\n\n  // Issue a warning, if we haven't already.\n  issueWarning = (code: string, warning: string) => {\n    warning += ` See https://lit.dev/msg/${code} for more information.`;\n    if (!issuedWarnings.has(warning)) {\n      console.warn(warning);\n      issuedWarnings.add(warning);\n    }\n  };\n}\n\n/**\n * Base element class that manages element properties and attributes, and\n * renders a lit-html template.\n *\n * To define a component, subclass `LitElement` and implement a\n * `render` method to provide the component's template. Define properties\n * using the {@linkcode LitElement.properties properties} property or the\n * {@linkcode property} decorator.\n */\nexport class LitElement extends ReactiveElement {\n  // This property needs to remain unminified.\n  static ['_$litElement$'] = true;\n\n  /**\n   * @category rendering\n   */\n  readonly renderOptions: RenderOptions = {host: this};\n\n  private __childPart: RootPart | undefined = undefined;\n\n  /**\n   * @category rendering\n   */\n  protected override createRenderRoot() {\n    const renderRoot = super.createRenderRoot();\n    // When adoptedStyleSheets are shimmed, they are inserted into the\n    // shadowRoot by createRenderRoot. Adjust the renderBefore node so that\n    // any styles in Lit content render before adoptedStyleSheets. This is\n    // important so that adoptedStyleSheets have precedence over styles in\n    // the shadowRoot.\n    this.renderOptions.renderBefore ??= renderRoot!.firstChild as ChildNode;\n    return renderRoot;\n  }\n\n  /**\n   * Updates the element. This method reflects property values to attributes\n   * and calls `render` to render DOM via lit-html. Setting properties inside\n   * this method will *not* trigger another update.\n   * @param changedProperties Map of changed properties with old values\n   * @category updates\n   */\n  protected override update(changedProperties: PropertyValues) {\n    // Setting properties in `render` should not trigger an update. Since\n    // updates are allowed after super.update, it's important to call `render`\n    // before that.\n    const value = this.render();\n    if (!this.hasUpdated) {\n      this.renderOptions.isConnected = this.isConnected;\n    }\n    super.update(changedProperties);\n    this.__childPart = render(value, this.renderRoot, this.renderOptions);\n  }\n\n  /**\n   * Invoked when the component is added to the document's DOM.\n   *\n   * In `connectedCallback()` you should setup tasks that should only occur when\n   * the element is connected to the document. The most common of these is\n   * adding event listeners to nodes external to the element, like a keydown\n   * event handler added to the window.\n   *\n   * ```ts\n   * connectedCallback() {\n   *   super.connectedCallback();\n   *   addEventListener('keydown', this._handleKeydown);\n   * }\n   * ```\n   *\n   * Typically, anything done in `connectedCallback()` should be undone when the\n   * element is disconnected, in `disconnectedCallback()`.\n   *\n   * @category lifecycle\n   */\n  override connectedCallback() {\n    super.connectedCallback();\n    this.__childPart?.setConnected(true);\n  }\n\n  /**\n   * Invoked when the component is removed from the document's DOM.\n   *\n   * This callback is the main signal to the element that it may no longer be\n   * used. `disconnectedCallback()` should ensure that nothing is holding a\n   * reference to the element (such as event listeners added to nodes external\n   * to the element), so that it is free to be garbage collected.\n   *\n   * ```ts\n   * disconnectedCallback() {\n   *   super.disconnectedCallback();\n   *   window.removeEventListener('keydown', this._handleKeydown);\n   * }\n   * ```\n   *\n   * An element may be re-connected after being disconnected.\n   *\n   * @category lifecycle\n   */\n  override disconnectedCallback() {\n    super.disconnectedCallback();\n    this.__childPart?.setConnected(false);\n  }\n\n  /**\n   * Invoked on each update to perform rendering tasks. This method may return\n   * any value renderable by lit-html's `ChildPart` - typically a\n   * `TemplateResult`. Setting properties inside this method will *not* trigger\n   * the element to update.\n   * @category rendering\n   */\n  protected render(): unknown {\n    return noChange;\n  }\n}\n\n/**\n * Ensure this class is marked as `finalized` as an optimization ensuring\n * it will not needlessly try to `finalize`.\n *\n * Note this property name is a string to prevent breaking Closure JS Compiler\n * optimizations. See @lit/reactive-element for more information.\n */\n(LitElement as unknown as Record<string, unknown>)[\n  JSCompiler_renameProperty('finalized', LitElement)\n] = true;\n\n// Install hydration if available\nglobalThis.litElementHydrateSupport?.({LitElement});\n\n// Apply polyfills if available\nconst polyfillSupport = DEV_MODE\n  ? globalThis.litElementPolyfillSupportDevMode\n  : globalThis.litElementPolyfillSupport;\npolyfillSupport?.({LitElement});\n\n/**\n * END USERS SHOULD NOT RELY ON THIS OBJECT.\n *\n * Private exports for use by other Lit packages, not intended for use by\n * external users.\n *\n * We currently do not make a mangled rollup build of the lit-ssr code. In order\n * to keep a number of (otherwise private) top-level exports  mangled in the\n * client side code, we export a _$LE object containing those members (or\n * helper methods for accessing private fields of those members), and then\n * re-export them for use in lit-ssr. This keeps lit-ssr agnostic to whether the\n * client-side code is being used in `dev` mode or `prod` mode.\n *\n * This has a unique name, to disambiguate it from private exports in\n * lit-html, since this module re-exports all of lit-html.\n *\n * @private\n */\nexport const _$LE = {\n  _$attributeToProperty: (\n    el: LitElement,\n    name: string,\n    value: string | null\n  ) => {\n    // eslint-disable-next-line\n    (el as any)._$attributeToProperty(name, value);\n  },\n  // eslint-disable-next-line\n  _$changedProperties: (el: LitElement) => (el as any)._$changedProperties,\n};\n\n// IMPORTANT: do not change the property name or the assignment expression.\n// This line will be used in regexes to search for LitElement usage.\n(globalThis.litElementVersions ??= []).push('4.1.0');\nif (DEV_MODE && globalThis.litElementVersions.length > 1) {\n  issueWarning!(\n    'multiple-versions',\n    `Multiple versions of Lit loaded. Loading multiple versions ` +\n      `is not recommended.`\n  );\n}\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\n\n/*\n * IMPORTANT: For compatibility with tsickle and the Closure JS compiler, all\n * property decorators (but not class decorators) in this file that have\n * an @ExportDecoratedItems annotation must be defined as a regular function,\n * not an arrow function.\n */\n\nimport type {Constructor} from './base.js';\n\n/**\n * Allow for custom element classes with private constructors\n */\ntype CustomElementClass = Omit<typeof HTMLElement, 'new'>;\n\nexport type CustomElementDecorator = {\n  // legacy\n  (cls: CustomElementClass): void;\n\n  // standard\n  (\n    target: CustomElementClass,\n    context: ClassDecoratorContext<Constructor<HTMLElement>>\n  ): void;\n};\n\n/**\n * Class decorator factory that defines the decorated class as a custom element.\n *\n * ```js\n * @customElement('my-element')\n * class MyElement extends LitElement {\n *   render() {\n *     return html``;\n *   }\n * }\n * ```\n * @category Decorator\n * @param tagName The tag name of the custom element to define.\n */\nexport const customElement =\n  (tagName: string): CustomElementDecorator =>\n  (\n    classOrTarget: CustomElementClass | Constructor<HTMLElement>,\n    context?: ClassDecoratorContext<Constructor<HTMLElement>>\n  ) => {\n    if (context !== undefined) {\n      context.addInitializer(() => {\n        customElements.define(\n          tagName,\n          classOrTarget as CustomElementConstructor\n        );\n      });\n    } else {\n      customElements.define(tagName, classOrTarget as CustomElementConstructor);\n    }\n  };\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\n\n/*\n * IMPORTANT: For compatibility with tsickle and the Closure JS compiler, all\n * property decorators (but not class decorators) in this file that have\n * an @ExportDecoratedItems annotation must be defined as a regular function,\n * not an arrow function.\n */\n\nimport {\n  type PropertyDeclaration,\n  type ReactiveElement,\n  defaultConverter,\n  notEqual,\n} from '../reactive-element.js';\nimport type {Interface} from './base.js';\n\nconst DEV_MODE = true;\n\nlet issueWarning: (code: string, warning: string) => void;\n\nif (DEV_MODE) {\n  // Ensure warnings are issued only 1x, even if multiple versions of Lit\n  // are loaded.\n  const issuedWarnings: Set<string | undefined> =\n    (globalThis.litIssuedWarnings ??= new Set());\n\n  // Issue a warning, if we haven't already.\n  issueWarning = (code: string, warning: string) => {\n    warning += ` See https://lit.dev/msg/${code} for more information.`;\n    if (!issuedWarnings.has(warning)) {\n      console.warn(warning);\n      issuedWarnings.add(warning);\n    }\n  };\n}\n\n// Overloads for property decorator so that TypeScript can infer the correct\n// return type when a decorator is used as an accessor decorator or a setter\n// decorator.\nexport type PropertyDecorator = {\n  // accessor decorator signature\n  <C extends Interface<ReactiveElement>, V>(\n    target: ClassAccessorDecoratorTarget<C, V>,\n    context: ClassAccessorDecoratorContext<C, V>\n  ): ClassAccessorDecoratorResult<C, V>;\n\n  // setter decorator signature\n  <C extends Interface<ReactiveElement>, V>(\n    target: (value: V) => void,\n    context: ClassSetterDecoratorContext<C, V>\n  ): (this: C, value: V) => void;\n\n  // legacy decorator signature\n  (\n    protoOrDescriptor: Object,\n    name: PropertyKey,\n    descriptor?: PropertyDescriptor\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  ): any;\n};\n\nconst legacyProperty = (\n  options: PropertyDeclaration | undefined,\n  proto: Object,\n  name: PropertyKey\n) => {\n  const hasOwnProperty = proto.hasOwnProperty(name);\n  (proto.constructor as typeof ReactiveElement).createProperty(\n    name,\n    hasOwnProperty ? {...options, wrapped: true} : options\n  );\n  // For accessors (which have a descriptor on the prototype) we need to\n  // return a descriptor, otherwise TypeScript overwrites the descriptor we\n  // define in createProperty() with the original descriptor. We don't do this\n  // for fields, which don't have a descriptor, because this could overwrite\n  // descriptor defined by other decorators.\n  return hasOwnProperty\n    ? Object.getOwnPropertyDescriptor(proto, name)\n    : undefined;\n};\n\n// This is duplicated from a similar variable in reactive-element.ts, but\n// actually makes sense to have this default defined with the decorator, so\n// that different decorators could have different defaults.\nconst defaultPropertyDeclaration: PropertyDeclaration = {\n  attribute: true,\n  type: String,\n  converter: defaultConverter,\n  reflect: false,\n  hasChanged: notEqual,\n};\n\n// Temporary type, until google3 is on TypeScript 5.2\ntype StandardPropertyContext<C, V> = (\n  | ClassAccessorDecoratorContext<C, V>\n  | ClassSetterDecoratorContext<C, V>\n) & {metadata: object};\n\n/**\n * Wraps a class accessor or setter so that `requestUpdate()` is called with the\n * property name and old value when the accessor is set.\n */\nexport const standardProperty = <C extends Interface<ReactiveElement>, V>(\n  options: PropertyDeclaration = defaultPropertyDeclaration,\n  target: ClassAccessorDecoratorTarget<C, V> | ((value: V) => void),\n  context: StandardPropertyContext<C, V>\n): ClassAccessorDecoratorResult<C, V> | ((this: C, value: V) => void) => {\n  const {kind, metadata} = context;\n\n  if (DEV_MODE && metadata == null) {\n    issueWarning(\n      'missing-class-metadata',\n      `The class ${target} is missing decorator metadata. This ` +\n        `could mean that you're using a compiler that supports decorators ` +\n        `but doesn't support decorator metadata, such as TypeScript 5.1. ` +\n        `Please update your compiler.`\n    );\n  }\n\n  // Store the property options\n  let properties = globalThis.litPropertyMetadata.get(metadata);\n  if (properties === undefined) {\n    globalThis.litPropertyMetadata.set(metadata, (properties = new Map()));\n  }\n  properties.set(context.name, options);\n\n  if (kind === 'accessor') {\n    // Standard decorators cannot dynamically modify the class, so we can't\n    // replace a field with accessors. The user must use the new `accessor`\n    // keyword instead.\n    const {name} = context;\n    return {\n      set(this: ReactiveElement, v: V) {\n        const oldValue = (\n          target as ClassAccessorDecoratorTarget<C, V>\n        ).get.call(this as unknown as C);\n        (target as ClassAccessorDecoratorTarget<C, V>).set.call(\n          this as unknown as C,\n          v\n        );\n        this.requestUpdate(name, oldValue, options);\n      },\n      init(this: ReactiveElement, v: V): V {\n        if (v !== undefined) {\n          this._$changeProperty(name, undefined, options);\n        }\n        return v;\n      },\n    } as unknown as ClassAccessorDecoratorResult<C, V>;\n  } else if (kind === 'setter') {\n    const {name} = context;\n    return function (this: ReactiveElement, value: V) {\n      const oldValue = this[name as keyof ReactiveElement];\n      (target as (value: V) => void).call(this, value);\n      this.requestUpdate(name, oldValue, options);\n    } as unknown as (this: C, value: V) => void;\n  }\n  throw new Error(`Unsupported decorator location: ${kind}`);\n};\n\n/**\n * A class field or accessor decorator which creates a reactive property that\n * reflects a corresponding attribute value. When a decorated property is set\n * the element will update and render. A {@linkcode PropertyDeclaration} may\n * optionally be supplied to configure property features.\n *\n * This decorator should only be used for public fields. As public fields,\n * properties should be considered as primarily settable by element users,\n * either via attribute or the property itself.\n *\n * Generally, properties that are changed by the element should be private or\n * protected fields and should use the {@linkcode state} decorator.\n *\n * However, sometimes element code does need to set a public property. This\n * should typically only be done in response to user interaction, and an event\n * should be fired informing the user; for example, a checkbox sets its\n * `checked` property when clicked and fires a `changed` event. Mutating public\n * properties should typically not be done for non-primitive (object or array)\n * properties. In other cases when an element needs to manage state, a private\n * property decorated via the {@linkcode state} decorator should be used. When\n * needed, state properties can be initialized via public properties to\n * facilitate complex interactions.\n *\n * ```ts\n * class MyElement {\n *   @property({ type: Boolean })\n *   clicked = false;\n * }\n * ```\n * @category Decorator\n * @ExportDecoratedItems\n */\nexport function property(options?: PropertyDeclaration): PropertyDecorator {\n  return <C extends Interface<ReactiveElement>, V>(\n    protoOrTarget:\n      | object\n      | ClassAccessorDecoratorTarget<C, V>\n      | ((value: V) => void),\n    nameOrContext:\n      | PropertyKey\n      | ClassAccessorDecoratorContext<C, V>\n      | ClassSetterDecoratorContext<C, V>\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  ): any => {\n    return (\n      typeof nameOrContext === 'object'\n        ? standardProperty<C, V>(\n            options,\n            protoOrTarget as\n              | ClassAccessorDecoratorTarget<C, V>\n              | ((value: V) => void),\n            nameOrContext as StandardPropertyContext<C, V>\n          )\n        : legacyProperty(\n            options,\n            protoOrTarget as Object,\n            nameOrContext as PropertyKey\n          )\n    ) as PropertyDecorator;\n  };\n}\n","/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\n\nimport {\n  _$LH,\n  Part,\n  DirectiveParent,\n  CompiledTemplateResult,\n  MaybeCompiledTemplateResult,\n  UncompiledTemplateResult,\n} from './lit-html.js';\nimport {\n  DirectiveResult,\n  DirectiveClass,\n  PartInfo,\n  AttributePartInfo,\n} from './directive.js';\ntype Primitive = null | undefined | boolean | number | string | symbol | bigint;\n\nconst {_ChildPart: ChildPart} = _$LH;\n\ntype ChildPart = InstanceType<typeof ChildPart>;\n\nconst ENABLE_SHADYDOM_NOPATCH = true;\n\nconst wrap =\n  ENABLE_SHADYDOM_NOPATCH &&\n  window.ShadyDOM?.inUse &&\n  window.ShadyDOM?.noPatch === true\n    ? window.ShadyDOM!.wrap\n    : (node: Node) => node;\n\n/**\n * Tests if a value is a primitive value.\n *\n * See https://tc39.github.io/ecma262/#sec-typeof-operator\n */\nexport const isPrimitive = (value: unknown): value is Primitive =>\n  value === null || (typeof value != 'object' && typeof value != 'function');\n\nexport const TemplateResultType = {\n  HTML: 1,\n  SVG: 2,\n  MATHML: 3,\n} as const;\n\nexport type TemplateResultType =\n  (typeof TemplateResultType)[keyof typeof TemplateResultType];\n\ntype IsTemplateResult = {\n  (val: unknown): val is MaybeCompiledTemplateResult;\n  <T extends TemplateResultType>(\n    val: unknown,\n    type: T,\n  ): val is UncompiledTemplateResult<T>;\n};\n\n/**\n * Tests if a value is a TemplateResult or a CompiledTemplateResult.\n */\nexport const isTemplateResult: IsTemplateResult = (\n  value: unknown,\n  type?: TemplateResultType,\n): value is UncompiledTemplateResult =>\n  type === undefined\n    ? // This property needs to remain unminified.\n      (value as UncompiledTemplateResult)?.['_$litType$'] !== undefined\n    : (value as UncompiledTemplateResult)?.['_$litType$'] === type;\n\n/**\n * Tests if a value is a CompiledTemplateResult.\n */\nexport const isCompiledTemplateResult = (\n  value: unknown,\n): value is CompiledTemplateResult => {\n  return (value as CompiledTemplateResult)?.['_$litType$']?.h != null;\n};\n\n/**\n * Tests if a value is a DirectiveResult.\n */\nexport const isDirectiveResult = (value: unknown): value is DirectiveResult =>\n  // This property needs to remain unminified.\n  (value as DirectiveResult)?.['_$litDirective$'] !== undefined;\n\n/**\n * Retrieves the Directive class for a DirectiveResult\n */\nexport const getDirectiveClass = (value: unknown): DirectiveClass | undefined =>\n  // This property needs to remain unminified.\n  (value as DirectiveResult)?.['_$litDirective$'];\n\n/**\n * Tests whether a part has only a single-expression with no strings to\n * interpolate between.\n *\n * Only AttributePart and PropertyPart can have multiple expressions.\n * Multi-expression parts have a `strings` property and single-expression\n * parts do not.\n */\nexport const isSingleExpression = (part: PartInfo) =>\n  (part as AttributePartInfo).strings === undefined;\n\nconst createMarker = () => document.createComment('');\n\n/**\n * Inserts a ChildPart into the given container ChildPart's DOM, either at the\n * end of the container ChildPart, or before the optional `refPart`.\n *\n * This does not add the part to the containerPart's committed value. That must\n * be done by callers.\n *\n * @param containerPart Part within which to add the new ChildPart\n * @param refPart Part before which to add the new ChildPart; when omitted the\n *     part added to the end of the `containerPart`\n * @param part Part to insert, or undefined to create a new part\n */\nexport const insertPart = (\n  containerPart: ChildPart,\n  refPart?: ChildPart,\n  part?: ChildPart,\n): ChildPart => {\n  const container = wrap(containerPart._$startNode).parentNode!;\n\n  const refNode =\n    refPart === undefined ? containerPart._$endNode : refPart._$startNode;\n\n  if (part === undefined) {\n    const startNode = wrap(container).insertBefore(createMarker(), refNode);\n    const endNode = wrap(container).insertBefore(createMarker(), refNode);\n    part = new ChildPart(\n      startNode,\n      endNode,\n      containerPart,\n      containerPart.options,\n    );\n  } else {\n    const endNode = wrap(part._$endNode!).nextSibling;\n    const oldParent = part._$parent;\n    const parentChanged = oldParent !== containerPart;\n    if (parentChanged) {\n      part._$reparentDisconnectables?.(containerPart);\n      // Note that although `_$reparentDisconnectables` updates the part's\n      // `_$parent` reference after unlinking from its current parent, that\n      // method only exists if Disconnectables are present, so we need to\n      // unconditionally set it here\n      part._$parent = containerPart;\n      // Since the _$isConnected getter is somewhat costly, only\n      // read it once we know the subtree has directives that need\n      // to be notified\n      let newConnectionState;\n      if (\n        part._$notifyConnectionChanged !== undefined &&\n        (newConnectionState = containerPart._$isConnected) !==\n          oldParent!._$isConnected\n      ) {\n        part._$notifyConnectionChanged(newConnectionState);\n      }\n    }\n    if (endNode !== refNode || parentChanged) {\n      let start: Node | null = part._$startNode;\n      while (start !== endNode) {\n        const n: Node | null = wrap(start!).nextSibling;\n        wrap(container).insertBefore(start!, refNode);\n        start = n;\n      }\n    }\n  }\n\n  return part;\n};\n\n/**\n * Sets the value of a Part.\n *\n * Note that this should only be used to set/update the value of user-created\n * parts (i.e. those created using `insertPart`); it should not be used\n * by directives to set the value of the directive's container part. Directives\n * should return a value from `update`/`render` to update their part state.\n *\n * For directives that require setting their part value asynchronously, they\n * should extend `AsyncDirective` and call `this.setValue()`.\n *\n * @param part Part to set\n * @param value Value to set\n * @param index For `AttributePart`s, the index to set\n * @param directiveParent Used internally; should not be set by user\n */\nexport const setChildPartValue = <T extends ChildPart>(\n  part: T,\n  value: unknown,\n  directiveParent: DirectiveParent = part,\n): T => {\n  part._$setValue(value, directiveParent);\n  return part;\n};\n\n// A sentinel value that can never appear as a part value except when set by\n// live(). Used to force a dirty-check to fail and cause a re-render.\nconst RESET_VALUE = {};\n\n/**\n * Sets the committed value of a ChildPart directly without triggering the\n * commit stage of the part.\n *\n * This is useful in cases where a directive needs to update the part such\n * that the next update detects a value change or not. When value is omitted,\n * the next update will be guaranteed to be detected as a change.\n *\n * @param part\n * @param value\n */\nexport const setCommittedValue = (part: Part, value: unknown = RESET_VALUE) =>\n  (part._$committedValue = value);\n\n/**\n * Returns the committed value of a ChildPart.\n *\n * The committed value is used for change detection and efficient updates of\n * the part. It can differ from the value set by the template or directive in\n * cases where the template value is transformed before being committed.\n *\n * - `TemplateResult`s are committed as a `TemplateInstance`\n * - Iterables are committed as `Array<ChildPart>`\n * - All other types are committed as the template value or value returned or\n *   set by a directive.\n *\n * @param part\n */\nexport const getCommittedValue = (part: ChildPart) => part._$committedValue;\n\n/**\n * Removes a ChildPart from the DOM, including any of its content.\n *\n * @param part The Part to remove\n */\nexport const removePart = (part: ChildPart) => {\n  part._$notifyConnectionChanged?.(false, true);\n  let start: ChildNode | null = part._$startNode;\n  const end: ChildNode | null = wrap(part._$endNode!).nextSibling;\n  while (start !== end) {\n    const n: ChildNode | null = wrap(start!).nextSibling;\n    (wrap(start!) as ChildNode).remove();\n    start = n;\n  }\n};\n\nexport const clearPart = (part: ChildPart) => {\n  part._$clear();\n};\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\n\nimport {Disconnectable, Part} from './lit-html.js';\n\nexport {\n  AttributePart,\n  BooleanAttributePart,\n  ChildPart,\n  ElementPart,\n  EventPart,\n  Part,\n  PropertyPart,\n} from './lit-html.js';\n\nexport interface DirectiveClass {\n  new (part: PartInfo): Directive;\n}\n\n/**\n * This utility type extracts the signature of a directive class's render()\n * method so we can use it for the type of the generated directive function.\n */\nexport type DirectiveParameters<C extends Directive> = Parameters<C['render']>;\n\n/**\n * A generated directive function doesn't evaluate the directive, but just\n * returns a DirectiveResult object that captures the arguments.\n */\nexport interface DirectiveResult<C extends DirectiveClass = DirectiveClass> {\n  /**\n   * This property needs to remain unminified.\n   * @internal\n   */\n  ['_$litDirective$']: C;\n  /** @internal */\n  values: DirectiveParameters<InstanceType<C>>;\n}\n\nexport const PartType = {\n  ATTRIBUTE: 1,\n  CHILD: 2,\n  PROPERTY: 3,\n  BOOLEAN_ATTRIBUTE: 4,\n  EVENT: 5,\n  ELEMENT: 6,\n} as const;\n\nexport type PartType = (typeof PartType)[keyof typeof PartType];\n\nexport interface ChildPartInfo {\n  readonly type: typeof PartType.CHILD;\n}\n\nexport interface AttributePartInfo {\n  readonly type:\n    | typeof PartType.ATTRIBUTE\n    | typeof PartType.PROPERTY\n    | typeof PartType.BOOLEAN_ATTRIBUTE\n    | typeof PartType.EVENT;\n  readonly strings?: ReadonlyArray<string>;\n  readonly name: string;\n  readonly tagName: string;\n}\n\nexport interface ElementPartInfo {\n  readonly type: typeof PartType.ELEMENT;\n}\n\n/**\n * Information about the part a directive is bound to.\n *\n * This is useful for checking that a directive is attached to a valid part,\n * such as with directive that can only be used on attribute bindings.\n */\nexport type PartInfo = ChildPartInfo | AttributePartInfo | ElementPartInfo;\n\n/**\n * Creates a user-facing directive function from a Directive class. This\n * function has the same parameters as the directive's render() method.\n */\nexport const directive =\n  <C extends DirectiveClass>(c: C) =>\n  (...values: DirectiveParameters<InstanceType<C>>): DirectiveResult<C> => ({\n    // This property needs to remain unminified.\n    ['_$litDirective$']: c,\n    values,\n  });\n\n/**\n * Base class for creating custom directives. Users should extend this class,\n * implement `render` and/or `update`, and then pass their subclass to\n * `directive`.\n */\nexport abstract class Directive implements Disconnectable {\n  //@internal\n  __part!: Part;\n  //@internal\n  __attributeIndex: number | undefined;\n  //@internal\n  __directive?: Directive;\n\n  //@internal\n  _$parent!: Disconnectable;\n\n  // These will only exist on the AsyncDirective subclass\n  //@internal\n  _$disconnectableChildren?: Set<Disconnectable>;\n  // This property needs to remain unminified.\n  //@internal\n  ['_$notifyDirectiveConnectionChanged']?(isConnected: boolean): void;\n\n  constructor(_partInfo: PartInfo) {}\n\n  // See comment in Disconnectable interface for why this is a getter\n  get _$isConnected() {\n    return this._$parent._$isConnected;\n  }\n\n  /** @internal */\n  _$initialize(\n    part: Part,\n    parent: Disconnectable,\n    attributeIndex: number | undefined,\n  ) {\n    this.__part = part;\n    this._$parent = parent;\n    this.__attributeIndex = attributeIndex;\n  }\n  /** @internal */\n  _$resolve(part: Part, props: Array<unknown>): unknown {\n    return this.update(part, props);\n  }\n\n  abstract render(...props: Array<unknown>): unknown;\n\n  update(_part: Part, props: Array<unknown>): unknown {\n    return this.render(...props);\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\n\n/**\n * Overview:\n *\n * This module is designed to add support for an async `setValue` API and\n * `disconnected` callback to directives with the least impact on the core\n * runtime or payload when that feature is not used.\n *\n * The strategy is to introduce a `AsyncDirective` subclass of\n * `Directive` that climbs the \"parent\" tree in its constructor to note which\n * branches of lit-html's \"logical tree\" of data structures contain such\n * directives and thus need to be crawled when a subtree is being cleared (or\n * manually disconnected) in order to run the `disconnected` callback.\n *\n * The \"nodes\" of the logical tree include Parts, TemplateInstances (for when a\n * TemplateResult is committed to a value of a ChildPart), and Directives; these\n * all implement a common interface called `DisconnectableChild`. Each has a\n * `_$parent` reference which is set during construction in the core code, and a\n * `_$disconnectableChildren` field which is initially undefined.\n *\n * The sparse tree created by means of the `AsyncDirective` constructor\n * crawling up the `_$parent` tree and placing a `_$disconnectableChildren` Set\n * on each parent that includes each child that contains a\n * `AsyncDirective` directly or transitively via its children. In order to\n * notify connection state changes and disconnect (or reconnect) a tree, the\n * `_$notifyConnectionChanged` API is patched onto ChildParts as a directive\n * climbs the parent tree, which is called by the core when clearing a part if\n * it exists. When called, that method iterates over the sparse tree of\n * Set<DisconnectableChildren> built up by AsyncDirectives, and calls\n * `_$notifyDirectiveConnectionChanged` on any directives that are encountered\n * in that tree, running the required callbacks.\n *\n * A given \"logical tree\" of lit-html data-structures might look like this:\n *\n *  ChildPart(N1) _$dC=[D2,T3]\n *   ._directive\n *     AsyncDirective(D2)\n *   ._value // user value was TemplateResult\n *     TemplateInstance(T3) _$dC=[A4,A6,N10,N12]\n *      ._$parts[]\n *        AttributePart(A4) _$dC=[D5]\n *         ._directives[]\n *           AsyncDirective(D5)\n *        AttributePart(A6) _$dC=[D7,D8]\n *         ._directives[]\n *           AsyncDirective(D7)\n *           Directive(D8) _$dC=[D9]\n *            ._directive\n *              AsyncDirective(D9)\n *        ChildPart(N10) _$dC=[D11]\n *         ._directive\n *           AsyncDirective(D11)\n *         ._value\n *           string\n *        ChildPart(N12) _$dC=[D13,N14,N16]\n *         ._directive\n *           AsyncDirective(D13)\n *         ._value // user value was iterable\n *           Array<ChildPart>\n *             ChildPart(N14) _$dC=[D15]\n *              ._value\n *                string\n *             ChildPart(N16) _$dC=[D17,T18]\n *              ._directive\n *                AsyncDirective(D17)\n *              ._value // user value was TemplateResult\n *                TemplateInstance(T18) _$dC=[A19,A21,N25]\n *                 ._$parts[]\n *                   AttributePart(A19) _$dC=[D20]\n *                    ._directives[]\n *                      AsyncDirective(D20)\n *                   AttributePart(A21) _$dC=[22,23]\n *                    ._directives[]\n *                      AsyncDirective(D22)\n *                      Directive(D23) _$dC=[D24]\n *                       ._directive\n *                         AsyncDirective(D24)\n *                   ChildPart(N25) _$dC=[D26]\n *                    ._directive\n *                      AsyncDirective(D26)\n *                    ._value\n *                      string\n *\n * Example 1: The directive in ChildPart(N12) updates and returns `nothing`. The\n * ChildPart will _clear() itself, and so we need to disconnect the \"value\" of\n * the ChildPart (but not its directive). In this case, when `_clear()` calls\n * `_$notifyConnectionChanged()`, we don't iterate all of the\n * _$disconnectableChildren, rather we do a value-specific disconnection: i.e.\n * since the _value was an Array<ChildPart> (because an iterable had been\n * committed), we iterate the array of ChildParts (N14, N16) and run\n * `setConnected` on them (which does recurse down the full tree of\n * `_$disconnectableChildren` below it, and also removes N14 and N16 from N12's\n * `_$disconnectableChildren`). Once the values have been disconnected, we then\n * check whether the ChildPart(N12)'s list of `_$disconnectableChildren` is empty\n * (and would remove it from its parent TemplateInstance(T3) if so), but since\n * it would still contain its directive D13, it stays in the disconnectable\n * tree.\n *\n * Example 2: In the course of Example 1, `setConnected` will reach\n * ChildPart(N16); in this case the entire part is being disconnected, so we\n * simply iterate all of N16's `_$disconnectableChildren` (D17,T18) and\n * recursively run `setConnected` on them. Note that we only remove children\n * from `_$disconnectableChildren` for the top-level values being disconnected\n * on a clear; doing this bookkeeping lower in the tree is wasteful since it's\n * all being thrown away.\n *\n * Example 3: If the LitElement containing the entire tree above becomes\n * disconnected, it will run `childPart.setConnected()` (which calls\n * `childPart._$notifyConnectionChanged()` if it exists); in this case, we\n * recursively run `setConnected()` over the entire tree, without removing any\n * children from `_$disconnectableChildren`, since this tree is required to\n * re-connect the tree, which does the same operation, simply passing\n * `isConnected: true` down the tree, signaling which callback to run.\n */\n\nimport {AttributePart, ChildPart, Disconnectable, Part} from './lit-html.js';\nimport {isSingleExpression} from './directive-helpers.js';\nimport {Directive, PartInfo, PartType} from './directive.js';\nexport * from './directive.js';\n\nconst DEV_MODE = true;\n\n/**\n * Recursively walks down the tree of Parts/TemplateInstances/Directives to set\n * the connected state of directives and run `disconnected`/ `reconnected`\n * callbacks.\n *\n * @return True if there were children to disconnect; false otherwise\n */\nconst notifyChildrenConnectedChanged = (\n  parent: Disconnectable,\n  isConnected: boolean,\n): boolean => {\n  const children = parent._$disconnectableChildren;\n  if (children === undefined) {\n    return false;\n  }\n  for (const obj of children) {\n    // The existence of `_$notifyDirectiveConnectionChanged` is used as a \"brand\" to\n    // disambiguate AsyncDirectives from other DisconnectableChildren\n    // (as opposed to using an instanceof check to know when to call it); the\n    // redundancy of \"Directive\" in the API name is to avoid conflicting with\n    // `_$notifyConnectionChanged`, which exists `ChildParts` which are also in\n    // this list\n    // Disconnect Directive (and any nested directives contained within)\n    // This property needs to remain unminified.\n    (obj as AsyncDirective)['_$notifyDirectiveConnectionChanged']?.(\n      isConnected,\n      false,\n    );\n    // Disconnect Part/TemplateInstance\n    notifyChildrenConnectedChanged(obj, isConnected);\n  }\n  return true;\n};\n\n/**\n * Removes the given child from its parent list of disconnectable children, and\n * if the parent list becomes empty as a result, removes the parent from its\n * parent, and so forth up the tree when that causes subsequent parent lists to\n * become empty.\n */\nconst removeDisconnectableFromParent = (obj: Disconnectable) => {\n  let parent, children;\n  do {\n    if ((parent = obj._$parent) === undefined) {\n      break;\n    }\n    children = parent._$disconnectableChildren!;\n    children.delete(obj);\n    obj = parent;\n  } while (children?.size === 0);\n};\n\nconst addDisconnectableToParent = (obj: Disconnectable) => {\n  // Climb the parent tree, creating a sparse tree of children needing\n  // disconnection\n  for (let parent; (parent = obj._$parent); obj = parent) {\n    let children = parent._$disconnectableChildren;\n    if (children === undefined) {\n      parent._$disconnectableChildren = children = new Set();\n    } else if (children.has(obj)) {\n      // Once we've reached a parent that already contains this child, we\n      // can short-circuit\n      break;\n    }\n    children.add(obj);\n    installDisconnectAPI(parent);\n  }\n};\n\n/**\n * Changes the parent reference of the ChildPart, and updates the sparse tree of\n * Disconnectable children accordingly.\n *\n * Note, this method will be patched onto ChildPart instances and called from\n * the core code when parts are moved between different parents.\n */\nfunction reparentDisconnectables(this: ChildPart, newParent: Disconnectable) {\n  if (this._$disconnectableChildren !== undefined) {\n    removeDisconnectableFromParent(this);\n    this._$parent = newParent;\n    addDisconnectableToParent(this);\n  } else {\n    this._$parent = newParent;\n  }\n}\n\n/**\n * Sets the connected state on any directives contained within the committed\n * value of this part (i.e. within a TemplateInstance or iterable of\n * ChildParts) and runs their `disconnected`/`reconnected`s, as well as within\n * any directives stored on the ChildPart (when `valueOnly` is false).\n *\n * `isClearingValue` should be passed as `true` on a top-level part that is\n * clearing itself, and not as a result of recursively disconnecting directives\n * as part of a `clear` operation higher up the tree. This both ensures that any\n * directive on this ChildPart that produced a value that caused the clear\n * operation is not disconnected, and also serves as a performance optimization\n * to avoid needless bookkeeping when a subtree is going away; when clearing a\n * subtree, only the top-most part need to remove itself from the parent.\n *\n * `fromPartIndex` is passed only in the case of a partial `_clear` running as a\n * result of truncating an iterable.\n *\n * Note, this method will be patched onto ChildPart instances and called from the\n * core code when parts are cleared or the connection state is changed by the\n * user.\n */\nfunction notifyChildPartConnectedChanged(\n  this: ChildPart,\n  isConnected: boolean,\n  isClearingValue = false,\n  fromPartIndex = 0,\n) {\n  const value = this._$committedValue;\n  const children = this._$disconnectableChildren;\n  if (children === undefined || children.size === 0) {\n    return;\n  }\n  if (isClearingValue) {\n    if (Array.isArray(value)) {\n      // Iterable case: Any ChildParts created by the iterable should be\n      // disconnected and removed from this ChildPart's disconnectable\n      // children (starting at `fromPartIndex` in the case of truncation)\n      for (let i = fromPartIndex; i < value.length; i++) {\n        notifyChildrenConnectedChanged(value[i], false);\n        removeDisconnectableFromParent(value[i]);\n      }\n    } else if (value != null) {\n      // TemplateInstance case: If the value has disconnectable children (will\n      // only be in the case that it is a TemplateInstance), we disconnect it\n      // and remove it from this ChildPart's disconnectable children\n      notifyChildrenConnectedChanged(value as Disconnectable, false);\n      removeDisconnectableFromParent(value as Disconnectable);\n    }\n  } else {\n    notifyChildrenConnectedChanged(this, isConnected);\n  }\n}\n\n/**\n * Patches disconnection API onto ChildParts.\n */\nconst installDisconnectAPI = (obj: Disconnectable) => {\n  if ((obj as ChildPart).type == PartType.CHILD) {\n    (obj as ChildPart)._$notifyConnectionChanged ??=\n      notifyChildPartConnectedChanged;\n    (obj as ChildPart)._$reparentDisconnectables ??= reparentDisconnectables;\n  }\n};\n\n/**\n * An abstract `Directive` base class whose `disconnected` method will be\n * called when the part containing the directive is cleared as a result of\n * re-rendering, or when the user calls `part.setConnected(false)` on\n * a part that was previously rendered containing the directive (as happens\n * when e.g. a LitElement disconnects from the DOM).\n *\n * If `part.setConnected(true)` is subsequently called on a\n * containing part, the directive's `reconnected` method will be called prior\n * to its next `update`/`render` callbacks. When implementing `disconnected`,\n * `reconnected` should also be implemented to be compatible with reconnection.\n *\n * Note that updates may occur while the directive is disconnected. As such,\n * directives should generally check the `this.isConnected` flag during\n * render/update to determine whether it is safe to subscribe to resources\n * that may prevent garbage collection.\n */\nexport abstract class AsyncDirective extends Directive {\n  // As opposed to other Disconnectables, AsyncDirectives always get notified\n  // when the RootPart connection changes, so the public `isConnected`\n  // is a locally stored variable initialized via its part's getter and synced\n  // via `_$notifyDirectiveConnectionChanged`. This is cheaper than using\n  // the _$isConnected getter, which has to look back up the tree each time.\n  /**\n   * The connection state for this Directive.\n   */\n  isConnected!: boolean;\n\n  // @internal\n  override _$disconnectableChildren?: Set<Disconnectable> = undefined;\n  /**\n   * Initialize the part with internal fields\n   * @param part\n   * @param parent\n   * @param attributeIndex\n   */\n  override _$initialize(\n    part: Part,\n    parent: Disconnectable,\n    attributeIndex: number | undefined,\n  ) {\n    super._$initialize(part, parent, attributeIndex);\n    addDisconnectableToParent(this);\n    this.isConnected = part._$isConnected;\n  }\n  // This property needs to remain unminified.\n  /**\n   * Called from the core code when a directive is going away from a part (in\n   * which case `shouldRemoveFromParent` should be true), and from the\n   * `setChildrenConnected` helper function when recursively changing the\n   * connection state of a tree (in which case `shouldRemoveFromParent` should\n   * be false).\n   *\n   * @param isConnected\n   * @param isClearingDirective - True when the directive itself is being\n   *     removed; false when the tree is being disconnected\n   * @internal\n   */\n  override ['_$notifyDirectiveConnectionChanged'](\n    isConnected: boolean,\n    isClearingDirective = true,\n  ) {\n    if (isConnected !== this.isConnected) {\n      this.isConnected = isConnected;\n      if (isConnected) {\n        this.reconnected?.();\n      } else {\n        this.disconnected?.();\n      }\n    }\n    if (isClearingDirective) {\n      notifyChildrenConnectedChanged(this, isConnected);\n      removeDisconnectableFromParent(this);\n    }\n  }\n\n  /**\n   * Sets the value of the directive's Part outside the normal `update`/`render`\n   * lifecycle of a directive.\n   *\n   * This method should not be called synchronously from a directive's `update`\n   * or `render`.\n   *\n   * @param directive The directive to update\n   * @param value The value to set\n   */\n  setValue(value: unknown) {\n    if (isSingleExpression(this.__part as unknown as PartInfo)) {\n      this.__part._$setValue(value, this);\n    } else {\n      // this.__attributeIndex will be defined in this case, but\n      // assert it in dev mode\n      if (DEV_MODE && this.__attributeIndex === undefined) {\n        throw new Error(`Expected this.__attributeIndex to be a number`);\n      }\n      const newValues = [...(this.__part._$committedValue as Array<unknown>)];\n      newValues[this.__attributeIndex!] = value;\n      (this.__part as AttributePart)._$setValue(newValues, this, 0);\n    }\n  }\n\n  /**\n   * User callbacks for implementing logic to release any resources/subscriptions\n   * that may have been retained by this directive. Since directives may also be\n   * re-connected, `reconnected` should also be implemented to restore the\n   * working state of the directive prior to the next render.\n   */\n  protected disconnected() {}\n  protected reconnected() {}\n}\n","/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\nimport {nothing, ElementPart} from '../lit-html.js';\nimport {directive, AsyncDirective} from '../async-directive.js';\n\n/**\n * Creates a new Ref object, which is container for a reference to an element.\n */\nexport const createRef = <T = Element>() => new Ref<T>();\n\n/**\n * An object that holds a ref value.\n */\nclass Ref<T = Element> {\n  /**\n   * The current Element value of the ref, or else `undefined` if the ref is no\n   * longer rendered.\n   */\n  readonly value?: T;\n}\n\nexport type {Ref};\n\ninterface RefInternal {\n  value: Element | undefined;\n}\n\n// When callbacks are used for refs, this map tracks the last value the callback\n// was called with, for ensuring a directive doesn't clear the ref if the ref\n// has already been rendered to a new spot. It is double-keyed on both the\n// context (`options.host`) and the callback, since we auto-bind class methods\n// to `options.host`.\nconst lastElementForContextAndCallback = new WeakMap<\n  object,\n  WeakMap<Function, Element | undefined>\n>();\n\nexport type RefOrCallback<T = Element> = Ref<T> | ((el: T | undefined) => void);\n\nclass RefDirective extends AsyncDirective {\n  private _element?: Element;\n  private _ref?: RefOrCallback;\n  private _context?: object;\n\n  render(_ref?: RefOrCallback) {\n    return nothing;\n  }\n\n  override update(part: ElementPart, [ref]: Parameters<this['render']>) {\n    const refChanged = ref !== this._ref;\n    if (refChanged && this._ref !== undefined) {\n      // The ref passed to the directive has changed;\n      // unset the previous ref's value\n      this._updateRefValue(undefined);\n    }\n    if (refChanged || this._lastElementForRef !== this._element) {\n      // We either got a new ref or this is the first render;\n      // store the ref/element & update the ref value\n      this._ref = ref;\n      this._context = part.options?.host;\n      this._updateRefValue((this._element = part.element));\n    }\n    return nothing;\n  }\n\n  private _updateRefValue(element: Element | undefined) {\n    if (!this.isConnected) {\n      element = undefined;\n    }\n    if (typeof this._ref === 'function') {\n      // If the current ref was called with a previous value, call with\n      // `undefined`; We do this to ensure callbacks are called in a consistent\n      // way regardless of whether a ref might be moving up in the tree (in\n      // which case it would otherwise be called with the new value before the\n      // previous one unsets it) and down in the tree (where it would be unset\n      // before being set). Note that element lookup is keyed by\n      // both the context and the callback, since we allow passing unbound\n      // functions that are called on options.host, and we want to treat\n      // these as unique \"instances\" of a function.\n      const context = this._context ?? globalThis;\n      let lastElementForCallback =\n        lastElementForContextAndCallback.get(context);\n      if (lastElementForCallback === undefined) {\n        lastElementForCallback = new WeakMap();\n        lastElementForContextAndCallback.set(context, lastElementForCallback);\n      }\n      if (lastElementForCallback.get(this._ref) !== undefined) {\n        this._ref.call(this._context, undefined);\n      }\n      lastElementForCallback.set(this._ref, element);\n      // Call the ref with the new element value\n      if (element !== undefined) {\n        this._ref.call(this._context, element);\n      }\n    } else {\n      (this._ref as RefInternal)!.value = element;\n    }\n  }\n\n  private get _lastElementForRef() {\n    return typeof this._ref === 'function'\n      ? lastElementForContextAndCallback\n          .get(this._context ?? globalThis)\n          ?.get(this._ref)\n      : this._ref?.value;\n  }\n\n  override disconnected() {\n    // Only clear the box if our element is still the one in it (i.e. another\n    // directive instance hasn't rendered its element to it before us); that\n    // only happens in the event of the directive being cleared (not via manual\n    // disconnection)\n    if (this._lastElementForRef === this._element) {\n      this._updateRefValue(undefined);\n    }\n  }\n\n  override reconnected() {\n    // If we were manually disconnected, we can safely put our element back in\n    // the box, since no rendering could have occurred to change its state\n    this._updateRefValue(this._element);\n  }\n}\n\n/**\n * Sets the value of a Ref object or calls a ref callback with the element it's\n * bound to.\n *\n * A Ref object acts as a container for a reference to an element. A ref\n * callback is a function that takes an element as its only argument.\n *\n * The ref directive sets the value of the Ref object or calls the ref callback\n * during rendering, if the referenced element changed.\n *\n * Note: If a ref callback is rendered to a different element position or is\n * removed in a subsequent render, it will first be called with `undefined`,\n * followed by another call with the new element it was rendered to (if any).\n *\n * ```js\n * // Using Ref object\n * const inputRef = createRef();\n * render(html`<input ${ref(inputRef)}>`, container);\n * inputRef.value.focus();\n *\n * // Using callback\n * const callback = (inputElement) => inputElement.focus();\n * render(html`<input ${ref(callback)}>`, container);\n * ```\n */\nexport const ref = directive(RefDirective);\n\n/**\n * The type of the class that powers this directive. Necessary for naming the\n * directive's return type.\n */\nexport type {RefDirective};\n","import { LitElement, html, css } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport type { SourceData } from '../types.js';\nimport { createRef, type Ref, ref } from 'lit/directives/ref.js';\nimport type { SourcesState } from '../sources/index.js';\n\n@customElement('video-selector')\nexport class VideoSelector extends LitElement {\n  static override styles = css`\n    :host {\n      display:block;\n      background-color: hsla(0,0%,30%,0.5);\n    }\n    #contents {\n      padding: 0.5rem;\n    }\n    input {\n      display: none;\n    }\n    #toolbar {\n      margin-bottom: 0.5rem;\n    }\n  `;\n\n  @property()\n  source: SourceData | undefined;\n\n  @property()\n  playing = false;\n\n  @property()\n  cameras: SourceData[] = []\n\n  #fileInputEl: Ref<HTMLInputElement> = createRef();\n  #selectEl: Ref<HTMLSelectElement> = createRef();\n\n  override render() {\n    const source = this.source;\n    let sel = ``;\n    if (source) {\n      if (source.kind === `camera`) {\n        const first = this.cameras[ 0 ];\n        if (source.id === `` && first) {\n          sel = first.id;\n        } else {\n          sel = source.id;\n        }\n      }\n    }\n\n\n    const cameras = this.cameras.length === 0 ? html`` : html`\n          ${ this.cameras.map(d => html`<option .source=${ d } ?selected=${ d.id === sel } value=${ d.id }>${ d.label }</option>`) }`\n\n    return html`\n    <div id=\"contents\">\n      <div id=\"toolbar\"><button @click=${ this.onStartStopClick }>${ this.playing ? `Stop` : `Start` }</button></div>\n      <select ${ ref(this.#selectEl) } @change=${ this.onCameraSelectChange }>\n        ${ cameras }\n      </select>\n      <input @change=${ this.onFileChange } ${ ref(this.#fileInputEl) } id=\"fileInput\" type=\"file\" accept=\"video/*\" />\n      <button @click=${ this.onFileSelect }>File</button>\n    </div>\n    `;\n  }\n\n  getSelected(): SourceData | undefined {\n    const el = this.#selectEl.value;\n    if (!el) return;\n    const item = el.item(el.selectedIndex);\n    if (!item) return;\n    return (item as any).source as SourceData;\n  }\n\n  /**\n * Start stop source & processing\n */\n  onStartStopClick() {\n    this.dispatchEvent(new CustomEvent(`startstop`, { detail: this.getSelected() }));\n  }\n\n  onFileSelect() {\n    this.#fileInputEl.value?.click();\n  }\n\n  notifySourceState(state: SourcesState) {\n    this.playing = state === `started`;\n  }\n\n  onFileChange(event: Event) {\n    const target = event.target as HTMLInputElement;\n    if (!target) return;\n    if (!target.files) return;\n    const files = target.files;\n    if (files.length === 0) return;\n\n    const url = URL.createObjectURL(files[ 0 ] as unknown as MediaSource);\n    const s: SourceData = {\n      id: url,\n      label: `file`,\n      kind: `file`\n    };\n\n    this.dispatchEvent(new CustomEvent(`change`, {\n      detail: s\n    }));\n  }\n\n  /**\n   * User has selected a camera\n   * @param event\n   * @returns \n   */\n  onCameraSelectChange(event: Event) {\n    const t = event.target as HTMLSelectElement;\n    const opt = t.item(t.selectedIndex);\n    if (!opt) return;\n    const value = opt.value;\n    this.source = {\n      kind: `camera`,\n      label: opt.innerText,\n      id: value\n    }\n    this.dispatchEvent(new CustomEvent(`change`, { detail: this.source }));\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    // @ts-ignore\n    'video-selector': VideoSelector;\n  }\n}\n","import type { Point } from \"ixfx/geometry.js\";\n\nconst PiPi = Math.PI * 2;\n\nexport const traceLine = (ctx: CanvasRenderingContext2D, ...points: Array<Point | undefined>) => {\n  if (points.length < 2) return;\n  ctx.moveTo(points[ 0 ]!.x, points[ 0 ]!.y);\n  for (let i = 1; i < points.length; i++) {\n    if (points[ i ] === undefined) continue;\n    ctx.lineTo(points[ i ]!.x, points[ i ]!.y);\n  }\n}\n\nexport const drawDot = (ctx: CanvasRenderingContext2D, point: Point, radius: number, fillStyle?: string, label?: string, labelFillStyle?: string) => {\n  ctx.beginPath();\n  ctx.arc(point.x, point.y, radius, 0, PiPi, false);\n  if (fillStyle) {\n    ctx.fillStyle = fillStyle;\n  }\n  ctx.fill();\n\n  if (label) {\n    if (labelFillStyle) ctx.fillStyle = labelFillStyle;\n    ctx.fillText(label, point.x + radius, point.y - radius);\n  }\n}\n\nconst toAbsolute = (el: HTMLCanvasElement) => (pt: Point) => {\n  return { x: pt.x * el.width, y: pt.y * el.height }\n}\n\nconst vpScale = (el: HTMLCanvasElement) => {\n  const s = Math.min(el.width, el.height);\n  return (v: number) => {\n    return v * s;\n  }\n}\n\nexport const wrap = (el: HTMLCanvasElement) => {\n  const ctx = el.getContext(`2d`);\n  if (!ctx) throw new Error(`Context unavailable`);\n\n  const abs = toAbsolute(el);\n\n  const dot = (point: Point, radius: number, fillStyle?: string, label?: string, labelFillStyle?: string) => {\n    drawDot(ctx, abs(point), scale(radius), fillStyle, label, labelFillStyle);\n  }\n\n  const clear = () => {\n    ctx.clearRect(0, 0, el.width, el.height);\n  }\n\n  const fill = (style?: string) => {\n    if (style) ctx.fillStyle = style;\n    ctx.fillRect(0, 0, el.width, el.height);\n  }\n\n  const line = (a: Point, b: Point, width: number) => {\n    a = abs(a);\n    b = abs(b);\n    width = scale(width);\n    ctx.beginPath();\n    ctx.moveTo(a.x, a.y);\n    ctx.lineTo(b.x, b.y);\n    ctx.lineWidth = width;\n    ctx.stroke();\n    ctx.closePath();\n  }\n\n  const joinPoints = (width: number, ...points: Array<Point>) => {\n    width = scale(width);\n    ctx.beginPath();\n    for (let i = 0; i < points.length; i++) {\n      const pt = abs(points[ i ]!);\n      if (i === 0) {\n        ctx.moveTo(pt.x, pt.y);\n      } else {\n        ctx.lineTo(pt.x, pt.y);\n      }\n    }\n    ctx.lineWidth = width;\n    ctx.stroke();\n    ctx.closePath();\n  }\n\n  const scale = vpScale(el);\n\n  const testPattern = () => {\n    ctx.beginPath();\n    ctx.strokeStyle = `red`;\n    ctx.lineWidth = 2;\n    traceLine(ctx, { x: 0, y: 0 }, { x: el.width, y: el.height });\n    traceLine(ctx, { x: 0, y: el.height }, { x: el.width, y: 0 });\n    ctx.stroke();\n  }\n\n  const text = (text: string, point: Point, style?: string) => {\n    point = abs(point);\n    if (style) ctx.fillStyle = style;\n    ctx.fillText(text, point.x, point.y);\n  }\n  return { dot, abs, clear, testPattern, scale, line, joinPoints, fill, text, ctx }\n\n}\n\nexport type Typewriter = ReturnType<typeof typewriter>;\n\nexport const typewriter = (ctx: CanvasRenderingContext2D, x = 0, y = 0) => {\n  const measure = (msg: string) => {\n    const m = ctx.measureText(msg);\n    return {\n      width: m.width,\n      height: m.fontBoundingBoxAscent + m.fontBoundingBoxDescent\n    }\n  }\n\n  const move = (toX: number, toY: number) => {\n    x = toX;\n    y = toY;\n  }\n\n  const line = (msg: string, colour?: string) => {\n    const r = measure(msg);\n    if (colour) ctx.fillStyle = colour;\n    ctx.fillText(msg, x, y);\n    y += r.height;\n  }\n\n  const word = (msg: string, colour?: string) => {\n    const r = measure(msg);\n    if (colour) ctx.fillStyle = colour;\n    ctx.fillText(msg, x, y);\n    x += r.width;\n  }\n\n  return { line, word, move }\n}\n\nexport type Wrapper = ReturnType<typeof wrap>;\n","var t=\"undefined\"!=typeof self?self:{};function e(e){t:{for(var n=[\"CLOSURE_FLAGS\"],r=t,i=0;i<n.length;i++)if(null==(r=r[n[i]])){n=null;break t}n=r}return null!=(e=n&&n[e])&&e}function n(){throw Error(\"Invalid UTF8\")}function r(t,e){return e=String.fromCharCode.apply(null,e),null==t?e:t+e}let i,s;const o=\"undefined\"!=typeof TextDecoder;let a;const h=\"undefined\"!=typeof TextEncoder;function c(t){if(h)t=(a||=new TextEncoder).encode(t);else{let n=0;const r=new Uint8Array(3*t.length);for(let i=0;i<t.length;i++){var e=t.charCodeAt(i);if(128>e)r[n++]=e;else{if(2048>e)r[n++]=e>>6|192;else{if(55296<=e&&57343>=e){if(56319>=e&&i<t.length){const s=t.charCodeAt(++i);if(56320<=s&&57343>=s){e=1024*(e-55296)+s-56320+65536,r[n++]=e>>18|240,r[n++]=e>>12&63|128,r[n++]=e>>6&63|128,r[n++]=63&e|128;continue}i--}e=65533}r[n++]=e>>12|224,r[n++]=e>>6&63|128}r[n++]=63&e|128}}t=n===r.length?r:r.subarray(0,n)}return t}var u,l=e(610401301),d=e(188588736);const f=t.navigator;function p(t){return!!l&&(!!u&&u.brands.some((({brand:e})=>e&&-1!=e.indexOf(t))))}function g(e){var n;return(n=t.navigator)&&(n=n.userAgent)||(n=\"\"),-1!=n.indexOf(e)}function m(){return!!l&&(!!u&&0<u.brands.length)}function y(){return m()?p(\"Chromium\"):(g(\"Chrome\")||g(\"CriOS\"))&&!(!m()&&g(\"Edge\"))||g(\"Silk\")}function _(t){return _[\" \"](t),t}u=f&&f.userAgentData||null,_[\" \"]=function(){};var v=!m()&&(g(\"Trident\")||g(\"MSIE\"));!g(\"Android\")||y(),y(),g(\"Safari\")&&(y()||!m()&&g(\"Coast\")||!m()&&g(\"Opera\")||!m()&&g(\"Edge\")||(m()?p(\"Microsoft Edge\"):g(\"Edg/\"))||m()&&p(\"Opera\"));var E={},w=null;function T(t){var e=t.length,n=3*e/4;n%3?n=Math.floor(n):-1!=\"=.\".indexOf(t[e-1])&&(n=-1!=\"=.\".indexOf(t[e-2])?n-2:n-1);var r=new Uint8Array(n),i=0;return function(t,e){function n(e){for(;r<t.length;){var n=t.charAt(r++),i=w[n];if(null!=i)return i;if(!/^[\\s\\xa0]*$/.test(n))throw Error(\"Unknown base64 encoding at char: \"+n)}return e}A();for(var r=0;;){var i=n(-1),s=n(0),o=n(64),a=n(64);if(64===a&&-1===i)break;e(i<<2|s>>4),64!=o&&(e(s<<4&240|o>>2),64!=a&&e(o<<6&192|a))}}(t,(function(t){r[i++]=t})),i!==n?r.subarray(0,i):r}function A(){if(!w){w={};for(var t=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\".split(\"\"),e=[\"+/=\",\"+/\",\"-_=\",\"-_.\",\"-_\"],n=0;5>n;n++){var r=t.concat(e[n].split(\"\"));E[n]=r;for(var i=0;i<r.length;i++){var s=r[i];void 0===w[s]&&(w[s]=i)}}}}var b=\"undefined\"!=typeof Uint8Array,k=!v&&\"function\"==typeof btoa;function x(t){if(!k){var e;void 0===e&&(e=0),A(),e=E[e];var n=Array(Math.floor(t.length/3)),r=e[64]||\"\";let h=0,c=0;for(;h<t.length-2;h+=3){var i=t[h],s=t[h+1],o=t[h+2],a=e[i>>2];i=e[(3&i)<<4|s>>4],s=e[(15&s)<<2|o>>6],o=e[63&o],n[c++]=a+i+s+o}switch(a=0,o=r,t.length-h){case 2:o=e[(15&(a=t[h+1]))<<2]||r;case 1:t=t[h],n[c]=e[t>>2]+e[(3&t)<<4|a>>4]+o+r}return n.join(\"\")}for(e=\"\",n=0,r=t.length-10240;n<r;)e+=String.fromCharCode.apply(null,t.subarray(n,n+=10240));return e+=String.fromCharCode.apply(null,n?t.subarray(n):t),btoa(e)}const S=/[-_.]/g,L={\"-\":\"+\",_:\"/\",\".\":\"=\"};function F(t){return L[t]||\"\"}function R(t){if(!k)return T(t);S.test(t)&&(t=t.replace(S,F)),t=atob(t);const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}function M(t){return b&&null!=t&&t instanceof Uint8Array}let P;function C(){return P||=new Uint8Array(0)}var O={};let I;function U(t){if(t!==O)throw Error(\"illegal external caller\")}function D(){return I||=new B(null,O)}function N(t){U(O);var e=t.g;return null==(e=null==e||M(e)?e:\"string\"==typeof e?R(e):null)?e:t.g=e}var B=class{constructor(t,e){if(U(e),this.g=t,null!=t&&0===t.length)throw Error(\"ByteString should be constructed with non-empty values\")}h(){const t=N(this);return t?new Uint8Array(t):C()}};function G(t,e){return Error(`Invalid wire type: ${t} (at position ${e})`)}function j(){return Error(\"Failed to read varint, encoding is invalid.\")}function V(t,e){return Error(`Tried to read past the end of the data ${e} > ${t}`)}function X(t){if(\"string\"==typeof t)return{buffer:R(t),P:!1};if(Array.isArray(t))return{buffer:new Uint8Array(t),P:!1};if(t.constructor===Uint8Array)return{buffer:t,P:!1};if(t.constructor===ArrayBuffer)return{buffer:new Uint8Array(t),P:!1};if(t.constructor===B)return{buffer:N(t)||C(),P:!0};if(t instanceof Uint8Array)return{buffer:new Uint8Array(t.buffer,t.byteOffset,t.byteLength),P:!1};throw Error(\"Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, a ByteString or an Array of numbers\")}function H(){return\"function\"==typeof BigInt}const W=\"function\"==typeof Uint8Array.prototype.slice;let z,K=0,Y=0;function $(t){const e=0>t;let n=(t=Math.abs(t))>>>0;if(t=Math.floor((t-n)/4294967296),e){const[e,r]=rt(n,t);t=r,n=e}K=n>>>0,Y=t>>>0}function q(t){const e=z||=new DataView(new ArrayBuffer(8));e.setFloat32(0,+t,!0),Y=0,K=e.getUint32(0,!0)}function J(t,e){return 4294967296*e+(t>>>0)}function Z(t,e){const n=2147483648&e;return n&&(e=~e>>>0,0==(t=1+~t>>>0)&&(e=e+1>>>0)),t=J(t,e),n?-t:t}function Q(t,e){if(t>>>=0,2097151>=(e>>>=0))var n=\"\"+(4294967296*e+t);else H()?n=\"\"+(BigInt(e)<<BigInt(32)|BigInt(t)):(t=(16777215&t)+6777216*(n=16777215&(t>>>24|e<<8))+6710656*(e=e>>16&65535),n+=8147497*e,e*=2,1e7<=t&&(n+=Math.floor(t/1e7),t%=1e7),1e7<=n&&(e+=Math.floor(n/1e7),n%=1e7),n=e+tt(n)+tt(t));return n}function tt(t){return t=String(t),\"0000000\".slice(t.length)+t}function et(){var t=K,e=Y;if(2147483648&e)if(H())t=\"\"+(BigInt(0|e)<<BigInt(32)|BigInt(t>>>0));else{const[n,r]=rt(t,e);t=\"-\"+Q(n,r)}else t=Q(t,e);return t}function nt(t){if(16>t.length)$(Number(t));else if(H())t=BigInt(t),K=Number(t&BigInt(4294967295))>>>0,Y=Number(t>>BigInt(32)&BigInt(4294967295));else{const e=+(\"-\"===t[0]);Y=K=0;const n=t.length;for(let r=e,i=(n-e)%6+e;i<=n;r=i,i+=6){const e=Number(t.slice(r,i));Y*=1e6,K=1e6*K+e,4294967296<=K&&(Y+=Math.trunc(K/4294967296),Y>>>=0,K>>>=0)}if(e){const[t,e]=rt(K,Y);K=t,Y=e}}}function rt(t,e){return e=~e,t?t=1+~t:e+=1,[t,e]}function it(t,e){let n,r=0,i=0,s=0;const o=t.h;let a=t.g;do{n=o[a++],r|=(127&n)<<s,s+=7}while(32>s&&128&n);for(32<s&&(i|=(127&n)>>4),s=3;32>s&&128&n;s+=7)n=o[a++],i|=(127&n)<<s;if(dt(t,a),128>n)return e(r>>>0,i>>>0);throw j()}function st(t){let e=0,n=t.g;const r=n+10,i=t.h;for(;n<r;){const r=i[n++];if(e|=r,0==(128&r))return dt(t,n),!!(127&e)}throw j()}function ot(t){const e=t.h;let n=t.g,r=e[n++],i=127&r;if(128&r&&(r=e[n++],i|=(127&r)<<7,128&r&&(r=e[n++],i|=(127&r)<<14,128&r&&(r=e[n++],i|=(127&r)<<21,128&r&&(r=e[n++],i|=r<<28,128&r&&128&e[n++]&&128&e[n++]&&128&e[n++]&&128&e[n++]&&128&e[n++])))))throw j();return dt(t,n),i}function at(t){return ot(t)>>>0}function ht(t){var e=t.h;const n=t.g,r=e[n],i=e[n+1],s=e[n+2];return e=e[n+3],dt(t,t.g+4),(r<<0|i<<8|s<<16|e<<24)>>>0}function ct(t){var e=ht(t);t=2*(e>>31)+1;const n=e>>>23&255;return e&=8388607,255==n?e?NaN:1/0*t:0==n?t*Math.pow(2,-149)*e:t*Math.pow(2,n-150)*(e+Math.pow(2,23))}function ut(t){return ot(t)}function lt(t,e,{ca:n=!1}={}){t.ca=n,e&&(e=X(e),t.h=e.buffer,t.m=e.P,t.j=0,t.l=t.h.length,t.g=t.j)}function dt(t,e){if(t.g=e,e>t.l)throw V(t.l,e)}function ft(t,e){if(0>e)throw Error(`Tried to read a negative byte length: ${e}`);const n=t.g,r=n+e;if(r>t.l)throw V(e,t.l-n);return t.g=r,n}function pt(t,e){if(0==e)return D();var n=ft(t,e);return t.ca&&t.m?n=t.h.subarray(n,n+e):(t=t.h,n=n===(e=n+e)?C():W?t.slice(n,e):new Uint8Array(t.subarray(n,e))),0==n.length?D():new B(n,O)}var gt=[];function mt(t){var e=t.g;if(e.g==e.l)return!1;t.l=t.g.g;var n=at(t.g);if(e=n>>>3,!(0<=(n&=7)&&5>=n))throw G(n,t.l);if(1>e)throw Error(`Invalid field number: ${e} (at position ${t.l})`);return t.m=e,t.h=n,!0}function yt(t){switch(t.h){case 0:0!=t.h?yt(t):st(t.g);break;case 1:dt(t=t.g,t.g+8);break;case 2:if(2!=t.h)yt(t);else{var e=at(t.g);dt(t=t.g,t.g+e)}break;case 5:dt(t=t.g,t.g+4);break;case 3:for(e=t.m;;){if(!mt(t))throw Error(\"Unmatched start-group tag: stream EOF\");if(4==t.h){if(t.m!=e)throw Error(\"Unmatched end-group tag\");break}yt(t)}break;default:throw G(t.h,t.l)}}function _t(t,e,n){const r=t.g.l,i=at(t.g),s=t.g.g+i;let o=s-r;if(0>=o&&(t.g.l=s,n(e,t,void 0,void 0,void 0),o=s-t.g.g),o)throw Error(`Message parsing ended unexpectedly. Expected to read ${i} bytes, instead read ${i-o} bytes, either the data ended unexpectedly or the message misreported its own length`);return t.g.g=s,t.g.l=r,e}function vt(t){var e=at(t.g),a=ft(t=t.g,e);if(t=t.h,o){var h,c=t;(h=s)||(h=s=new TextDecoder(\"utf-8\",{fatal:!0})),e=a+e,c=0===a&&e===c.length?c:c.subarray(a,e);try{var u=h.decode(c)}catch(t){if(void 0===i){try{h.decode(new Uint8Array([128]))}catch(t){}try{h.decode(new Uint8Array([97])),i=!0}catch(t){i=!1}}throw!i&&(s=void 0),t}}else{e=(u=a)+e,a=[];let i,s=null;for(;u<e;){var l=t[u++];128>l?a.push(l):224>l?u>=e?n():(i=t[u++],194>l||128!=(192&i)?(u--,n()):a.push((31&l)<<6|63&i)):240>l?u>=e-1?n():(i=t[u++],128!=(192&i)||224===l&&160>i||237===l&&160<=i||128!=(192&(h=t[u++]))?(u--,n()):a.push((15&l)<<12|(63&i)<<6|63&h)):244>=l?u>=e-2?n():(i=t[u++],128!=(192&i)||0!=i-144+(l<<28)>>30||128!=(192&(h=t[u++]))||128!=(192&(c=t[u++]))?(u--,n()):(l=(7&l)<<18|(63&i)<<12|(63&h)<<6|63&c,l-=65536,a.push(55296+(l>>10&1023),56320+(1023&l)))):n(),8192<=a.length&&(s=r(s,a),a.length=0)}u=r(s,a)}return u}function Et(t){const e=at(t.g);return pt(t.g,e)}function wt(t,e,n){var r=at(t.g);for(r=t.g.g+r;t.g.g<r;)n.push(e(t.g))}var Tt=[];function At(t){return t?/^\\d+$/.test(t)?(nt(t),new bt(K,Y)):null:kt||=new bt(0,0)}var bt=class{constructor(t,e){this.h=t>>>0,this.g=e>>>0}};let kt;function xt(t){return t?/^-?\\d+$/.test(t)?(nt(t),new St(K,Y)):null:Lt||=new St(0,0)}var St=class{constructor(t,e){this.h=t>>>0,this.g=e>>>0}};let Lt;function Ft(t,e,n){for(;0<n||127<e;)t.g.push(127&e|128),e=(e>>>7|n<<25)>>>0,n>>>=7;t.g.push(e)}function Rt(t,e){for(;127<e;)t.g.push(127&e|128),e>>>=7;t.g.push(e)}function Mt(t,e){if(0<=e)Rt(t,e);else{for(let n=0;9>n;n++)t.g.push(127&e|128),e>>=7;t.g.push(1)}}function Pt(t,e){t.g.push(e>>>0&255),t.g.push(e>>>8&255),t.g.push(e>>>16&255),t.g.push(e>>>24&255)}function Ct(t,e){0!==e.length&&(t.l.push(e),t.h+=e.length)}function Ot(t,e,n){Rt(t.g,8*e+n)}function It(t,e){return Ot(t,e,2),e=t.g.end(),Ct(t,e),e.push(t.h),e}function Ut(t,e){var n=e.pop();for(n=t.h+t.g.length()-n;127<n;)e.push(127&n|128),n>>>=7,t.h++;e.push(n),t.h++}function Dt(t,e,n){Ot(t,e,2),Rt(t.g,n.length),Ct(t,t.g.end()),Ct(t,n)}function Nt(t,e,n,r){null!=n&&(e=It(t,e),r(n,t),Ut(t,e))}class Bt{constructor(t,e,n,r){this.g=t,this.h=e,this.l=n,this.pa=r}}function Gt(t){return Array.prototype.slice.call(t)}function jt(t){return\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol()?Symbol():t}var Vt=jt(),Xt=jt(\"0di\"),Ht=jt(\"2ex\"),Wt=jt(\"0dg\"),zt=Vt?(t,e)=>{t[Vt]|=e}:(t,e)=>{void 0!==t.g?t.g|=e:Object.defineProperties(t,{g:{value:e,configurable:!0,writable:!0,enumerable:!1}})},Kt=Vt?(t,e)=>{t[Vt]&=~e}:(t,e)=>{void 0!==t.g&&(t.g&=~e)};function Yt(t,e,n){return n?t|e:t&~e}var $t=Vt?t=>0|t[Vt]:t=>0|t.g,qt=Vt?t=>t[Vt]:t=>t.g,Jt=Vt?(t,e)=>(t[Vt]=e,t):(t,e)=>(void 0!==t.g?t.g=e:Object.defineProperties(t,{g:{value:e,configurable:!0,writable:!0,enumerable:!1}}),t);function Zt(t){return zt(t,34),t}function Qt(t,e){Jt(e,-14591&(0|t))}function te(t,e){Jt(e,-14557&(34|t))}function ee(t){return 0===(t=t>>14&1023)?536870912:t}var ne,re={},ie={};function se(t){return!(!t||\"object\"!=typeof t||t.Ja!==ie)}function oe(t){return null!==t&&\"object\"==typeof t&&!Array.isArray(t)&&t.constructor===Object}function ae(t,e,n){if(null!=t)if(\"string\"==typeof t)t=t?new B(t,O):D();else if(t.constructor!==B)if(M(t))t=t.length?new B(n?t:new Uint8Array(t),O):D();else{if(!e)throw Error();t=void 0}return t}function he(t,e,n){if(!Array.isArray(t)||t.length)return!1;const r=$t(t);return!!(1&r)||!(!e||!(Array.isArray(e)?e.includes(n):e.has(n)))&&(Jt(t,1|r),!0)}const ce=[];function ue(t){if(2&t)throw Error()}Jt(ce,55),ne=Object.freeze(ce);class le{constructor(t,e,n){this.l=0,this.g=t,this.h=e,this.m=n}next(){if(this.l<this.g.length){const t=this.g[this.l++];return{done:!1,value:this.h?this.h.call(this.m,t):t}}return{done:!0,value:void 0}}[Symbol.iterator](){return new le(this.g,this.h,this.m)}}let de,fe,pe;function ge(t,e){(e=de?e[de]:void 0)&&(t[de]=Gt(e))}function me(t,e){t.__closure__error__context__984382||(t.__closure__error__context__984382={}),t.__closure__error__context__984382.severity=e}function ye(){const e=Error();me(e,\"incident\"),function(e){t.setTimeout((()=>{throw e}),0)}(e)}function _e(t){return me(t=Error(t),\"warning\"),t}function ve(t){return null==t||\"number\"==typeof t?t:\"NaN\"===t||\"Infinity\"===t||\"-Infinity\"===t?Number(t):void 0}function Ee(t){return null==t||\"boolean\"==typeof t?t:\"number\"==typeof t?!!t:void 0}Object.freeze(new class{}),Object.freeze(new class{});const we=/^-?([1-9][0-9]*|0)(\\.[0-9]+)?$/;function Te(t){const e=typeof t;return\"number\"===e?Number.isFinite(t):\"string\"===e&&we.test(t)}function Ae(t){if(null==t)return t;if(\"string\"==typeof t){if(!t)return;t=+t}return\"number\"==typeof t&&Number.isFinite(t)?0|t:void 0}function be(t){if(null==t)return t;if(\"string\"==typeof t){if(!t)return;t=+t}return\"number\"==typeof t&&Number.isFinite(t)?t>>>0:void 0}function ke(t){return\"-\"!==t[0]&&(20>t.length||20===t.length&&184467>Number(t.substring(0,6)))}function xe(t){return\"-\"===t[0]?20>t.length||20===t.length&&-922337<Number(t.substring(0,7)):19>t.length||19===t.length&&922337>Number(t.substring(0,6))}function Se(t){return t=Math.trunc(t),Number.isSafeInteger(t)||($(t),t=Z(K,Y)),t}function Le(t){var e=Math.trunc(Number(t));return Number.isSafeInteger(e)?String(e):(-1!==(e=t.indexOf(\".\"))&&(t=t.substring(0,e)),xe(t)||(nt(t),t=et()),t)}function Fe(t){return null==t?t:Te(t)?\"number\"==typeof t?Se(t):Le(t):void 0}function Re(t){if(\"string\"!=typeof t)throw Error();return t}function Me(t){if(null!=t&&\"string\"!=typeof t)throw Error();return t}function Pe(t){return null==t||\"string\"==typeof t?t:void 0}function Ce(t,e,n,r){if(null!=t&&\"object\"==typeof t&&t.X===re)return t;if(!Array.isArray(t))return n?2&r?(t=e[Xt])?e=t:(Zt((t=new e).s),e=e[Xt]=t):e=new e:e=void 0,e;let i=n=$t(t);return 0===i&&(i|=32&r),i|=2&r,i!==n&&Jt(t,i),new e(t)}function Oe(t,e,n){if(e){var r=!!r;if(!Te(e=t))throw _e(\"int64\");\"string\"==typeof e?r=Le(e):r?(r=Math.trunc(e),Number.isSafeInteger(r)?r=String(r):xe(e=String(r))?r=e:($(r),r=et())):r=Se(e)}else r=Fe(t);return\"string\"==typeof(n=null==(t=r)?n?0:void 0:t)&&(r=+n,Number.isSafeInteger(r))?r:n}let Ie,Ue,De;function Ne(t){switch(typeof t){case\"boolean\":return Ue||=[0,void 0,!0];case\"number\":return 0<t?void 0:0===t?De||=[0,void 0]:[-t,void 0];case\"string\":return[0,t];case\"object\":return t}}function Be(t,e){return Ge(t,e[0],e[1])}function Ge(t,e,n){if(null==t&&(t=Ie),Ie=void 0,null==t){var r=96;n?(t=[n],r|=512):t=[],e&&(r=-16760833&r|(1023&e)<<14)}else{if(!Array.isArray(t))throw Error(\"narr\");if(2048&(r=$t(t)))throw Error(\"farr\");if(64&r)return t;if(r|=64,n&&(r|=512,n!==t[0]))throw Error(\"mid\");t:{const i=(n=t).length;if(i){const t=i-1;if(oe(n[t])){if(1024<=(e=t-(+!!(512&(r|=256))-1)))throw Error(\"pvtlmt\");r=-16760833&r|(1023&e)<<14;break t}}if(e){if(1024<(e=Math.max(e,i-(+!!(512&r)-1))))throw Error(\"spvt\");r=-16760833&r|(1023&e)<<14}}}return Jt(t,r),t}const je={};let Ve=function(){try{return _(new class extends Map{constructor(){super()}}),!1}catch{return!0}}();class Xe{constructor(){this.g=new Map}get(t){return this.g.get(t)}set(t,e){return this.g.set(t,e),this.size=this.g.size,this}delete(t){return t=this.g.delete(t),this.size=this.g.size,t}clear(){this.g.clear(),this.size=this.g.size}has(t){return this.g.has(t)}entries(){return this.g.entries()}keys(){return this.g.keys()}values(){return this.g.values()}forEach(t,e){return this.g.forEach(t,e)}[Symbol.iterator](){return this.entries()}}const He=Ve?(Object.setPrototypeOf(Xe.prototype,Map.prototype),Object.defineProperties(Xe.prototype,{size:{value:0,configurable:!0,enumerable:!0,writable:!0}}),Xe):class extends Map{constructor(){super()}};function We(t){return t}function ze(t){if(2&t.N)throw Error(\"Cannot mutate an immutable Map\")}var Ke=class extends He{constructor(t,e,n=We,r=We){super();let i=$t(t);i|=64,Jt(t,i),this.N=i,this.U=e,this.S=n,this.Z=this.U?Ye:r;for(let s=0;s<t.length;s++){const o=t[s],a=n(o[0],!1,!0);let h=o[1];e?void 0===h&&(h=null):h=r(o[1],!1,!0,void 0,void 0,i),super.set(a,h)}}oa(t=$e){if(0!==this.size)return this.Y(t)}Y(t=$e){const e=[],n=super.entries();for(var r;!(r=n.next()).done;)(r=r.value)[0]=t(r[0]),r[1]=t(r[1]),e.push(r);return e}clear(){ze(this),super.clear()}delete(t){return ze(this),super.delete(this.S(t,!0,!1))}entries(){var t=this.na();return new le(t,qe,this)}keys(){return this.Ia()}values(){var t=this.na();return new le(t,Ke.prototype.get,this)}forEach(t,e){super.forEach(((n,r)=>{t.call(e,this.get(r),r,this)}))}set(t,e){return ze(this),null==(t=this.S(t,!0,!1))?this:null==e?(super.delete(t),this):super.set(t,this.Z(e,!0,!0,this.U,!1,this.N))}Oa(t){const e=this.S(t[0],!1,!0);t=t[1],t=this.U?void 0===t?null:t:this.Z(t,!1,!0,void 0,!1,this.N),super.set(e,t)}has(t){return super.has(this.S(t,!1,!1))}get(t){t=this.S(t,!1,!1);const e=super.get(t);if(void 0!==e){var n=this.U;return n?((n=this.Z(e,!1,!0,n,this.ta,this.N))!==e&&super.set(t,n),n):e}}na(){return Array.from(super.keys())}Ia(){return super.keys()}[Symbol.iterator](){return this.entries()}};function Ye(t,e,n,r,i,s){return t=Ce(t,r,n,s),i&&(t=an(t)),t}function $e(t){return t}function qe(t){return[t,this.get(t)]}let Je;function Ze(){return Je||=new Ke(Zt([]),void 0,void 0,void 0,je)}function Qe(t,e,n,r,i){if(null!=t){if(Array.isArray(t))t=he(t,void 0,0)?void 0:i&&2&$t(t)?t:tn(t,e,n,void 0!==r,i);else if(oe(t)){const s={};for(let o in t)s[o]=Qe(t[o],e,n,r,i);t=s}else t=e(t,r);return t}}function tn(t,e,n,r,i){const s=r||n?$t(t):0;r=r?!!(32&s):void 0;const o=Gt(t);for(let t=0;t<o.length;t++)o[t]=Qe(o[t],e,n,r,i);return n&&(ge(o,t),n(s,o)),o}function en(t){return Qe(t,nn,void 0,void 0,!1)}function nn(t){return t.X===re?t.toJSON():t instanceof Ke?t.oa(en):function(t){switch(typeof t){case\"number\":return isFinite(t)?t:String(t);case\"boolean\":return t?1:0;case\"object\":if(t)if(Array.isArray(t)){if(he(t,void 0,0))return}else{if(M(t))return x(t);if(t instanceof B){const e=t.g;return null==e?\"\":\"string\"==typeof e?e:t.g=x(e)}if(t instanceof Ke)return t.oa()}}return t}(t)}function rn(t,e,n=te){if(null!=t){if(b&&t instanceof Uint8Array)return e?t:new Uint8Array(t);if(Array.isArray(t)){var r=$t(t);return 2&r||(e&&=0===r||!!(32&r)&&!(64&r||!(16&r)),t=e?Jt(t,-12293&(34|r)):tn(t,rn,4&r?te:n,!0,!0)),t}return t.X===re?(n=t.s,t=2&(r=qt(n))?t:sn(t,n,r,!0)):t instanceof Ke&&!(2&t.N)&&(n=Zt(t.Y(rn)),t=new Ke(n,t.U,t.S,t.Z)),t}}function sn(t,e,n,r){return t=t.constructor,Ie=e=on(e,n,r),e=new t(e),Ie=void 0,e}function on(t,e,n){const r=n||2&e?te:Qt,i=!!(32&e);return t=function(t,e,n){const r=Gt(t);var i=r.length;const s=256&e?r[i-1]:void 0;for(i+=s?-1:0,e=512&e?1:0;e<i;e++)r[e]=n(r[e]);if(s){e=r[e]={};for(const t in s)e[t]=n(s[t])}return ge(r,t),r}(t,e,(t=>rn(t,i,r))),zt(t,32|(n?2:0)),t}function an(t){const e=t.s,n=qt(e);return 2&n?sn(t,e,n,!1):t}function hn(t,e,n,r){return!(4&e)||null!=n&&(!r&&0===n&&(4096&e||8192&e)&&5>(t.constructor[Wt]=1+(0|t.constructor[Wt]))&&ye(),0!==n&&!(n&e))}function cn(t,e){return ln(t=t.s,qt(t),e)}function un(t,e,n,r){if(!(0>(e=r+(+!!(512&e)-1))||e>=t.length||e>=n))return t[e]}function ln(t,e,n,r){if(-1===n)return null;const i=ee(e);if(!(n>=i)){var s=t.length;return r&&256&e&&null!=(r=t[s-1][n])?(un(t,e,i,n)&&null!=Ht&&(4<=(e=(t=pe??={})[Ht]||0)||(t[Ht]=e+1,ye())),r):un(t,e,i,n)}return 256&e?t[t.length-1][n]:void 0}function dn(t,e,n,r){const i=t.s;let s=qt(i);return ue(s),fn(i,s,e,n,r),t}function fn(t,e,n,r,i){const s=ee(e);if(n>=s||i){let o=e;if(256&e)i=t[t.length-1];else{if(null==r)return o;i=t[s+(+!!(512&e)-1)]={},o|=256}return i[n]=r,n<s&&(t[n+(+!!(512&e)-1)]=void 0),o!==e&&Jt(t,o),o}return t[n+(+!!(512&e)-1)]=r,256&e&&(n in(t=t[t.length-1])&&delete t[n]),e}function pn(t,e,n,r,i){var s=2&e;let o=ln(t,e,n,i);Array.isArray(o)||(o=ne);const a=!(2&r);r=!(1&r);const h=!!(32&e);let c=$t(o);return 0!==c||!h||s||a?1&c||(c|=1,Jt(o,c)):(c|=33,Jt(o,c)),s?(t=!1,2&c||(Zt(o),t=!!(4&c)),(r||t)&&Object.freeze(o)):(s=!!(2&c)||!!(2048&c),r&&s?(o=Gt(o),r=1,h&&!a&&(r|=32),Jt(o,r),fn(t,e,n,o,i)):a&&32&c&&!s&&Kt(o,32)),o}function gn(t,e){t=t.s;let n=qt(t);const r=ln(t,n,e),i=ve(r);return null!=i&&i!==r&&fn(t,n,e,i),i}function mn(t){t=t.s;let e=qt(t);const n=ln(t,e,1),r=ae(n,!0,!!(34&e));return null!=r&&r!==n&&fn(t,e,1,r),r}function yn(t,e,n){const r=t.s;let i=qt(r);const s=2&i?1:2;let o=_n(r,i,e);var a=$t(o);if(hn(t,a,void 0,!1)){(4&a||Object.isFrozen(o))&&(o=Gt(o),a=In(a,i),i=fn(r,i,e,o));let s=t=0;for(;t<o.length;t++){const e=n(o[t]);null!=e&&(o[s++]=e)}s<t&&(o.length=s),a=Yt(a=vn(a,i),20,!0),a=Yt(a,4096,!1),a=Yt(a,8192,!1),Jt(o,a),2&a&&Object.freeze(o)}return En(a)||(n=a,(a=(t=1===s||4===s&&!!(32&a))?Yt(a,2,!0):Un(a,i,!1))!==n&&Jt(o,a),t&&Object.freeze(o)),2===s&&En(a)&&(o=Gt(o),a=Un(a=In(a,i),i,!1),Jt(o,a),fn(r,i,e,o)),o}function _n(t,e,n){return t=ln(t,e,n),Array.isArray(t)?t:ne}function vn(t,e){return 0===t&&(t=In(t,e)),Yt(t,1,!0)}function En(t){return!!(2&t)&&!!(4&t)||!!(2048&t)}function wn(t){t=Gt(t);for(let e=0;e<t.length;e++){const n=t[e]=Gt(t[e]);Array.isArray(n[1])&&(n[1]=Zt(n[1]))}return t}function Tn(t,e,n){{const a=t.s;let h=qt(a);if(ue(h),null==n)fn(a,h,e);else{var r,i=$t(n),s=i,o=!!(2&i)||Object.isFrozen(n);if((r=!o)&&(r=!1),hn(t,i))for(i=21,o&&(n=Gt(n),s=0,i=Un(i=In(i,h),h,!0)),t=0;t<n.length;t++)n[t]=Re(n[t]);r&&(n=Gt(n),s=0,i=Un(i=In(i,h),h,!0)),i!==s&&Jt(n,i),fn(a,h,e,n)}}}function An(t,e,n,r){t=t.s;let i=qt(t);ue(i),fn(t,i,e,(\"0\"===r?0===Number(n):n===r)?void 0:n)}function bn(t,e,n,r){const i=qt(t);ue(i),t=pn(t,i,e,2),r=n(r,!!(4&(e=$t(t)))&&!!(4096&e)),t.push(r)}function kn(t){return t}function xn(t,e){return Sn(t=t.s,qt(t),ws)===e?e:-1}function Sn(t,e,n){let r=0;for(let i=0;i<n.length;i++){const s=n[i];null!=ln(t,e,s)&&(0!==r&&(e=fn(t,e,r)),r=s)}return r}function Ln(t,e,n,r){let i=qt(t);ue(i);const s=ln(t,i,n,r);let o;if(null!=s&&s.X===re)return(e=an(s))!==s&&fn(t,i,n,e,r),e.s;if(Array.isArray(s)){const t=$t(s);o=2&t?on(s,t,!1):s,o=Be(o,e)}else o=Be(void 0,e);return o!==s&&fn(t,i,n,o,r),o}function Fn(t,e,n,r){t=t.s;let i=qt(t);const s=ln(t,i,n,r);return(e=Ce(s,e,!1,i))!==s&&null!=e&&fn(t,i,n,e,r),e}function Rn(t,e,n,r=!1){if(null==(e=Fn(t,e,n,r)))return e;t=t.s;let i=qt(t);if(!(2&i)){const s=an(e);s!==e&&fn(t,i,n,e=s,r)}return e}function Mn(t,e,n,r,i,s){var o=2,a=!!(2&e);o=a?1:o,i=!!i,s&&=!a,a=_n(t,e,r);var h=$t(a);const c=!!(4&h);if(!c){var u=a,l=e;const t=!!(2&(h=vn(h,e)));t&&(l=Yt(l,2,!0));let r=!t,i=!0,s=0,o=0;for(;s<u.length;s++){const e=Ce(u[s],n,!1,l);if(e instanceof n){if(!t){const t=!!(2&$t(e.s));r&&=!t,i&&=t}u[o++]=e}}o<s&&(u.length=o),h=Yt(h,4,!0),h=Yt(h,16,i),h=Yt(h,8,r),Jt(u,h),t&&Object.freeze(u)}if(s&&!(8&h||!a.length&&(1===o||4===o&&32&h))){for(En(h)&&(a=Gt(a),h=In(h,e),e=fn(t,e,r,a)),n=a,s=h,u=0;u<n.length;u++)(h=n[u])!==(l=an(h))&&(n[u]=l);s=Yt(s,8,!0),s=Yt(s,16,!n.length),Jt(n,s),h=s}return En(h)||(n=h,(h=(s=1===o||4===o&&!!(32&h))?Yt(h,!a.length||16&h&&(!c||32&h)?2:2048,!0):Un(h,e,i))!==n&&Jt(a,h),s&&Object.freeze(a)),2===o&&En(h)&&(a=Gt(a),h=Un(h=In(h,e),e,i),Jt(a,h),fn(t,e,r,a)),a}function Pn(t,e,n){t=t.s;const r=qt(t);return Mn(t,r,e,n,!1,!(2&r))}function Cn(t,e,n,r,i){return null==r&&(r=void 0),dn(t,n,r,i)}function On(t,e,n,r){null==r&&(r=void 0),t=t.s;let i=qt(t);ue(i),(n=Sn(t,i,n))&&n!==e&&null!=r&&(i=fn(t,i,n)),fn(t,i,e,r)}function In(t,e){return t=Yt(t,2,!!(2&e)),t=Yt(t,32,!0),Yt(t,2048,!1)}function Un(t,e,n){return 32&e&&n||(t=Yt(t,32,!1)),t}function Dn(t,e,n,r){t=t.s;const i=qt(t);ue(i),e=Mn(t,i,n,e,!0),n=null!=r?r:new n,e.push(n),2&$t(n.s)?Kt(e,8):Kt(e,16)}function Nn(t,e){return Ae(cn(t,e))}function Bn(t,e){return t??e}function Gn(t,e){return Bn(gn(t,e),0)}function jn(t,e){return Bn(Pe(cn(t,e)),\"\")}function Vn(t,e,n){if(null!=n&&\"boolean\"!=typeof n)throw t=typeof n,Error(`Expected boolean but got ${\"object\"!=t?t:n?Array.isArray(n)?\"array\":t:\"null\"}: ${n}`);dn(t,e,n)}function Xn(t,e,n){if(null!=n){if(\"number\"!=typeof n)throw _e(\"int32\");if(!Number.isFinite(n))throw _e(\"int32\");n|=0}dn(t,e,n)}function Hn(t,e,n){if(null!=n&&\"number\"!=typeof n)throw Error(`Value of float/double field must be a number, found ${typeof n}: ${n}`);dn(t,e,n)}function Wn(t,e,n){e.g?e.m(t,e.g,e.h,n,!0):e.m(t,e.h,n,!0)}Ke.prototype.toJSON=void 0,Ke.prototype.Ja=ie;var zn=class{constructor(t,e){this.s=Ge(t,e)}toJSON(){return Kn(this,tn(this.s,nn,void 0,void 0,!1),!0)}l(){var t=ko;return t.g?t.l(this,t.g,t.h,!0):t.l(this,t.h,t.defaultValue,!0)}clone(){const t=this.s;return sn(this,t,qt(t),!1)}P(){return!!(2&$t(this.s))}};function Kn(t,e,n){var r=d?void 0:t.constructor.B;const i=qt(n?t.s:e);if(!(t=e.length))return e;let s,o;if(oe(n=e[t-1])){t:{var a=n;let t={},e=!1;for(var h in a){let n=a[h];if(Array.isArray(n)){let t=n;(he(n,r,+h)||se(n)&&0===n.size)&&(n=null),n!=t&&(e=!0)}null!=n?t[h]=n:e=!0}if(e){for(var c in t){a=t;break t}a=null}}a!=n&&(s=!0),t--}for(h=+!!(512&i)-1;0<t&&(n=e[c=t-1],c-=h,null==n||he(n,r,c)||se(n)&&0===n.size);t--)o=!0;return s||o?(e=Array.prototype.slice.call(e,0,t),a&&e.push(a),e):e}function Yn(t){return Array.isArray(t)?t[0]instanceof Bt?t:[$r,t]:[t,void 0]}function $n(t,e){if(Array.isArray(e)){var n=$t(e);if(4&n)return e;for(var r=0,i=0;r<e.length;r++){const n=t(e[r]);null!=n&&(e[i++]=n)}return i<r&&(e.length=i),Jt(e,-12289&(5|n)),2&n&&Object.freeze(e),e}}zn.prototype.X=re,zn.prototype.toString=function(){return Kn(this,this.s,!1).toString()};const qn=Symbol();function Jn(t){let e=t[qn];if(!e){const n=sr(t),r=yr(t),i=r.l;e=i?(t,e)=>i(t,e,r):(t,e)=>{for(;mt(e)&&4!=e.h;){var i=e.m,s=r[i];if(!s){var o=r.ea;o&&(o=o[i])&&(s=r[i]=Zn(o))}s&&s(e,t,i)||(i=(s=e).l,yt(s),s.ia?s=void 0:(o=s.g.g-i,s.g.g=i,s=pt(s.g,o)),i=t,s&&(de||=Symbol(),(o=i[de])?o.push(s):i[de]=[s]))}n===tr||n===er||n.j||(t[fe||=Symbol()]=n)},t[qn]=e}return e}function Zn(t){const e=(t=Yn(t))[0].g;if(t=t[1]){const n=Jn(t),r=yr(t).T;return(t,i,s)=>e(t,i,s,r,n)}return e}class Qn{}let tr,er;const nr=Symbol();function rr(t,e,n){const r=n[1];let i;if(r){const n=r[nr];i=n?n.T:Ne(r[0]),t[e]=n??r}i&&i===Ue?(t.g||(t.g=new Set)).add(e):n[0]&&(t.h||(t.h=new Set)).add(e)}function ir(t,e){return[t.l,!e||0<e[0]?void 0:e]}function sr(t){var e=t[nr];if(e)return e;if(!(e=ar(t,t[nr]=new Qn,ir,ir,rr)).ea&&!e.h&&!e.g){let n=!0;for(let t in e)isNaN(t)||(n=!1);n?(Ne(t[0])===Ue?er?e=er:((e=new Qn).T=Ne(!0),e=er=e):e=tr||=new Qn,e=t[nr]=e):e.j=!0}return e}function or(t,e,n){t[e]=n}function ar(t,e,n,r,i=or){e.T=Ne(t[0]);let s=0;var o=t[++s];o&&o.constructor===Object&&(e.ea=o,\"function\"==typeof(o=t[++s])&&(e.l=o,e.m=t[++s],o=t[++s]));const a={};for(;Array.isArray(o)&&\"number\"==typeof o[0]&&0<o[0];){for(var h=0;h<o.length;h++)a[o[h]]=o;o=t[++s]}for(h=1;void 0!==o;){let l;\"number\"==typeof o&&(h+=o,o=t[++s]);var c=void 0;if(o instanceof Bt?l=o:(l=qr,s--),l.pa){o=t[++s],c=t;var u=s;\"function\"==typeof o&&(o=o(),c[u]=o),c=o}for(u=h+1,\"number\"==typeof(o=t[++s])&&0>o&&(u-=o,o=t[++s]);h<u;h++){const t=a[h];i(e,h,c?r(l,c,t):n(l,t))}}return e}const hr=Symbol();function cr(t){let e=t[hr];if(!e){const n=fr(t);e=(t,e)=>Er(t,e,n),t[hr]=e}return e}const ur=Symbol();function lr(t){return t.h}function dr(t,e){let n,r;const i=t.h;return(t,s,o)=>i(t,s,o,r||=fr(e).T,n||=cr(e))}function fr(t){let e=t[ur];return e||(e=ar(t,t[ur]={},lr,dr),_r(t),e)}const pr=Symbol();function gr(t,e){const n=t.g;return e?(t,r,i)=>n(t,r,i,e):n}function mr(t,e,n){const r=t.g;let i,s;return(t,o,a)=>r(t,o,a,s||=yr(e).T,i||=Jn(e),n)}function yr(t){let e=t[pr];return e||(sr(t),e=ar(t,t[pr]={},gr,mr),_r(t),e)}function _r(t){pr in t&&nr in t&&ur in t&&(t.length=0)}function vr(t,e){var n=t[e];if(n)return n;if((n=t.ea)&&(n=n[e])){var r=(n=Yn(n))[0].h;if(n=n[1]){const e=cr(n),i=fr(n).T;n=(n=t.m)?n(i,e):(t,n,s)=>r(t,n,s,i,e)}else n=r;return t[e]=n}}function Er(t,e,n){for(var r=qt(t),i=+!!(512&r)-1,s=t.length,o=512&r?1:0,a=s+(256&r?-1:0);o<a;o++){const r=t[o];if(null==r)continue;const s=o-i,a=vr(n,s);a&&a(e,r,s)}if(256&r){r=t[s-1];for(let t in r)i=+t,Number.isNaN(i)||null!=(s=r[t])&&(a=vr(n,i))&&a(e,s,i)}if(t=de?t[de]:void 0)for(Ct(e,e.g.end()),n=0;n<t.length;n++)Ct(e,N(t[n])||C())}function wr(t,e){return new Bt(t,e,!1,!1)}function Tr(t,e){return new Bt(t,e,!0,!1)}function Ar(t,e){return new Bt(t,e,!1,!0)}function br(t,e,n){fn(t,qt(t),e,n)}var kr=Ar((function(t,e,n,r,i){return 2===t.h&&(t=_t(t,Be([void 0,void 0],r),i),ue(r=qt(e)),(i=ln(e,r,n))instanceof Ke?0!=(2&i.N)?((i=i.Y()).push(t),fn(e,r,n,i)):i.Oa(t):Array.isArray(i)?(2&$t(i)&&fn(e,r,n,i=wn(i)),i.push(t)):fn(e,r,n,[t]),!0)}),(function(t,e,n,r,i){if(e instanceof Ke)e.forEach(((e,s)=>{Nt(t,n,Be([s,e],r),i)}));else if(Array.isArray(e))for(let s=0;s<e.length;s++){const o=e[s];Array.isArray(o)&&Nt(t,n,Be(o,r),i)}}));function xr(t,e,n){t:if(null!=e){if(Te(e)){if(\"string\"==typeof e){e=Le(e);break t}if(\"number\"==typeof e){e=Se(e);break t}}e=void 0}null!=e&&(\"string\"==typeof e&&xt(e),null!=e&&(Ot(t,n,0),\"number\"==typeof e?(t=t.g,$(e),Ft(t,K,Y)):(n=xt(e),Ft(t.g,n.h,n.g))))}function Sr(t,e,n){null!=(e=Ae(e))&&null!=e&&(Ot(t,n,0),Mt(t.g,e))}function Lr(t,e,n){null!=(e=Ee(e))&&(Ot(t,n,0),t.g.g.push(e?1:0))}function Fr(t,e,n){null!=(e=Pe(e))&&Dt(t,n,c(e))}function Rr(t,e,n,r,i){Nt(t,n,e instanceof zn?e.s:Array.isArray(e)?Be(e,r):void 0,i)}function Mr(t,e,n){null!=(e=null==e||\"string\"==typeof e||M(e)||e instanceof B?e:void 0)&&Dt(t,n,X(e).buffer)}function Pr(t,e,n){return(5===t.h||2===t.h)&&(e=pn(e,qt(e),n,2,!1),2==t.h?wt(t,ct,e):e.push(ct(t.g)),!0)}var Cr,Or=wr((function(t,e,n){if(1!==t.h)return!1;var r=t.g;t=ht(r);const i=ht(r);r=2*(i>>31)+1;const s=i>>>20&2047;return t=4294967296*(1048575&i)+t,br(e,n,2047==s?t?NaN:1/0*r:0==s?r*Math.pow(2,-1074)*t:r*Math.pow(2,s-1075)*(t+4503599627370496)),!0}),(function(t,e,n){null!=(e=ve(e))&&(Ot(t,n,1),t=t.g,(n=z||=new DataView(new ArrayBuffer(8))).setFloat64(0,+e,!0),K=n.getUint32(0,!0),Y=n.getUint32(4,!0),Pt(t,K),Pt(t,Y))})),Ir=wr((function(t,e,n){return 5===t.h&&(br(e,n,ct(t.g)),!0)}),(function(t,e,n){null!=(e=ve(e))&&(Ot(t,n,5),t=t.g,q(e),Pt(t,K))})),Ur=Tr(Pr,(function(t,e,n){if(null!=(e=$n(ve,e)))for(let o=0;o<e.length;o++){var r=t,i=n,s=e[o];null!=s&&(Ot(r,i,5),r=r.g,q(s),Pt(r,K))}})),Dr=Tr(Pr,(function(t,e,n){if(null!=(e=$n(ve,e))&&e.length){Ot(t,n,2),Rt(t.g,4*e.length);for(let r=0;r<e.length;r++)n=t.g,q(e[r]),Pt(n,K)}})),Nr=wr((function(t,e,n){return 0===t.h&&(br(e,n,it(t.g,Z)),!0)}),xr),Br=wr((function(t,e,n){return 0===t.h&&(br(e,n,0===(t=it(t.g,Z))?void 0:t),!0)}),xr),Gr=wr((function(t,e,n){return 0===t.h&&(br(e,n,it(t.g,J)),!0)}),(function(t,e,n){t:if(null!=e){if(Te(e)){if(\"string\"==typeof e){var r=Math.trunc(Number(e));Number.isSafeInteger(r)&&0<=r?e=String(r):(-1!==(r=e.indexOf(\".\"))&&(e=e.substring(0,r)),ke(e)||(nt(e),e=Q(K,Y)));break t}if(\"number\"==typeof e){e=0<=(e=Math.trunc(e))&&Number.isSafeInteger(e)?e:function(t){if(0>t){$(t);const e=Q(K,Y);return t=Number(e),Number.isSafeInteger(t)?t:e}return ke(String(t))?t:($(t),J(K,Y))}(e);break t}}e=void 0}null!=e&&(\"string\"==typeof e&&At(e),null!=e&&(Ot(t,n,0),\"number\"==typeof e?(t=t.g,$(e),Ft(t,K,Y)):(n=At(e),Ft(t.g,n.h,n.g))))})),jr=wr((function(t,e,n){return 0===t.h&&(br(e,n,ot(t.g)),!0)}),Sr),Vr=Tr((function(t,e,n){return(0===t.h||2===t.h)&&(e=pn(e,qt(e),n,2,!1),2==t.h?wt(t,ot,e):e.push(ot(t.g)),!0)}),(function(t,e,n){if(null!=(e=$n(Ae,e))&&e.length){n=It(t,n);for(let n=0;n<e.length;n++)Mt(t.g,e[n]);Ut(t,n)}})),Xr=wr((function(t,e,n){return 0===t.h&&(br(e,n,0===(t=ot(t.g))?void 0:t),!0)}),Sr),Hr=wr((function(t,e,n){return 0===t.h&&(br(e,n,st(t.g)),!0)}),Lr),Wr=wr((function(t,e,n){return 0===t.h&&(br(e,n,!1===(t=st(t.g))?void 0:t),!0)}),Lr),zr=Tr((function(t,e,n){return 2===t.h&&(bn(e,n,kn,t=vt(t)),!0)}),(function(t,e,n){if(null!=(e=$n(Pe,e)))for(let o=0;o<e.length;o++){var r=t,i=n,s=e[o];null!=s&&Dt(r,i,c(s))}})),Kr=wr((function(t,e,n){return 2===t.h&&(br(e,n,\"\"===(t=vt(t))?void 0:t),!0)}),Fr),Yr=wr((function(t,e,n){return 2===t.h&&(br(e,n,vt(t)),!0)}),Fr),$r=Ar((function(t,e,n,r,i){return 2===t.h&&(_t(t,Ln(e,r,n,!0),i),!0)}),Rr),qr=Ar((function(t,e,n,r,i){return 2===t.h&&(_t(t,Ln(e,r,n),i),!0)}),Rr);Cr=new Bt((function(t,e,n,r,i){if(2!==t.h)return!1;r=Be(void 0,r);let s=qt(e);ue(s);let o=pn(e,s,n,3);return s=qt(e),4&$t(o)&&(o=Gt(o),Jt(o,-2079&(1|$t(o))),fn(e,s,n,o)),o.push(r),_t(t,r,i),!0}),(function(t,e,n,r,i){if(Array.isArray(e))for(let s=0;s<e.length;s++)Rr(t,e[s],n,r,i)}),!0,!0);var Jr=Ar((function(t,e,n,r,i,s){if(2!==t.h)return!1;let o=qt(e);return ue(o),(s=Sn(e,o,s))&&n!==s&&fn(e,o,s),_t(t,e=Ln(e,r,n),i),!0}),Rr),Zr=wr((function(t,e,n){return 2===t.h&&(br(e,n,Et(t)),!0)}),Mr),Qr=Tr((function(t,e,n){return(0===t.h||2===t.h)&&(e=pn(e,qt(e),n,2,!1),2==t.h?wt(t,at,e):e.push(at(t.g)),!0)}),(function(t,e,n){if(null!=(e=$n(be,e)))for(let o=0;o<e.length;o++){var r=t,i=n,s=e[o];null!=s&&(Ot(r,i,0),Rt(r.g,s))}})),ti=wr((function(t,e,n){return 0===t.h&&(br(e,n,ot(t.g)),!0)}),(function(t,e,n){null!=(e=Ae(e))&&(e=parseInt(e,10),Ot(t,n,0),Mt(t.g,e))})),ei=Tr((function(t,e,n){return(0===t.h||2===t.h)&&(e=pn(e,qt(e),n,2,!1),2==t.h?wt(t,ut,e):e.push(ot(t.g)),!0)}),(function(t,e,n){if(null!=(e=$n(Ae,e))&&e.length){n=It(t,n);for(let n=0;n<e.length;n++)Mt(t.g,e[n]);Ut(t,n)}}));class ni{constructor(t,e){this.h=t,this.g=e,this.l=Rn,this.m=Cn,this.defaultValue=void 0}}function ri(t,e){return new ni(t,e)}function ii(t,e){return(n,r)=>{if(Tt.length){const t=Tt.pop();t.o(r),lt(t.g,n,r),n=t}else n=new class{constructor(t,e){if(gt.length){const n=gt.pop();lt(n,t,e),t=n}else t=new class{constructor(t,e){this.h=null,this.m=!1,this.g=this.l=this.j=0,lt(this,t,e)}clear(){this.h=null,this.m=!1,this.g=this.l=this.j=0,this.ca=!1}}(t,e);this.g=t,this.l=this.g.g,this.h=this.m=-1,this.o(e)}o({ia:t=!1}={}){this.ia=t}}(n,r);try{const r=new t,s=r.s;Jn(e)(s,n);var i=r}finally{n.g.clear(),n.m=-1,n.h=-1,100>Tt.length&&Tt.push(n)}return i}}function si(t){return function(){const e=new class{constructor(){this.l=[],this.h=0,this.g=new class{constructor(){this.g=[]}length(){return this.g.length}end(){const t=this.g;return this.g=[],t}}}};Er(this.s,e,fr(t)),Ct(e,e.g.end());const n=new Uint8Array(e.h),r=e.l,i=r.length;let s=0;for(let t=0;t<i;t++){const e=r[t];n.set(e,s),s+=e.length}return e.l=[n],n}}var oi=class extends zn{constructor(t){super(t)}},ai=[0,Kr,wr((function(t,e,n){return 2===t.h&&(br(e,n,(t=Et(t))===D()?void 0:t),!0)}),(function(t,e,n){if(null!=e){if(e instanceof zn){const r=e.Qa;return void(r&&(e=r(e),null!=e&&Dt(t,n,X(e).buffer)))}if(Array.isArray(e))return}Mr(t,e,n)}))],hi=[0,Yr],ci=[0,jr,ti,Hr,-1,Vr,ti,-1],ui=[0,Hr,-1],li=class extends zn{constructor(){super()}};li.B=[6];var di=[0,Hr,Yr,Hr,ti,-1,ei,Yr,-1,ui,ti],fi=[0,Yr,-2],pi=class extends zn{constructor(){super()}},gi=[0],mi=[0,jr,Hr,-4],yi=class extends zn{constructor(t){super(t,2)}},_i={},vi=[-2,_i,Hr];_i[336783863]=[0,Yr,Hr,-1,jr,[0,[1,2,3,4,5,6],Jr,gi,Jr,di,Jr,fi,Jr,mi,Jr,ci,Jr,[0,Yr]],hi,Hr,[0,[1,3],[2,4],Jr,[0,Vr],-1,Jr,[0,zr],-1,Cr,[0,Yr,-1]],Yr];var Ei=[0,Kr,Wr],wi=[0,Br,-1,Wr,-3,Br,Vr,Kr,Xr,Br,-1,Wr,Xr,Wr,-2,Kr],Ti=[-1,{}],Ai=[0,Yr,1,Ti],bi=[0,Yr,zr,Ti];function ki(t,e){An(t,2,Me(e),\"\")}function xi(t,e){bn(t.s,3,Re,e)}function Si(t,e){bn(t.s,4,Re,e)}var Li=class extends zn{constructor(t){super(t,500)}o(t){return Cn(this,0,7,t)}};Li.B=[3,4,5,6,8,13,17,1005];var Fi=[-500,Kr,-1,zr,-3,vi,Cr,ai,Xr,-1,Ai,bi,Cr,Ei,Kr,wi,Xr,zr,987,zr],Ri=[0,Kr,-1,Ti],Mi=[-500,Yr,-1,[-1,{}],998,Yr],Pi=[-500,Yr,zr,-1,[-2,{},Hr],997,zr,-1],Ci=[-500,Yr,zr,Ti,998,zr];function Oi(t,e){Dn(t,1,Li,e)}function Ii(t,e){bn(t.s,10,Re,e)}function Ui(t,e){bn(t.s,15,Re,e)}var Di=class extends zn{constructor(t){super(t,500)}o(t){return Cn(this,0,1001,t)}};Di.B=[1,6,7,9,10,15,16,17,14,1002];var Ni=[-500,Cr,Fi,4,Cr,Mi,Cr,Pi,Xr,Cr,Ci,zr,Xr,Ai,bi,Cr,Ri,zr,-2,wi,Kr,-1,Wr,979,Ti,Cr,ai],Bi=ii(Di,Ni);Di.prototype.g=si(Ni);var Gi=[0,Cr,[0,jr,-2]],ji=class extends zn{constructor(t){super(t)}},Vi=[0,jr,Ir,Yr,-1],Xi=class extends zn{constructor(t){super(t)}g(){return Pn(this,ji,1)}};Xi.B=[1];var Hi=[0,Cr,Vi],Wi=ii(Xi,Hi),zi=[0,jr,Ir],Ki=[0,jr,-1,Gi],Yi=class extends zn{constructor(t){super(t)}},$i=[0,jr,-3],qi=[0,Ir,-3],Ji=class extends zn{constructor(t){super(t)}},Zi=[0,Ir,-1,Yr,Ir],Qi=class extends zn{constructor(t){super(t)}h(){return Rn(this,Yi,2)}g(){return Pn(this,Ji,5)}};Qi.B=[5];var ts=[0,ti,$i,qi,Ki,Cr,Zi],es=class extends zn{constructor(t){super(t)}};es.B=[1,2,3,8,9];var ns=ii(es,[0,zr,Vr,Dr,ts,Yr,-1,Nr,Cr,zi,zr,Nr]),rs=class extends zn{constructor(t){super(t)}},is=[0,Ir,-4],ss=class extends zn{constructor(t){super(t)}};ss.B=[1];var os=ii(ss,[0,Cr,is]),as=class extends zn{constructor(t){super(t)}},hs=[0,Ir,-4],cs=class extends zn{constructor(t){super(t)}};cs.B=[1];var us=ii(cs,[0,Cr,hs]),ls=class extends zn{constructor(t){super(t)}};ls.B=[3];var ds=[0,jr,-1,Dr,ti],fs=class extends zn{constructor(){super()}};fs.prototype.g=si([0,Ir,-4,Nr]);var ps=class extends zn{constructor(t){super(t)}},gs=[0,1,jr,Yr,Hi],ms=class extends zn{constructor(t){super(t)}};ms.B=[1];var ys=ii(ms,[0,Cr,gs,Nr]),_s=class extends zn{constructor(t){super(t)}};_s.B=[1];var vs=class extends zn{constructor(t){super(t)}qa(){const t=mn(this);return null==t?D():t}},Es=class extends zn{constructor(t){super(t)}},ws=[1,2],Ts=[0,ws,Jr,[0,Dr],Jr,[0,Zr],jr,Yr],As=class extends zn{constructor(t){super(t)}};As.B=[1];var bs=ii(As,[0,Cr,Ts,Nr]),ks=class extends zn{constructor(t){super(t)}};ks.B=[4,5];var xs=[0,Yr,jr,Ir,zr,-1],Ss=class extends zn{constructor(t){super(t)}},Ls=[0,Hr,-1],Fs=class extends zn{constructor(t){super(t)}},Rs=[1,2,3,4,5],Ms=class extends zn{constructor(t){super(t)}g(){return null!=mn(this)}h(){return null!=Pe(cn(this,2))}},Ps=[0,Zr,Yr,[0,jr,Nr,-1],[0,Gr,Nr]],Cs=class extends zn{constructor(t){super(t)}g(){return Ee(cn(this,2))??!1}},Os=[0,Ps,Hr,[0,Rs,Jr,mi,Jr,di,Jr,ci,Jr,gi,Jr,fi],ti],Is=class extends zn{constructor(t){super(t)}},Us=[0,Os,Ir,-1,jr],Ds=ri(502141897,Is);_i[502141897]=Us;var Ns=[0,Ps];_i[512499200]=Ns;var Bs=[0,Ns];_i[515723506]=Bs;var Gs=ii(class extends zn{constructor(t){super(t)}},[0,[0,ti,-1,Ur,Qr],ds]),js=[0,Os];_i[508981768]=js;var Vs=class extends zn{constructor(t){super(t)}},Xs=[0,Os,Ir,js,Hr],Hs=class extends zn{constructor(t){super(t)}},Ws=[0,Os,Us,Xs,Ir,Bs];_i[508968149]=Xs;var zs=ri(508968150,Hs);_i[508968150]=Ws;var Ks=class extends zn{constructor(t){super(t)}},Ys=ri(513916220,Ks);_i[513916220]=[0,Os,Ws,jr];var $s=class extends zn{constructor(t){super(t)}h(){return Rn(this,ks,2)}g(){dn(this,2)}},qs=[0,Os,xs];_i[478825465]=qs;var Js=[0,Os];_i[478825422]=Js;var Zs=class extends zn{constructor(t){super(t)}},Qs=[0,Os,Js,qs,-1],to=class extends zn{constructor(t){super(t)}},eo=[0,Os,Ir,jr],no=class extends zn{constructor(t){super(t)}},ro=[0,Os,Ir],io=class extends zn{constructor(t){super(t)}},so=[0,Os,eo,ro,Ir],oo=class extends zn{constructor(t){super(t)}},ao=[0,Os,so,Qs];_i[463370452]=Qs,_i[464864288]=eo,_i[474472470]=ro;var ho=ri(462713202,io);_i[462713202]=so;var co=ri(479097054,oo);_i[479097054]=ao;var uo=class extends zn{constructor(t){super(t)}},lo=[0,Os],fo=class extends zn{constructor(t){super(t)}},po=[0,Os,Ir,-1,jr];_i[514774813]=po;var go=class extends zn{constructor(t){super(t)}},mo=[0,Os,Ir,Hr];_i[518928384]=mo;var yo=class extends zn{constructor(){super()}};yo.prototype.g=si([0,Os,ro,lo,Us,Xs,po,mo]);var _o=class extends zn{constructor(t){super(t)}},vo=ri(456383383,_o);_i[456383383]=[0,Os,xs];var Eo=class extends zn{constructor(t){super(t)}},wo=ri(476348187,Eo);_i[476348187]=[0,Os,Ls];var To=class extends zn{constructor(t){super(t)}},Ao=[0,ti,-1],bo=class extends zn{constructor(t){super(t)}};bo.B=[3];var ko=ri(458105876,class extends zn{constructor(t){super(t)}g(){var t=this.s;const e=qt(t);var n=2&e;return t=function(t,e,n){var r=bo;const i=2&e;let s=!1;if(null==n){if(i)return Ze();n=[]}else if(n.constructor===Ke){if(0==(2&n.N)||i)return n;n=n.Y()}else Array.isArray(n)?s=!!(2&$t(n)):n=[];if(i){if(!n.length)return Ze();s||(s=!0,Zt(n))}else s&&(s=!1,n=wn(n));return s||(64&$t(n)?Kt(n,32):32&e&&zt(n,32)),fn(t,e,2,r=new Ke(n,r,Oe,void 0),!1),r}(t,e,ln(t,e,2)),null==t||!n&&bo&&(t.ta=!0),n=t}});_i[458105876]=[0,Ao,kr,[!0,Nr,[0,Yr,-1,zr]]];var xo=class extends zn{constructor(t){super(t)}},So=ri(458105758,xo);_i[458105758]=[0,Os,Yr,Ao];var Lo=class extends zn{constructor(t){super(t)}};Lo.B=[5,6];var Fo=ri(443442058,Lo);_i[443442058]=[0,Os,Yr,jr,Ir,zr,-1];var Ro=class extends zn{constructor(t){super(t)}},Mo=ri(516587230,Ro);function Po(t,e){return e=e?e.clone():new ks,void 0!==t.displayNamesLocale?dn(e,1,Me(t.displayNamesLocale)):void 0===t.displayNamesLocale&&dn(e,1),void 0!==t.maxResults?Xn(e,2,t.maxResults):\"maxResults\"in t&&dn(e,2),void 0!==t.scoreThreshold?Hn(e,3,t.scoreThreshold):\"scoreThreshold\"in t&&dn(e,3),void 0!==t.categoryAllowlist?Tn(e,4,t.categoryAllowlist):\"categoryAllowlist\"in t&&dn(e,4),void 0!==t.categoryDenylist?Tn(e,5,t.categoryDenylist):\"categoryDenylist\"in t&&dn(e,5),e}function Co(t,e=-1,n=\"\"){return{categories:t.map((t=>({index:Bn(Nn(t,1),0)??-1,score:Gn(t,2)??0,categoryName:jn(t,3)??\"\",displayName:jn(t,4)??\"\"}))),headIndex:e,headName:n}}function Oo(t){var e=yn(t,3,ve),n=yn(t,2,Ae),r=yn(t,1,Pe),i=yn(t,9,Pe);const s={categories:[],keypoints:[]};for(let t=0;t<e.length;t++)s.categories.push({score:e[t],index:n[t]??-1,categoryName:r[t]??\"\",displayName:i[t]??\"\"});if((e=Rn(t,Qi,4)?.h())&&(s.boundingBox={originX:Nn(e,1)??0,originY:Nn(e,2)??0,width:Nn(e,3)??0,height:Nn(e,4)??0,angle:0}),Rn(t,Qi,4)?.g().length)for(const e of Rn(t,Qi,4).g())s.keypoints.push({x:gn(e,1)??0,y:gn(e,2)??0,score:gn(e,4)??0,label:Pe(cn(e,3))??\"\"});return s}function Io(t){const e=[];for(const n of Pn(t,as,1))e.push({x:Gn(n,1)??0,y:Gn(n,2)??0,z:Gn(n,3)??0,visibility:Gn(n,4)??0});return e}function Uo(t){const e=[];for(const n of Pn(t,rs,1))e.push({x:Gn(n,1)??0,y:Gn(n,2)??0,z:Gn(n,3)??0,visibility:Gn(n,4)??0});return e}function Do(t){return Array.from(t,(t=>127<t?t-256:t))}function No(t,e){if(t.length!==e.length)throw Error(`Cannot compute cosine similarity between embeddings of different sizes (${t.length} vs. ${e.length}).`);let n=0,r=0,i=0;for(let s=0;s<t.length;s++)n+=t[s]*e[s],r+=t[s]*t[s],i+=e[s]*e[s];if(0>=r||0>=i)throw Error(\"Cannot compute cosine similarity on embedding with 0 norm.\");return n/Math.sqrt(r*i)}let Bo;_i[516587230]=[0,Os,po,mo,Ir];const Go=new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11]);async function jo(){if(void 0===Bo)try{await WebAssembly.instantiate(Go),Bo=!0}catch{Bo=!1}return Bo}async function Vo(t,e=\"\"){const n=await jo()?\"wasm_internal\":\"wasm_nosimd_internal\";return{wasmLoaderPath:`${e}/${t}_${n}.js`,wasmBinaryPath:`${e}/${t}_${n}.wasm`}}var Xo=class{};function Ho(){var t=navigator;return\"undefined\"!=typeof OffscreenCanvas&&(!function(t=navigator){return(t=t.userAgent).includes(\"Safari\")&&!t.includes(\"Chrome\")}(t)||!!((t=t.userAgent.match(/Version\\/([\\d]+).*Safari/))&&1<=t.length&&17<=Number(t[1])))}async function Wo(t){if(\"function\"!=typeof importScripts){const e=document.createElement(\"script\");return e.src=t.toString(),e.crossOrigin=\"anonymous\",new Promise(((t,n)=>{e.addEventListener(\"load\",(()=>{t()}),!1),e.addEventListener(\"error\",(t=>{n(t)}),!1),document.body.appendChild(e)}))}importScripts(t.toString())}function zo(t){return void 0!==t.videoWidth?[t.videoWidth,t.videoHeight]:void 0!==t.naturalWidth?[t.naturalWidth,t.naturalHeight]:void 0!==t.displayWidth?[t.displayWidth,t.displayHeight]:[t.width,t.height]}function Ko(t,e,n){t.m||console.error(\"No wasm multistream support detected: ensure dependency inclusion of :gl_graph_runner_internal_multi_input target\"),n(e=t.i.stringToNewUTF8(e)),t.i._free(e)}function Yo(t,e,n){if(!t.i.canvas)throw Error(\"No OpenGL canvas configured.\");if(n?t.i._bindTextureToStream(n):t.i._bindTextureToCanvas(),!(n=t.i.canvas.getContext(\"webgl2\")||t.i.canvas.getContext(\"webgl\")))throw Error(\"Failed to obtain WebGL context from the provided canvas. `getContext()` should only be invoked with `webgl` or `webgl2`.\");t.i.gpuOriginForWebTexturesIsBottomLeft&&n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!0),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e),t.i.gpuOriginForWebTexturesIsBottomLeft&&n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1);const[r,i]=zo(e);return!t.l||r===t.i.canvas.width&&i===t.i.canvas.height||(t.i.canvas.width=r,t.i.canvas.height=i),[r,i]}function $o(t,e,n){t.m||console.error(\"No wasm multistream support detected: ensure dependency inclusion of :gl_graph_runner_internal_multi_input target\");const r=new Uint32Array(e.length);for(let n=0;n<e.length;n++)r[n]=t.i.stringToNewUTF8(e[n]);e=t.i._malloc(4*r.length),t.i.HEAPU32.set(r,e>>2),n(e);for(const e of r)t.i._free(e);t.i._free(e)}function qo(t,e,n){t.i.simpleListeners=t.i.simpleListeners||{},t.i.simpleListeners[e]=n}function Jo(t,e,n){let r=[];t.i.simpleListeners=t.i.simpleListeners||{},t.i.simpleListeners[e]=(t,e,i)=>{e?(n(r,i),r=[]):r.push(t)}}Xo.forVisionTasks=function(t){return Vo(\"vision\",t)},Xo.forTextTasks=function(t){return Vo(\"text\",t)},Xo.forGenAiExperimentalTasks=function(t){return Vo(\"genai_experimental\",t)},Xo.forGenAiTasks=function(t){return Vo(\"genai\",t)},Xo.forAudioTasks=function(t){return Vo(\"audio\",t)},Xo.isSimdSupported=function(){return jo()};async function Zo(t,e,n,r){return t=await(async(t,e,n,r,i)=>{if(e&&await Wo(e),!self.ModuleFactory)throw Error(\"ModuleFactory not set.\");if(n&&(await Wo(n),!self.ModuleFactory))throw Error(\"ModuleFactory not set.\");return self.Module&&i&&((e=self.Module).locateFile=i.locateFile,i.mainScriptUrlOrBlob&&(e.mainScriptUrlOrBlob=i.mainScriptUrlOrBlob)),i=await self.ModuleFactory(self.Module||i),self.ModuleFactory=self.Module=void 0,new t(i,r)})(t,n.wasmLoaderPath,n.assetLoaderPath,e,{locateFile:t=>t.endsWith(\".wasm\")?n.wasmBinaryPath.toString():n.assetBinaryPath&&t.endsWith(\".data\")?n.assetBinaryPath.toString():t}),await t.o(r),t}function Qo(t,e){const n=Rn(t.baseOptions,Ms,1)||new Ms;\"string\"==typeof e?(dn(n,2,Me(e)),dn(n,1)):e instanceof Uint8Array&&(dn(n,1,ae(e,!1,!1)),dn(n,2)),Cn(t.baseOptions,0,1,n)}function ta(t){try{const e=t.K.length;if(1===e)throw Error(t.K[0].message);if(1<e)throw Error(\"Encountered multiple errors: \"+t.K.map((t=>t.message)).join(\", \"))}finally{t.K=[]}}function ea(t,e){t.J=Math.max(t.J,e)}function na(t,e){t.C=new Li,ki(t.C,\"PassThroughCalculator\"),xi(t.C,\"free_memory\"),Si(t.C,\"free_memory_unused_out\"),Ii(e,\"free_memory\"),Oi(e,t.C)}function ra(t,e){xi(t.C,e),Si(t.C,e+\"_unused_out\")}function ia(t){t.g.addBoolToStream(!0,\"free_memory\",t.J)}var sa=class{constructor(t){this.g=t,this.K=[],this.J=0,this.g.setAutoRenderToScreen(!1)}l(t,e=!0){if(e){const e=t.baseOptions||{};if(t.baseOptions?.modelAssetBuffer&&t.baseOptions?.modelAssetPath)throw Error(\"Cannot set both baseOptions.modelAssetPath and baseOptions.modelAssetBuffer\");if(!(Rn(this.baseOptions,Ms,1)?.g()||Rn(this.baseOptions,Ms,1)?.h()||t.baseOptions?.modelAssetBuffer||t.baseOptions?.modelAssetPath))throw Error(\"Either baseOptions.modelAssetPath or baseOptions.modelAssetBuffer must be set\");if(function(t,e){let n=Rn(t.baseOptions,Fs,3);if(!n){var r=n=new Fs,i=new pi;On(r,4,Rs,i)}\"delegate\"in e&&(\"GPU\"===e.delegate?(e=n,r=new li,On(e,2,Rs,r)):(e=n,r=new pi,On(e,4,Rs,r))),Cn(t.baseOptions,0,3,n)}(this,e),e.modelAssetPath)return fetch(e.modelAssetPath.toString()).then((t=>{if(t.ok)return t.arrayBuffer();throw Error(`Failed to fetch model: ${e.modelAssetPath} (${t.status})`)})).then((t=>{try{this.g.i.FS_unlink(\"/model.dat\")}catch{}this.g.i.FS_createDataFile(\"/\",\"model.dat\",new Uint8Array(t),!0,!1,!1),Qo(this,\"/model.dat\"),this.m(),this.L()}));if(e.modelAssetBuffer instanceof Uint8Array)Qo(this,e.modelAssetBuffer);else if(e.modelAssetBuffer)return async function(t){const e=[];for(var n=0;;){const{done:r,value:i}=await t.read();if(r)break;e.push(i),n+=i.length}if(0===e.length)return new Uint8Array(0);if(1===e.length)return e[0];t=new Uint8Array(n),n=0;for(const r of e)t.set(r,n),n+=r.length;return t}(e.modelAssetBuffer).then((t=>{Qo(this,t),this.m(),this.L()}))}return this.m(),this.L(),Promise.resolve()}L(){}fa(){let t;if(this.g.fa((e=>{t=Bi(e)})),!t)throw Error(\"Failed to retrieve CalculatorGraphConfig\");return t}setGraph(t,e){this.g.attachErrorListener(((t,e)=>{this.K.push(Error(e))})),this.g.Ma(),this.g.setGraph(t,e),this.C=void 0,ta(this)}finishProcessing(){this.g.finishProcessing(),ta(this)}close(){this.C=void 0,this.g.closeGraph()}};function oa(t,e){if(!t)throw Error(`Unable to obtain required WebGL resource: ${e}`);return t}sa.prototype.close=sa.prototype.close,function(e,n){e=e.split(\".\");var r,i=t;e[0]in i||void 0===i.execScript||i.execScript(\"var \"+e[0]);for(;e.length&&(r=e.shift());)e.length||void 0===n?i=i[r]&&i[r]!==Object.prototype[r]?i[r]:i[r]={}:i[r]=n}(\"TaskRunner\",sa);class aa{constructor(t,e,n,r){this.g=t,this.h=e,this.m=n,this.l=r}bind(){this.g.bindVertexArray(this.h)}close(){this.g.deleteVertexArray(this.h),this.g.deleteBuffer(this.m),this.g.deleteBuffer(this.l)}}function ha(t,e,n){const r=t.g;if(n=oa(r.createShader(n),\"Failed to create WebGL shader\"),r.shaderSource(n,e),r.compileShader(n),!r.getShaderParameter(n,r.COMPILE_STATUS))throw Error(`Could not compile WebGL shader: ${r.getShaderInfoLog(n)}`);return r.attachShader(t.h,n),n}function ca(t,e){const n=t.g,r=oa(n.createVertexArray(),\"Failed to create vertex array\");n.bindVertexArray(r);const i=oa(n.createBuffer(),\"Failed to create buffer\");n.bindBuffer(n.ARRAY_BUFFER,i),n.enableVertexAttribArray(t.K),n.vertexAttribPointer(t.K,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),n.STATIC_DRAW);const s=oa(n.createBuffer(),\"Failed to create buffer\");return n.bindBuffer(n.ARRAY_BUFFER,s),n.enableVertexAttribArray(t.J),n.vertexAttribPointer(t.J,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array(e?[0,1,0,0,1,0,1,1]:[0,0,0,1,1,1,1,0]),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),n.bindVertexArray(null),new aa(n,r,i,s)}function ua(t,e){if(t.g){if(e!==t.g)throw Error(\"Cannot change GL context once initialized\")}else t.g=e}function la(t,e,n,r){return ua(t,e),t.h||(t.m(),t.D()),n?(t.v||(t.v=ca(t,!0)),n=t.v):(t.A||(t.A=ca(t,!1)),n=t.A),e.useProgram(t.h),n.bind(),t.l(),t=r(),n.g.bindVertexArray(null),t}function da(t,e,n){return ua(t,e),t=oa(e.createTexture(),\"Failed to create texture\"),e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,n??e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,n??e.LINEAR),e.bindTexture(e.TEXTURE_2D,null),t}function fa(t,e,n){ua(t,e),t.u||(t.u=oa(e.createFramebuffer(),\"Failed to create framebuffe.\")),e.bindFramebuffer(e.FRAMEBUFFER,t.u),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)}function pa(t){t.g?.bindFramebuffer(t.g.FRAMEBUFFER,null)}var ga=class{H(){return\"\\n  precision mediump float;\\n  varying vec2 vTex;\\n  uniform sampler2D inputTexture;\\n  void main() {\\n    gl_FragColor = texture2D(inputTexture, vTex);\\n  }\\n \"}m(){const t=this.g;if(this.h=oa(t.createProgram(),\"Failed to create WebGL program\"),this.ba=ha(this,\"\\n  attribute vec2 aVertex;\\n  attribute vec2 aTex;\\n  varying vec2 vTex;\\n  void main(void) {\\n    gl_Position = vec4(aVertex, 0.0, 1.0);\\n    vTex = aTex;\\n  }\",t.VERTEX_SHADER),this.aa=ha(this,this.H(),t.FRAGMENT_SHADER),t.linkProgram(this.h),!t.getProgramParameter(this.h,t.LINK_STATUS))throw Error(`Error during program linking: ${t.getProgramInfoLog(this.h)}`);this.K=t.getAttribLocation(this.h,\"aVertex\"),this.J=t.getAttribLocation(this.h,\"aTex\")}D(){}l(){}close(){if(this.h){const t=this.g;t.deleteProgram(this.h),t.deleteShader(this.ba),t.deleteShader(this.aa)}this.u&&this.g.deleteFramebuffer(this.u),this.A&&this.A.close(),this.v&&this.v.close()}};var ma=class extends ga{H(){return\"\\n  precision mediump float;\\n  uniform sampler2D backgroundTexture;\\n  uniform sampler2D maskTexture;\\n  uniform sampler2D colorMappingTexture;\\n  varying vec2 vTex;\\n  void main() {\\n    vec4 backgroundColor = texture2D(backgroundTexture, vTex);\\n    float category = texture2D(maskTexture, vTex).r;\\n    vec4 categoryColor = texture2D(colorMappingTexture, vec2(category, 0.0));\\n    gl_FragColor = mix(backgroundColor, categoryColor, categoryColor.a);\\n  }\\n \"}D(){const t=this.g;t.activeTexture(t.TEXTURE1),this.C=da(this,t,t.LINEAR),t.activeTexture(t.TEXTURE2),this.j=da(this,t,t.NEAREST)}m(){super.m();const t=this.g;this.M=oa(t.getUniformLocation(this.h,\"backgroundTexture\"),\"Uniform location\"),this.V=oa(t.getUniformLocation(this.h,\"colorMappingTexture\"),\"Uniform location\"),this.L=oa(t.getUniformLocation(this.h,\"maskTexture\"),\"Uniform location\")}l(){super.l();const t=this.g;t.uniform1i(this.L,0),t.uniform1i(this.M,1),t.uniform1i(this.V,2)}close(){this.C&&this.g.deleteTexture(this.C),this.j&&this.g.deleteTexture(this.j),super.close()}},ya=class extends ga{H(){return\"\\n  precision mediump float;\\n  uniform sampler2D maskTexture;\\n  uniform sampler2D defaultTexture;\\n  uniform sampler2D overlayTexture;\\n  varying vec2 vTex;\\n  void main() {\\n    float confidence = texture2D(maskTexture, vTex).r;\\n    vec4 defaultColor = texture2D(defaultTexture, vTex);\\n    vec4 overlayColor = texture2D(overlayTexture, vTex);\\n    // Apply the alpha from the overlay and merge in the default color\\n    overlayColor = mix(defaultColor, overlayColor, overlayColor.a);\\n    gl_FragColor = mix(defaultColor, overlayColor, confidence);\\n  }\\n \"}D(){const t=this.g;t.activeTexture(t.TEXTURE1),this.j=da(this,t),t.activeTexture(t.TEXTURE2),this.C=da(this,t)}m(){super.m();const t=this.g;this.L=oa(t.getUniformLocation(this.h,\"defaultTexture\"),\"Uniform location\"),this.M=oa(t.getUniformLocation(this.h,\"overlayTexture\"),\"Uniform location\"),this.I=oa(t.getUniformLocation(this.h,\"maskTexture\"),\"Uniform location\")}l(){super.l();const t=this.g;t.uniform1i(this.I,0),t.uniform1i(this.L,1),t.uniform1i(this.M,2)}close(){this.j&&this.g.deleteTexture(this.j),this.C&&this.g.deleteTexture(this.C),super.close()}};function _a(t,e){switch(e){case 0:return t.g.find((t=>t instanceof Uint8Array));case 1:return t.g.find((t=>t instanceof Float32Array));case 2:return t.g.find((t=>\"undefined\"!=typeof WebGLTexture&&t instanceof WebGLTexture));default:throw Error(`Type is not supported: ${e}`)}}function va(t){var e=_a(t,1);if(!e){if(e=_a(t,0))e=new Float32Array(e).map((t=>t/255));else{e=new Float32Array(t.width*t.height);const r=wa(t);var n=Aa(t);if(fa(n,r,Ea(t)),\"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod\".split(\";\").includes(navigator.platform)||navigator.userAgent.includes(\"Mac\")&&\"ontouchend\"in self.document){n=new Float32Array(t.width*t.height*4),r.readPixels(0,0,t.width,t.height,r.RGBA,r.FLOAT,n);for(let t=0,r=0;t<e.length;++t,r+=4)e[t]=n[r]}else r.readPixels(0,0,t.width,t.height,r.RED,r.FLOAT,e)}t.g.push(e)}return e}function Ea(t){let e=_a(t,2);if(!e){const n=wa(t);e=ba(t);const r=va(t),i=Ta(t);n.texImage2D(n.TEXTURE_2D,0,i,t.width,t.height,0,n.RED,n.FLOAT,r),ka(t)}return e}function wa(t){if(!t.canvas)throw Error(\"Conversion to different image formats require that a canvas is passed when initializing the image.\");return t.h||(t.h=oa(t.canvas.getContext(\"webgl2\"),\"You cannot use a canvas that is already bound to a different type of rendering context.\")),t.h}function Ta(t){if(t=wa(t),!xa)if(t.getExtension(\"EXT_color_buffer_float\")&&t.getExtension(\"OES_texture_float_linear\")&&t.getExtension(\"EXT_float_blend\"))xa=t.R32F;else{if(!t.getExtension(\"EXT_color_buffer_half_float\"))throw Error(\"GPU does not fully support 4-channel float32 or float16 formats\");xa=t.R16F}return xa}function Aa(t){return t.l||(t.l=new ga),t.l}function ba(t){const e=wa(t);e.viewport(0,0,t.width,t.height),e.activeTexture(e.TEXTURE0);let n=_a(t,2);return n||(n=da(Aa(t),e,t.m?e.LINEAR:e.NEAREST),t.g.push(n),t.j=!0),e.bindTexture(e.TEXTURE_2D,n),n}function ka(t){t.h.bindTexture(t.h.TEXTURE_2D,null)}var xa,Sa=class{constructor(t,e,n,r,i,s,o){this.g=t,this.m=e,this.j=n,this.canvas=r,this.l=i,this.width=s,this.height=o,this.j&&(0===--La&&console.error(\"You seem to be creating MPMask instances without invoking .close(). This leaks resources.\"))}Ha(){return!!_a(this,0)}la(){return!!_a(this,1)}R(){return!!_a(this,2)}ka(){return(e=_a(t=this,0))||(e=va(t),e=new Uint8Array(e.map((t=>255*t))),t.g.push(e)),e;var t,e}ja(){return va(this)}O(){return Ea(this)}clone(){const t=[];for(const e of this.g){let n;if(e instanceof Uint8Array)n=new Uint8Array(e);else if(e instanceof Float32Array)n=new Float32Array(e);else{if(!(e instanceof WebGLTexture))throw Error(`Type is not supported: ${e}`);{const t=wa(this),e=Aa(this);t.activeTexture(t.TEXTURE1),n=da(e,t,this.m?t.LINEAR:t.NEAREST),t.bindTexture(t.TEXTURE_2D,n);const r=Ta(this);t.texImage2D(t.TEXTURE_2D,0,r,this.width,this.height,0,t.RED,t.FLOAT,null),t.bindTexture(t.TEXTURE_2D,null),fa(e,t,n),la(e,t,!1,(()=>{ba(this),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),t.drawArrays(t.TRIANGLE_FAN,0,4),ka(this)})),pa(e),ka(this)}}t.push(n)}return new Sa(t,this.m,this.R(),this.canvas,this.l,this.width,this.height)}close(){this.j&&wa(this).deleteTexture(_a(this,2)),La=-1}};Sa.prototype.close=Sa.prototype.close,Sa.prototype.clone=Sa.prototype.clone,Sa.prototype.getAsWebGLTexture=Sa.prototype.O,Sa.prototype.getAsFloat32Array=Sa.prototype.ja,Sa.prototype.getAsUint8Array=Sa.prototype.ka,Sa.prototype.hasWebGLTexture=Sa.prototype.R,Sa.prototype.hasFloat32Array=Sa.prototype.la,Sa.prototype.hasUint8Array=Sa.prototype.Ha;var La=250;const Fa={color:\"white\",lineWidth:4,radius:6};function Ra(t){return{...Fa,fillColor:(t=t||{}).color,...t}}function Ma(t,e){return t instanceof Function?t(e):t}function Pa(t,e,n){return Math.max(Math.min(e,n),Math.min(Math.max(e,n),t))}function Ca(t){if(!t.l)throw Error(\"CPU rendering requested but CanvasRenderingContext2D not provided.\");return t.l}function Oa(t){if(!t.j)throw Error(\"GPU rendering requested but WebGL2RenderingContext not provided.\");return t.j}function Ia(t,e,n){if(e.R())n(e.O());else{const r=e.la()?e.ja():e.ka();t.m=t.m??new ga;const i=Oa(t);n((t=new Sa([r],e.m,!1,i.canvas,t.m,e.width,e.height)).O()),t.close()}}function Ua(t,e,n,r){const i=function(t){return t.g||(t.g=new ma),t.g}(t),s=Oa(t),o=Array.isArray(n)?new ImageData(new Uint8ClampedArray(n),1,1):n;la(i,s,!0,(()=>{!function(t,e,n,r){const i=t.g;if(i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,e),i.activeTexture(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,t.C),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,n),t.I&&function(t,e){if(t!==e)return!1;t=t.entries(),e=e.entries();for(const[r,i]of t){t=r;const s=i;var n=e.next();if(n.done)return!1;const[o,a]=n.value;if(n=a,t!==o||s[0]!==n[0]||s[1]!==n[1]||s[2]!==n[2]||s[3]!==n[3])return!1}return!!e.next().done}(t.I,r))i.activeTexture(i.TEXTURE2),i.bindTexture(i.TEXTURE_2D,t.j);else{t.I=r;const e=Array(1024).fill(0);r.forEach(((t,n)=>{if(4!==t.length)throw Error(`Color at index ${n} is not a four-channel value.`);e[4*n]=t[0],e[4*n+1]=t[1],e[4*n+2]=t[2],e[4*n+3]=t[3]})),i.activeTexture(i.TEXTURE2),i.bindTexture(i.TEXTURE_2D,t.j),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,256,1,0,i.RGBA,i.UNSIGNED_BYTE,new Uint8Array(e))}}(i,e,o,r),s.clearColor(0,0,0,0),s.clear(s.COLOR_BUFFER_BIT),s.drawArrays(s.TRIANGLE_FAN,0,4);const t=i.g;t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,null),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,null),t.activeTexture(t.TEXTURE2),t.bindTexture(t.TEXTURE_2D,null)}))}function Da(t,e,n,r){const i=Oa(t),s=function(t){return t.h||(t.h=new ya),t.h}(t),o=Array.isArray(n)?new ImageData(new Uint8ClampedArray(n),1,1):n,a=Array.isArray(r)?new ImageData(new Uint8ClampedArray(r),1,1):r;la(s,i,!0,(()=>{var t=s.g;t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,e),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,s.j),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,o),t.activeTexture(t.TEXTURE2),t.bindTexture(t.TEXTURE_2D,s.C),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,a),i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),i.drawArrays(i.TRIANGLE_FAN,0,4),i.bindTexture(i.TEXTURE_2D,null),(t=s.g).activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,null),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,null),t.activeTexture(t.TEXTURE2),t.bindTexture(t.TEXTURE_2D,null)}))}var Na=class{constructor(t,e){t instanceof CanvasRenderingContext2D||t instanceof OffscreenCanvasRenderingContext2D?(this.l=t,this.j=e):this.j=t}Aa(t,e){if(t){var n=Ca(this);e=Ra(e),n.save();var r=n.canvas,i=0;for(const s of t)n.fillStyle=Ma(e.fillColor,{index:i,from:s}),n.strokeStyle=Ma(e.color,{index:i,from:s}),n.lineWidth=Ma(e.lineWidth,{index:i,from:s}),(t=new Path2D).arc(s.x*r.width,s.y*r.height,Ma(e.radius,{index:i,from:s}),0,2*Math.PI),n.fill(t),n.stroke(t),++i;n.restore()}}za(t,e,n){if(t&&e){var r=Ca(this);n=Ra(n),r.save();var i=r.canvas,s=0;for(const o of e){r.beginPath(),e=t[o.start];const a=t[o.end];e&&a&&(r.strokeStyle=Ma(n.color,{index:s,from:e,to:a}),r.lineWidth=Ma(n.lineWidth,{index:s,from:e,to:a}),r.moveTo(e.x*i.width,e.y*i.height),r.lineTo(a.x*i.width,a.y*i.height)),++s,r.stroke()}r.restore()}}wa(t,e){const n=Ca(this);e=Ra(e),n.save(),n.beginPath(),n.lineWidth=Ma(e.lineWidth,{}),n.strokeStyle=Ma(e.color,{}),n.fillStyle=Ma(e.fillColor,{}),n.moveTo(t.originX,t.originY),n.lineTo(t.originX+t.width,t.originY),n.lineTo(t.originX+t.width,t.originY+t.height),n.lineTo(t.originX,t.originY+t.height),n.lineTo(t.originX,t.originY),n.stroke(),n.fill(),n.restore()}xa(t,e,n=[0,0,0,255]){this.l?function(t,e,n,r){const i=Oa(t);Ia(t,e,(e=>{Ua(t,e,n,r),(e=Ca(t)).drawImage(i.canvas,0,0,e.canvas.width,e.canvas.height)}))}(this,t,n,e):Ua(this,t.O(),n,e)}ya(t,e,n){this.l?function(t,e,n,r){const i=Oa(t);Ia(t,e,(e=>{Da(t,e,n,r),(e=Ca(t)).drawImage(i.canvas,0,0,e.canvas.width,e.canvas.height)}))}(this,t,e,n):Da(this,t.O(),e,n)}close(){this.g?.close(),this.g=void 0,this.h?.close(),this.h=void 0,this.m?.close(),this.m=void 0}};function Ba(t,e){switch(e){case 0:return t.g.find((t=>t instanceof ImageData));case 1:return t.g.find((t=>\"undefined\"!=typeof ImageBitmap&&t instanceof ImageBitmap));case 2:return t.g.find((t=>\"undefined\"!=typeof WebGLTexture&&t instanceof WebGLTexture));default:throw Error(`Type is not supported: ${e}`)}}function Ga(t){var e=Ba(t,0);if(!e){e=Va(t);const n=Xa(t),r=new Uint8Array(t.width*t.height*4);fa(n,e,ja(t)),e.readPixels(0,0,t.width,t.height,e.RGBA,e.UNSIGNED_BYTE,r),pa(n),e=new ImageData(new Uint8ClampedArray(r.buffer),t.width,t.height),t.g.push(e)}return e}function ja(t){let e=Ba(t,2);if(!e){const n=Va(t);e=Ha(t);const r=Ba(t,1)||Ga(t);n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,r),Wa(t)}return e}function Va(t){if(!t.canvas)throw Error(\"Conversion to different image formats require that a canvas is passed when iniitializing the image.\");return t.h||(t.h=oa(t.canvas.getContext(\"webgl2\"),\"You cannot use a canvas that is already bound to a different type of rendering context.\")),t.h}function Xa(t){return t.l||(t.l=new ga),t.l}function Ha(t){const e=Va(t);e.viewport(0,0,t.width,t.height),e.activeTexture(e.TEXTURE0);let n=Ba(t,2);return n||(n=da(Xa(t),e),t.g.push(n),t.m=!0),e.bindTexture(e.TEXTURE_2D,n),n}function Wa(t){t.h.bindTexture(t.h.TEXTURE_2D,null)}function za(t){const e=Va(t);return la(Xa(t),e,!0,(()=>function(t,e){const n=t.canvas;if(n.width===t.width&&n.height===t.height)return e();const r=n.width,i=n.height;return n.width=t.width,n.height=t.height,t=e(),n.width=r,n.height=i,t}(t,(()=>{if(e.bindFramebuffer(e.FRAMEBUFFER,null),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.drawArrays(e.TRIANGLE_FAN,0,4),!(t.canvas instanceof OffscreenCanvas))throw Error(\"Conversion to ImageBitmap requires that the MediaPipe Tasks is initialized with an OffscreenCanvas\");return t.canvas.transferToImageBitmap()}))))}Na.prototype.close=Na.prototype.close,Na.prototype.drawConfidenceMask=Na.prototype.ya,Na.prototype.drawCategoryMask=Na.prototype.xa,Na.prototype.drawBoundingBox=Na.prototype.wa,Na.prototype.drawConnectors=Na.prototype.za,Na.prototype.drawLandmarks=Na.prototype.Aa,Na.lerp=function(t,e,n,r,i){return Pa(r*(1-(t-e)/(n-e))+i*(1-(n-t)/(n-e)),r,i)},Na.clamp=Pa;var Ka=class{constructor(t,e,n,r,i,s,o){this.g=t,this.j=e,this.m=n,this.canvas=r,this.l=i,this.width=s,this.height=o,(this.j||this.m)&&(0===--Ya&&console.error(\"You seem to be creating MPImage instances without invoking .close(). This leaks resources.\"))}Ga(){return!!Ba(this,0)}ma(){return!!Ba(this,1)}R(){return!!Ba(this,2)}Ea(){return Ga(this)}Da(){var t=Ba(this,1);return t||(ja(this),Ha(this),t=za(this),Wa(this),this.g.push(t),this.j=!0),t}O(){return ja(this)}clone(){const t=[];for(const e of this.g){let n;if(e instanceof ImageData)n=new ImageData(e.data,this.width,this.height);else if(e instanceof WebGLTexture){const t=Va(this),e=Xa(this);t.activeTexture(t.TEXTURE1),n=da(e,t),t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,null),t.bindTexture(t.TEXTURE_2D,null),fa(e,t,n),la(e,t,!1,(()=>{Ha(this),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),t.drawArrays(t.TRIANGLE_FAN,0,4),Wa(this)})),pa(e),Wa(this)}else{if(!(e instanceof ImageBitmap))throw Error(`Type is not supported: ${e}`);ja(this),Ha(this),n=za(this),Wa(this)}t.push(n)}return new Ka(t,this.ma(),this.R(),this.canvas,this.l,this.width,this.height)}close(){this.j&&Ba(this,1).close(),this.m&&Va(this).deleteTexture(Ba(this,2)),Ya=-1}};Ka.prototype.close=Ka.prototype.close,Ka.prototype.clone=Ka.prototype.clone,Ka.prototype.getAsWebGLTexture=Ka.prototype.O,Ka.prototype.getAsImageBitmap=Ka.prototype.Da,Ka.prototype.getAsImageData=Ka.prototype.Ea,Ka.prototype.hasWebGLTexture=Ka.prototype.R,Ka.prototype.hasImageBitmap=Ka.prototype.ma,Ka.prototype.hasImageData=Ka.prototype.Ga;var Ya=250;function $a(...t){return t.map((([t,e])=>({start:t,end:e})))}const qa=function(t){return class extends t{Ma(){this.i._registerModelResourcesGraphService()}}}((Ja=class{constructor(t,e){this.l=!0,this.i=t,this.g=null,this.h=0,this.m=\"function\"==typeof this.i._addIntToInputStream,void 0!==e?this.i.canvas=e:Ho()?this.i.canvas=new OffscreenCanvas(1,1):(console.warn(\"OffscreenCanvas not supported and GraphRunner constructor glCanvas parameter is undefined. Creating backup canvas.\"),this.i.canvas=document.createElement(\"canvas\"))}async initializeGraph(t){const e=await(await fetch(t)).arrayBuffer();t=!(t.endsWith(\".pbtxt\")||t.endsWith(\".textproto\")),this.setGraph(new Uint8Array(e),t)}setGraphFromString(t){this.setGraph((new TextEncoder).encode(t),!1)}setGraph(t,e){const n=t.length,r=this.i._malloc(n);this.i.HEAPU8.set(t,r),e?this.i._changeBinaryGraph(n,r):this.i._changeTextGraph(n,r),this.i._free(r)}configureAudio(t,e,n,r,i){this.i._configureAudio||console.warn('Attempting to use configureAudio without support for input audio. Is build dep \":gl_graph_runner_audio\" missing?'),Ko(this,r||\"input_audio\",(r=>{Ko(this,i=i||\"audio_header\",(i=>{this.i._configureAudio(r,i,t,e,n)}))}))}setAutoResizeCanvas(t){this.l=t}setAutoRenderToScreen(t){this.i._setAutoRenderToScreen(t)}setGpuBufferVerticalFlip(t){this.i.gpuOriginForWebTexturesIsBottomLeft=t}fa(t){qo(this,\"__graph_config__\",(e=>{t(e)})),Ko(this,\"__graph_config__\",(t=>{this.i._getGraphConfig(t,void 0)})),delete this.i.simpleListeners.__graph_config__}attachErrorListener(t){this.i.errorListener=t}attachEmptyPacketListener(t,e){this.i.emptyPacketListeners=this.i.emptyPacketListeners||{},this.i.emptyPacketListeners[t]=e}addAudioToStream(t,e,n){this.addAudioToStreamWithShape(t,0,0,e,n)}addAudioToStreamWithShape(t,e,n,r,i){const s=4*t.length;this.h!==s&&(this.g&&this.i._free(this.g),this.g=this.i._malloc(s),this.h=s),this.i.HEAPF32.set(t,this.g/4),Ko(this,r,(t=>{this.i._addAudioToInputStream(this.g,e,n,t,i)}))}addGpuBufferToStream(t,e,n){Ko(this,e,(e=>{const[r,i]=Yo(this,t,e);this.i._addBoundTextureToStream(e,r,i,n)}))}addBoolToStream(t,e,n){Ko(this,e,(e=>{this.i._addBoolToInputStream(t,e,n)}))}addDoubleToStream(t,e,n){Ko(this,e,(e=>{this.i._addDoubleToInputStream(t,e,n)}))}addFloatToStream(t,e,n){Ko(this,e,(e=>{this.i._addFloatToInputStream(t,e,n)}))}addIntToStream(t,e,n){Ko(this,e,(e=>{this.i._addIntToInputStream(t,e,n)}))}addUintToStream(t,e,n){Ko(this,e,(e=>{this.i._addUintToInputStream(t,e,n)}))}addStringToStream(t,e,n){Ko(this,e,(e=>{Ko(this,t,(t=>{this.i._addStringToInputStream(t,e,n)}))}))}addStringRecordToStream(t,e,n){Ko(this,e,(e=>{$o(this,Object.keys(t),(r=>{$o(this,Object.values(t),(i=>{this.i._addFlatHashMapToInputStream(r,i,Object.keys(t).length,e,n)}))}))}))}addProtoToStream(t,e,n,r){Ko(this,n,(n=>{Ko(this,e,(e=>{const i=this.i._malloc(t.length);this.i.HEAPU8.set(t,i),this.i._addProtoToInputStream(i,t.length,e,n,r),this.i._free(i)}))}))}addEmptyPacketToStream(t,e){Ko(this,t,(t=>{this.i._addEmptyPacketToInputStream(t,e)}))}addBoolVectorToStream(t,e,n){Ko(this,e,(e=>{const r=this.i._allocateBoolVector(t.length);if(!r)throw Error(\"Unable to allocate new bool vector on heap.\");for(const e of t)this.i._addBoolVectorEntry(r,e);this.i._addBoolVectorToInputStream(r,e,n)}))}addDoubleVectorToStream(t,e,n){Ko(this,e,(e=>{const r=this.i._allocateDoubleVector(t.length);if(!r)throw Error(\"Unable to allocate new double vector on heap.\");for(const e of t)this.i._addDoubleVectorEntry(r,e);this.i._addDoubleVectorToInputStream(r,e,n)}))}addFloatVectorToStream(t,e,n){Ko(this,e,(e=>{const r=this.i._allocateFloatVector(t.length);if(!r)throw Error(\"Unable to allocate new float vector on heap.\");for(const e of t)this.i._addFloatVectorEntry(r,e);this.i._addFloatVectorToInputStream(r,e,n)}))}addIntVectorToStream(t,e,n){Ko(this,e,(e=>{const r=this.i._allocateIntVector(t.length);if(!r)throw Error(\"Unable to allocate new int vector on heap.\");for(const e of t)this.i._addIntVectorEntry(r,e);this.i._addIntVectorToInputStream(r,e,n)}))}addUintVectorToStream(t,e,n){Ko(this,e,(e=>{const r=this.i._allocateUintVector(t.length);if(!r)throw Error(\"Unable to allocate new unsigned int vector on heap.\");for(const e of t)this.i._addUintVectorEntry(r,e);this.i._addUintVectorToInputStream(r,e,n)}))}addStringVectorToStream(t,e,n){Ko(this,e,(e=>{const r=this.i._allocateStringVector(t.length);if(!r)throw Error(\"Unable to allocate new string vector on heap.\");for(const e of t)Ko(this,e,(t=>{this.i._addStringVectorEntry(r,t)}));this.i._addStringVectorToInputStream(r,e,n)}))}addBoolToInputSidePacket(t,e){Ko(this,e,(e=>{this.i._addBoolToInputSidePacket(t,e)}))}addDoubleToInputSidePacket(t,e){Ko(this,e,(e=>{this.i._addDoubleToInputSidePacket(t,e)}))}addFloatToInputSidePacket(t,e){Ko(this,e,(e=>{this.i._addFloatToInputSidePacket(t,e)}))}addIntToInputSidePacket(t,e){Ko(this,e,(e=>{this.i._addIntToInputSidePacket(t,e)}))}addUintToInputSidePacket(t,e){Ko(this,e,(e=>{this.i._addUintToInputSidePacket(t,e)}))}addStringToInputSidePacket(t,e){Ko(this,e,(e=>{Ko(this,t,(t=>{this.i._addStringToInputSidePacket(t,e)}))}))}addProtoToInputSidePacket(t,e,n){Ko(this,n,(n=>{Ko(this,e,(e=>{const r=this.i._malloc(t.length);this.i.HEAPU8.set(t,r),this.i._addProtoToInputSidePacket(r,t.length,e,n),this.i._free(r)}))}))}addBoolVectorToInputSidePacket(t,e){Ko(this,e,(e=>{const n=this.i._allocateBoolVector(t.length);if(!n)throw Error(\"Unable to allocate new bool vector on heap.\");for(const e of t)this.i._addBoolVectorEntry(n,e);this.i._addBoolVectorToInputSidePacket(n,e)}))}addDoubleVectorToInputSidePacket(t,e){Ko(this,e,(e=>{const n=this.i._allocateDoubleVector(t.length);if(!n)throw Error(\"Unable to allocate new double vector on heap.\");for(const e of t)this.i._addDoubleVectorEntry(n,e);this.i._addDoubleVectorToInputSidePacket(n,e)}))}addFloatVectorToInputSidePacket(t,e){Ko(this,e,(e=>{const n=this.i._allocateFloatVector(t.length);if(!n)throw Error(\"Unable to allocate new float vector on heap.\");for(const e of t)this.i._addFloatVectorEntry(n,e);this.i._addFloatVectorToInputSidePacket(n,e)}))}addIntVectorToInputSidePacket(t,e){Ko(this,e,(e=>{const n=this.i._allocateIntVector(t.length);if(!n)throw Error(\"Unable to allocate new int vector on heap.\");for(const e of t)this.i._addIntVectorEntry(n,e);this.i._addIntVectorToInputSidePacket(n,e)}))}addUintVectorToInputSidePacket(t,e){Ko(this,e,(e=>{const n=this.i._allocateUintVector(t.length);if(!n)throw Error(\"Unable to allocate new unsigned int vector on heap.\");for(const e of t)this.i._addUintVectorEntry(n,e);this.i._addUintVectorToInputSidePacket(n,e)}))}addStringVectorToInputSidePacket(t,e){Ko(this,e,(e=>{const n=this.i._allocateStringVector(t.length);if(!n)throw Error(\"Unable to allocate new string vector on heap.\");for(const e of t)Ko(this,e,(t=>{this.i._addStringVectorEntry(n,t)}));this.i._addStringVectorToInputSidePacket(n,e)}))}attachBoolListener(t,e){qo(this,t,e),Ko(this,t,(t=>{this.i._attachBoolListener(t)}))}attachBoolVectorListener(t,e){Jo(this,t,e),Ko(this,t,(t=>{this.i._attachBoolVectorListener(t)}))}attachIntListener(t,e){qo(this,t,e),Ko(this,t,(t=>{this.i._attachIntListener(t)}))}attachIntVectorListener(t,e){Jo(this,t,e),Ko(this,t,(t=>{this.i._attachIntVectorListener(t)}))}attachUintListener(t,e){qo(this,t,e),Ko(this,t,(t=>{this.i._attachUintListener(t)}))}attachUintVectorListener(t,e){Jo(this,t,e),Ko(this,t,(t=>{this.i._attachUintVectorListener(t)}))}attachDoubleListener(t,e){qo(this,t,e),Ko(this,t,(t=>{this.i._attachDoubleListener(t)}))}attachDoubleVectorListener(t,e){Jo(this,t,e),Ko(this,t,(t=>{this.i._attachDoubleVectorListener(t)}))}attachFloatListener(t,e){qo(this,t,e),Ko(this,t,(t=>{this.i._attachFloatListener(t)}))}attachFloatVectorListener(t,e){Jo(this,t,e),Ko(this,t,(t=>{this.i._attachFloatVectorListener(t)}))}attachStringListener(t,e){qo(this,t,e),Ko(this,t,(t=>{this.i._attachStringListener(t)}))}attachStringVectorListener(t,e){Jo(this,t,e),Ko(this,t,(t=>{this.i._attachStringVectorListener(t)}))}attachProtoListener(t,e,n){qo(this,t,e),Ko(this,t,(t=>{this.i._attachProtoListener(t,n||!1)}))}attachProtoVectorListener(t,e,n){Jo(this,t,e),Ko(this,t,(t=>{this.i._attachProtoVectorListener(t,n||!1)}))}attachAudioListener(t,e,n){this.i._attachAudioListener||console.warn('Attempting to use attachAudioListener without support for output audio. Is build dep \":gl_graph_runner_audio_out\" missing?'),qo(this,t,((t,n)=>{t=new Float32Array(t.buffer,t.byteOffset,t.length/4),e(t,n)})),Ko(this,t,(t=>{this.i._attachAudioListener(t,n||!1)}))}finishProcessing(){this.i._waitUntilIdle()}closeGraph(){this.i._closeGraph(),this.i.simpleListeners=void 0,this.i.emptyPacketListeners=void 0}},class extends Ja{get ha(){return this.i}sa(t,e,n){Ko(this,e,(e=>{const[r,i]=Yo(this,t,e);this.ha._addBoundTextureAsImageToStream(e,r,i,n)}))}W(t,e){qo(this,t,e),Ko(this,t,(t=>{this.ha._attachImageListener(t)}))}da(t,e){Jo(this,t,e),Ko(this,t,(t=>{this.ha._attachImageVectorListener(t)}))}}));var Ja,Za=class extends qa{};async function Qa(t,e,n){return async function(t,e,n,r){return Zo(t,e,n,r)}(t,n.canvas??(Ho()?void 0:document.createElement(\"canvas\")),e,n)}function th(t,e,n,r){if(t.V){const s=new fs;if(n?.regionOfInterest){if(!t.ra)throw Error(\"This task doesn't support region-of-interest.\");var i=n.regionOfInterest;if(i.left>=i.right||i.top>=i.bottom)throw Error(\"Expected RectF with left < right and top < bottom.\");if(0>i.left||0>i.top||1<i.right||1<i.bottom)throw Error(\"Expected RectF values to be in [0,1].\");Hn(s,1,(i.left+i.right)/2),Hn(s,2,(i.top+i.bottom)/2),Hn(s,4,i.right-i.left),Hn(s,3,i.bottom-i.top)}else Hn(s,1,.5),Hn(s,2,.5),Hn(s,4,1),Hn(s,3,1);if(n?.rotationDegrees){if(0!=n?.rotationDegrees%90)throw Error(\"Expected rotation to be a multiple of 90°.\");if(Hn(s,5,-Math.PI*n.rotationDegrees/180),0!=n?.rotationDegrees%180){const[t,r]=zo(e);n=Gn(s,3)*r/t,i=Gn(s,4)*t/r,Hn(s,4,n),Hn(s,3,i)}}t.g.addProtoToStream(s.g(),\"mediapipe.NormalizedRect\",t.V,r)}t.g.sa(e,t.ba,r??performance.now()),t.finishProcessing()}function eh(t,e,n){if(t.baseOptions?.g())throw Error(\"Task is not initialized with image mode. 'runningMode' must be set to 'IMAGE'.\");th(t,e,n,t.J+1)}function nh(t,e,n,r){if(!t.baseOptions?.g())throw Error(\"Task is not initialized with video mode. 'runningMode' must be set to 'VIDEO'.\");th(t,e,n,r)}function rh(t,e,n,r){var i=e.data;const s=e.width,o=s*(e=e.height);if((i instanceof Uint8Array||i instanceof Float32Array)&&i.length!==o)throw Error(\"Unsupported channel count: \"+i.length/o);return t=new Sa([i],n,!1,t.g.i.canvas,t.M,s,e),r?t.clone():t}var ih=class extends sa{constructor(t,e,n,r){super(t),this.g=t,this.ba=e,this.V=n,this.ra=r,this.M=new ga}l(t,e=!0){if(\"runningMode\"in t&&Vn(this.baseOptions,2,!!t.runningMode&&\"IMAGE\"!==t.runningMode),void 0!==t.canvas&&this.g.i.canvas!==t.canvas)throw Error(\"You must create a new task to reset the canvas.\");return super.l(t,e)}close(){this.M.close(),super.close()}};ih.prototype.close=ih.prototype.close;var sh=class extends ih{constructor(t,e){super(new Za(t,e),\"image_in\",\"norm_rect_in\",!1),this.j={detections:[]},Cn(t=this.h=new Is,0,1,e=new Cs),Hn(this.h,2,.5),Hn(this.h,3,.3)}get baseOptions(){return Rn(this.h,Cs,1)}set baseOptions(t){Cn(this.h,0,1,t)}o(t){return\"minDetectionConfidence\"in t&&Hn(this.h,2,t.minDetectionConfidence??.5),\"minSuppressionThreshold\"in t&&Hn(this.h,3,t.minSuppressionThreshold??.3),this.l(t)}F(t,e){return this.j={detections:[]},eh(this,t,e),this.j}G(t,e,n){return this.j={detections:[]},nh(this,t,n,e),this.j}m(){var t=new Di;Ii(t,\"image_in\"),Ii(t,\"norm_rect_in\"),Ui(t,\"detections\");const e=new yi;Wn(e,Ds,this.h);const n=new Li;ki(n,\"mediapipe.tasks.vision.face_detector.FaceDetectorGraph\"),xi(n,\"IMAGE:image_in\"),xi(n,\"NORM_RECT:norm_rect_in\"),Si(n,\"DETECTIONS:detections\"),n.o(e),Oi(t,n),this.g.attachProtoVectorListener(\"detections\",((t,e)=>{for(const e of t)t=ns(e),this.j.detections.push(Oo(t));ea(this,e)})),this.g.attachEmptyPacketListener(\"detections\",(t=>{ea(this,t)})),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};sh.prototype.detectForVideo=sh.prototype.G,sh.prototype.detect=sh.prototype.F,sh.prototype.setOptions=sh.prototype.o,sh.createFromModelPath=async function(t,e){return Qa(sh,t,{baseOptions:{modelAssetPath:e}})},sh.createFromModelBuffer=function(t,e){return Qa(sh,t,{baseOptions:{modelAssetBuffer:e}})},sh.createFromOptions=function(t,e){return Qa(sh,t,e)};var oh=$a([61,146],[146,91],[91,181],[181,84],[84,17],[17,314],[314,405],[405,321],[321,375],[375,291],[61,185],[185,40],[40,39],[39,37],[37,0],[0,267],[267,269],[269,270],[270,409],[409,291],[78,95],[95,88],[88,178],[178,87],[87,14],[14,317],[317,402],[402,318],[318,324],[324,308],[78,191],[191,80],[80,81],[81,82],[82,13],[13,312],[312,311],[311,310],[310,415],[415,308]),ah=$a([263,249],[249,390],[390,373],[373,374],[374,380],[380,381],[381,382],[382,362],[263,466],[466,388],[388,387],[387,386],[386,385],[385,384],[384,398],[398,362]),hh=$a([276,283],[283,282],[282,295],[295,285],[300,293],[293,334],[334,296],[296,336]),ch=$a([474,475],[475,476],[476,477],[477,474]),uh=$a([33,7],[7,163],[163,144],[144,145],[145,153],[153,154],[154,155],[155,133],[33,246],[246,161],[161,160],[160,159],[159,158],[158,157],[157,173],[173,133]),lh=$a([46,53],[53,52],[52,65],[65,55],[70,63],[63,105],[105,66],[66,107]),dh=$a([469,470],[470,471],[471,472],[472,469]),fh=$a([10,338],[338,297],[297,332],[332,284],[284,251],[251,389],[389,356],[356,454],[454,323],[323,361],[361,288],[288,397],[397,365],[365,379],[379,378],[378,400],[400,377],[377,152],[152,148],[148,176],[176,149],[149,150],[150,136],[136,172],[172,58],[58,132],[132,93],[93,234],[234,127],[127,162],[162,21],[21,54],[54,103],[103,67],[67,109],[109,10]),ph=[...oh,...ah,...hh,...uh,...lh,...fh],gh=$a([127,34],[34,139],[139,127],[11,0],[0,37],[37,11],[232,231],[231,120],[120,232],[72,37],[37,39],[39,72],[128,121],[121,47],[47,128],[232,121],[121,128],[128,232],[104,69],[69,67],[67,104],[175,171],[171,148],[148,175],[118,50],[50,101],[101,118],[73,39],[39,40],[40,73],[9,151],[151,108],[108,9],[48,115],[115,131],[131,48],[194,204],[204,211],[211,194],[74,40],[40,185],[185,74],[80,42],[42,183],[183,80],[40,92],[92,186],[186,40],[230,229],[229,118],[118,230],[202,212],[212,214],[214,202],[83,18],[18,17],[17,83],[76,61],[61,146],[146,76],[160,29],[29,30],[30,160],[56,157],[157,173],[173,56],[106,204],[204,194],[194,106],[135,214],[214,192],[192,135],[203,165],[165,98],[98,203],[21,71],[71,68],[68,21],[51,45],[45,4],[4,51],[144,24],[24,23],[23,144],[77,146],[146,91],[91,77],[205,50],[50,187],[187,205],[201,200],[200,18],[18,201],[91,106],[106,182],[182,91],[90,91],[91,181],[181,90],[85,84],[84,17],[17,85],[206,203],[203,36],[36,206],[148,171],[171,140],[140,148],[92,40],[40,39],[39,92],[193,189],[189,244],[244,193],[159,158],[158,28],[28,159],[247,246],[246,161],[161,247],[236,3],[3,196],[196,236],[54,68],[68,104],[104,54],[193,168],[168,8],[8,193],[117,228],[228,31],[31,117],[189,193],[193,55],[55,189],[98,97],[97,99],[99,98],[126,47],[47,100],[100,126],[166,79],[79,218],[218,166],[155,154],[154,26],[26,155],[209,49],[49,131],[131,209],[135,136],[136,150],[150,135],[47,126],[126,217],[217,47],[223,52],[52,53],[53,223],[45,51],[51,134],[134,45],[211,170],[170,140],[140,211],[67,69],[69,108],[108,67],[43,106],[106,91],[91,43],[230,119],[119,120],[120,230],[226,130],[130,247],[247,226],[63,53],[53,52],[52,63],[238,20],[20,242],[242,238],[46,70],[70,156],[156,46],[78,62],[62,96],[96,78],[46,53],[53,63],[63,46],[143,34],[34,227],[227,143],[123,117],[117,111],[111,123],[44,125],[125,19],[19,44],[236,134],[134,51],[51,236],[216,206],[206,205],[205,216],[154,153],[153,22],[22,154],[39,37],[37,167],[167,39],[200,201],[201,208],[208,200],[36,142],[142,100],[100,36],[57,212],[212,202],[202,57],[20,60],[60,99],[99,20],[28,158],[158,157],[157,28],[35,226],[226,113],[113,35],[160,159],[159,27],[27,160],[204,202],[202,210],[210,204],[113,225],[225,46],[46,113],[43,202],[202,204],[204,43],[62,76],[76,77],[77,62],[137,123],[123,116],[116,137],[41,38],[38,72],[72,41],[203,129],[129,142],[142,203],[64,98],[98,240],[240,64],[49,102],[102,64],[64,49],[41,73],[73,74],[74,41],[212,216],[216,207],[207,212],[42,74],[74,184],[184,42],[169,170],[170,211],[211,169],[170,149],[149,176],[176,170],[105,66],[66,69],[69,105],[122,6],[6,168],[168,122],[123,147],[147,187],[187,123],[96,77],[77,90],[90,96],[65,55],[55,107],[107,65],[89,90],[90,180],[180,89],[101,100],[100,120],[120,101],[63,105],[105,104],[104,63],[93,137],[137,227],[227,93],[15,86],[86,85],[85,15],[129,102],[102,49],[49,129],[14,87],[87,86],[86,14],[55,8],[8,9],[9,55],[100,47],[47,121],[121,100],[145,23],[23,22],[22,145],[88,89],[89,179],[179,88],[6,122],[122,196],[196,6],[88,95],[95,96],[96,88],[138,172],[172,136],[136,138],[215,58],[58,172],[172,215],[115,48],[48,219],[219,115],[42,80],[80,81],[81,42],[195,3],[3,51],[51,195],[43,146],[146,61],[61,43],[171,175],[175,199],[199,171],[81,82],[82,38],[38,81],[53,46],[46,225],[225,53],[144,163],[163,110],[110,144],[52,65],[65,66],[66,52],[229,228],[228,117],[117,229],[34,127],[127,234],[234,34],[107,108],[108,69],[69,107],[109,108],[108,151],[151,109],[48,64],[64,235],[235,48],[62,78],[78,191],[191,62],[129,209],[209,126],[126,129],[111,35],[35,143],[143,111],[117,123],[123,50],[50,117],[222,65],[65,52],[52,222],[19,125],[125,141],[141,19],[221,55],[55,65],[65,221],[3,195],[195,197],[197,3],[25,7],[7,33],[33,25],[220,237],[237,44],[44,220],[70,71],[71,139],[139,70],[122,193],[193,245],[245,122],[247,130],[130,33],[33,247],[71,21],[21,162],[162,71],[170,169],[169,150],[150,170],[188,174],[174,196],[196,188],[216,186],[186,92],[92,216],[2,97],[97,167],[167,2],[141,125],[125,241],[241,141],[164,167],[167,37],[37,164],[72,38],[38,12],[12,72],[38,82],[82,13],[13,38],[63,68],[68,71],[71,63],[226,35],[35,111],[111,226],[101,50],[50,205],[205,101],[206,92],[92,165],[165,206],[209,198],[198,217],[217,209],[165,167],[167,97],[97,165],[220,115],[115,218],[218,220],[133,112],[112,243],[243,133],[239,238],[238,241],[241,239],[214,135],[135,169],[169,214],[190,173],[173,133],[133,190],[171,208],[208,32],[32,171],[125,44],[44,237],[237,125],[86,87],[87,178],[178,86],[85,86],[86,179],[179,85],[84,85],[85,180],[180,84],[83,84],[84,181],[181,83],[201,83],[83,182],[182,201],[137,93],[93,132],[132,137],[76,62],[62,183],[183,76],[61,76],[76,184],[184,61],[57,61],[61,185],[185,57],[212,57],[57,186],[186,212],[214,207],[207,187],[187,214],[34,143],[143,156],[156,34],[79,239],[239,237],[237,79],[123,137],[137,177],[177,123],[44,1],[1,4],[4,44],[201,194],[194,32],[32,201],[64,102],[102,129],[129,64],[213,215],[215,138],[138,213],[59,166],[166,219],[219,59],[242,99],[99,97],[97,242],[2,94],[94,141],[141,2],[75,59],[59,235],[235,75],[24,110],[110,228],[228,24],[25,130],[130,226],[226,25],[23,24],[24,229],[229,23],[22,23],[23,230],[230,22],[26,22],[22,231],[231,26],[112,26],[26,232],[232,112],[189,190],[190,243],[243,189],[221,56],[56,190],[190,221],[28,56],[56,221],[221,28],[27,28],[28,222],[222,27],[29,27],[27,223],[223,29],[30,29],[29,224],[224,30],[247,30],[30,225],[225,247],[238,79],[79,20],[20,238],[166,59],[59,75],[75,166],[60,75],[75,240],[240,60],[147,177],[177,215],[215,147],[20,79],[79,166],[166,20],[187,147],[147,213],[213,187],[112,233],[233,244],[244,112],[233,128],[128,245],[245,233],[128,114],[114,188],[188,128],[114,217],[217,174],[174,114],[131,115],[115,220],[220,131],[217,198],[198,236],[236,217],[198,131],[131,134],[134,198],[177,132],[132,58],[58,177],[143,35],[35,124],[124,143],[110,163],[163,7],[7,110],[228,110],[110,25],[25,228],[356,389],[389,368],[368,356],[11,302],[302,267],[267,11],[452,350],[350,349],[349,452],[302,303],[303,269],[269,302],[357,343],[343,277],[277,357],[452,453],[453,357],[357,452],[333,332],[332,297],[297,333],[175,152],[152,377],[377,175],[347,348],[348,330],[330,347],[303,304],[304,270],[270,303],[9,336],[336,337],[337,9],[278,279],[279,360],[360,278],[418,262],[262,431],[431,418],[304,408],[408,409],[409,304],[310,415],[415,407],[407,310],[270,409],[409,410],[410,270],[450,348],[348,347],[347,450],[422,430],[430,434],[434,422],[313,314],[314,17],[17,313],[306,307],[307,375],[375,306],[387,388],[388,260],[260,387],[286,414],[414,398],[398,286],[335,406],[406,418],[418,335],[364,367],[367,416],[416,364],[423,358],[358,327],[327,423],[251,284],[284,298],[298,251],[281,5],[5,4],[4,281],[373,374],[374,253],[253,373],[307,320],[320,321],[321,307],[425,427],[427,411],[411,425],[421,313],[313,18],[18,421],[321,405],[405,406],[406,321],[320,404],[404,405],[405,320],[315,16],[16,17],[17,315],[426,425],[425,266],[266,426],[377,400],[400,369],[369,377],[322,391],[391,269],[269,322],[417,465],[465,464],[464,417],[386,257],[257,258],[258,386],[466,260],[260,388],[388,466],[456,399],[399,419],[419,456],[284,332],[332,333],[333,284],[417,285],[285,8],[8,417],[346,340],[340,261],[261,346],[413,441],[441,285],[285,413],[327,460],[460,328],[328,327],[355,371],[371,329],[329,355],[392,439],[439,438],[438,392],[382,341],[341,256],[256,382],[429,420],[420,360],[360,429],[364,394],[394,379],[379,364],[277,343],[343,437],[437,277],[443,444],[444,283],[283,443],[275,440],[440,363],[363,275],[431,262],[262,369],[369,431],[297,338],[338,337],[337,297],[273,375],[375,321],[321,273],[450,451],[451,349],[349,450],[446,342],[342,467],[467,446],[293,334],[334,282],[282,293],[458,461],[461,462],[462,458],[276,353],[353,383],[383,276],[308,324],[324,325],[325,308],[276,300],[300,293],[293,276],[372,345],[345,447],[447,372],[352,345],[345,340],[340,352],[274,1],[1,19],[19,274],[456,248],[248,281],[281,456],[436,427],[427,425],[425,436],[381,256],[256,252],[252,381],[269,391],[391,393],[393,269],[200,199],[199,428],[428,200],[266,330],[330,329],[329,266],[287,273],[273,422],[422,287],[250,462],[462,328],[328,250],[258,286],[286,384],[384,258],[265,353],[353,342],[342,265],[387,259],[259,257],[257,387],[424,431],[431,430],[430,424],[342,353],[353,276],[276,342],[273,335],[335,424],[424,273],[292,325],[325,307],[307,292],[366,447],[447,345],[345,366],[271,303],[303,302],[302,271],[423,266],[266,371],[371,423],[294,455],[455,460],[460,294],[279,278],[278,294],[294,279],[271,272],[272,304],[304,271],[432,434],[434,427],[427,432],[272,407],[407,408],[408,272],[394,430],[430,431],[431,394],[395,369],[369,400],[400,395],[334,333],[333,299],[299,334],[351,417],[417,168],[168,351],[352,280],[280,411],[411,352],[325,319],[319,320],[320,325],[295,296],[296,336],[336,295],[319,403],[403,404],[404,319],[330,348],[348,349],[349,330],[293,298],[298,333],[333,293],[323,454],[454,447],[447,323],[15,16],[16,315],[315,15],[358,429],[429,279],[279,358],[14,15],[15,316],[316,14],[285,336],[336,9],[9,285],[329,349],[349,350],[350,329],[374,380],[380,252],[252,374],[318,402],[402,403],[403,318],[6,197],[197,419],[419,6],[318,319],[319,325],[325,318],[367,364],[364,365],[365,367],[435,367],[367,397],[397,435],[344,438],[438,439],[439,344],[272,271],[271,311],[311,272],[195,5],[5,281],[281,195],[273,287],[287,291],[291,273],[396,428],[428,199],[199,396],[311,271],[271,268],[268,311],[283,444],[444,445],[445,283],[373,254],[254,339],[339,373],[282,334],[334,296],[296,282],[449,347],[347,346],[346,449],[264,447],[447,454],[454,264],[336,296],[296,299],[299,336],[338,10],[10,151],[151,338],[278,439],[439,455],[455,278],[292,407],[407,415],[415,292],[358,371],[371,355],[355,358],[340,345],[345,372],[372,340],[346,347],[347,280],[280,346],[442,443],[443,282],[282,442],[19,94],[94,370],[370,19],[441,442],[442,295],[295,441],[248,419],[419,197],[197,248],[263,255],[255,359],[359,263],[440,275],[275,274],[274,440],[300,383],[383,368],[368,300],[351,412],[412,465],[465,351],[263,467],[467,466],[466,263],[301,368],[368,389],[389,301],[395,378],[378,379],[379,395],[412,351],[351,419],[419,412],[436,426],[426,322],[322,436],[2,164],[164,393],[393,2],[370,462],[462,461],[461,370],[164,0],[0,267],[267,164],[302,11],[11,12],[12,302],[268,12],[12,13],[13,268],[293,300],[300,301],[301,293],[446,261],[261,340],[340,446],[330,266],[266,425],[425,330],[426,423],[423,391],[391,426],[429,355],[355,437],[437,429],[391,327],[327,326],[326,391],[440,457],[457,438],[438,440],[341,382],[382,362],[362,341],[459,457],[457,461],[461,459],[434,430],[430,394],[394,434],[414,463],[463,362],[362,414],[396,369],[369,262],[262,396],[354,461],[461,457],[457,354],[316,403],[403,402],[402,316],[315,404],[404,403],[403,315],[314,405],[405,404],[404,314],[313,406],[406,405],[405,313],[421,418],[418,406],[406,421],[366,401],[401,361],[361,366],[306,408],[408,407],[407,306],[291,409],[409,408],[408,291],[287,410],[410,409],[409,287],[432,436],[436,410],[410,432],[434,416],[416,411],[411,434],[264,368],[368,383],[383,264],[309,438],[438,457],[457,309],[352,376],[376,401],[401,352],[274,275],[275,4],[4,274],[421,428],[428,262],[262,421],[294,327],[327,358],[358,294],[433,416],[416,367],[367,433],[289,455],[455,439],[439,289],[462,370],[370,326],[326,462],[2,326],[326,370],[370,2],[305,460],[460,455],[455,305],[254,449],[449,448],[448,254],[255,261],[261,446],[446,255],[253,450],[450,449],[449,253],[252,451],[451,450],[450,252],[256,452],[452,451],[451,256],[341,453],[453,452],[452,341],[413,464],[464,463],[463,413],[441,413],[413,414],[414,441],[258,442],[442,441],[441,258],[257,443],[443,442],[442,257],[259,444],[444,443],[443,259],[260,445],[445,444],[444,260],[467,342],[342,445],[445,467],[459,458],[458,250],[250,459],[289,392],[392,290],[290,289],[290,328],[328,460],[460,290],[376,433],[433,435],[435,376],[250,290],[290,392],[392,250],[411,416],[416,433],[433,411],[341,463],[463,464],[464,341],[453,464],[464,465],[465,453],[357,465],[465,412],[412,357],[343,412],[412,399],[399,343],[360,363],[363,440],[440,360],[437,399],[399,456],[456,437],[420,456],[456,363],[363,420],[401,435],[435,288],[288,401],[372,383],[383,353],[353,372],[339,255],[255,249],[249,339],[448,261],[261,255],[255,448],[133,243],[243,190],[190,133],[133,155],[155,112],[112,133],[33,246],[246,247],[247,33],[33,130],[130,25],[25,33],[398,384],[384,286],[286,398],[362,398],[398,414],[414,362],[362,463],[463,341],[341,362],[263,359],[359,467],[467,263],[263,249],[249,255],[255,263],[466,467],[467,260],[260,466],[75,60],[60,166],[166,75],[238,239],[239,79],[79,238],[162,127],[127,139],[139,162],[72,11],[11,37],[37,72],[121,232],[232,120],[120,121],[73,72],[72,39],[39,73],[114,128],[128,47],[47,114],[233,232],[232,128],[128,233],[103,104],[104,67],[67,103],[152,175],[175,148],[148,152],[119,118],[118,101],[101,119],[74,73],[73,40],[40,74],[107,9],[9,108],[108,107],[49,48],[48,131],[131,49],[32,194],[194,211],[211,32],[184,74],[74,185],[185,184],[191,80],[80,183],[183,191],[185,40],[40,186],[186,185],[119,230],[230,118],[118,119],[210,202],[202,214],[214,210],[84,83],[83,17],[17,84],[77,76],[76,146],[146,77],[161,160],[160,30],[30,161],[190,56],[56,173],[173,190],[182,106],[106,194],[194,182],[138,135],[135,192],[192,138],[129,203],[203,98],[98,129],[54,21],[21,68],[68,54],[5,51],[51,4],[4,5],[145,144],[144,23],[23,145],[90,77],[77,91],[91,90],[207,205],[205,187],[187,207],[83,201],[201,18],[18,83],[181,91],[91,182],[182,181],[180,90],[90,181],[181,180],[16,85],[85,17],[17,16],[205,206],[206,36],[36,205],[176,148],[148,140],[140,176],[165,92],[92,39],[39,165],[245,193],[193,244],[244,245],[27,159],[159,28],[28,27],[30,247],[247,161],[161,30],[174,236],[236,196],[196,174],[103,54],[54,104],[104,103],[55,193],[193,8],[8,55],[111,117],[117,31],[31,111],[221,189],[189,55],[55,221],[240,98],[98,99],[99,240],[142,126],[126,100],[100,142],[219,166],[166,218],[218,219],[112,155],[155,26],[26,112],[198,209],[209,131],[131,198],[169,135],[135,150],[150,169],[114,47],[47,217],[217,114],[224,223],[223,53],[53,224],[220,45],[45,134],[134,220],[32,211],[211,140],[140,32],[109,67],[67,108],[108,109],[146,43],[43,91],[91,146],[231,230],[230,120],[120,231],[113,226],[226,247],[247,113],[105,63],[63,52],[52,105],[241,238],[238,242],[242,241],[124,46],[46,156],[156,124],[95,78],[78,96],[96,95],[70,46],[46,63],[63,70],[116,143],[143,227],[227,116],[116,123],[123,111],[111,116],[1,44],[44,19],[19,1],[3,236],[236,51],[51,3],[207,216],[216,205],[205,207],[26,154],[154,22],[22,26],[165,39],[39,167],[167,165],[199,200],[200,208],[208,199],[101,36],[36,100],[100,101],[43,57],[57,202],[202,43],[242,20],[20,99],[99,242],[56,28],[28,157],[157,56],[124,35],[35,113],[113,124],[29,160],[160,27],[27,29],[211,204],[204,210],[210,211],[124,113],[113,46],[46,124],[106,43],[43,204],[204,106],[96,62],[62,77],[77,96],[227,137],[137,116],[116,227],[73,41],[41,72],[72,73],[36,203],[203,142],[142,36],[235,64],[64,240],[240,235],[48,49],[49,64],[64,48],[42,41],[41,74],[74,42],[214,212],[212,207],[207,214],[183,42],[42,184],[184,183],[210,169],[169,211],[211,210],[140,170],[170,176],[176,140],[104,105],[105,69],[69,104],[193,122],[122,168],[168,193],[50,123],[123,187],[187,50],[89,96],[96,90],[90,89],[66,65],[65,107],[107,66],[179,89],[89,180],[180,179],[119,101],[101,120],[120,119],[68,63],[63,104],[104,68],[234,93],[93,227],[227,234],[16,15],[15,85],[85,16],[209,129],[129,49],[49,209],[15,14],[14,86],[86,15],[107,55],[55,9],[9,107],[120,100],[100,121],[121,120],[153,145],[145,22],[22,153],[178,88],[88,179],[179,178],[197,6],[6,196],[196,197],[89,88],[88,96],[96,89],[135,138],[138,136],[136,135],[138,215],[215,172],[172,138],[218,115],[115,219],[219,218],[41,42],[42,81],[81,41],[5,195],[195,51],[51,5],[57,43],[43,61],[61,57],[208,171],[171,199],[199,208],[41,81],[81,38],[38,41],[224,53],[53,225],[225,224],[24,144],[144,110],[110,24],[105,52],[52,66],[66,105],[118,229],[229,117],[117,118],[227,34],[34,234],[234,227],[66,107],[107,69],[69,66],[10,109],[109,151],[151,10],[219,48],[48,235],[235,219],[183,62],[62,191],[191,183],[142,129],[129,126],[126,142],[116,111],[111,143],[143,116],[118,117],[117,50],[50,118],[223,222],[222,52],[52,223],[94,19],[19,141],[141,94],[222,221],[221,65],[65,222],[196,3],[3,197],[197,196],[45,220],[220,44],[44,45],[156,70],[70,139],[139,156],[188,122],[122,245],[245,188],[139,71],[71,162],[162,139],[149,170],[170,150],[150,149],[122,188],[188,196],[196,122],[206,216],[216,92],[92,206],[164,2],[2,167],[167,164],[242,141],[141,241],[241,242],[0,164],[164,37],[37,0],[11,72],[72,12],[12,11],[12,38],[38,13],[13,12],[70,63],[63,71],[71,70],[31,226],[226,111],[111,31],[36,101],[101,205],[205,36],[203,206],[206,165],[165,203],[126,209],[209,217],[217,126],[98,165],[165,97],[97,98],[237,220],[220,218],[218,237],[237,239],[239,241],[241,237],[210,214],[214,169],[169,210],[140,171],[171,32],[32,140],[241,125],[125,237],[237,241],[179,86],[86,178],[178,179],[180,85],[85,179],[179,180],[181,84],[84,180],[180,181],[182,83],[83,181],[181,182],[194,201],[201,182],[182,194],[177,137],[137,132],[132,177],[184,76],[76,183],[183,184],[185,61],[61,184],[184,185],[186,57],[57,185],[185,186],[216,212],[212,186],[186,216],[192,214],[214,187],[187,192],[139,34],[34,156],[156,139],[218,79],[79,237],[237,218],[147,123],[123,177],[177,147],[45,44],[44,4],[4,45],[208,201],[201,32],[32,208],[98,64],[64,129],[129,98],[192,213],[213,138],[138,192],[235,59],[59,219],[219,235],[141,242],[242,97],[97,141],[97,2],[2,141],[141,97],[240,75],[75,235],[235,240],[229,24],[24,228],[228,229],[31,25],[25,226],[226,31],[230,23],[23,229],[229,230],[231,22],[22,230],[230,231],[232,26],[26,231],[231,232],[233,112],[112,232],[232,233],[244,189],[189,243],[243,244],[189,221],[221,190],[190,189],[222,28],[28,221],[221,222],[223,27],[27,222],[222,223],[224,29],[29,223],[223,224],[225,30],[30,224],[224,225],[113,247],[247,225],[225,113],[99,60],[60,240],[240,99],[213,147],[147,215],[215,213],[60,20],[20,166],[166,60],[192,187],[187,213],[213,192],[243,112],[112,244],[244,243],[244,233],[233,245],[245,244],[245,128],[128,188],[188,245],[188,114],[114,174],[174,188],[134,131],[131,220],[220,134],[174,217],[217,236],[236,174],[236,198],[198,134],[134,236],[215,177],[177,58],[58,215],[156,143],[143,124],[124,156],[25,110],[110,7],[7,25],[31,228],[228,25],[25,31],[264,356],[356,368],[368,264],[0,11],[11,267],[267,0],[451,452],[452,349],[349,451],[267,302],[302,269],[269,267],[350,357],[357,277],[277,350],[350,452],[452,357],[357,350],[299,333],[333,297],[297,299],[396,175],[175,377],[377,396],[280,347],[347,330],[330,280],[269,303],[303,270],[270,269],[151,9],[9,337],[337,151],[344,278],[278,360],[360,344],[424,418],[418,431],[431,424],[270,304],[304,409],[409,270],[272,310],[310,407],[407,272],[322,270],[270,410],[410,322],[449,450],[450,347],[347,449],[432,422],[422,434],[434,432],[18,313],[313,17],[17,18],[291,306],[306,375],[375,291],[259,387],[387,260],[260,259],[424,335],[335,418],[418,424],[434,364],[364,416],[416,434],[391,423],[423,327],[327,391],[301,251],[251,298],[298,301],[275,281],[281,4],[4,275],[254,373],[373,253],[253,254],[375,307],[307,321],[321,375],[280,425],[425,411],[411,280],[200,421],[421,18],[18,200],[335,321],[321,406],[406,335],[321,320],[320,405],[405,321],[314,315],[315,17],[17,314],[423,426],[426,266],[266,423],[396,377],[377,369],[369,396],[270,322],[322,269],[269,270],[413,417],[417,464],[464,413],[385,386],[386,258],[258,385],[248,456],[456,419],[419,248],[298,284],[284,333],[333,298],[168,417],[417,8],[8,168],[448,346],[346,261],[261,448],[417,413],[413,285],[285,417],[326,327],[327,328],[328,326],[277,355],[355,329],[329,277],[309,392],[392,438],[438,309],[381,382],[382,256],[256,381],[279,429],[429,360],[360,279],[365,364],[364,379],[379,365],[355,277],[277,437],[437,355],[282,443],[443,283],[283,282],[281,275],[275,363],[363,281],[395,431],[431,369],[369,395],[299,297],[297,337],[337,299],[335,273],[273,321],[321,335],[348,450],[450,349],[349,348],[359,446],[446,467],[467,359],[283,293],[293,282],[282,283],[250,458],[458,462],[462,250],[300,276],[276,383],[383,300],[292,308],[308,325],[325,292],[283,276],[276,293],[293,283],[264,372],[372,447],[447,264],[346,352],[352,340],[340,346],[354,274],[274,19],[19,354],[363,456],[456,281],[281,363],[426,436],[436,425],[425,426],[380,381],[381,252],[252,380],[267,269],[269,393],[393,267],[421,200],[200,428],[428,421],[371,266],[266,329],[329,371],[432,287],[287,422],[422,432],[290,250],[250,328],[328,290],[385,258],[258,384],[384,385],[446,265],[265,342],[342,446],[386,387],[387,257],[257,386],[422,424],[424,430],[430,422],[445,342],[342,276],[276,445],[422,273],[273,424],[424,422],[306,292],[292,307],[307,306],[352,366],[366,345],[345,352],[268,271],[271,302],[302,268],[358,423],[423,371],[371,358],[327,294],[294,460],[460,327],[331,279],[279,294],[294,331],[303,271],[271,304],[304,303],[436,432],[432,427],[427,436],[304,272],[272,408],[408,304],[395,394],[394,431],[431,395],[378,395],[395,400],[400,378],[296,334],[334,299],[299,296],[6,351],[351,168],[168,6],[376,352],[352,411],[411,376],[307,325],[325,320],[320,307],[285,295],[295,336],[336,285],[320,319],[319,404],[404,320],[329,330],[330,349],[349,329],[334,293],[293,333],[333,334],[366,323],[323,447],[447,366],[316,15],[15,315],[315,316],[331,358],[358,279],[279,331],[317,14],[14,316],[316,317],[8,285],[285,9],[9,8],[277,329],[329,350],[350,277],[253,374],[374,252],[252,253],[319,318],[318,403],[403,319],[351,6],[6,419],[419,351],[324,318],[318,325],[325,324],[397,367],[367,365],[365,397],[288,435],[435,397],[397,288],[278,344],[344,439],[439,278],[310,272],[272,311],[311,310],[248,195],[195,281],[281,248],[375,273],[273,291],[291,375],[175,396],[396,199],[199,175],[312,311],[311,268],[268,312],[276,283],[283,445],[445,276],[390,373],[373,339],[339,390],[295,282],[282,296],[296,295],[448,449],[449,346],[346,448],[356,264],[264,454],[454,356],[337,336],[336,299],[299,337],[337,338],[338,151],[151,337],[294,278],[278,455],[455,294],[308,292],[292,415],[415,308],[429,358],[358,355],[355,429],[265,340],[340,372],[372,265],[352,346],[346,280],[280,352],[295,442],[442,282],[282,295],[354,19],[19,370],[370,354],[285,441],[441,295],[295,285],[195,248],[248,197],[197,195],[457,440],[440,274],[274,457],[301,300],[300,368],[368,301],[417,351],[351,465],[465,417],[251,301],[301,389],[389,251],[394,395],[395,379],[379,394],[399,412],[412,419],[419,399],[410,436],[436,322],[322,410],[326,2],[2,393],[393,326],[354,370],[370,461],[461,354],[393,164],[164,267],[267,393],[268,302],[302,12],[12,268],[312,268],[268,13],[13,312],[298,293],[293,301],[301,298],[265,446],[446,340],[340,265],[280,330],[330,425],[425,280],[322,426],[426,391],[391,322],[420,429],[429,437],[437,420],[393,391],[391,326],[326,393],[344,440],[440,438],[438,344],[458,459],[459,461],[461,458],[364,434],[434,394],[394,364],[428,396],[396,262],[262,428],[274,354],[354,457],[457,274],[317,316],[316,402],[402,317],[316,315],[315,403],[403,316],[315,314],[314,404],[404,315],[314,313],[313,405],[405,314],[313,421],[421,406],[406,313],[323,366],[366,361],[361,323],[292,306],[306,407],[407,292],[306,291],[291,408],[408,306],[291,287],[287,409],[409,291],[287,432],[432,410],[410,287],[427,434],[434,411],[411,427],[372,264],[264,383],[383,372],[459,309],[309,457],[457,459],[366,352],[352,401],[401,366],[1,274],[274,4],[4,1],[418,421],[421,262],[262,418],[331,294],[294,358],[358,331],[435,433],[433,367],[367,435],[392,289],[289,439],[439,392],[328,462],[462,326],[326,328],[94,2],[2,370],[370,94],[289,305],[305,455],[455,289],[339,254],[254,448],[448,339],[359,255],[255,446],[446,359],[254,253],[253,449],[449,254],[253,252],[252,450],[450,253],[252,256],[256,451],[451,252],[256,341],[341,452],[452,256],[414,413],[413,463],[463,414],[286,441],[441,414],[414,286],[286,258],[258,441],[441,286],[258,257],[257,442],[442,258],[257,259],[259,443],[443,257],[259,260],[260,444],[444,259],[260,467],[467,445],[445,260],[309,459],[459,250],[250,309],[305,289],[289,290],[290,305],[305,290],[290,460],[460,305],[401,376],[376,435],[435,401],[309,250],[250,392],[392,309],[376,411],[411,433],[433,376],[453,341],[341,464],[464,453],[357,453],[453,465],[465,357],[343,357],[357,412],[412,343],[437,343],[343,399],[399,437],[344,360],[360,440],[440,344],[420,437],[437,456],[456,420],[360,420],[420,363],[363,360],[361,401],[401,288],[288,361],[265,372],[372,353],[353,265],[390,339],[339,249],[249,390],[339,448],[448,255],[255,339]);function mh(t){t.u={faceLandmarks:[],faceBlendshapes:[],facialTransformationMatrixes:[]}}var yh=class extends ih{constructor(t,e){super(new Za(t,e),\"image_in\",\"norm_rect\",!1),this.u={faceLandmarks:[],faceBlendshapes:[],facialTransformationMatrixes:[]},this.outputFacialTransformationMatrixes=this.outputFaceBlendshapes=!1,Cn(t=this.h=new Hs,0,1,e=new Cs),this.H=new Vs,Cn(this.h,0,3,this.H),this.j=new Is,Cn(this.h,0,2,this.j),Xn(this.j,4,1),Hn(this.j,2,.5),Hn(this.H,2,.5),Hn(this.h,4,.5)}get baseOptions(){return Rn(this.h,Cs,1)}set baseOptions(t){Cn(this.h,0,1,t)}o(t){return\"numFaces\"in t&&Xn(this.j,4,t.numFaces??1),\"minFaceDetectionConfidence\"in t&&Hn(this.j,2,t.minFaceDetectionConfidence??.5),\"minTrackingConfidence\"in t&&Hn(this.h,4,t.minTrackingConfidence??.5),\"minFacePresenceConfidence\"in t&&Hn(this.H,2,t.minFacePresenceConfidence??.5),\"outputFaceBlendshapes\"in t&&(this.outputFaceBlendshapes=!!t.outputFaceBlendshapes),\"outputFacialTransformationMatrixes\"in t&&(this.outputFacialTransformationMatrixes=!!t.outputFacialTransformationMatrixes),this.l(t)}F(t,e){return mh(this),eh(this,t,e),this.u}G(t,e,n){return mh(this),nh(this,t,n,e),this.u}m(){var t=new Di;Ii(t,\"image_in\"),Ii(t,\"norm_rect\"),Ui(t,\"face_landmarks\");const e=new yi;Wn(e,zs,this.h);const n=new Li;ki(n,\"mediapipe.tasks.vision.face_landmarker.FaceLandmarkerGraph\"),xi(n,\"IMAGE:image_in\"),xi(n,\"NORM_RECT:norm_rect\"),Si(n,\"NORM_LANDMARKS:face_landmarks\"),n.o(e),Oi(t,n),this.g.attachProtoVectorListener(\"face_landmarks\",((t,e)=>{for(const e of t)t=us(e),this.u.faceLandmarks.push(Io(t));ea(this,e)})),this.g.attachEmptyPacketListener(\"face_landmarks\",(t=>{ea(this,t)})),this.outputFaceBlendshapes&&(Ui(t,\"blendshapes\"),Si(n,\"BLENDSHAPES:blendshapes\"),this.g.attachProtoVectorListener(\"blendshapes\",((t,e)=>{if(this.outputFaceBlendshapes)for(const e of t)t=Wi(e),this.u.faceBlendshapes.push(Co(t.g()??[]));ea(this,e)})),this.g.attachEmptyPacketListener(\"blendshapes\",(t=>{ea(this,t)}))),this.outputFacialTransformationMatrixes&&(Ui(t,\"face_geometry\"),Si(n,\"FACE_GEOMETRY:face_geometry\"),this.g.attachProtoVectorListener(\"face_geometry\",((t,e)=>{if(this.outputFacialTransformationMatrixes)for(const e of t)(t=Rn(Gs(e),ls,2))&&this.u.facialTransformationMatrixes.push({rows:Bn(Nn(t,1),0)??0,columns:Bn(Nn(t,2),0)??0,data:yn(t,3,ve).slice()??[]});ea(this,e)})),this.g.attachEmptyPacketListener(\"face_geometry\",(t=>{ea(this,t)}))),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};yh.prototype.detectForVideo=yh.prototype.G,yh.prototype.detect=yh.prototype.F,yh.prototype.setOptions=yh.prototype.o,yh.createFromModelPath=function(t,e){return Qa(yh,t,{baseOptions:{modelAssetPath:e}})},yh.createFromModelBuffer=function(t,e){return Qa(yh,t,{baseOptions:{modelAssetBuffer:e}})},yh.createFromOptions=function(t,e){return Qa(yh,t,e)},yh.FACE_LANDMARKS_LIPS=oh,yh.FACE_LANDMARKS_LEFT_EYE=ah,yh.FACE_LANDMARKS_LEFT_EYEBROW=hh,yh.FACE_LANDMARKS_LEFT_IRIS=ch,yh.FACE_LANDMARKS_RIGHT_EYE=uh,yh.FACE_LANDMARKS_RIGHT_EYEBROW=lh,yh.FACE_LANDMARKS_RIGHT_IRIS=dh,yh.FACE_LANDMARKS_FACE_OVAL=fh,yh.FACE_LANDMARKS_CONTOURS=ph,yh.FACE_LANDMARKS_TESSELATION=gh;var _h=class extends ih{constructor(t,e){super(new Za(t,e),\"image_in\",\"norm_rect\",!0),Cn(t=this.j=new Ks,0,1,e=new Cs)}get baseOptions(){return Rn(this.j,Cs,1)}set baseOptions(t){Cn(this.j,0,1,t)}o(t){return super.l(t)}Pa(t,e,n){const r=\"function\"!=typeof e?e:{};if(this.h=\"function\"==typeof e?e:n,eh(this,t,r??{}),!this.h)return this.u}m(){var t=new Di;Ii(t,\"image_in\"),Ii(t,\"norm_rect\"),Ui(t,\"stylized_image\");const e=new yi;Wn(e,Ys,this.j);const n=new Li;ki(n,\"mediapipe.tasks.vision.face_stylizer.FaceStylizerGraph\"),xi(n,\"IMAGE:image_in\"),xi(n,\"NORM_RECT:norm_rect\"),Si(n,\"STYLIZED_IMAGE:stylized_image\"),n.o(e),Oi(t,n),this.g.W(\"stylized_image\",((t,e)=>{var n=!this.h,r=t.data,i=t.width;const s=i*(t=t.height);if(r instanceof Uint8Array)if(r.length===3*s){const e=new Uint8ClampedArray(4*s);for(let t=0;t<s;++t)e[4*t]=r[3*t],e[4*t+1]=r[3*t+1],e[4*t+2]=r[3*t+2],e[4*t+3]=255;r=new ImageData(e,i,t)}else{if(r.length!==4*s)throw Error(\"Unsupported channel count: \"+r.length/s);r=new ImageData(new Uint8ClampedArray(r.buffer,r.byteOffset,r.length),i,t)}else if(!(r instanceof WebGLTexture))throw Error(`Unsupported format: ${r.constructor.name}`);i=new Ka([r],!1,!1,this.g.i.canvas,this.M,i,t),this.u=n=n?i.clone():i,this.h&&this.h(n),ea(this,e)})),this.g.attachEmptyPacketListener(\"stylized_image\",(t=>{this.u=null,this.h&&this.h(null),ea(this,t)})),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};_h.prototype.stylize=_h.prototype.Pa,_h.prototype.setOptions=_h.prototype.o,_h.createFromModelPath=function(t,e){return Qa(_h,t,{baseOptions:{modelAssetPath:e}})},_h.createFromModelBuffer=function(t,e){return Qa(_h,t,{baseOptions:{modelAssetBuffer:e}})},_h.createFromOptions=function(t,e){return Qa(_h,t,e)};var vh=$a([0,1],[1,2],[2,3],[3,4],[0,5],[5,6],[6,7],[7,8],[5,9],[9,10],[10,11],[11,12],[9,13],[13,14],[14,15],[15,16],[13,17],[0,17],[17,18],[18,19],[19,20]);function Eh(t){t.gestures=[],t.landmarks=[],t.worldLandmarks=[],t.handedness=[]}function wh(t){return 0===t.gestures.length?{gestures:[],landmarks:[],worldLandmarks:[],handedness:[],handednesses:[]}:{gestures:t.gestures,landmarks:t.landmarks,worldLandmarks:t.worldLandmarks,handedness:t.handedness,handednesses:t.handedness}}function Th(t,e=!0){const n=[];for(const i of t){var r=Wi(i);t=[];for(const n of r.g())r=e&&null!=Nn(n,1)?Bn(Nn(n,1),0):-1,t.push({score:Gn(n,2)??0,index:r,categoryName:jn(n,3)??\"\",displayName:jn(n,4)??\"\"});n.push(t)}return n}var Ah=class extends ih{constructor(t,e){super(new Za(t,e),\"image_in\",\"norm_rect\",!1),this.gestures=[],this.landmarks=[],this.worldLandmarks=[],this.handedness=[],Cn(t=this.v=new oo,0,1,e=new Cs),this.A=new io,Cn(this.v,0,2,this.A),this.u=new no,Cn(this.A,0,3,this.u),this.h=new to,Cn(this.A,0,2,this.h),this.j=new Zs,Cn(this.v,0,3,this.j),Hn(this.h,2,.5),Hn(this.A,4,.5),Hn(this.u,2,.5)}get baseOptions(){return Rn(this.v,Cs,1)}set baseOptions(t){Cn(this.v,0,1,t)}o(t){if(Xn(this.h,3,t.numHands??1),\"minHandDetectionConfidence\"in t&&Hn(this.h,2,t.minHandDetectionConfidence??.5),\"minTrackingConfidence\"in t&&Hn(this.A,4,t.minTrackingConfidence??.5),\"minHandPresenceConfidence\"in t&&Hn(this.u,2,t.minHandPresenceConfidence??.5),t.cannedGesturesClassifierOptions){var e=new $s,n=e,r=Po(t.cannedGesturesClassifierOptions,Rn(this.j,$s,3)?.h());Cn(n,0,2,r),Cn(this.j,0,3,e)}else void 0===t.cannedGesturesClassifierOptions&&Rn(this.j,$s,3)?.g();return t.customGesturesClassifierOptions?(Cn(n=e=new $s,0,2,r=Po(t.customGesturesClassifierOptions,Rn(this.j,$s,4)?.h())),Cn(this.j,0,4,e)):void 0===t.customGesturesClassifierOptions&&Rn(this.j,$s,4)?.g(),this.l(t)}Ka(t,e){return Eh(this),eh(this,t,e),wh(this)}La(t,e,n){return Eh(this),nh(this,t,n,e),wh(this)}m(){var t=new Di;Ii(t,\"image_in\"),Ii(t,\"norm_rect\"),Ui(t,\"hand_gestures\"),Ui(t,\"hand_landmarks\"),Ui(t,\"world_hand_landmarks\"),Ui(t,\"handedness\");const e=new yi;Wn(e,co,this.v);const n=new Li;ki(n,\"mediapipe.tasks.vision.gesture_recognizer.GestureRecognizerGraph\"),xi(n,\"IMAGE:image_in\"),xi(n,\"NORM_RECT:norm_rect\"),Si(n,\"HAND_GESTURES:hand_gestures\"),Si(n,\"LANDMARKS:hand_landmarks\"),Si(n,\"WORLD_LANDMARKS:world_hand_landmarks\"),Si(n,\"HANDEDNESS:handedness\"),n.o(e),Oi(t,n),this.g.attachProtoVectorListener(\"hand_landmarks\",((t,e)=>{for(const e of t){t=us(e);const n=[];for(const e of Pn(t,as,1))n.push({x:Gn(e,1)??0,y:Gn(e,2)??0,z:Gn(e,3)??0,visibility:Gn(e,4)??0});this.landmarks.push(n)}ea(this,e)})),this.g.attachEmptyPacketListener(\"hand_landmarks\",(t=>{ea(this,t)})),this.g.attachProtoVectorListener(\"world_hand_landmarks\",((t,e)=>{for(const e of t){t=os(e);const n=[];for(const e of Pn(t,rs,1))n.push({x:Gn(e,1)??0,y:Gn(e,2)??0,z:Gn(e,3)??0,visibility:Gn(e,4)??0});this.worldLandmarks.push(n)}ea(this,e)})),this.g.attachEmptyPacketListener(\"world_hand_landmarks\",(t=>{ea(this,t)})),this.g.attachProtoVectorListener(\"hand_gestures\",((t,e)=>{this.gestures.push(...Th(t,!1)),ea(this,e)})),this.g.attachEmptyPacketListener(\"hand_gestures\",(t=>{ea(this,t)})),this.g.attachProtoVectorListener(\"handedness\",((t,e)=>{this.handedness.push(...Th(t)),ea(this,e)})),this.g.attachEmptyPacketListener(\"handedness\",(t=>{ea(this,t)})),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};function bh(t){return{landmarks:t.landmarks,worldLandmarks:t.worldLandmarks,handednesses:t.handedness,handedness:t.handedness}}Ah.prototype.recognizeForVideo=Ah.prototype.La,Ah.prototype.recognize=Ah.prototype.Ka,Ah.prototype.setOptions=Ah.prototype.o,Ah.createFromModelPath=function(t,e){return Qa(Ah,t,{baseOptions:{modelAssetPath:e}})},Ah.createFromModelBuffer=function(t,e){return Qa(Ah,t,{baseOptions:{modelAssetBuffer:e}})},Ah.createFromOptions=function(t,e){return Qa(Ah,t,e)},Ah.HAND_CONNECTIONS=vh;var kh=class extends ih{constructor(t,e){super(new Za(t,e),\"image_in\",\"norm_rect\",!1),this.landmarks=[],this.worldLandmarks=[],this.handedness=[],Cn(t=this.j=new io,0,1,e=new Cs),this.u=new no,Cn(this.j,0,3,this.u),this.h=new to,Cn(this.j,0,2,this.h),Xn(this.h,3,1),Hn(this.h,2,.5),Hn(this.u,2,.5),Hn(this.j,4,.5)}get baseOptions(){return Rn(this.j,Cs,1)}set baseOptions(t){Cn(this.j,0,1,t)}o(t){return\"numHands\"in t&&Xn(this.h,3,t.numHands??1),\"minHandDetectionConfidence\"in t&&Hn(this.h,2,t.minHandDetectionConfidence??.5),\"minTrackingConfidence\"in t&&Hn(this.j,4,t.minTrackingConfidence??.5),\"minHandPresenceConfidence\"in t&&Hn(this.u,2,t.minHandPresenceConfidence??.5),this.l(t)}F(t,e){return this.landmarks=[],this.worldLandmarks=[],this.handedness=[],eh(this,t,e),bh(this)}G(t,e,n){return this.landmarks=[],this.worldLandmarks=[],this.handedness=[],nh(this,t,n,e),bh(this)}m(){var t=new Di;Ii(t,\"image_in\"),Ii(t,\"norm_rect\"),Ui(t,\"hand_landmarks\"),Ui(t,\"world_hand_landmarks\"),Ui(t,\"handedness\");const e=new yi;Wn(e,ho,this.j);const n=new Li;ki(n,\"mediapipe.tasks.vision.hand_landmarker.HandLandmarkerGraph\"),xi(n,\"IMAGE:image_in\"),xi(n,\"NORM_RECT:norm_rect\"),Si(n,\"LANDMARKS:hand_landmarks\"),Si(n,\"WORLD_LANDMARKS:world_hand_landmarks\"),Si(n,\"HANDEDNESS:handedness\"),n.o(e),Oi(t,n),this.g.attachProtoVectorListener(\"hand_landmarks\",((t,e)=>{for(const e of t)t=us(e),this.landmarks.push(Io(t));ea(this,e)})),this.g.attachEmptyPacketListener(\"hand_landmarks\",(t=>{ea(this,t)})),this.g.attachProtoVectorListener(\"world_hand_landmarks\",((t,e)=>{for(const e of t)t=os(e),this.worldLandmarks.push(Uo(t));ea(this,e)})),this.g.attachEmptyPacketListener(\"world_hand_landmarks\",(t=>{ea(this,t)})),this.g.attachProtoVectorListener(\"handedness\",((t,e)=>{var n=this.handedness,r=n.push;const i=[];for(const e of t){t=Wi(e);const n=[];for(const e of t.g())n.push({score:Gn(e,2)??0,index:Bn(Nn(e,1),0)??-1,categoryName:jn(e,3)??\"\",displayName:jn(e,4)??\"\"});i.push(n)}r.call(n,...i),ea(this,e)})),this.g.attachEmptyPacketListener(\"handedness\",(t=>{ea(this,t)})),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};kh.prototype.detectForVideo=kh.prototype.G,kh.prototype.detect=kh.prototype.F,kh.prototype.setOptions=kh.prototype.o,kh.createFromModelPath=function(t,e){return Qa(kh,t,{baseOptions:{modelAssetPath:e}})},kh.createFromModelBuffer=function(t,e){return Qa(kh,t,{baseOptions:{modelAssetBuffer:e}})},kh.createFromOptions=function(t,e){return Qa(kh,t,e)},kh.HAND_CONNECTIONS=vh;var xh=$a([0,1],[1,2],[2,3],[3,7],[0,4],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[13,15],[15,17],[15,19],[15,21],[17,19],[12,14],[14,16],[16,18],[16,20],[16,22],[18,20],[11,23],[12,24],[23,24],[23,25],[24,26],[25,27],[26,28],[27,29],[28,30],[29,31],[30,32],[27,31],[28,32]);function Sh(t){t.h={faceLandmarks:[],faceBlendshapes:[],poseLandmarks:[],poseWorldLandmarks:[],poseSegmentationMasks:[],leftHandLandmarks:[],leftHandWorldLandmarks:[],rightHandLandmarks:[],rightHandWorldLandmarks:[]}}function Lh(t){try{if(!t.I)return t.h;t.I(t.h)}finally{ia(t)}}function Fh(t,e){t=us(t),e.push(Io(t))}var Rh=class extends ih{constructor(t,e){super(new Za(t,e),\"input_frames_image\",null,!1),this.h={faceLandmarks:[],faceBlendshapes:[],poseLandmarks:[],poseWorldLandmarks:[],poseSegmentationMasks:[],leftHandLandmarks:[],leftHandWorldLandmarks:[],rightHandLandmarks:[],rightHandWorldLandmarks:[]},this.outputPoseSegmentationMasks=this.outputFaceBlendshapes=!1,Cn(t=this.A=new yo,0,1,e=new Cs),this.u=new no,Cn(this.A,0,2,this.u),this.aa=new uo,Cn(this.A,0,3,this.aa),this.j=new Is,Cn(this.A,0,4,this.j),this.H=new Vs,Cn(this.A,0,5,this.H),this.v=new fo,Cn(this.A,0,6,this.v),this.D=new go,Cn(this.A,0,7,this.D),Hn(this.j,2,.5),Hn(this.j,3,.3),Hn(this.H,2,.5),Hn(this.v,2,.5),Hn(this.v,3,.3),Hn(this.D,2,.5),Hn(this.u,2,.5)}get baseOptions(){return Rn(this.A,Cs,1)}set baseOptions(t){Cn(this.A,0,1,t)}o(t){return\"minFaceDetectionConfidence\"in t&&Hn(this.j,2,t.minFaceDetectionConfidence??.5),\"minFaceSuppressionThreshold\"in t&&Hn(this.j,3,t.minFaceSuppressionThreshold??.3),\"minFacePresenceConfidence\"in t&&Hn(this.H,2,t.minFacePresenceConfidence??.5),\"outputFaceBlendshapes\"in t&&(this.outputFaceBlendshapes=!!t.outputFaceBlendshapes),\"minPoseDetectionConfidence\"in t&&Hn(this.v,2,t.minPoseDetectionConfidence??.5),\"minPoseSuppressionThreshold\"in t&&Hn(this.v,3,t.minPoseSuppressionThreshold??.3),\"minPosePresenceConfidence\"in t&&Hn(this.D,2,t.minPosePresenceConfidence??.5),\"outputPoseSegmentationMasks\"in t&&(this.outputPoseSegmentationMasks=!!t.outputPoseSegmentationMasks),\"minHandLandmarksConfidence\"in t&&Hn(this.u,2,t.minHandLandmarksConfidence??.5),this.l(t)}F(t,e,n){const r=\"function\"!=typeof e?e:{};return this.I=\"function\"==typeof e?e:n,Sh(this),eh(this,t,r),Lh(this)}G(t,e,n,r){const i=\"function\"!=typeof n?n:{};return this.I=\"function\"==typeof n?n:r,Sh(this),nh(this,t,i,e),Lh(this)}m(){var t=new Di;Ii(t,\"input_frames_image\"),Ui(t,\"pose_landmarks\"),Ui(t,\"pose_world_landmarks\"),Ui(t,\"face_landmarks\"),Ui(t,\"left_hand_landmarks\"),Ui(t,\"left_hand_world_landmarks\"),Ui(t,\"right_hand_landmarks\"),Ui(t,\"right_hand_world_landmarks\");const e=new yi,n=new oi;An(n,1,Me(\"type.googleapis.com/mediapipe.tasks.vision.holistic_landmarker.proto.HolisticLandmarkerGraphOptions\"),\"\"),function(t,e){if(null!=e)if(Array.isArray(e))dn(t,2,tn(e,nn,void 0,void 0,!1));else{if(!(\"string\"==typeof e||e instanceof B||M(e)))throw Error(\"invalid value in Any.value field: \"+e+\" expected a ByteString, a base64 encoded string, a Uint8Array or a jspb array\");An(t,2,ae(e,!1,!1),D())}}(n,this.A.g());const r=new Li;ki(r,\"mediapipe.tasks.vision.holistic_landmarker.HolisticLandmarkerGraph\"),Dn(r,8,oi,n),xi(r,\"IMAGE:input_frames_image\"),Si(r,\"POSE_LANDMARKS:pose_landmarks\"),Si(r,\"POSE_WORLD_LANDMARKS:pose_world_landmarks\"),Si(r,\"FACE_LANDMARKS:face_landmarks\"),Si(r,\"LEFT_HAND_LANDMARKS:left_hand_landmarks\"),Si(r,\"LEFT_HAND_WORLD_LANDMARKS:left_hand_world_landmarks\"),Si(r,\"RIGHT_HAND_LANDMARKS:right_hand_landmarks\"),Si(r,\"RIGHT_HAND_WORLD_LANDMARKS:right_hand_world_landmarks\"),r.o(e),Oi(t,r),na(this,t),this.g.attachProtoListener(\"pose_landmarks\",((t,e)=>{Fh(t,this.h.poseLandmarks),ea(this,e)})),this.g.attachEmptyPacketListener(\"pose_landmarks\",(t=>{ea(this,t)})),this.g.attachProtoListener(\"pose_world_landmarks\",((t,e)=>{var n=this.h.poseWorldLandmarks;t=os(t),n.push(Uo(t)),ea(this,e)})),this.g.attachEmptyPacketListener(\"pose_world_landmarks\",(t=>{ea(this,t)})),this.outputPoseSegmentationMasks&&(Si(r,\"POSE_SEGMENTATION_MASK:pose_segmentation_mask\"),ra(this,\"pose_segmentation_mask\"),this.g.W(\"pose_segmentation_mask\",((t,e)=>{this.h.poseSegmentationMasks=[rh(this,t,!0,!this.I)],ea(this,e)})),this.g.attachEmptyPacketListener(\"pose_segmentation_mask\",(t=>{this.h.poseSegmentationMasks=[],ea(this,t)}))),this.g.attachProtoListener(\"face_landmarks\",((t,e)=>{Fh(t,this.h.faceLandmarks),ea(this,e)})),this.g.attachEmptyPacketListener(\"face_landmarks\",(t=>{ea(this,t)})),this.outputFaceBlendshapes&&(Ui(t,\"extra_blendshapes\"),Si(r,\"FACE_BLENDSHAPES:extra_blendshapes\"),this.g.attachProtoListener(\"extra_blendshapes\",((t,e)=>{var n=this.h.faceBlendshapes;this.outputFaceBlendshapes&&(t=Wi(t),n.push(Co(t.g()??[]))),ea(this,e)})),this.g.attachEmptyPacketListener(\"extra_blendshapes\",(t=>{ea(this,t)}))),this.g.attachProtoListener(\"left_hand_landmarks\",((t,e)=>{Fh(t,this.h.leftHandLandmarks),ea(this,e)})),this.g.attachEmptyPacketListener(\"left_hand_landmarks\",(t=>{ea(this,t)})),this.g.attachProtoListener(\"left_hand_world_landmarks\",((t,e)=>{var n=this.h.leftHandWorldLandmarks;t=os(t),n.push(Uo(t)),ea(this,e)})),this.g.attachEmptyPacketListener(\"left_hand_world_landmarks\",(t=>{ea(this,t)})),this.g.attachProtoListener(\"right_hand_landmarks\",((t,e)=>{Fh(t,this.h.rightHandLandmarks),ea(this,e)})),this.g.attachEmptyPacketListener(\"right_hand_landmarks\",(t=>{ea(this,t)})),this.g.attachProtoListener(\"right_hand_world_landmarks\",((t,e)=>{var n=this.h.rightHandWorldLandmarks;t=os(t),n.push(Uo(t)),ea(this,e)})),this.g.attachEmptyPacketListener(\"right_hand_world_landmarks\",(t=>{ea(this,t)})),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};Rh.prototype.detectForVideo=Rh.prototype.G,Rh.prototype.detect=Rh.prototype.F,Rh.prototype.setOptions=Rh.prototype.o,Rh.createFromModelPath=function(t,e){return Qa(Rh,t,{baseOptions:{modelAssetPath:e}})},Rh.createFromModelBuffer=function(t,e){return Qa(Rh,t,{baseOptions:{modelAssetBuffer:e}})},Rh.createFromOptions=function(t,e){return Qa(Rh,t,e)},Rh.HAND_CONNECTIONS=vh,Rh.POSE_CONNECTIONS=xh,Rh.FACE_LANDMARKS_LIPS=oh,Rh.FACE_LANDMARKS_LEFT_EYE=ah,Rh.FACE_LANDMARKS_LEFT_EYEBROW=hh,Rh.FACE_LANDMARKS_LEFT_IRIS=ch,Rh.FACE_LANDMARKS_RIGHT_EYE=uh,Rh.FACE_LANDMARKS_RIGHT_EYEBROW=lh,Rh.FACE_LANDMARKS_RIGHT_IRIS=dh,Rh.FACE_LANDMARKS_FACE_OVAL=fh,Rh.FACE_LANDMARKS_CONTOURS=ph,Rh.FACE_LANDMARKS_TESSELATION=gh;var Mh=class extends ih{constructor(t,e){super(new Za(t,e),\"input_image\",\"norm_rect\",!0),this.j={classifications:[]},Cn(t=this.h=new _o,0,1,e=new Cs)}get baseOptions(){return Rn(this.h,Cs,1)}set baseOptions(t){Cn(this.h,0,1,t)}o(t){return Cn(this.h,0,2,Po(t,Rn(this.h,ks,2))),this.l(t)}ua(t,e){return this.j={classifications:[]},eh(this,t,e),this.j}va(t,e,n){return this.j={classifications:[]},nh(this,t,n,e),this.j}m(){var t=new Di;Ii(t,\"input_image\"),Ii(t,\"norm_rect\"),Ui(t,\"classifications\");const e=new yi;Wn(e,vo,this.h);const n=new Li;ki(n,\"mediapipe.tasks.vision.image_classifier.ImageClassifierGraph\"),xi(n,\"IMAGE:input_image\"),xi(n,\"NORM_RECT:norm_rect\"),Si(n,\"CLASSIFICATIONS:classifications\"),n.o(e),Oi(t,n),this.g.attachProtoListener(\"classifications\",((t,e)=>{this.j=function(t){const e={classifications:Pn(t,ps,1).map((t=>Co(Rn(t,Xi,4)?.g()??[],Bn(Nn(t,2),0),jn(t,3))))};return null!=Fe(cn(t,2))&&(e.timestampMs=Bn(Fe(cn(t,2)),0)),e}(ys(t)),ea(this,e)})),this.g.attachEmptyPacketListener(\"classifications\",(t=>{ea(this,t)})),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};Mh.prototype.classifyForVideo=Mh.prototype.va,Mh.prototype.classify=Mh.prototype.ua,Mh.prototype.setOptions=Mh.prototype.o,Mh.createFromModelPath=function(t,e){return Qa(Mh,t,{baseOptions:{modelAssetPath:e}})},Mh.createFromModelBuffer=function(t,e){return Qa(Mh,t,{baseOptions:{modelAssetBuffer:e}})},Mh.createFromOptions=function(t,e){return Qa(Mh,t,e)};var Ph=class extends ih{constructor(t,e){super(new Za(t,e),\"image_in\",\"norm_rect\",!0),this.h=new Eo,this.embeddings={embeddings:[]},Cn(t=this.h,0,1,e=new Cs)}get baseOptions(){return Rn(this.h,Cs,1)}set baseOptions(t){Cn(this.h,0,1,t)}o(t){var e=this.h,n=Rn(this.h,Ss,2);return n=n?n.clone():new Ss,void 0!==t.l2Normalize?Vn(n,1,t.l2Normalize):\"l2Normalize\"in t&&dn(n,1),void 0!==t.quantize?Vn(n,2,t.quantize):\"quantize\"in t&&dn(n,2),Cn(e,0,2,n),this.l(t)}Ba(t,e){return eh(this,t,e),this.embeddings}Ca(t,e,n){return nh(this,t,n,e),this.embeddings}m(){var t=new Di;Ii(t,\"image_in\"),Ii(t,\"norm_rect\"),Ui(t,\"embeddings_out\");const e=new yi;Wn(e,wo,this.h);const n=new Li;ki(n,\"mediapipe.tasks.vision.image_embedder.ImageEmbedderGraph\"),xi(n,\"IMAGE:image_in\"),xi(n,\"NORM_RECT:norm_rect\"),Si(n,\"EMBEDDINGS:embeddings_out\"),n.o(e),Oi(t,n),this.g.attachProtoListener(\"embeddings_out\",((t,e)=>{t=bs(t),this.embeddings=function(t){return{embeddings:Pn(t,Es,1).map((t=>{const e={headIndex:Bn(Nn(t,3),0)??-1,headName:jn(t,4)??\"\"};if(void 0!==Fn(t,_s,xn(t,1)))t=yn(t=Rn(t,_s,xn(t,1)),1,ve),e.floatEmbedding=t.slice();else{const n=new Uint8Array(0);e.quantizedEmbedding=Rn(t,vs,xn(t,2))?.qa()?.h()??n}return e})),timestampMs:Bn(Fe(cn(t,2)),0)}}(t),ea(this,e)})),this.g.attachEmptyPacketListener(\"embeddings_out\",(t=>{ea(this,t)})),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};Ph.cosineSimilarity=function(t,e){if(t.floatEmbedding&&e.floatEmbedding)t=No(t.floatEmbedding,e.floatEmbedding);else{if(!t.quantizedEmbedding||!e.quantizedEmbedding)throw Error(\"Cannot compute cosine similarity between quantized and float embeddings.\");t=No(Do(t.quantizedEmbedding),Do(e.quantizedEmbedding))}return t},Ph.prototype.embedForVideo=Ph.prototype.Ca,Ph.prototype.embed=Ph.prototype.Ba,Ph.prototype.setOptions=Ph.prototype.o,Ph.createFromModelPath=function(t,e){return Qa(Ph,t,{baseOptions:{modelAssetPath:e}})},Ph.createFromModelBuffer=function(t,e){return Qa(Ph,t,{baseOptions:{modelAssetBuffer:e}})},Ph.createFromOptions=function(t,e){return Qa(Ph,t,e)};var Ch=class{constructor(t,e,n){this.confidenceMasks=t,this.categoryMask=e,this.qualityScores=n}close(){this.confidenceMasks?.forEach((t=>{t.close()})),this.categoryMask?.close()}};function Oh(t){t.categoryMask=void 0,t.confidenceMasks=void 0,t.qualityScores=void 0}function Ih(t){try{const e=new Ch(t.confidenceMasks,t.categoryMask,t.qualityScores);if(!t.j)return e;t.j(e)}finally{ia(t)}}Ch.prototype.close=Ch.prototype.close;var Uh=class extends ih{constructor(t,e){super(new Za(t,e),\"image_in\",\"norm_rect\",!1),this.u=[],this.outputCategoryMask=!1,this.outputConfidenceMasks=!0,this.h=new xo,this.v=new To,Cn(this.h,0,3,this.v),Cn(t=this.h,0,1,e=new Cs)}get baseOptions(){return Rn(this.h,Cs,1)}set baseOptions(t){Cn(this.h,0,1,t)}o(t){return void 0!==t.displayNamesLocale?dn(this.h,2,Me(t.displayNamesLocale)):\"displayNamesLocale\"in t&&dn(this.h,2),\"outputCategoryMask\"in t&&(this.outputCategoryMask=t.outputCategoryMask??!1),\"outputConfidenceMasks\"in t&&(this.outputConfidenceMasks=t.outputConfidenceMasks??!0),super.l(t)}L(){!function(t){const e=Pn(t.fa(),Li,1).filter((t=>jn(t,1).includes(\"mediapipe.tasks.TensorsToSegmentationCalculator\")));if(t.u=[],1<e.length)throw Error(\"The graph has more than one mediapipe.tasks.TensorsToSegmentationCalculator.\");1===e.length&&(Rn(e[0],yi,7)?.l()?.g()??new Map).forEach(((e,n)=>{t.u[Number(n)]=jn(e,1)}))}(this)}ga(t,e,n){const r=\"function\"!=typeof e?e:{};return this.j=\"function\"==typeof e?e:n,Oh(this),eh(this,t,r),Ih(this)}Na(t,e,n,r){const i=\"function\"!=typeof n?n:{};return this.j=\"function\"==typeof n?n:r,Oh(this),nh(this,t,i,e),Ih(this)}Fa(){return this.u}m(){var t=new Di;Ii(t,\"image_in\"),Ii(t,\"norm_rect\");const e=new yi;Wn(e,So,this.h);const n=new Li;ki(n,\"mediapipe.tasks.vision.image_segmenter.ImageSegmenterGraph\"),xi(n,\"IMAGE:image_in\"),xi(n,\"NORM_RECT:norm_rect\"),n.o(e),Oi(t,n),na(this,t),this.outputConfidenceMasks&&(Ui(t,\"confidence_masks\"),Si(n,\"CONFIDENCE_MASKS:confidence_masks\"),ra(this,\"confidence_masks\"),this.g.da(\"confidence_masks\",((t,e)=>{this.confidenceMasks=t.map((t=>rh(this,t,!0,!this.j))),ea(this,e)})),this.g.attachEmptyPacketListener(\"confidence_masks\",(t=>{this.confidenceMasks=[],ea(this,t)}))),this.outputCategoryMask&&(Ui(t,\"category_mask\"),Si(n,\"CATEGORY_MASK:category_mask\"),ra(this,\"category_mask\"),this.g.W(\"category_mask\",((t,e)=>{this.categoryMask=rh(this,t,!1,!this.j),ea(this,e)})),this.g.attachEmptyPacketListener(\"category_mask\",(t=>{this.categoryMask=void 0,ea(this,t)}))),Ui(t,\"quality_scores\"),Si(n,\"QUALITY_SCORES:quality_scores\"),this.g.attachFloatVectorListener(\"quality_scores\",((t,e)=>{this.qualityScores=t,ea(this,e)})),this.g.attachEmptyPacketListener(\"quality_scores\",(t=>{this.categoryMask=void 0,ea(this,t)})),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};Uh.prototype.getLabels=Uh.prototype.Fa,Uh.prototype.segmentForVideo=Uh.prototype.Na,Uh.prototype.segment=Uh.prototype.ga,Uh.prototype.setOptions=Uh.prototype.o,Uh.createFromModelPath=function(t,e){return Qa(Uh,t,{baseOptions:{modelAssetPath:e}})},Uh.createFromModelBuffer=function(t,e){return Qa(Uh,t,{baseOptions:{modelAssetBuffer:e}})},Uh.createFromOptions=function(t,e){return Qa(Uh,t,e)};var Dh=class{constructor(t,e,n){this.confidenceMasks=t,this.categoryMask=e,this.qualityScores=n}close(){this.confidenceMasks?.forEach((t=>{t.close()})),this.categoryMask?.close()}};Dh.prototype.close=Dh.prototype.close;var Nh=class extends zn{constructor(t){super(t)}},Bh=[0,jr,-2],Gh=[0,Or,-3,Hr],jh=[0,Or,-3,Hr,Or,-1],Vh=[0,jh],Xh=[0,Vh,Bh],Hh=[0,jh,Bh],Wh=[0,jh,jr,-1],zh=[0,Wh,Bh],Kh=[0,Or,-3,Hr,Bh,-1],Yh=[0,Or,-3,Hr,ti],$h=class extends zn{constructor(t){super(t)}},qh=[0,Or,-1,Hr],Jh=class extends zn{constructor(){super()}};Jh.B=[1];var Zh=class extends zn{constructor(t){super(t)}},Qh=[1,2,3,4,5,6,7,8,9,10,14,15],tc=[0,Qh,Jr,jh,Jr,Hh,Jr,Vh,Jr,Xh,Jr,qh,Jr,Yh,Jr,Gh,Jr,[0,Yr,Or,-2,Hr,jr,Hr,-1,2,Or,Bh],Jr,Wh,Jr,zh,Or,Bh,Yr,Jr,Kh,Jr,[0,Cr,qh]],ec=[0,Yr,jr,-1,Hr],nc=class extends zn{constructor(){super()}};nc.B=[1],nc.prototype.g=si([0,Cr,tc,Yr,ec]);var rc=class extends ih{constructor(t,e){super(new Za(t,e),\"image_in\",\"norm_rect_in\",!1),this.outputCategoryMask=!1,this.outputConfidenceMasks=!0,this.h=new xo,this.v=new To,Cn(this.h,0,3,this.v),Cn(t=this.h,0,1,e=new Cs)}get baseOptions(){return Rn(this.h,Cs,1)}set baseOptions(t){Cn(this.h,0,1,t)}o(t){return\"outputCategoryMask\"in t&&(this.outputCategoryMask=t.outputCategoryMask??!1),\"outputConfidenceMasks\"in t&&(this.outputConfidenceMasks=t.outputConfidenceMasks??!0),super.l(t)}ga(t,e,n,r){const i=\"function\"!=typeof n?n:{};this.j=\"function\"==typeof n?n:r,this.qualityScores=this.categoryMask=this.confidenceMasks=void 0,n=this.J+1,r=new nc;const s=new Zh;var o=new Nh;if(Xn(o,1,255),Cn(s,0,12,o),e.keypoint&&e.scribble)throw Error(\"Cannot provide both keypoint and scribble.\");if(e.keypoint){var a=new $h;Vn(a,3,!0),Hn(a,1,e.keypoint.x),Hn(a,2,e.keypoint.y),On(s,5,Qh,a)}else{if(!e.scribble)throw Error(\"Must provide either a keypoint or a scribble.\");for(a of(o=new Jh,e.scribble))Vn(e=new $h,3,!0),Hn(e,1,a.x),Hn(e,2,a.y),Dn(o,1,$h,e);On(s,15,Qh,o)}Dn(r,1,Zh,s),this.g.addProtoToStream(r.g(),\"drishti.RenderData\",\"roi_in\",n),eh(this,t,i);t:{try{const t=new Dh(this.confidenceMasks,this.categoryMask,this.qualityScores);if(!this.j){var h=t;break t}this.j(t)}finally{ia(this)}h=void 0}return h}m(){var t=new Di;Ii(t,\"image_in\"),Ii(t,\"roi_in\"),Ii(t,\"norm_rect_in\");const e=new yi;Wn(e,So,this.h);const n=new Li;ki(n,\"mediapipe.tasks.vision.interactive_segmenter.InteractiveSegmenterGraph\"),xi(n,\"IMAGE:image_in\"),xi(n,\"ROI:roi_in\"),xi(n,\"NORM_RECT:norm_rect_in\"),n.o(e),Oi(t,n),na(this,t),this.outputConfidenceMasks&&(Ui(t,\"confidence_masks\"),Si(n,\"CONFIDENCE_MASKS:confidence_masks\"),ra(this,\"confidence_masks\"),this.g.da(\"confidence_masks\",((t,e)=>{this.confidenceMasks=t.map((t=>rh(this,t,!0,!this.j))),ea(this,e)})),this.g.attachEmptyPacketListener(\"confidence_masks\",(t=>{this.confidenceMasks=[],ea(this,t)}))),this.outputCategoryMask&&(Ui(t,\"category_mask\"),Si(n,\"CATEGORY_MASK:category_mask\"),ra(this,\"category_mask\"),this.g.W(\"category_mask\",((t,e)=>{this.categoryMask=rh(this,t,!1,!this.j),ea(this,e)})),this.g.attachEmptyPacketListener(\"category_mask\",(t=>{this.categoryMask=void 0,ea(this,t)}))),Ui(t,\"quality_scores\"),Si(n,\"QUALITY_SCORES:quality_scores\"),this.g.attachFloatVectorListener(\"quality_scores\",((t,e)=>{this.qualityScores=t,ea(this,e)})),this.g.attachEmptyPacketListener(\"quality_scores\",(t=>{this.categoryMask=void 0,ea(this,t)})),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};rc.prototype.segment=rc.prototype.ga,rc.prototype.setOptions=rc.prototype.o,rc.createFromModelPath=function(t,e){return Qa(rc,t,{baseOptions:{modelAssetPath:e}})},rc.createFromModelBuffer=function(t,e){return Qa(rc,t,{baseOptions:{modelAssetBuffer:e}})},rc.createFromOptions=function(t,e){return Qa(rc,t,e)};var ic=class extends ih{constructor(t,e){super(new Za(t,e),\"input_frame_gpu\",\"norm_rect\",!1),this.j={detections:[]},Cn(t=this.h=new Lo,0,1,e=new Cs)}get baseOptions(){return Rn(this.h,Cs,1)}set baseOptions(t){Cn(this.h,0,1,t)}o(t){return void 0!==t.displayNamesLocale?dn(this.h,2,Me(t.displayNamesLocale)):\"displayNamesLocale\"in t&&dn(this.h,2),void 0!==t.maxResults?Xn(this.h,3,t.maxResults):\"maxResults\"in t&&dn(this.h,3),void 0!==t.scoreThreshold?Hn(this.h,4,t.scoreThreshold):\"scoreThreshold\"in t&&dn(this.h,4),void 0!==t.categoryAllowlist?Tn(this.h,5,t.categoryAllowlist):\"categoryAllowlist\"in t&&dn(this.h,5),void 0!==t.categoryDenylist?Tn(this.h,6,t.categoryDenylist):\"categoryDenylist\"in t&&dn(this.h,6),this.l(t)}F(t,e){return this.j={detections:[]},eh(this,t,e),this.j}G(t,e,n){return this.j={detections:[]},nh(this,t,n,e),this.j}m(){var t=new Di;Ii(t,\"input_frame_gpu\"),Ii(t,\"norm_rect\"),Ui(t,\"detections\");const e=new yi;Wn(e,Fo,this.h);const n=new Li;ki(n,\"mediapipe.tasks.vision.ObjectDetectorGraph\"),xi(n,\"IMAGE:input_frame_gpu\"),xi(n,\"NORM_RECT:norm_rect\"),Si(n,\"DETECTIONS:detections\"),n.o(e),Oi(t,n),this.g.attachProtoVectorListener(\"detections\",((t,e)=>{for(const e of t)t=ns(e),this.j.detections.push(Oo(t));ea(this,e)})),this.g.attachEmptyPacketListener(\"detections\",(t=>{ea(this,t)})),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};ic.prototype.detectForVideo=ic.prototype.G,ic.prototype.detect=ic.prototype.F,ic.prototype.setOptions=ic.prototype.o,ic.createFromModelPath=async function(t,e){return Qa(ic,t,{baseOptions:{modelAssetPath:e}})},ic.createFromModelBuffer=function(t,e){return Qa(ic,t,{baseOptions:{modelAssetBuffer:e}})},ic.createFromOptions=function(t,e){return Qa(ic,t,e)};var sc=class{constructor(t,e,n){this.landmarks=t,this.worldLandmarks=e,this.segmentationMasks=n}close(){this.segmentationMasks?.forEach((t=>{t.close()}))}};function oc(t){t.landmarks=[],t.worldLandmarks=[],t.segmentationMasks=void 0}function ac(t){try{const e=new sc(t.landmarks,t.worldLandmarks,t.segmentationMasks);if(!t.j)return e;t.j(e)}finally{ia(t)}}sc.prototype.close=sc.prototype.close;var hc=class extends ih{constructor(t,e){super(new Za(t,e),\"image_in\",\"norm_rect\",!1),this.landmarks=[],this.worldLandmarks=[],this.outputSegmentationMasks=!1,Cn(t=this.h=new Ro,0,1,e=new Cs),this.D=new go,Cn(this.h,0,3,this.D),this.v=new fo,Cn(this.h,0,2,this.v),Xn(this.v,4,1),Hn(this.v,2,.5),Hn(this.D,2,.5),Hn(this.h,4,.5)}get baseOptions(){return Rn(this.h,Cs,1)}set baseOptions(t){Cn(this.h,0,1,t)}o(t){return\"numPoses\"in t&&Xn(this.v,4,t.numPoses??1),\"minPoseDetectionConfidence\"in t&&Hn(this.v,2,t.minPoseDetectionConfidence??.5),\"minTrackingConfidence\"in t&&Hn(this.h,4,t.minTrackingConfidence??.5),\"minPosePresenceConfidence\"in t&&Hn(this.D,2,t.minPosePresenceConfidence??.5),\"outputSegmentationMasks\"in t&&(this.outputSegmentationMasks=t.outputSegmentationMasks??!1),this.l(t)}F(t,e,n){const r=\"function\"!=typeof e?e:{};return this.j=\"function\"==typeof e?e:n,oc(this),eh(this,t,r),ac(this)}G(t,e,n,r){const i=\"function\"!=typeof n?n:{};return this.j=\"function\"==typeof n?n:r,oc(this),nh(this,t,i,e),ac(this)}m(){var t=new Di;Ii(t,\"image_in\"),Ii(t,\"norm_rect\"),Ui(t,\"normalized_landmarks\"),Ui(t,\"world_landmarks\"),Ui(t,\"segmentation_masks\");const e=new yi;Wn(e,Mo,this.h);const n=new Li;ki(n,\"mediapipe.tasks.vision.pose_landmarker.PoseLandmarkerGraph\"),xi(n,\"IMAGE:image_in\"),xi(n,\"NORM_RECT:norm_rect\"),Si(n,\"NORM_LANDMARKS:normalized_landmarks\"),Si(n,\"WORLD_LANDMARKS:world_landmarks\"),n.o(e),Oi(t,n),na(this,t),this.g.attachProtoVectorListener(\"normalized_landmarks\",((t,e)=>{this.landmarks=[];for(const e of t)t=us(e),this.landmarks.push(Io(t));ea(this,e)})),this.g.attachEmptyPacketListener(\"normalized_landmarks\",(t=>{this.landmarks=[],ea(this,t)})),this.g.attachProtoVectorListener(\"world_landmarks\",((t,e)=>{this.worldLandmarks=[];for(const e of t)t=os(e),this.worldLandmarks.push(Uo(t));ea(this,e)})),this.g.attachEmptyPacketListener(\"world_landmarks\",(t=>{this.worldLandmarks=[],ea(this,t)})),this.outputSegmentationMasks&&(Si(n,\"SEGMENTATION_MASK:segmentation_masks\"),ra(this,\"segmentation_masks\"),this.g.da(\"segmentation_masks\",((t,e)=>{this.segmentationMasks=t.map((t=>rh(this,t,!0,!this.j))),ea(this,e)})),this.g.attachEmptyPacketListener(\"segmentation_masks\",(t=>{this.segmentationMasks=[],ea(this,t)}))),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};hc.prototype.detectForVideo=hc.prototype.G,hc.prototype.detect=hc.prototype.F,hc.prototype.setOptions=hc.prototype.o,hc.createFromModelPath=function(t,e){return Qa(hc,t,{baseOptions:{modelAssetPath:e}})},hc.createFromModelBuffer=function(t,e){return Qa(hc,t,{baseOptions:{modelAssetBuffer:e}})},hc.createFromOptions=function(t,e){return Qa(hc,t,e)},hc.POSE_CONNECTIONS=xh;export{Na as DrawingUtils,sh as FaceDetector,yh as FaceLandmarker,_h as FaceStylizer,Xo as FilesetResolver,Ah as GestureRecognizer,kh as HandLandmarker,Rh as HolisticLandmarker,Mh as ImageClassifier,Ph as ImageEmbedder,Uh as ImageSegmenter,Ch as ImageSegmenterResult,rc as InteractiveSegmenter,Dh as InteractiveSegmenterResult,Ka as MPImage,Sa as MPMask,ic as ObjectDetector,hc as PoseLandmarker,ih as VisionTaskRunner};\n//# sourceMappingURL=vision_bundle_mjs.js.map\n","import type { ArrayKeys, EitherKey, ObjectKeys } from '../Types.js';\n\n/**\n * Adds an array o [k,v] to the map, returning a new instance\n * @param map Initial data\n * @param data Data to add\n * @returns New map with data added\n */\nconst addArray = <K, V>(\n  map: ReadonlyMap<K, V>,\n  data: ArrayKeys<K, V>\n): ReadonlyMap<K, V> => {\n  const x = new Map<K, V>(map.entries());\n  for (const d of data) {\n    if (d[ 0 ] === undefined) throw new Error(`key cannot be undefined`);\n    if (d[ 1 ] === undefined) throw new Error(`value cannot be undefined`);\n    x.set(d[ 0 ], d[ 1 ]);\n  }\n  return x;\n};\n\n/**\n * Adds objects to the map, returning a new instance\n * @param map Initial data\n * @param data Data to add\n * @returns A new map with data added\n */\nconst addObjects = <K, V>(\n  map: ReadonlyMap<K, V>,\n  data: ObjectKeys<K, V>\n): ReadonlyMap<K, V> => {\n  const x = new Map<K, V>(map.entries());\n  for (const d of data) {\n    if (d.key === undefined) throw new Error(`key cannot be undefined`);\n    if (d.value === undefined) throw new Error(`value cannot be undefined`);\n\n    x.set(d.key, d.value);\n  }\n  return x;\n};\n\n/**\n * Returns true if map contains key\n *\n * @example\n * ```js\n * if (has(map, `London`)) ...\n * ```\n * @param map Map to search\n * @param key Key to find\n * @returns True if map contains key\n */\nexport const has = <K, V>(map: ReadonlyMap<K, V>, key: K): boolean =>\n  map.has(key);\n\n/**\n * Adds data to a map, returning the new map.\n *\n * Can add items in the form of [key,value] or {key, value}.\n * @example These all produce the same result\n * ```js\n * map.set(`hello`, `samantha`);\n * map.add([`hello`, `samantha`]);\n * map.add({key: `hello`, value: `samantha`})\n * ```\n * @param map Initial data\n * @param data One or more data to add in the form of [key,value] or {key, value}\n * @returns New map with data added\n */\nexport const add = <K, V>(\n  map: ReadonlyMap<K, V>,\n  ...data: EitherKey<K, V>\n): ReadonlyMap<K, V> => {\n  if (map === undefined) throw new Error(`map parameter is undefined`);\n  if (data === undefined) throw new Error(`data parameter i.s undefined`);\n  if (data.length === 0) return map;\n\n  const firstRecord = data[ 0 ];\n  const isObject =\n    typeof (firstRecord as { readonly key: K; readonly value: V }).key !==\n    `undefined` &&\n    typeof (firstRecord as { readonly key: K; readonly value: V }).value !==\n    `undefined`; //(typeof (data[0] as {readonly key:K}).key !== undefined && typeof (data[0] as {readonly value:V}).value !== undefined);\n  return isObject\n    ? addObjects(map, data as ObjectKeys<K, V>)\n    : addArray(map, data as ArrayKeys<K, V>);\n};\n\n/**\n * Sets data in a copy of the initial map\n * @param map Initial map\n * @param key Key\n * @param value Value to  set\n * @returns New map with data set\n */\nexport const set = <K, V>(map: ReadonlyMap<K, V>, key: K, value: V) => {\n  const x = new Map<K, V>(map.entries());\n  x.set(key, value);\n  return x;\n};\n\n/**\n * Delete a key from the map, returning a new map\n * @param map Initial data\n * @param key\n * @returns New map with data deleted\n */\nexport const del = <K, V>(\n  map: ReadonlyMap<K, V>,\n  key: K\n): ReadonlyMap<K, V> => {\n  const x = new Map<K, V>(map.entries());\n  x.delete(key);\n  return x;\n};\n","import { type EitherKey } from '../Types.js';\nimport type { IMapBase } from './IMapBase.js';\nimport { add, del, set } from './MapImmutableFns.js';\n\n/**\n * An immutable map. Rather than changing the map, functions like `add` and `delete`\n * return a new map reference which must be captured.\n *\n * Immutable data is useful because as it gets passed around your code, it never\n * changes from underneath you. You have what you have.\n *\n * @example\n * ```js\n * let m = map(); // Create\n * let m2 = m.set(`hello`, `samantha`);\n * // m is still empty, only m2 contains a value.\n * ```\n *\n * @typeParam K - Type of map keys. Typically `string`\n * @typeParam V - Type of stored values\n */\n//eslint-disable-next-line @typescript-eslint/consistent-type-definitions\nexport interface IMapImmutable<K, V> extends IMapBase<K, V> {\n  /**\n   * Adds one or more items, returning the changed map.\n   *\n   * Can add items in the form of `[key,value]` or `{key, value}`.\n   * @example These all produce the same result\n   * ```js\n   * map.set(`hello`, `samantha`);\n   * map.add([`hello`, `samantha`]);\n   * map.add({key: `hello`, value: `samantha`})\n   * ```\n   * @param itemsToAdd\n   */\n  add(...itemsToAdd: EitherKey<K, V>): IMapImmutable<K, V>;\n  /**\n   * Deletes an item by key, returning the changed map\n   * @param key\n   */\n  delete(key: K): IMapImmutable<K, V>;\n  /**\n   * Returns an empty map\n   */\n  clear(): IMapImmutable<K, V>;\n\n\n  /**\n   * Sets `key` to be `value`, overwriting anything existing.\n   * Returns a new map with added key.\n   * @param key\n   * @param value\n   */\n  set(key: K, value: V): IMapImmutable<K, V>;\n\n}\n\n/**\n * Returns an {@link IMapImmutable}.\n * Use {@link Maps.mutable} as a mutable alternatve.\n *\n * @example Basic usage\n * ```js\n * // Creating\n * let m = map();\n * // Add\n * m = m.set(\"name\", \"sally\");\n * // Recall\n * m.get(\"name\");\n * ```\n *\n * @example Enumerating\n * ```js\n * for (const [key, value] of map.entries()) {\n *  console.log(`${key} = ${value}`);\n * }\n * ```\n *\n * @example Overview\n * ```js\n * // Create\n * let m = map();\n * // Add as array or key & value pair\n * m = m.add([\"name\" , \"sally\"]);\n * m = m.add({ key: \"name\", value: \"sally\" });\n * // Add using the more typical set\n * m = m.set(\"name\", \"sally\");\n * m.get(\"name\");   // \"sally\";\n * m.has(\"age\");    // false\n * m.has(\"name\");   // true\n * m.isEmpty;       // false\n * m = m.delete(\"name\");\n * m.entries();     // Iterator of key value pairs\n * ```\n *\n * Since it is immutable, `add()`, `delete()` and `clear()` return a new version with change.\n *\n * @param dataOrMap Optional initial data in the form of an array of `{ key: value }` or `[ key, value ]`\n */\nexport const immutable = <K, V>(\n  dataOrMap?: ReadonlyMap<K, V> | EitherKey<K, V>\n): IMapImmutable<K, V> => {\n  if (dataOrMap === undefined) return immutable([]);\n  if (Array.isArray(dataOrMap)) return immutable<K, V>(add(new Map(), ...dataOrMap));\n\n  const data = dataOrMap as ReadonlyMap<K, V>;\n  return {\n    add: (...itemsToAdd: EitherKey<K, V>) => {\n      const s = add(data, ...itemsToAdd);\n      return immutable(s);\n    },\n    set: (key: K, value: V) => {\n      const s = set(data, key, value);\n      return immutable(s);\n    },\n    get: (key: K) => data.get(key),\n    delete: (key: K) => immutable(del(data, key)),\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    clear: () => immutable(),\n    has: (key: K) => data.has(key),\n    entries: () => data.entries(),\n    values: () => data.values(),\n    isEmpty: () => data.size === 0,\n  };\n};\n","/**\n * Simple map for numbers.\n * \n * Keys not present in map return the `defaultValue` given in the constructor\n * ```js\n * // All keys default to zero.\n * const map = new NumberMap();\n * map.get(`hello`); // 0\n * ```\n * \n * To check if a key is present, use `has`:\n * ```js\n * map.has(`hello`); // false\n * ```\n * \n * Math:\n * ```js\n * // Adds 1 by default to value of `hello`\n * map.add(`hello`);         // 1\n * map.multiply(`hello`, 2); // 2 \n * \n * // Reset key to default value\n * map.reset(`hello`); // 0\n * ```\n * \n * Different default value:\n * ```js\n * const map = new NumberMap(10);\n * map.get(`hello`); // 10\n * ```\n * \n * Regular `set` works as well:\n * ```js\n * map.set(`hello`, 5);\n * map.add(`hello`, 2); // 7\n * ```\n */\nexport class NumberMap<K> extends Map<K, number> {\n  readonly defaultValue: number;\n\n  constructor(defaultValue = 0) {\n    super();\n    this.defaultValue = defaultValue;\n  }\n\n  get(key: K): number {\n    const v = super.get(key);\n    if (v === undefined) return this.defaultValue;\n    return v;\n  }\n\n  reset(key: K): number {\n    super.set(key, this.defaultValue);\n    return this.defaultValue;\n  }\n\n  multiply(key: K, amount: number): number {\n    const v = super.get(key);\n    let value = v ?? this.defaultValue;\n    value *= amount;\n    super.set(key, value);\n    return value;\n  }\n\n  add(key: K, amount = 1): number {\n    const v = super.get(key);\n    let value = v ?? this.defaultValue;\n    value += amount;\n    super.set(key, value);\n    return value;\n  }\n\n  subtract(key: K, amount = 1): number {\n    const v = super.get(key);\n    let value = v ?? this.defaultValue;\n    value -= amount;\n    super.set(key, value);\n    return value;\n  }\n}","import type { GuardResultFail, GuardResultOk } from \"./GuardTypes.js\";\n\nexport const throwFromResult = (test: GuardResultFail | GuardResultOk) => {\n  if (test[ 0 ]) return false;\n  else throw new Error(test[ 1 ]);\n}","import { throwFromResult } from \"./GuardThrowFromResult.js\";\nimport type { GuardResult, NumberGuardRange } from \"./GuardTypes.js\";\n\n/**\n * Returns true if `x` is a power of two\n * @param x\n * @returns True if `x` is a power of two\n */\nexport const isPowerOfTwo = (x: number) => Math.log2(x) % 1 === 0;\n\n\n/**\n * Returns `fallback` if `v` is NaN, otherwise returns `v`.\n *\n * Throws if `v` is not a number type.\n * @param v\n * @param fallback\n * @returns\n */\nexport const ifNaN = (v: number, fallback: number): number => {\n  // ✔️ Unit tested\n\n  if (Number.isNaN(v)) return fallback;\n  if (typeof v !== `number`) {\n    throw new TypeError(`v is not a number. Got: ${ typeof v }`);\n  }\n  return v;\n};\n\n/**\n * Parses `value` as an integer, returning it if it meets the `range` criteria.\n * If not, `defaultValue` is returned.\n *\n * ```js\n * const i = integerParse('10', 'positive');    // 10\n * const i = integerParse('10.5', 'positive');  // 10\n * const i = integerParse('0', 'nonZero', 100); // 100\n * ```\n *\n * NaN is returned if criteria does not match and no default is given\n * ```js\n * const i = integerParse('10', 'negative');    // NaN\n * ```\n *\n * @param value\n * @param range\n * @param defaultValue\n * @returns\n */\nexport const integerParse = (\n  //eslint-disable-next-line @typescript-eslint/no-explicit-any\n  value: any,\n  range: NumberGuardRange = ``,\n  defaultValue: number = Number.NaN\n): number => {\n  // ✔️ Unit tested\n  if (value === undefined) return defaultValue;\n  if (value === null) return defaultValue;\n  try {\n    const parsed = Number.parseInt(value);\n    const r = integerTest(parsed, range, `parsed`);\n    return r[ 0 ] ? parsed : defaultValue;\n  } catch {\n    return defaultValue;\n  }\n};\n\n\n/**\n * Checks if `t` is not a number or within specified range.\n * Returns `[false, reason:string]` if invalid or `[true]` if valid.\n * Use {@link throwNumberTest} to throw an error rather than return result.\n * \n * Alternatives: {@link integerTest} for additional integer check, {@link percentTest} for percentage-range.\n *\n * * (empty, default): must be a number type and not NaN.\n * * finite: must be a number, not NaN and not infinite\n * * positive: must be at least zero\n * * negative: must be zero or lower\n * * aboveZero: must be above zero\n * * belowZero: must be below zero\n * * percentage: must be within 0-1, inclusive\n * * nonZero: can be anything except zero\n * * bipolar: can be -1 to 1, inclusive\n * @param value Value to check\n * @param parameterName Name of parameter (for more helpful exception messages)\n * @param range Range to enforce\n * @returns\n */\nexport const numberTest = (\n  value?: unknown,\n  range: NumberGuardRange = ``,\n  parameterName = `?`,\n): GuardResult => {\n  if (value === null) return [ false, `Parameter '${ parameterName }' is null` ];\n  if (typeof value === `undefined`) {\n    return [ false, `Parameter '${ parameterName }' is undefined` ];\n  }\n  if (Number.isNaN(value)) {\n    return [ false, `Parameter '${ parameterName }' is NaN` ];\n  }\n  if (typeof value !== `number`) {\n    return [ false, `Parameter '${ parameterName }' is not a number (${ JSON.stringify(value) })` ];\n  }\n  switch (range) {\n    case `finite`: {\n      if (!Number.isFinite(value)) {\n        return [ false, `Parameter '${ parameterName } must be finite` ];\n      }\n    }\n    case `positive`: {\n      if (value < 0) {\n        return [ false, `Parameter '${ parameterName }' must be at least zero (${ value })` ];\n      }\n      break;\n    } case `negative`: {\n      if (value > 0) {\n        return [ false, `Parameter '${ parameterName }' must be zero or lower (${ value })` ];\n      }\n      break;\n    }\n    case `aboveZero`: {\n      if (value <= 0) {\n        return [ false, `Parameter '${ parameterName }' must be above zero (${ value })` ]\n\n      }\n      break;\n    }\n    case `belowZero`: {\n      if (value >= 0) {\n        return [ false, `Parameter '${ parameterName }' must be below zero (${ value })` ];\n      }\n      break;\n    }\n    case `percentage`: {\n      if (value > 1 || value < 0) {\n        return [ false, `Parameter '${ parameterName }' must be in percentage range (0 to 1). (${ value })` ]\n      }\n      break;\n    }\n    case `nonZero`: {\n      if (value === 0) {\n        return [ false, `Parameter '${ parameterName }' must non-zero. (${ value })` ];\n      }\n      break;\n    }\n    case `bipolar`: {\n      if (value > 1 || value < -1) {\n        return [ false, `Parameter '${ parameterName }' must be in bipolar percentage range (-1 to 1). (${ value })` ];\n      }\n      break;\n    }\n  }\n  return [ true ];\n};\n\n/**\n * Checks if `t` is not a number or within specified range.\n * Throws if invalid. Use {@link numberTest} to test without throwing.\n *\n* * (empty, default): must be a number type and not NaN.\n* * positive: must be at least zero\n* * negative: must be zero or lower\n* * aboveZero: must be above zero\n* * belowZero: must be below zero\n* * percentage: must be within 0-1, inclusive\n* * nonZero: can be anything except zero\n* * bipolar: can be -1 to 1, inclusive\n* \n * Alternatives: {@link integerTest} for additional integer check, {@link percentTest} for percentage-range.\n * @param value Value to test\n * @param range Range\n * @param parameterName Name of parameter \n */\nexport const throwNumberTest = (value?: unknown,\n  range: NumberGuardRange = ``,\n  parameterName = `?`) => {\n  throwFromResult(numberTest(value, range, parameterName));\n}\n\n/**\n * Returns test of `value` being in the range of 0-1.\n * Equiv to `number(value, `percentage`);`\n *\n * This is the same as calling ```number(t, `percentage`)```\n * @param value Value to check\n * @param parameterName Param name for customising exception message\n * @returns\n */\nexport const percentTest = (value: number, parameterName = `?`): GuardResult =>\n  numberTest(value, `percentage`, parameterName);\n\nexport const throwPercentTest = (value: number, parameterName = `?`) => {\n  throwFromResult(percentTest(value, parameterName));\n}\n/**\n * Checks if `value` an integer and meets additional criteria.\n * See {@link numberTest} for guard details, or use that if integer checking is not required.\n *\n * Note:\n * * `bipolar` will mean -1, 0 or 1.\n * * positive: must be at least zero\n * * negative: must be zero or lower\n * * aboveZero: must be above zero\n * * belowZero: must be below zero\n * * percentage: must be within 0-1, inclusive\n * * nonZero: can be anything except zero\n * @param value Value to check\n * @param parameterName Param name for customising exception message\n * @param range Guard specifier.\n */\nexport const integerTest = (\n  value: number | undefined,\n  range: NumberGuardRange = ``,\n  parameterName = `?`\n): GuardResult => {\n  // ✔️ Unit tested\n  const r = numberTest(value, range, parameterName);\n  if (!r[ 0 ]) return r;\n  if (!Number.isInteger(value)) {\n    return [ false, `Param '${ parameterName }' is not an integer` ];\n  }\n  return [ true ];\n};\n\nexport const throwIntegerTest = (value: number | undefined,\n  range: NumberGuardRange = ``,\n  parameterName = `?`) => {\n  throwFromResult(integerTest(value, range, parameterName));\n}\n","import { throwIntegerTest, throwNumberTest } from \"../util/GuardNumbers.js\";\n\nexport function round(decimalPlaces: number, v: number): number;\nexport function round(decimalPlaces: number): (v: number) => number;\n\n/**\n * Rounds a number.\n *\n * If one parameter is given, it's the decimal places,\n * and a rounding function is returned:\n * ```js\n * import { round } from 'https://unpkg.com/ixfx/dist/numbers.js';\n * const r = round(2);\n * r(10.12355); // 10.12\n * ```\n *\n * If two parameters are given, the first is decimal places,\n * the second the value to round.\n * ```js\n * round(2, 10.12355); // 10.12\n * ```\n * @param decimalPlaces\n * @returns\n */\nexport function round(a: number, b?: number) {\n  throwIntegerTest(a, `positive`, `decimalPlaces`);\n\n  //eslint-disable-next-line functional/no-let\n  let rounder;\n  if (a === 0) rounder = Math.round;\n  else {\n    const p = Math.pow(10, a);\n    rounder = (v: number) => Math.floor(v * p) / p;\n  }\n\n  return b === undefined ? rounder : rounder(b);\n}\n\n\n/**\n * Rounds `v` up to the nearest multiple of `multiple`\n * ```\n * roundMultiple(19, 20); // 20\n * roundMultiple(21, 20); // 40\n * ```\n * @param v\n * @param multiple\n * @returns\n */\n// export const roundUpToMultiple = (v: number, multiple: number): number => {\n//   throwNumberTest(v, `nonZero`, `v`);\n//   throwNumberTest(multiple, `nonZero`, `multiple`);\n//   return Math.ceil(v / multiple) * multiple;\n// };\n","import { numberTest } from '../util/GuardNumbers.js';\nimport { round } from '../numbers/Round.js';\n\n/**\n * Interval types allows for more expressive coding, rather than embedding millisecond values.\n * \n * That is, we can use `{ mins: 5 }` to mean 5 minutes rather than `5*60*1000` \n * or worse, 300000, for the same value.\n *\n * @example\n * ```js\n * { hours: 1 };  // 1 hour\n * { mins: 5 };   // 5 mins\n * { secs: 5 };   // 5 secs\n * { millis: 5 }; // 5 milliseconds\n * ```\n * \n * If several fields are used, this sums their value\n * ```js\n * { secs: 2, millis: 1 }; // equal 2001 milliseconds.\n * ```\n * \n * Wherever ixfx takes an `Interval`, you can also just provide a number instead.\n * This will be taken as a millisecond value.\n * \n * @see {@link intervalToMs} to convert to milliseconds.\n * @see {@link isInterval} check whether input is an Interval type\n * @see {@link elapsedToHumanString} render interval in human-friendly form\n */\nexport type Interval =\n  | number\n  | {\n    readonly millis?: number;\n    readonly secs?: number;\n    readonly hours?: number;\n    readonly mins?: number;\n  };\n\n// export function intervalToMs(interval: Interval | undefined): number | undefined;\n// export function intervalToMs(\n//   interval: Interval | undefined,\n//   defaultNumber: number\n// ): number;\n\n\n/**\n * Return the millisecond value of an Interval.\n * \n * ```js\n * intervalToMs(100); // 100\n * intervalToMs({ millis: 100 }); // 100\n * ```\n *\n * Use `defaultNumber` to return a default in the case of\n * _undefined_ or invalid input.\n *\n * ```js\n * intervalToMs(undefined);      // throws error\n * intervalToMs(undefined, 100); // 100\n * ```\n *\n * If no default is provided, an exception is thrown.\n * @param interval Interval\n * @param defaultNumber Default value if `interval` is _undefined_ or invalid\n * @returns Milliseconds\n */\nexport function intervalToMs(\n  interval: Interval | undefined,\n  defaultNumber?: number\n): number {\n  if (isInterval(interval)) {\n    // Number given, must be millis?\n    if (typeof interval === `number`) return interval;\n\n    let ms = interval.millis ?? 0;\n    ms += (interval.hours ?? 0) * 60 * 60 * 1000;\n    ms += (interval.mins ?? 0) * 60 * 1000;\n    ms += (interval.secs ?? 0) * 1000;\n    return ms;\n  } else {\n    if (typeof defaultNumber !== `undefined`) return defaultNumber;\n    throw new Error(`Not a valid interval: ${ interval }`);\n  }\n}\n\n/**\n * Returns _true_ if `interval` matches the {@link Interval} type.\n * @param interval \n * @returns _True_ if `interval` is an {@link Interval}.\n */\nexport function isInterval(interval: number | Interval | undefined): interval is Interval {\n  if (interval === undefined) return false;\n  if (interval === null) return false;\n  if (typeof interval === `number`) {\n    if (Number.isNaN(interval)) return false;\n    if (!Number.isFinite(interval)) return false;\n    return true;\n  } else if (typeof interval !== `object`) return false;\n\n  const hasMillis = `millis` in interval;\n  const hasSecs = `secs` in interval;\n  const hasMins = `mins` in interval;\n  const hasHours = `hours` in interval;\n  if (hasMillis && !numberTest(interval.millis)[ 0 ]) return false;\n  if (hasSecs && !numberTest(interval.secs)[ 0 ]) return false;\n  if (hasMins && !numberTest(interval.mins)[ 0 ]) return false;\n  if (hasHours && !numberTest(interval.hours)[ 0 ]) return false;\n  if (hasMillis || hasSecs || hasHours || hasMins) return true;\n  return false;\n}\n\n/**\n * Returns a human-readable representation\n * of some elapsed milliseconds\n * \n * @example\n * ```js\n * elapsedToHumanString(10);      // `10ms`\n * elapsedToHumanString(2000);    // `2s`\n * elapsedToHumanString(65*1000); // `1mins`\n * ```\n * @param millisOrFunction Milliseconds as a number, {@link Interval} or function that resolve to a number\n * @param rounding Rounding (default: 2)\n * @returns \n */\nexport const elapsedToHumanString = (millisOrFunction: number | (() => number) | Interval, rounding = 2): string => {\n  let interval: number | undefined = {} = 0;\n  if (typeof millisOrFunction === `function`) {\n    const intervalResult = millisOrFunction();\n    return elapsedToHumanString(intervalResult);\n  } else if (typeof millisOrFunction === `number`) {\n    interval = millisOrFunction;\n  } else if (typeof millisOrFunction === `object`) {\n    interval = intervalToMs(interval);\n  }\n\n  let ms = intervalToMs(interval);\n  if (typeof ms === `undefined`) return `(undefined)`;\n  if (ms < 1000) return `${ round(rounding, ms) }ms`;\n  ms /= 1000;\n  if (ms < 120) return `${ ms.toFixed(1) }secs`;\n  ms /= 60;\n  if (ms < 60) return `${ ms.toFixed(2) }mins`;\n  ms /= 60;\n  return `${ ms.toFixed(2) }hrs`;\n};","export type ToString<V> = (itemToMakeStringFor: V) => string;\n// Via Vuejs\n// eslint-disable-next-line @typescript-eslint/unbound-method\nconst objectToString = Object.prototype.toString\nconst toTypeString = (value: unknown): string =>\n  objectToString.call(value)\nexport const isMap = (value: unknown): value is Map<any, any> =>\n  toTypeString(value) === `[object Map]`\nexport const isSet = (value: unknown): value is Set<any> =>\n  toTypeString(value) === `[object Set]`\n\n/**\n * A default converter to string that uses JSON.stringify if its an object, or the thing itself if it's a string\n */\nexport const toStringDefault = <V>(itemToMakeStringFor: V): string =>\n  typeof itemToMakeStringFor === `string`\n    ? itemToMakeStringFor\n    : JSON.stringify(itemToMakeStringFor);\n\n//eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport const defaultToString = (object: any): string => {\n  //ECMA specification: http://www.ecma-international.org/ecma-262/6.0/#sec-tostring\n  if (object === null) return `null`;\n  if (typeof object === `boolean` || typeof object === `number`) {\n    return object.toString();\n  }\n\n  if (typeof object === `string`) return object;\n  if (typeof object === `symbol`) throw new TypeError(`Symbol cannot be converted to string`);\n  return JSON.stringify(object);\n};","import { toStringDefault } from \"./ToString.js\";\n\n/**\n * If input is a string, it is returned.\n * Otherwise, it returns the result of JSON.stringify() with fields ordered.\n * \n * This allows for more consistent comparisons when object field orders are different but values the same.\n * @param itemToMakeStringFor \n * @returns \n */\nexport const toStringOrdered = (itemToMakeStringFor: any) => {\n  if (typeof itemToMakeStringFor === `string`) return itemToMakeStringFor;\n  const allKeys = new Set<string>();\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n  JSON.stringify(itemToMakeStringFor, (key: string, value: any) => (allKeys.add(key), value));\n  return JSON.stringify(itemToMakeStringFor, [ ...allKeys ].sort());\n}\n\n/**\n * Function that returns true if `a` and `b` are considered equal\n */\nexport type IsEqual<T> = (a: T, b: T) => boolean;\n\n/**\n * Default comparer function is equiv to checking `a === b`.\n * Use {@link isEqualValueDefault} to compare by value, via comparing JSON string representation.\n */\nexport const isEqualDefault = <T>(a: T, b: T): boolean => a === b;\n\n/**\n * Comparer returns true if string representation of `a` and `b` are equal.\n * Use {@link isEqualDefault} to compare using === semantics\n * Uses `toStringDefault` to generate a string representation (via `JSON.stringify`).\n * \n * Returns _false_ if the ordering of fields is different, even though values are identical:\n * ```js\n * isEqualValueDefault({ a: 10, b: 20}, { b: 20, a: 10 }); // false\n * ```\n * \n * Use {@link isEqualValueIgnoreOrder} to ignore order (with an overhead of additional processing).\n * ```js\n * isEqualValueIgnoreOrder({ a: 10, b: 20}, { b: 20, a: 10 }); // true\n * ```\n * \n * Use {@link isEqualValuePartial} to partially match `b` against `a`.\n * @returns True if the contents of `a` and `b` are equal\n */\nexport const isEqualValueDefault = <T>(a: T, b: T): boolean => {\n  // ✔ UNIT TESTED\n  if (a === b) return true; // Object references are the same, or string values are the same\n  return toStringDefault(a) === toStringDefault(b); // String representations are the same\n};\n\n/**\n * Returns _true_ if `a` contains the values of `b`. `a` may contain other values, but we\n * only check against what is in `b`. `a` and `b` must both be simple objects.\n * \n * ```js\n * const obj = {\n *  name: `Elle`,\n *  size: 100,\n *  colour: {\n *    red: 0.5,\n *    green: 0.1,\n *    blue: 0.2\n *  }\n * }\n * \n * isEqualValuePartial(obj, { name: `Elle` }); // true\n * isEqualValuePartial(obj, { name: { colour: red: { 0.5, green: 0.1  }} }); // true\n * \n * isEqualValuePartial(obj, { name: `Ellen` });     // false\n * isEqualValuePartial(obj, { lastname: `Elle` });  // false\n * ```\n * @param a \n * @param b \n * @param fieldComparer \n * @returns \n */\nexport const isEqualValuePartial = <T1 extends Record<string, any>, T2 extends Record<string, any>>(a: T1, b: T2, fieldComparer?: IsEqual<any>): boolean => {\n  if (typeof a !== `object`) throw new Error(`Parameter 'a' expected to be object`);\n  if (typeof b !== `object`) throw new Error(`Parameter 'b' expected to be object`);\n\n  if (Object.is(a, b)) return true;\n  const comparer = fieldComparer ?? isEqualValuePartial;\n  for (const entryB of Object.entries(b)) {\n    const valueA = a[ entryB[ 0 ] ];\n    const valueB = entryB[ 1 ];\n    if (typeof valueA === `object` && typeof valueB === `object`) {\n      if (!comparer(valueA, valueB)) {\n        return false;\n      }\n    } else {\n      if (valueA !== valueB) {\n        return false;\n      }\n    }\n  }\n  return true;\n}\n\n\n\n/**\n * Comparer returns true if string representation of `a` and `b` are equal, regardless of field ordering.\n * Uses `toStringOrdered` to generate a string representation (via JSON.stringify`).\n * \n * ```js\n * isEqualValueIgnoreOrder({ a: 10, b: 20}, { b: 20, a: 10 }); // true\n * isEqualValue({ a: 10, b: 20}, { b: 20, a: 10 }); // false, fields are different order\n * ```\n * \n * There is an overhead to ordering fields. Use {@link isEqualValueDefault} if it's not possible that field ordering will change.\n * @returns True if the contents of `a` and `b` are equal\n * @typeParam T - Type of objects being compared\n */\nexport const isEqualValueIgnoreOrder = <T>(a: T, b: T): boolean => {\n  // ✔ UNIT TESTED\n  if (a === b) return true; // Object references are the same, or string values are the same\n  return toStringOrdered(a) === toStringOrdered(b); // String representations are the same\n};","var __create = Object.create;\nvar __defProp = Object.defineProperty;\nvar __getOwnPropDesc = Object.getOwnPropertyDescriptor;\nvar __getOwnPropNames = Object.getOwnPropertyNames;\nvar __getProtoOf = Object.getPrototypeOf;\nvar __hasOwnProp = Object.prototype.hasOwnProperty;\nvar __typeError = (msg) => {\n  throw TypeError(msg);\n};\nvar __commonJS = (cb, mod) => function __require() {\n  return mod || (0, cb[__getOwnPropNames(cb)[0]])((mod = { exports: {} }).exports, mod), mod.exports;\n};\nvar __export = (target, all) => {\n  for (var name in all)\n    __defProp(target, name, { get: all[name], enumerable: true });\n};\nvar __copyProps = (to, from, except, desc) => {\n  if (from && typeof from === \"object\" || typeof from === \"function\") {\n    for (let key of __getOwnPropNames(from))\n      if (!__hasOwnProp.call(to, key) && key !== except)\n        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });\n  }\n  return to;\n};\nvar __toESM = (mod, isNodeMode, target) => (target = mod != null ? __create(__getProtoOf(mod)) : {}, __copyProps(\n  // If the importer is in node compatibility mode or this is not an ESM\n  // file that has been converted to a CommonJS file using a Babel-\n  // compatible transform (i.e. \"__esModule\" has not been set), then set\n  // \"default\" to the CommonJS \"module.exports\" for node compatibility.\n  isNodeMode || !mod || !mod.__esModule ? __defProp(target, \"default\", { value: mod, enumerable: true }) : target,\n  mod\n));\nvar __decorateClass = (decorators, target, key, kind) => {\n  var result = kind > 1 ? void 0 : kind ? __getOwnPropDesc(target, key) : target;\n  for (var i = decorators.length - 1, decorator; i >= 0; i--)\n    if (decorator = decorators[i])\n      result = (kind ? decorator(target, key, result) : decorator(result)) || result;\n  if (kind && result) __defProp(target, key, result);\n  return result;\n};\nvar __accessCheck = (obj, member, msg) => member.has(obj) || __typeError(\"Cannot \" + msg);\nvar __privateGet = (obj, member, getter) => (__accessCheck(obj, member, \"read from private field\"), getter ? getter.call(obj) : member.get(obj));\nvar __privateAdd = (obj, member, value) => member.has(obj) ? __typeError(\"Cannot add the same private member more than once\") : member instanceof WeakSet ? member.add(obj) : member.set(obj, value);\nvar __privateSet = (obj, member, value, setter) => (__accessCheck(obj, member, \"write to private field\"), setter ? setter.call(obj, value) : member.set(obj, value), value);\nvar __privateMethod = (obj, member, method) => (__accessCheck(obj, member, \"access private method\"), method);\n\nexport {\n  __commonJS,\n  __export,\n  __toESM,\n  __decorateClass,\n  __privateGet,\n  __privateAdd,\n  __privateSet,\n  __privateMethod\n};\n//# sourceMappingURL=chunk-L5EJU35C.js.map","\nimport type { ISimpleEventEmitter, Listener } from './ISimpleEventEmitter.js';\nimport { ofSimpleMutable } from './collections/map/MapOfSimpleMutable.js';\nimport { intervalToMs, type Interval } from './flow/IntervalType.js';\n\n/**\n * Subscribes to events on `target`, returning the event data\n * from the first event that fires.\n * \n * By default waits a maximum of 1 minute.\n * \n * Automatically unsubscribes on success or failure (ie. timeout)\n * \n * ```js\n * // Event will be data from either event, whichever fires first\n * // Exception is thrown if neither fires within 1 second\n * const event = await eventRace(document.body, [`pointermove`, `pointerdown`], { timeout: 1000 });\n * ```\n * @param target Event source\n * @param eventNames Event name(s)\n * @param options Options\n * @returns \n */\nexport const eventRace = (target: EventTarget, eventNames: Array<string>, options: Partial<{ timeout: Interval, signal: AbortSignal }> = {}) => {\n  const intervalMs = intervalToMs(options.timeout, 60 * 1000);\n  const signal = options.signal;\n  let triggered = false;\n  let disposed = false;\n  let timeout: ReturnType<typeof setTimeout> | undefined;\n\n  const promise = new Promise<Event>((resolve, reject) => {\n    const onEvent = (event: Event) => {\n      if (`type` in event) {\n        if (eventNames.includes(event.type)) {\n          triggered = true;\n          resolve(event);\n          dispose();\n        } else {\n          console.warn(`eventRace: Got event '${ event.type }' that is not in race list`);\n        }\n      } else {\n        console.warn(`eventRace: Event data does not have expected 'type' field`);\n        console.log(event);\n      }\n    }\n\n    for (const name of eventNames) {\n      target.addEventListener(name, onEvent);\n    }\n\n    const dispose = () => {\n      if (disposed) return;\n      if (timeout !== undefined) clearTimeout(timeout);\n      timeout = undefined;\n      disposed = true;\n      for (const name of eventNames) {\n        target.removeEventListener(name, onEvent);\n      }\n    }\n\n    timeout = setTimeout(() => {\n      if (triggered || disposed) return;\n      dispose();\n      reject(new Error(`eventRace: Events not fired within interval. Events: ${ JSON.stringify(eventNames) } Interval: ${ intervalMs }`));\n    }, intervalMs);\n\n\n    signal?.addEventListener(`abort`, () => {\n      if (triggered || disposed) return;\n      dispose();\n      reject(new Error(`Abort signal received ${ signal.reason }`));\n    });\n  });\n  return promise;\n}\n\n\nexport class SimpleEventEmitter<Events> implements ISimpleEventEmitter<Events> {\n  readonly #listeners = ofSimpleMutable<Listener<Events>>();\n  #disposed = false;\n\n  dispose() {\n    if (this.#disposed) return;\n    this.clearEventListeners();\n  }\n\n  get isDisposed() {\n    return this.#disposed;\n  }\n\n  /**\n   * Fire event\n   * @param type Type of event\n   * @param args Arguments for event\n   * @returns\n   */\n  protected fireEvent<K extends keyof Events>(type: K, args: Events[ K ]) {\n    if (this.#disposed) throw new Error(`Disposed`);\n    const listeners = this.#listeners.get(type as string);\n    //console.log(`Firing ${type as string}`);\n    for (const l of listeners) {\n      l(args, this);\n    }\n  }\n\n  /**\n   * Adds event listener.\n   * \n   * @throws Error if emitter is disposed\n   * @typeParam K - Events\n   * @param name Event name\n   * @param listener Event handler\n   */\n  addEventListener<K extends keyof Events>(\n    name: K,\n    listener: (event: Events[ K ], sender: SimpleEventEmitter<Events>) => void\n  ): void {\n    if (this.#disposed) throw new Error(`Disposed`);\n    this.#listeners.addKeyedValues(\n      name as string,\n      listener as Listener<Events>\n    );\n  }\n\n  /**\n   * Remove event listener\n   *\n   * @param listener\n   */\n  removeEventListener<K extends keyof Events>(\n    type: K,\n    listener: (event: Events[ K ], sender: SimpleEventEmitter<Events>) => void\n  ) {\n    if (this.#disposed) return;\n\n    // listener: Listener<Events>): void {\n    this.#listeners.deleteKeyValue(\n      type as string,\n      listener as Listener<Events>\n    );\n  }\n\n  /**\n   * Clear all event listeners\n   * @private\n   */\n  clearEventListeners() {\n    if (this.#disposed) return;\n    this.#listeners.clear();\n  }\n}\n\n// type TestEventMap = {\n//   readonly change: TestEvent\n//   readonly other: TestEvent2;\n// }\n\n// interface TestEvent2 {\n//   readonly something: string;\n// }\n// interface TestEvent {\n//   readonly blah: boolean;\n// }\n\n// class TestEmitter extends SimpleEventEmitter<TestEventMap> {\n//   constructor() {\n//     super();\n//     this.addEventListener(`change`, (e) => {\n//       e.blah;\n//     });\n//   }\n// }\n\n/*\nexport class Event {\n  public target: any;\n  public type: string;\n  constructor(type: string, target: any) {\n    this.target = target;\n    this.type = type;\n  }\n}\n\nexport class ErrorEvent extends Event {\n  public message: string;\n  public error: Error;\n  constructor(error: Error, target: any) {\n    super('error', target);\n    this.message = error.message;\n    this.error = error;\n  }\n}\n\nexport class CloseEvent extends Event {\n  public code: number;\n  public reason: string;\n  public wasClean = true;\n  constructor(code = 1000, reason = '', target: any) {\n    super('close', target);\n    this.code = code;\n    this.reason = reason;\n  }\n}\nexport interface WebSocketEventMap {\n  close: CloseEvent;\n  error: ErrorEvent;\n  message: MessageEvent;\n  open: Event;\n}\n\nexport interface WebSocketEventListenerMap {\n  close: (event: CloseEvent) => void | {handleEvent: (event: CloseEvent) => void};\n  error: (event: ErrorEvent) => void | {handleEvent: (event: ErrorEvent) => void};\n  message: (event: MessageEvent) => void | {handleEvent: (event: MessageEvent) => void};\n  open: (event: Event) => void | {handleEvent: (event: Event) => void};\n}\n*/\n\nexport { type ISimpleEventEmitter, type Listener } from './ISimpleEventEmitter.js';","/**\n * If values are strings, uses that as the key.\n * Otherwise uses `JSON.stringify`.\n * @param a\n * @returns\n */\nexport const defaultKeyer = <V>(a: V) => {\n  return typeof a === `string` ? a : JSON.stringify(a);\n};","// ✔ UNIT TESTED\n\nimport { type IsEqual, isEqualDefault } from '../../util/IsEqual.js';\nimport type { IMapOf } from './IMapOf.js';\nimport type { IWithEntries } from '../../data/maps/IMappish.js';\n\n/**\n * Finds first entry by iterable value. Expects a map with an iterable as values.\n *\n * ```js\n * const map = new Map();\n * map.set('hello', ['a', 'b', 'c']);\n * map.set('there', ['d', 'e', 'f']);\n *\n * const entry = firstEntry(map, (value, key) => {\n *  return (value === 'e');\n * });\n * // Entry is: ['there', ['d', 'e', 'f']]\n * ```\n *\n * An alternative is {@link firstEntryByValue} to search by value.\n * @param map Map to search\n * @param predicate Filter function returns true when there is a match of value\n * @returns Entry, or _undefined_ if `filter` function never returns _true_\n */\nexport const firstEntry = <K, V>(\n  map: IWithEntries<K, Iterable<V>>,\n  predicate: (value: V, key: K) => boolean\n): readonly [ key: K, value: Iterable<V> ] | undefined => {\n  for (const e of map.entries()) {\n    const val = e[ 1 ];\n    for (const subValue of val) {\n      if (predicate(subValue, e[ 0 ])) return e;\n    }\n  }\n};\n\n/**\n * Returns the size of the largest key, or 0 if empty.\n */\nexport const lengthMax = <V>(map: IMapOf<V>): number => {\n  //eslint-disable-next-line functional/no-let\n  let largest: readonly [ string, number ] = [ '', 0 ];\n  for (const e of map.keysAndCounts()) {\n    if (e[ 1 ] > largest[ 1 ]) {\n      largest = e;\n    }\n  }\n  return largest[ 1 ];\n};\n\n/**\n * Finds first entry by iterable value. Expects a map with an iterable as values.\n *\n * ```js\n * const map = new Map();\n * map.set('hello', ['a', 'b', 'c']);\n * map.set('there', ['d', 'e', 'f']);\n *\n * const entry = firstEntryByValue(map, 'e');\n * // Entry is: ['there', ['d', 'e', 'f']]\n * ```\n *\n * An alternative is {@link firstEntry} to search by predicate function.\n * @param map Map to search\n * @param value Value to seek\n * @param isEqual Filter function which checks equality. Uses JS comparer by default.\n * @returns Entry, or _undefined_ if `value` not found.\n */\nexport const firstEntryByValue = <K, V>(\n  map: IWithEntries<K, Iterable<V>>,\n  value: V,\n  isEqual: IsEqual<V> = isEqualDefault\n): readonly [ key: K, value: Iterable<V> ] | undefined => {\n  for (const e of map.entries()) {\n    const val = e[ 1 ];\n    for (const subValue of val) {\n      if (isEqual(subValue, value)) return e;\n    }\n  }\n};\n","import { defaultKeyer } from '../../DefaultKeyer.js';\nimport { type IsEqual, isEqualDefault } from '../../util/IsEqual.js';\nimport { firstEntryByValue } from './MapMultiFns.js';\n\nexport class MapOfSimpleBase<V> {\n  protected map: Map<string, ReadonlyArray<V>>;\n  protected readonly groupBy;\n  protected valueEq;\n\n  /**\n   * Constructor\n   * @param groupBy Creates keys for values when using `addValue`. By default uses JSON.stringify\n   * @param valueEq Compare values. By default uses JS logic for equality\n   */\n  constructor(\n    groupBy: (value: V) => string = defaultKeyer,\n    valueEq: IsEqual<V> = isEqualDefault<V>,\n    initial: Array<[ string, ReadonlyArray<V> ]> = []\n  ) {\n    this.groupBy = groupBy;\n    this.valueEq = valueEq;\n    this.map = new Map(initial);\n  }\n\n\n  /**\n   * Iterate over all entries\n   */\n  *entriesFlat(): IterableIterator<[ key: string, value: V ]> {\n    for (const key of this.map.keys()) {\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      for (const value of this.map.get(key)!) {\n        yield [ key, value ];\n      }\n    }\n  }\n\n  *entries(): IterableIterator<[ key: string, value: Array<V> ]> {\n    for (const [ k, v ] of this.map.entries()) {\n      yield [ k, [ ...v ] ];\n    }\n  }\n\n  firstKeyByValue(value: V, eq: IsEqual<V> = isEqualDefault) {\n    const entry = firstEntryByValue(this, value, eq);\n    if (entry) return entry[ 0 ];\n  }\n\n  /**\n   * Get all values under `key`\n   * @param key\n   * @returns\n   */\n  *get(key: string): IterableIterator<V> {\n    const m = this.map.get(key);\n    if (!m) return;\n    yield* m.values();\n  }\n\n  /**\n   * Iterate over all keys\n   */\n  *keys(): IterableIterator<string> {\n    yield* this.map.keys();\n  }\n\n  /**\n   * Iterate over all values (regardless of key)\n   */\n  *valuesFlat(): IterableIterator<V> {\n    for (const entries of this.map) {\n      yield* entries[ 1 ];\n    }\n  }\n\n  /**\n   * Iterate over keys and length of values stored under keys\n   */\n  *keysAndCounts(): IterableIterator<[ string, number ]> {\n    for (const entries of this.map) {\n      yield [ entries[ 0 ], entries[ 1 ].length ];\n    }\n  }\n\n  /**\n   * Returns _true_ if `key` exists\n   * @param key\n   * @returns\n   */\n  //eslint-disable-next-line functional/prefer-tacit\n  has(key: string): boolean {\n    return this.map.has(key);\n  }\n\n  /**\n   * Returns _true_ if `value` exists under `key`.\n   * @param key Key\n   * @param value Value to seek under `key`\n   * @returns _True_ if `value` exists under `key`.\n   */\n  hasKeyValue(key: string, value: V): boolean {\n    const values = this.map.get(key);\n    if (!values) return false;\n    for (const v of values) {\n      if (this.valueEq(v, value)) return true;\n    }\n    return false;\n  }\n\n  /**\n   * Debug dump of contents\n   * @returns\n   */\n  debugString(): string {\n    // eslint-disable-next-line functional/no-let\n    let r = ``;\n    const keys = [ ...this.map.keys() ];\n    keys.every((k) => {\n      const v = this.map.get(k);\n      if (v === undefined) return;\n      r += k + ` (${ v.length }) = ${ JSON.stringify(v) }\\r\\n`;\n    });\n    return r;\n  }\n\n  /**\n   * _True_ if empty\n   */\n  get isEmpty(): boolean {\n    return this.map.size === 0;\n  }\n\n  /**\n   * Return number of values stored under `key`.\n   * Returns 0 if `key` is not found.\n   * @param key\n   * @returns\n   */\n  count(key: string): number {\n    const values = this.map.get(key);\n    if (!values) return 0;\n    return values.length;\n  }\n\n  get lengthKeys() {\n    return this.map.size;\n  }\n\n}\n","import { defaultKeyer } from '../../DefaultKeyer.js';\nimport { type IsEqual, isEqualDefault } from '../../util/IsEqual.js';\nimport type { IMapOfMutable } from './IMapOfMutable.js';\nimport { MapOfSimpleBase } from './MapOfSimpleBase.js';\n\n/**\n * A simple mutable map of arrays, without events. It can store multiple values\n * under the same key.\n *\n * For a fancier approaches, consider ofArrayMutable, ofCircularMutable or ofSetMutable.\n *\n * @example\n * ```js\n * const m = mapOfSimpleMutable();\n * m.add(`hello`, 1, 2, 3); // Adds numbers under key `hello`\n * m.delete(`hello`);       // Deletes everything under `hello`\n *\n * const hellos = m.get(`hello`); // Get list of items under `hello`\n * ```\n *\n * Constructor takes a `groupBy` parameter, which yields a string key for a value. This is the\n * basis by which values are keyed when using `addValues`.\n *\n * Constructor takes a `valueEq` parameter, which compares values. This is used when checking\n * if a value exists under a key, for example.\n * @typeParam V - Type of items\n */\nexport class MapOfSimpleMutable<V>\n  extends MapOfSimpleBase<V>\n  implements IMapOfMutable<V> {\n  addKeyedValues(key: string, ...values: ReadonlyArray<V>) {\n    const existing = this.map.get(key);\n    if (existing === undefined) {\n      this.map.set(key, values);\n    } else {\n      this.map.set(key, [ ...existing, ...values ]);\n    }\n  }\n\n\n  /**\n   * Adds a value, automatically extracting a key via the\n   * `groupBy` function assigned in the constructor options.\n   * @param values Adds several values\n   */\n  addValue(...values: ReadonlyArray<V>) {\n    for (const v of values) {\n      const key = this.groupBy(v);\n      this.addKeyedValues(key, v);\n    }\n  }\n\n  /**\n   * Delete `value` under a particular `key`\n   * @param key\n   * @param value\n   * @returns _True_ if `value` was found under `key`\n   */\n  deleteKeyValue(key: string, value: V): boolean {\n    const existing = this.map.get(key);\n    if (existing === undefined) return false;\n    const without = existing.filter((existingValue) => !this.valueEq(existingValue, value));\n    this.map.set(key, without);\n    return without.length < existing.length;\n  }\n\n  /**\n   * Deletes `value` regardless of key.\n   *\n   * Uses the constructor-defined equality function.\n   * @param value Value to delete\n   * @returns\n   */\n  deleteByValue(value: V): boolean {\n    //eslint-disable-next-line functional/no-let\n    let del = false;\n    const entries = [ ...this.map.entries() ];\n    for (const keyEntries of entries) {\n      for (const values of keyEntries[ 1 ]) {\n        if (this.valueEq(values, value)) {\n          del = true;\n          this.deleteKeyValue(keyEntries[ 0 ], value);\n        }\n      }\n    }\n    return del;\n  }\n\n  /**\n   * Deletes all values under `key`,\n   * @param key\n   * @returns _True_ if `key` was found and values stored\n   */\n  delete(key: string): boolean {\n    const values = this.map.get(key);\n    if (!values) return false;\n    if (values.length === 0) return false;\n    this.map.delete(key);\n    return true;\n  }\n\n  /**\n   * Clear contents\n   */\n  clear() {\n    this.map.clear();\n  }\n}\n\n/**\n * A simple mutable map of arrays, without events. It can store multiple values\n * under the same key.\n *\n * For a fancier approaches, consider {@link ofArrayMutable}, {@link ofCircularMutable} or {@link ofSetMutable}.\n *\n * @example\n * ```js\n * const m = mapOfSimpleMutable();\n * m.add(`hello`, 1, 2, 3); // Adds numbers under key `hello`\n * m.delete(`hello`);       // Deletes everything under `hello`\n *\n * const hellos = m.get(`hello`); // Get list of items under `hello`\n * ```\n *\n * @typeParam V - Type of items\n * @returns New instance\n */\nexport const ofSimpleMutable = <V>(\n  groupBy: (value: V) => string = defaultKeyer,\n  valueEq: IsEqual<V> = isEqualDefault<V>\n): IMapOfMutable<V> => new MapOfSimpleMutable<V>(groupBy, valueEq);\n","/**\n * A random source.\n *\n * Predefined sources: {@link defaultRandom}, {@link gaussianSource}, {@link weightedSource}\n */\nexport type RandomSource = () => number;\n\n\nexport type StringOptions = Readonly<{\n  length: number;\n  source?: RandomSource;\n}>\n\n/**\n * Default random number generator: `Math.random`.\n */\nexport const defaultRandom = Math.random;\n\nexport type RandomOptions = Readonly<{\n  max: number;\n  min?: number;\n  source?: RandomSource;\n}>\n\nexport type GenerateRandomOptions = RandomOptions & Readonly<{\n  /**\n   * If true, number range is looped\n   */\n  loop?: boolean;\n}>;","import { defaultRandom, type StringOptions } from \"./Types.js\";\n\n/**\n * Returns a string of random letters and numbers of a given `length`.\n *\n * ```js\n * string();  // Random string of length 5\n * string(4); // eg. `4afd`\n * ```\n * @param lengthOrOptions Length of random string, or options.\n * @returns Random string\n */\nexport const string = (lengthOrOptions: number | StringOptions = 5) => {\n  const options =\n    typeof lengthOrOptions === `number` ? { length: lengthOrOptions } : lengthOrOptions;\n  const calculate = options.source ?? defaultRandom;\n  return calculate()\n    .toString(36)\n    .slice(2, length + 2);\n};","import { integerTest } from './util/GuardNumbers.js';\nimport { throwFromResult } from './util/GuardThrowFromResult.js';\nexport { string as random } from './random/String.js';\n\n/**\n * Given a long string, abbreviates it with ...\n * ```js\n * abbreviate(`This is something`, 7); // `This is...`\n * ```\n * \n * If `source` is under `maxLength` the original is returned.\n * @param source \n * @param maxLength Maximum length. Defaults to 20\n * @returns \n */\nexport const abbreviate = (source: string, maxLength = 15) => {\n  // ✔️ Unit tested\n  throwFromResult(integerTest(maxLength, `aboveZero`, `maxLength`));\n  if (typeof source !== `string`) throw new Error(`Parameter 'source' is not a string`);\n\n  if (source.length > maxLength && source.length > 3) {\n    if (maxLength > 15) {\n      const chunk = Math.round((maxLength - 2) / 2);\n      return source.slice(0, chunk) + `...` + source.slice(-chunk);\n    }\n    return source.slice(0, maxLength) + `...`;\n  }\n  return source;\n}\n\n/**\n * Uses JSON.toString() on `source`, but abbreviates result.\n * @param source Object to stringify\n * @param maxLength Default 20\n * @returns \n */\nexport const toStringAbbreviate = (source: any, maxLength = 20) => {\n  if (source === undefined) return `(undefined)`;\n  if (source === null) return `(null)`;\n  return abbreviate(JSON.stringify(source), maxLength);\n}\n\n/**\n * Returns source text that is between `start` and `end` match strings. Returns _undefined_ if start/end is not found.\n *\n * ```js\n * // Yields ` orange `;\n * between(`apple orange melon`, `apple`, `melon`);\n * ```\n * @param source Source text\n * @param start Start match\n * @param end If undefined, the `start` string will be looked for\n * @param lastEndMatch If true, looks for the last match of `end` (default). If false, looks for the first match.\n * @returns\n */\nexport const between = (\n  source: string,\n  start: string,\n  end?: string,\n  lastEndMatch = true\n): string | undefined => {\n  // ✔ Unit tested\n\n  const startPos = source.indexOf(start);\n  if (startPos < 0) return;\n\n  if (end === undefined) end = start;\n\n  const endPos = lastEndMatch\n    ? source.lastIndexOf(end)\n    : source.indexOf(end, startPos + 1);\n  if (endPos < 0) return;\n\n  return source.slice(startPos + 1, endPos);\n};\n\n/**\n * Like {@link between}, but also returns the source string without the start/end match and what's between.\n * ```js\n * const [src,between] = betweenChomp('hello [there] friend', '[', ']');\n * // src: 'hello  friend'\n * // between: 'there'\n * ```\n * @param source\n * @param start\n * @param end\n * @param lastEndMatch\n * @returns\n */\nexport const betweenChomp = (\n  source: string,\n  start: string,\n  end?: string,\n  lastEndMatch = true\n): [ source: string, between: string | undefined ] => {\n  // ✔ Unit tested\n  if (typeof source !== `string`) throw new Error(`Parameter 'source' is not a string`);\n  if (typeof start !== `string`) throw new Error(`Parameter 'start' is not a string`);\n  if (end !== undefined && typeof end !== `string`) throw new Error(`Parameter 'end' is not a string`);\n  const startPos = source.indexOf(start);\n  if (startPos < 0) return [ source, undefined ];\n\n  if (end === undefined) end = start;\n\n  const endPos = lastEndMatch\n    ? source.lastIndexOf(end)\n    : source.indexOf(end, startPos + 1);\n  if (endPos < 0) return [ source, undefined ];\n\n  const between = source.slice(startPos + 1, endPos);\n  const sourceResult = source.slice(0, startPos) + source.slice(endPos + 1);\n  return [ sourceResult, between ];\n};\n/**\n * Returns first position of the given character code, or -1 if not found.\n * @param source Source string\n * @param code Code to seek\n * @param start Start index, 0 by default\n * @param end End index (inclusive), source.length-1 by default\n * @returns Found position, or -1 if not found\n */\nexport const indexOfCharCode = (\n  source: string,\n  code: number,\n  start = 0,\n  end = source.length - 1\n): number => {\n  //eslint-disable-next-line functional/no-let\n  for (let index = start; index <= end; index++) {\n    if (source.codePointAt(index) === code) return index;\n  }\n  return -1;\n};\n\n/**\n * Returns `source` with a given number of characters removed from start position.\n *\n * ```js\n * // Remove three characters starting at position 1\n * omitChars(`hello there`, 1, 3); // ie. removes 'ell'\n * // Yields: `ho there`\n * ```\n * @param source\n * @param removeStart Start point to remove\n * @param removeLength Number of characters to remove\n * @returns\n */\nexport const omitChars = (\n  source: string,\n  removeStart: number,\n  removeLength: number\n) =>\n  source.slice(0, removeStart) +\n  source.slice(removeStart + removeLength);\n\n/**\n * Splits a string into `length`-size chunks.\n *\n * If `length` is greater than the length of `source`, a single element array is returned with source.\n * The final array element may be smaller if we ran out of characters.\n *\n * ```js\n * splitByLength(`hello there`, 2);\n * // Yields:\n * // [`he`, `ll`, `o `, `th`, `er`, `e`]\n * ```\n * @param source Source string\n * @param length Length of each chunk\n * @returns\n */\nexport const splitByLength = (\n  source: string | null,\n  length: number\n): ReadonlyArray<string> => {\n  throwFromResult(integerTest(length, `aboveZero`, `length`));\n  if (source === null) throw new Error(`source parameter null`);\n  if (typeof source !== `string`) {\n    throw new TypeError(`source parameter not a string`);\n  }\n\n  // ✔ Unit tested\n  const chunks = Math.ceil(source.length / length);\n  const returnValue: Array<string> = [];\n  //eslint-disable-next-line functional/no-let\n  let start = 0;\n\n  //eslint-disable-next-line functional/no-let\n  for (let c = 0; c < chunks; c++) {\n    //eslint-disable-next-line functional/immutable-data\n    returnValue.push(source.slice(start, start + length));\n    start += length;\n  }\n  return returnValue;\n};\n\n\n\n/**\n * Returns the `source` string up until (and excluding) `match`. \n * \n * By default, if match is not found, all of `source` is returned.\n *\n * ```js\n * // Yields `apple `\n * untilMarch(`apple orange melon`, `orange`);\n * ```\n * \n * If match is not found, fallback can be returned instead:\n * ```js\n * // Yields 'lemon'\n * untilMatch(`apple orange mellon`, `kiwi`, { fallback: `lemon` });\n * ```\n * \n * Or an exception thrown\n * ```js\n * // Throws\n * untilMatch(`apple orange mellon`, `kiwi`, { ifNoMatch: `throw` });\n * ```\n * @param source\n * @param match\n * @param startPos If provided, gives the starting offset. Default 0\n */\n// export const untilMatch = (\n//   source: string,\n//   match: string,\n//   options: Partial<UntilMatchOptions> = {}\n// ): string => {\n//   //  ✔️ Unit tested\n//   let fallback = options.fallback;\n//   const ifNoMatch = options.ifNoMatch ?? (fallback ? `fallback` : `original`);\n//   if (ifNoMatch === `original`) fallback = source;\n//   if (ifNoMatch === `fallback` && fallback === undefined) throw new Error(`Fallback must be provided`);\n//   const startPos = options.startPos ?? undefined;\n//   const fromEnd = options.fromEnd ?? false;\n//   const m = fromEnd\n//     ? source.lastIndexOf(match, startPos)\n//     : source.indexOf(match, startPos);\n\n//   if (m < 0) {\n//     if (ifNoMatch === `throw`) throw new Error(`Match string not found in source`);\n//     // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n//     return fallback!;\n//   }\n//   return source.slice(startPos ?? 0, m);\n// };\n\n\n// export type UntilMatchOptions = MatchOptions & {\n//   ifNoMatch: `throw` | `original` | `fallback`,\n//   fallback?: string\n// }\n\nexport type MatchOptions = {\n  startPos: number;\n  fromEnd: boolean;\n  ifNoMatch: `throw` | `original` | `fallback`,\n  fallback: string\n}\n\n// export const afterMatch = (\n//   source: string,\n//   match: string,\n//   options: MatchOptions = {}\n// ): string => {\n//   if (source === undefined) throw new Error(`Param 'source' is undefined`);\n\n//   //  ✔️ Unit tested\n//   const startPos = options.startPos ?? undefined;\n//   const fromEnd = options.fromEnd ?? false;\n\n//   const m = fromEnd\n//     ? source.lastIndexOf(match, startPos)\n//     : source.indexOf(match, startPos);\n\n//   if (m < 0) return source;\n//   return source.slice(Math.max(0, m + match.length));\n// };\n\n/**\n * Returns all the text in `source` that precedes (and does not include) `match`. If not found, `source` is returned.\n * \n * See also: {@link beforeMatch}, {@link beforeAfterMatch}.\n * \n * ```js\n * afterMatch(`Hello. There`, `.`); // ' There'\n * afterMatch(`Hello, there', `,`); // 'Hello, there'\n * ```\n * \n * If `source` is _undefined_, an error is thrown.\n * @param source\n * @param match\n * @param options\n * @returns\n */\nexport const beforeMatch = (\n  source: string,\n  match: string,\n  options: Partial<MatchOptions> = {}\n): string => {\n  const ba = beforeAfterMatch(source, match, options);\n  return ba[ 0 ];\n}\n\n/**\n * Returns all the text in `source` that follows `match`. If not found, `source` is returned.\n * \n * See also: {@link beforeMatch}, {@link beforeAfterMatch}.\n * \n * ```js\n * afterMatch(`Hello. There`, `.`); // ' There'\n * afterMatch(`Hello, there', `,`); // 'Hello, there'\n * ```\n * \n * If `source` is _undefined_, an error is thrown.\n * @param source\n * @param match\n * @param options\n * @returns\n */\nexport const afterMatch = (\n  source: string,\n  match: string,\n  options: Partial<MatchOptions> = {}\n): string => {\n  const ba = beforeAfterMatch(source, match, options);\n  return ba[ 1 ];\n}\n\n/**\n * Returns the text that is before and after `match`.\n * \n * See also: {@link beforeMatch}, {@link afterMatch}.\n * \n * If `match` is at the end of start of `source`, after or before might be an empty string.\n * @param source \n * @param match \n * @param options \n * @returns \n */\nexport const beforeAfterMatch = (source: string, match: string, options: Partial<MatchOptions> = {}): [ before: string, after: string ] => {\n  if (source === undefined) throw new Error(`Param 'source' is undefined`);\n\n  let fallback = options.fallback;\n  const ifNoMatch = options.ifNoMatch ?? (fallback ? `fallback` : `original`);\n  if (ifNoMatch === `original`) fallback = source;\n  if (ifNoMatch === `fallback` && fallback === undefined) throw new Error(`Fallback must be provided`);\n\n  const startPos = options.startPos ?? undefined;\n  const fromEnd = options.fromEnd ?? false;\n\n  const m = fromEnd\n    ? source.lastIndexOf(match, startPos)\n    : source.indexOf(match, startPos);\n\n  if (m < 0 && ifNoMatch === `throw`) throw new Error(`Match '${ match }' not found in source.`);\n  if (m < 0 && ifNoMatch === `original`) return [ source, source ];\n  if (m < 0 && ifNoMatch === `fallback`) {\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    return [ fallback!, fallback! ];\n  }\n  return [\n    source.slice(0, m),\n    source.slice(Math.max(0, m + match.length))\n  ]\n}\n/**\n * 'Unwraps' a string, removing one or more 'wrapper' strings that it starts and ends with.\n * Only removes when a matching end is found.\n * ```js\n * unwrap(\"'hello'\", \"'\");        // hello\n * // No mataching end 'a', so nothing happens\n * unwrap(\"apple\", \"a\");          // apple\n * unwrap(\"wow\", \"w\");            // o\n * unwrap(`\"'blah'\"`, '\"', \"'\");  // blah\n * ```\n * @param source\n * @param wrappers\n * @returns\n */\nexport const unwrap = (\n  source: string,\n  ...wrappers: ReadonlyArray<string>\n): string => {\n  //eslint-disable-next-line functional/no-let\n  let matched = false;\n  do {\n    matched = false;\n    for (const w of wrappers) {\n      if (source.startsWith(w) && source.endsWith(w)) {\n        source = source.slice(w.length, source.length - w.length * 2 + 1);\n        matched = true;\n      }\n    }\n  } while (matched);\n\n  return source;\n};\n\n/**\n * A range\n */\nexport type Range = {\n  /**\n   * Text of range\n   */\n  readonly text: string;\n  /**\n   * Start position, with respect to source text\n   */\n  readonly start: number;\n  /**\n   * End position, with respect to source text\n   */\n  readonly end: number;\n  /**\n   * Index of range. First range is 0\n   */\n  readonly index: number;\n}\n\nexport type LineSpan = {\n  readonly start: number;\n  readonly end: number;\n  readonly length: number;\n}\n\n/**\n * Calculates the span, defined in {@link Range} indexes, that includes `start` through to `end` character positions.\n *\n * After using {@link splitRanges} to split text, `lineSpan` is used to associate some text coordinates with ranges.\n *\n * @param ranges Ranges\n * @param start Start character position, in source text reference\n * @param end End character position, in source text reference\n * @returns Span\n */\nexport const lineSpan = (\n  ranges: ReadonlyArray<Range>,\n  start: number,\n  end: number\n): LineSpan => {\n  //eslint-disable-next-line functional/no-let\n  let s = -1;\n  //eslint-disable-next-line functional/no-let\n  let endPos = -1;\n  //eslint-disable-next-line functional/no-let\n  for (const [ index, r ] of ranges.entries()) {\n    s = index;\n    if (r.text.length === 0) continue;\n    if (start < r.end) {\n      break;\n    }\n  }\n\n  //eslint-disable-next-line functional/no-let\n  for (let index = s; index < ranges.length; index++) {\n    const r = ranges[ index ];\n    endPos = index;\n    if (end === r.end) {\n      endPos = index + 1;\n      break;\n    }\n    if (end < r.end) {\n      break;\n    }\n  }\n  return { length: endPos - s, start: s, end: endPos };\n};\n\n/**\n * Splits a source string into ranges:\n * ```js\n * const ranges = splitRanges(\"hello;there;fella\", \";\");\n * ```\n *\n * Each range consists of:\n * ```js\n * {\n *  text: string  - the text of range\n *  start: number - start pos of range, wrt to source\n *  end: number   - end pos of range, wrt to source\n *  index: number - index of range (starting at 0)\n * }\n * ```\n * @param source\n * @param split\n * @returns\n */\nexport const splitRanges = (\n  source: string,\n  split: string\n): ReadonlyArray<Range> => {\n  //eslint-disable-next-line functional/no-let\n  let start = 0;\n  //eslint-disable-next-line functional/no-let\n  let text = ``;\n  const ranges: Array<Range> = [];\n  //eslint-disable-next-line functional/no-let\n  let index = 0;\n  //eslint-disable-next-line functional/no-let,unicorn/prevent-abbreviations\n  for (let i = 0; i < source.length; i++) {\n    if (source.indexOf(split, i) === i) {\n      //eslint-disable-next-line functional/no-let\n      const end = i;\n      //eslint-disable-next-line functional/immutable-data\n      ranges.push({\n        text,\n        start,\n        end,\n        index,\n      });\n      start = end + 1;\n      text = ``;\n      index++;\n    } else {\n      text += source.charAt(i);\n    }\n  }\n  if (start < source.length) {\n    //eslint-disable-next-line functional/immutable-data\n    ranges.push({ text, start, index, end: source.length });\n  }\n  return ranges;\n};\n\n/**\n * Counts the number of times one of `chars` appears at the front of\n * a string, contiguously.\n *\n * ```js\n * countCharsFromStart(`  hi`, ` `); // 2\n * countCharsFromStart(`hi  `, ` `); // 0\n * countCharsFromStart(`  hi  `, ` `); // 2\n * ```\n * @param source\n * @param chars\n * @returns\n */\nexport const countCharsFromStart = (\n  source: string,\n  ...chars: ReadonlyArray<string>\n): number => {\n  //eslint-disable-next-line functional/no-let\n  let counted = 0;\n  //eslint-disable-next-line functional/no-let\n  for (let index = 0; index < source.length; index++) {\n    if (chars.includes(source.charAt(index))) {\n      counted++;\n    } else {\n      break;\n    }\n  }\n  return counted;\n};\n\n/**\n * Returns _true_ if `source` starts and ends with `start` and `end`. Case-sensitive.\n * If _end_ is omitted, the the `start` value will be used.\n *\n * ```js\n * startsEnds(`This is a string`, `This`, `string`); // True\n * startsEnds(`This is a string`, `is`, `a`); // False\n * starsEnds(`test`, `t`); // True, starts and ends with 't'\n * ```\n * @param source String to search within\n * @param start Start\n * @param end End (if omitted, start will be looked for at end as well)\n * @returns True if source starts and ends with provided values.\n */\nexport const startsEnds = (\n  source: string,\n  start: string,\n  end: string = start\n): boolean => source.startsWith(start) && source.endsWith(end);\n\n//eslint-disable-next-line no-useless-escape\nexport const htmlEntities = (source: string): string =>\n  source.replaceAll(/[&<>\\u00A0-\\u9999]/g, (index) => `&#${ index.codePointAt(0) };`);\n\n\n/**\n * Simple wilcard matching. Use '*' in `pattern` to denote any number of characters.\n * ```js\n * // Must start with 'cat'\n * wildcard(`cat*`,`caterpillar`); // true\n * // Must end with 'cat'\n * wildcat(`*cat`, `bobcat`);  // true\n * // 'cat' anywhere in string\n * wildcard(`*cat*`, `see cat run`); // true\n * ```\n * @param pattern \n * @returns \n */\nexport const wildcard = (pattern: string) => {\n  // Based on source: https://stackoverflow.com/questions/26246601/wildcard-string-comparison-in-javascript\n  // for this solution to work on any string, no matter what characters it has\n  const escapeRegex = (value: string) => value.replaceAll(/([!$()*+./:=?[\\\\\\]^{|}])/g, `\\\\$1`);\n\n  // \".\"  => Find a single character, except newline or line terminator\n  // \".*\" => Matches any string that contains zero or more characters\n  pattern = pattern.split(`*`).map(m => escapeRegex(m)).join(`.*`);\n\n  // \"^\"  => Matches any string with the following at the beginning of it\n  // \"$\"  => Matches any string with that in front at the end of it\n  pattern = `^` + pattern + `$`\n\n  // Create a regular expression object for matching string\n  const regex = new RegExp(pattern);\n\n  return (value: string) => {\n    // Returns true if it finds a match, otherwse it returns false\n    return regex.test(value);\n  }\n}","/**\n * Throws an error if `array` parameter is not a valid array\n *\n * ```js\n * import { Arrays } from 'https://unpkg.com/ixfx/dist/data.js';\n * Arrays.guardArray(someVariable);\n * ```\n * @private\n * @param array\n * @param name\n */\nexport const guardArray = <V>(array: ArrayLike<V>, name = `?`) => {\n  if (array === undefined) {\n    throw new TypeError(`Param '${ name }' is undefined. Expected array.`);\n  }\n  if (array === null) {\n    throw new TypeError(`Param '${ name }' is null. Expected array.`);\n  }\n  if (!Array.isArray(array)) {\n    throw new TypeError(`Param '${ name }' not an array as expected`);\n  }\n};\n","export function* slice<V>(\n  it: Iterable<V>,\n  start = 0,\n  end = Number.POSITIVE_INFINITY\n) {\n  // https://surma.github.io/underdash/\n  const iit = it[ Symbol.iterator ]();\n  if (end < start) throw new Error(`Param 'end' should be more than 'start'`);\n\n  for (; start > 0; start--, end--) iit.next();\n\n  for (const v of it) {\n    if (end-- > 0) {\n      yield v;\n    } else {\n      break;\n    }\n  }\n}","import { throwIntegerTest } from \"../../util/GuardNumbers.js\";\nimport { guardArray } from \"./GuardArray.js\";\n/**\n * Throws if `index` is an invalid array index for `array`, and if\n * `array` itself is not a valid array.\n * @param array\n * @param index\n */\nexport const guardIndex = <V>(\n  array: ArrayLike<V>,\n  index: number,\n  name = `index`\n) => {\n  guardArray(array);\n  throwIntegerTest(index, `positive`, name);\n  if (index > array.length - 1) {\n    throw new Error(\n      `'${ name }' ${ index } beyond array max of ${ array.length - 1 }`\n    );\n  }\n};","import { isEqualDefault, type IsEqual } from \"../../util/IsEqual.js\";\nimport { guardArray } from \"./GuardArray.js\";\nimport { guardIndex } from \"./GuardIndex.js\";\n\nexport const withoutUndefined = <V>(data: ReadonlyArray<V> | Array<V>): Array<V> => {\n  return data.filter(v => v !== undefined);\n}\n\n/**\n * Returns two separate arrays of everything that `filter` returns _true_,\n * and everything it returns _false_ on. The in-built Array.filter() in\n * constrast only returns things that `filter` returns _true_ for.\n *\n * ```js\n * const [ matching, nonMatching ] = filterAB(data, v => v.enabled);\n * // `matching` is a list of items from `data` where .enabled is true\n * // `nonMatching` is a list of items from `data` where .enabled is false\n * ```\n * @param data Array of data to filter\n * @param filter Function which returns _true_ to add items to the A list, or _false_ for items to add to the B list\n * @returns Array of two elements. The first is items that match `filter`, the second is items that do not.\n */\nexport const filterAB = <V>(\n  data: ReadonlyArray<V>,\n  filter: (a: V) => boolean\n): [ a: Array<V>, b: Array<V> ] => {\n  const a: Array<V> = [];\n  const b: Array<V> = [];\n  for (const datum of data) {\n    //eslint-disable-next-line functional/immutable-data\n    if (filter(datum)) a.push(datum);\n    //eslint-disable-next-line functional/immutable-data\n    else b.push(datum);\n  }\n  return [ a, b ];\n};\n\n/**\n * Yields elements from `array` that match a given `predicate`, and moreover are between\n * the given `startIndex` (inclusive) and `endIndex` (exclusive).\n *\n * While this can be done with in the in-built `array.filter` function, it will\n * needlessly iterate through the whole array. It also avoids another alternative\n * of slicing the array before using `filter`.\n *\n * ```js\n * import { filterBetween } from 'https://unpkg.com/ixfx/dist/data.js';\n *\n * // Return 'registered' people between and including array indexes 5-10\n * const filtered = [...filterBetween(people, person => person.registered, 5, 10)];\n * ```\n * @param array Array to filter\n * @param predicate Filter function\n * @param startIndex Start index (defaults to 0)\n * @param endIndex End index (by default runs until end)\n */\nexport function* filterBetween<V>(\n  array: ReadonlyArray<V> | Array<V>,\n  predicate: (\n    value: V,\n    index: number,\n    array: ReadonlyArray<V> | Array<V>\n  ) => boolean,\n  startIndex?: number,\n  endIndex?: number\n): Generator<V> {\n  guardArray(array);\n  if (typeof startIndex === `undefined`) startIndex = 0;\n  if (typeof endIndex === `undefined`) endIndex = array.length; //- 1;\n  guardIndex(array, startIndex, `startIndex`);\n  guardIndex(array, endIndex - 1, `endIndex`);\n\n  //const t: Array<V> = [];\n\n  //eslint-disable-next-line functional/no-let\n  for (let index = startIndex; index < endIndex; index++) {\n    //eslint-disable-next-line functional/immutable-data\n    if (predicate(array[ index ], index, array)) yield array[ index ];//t.push(array[ index ]);\n  }\n  //return t;\n};\n\n\n/**\n * Returns an array with value(s) omitted. If value is not found, result will be a copy of input.\n * Value checking is completed via the provided `comparer` function.\n * By default checking whether `a === b`. To compare based on value, use the `isEqualValueDefault` comparer.\n *\n * @example\n * ```js\n * import { Arrays } from 'https://unpkg.com/ixfx/dist/data.js';\n *\n * const data = [100, 20, 40];\n * const filtered = Arrays.without(data, 20); // [100, 40]\n * ```\n *\n * @example Using value-based comparison\n * ```js\n * import { Arrays } from 'https://unpkg.com/ixfx/dist/data.js';\n *\n * const data = [{name: `Alice`}, {name:`Sam`}];\n *\n * // This wouldn't work as expected, because the default comparer uses instance,\n * // not value:\n * Arrays.without(data, {name: `Alice`});\n *\n * // So instead we can use a value comparer:\n * Arrays.without(data, {name:`Alice`}, isEqualValueDefault);\n * ```\n *\n * @example Use a function\n * ```js\n * import { Arrays } from 'https://unpkg.com/ixfx/dist/data.js';\n *\n * const data = [{name: `Alice`}, {name:`Sam`}];\n * Arrays.without(data, {name:`ALICE`}, (a, b) => {\n *  return (a.name.toLowerCase() === b.name.toLowerCase());\n * });\n * ```\n *\n * Consider {@link remove} to remove an item by index.\n *\n * @typeParam V - Type of array items\n * @param sourceArray Source array\n * @param toRemove Value(s) to remove\n * @param comparer Comparison function. If not provided `Util.isEqualDefault` is used, which compares using `===`\n * @return Copy of array without value.\n */\nexport const without = <V>(\n  //eslint-disable-next-line functional/prefer-readonly-type\n  sourceArray: ReadonlyArray<V> | Array<V>,\n  toRemove: V | Array<V>,\n  comparer: IsEqual<V> = isEqualDefault\n): Array<V> => {\n  if (Array.isArray(toRemove)) {\n    const returnArray = []\n    for (const source of sourceArray) {\n      if (!toRemove.some(v => comparer(source, v))) {\n        returnArray.push(source);\n      }\n    }\n    return returnArray;\n  } else {\n    return sourceArray.filter((v) => !comparer(v, toRemove));\n  }\n}","import { slice } from '../iterables/sync/Slice.js';\nimport { filterBetween } from '../data/arrays/Filter.js';\nimport type { MinMaxAvgOpts, MinMaxAvgTotal } from './Types.js';\n\n/**\n * Returns the min, max, avg and total of the array or iterable.\n * Any values that are invalid are silently skipped over.\n *\n * ```js\n * import { Arrays } from 'https://unpkg.com/ixfx/dist/collections.js';\n *\n * const v = [10, 2, 4.2, 99];\n * const mma = Arrays.minMaxAvg(v);\n * Yields: { min: 2, max: 99, total: 115.2, avg: 28.8 }\n * ```\n *\n * Use {@link Numbers.average}, {@link Numbers.max}, {@link Numbers.min} or {@link Numbers.total} if you only need one of these.\n *\n * A start and end range can be provided if the calculation should be restricted to a part\n * of the input array. By default the whole array is used.\n *\n * It's also possible to use an iterable as input.\n * ```js\n * Arrays.minMaxAvg(count(5,1)); // Averages 1,2,3,4,5\n * ```\n * @param data\n * @param opts Allows restriction of range that is examined\n * @returns `{min, max, avg, total}`\n */\nexport const minMaxAvg = (\n  //eslint-disable-next-line functional/prefer-readonly-type\n  data: ReadonlyArray<number> | Array<number> | Iterable<number>,\n  opts: MinMaxAvgOpts = {}\n): MinMaxAvgTotal => {\n  if (data === undefined) throw new Error(`'data' is undefined`);\n  if (!Array.isArray(data)) {\n    if (`next` in data) {\n      // eslint-disable-next-line @typescript-eslint/prefer-nullish-coalescing\n      if (opts.startIndex || opts.endIndex) {\n        data = slice(data, opts.startIndex, opts.endIndex);\n      }\n      //eslint-disable-next-line functional/no-let\n      let total = 0;\n      //eslint-disable-next-line functional/no-let\n      let min = Number.MAX_SAFE_INTEGER;\n      //eslint-disable-next-line functional/no-let\n      let max = Number.MIN_SAFE_INTEGER;\n      //eslint-disable-next-line functional/no-let\n      let samples = 0;\n      for (const v of data) {\n        if (typeof v !== `number`) {\n          throw new TypeError(`Generator should yield numbers. Got: ${ typeof v }`);\n        }\n        total += v;\n        samples++;\n        min = Math.min(min, v);\n        max = Math.max(max, v);\n      }\n      return {\n        avg: total / samples,\n        total,\n        max,\n        min,\n      };\n    } else {\n      throw new Error(`'data' parameter is neither array or iterable`);\n    }\n  }\n\n  if (data.length === 0) {\n    return {\n      total: 0,\n      min: 0,\n      max: 0,\n      avg: 0,\n    };\n  }\n  const startIndex = opts.startIndex ?? 0;\n  const endIndex = opts.endIndex ?? data.length;\n\n  const validNumbers = [ ...filterBetween<number>(\n    data,\n    (d) => typeof d === `number` && !Number.isNaN(d),\n    startIndex,\n    endIndex\n  ) ];\n  const total = validNumbers.reduce((accumulator, v) => accumulator + v, 0);\n  return {\n    total: total,\n    max: Math.max(...validNumbers),\n    min: Math.min(...validNumbers),\n    avg: total / validNumbers.length,\n  };\n};\n","import type { GuardResult } from \"./GuardTypes.js\";\n\nexport const isFunction = (object: unknown): object is (...args: Array<any>) => any => object instanceof Function;\n\nexport const functionTest = (value: unknown, parameterName = `?`): GuardResult => {\n  if (value === undefined) return [ false, `Param '${ parameterName }' is undefined. Expected: function.` ];\n  if (value === null) return [ false, `Param '${ parameterName }' is null. Expected: function.` ];\n  if (typeof value !== `function`) return [ false, `Param '${ parameterName }' is type '${ typeof value }'. Expected: function` ];\n  return [ true ];\n}\n\nexport const throwFunctionTest = (value: unknown, parameterName = `?`) => {\n  const [ ok, msg ] = functionTest(value, parameterName);\n  if (ok) return;\n  throw new TypeError(msg);\n}","import type { GuardResult } from \"./GuardTypes.js\";\nimport { throwFromResult } from \"./GuardThrowFromResult.js\";\n\nexport type StringGuardRange = `` | `non-empty`\n\n/**\n * Throws an error if parameter is not an string\n * @param value\n * @param parameterName\n */\nexport const stringTest = (value: unknown, range: StringGuardRange = ``, parameterName = `?`): GuardResult => {\n  if (typeof value !== `string`) return [ false, `Param '${ parameterName } is not type string. Got: ${ typeof value }` ];\n  switch (range) {\n    case `non-empty`:\n      if (value.length === 0) return [ false, `Param '${ parameterName } is empty` ];\n      break;\n  }\n  return [ true ];\n};\n\nexport const throwStringTest = (value: unknown, range: StringGuardRange = ``, parameterName = `?`) => {\n  throwFromResult(stringTest(value, range, parameterName));\n}\n\n","export * from './GuardArrays.js';\nexport * from './GuardEmpty.js';\nexport * from './GuardFunction.js';\nexport * from './GuardNumbers.js';\nexport * from './GuardObject.js';\nexport * from './GuardThrowFromResult.js';\nexport * from './GuardString.js';\n","import type { GuardResult } from \"./GuardTypes.js\";\nimport { throwFromResult } from \"./GuardThrowFromResult.js\";\n\n/**\n * Throws an error if parameter is not an array\n * @param value\n * @param parameterName\n */\nexport const arrayTest = (value: unknown, parameterName = `?`): GuardResult => {\n  if (!Array.isArray(value)) {\n    return [ false, `Parameter '${ parameterName }' is expected to be an array'` ];\n  }\n  return [ true ];\n};\n\nexport const throwArrayTest = (value: unknown, parameterName = `?`) => {\n  throwFromResult(arrayTest(value, parameterName));\n}\n\n/**\n * Returns true if parameter is an array of strings\n * @param value\n * @returns\n */\nexport const isStringArray = (value: unknown): boolean => {\n  if (!Array.isArray(value)) return false;\n  return !value.some((v) => typeof v !== `string`);\n};\n","import type { GuardResult } from \"./GuardTypes.js\";\n/**\n * Throws if `value` is _undefined_ or _null_.\n * @param value\n * @param parameterName\n */\n//eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport const nullUndef = (value: any, parameterName = `?`): GuardResult => {\n  if (typeof value === `undefined`) {\n    return [ false, `${ parameterName } param is undefined` ];\n  }\n  if (value === null) return [ false, `${ parameterName } param is null` ];\n  return [ true ];\n};\n\nexport const throwNullUndef = (value: any, parameterName = `?`) => {\n  const r = nullUndef(value, parameterName);\n  if (r[ 0 ]) return;\n  throw new Error(r[ 1 ]);\n}\n\n/** Throws an error if parameter is not defined */\nexport const defined = <T>(argument: T | undefined): argument is T =>\n  argument !== undefined;\n","/**\n * Returns _true_ if `value` is a plain object\n * \n * ```js\n * isPlainObject(`text`); // false\n * isPlainObject(document); // false\n * isPlainObject({ hello: `there` }); // true\n * ```\n * @param value \n * @returns \n */\nexport const isPlainObject = (value: unknown) => {\n  if (typeof value !== `object` || value === null) return false;\n  const prototype = Object.getPrototypeOf(value);\n  return (prototype === null || prototype === Object.prototype || Object.getPrototypeOf(prototype) === null) && !(Symbol.toStringTag in value) && !(Symbol.iterator in value);\n}\n\n/**\n * Returns _true_ if `value` is primitive value or plain object\n * @param value \n * @returns \n */\nexport const isPlainObjectOrPrimitive = (value: unknown) => {\n  const t = typeof value;\n  if (t === `symbol`) return false;\n  if (t === `function`) return false;\n  if (t === `bigint`) return true;\n  if (t === `number`) return true;\n  if (t === `string`) return true;\n  if (t === `boolean`) return true;\n  return isPlainObject(value);\n}","export const mapKeys = <TKey extends string | number | symbol>(object: Record<any, any>, mapFunction: (key: string) => TKey) => {\n  // @ts-expect-error\n  const destinationObject: Record<TKey, any> = {};\n  for (const entries of Object.entries(object)) {\n    const key = mapFunction(entries[ 0 ]);\n    destinationObject[ key ] = entries[ 1 ];\n  }\n  return destinationObject;\n}","export type * from './ArrayTypes.js';\nexport type * from './GuardTypes.js';\nexport * from './Comparers.js';\nexport * as Guards from './guards.js';\nexport * from './IsEqual.js';\nexport * from './IsEqualTrace.js';\nexport * from './IsInteger.js';\nexport * from './MapKeys.js';\nexport * from './Platform.js';\nexport * from './Results.js';\nexport * from './ToString.js';\nexport * from './KeyValue.js';","import { defaultToString } from \"./ToString.js\";\n\nexport type CompareResult = number; // 0 | 1 | -1;\nexport type Comparer<V> = (a: V, b: V) => CompareResult;\n\n/**\n * Sort numbers in ascending order.\n *\n * ```js\n * [10, 4, 5, 0].sort(numericComparer);\n * // Yields: [0, 4, 5, 10]\n * [10, 4, 5, 0].sort(comparerInverse(numericComparer));\n * // Yields: [ 10, 5, 4, 0]\n * ```\n * @param x\n * @param y\n * @returns\n */\nexport const numericComparer = (x: number, y: number): CompareResult => {\n  // ✔️ Unit tested\n  if (x === y) return 0;\n  if (x > y) return 1;\n  return -1;\n};\n\n/**\n * Default sort comparer, following same sematics as Array.sort.\n * Consider using {@link defaultComparer} to get more logical sorting of numbers.\n *\n * Note: numbers are sorted in alphabetical order, eg:\n * ```js\n * [ 10, 20, 5, 100 ].sort(jsComparer); // same as .sort()\n * // Yields: [10, 100, 20, 5]\n * ```\n * @param x\n * @param y\n * @returns\n */\n//eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport const jsComparer = (x: any, y: any): CompareResult => {\n  // ✔️ Unit tested\n\n  // Via https://stackoverflow.com/questions/47334234/how-to-implement-array-prototype-sort-default-compare-function\n  if (x === undefined && y === undefined) return 0;\n  if (x === undefined) return 1;\n  if (y === undefined) return -1;\n\n  const xString = defaultToString(x);\n  const yString = defaultToString(y);\n\n  if (xString < yString) return -1;\n  if (xString > yString) return 1;\n  return 0;\n};\n\n/**\n * Inverts the source comparer.\n * @param comparer\n * @returns\n */\nexport const comparerInverse = <V>(comparer: Comparer<V>): Comparer<V> => {\n  return (x: V, y: V) => {\n    const v = comparer(x, y);\n    return v * -1;\n  };\n};\n\n/**\n * Compares numbers by numeric value, otherwise uses the default\n * logic of string comparison.\n *\n * Is an ascending sort:\n *  b, a, c -> a, b, c\n *  10, 5, 100 -> 5, 10, 100\n * @param x\n * @param y\n * @see {@link comparerInverse} Inverted order\n * @returns\n */\n//eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport const defaultComparer = (x: any, y: any): CompareResult => {\n  if (typeof x === `number` && typeof y === `number`) {\n    return numericComparer(x, y);\n  }\n  return jsComparer(x, y);\n};","import { toStringAbbreviate } from \"../Text.js\";\nimport type { IsEqual } from \"./IsEqual.js\";\n\n\n/**\n * Wraps the `eq` function, tracing the input data result\n * ```js\n * // Init trace\n * const traceEq = isEqualTrace(isEqualValueDefault); \n * // Use it in some function that takes IsEqual<T>\n * compare(a, b, eq);\n * ```\n * @param eq \n * @returns \n */\nexport const isEqualTrace = <T>(eq: IsEqual<T>): IsEqual<T> => {\n  return (a, b) => {\n    const result = eq(a, b);\n    console.log(`isEqualTrace eq: ${ result } a: ${ toStringAbbreviate(a) } b: ${ toStringAbbreviate(b) }`);\n    return result;\n  }\n}","/**\n * Returns _true_ if `value` is an integer. Parses string input, but\n * all other data types return _false_.\n * \n * ```js\n * isInteger(1);      // true\n * isInteger(1.1);    // false\n * isInteger(`1`);    // true\n * isInteger(`1.1`);  // false\n * isInteger(true);   // false\n * isInteger(false);  // false\n * ```\n * \n * Returns _false_ for _undefined_, NaN, booleans and infinite numbers.\n * @param value \n * @returns \n */\nexport const isInteger = (value: string | number) => {\n  if (value === undefined) return false;\n  if (typeof value === `string`) {\n    const v = Number.parseInt(value);\n    if (Number.isNaN(v)) return false;\n    if (v.toString() === value.toString()) return true;\n    return false;\n  }\n  if (typeof value === `number`) {\n    if (Number.isNaN(value)) return false;\n    if (!Number.isFinite(value)) return false;\n    if (Math.round(value) === value) return true;\n    return false;\n  }\n  return false;\n}","//eslint-disable-next-line functional/functional-parameters\nexport const runningiOS = () =>\n  [\n    `iPad Simulator`,\n    `iPhone Simulator`,\n    `iPod Simulator`,\n    `iPad`,\n    `iPhone`,\n    `iPod`,\n  ].includes(navigator.platform) ||\n  // iPad on iOS 13 detection\n  (navigator.userAgent.includes(`Mac`) && `ontouchend` in document);","export type Result<T> = {\n  success: boolean\n  value?: T\n  error?: Error | string\n}\n\nexport type ResultOk<T> = {\n  success: true\n  value: T\n}\n\nexport type ResultError = {\n  success: false\n  error: Error | string\n}\n\n/**\n * If `result` is an error, throws it, otherwise ignored.\n * @param result \n * @returns \n */\nexport function throwResult<T>(result: Result<T>): result is ResultOk<T> {\n  if (result.success) return true;\n  if (typeof result.error === `string`) throw new Error(result.error);\n  throw result.error;\n}","\nimport type { KeyValue } from '../PrimitiveTypes.js';\nimport { defaultComparer } from './index.js';\nimport { minMaxAvg as arrayMinMaxAg } from '../numbers/MinMaxAvg.js';\n\n// const byKey = (reverse = false) => pipe(\n//   reverse ? reverseOrd(S.Ord) : S.Ord,\n//   contramap((v: KeyValue) => v[ 0 ])\n// );\n\n// export const byValueString = (reverse = false) => pipe(\n//   reverse ? reverseOrd(S.Ord) : S.Ord,\n//   contramap((v: KeyValue) => v[ 1 ] as string)\n// );\n\n// const byValueNumber = (reverse = false) => pipe(\n//   reverse ? reverseOrd(N.Ord) : N.Ord,\n//   contramap((v: KeyValue) => v[ 1 ] as number)\n// );\n\n// export const sortByKey = (reverse = false) => sort<KeyValue>(byKey(reverse));\n// export const sortByValueString = (reverse = false) => sort<KeyValue>(byValueString(reverse));\n// export const sortByValueNumber = (reverse = false) => sort<KeyValue>(byValueNumber(reverse));\n\n// eslint-disable-next-line functional/prefer-readonly-type,functional/prefer-immutable-types\nexport type KeyValueSorter = (data: Array<KeyValue>) => Array<KeyValue>;\n\nconst sorterByValueIndex = (index: number, reverse = false) => {\n  return (values: Array<KeyValue>) => {\n    const s = values.toSorted((a, b) => {\n      return defaultComparer(a[ index ], b[ index ]);\n    });\n    if (reverse) return s.reverse();\n    return s;\n  }\n}\n\nexport type SortSyles = `value` | `value-reverse` | `key` | `key-reverse`;\nexport const getSorter = (sortStyle: SortSyles): KeyValueSorter => {\n  switch (sortStyle) {\n    case `value`: {\n      return sorterByValueIndex(1, false);\n    }\n    case `value-reverse`: {\n      return sorterByValueIndex(1, true);\n    }\n    case `key`: {\n      return sorterByValueIndex(0, false);\n    }\n    case `key-reverse`: {\n      return sorterByValueIndex(0, true);\n    }\n    default: {\n      throw new Error(`Unknown sorting value '${ (sortStyle as string) }'. Expecting: value, value-reverse, key or key-reverse`);\n    }\n  }\n};\n\n\nexport const minMaxAvg = (entries: ReadonlyArray<KeyValue>, conversionFunction?: (v: KeyValue) => number) => {\n  const converter = conversionFunction ?? ((v: KeyValue) => v[ 1 ] as number);\n  const values = entries.map<number>(entry => converter(entry));\n  return arrayMinMaxAg(values);\n};","import { isEqualDefault, type IsEqual } from '../../util/IsEqual.js';\nimport {\n  toStringDefault,\n  defaultComparer,\n  type ToString,\n} from '../../util/index.js';\nimport type { IWithEntries } from '../../data/maps/IMappish.js';\n\n// ✔ UNIT TESTED!\n/**\n * Gets the closest integer key to `target` in `data`.\n * * Requires map to have numbers as keys, not strings\n * * Math.round is used for rounding `target`.\n *\n * Examples:\n * ```js\n * // Assuming numeric keys 1, 2, 3, 4 exist:\n * getClosestIntegerKey(map, 3);    // 3\n * getClosestIntegerKey(map, 3.1);  // 3\n * getClosestIntegerKey(map, 3.5);  // 4\n * getClosestIntegerKey(map, 3.6);  // 4\n * getClosestIntegerKey(map, 100);  // 4\n * getClosestIntegerKey(map, -100); // 1\n * ```\n * @param data Map\n * @param target Target value\n * @returns\n */\nexport const getClosestIntegerKey = (\n  data: ReadonlyMap<number, any>,\n  target: number\n): number => {\n  target = Math.round(target);\n  if (data.has(target)) {\n    return target;\n  } else {\n    //eslint-disable-next-line functional/no-let\n    let offset = 1;\n    while (offset < 1000) {\n      if (data.has(target - offset)) return target - offset;\n      else if (data.has(target + offset)) return target + offset;\n      offset++;\n    }\n    throw new Error(`Could not find target ${ target }`);\n  }\n};\n\n/**\n * Returns the first value in `data` that matches a key from `keys`.\n * ```js\n * // Iterate, yielding: `a.b.c.d`, `b.c.d`, `c.d`, `d`\n * const keys = Text.segmentsFromEnd(`a.b.c.d`);\n * // Gets first value that matches a key (starting from most precise)\n * const value = getFromKeys(data, keys);\n * ```\n * @param data \n * @param keys \n * @returns \n */\nexport const getFromKeys = <T>(data: ReadonlyMap<string, T>, keys: Iterable<string>): T | undefined => {\n  for (const key of keys) {\n    if (data.has(key)) return data.get(key);\n  }\n}\n\n/**\n * Returns true if map contains `value` under `key`, using `comparer` function. Use {@link hasAnyValue} if you don't care\n * what key value might be under.\n *\n * Having a comparer function is useful to check by value rather than object reference.\n *\n * @example Find key value based on string equality\n * ```js\n * hasKeyValue(map,`hello`, `samantha`, (a, b) => a === b);\n * ```\n * @param map Map to search\n * @param key Key to search\n * @param value Value to search\n * @param comparer Function to determine match\n * @returns True if key is found\n */\nexport const hasKeyValue = <K, V>(\n  map: ReadonlyMap<K, V>,\n  key: K,\n  value: V,\n  comparer: IsEqual<V>\n): boolean => {\n  if (!map.has(key)) return false;\n  const values = [ ...map.values() ];\n  return values.some((v) => comparer(v, value));\n};\n\n/**\n * Deletes all key/values from map where value matches `value`,\n * with optional comparer. Mutates map.\n *\n * ```js\n * import { Maps } from \"https://unpkg.com/ixfx/dist/collections.js\"\n *\n * // Compare fruits based on their colour property\n * const colourComparer = (a, b) => a.colour === b.colour;\n *\n * // Deletes all values where .colour = `red`\n * Maps.deleteByValue(map, { colour: `red` }, colourComparer);\n * ```\n * @param map\n * @param value\n * @param comparer\n */\nexport const deleteByValue = <K, V>(\n  map: ReadonlyMap<K, V>,\n  value: V,\n  comparer: IsEqual<V> = isEqualDefault\n) => {\n  for (const entry of Object.entries(map)) {\n    if (comparer(entry[ 1 ], value)) {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-call\n      (map as any).delete(entry[ 0 ]);\n    }\n  }\n};\n\n\n\n/**\n * Finds first entry by iterable value. Expects a map with an iterable as values.\n *\n * ```js\n * const map = new Map();\n * map.set('hello', 'a');\n * map.set('there', 'b');\n *\n * const entry = firstEntryByPredicate(map, (value, key) => {\n *  return (value === 'b');\n * });\n * // Entry is: ['there', 'b']\n * ```\n *\n * An alternative is {@link firstEntryByValue} to search by value.\n * @param map Map to search\n * @param predicate Filter function returns true when there is a match of value\n * @returns Entry, or _undefined_ if `filter` function never returns _true_\n */\nexport const firstEntryByPredicate = <K, V>(\n  map: IWithEntries<K, V>,\n  predicate: (value: V, key: K) => boolean\n): readonly [ key: K, value: V ] | undefined => {\n  for (const entry of map.entries()) {\n    if (predicate(entry[ 1 ], entry[ 0 ])) return entry;\n  }\n};\n\n/**\n * Finds first entry by value.\n *\n * ```js\n * const map = new Map();\n * map.set('hello', 'a');\n * map.set('there', 'b');\n *\n * const entry = firstEntryByValue(map, 'b');\n * // Entry is: ['there', 'b']\n * ```\n *\n * An alternative is {@link firstEntryByValue} to search by predicate function.\n * @param map Map to search\n * @param value Value to seek\n * @param isEqual Filter function which checks equality. Uses JS comparer by default.\n * @returns Entry, or _undefined_ if `value` not found.\n */\nexport const firstEntryByValue = <K, V>(\n  map: IWithEntries<K, V>,\n  value: V,\n  isEqual: IsEqual<V> = isEqualDefault\n): readonly [ key: K, value: V ] | undefined => {\n  for (const entry of map.entries()) {\n    if (isEqual(entry[ 1 ], value)) return entry;\n  }\n};\n\n\n\n/**\n * Adds items to a map only if their key doesn't already exist\n *\n * Uses provided {@link Util.ToString} function to create keys for items. Item is only added if it doesn't already exist.\n * Thus the older item wins out, versus normal `Map.set` where the newest wins.\n *\n *\n * @example\n * ```js\n * import { Maps } from \"https://unpkg.com/ixfx/dist/collections.js\";\n * const map = new Map();\n * const peopleArray = [ _some people objects..._];\n * Maps.addKeepingExisting(map, p => p.name, ...peopleArray);\n * ```\n * @param set\n * @param hasher\n * @param values\n * @returns\n */\nexport const addKeepingExisting = <V>(\n  set: ReadonlyMap<string, V> | undefined,\n  hasher: ToString<V>,\n  ...values: ReadonlyArray<V>\n) => {\n  const s = set === undefined ? new Map() : new Map(set);\n  for (const v of values) {\n    const hashResult = hasher(v);\n    if (s.has(hashResult)) continue;\n    s.set(hashResult, v);\n  }\n  return s;\n};\n\n/**\n * Returns a array of entries from a map, sorted by value.\n *\n * ```js\n * const m = new Map();\n * m.set(`4491`, { name: `Bob` });\n * m.set(`2319`, { name: `Alice` });\n *\n * // Compare by name\n * const comparer = (a, b) => defaultComparer(a.name, b.name);\n *\n * // Get sorted values\n * const sorted = Maps.sortByValue(m, comparer);\n * ```\n *\n * `sortByValue` takes a comparison function that should return -1, 0 or 1 to indicate order of `a` to `b`. If not provided, {@link Util.defaultComparer} is used.\n * @param map\n * @param comparer\n * @returns\n */\nexport const sortByValue = <K, V>(\n  map: ReadonlyMap<K, V>,\n  comparer?: (a: V, b: V) => number\n) => {\n  const f = comparer ?? defaultComparer;\n  return [ ...map.entries() ].sort((a, b) => f(a[ 1 ], b[ 1 ]));\n};\n\n/**\n * Returns an array of entries from a map, sorted by a property of the value\n *\n * ```js\n * cosnt m = new Map();\n * m.set(`4491`, { name: `Bob` });\n * m.set(`2319`, { name: `Alice` });\n * const sorted = Maps.sortByValue(m, `name`);\n * ```\n * @param map Map to sort\n * @param property Property of value\n * @param compareFunction Comparer. If unspecified, uses a default.\n */\nexport const sortByValueProperty = <K, V, Z>(\n  map: ReadonlyMap<K, V>,\n  property: string,\n  compareFunction?: (a: Z, b: Z) => number\n) => {\n  const cfn = typeof compareFunction === `undefined` ? defaultComparer : compareFunction;\n  return [ ...map.entries() ].sort((aE, bE) => {\n    const a = aE[ 1 ];\n    const b = bE[ 1 ];\n    // @ts-expect-error\n    return cfn(a[ property ], b[ property ]);\n  });\n};\n/**\n * Returns _true_ if any key contains `value`, based on the provided `comparer` function. Use {@link hasKeyValue}\n * if you only want to find a value under a certain key.\n *\n * Having a comparer function is useful to check by value rather than object reference.\n * @example Finds value where name is 'samantha', regardless of other properties\n * ```js\n * hasAnyValue(map, {name:`samantha`}, (a, b) => a.name === b.name);\n * ```\n *\n * Works by comparing `value` against all values contained in `map` for equality using the provided `comparer`.\n *\n * @param map Map to search\n * @param value Value to find\n * @param comparer Function that determines matching. Should return true if `a` and `b` are considered equal.\n * @returns True if value is found\n */\nexport const hasAnyValue = <K, V>(\n  map: ReadonlyMap<K, V>,\n  value: V,\n  comparer: IsEqual<V>\n): boolean => {\n  const entries = [ ...map.entries() ];\n  return entries.some((kv) => comparer(kv[ 1 ], value));\n};\n\n/**\n * Returns values where `predicate` returns true.\n *\n * If you just want the first match, use `find`\n *\n * @example All people over thirty\n * ```js\n * // for-of loop\n * for (const v of filter(people, person => person.age > 30)) {\n *\n * }\n * // If you want an array\n * const overThirty = Array.from(filter(people, person => person.age > 30));\n * ```\n * @param map Map\n * @param predicate Filtering predicate\n * @returns Values that match predicate\n */\n//eslint-disable-next-line func-style\nexport function* filter<V>(\n  map: ReadonlyMap<string, V>,\n  predicate: (v: V) => boolean\n) {\n  for (const v of map.values()) {\n    if (predicate(v)) yield v;\n  }\n}\n\n//export const filter = <V>(map:ReadonlyMap<string, V>, predicate:(v:V) => boolean):ReadonlyArray<V> => Array.from(map.values()).filter(predicate);\n\n/**\n * Copies data to an array\n * @param map\n * @returns\n */\nexport const toArray = <V>(map: ReadonlyMap<string, V>): ReadonlyArray<V> =>\n  [ ...map.values() ];\n\n\n/**\n * import { Maps } from 'https://unpkg.com/ixfx/dist/data.js';\n * Returns a Map from an iterable. By default throws an exception\n * if iterable contains duplicate values.\n *\n * ```js\n * const data = [\n *  { fruit: `granny-smith`, family: `apple`, colour: `green` }\n *  { fruit: `mango`, family: `stone-fruit`, colour: `orange` }\n * ];\n * const map = Maps.fromIterable(data, v => v.fruit);\n * ```\n * @param data Input data\n * @param keyFunction Function which returns a string id. By default uses the JSON value of the object.\n * @param allowOverwrites When set to _true_, items with same id will silently overwrite each other, with last write wins. _false_ by default.\n * @returns\n */\nexport const fromIterable = <V>(\n  data: Iterable<V>,\n  keyFunction = toStringDefault<V>,\n  allowOverwrites = false\n): ReadonlyMap<string, V> => {\n  const m = new Map<string, V>();\n  for (const d of data) {\n    const id = keyFunction(d);\n    if (m.has(id) && !allowOverwrites) {\n      throw new Error(\n        `id ${ id } is already used and new data will overwrite it. `\n      );\n    }\n    m.set(id, d);\n  }\n  return m;\n};\n\n/**\n * Returns a Map from an object, or array of objects.\n * Assumes the top-level properties of the object is the key.\n *\n * ```js\n * import { Maps } from 'https://unpkg.com/ixfx/dist/data.js';\n * const data = {\n *  Sally: { name: `Sally`, colour: `red` },\n *  Bob: { name: `Bob`, colour: `pink` }\n * };\n * const map = Maps.fromObject(data);\n * map.get(`Sally`); // { name: `Sally`, colour: `red` }\n * ```\n *\n * To add an object to an existing map, use {@link addObject}.\n * @param data\n * @returns\n */\n//eslint-disable-next-line @typescript-eslint/no-explicit-any,functional/prefer-readonly-type\nexport const fromObject = <V>(data: any): ReadonlyMap<string, V> => {\n  //eslint-disable-next-line @typescript-eslint/no-explicit-any,functional/prefer-readonly-type\n  const map = new Map<string, V>();\n  if (Array.isArray(data)) {\n    for (const d of data) addObject<V>(map, d);\n  } else {\n    addObject<V>(map, data);\n  }\n  return map;\n};\n\n/**\n * Adds an object to an existing map. It assumes a structure where\n * each top-level property is a key:\n *\n * ```js\n * import { Maps } from 'https://unpkg.com/ixfx/dist/data.js';\n * const data = {\n *  Sally: { colour: `red` },\n *  Bob:   { colour: `pink` }\n * };\n * const map = new Map();\n * Maps.addObject(map, data);\n *\n * map.get(`Sally`); // { name: `Sally`, colour: `red` }\n * ```\n *\n * To create a new map from an object, use {@link fromObject} instead.\n * @param map\n * @param data\n */\n//eslint-disable-next-line @typescript-eslint/no-explicit-any,functional/prefer-readonly-type\nexport const addObject = <V>(map: Map<string, V>, data: any) => {\n  const entries = Object.entries(data);\n  for (const [ key, value ] of entries) {\n    map.set(key, value as V);\n  }\n};\n/**\n * Returns the first found value that matches `predicate` or _undefined_.\n *\n * Use {@link some} if you don't care about the value, just whether it appears.\n * Use {@link filter} to get all value(s) that match `predicate`.\n *\n * @example First person over thirty\n * ```js\n * const overThirty = find(people, person => person.age > 30);\n * ```\n * @param map Map to search\n * @param predicate Function that returns true for a matching value\n * @returns Found value or _undefined_\n */\nexport const find = <V>(\n  map: ReadonlyMap<string, V>,\n  predicate: (v: V) => boolean\n): V | undefined => [ ...map.values() ].find(v => predicate(v));\n\n/**\n * Returns _true_ if `predicate` yields _true_ for any value in `map`.\n * Use {@link find} if you want the matched value.\n * ```js\n * const map = new Map();\n * map.set(`fruit`, `apple`);\n * map.set(`colour`, `red`);\n * Maps.some(map, v => v === `red`);    // true\n * Maps.some(map, v => v === `orange`); // false\n * ```\n * @param map \n * @param predicate \n * @returns \n */\nexport const some = <V>(map: ReadonlyMap<string, V>, predicate: (v: V) => boolean): boolean => [ ...map.values() ].some(v => predicate(v));\n\n/**\n * Converts a map to a simple object, transforming from type `T` to `K` as it does so. If no transforms are needed, use {@link toObject}.\n *\n * ```js\n * const map = new Map();\n * map.set(`name`, `Alice`);\n * map.set(`pet`, `dog`);\n *\n * const o = mapToObjectTransform(map, v => {\n *  ...v,\n *  registered: true\n * });\n *\n * // Yields: { name: `Alice`, pet: `dog`, registered: true }\n * ```\n *\n * If the goal is to create a new map with transformed values, use {@link transformMap}.\n * @param m\n * @param valueTransform\n * @typeParam T Value type of input map\n * @typeParam K Value type of destination map\n * @returns\n */\n//eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport const mapToObjectTransform = <T, K>(\n  m: ReadonlyMap<string, T>,\n  valueTransform: (value: T) => K\n): Readonly<Record<string, K>> =>\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-return, unicorn/no-array-reduce\n  [ ...m ].reduce((object: any, [ key, value ]) => {\n    const t = valueTransform(value);\n    /* eslint-disable-next-line functional/immutable-data */\n    object[ key ] = t;\n    return object;\n  }, {});\n\n/**\n * Zips together an array of keys and values into an object. Requires that\n * `keys` and `values` are the same length.\n *\n * @example\n * ```js\n * const o = zipKeyValue([`a`, `b`, `c`], [0, 1, 2])\n * Yields: { a: 0, b: 1, c: 2}\n *```\n * @param keys String keys\n * @param values Values\n * @typeParam V Type of values\n * @return Object with keys and values\n */\nexport const zipKeyValue = <V>(\n  keys: ReadonlyArray<string>,\n  values: ArrayLike<V | undefined>\n) => {\n  if (keys.length !== values.length) {\n    throw new Error(`Keys and values arrays should be same length`);\n  }\n  return Object.fromEntries(keys.map((k, index) => [ k, values[ index ] ]));\n};\n\n//#region Functions by Kees C. Bakker\n// Functions by Kees C. Bakker\n// https://keestalkstech.com/2021/10/having-fun-grouping-arrays-into-maps-with-typescript/\n\n/**\n * Like `Array.map`, but for a Map. Transforms from Map<K,V> to Map<K,R>, returning as a new Map.\n *\n * @example\n * ```js\n * const mapOfStrings = new Map();\n * mapOfStrings.set(`a`, `10`);\n * mapOfStrings.get(`a`); // Yields `10` (a string)\n *\n * // Convert a map of string->string to string->number\n * const mapOfInts = transformMap(mapOfStrings, (value, key) => parseInt(value));\n *\n * mapOfInts.get(`a`); // Yields 10 (a proper number)\n * ```\n *\n * If you want to combine values into a single object, consider instead  {@link mapToObjectTransform}.\n * @param source\n * @param transformer\n * @typeParam K Type of keys (generally a string)\n * @typeParam V Type of input map values\n * @typeParam R Type of output map values\n * @returns\n */\nexport const transformMap = <K, V, R>(\n  source: ReadonlyMap<K, V>,\n  transformer: (value: V, key: K) => R\n) => new Map(Array.from(source, (v) => [ v[ 0 ], transformer(v[ 1 ], v[ 0 ]) ]));\n\n/**\n * Converts a `Map` to a plain object, useful for serializing to JSON.\n * To convert back to a map use {@link fromObject}.\n *\n * @example\n * ```js\n * const map = new Map();\n * map.set(`Sally`, { name: `Sally`, colour: `red` });\n * map.set(`Bob`, { name: `Bob`, colour: `pink });\n *\n * const objects = Maps.toObject(map);\n * // Yields: {\n * //  Sally: { name: `Sally`, colour: `red` },\n * //  Bob: { name: `Bob`, colour: `pink` }\n * // }\n * ```\n * @param m\n * @returns\n */\n/* eslint-disable-next-line @typescript-eslint/no-explicit-any */\nexport const toObject = <T>(\n  m: ReadonlyMap<string, T>\n): Readonly<Record<string, T>> =>\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n  [ ...m ].reduce((object: any, [ key, value ]) => {\n    /* eslint-disable-next-line functional/immutable-data */\n    object[ key ] = value;\n    return object;\n  }, {});\n\n/**\n * Converts Map to Array with a provided `transformer` function. Useful for plucking out certain properties\n * from contained values and for creating a new map based on transformed values from an input map.\n *\n * @example Get an array of ages from a map of Person objects\n * ```js\n * let person = { age: 29, name: `John`};\n * map.add(person.name, person);\n *\n * const ages = mapToArray(map, (key, person) => person.age);\n * // [29, ...]\n * ```\n *\n * In the above example, the `transformer` function returns a number, but it could\n * just as well return a transformed version of the input:\n *\n * ```js\n * // Return with random heights and uppercased name\n * mapToArray(map, (key, person) => ({\n *  ...person,\n *  height: Math.random(),\n *  name: person.name.toUpperCase();\n * }))\n * // Yields:\n * // [{height: 0.12, age: 29, name: \"JOHN\"}, ...]\n * ```\n * @param m\n * @param transformer A function that takes a key and item, returning a new item.\n * @returns\n */\nexport const mapToArray = <K, V, R>(\n  m: ReadonlyMap<K, V>,\n  transformer: (key: K, item: V) => R\n): ReadonlyArray<R> => [ ...m.entries() ].map((x) => transformer(x[ 0 ], x[ 1 ]));\n// End Functions by Kees C. Bakker\n//#endregion\n\n/**\n * Returns a result of a merged into b.\n * B is always the 'newer' data that takes\n * precedence.\n */\nexport type MergeReconcile<V> = (a: V, b: V) => V;\n\n/**\n * Merges maps left to right, using the provided\n * `reconcile` function to choose a winner when keys overlap.\n *\n * There's also {@link Data.Arrays.mergeByKey Arrays.mergeByKey} if you don't already have a map.\n *\n * For example, if we have the map A:\n * 1 => `A-1`, 2 => `A-2`, 3 => `A-3`\n *\n * And map B:\n * 2 => `B-1`, 2 => `B-2`, 4 => `B-4`\n *\n * If they are merged with the reconile function:\n * ```js\n * const reconcile = (a, b) => b.replace(`-`, `!`);\n * const output = mergeByKey(reconcile, mapA, mapB);\n * ```\n *\n * The final result will be:\n *\n * 1 => `B!1`, 2 => `B!2`, 3 => `A-3`, 4 => `B-4`\n *\n * In this toy example, it's obvious how the reconciler transforms\n * data where the keys overlap. For the keys that do not overlap -\n * 3 and 4 in this example - they are copied unaltered.\n *\n * A practical use for `mergeByKey` has been in smoothing keypoints\n * from a TensorFlow pose. In this case, we want to smooth new keypoints\n * with older keypoints. But if a keypoint is not present, for it to be\n * passed through.\n *\n * @param reconcile\n * @param maps\n */\nexport const mergeByKey = <K, V>(\n  reconcile: MergeReconcile<V>,\n  ...maps: ReadonlyArray<ReadonlyMap<K, V>>\n): ReadonlyMap<K, V> => {\n  const result = new Map<K, V>();\n  for (const m of maps) {\n    for (const [ mk, mv ] of m) {\n      //eslint-disable-next-line functional/no-let\n      let v = result.get(mk);\n      v = v ? reconcile(v, mv) : mv;\n      result.set(mk, v);\n    }\n  }\n  return result;\n};\n","export { create as expiringMap } from './ExpiringMap.js';\nexport type {\n  ExpiringMapEvent,\n  ExpiringMapEvents,\n  Opts as ExpiringMapOpts,\n} from './ExpiringMap.js';\n\nexport type { IMapOf } from './IMapOf.js';\nexport { immutable, type IMapImmutable } from './Map.js';\nexport { mutable, type IMapMutable } from './MapMutable.js';\nexport { ofSetMutable } from './MapOfSetMutable.js';\nexport { ofCircularMutable } from './MapOfCircularMutable.js';\nexport type { MapCircularOpts } from './MapOfCircularMutable.js';\nexport type { IMapOfMutable } from './IMapOfMutable.js';\nexport type { MapArrayOpts } from './MapOfArrayMutable.js';\nexport { NumberMap } from './NumberMap.js';\nexport * from './MapMulti.js';\n\nexport type { IDictionary as IMappish, IWithEntries } from '../../data/maps/IMappish.js';\n","import { SimpleEventEmitter } from '../../Events.js';\nimport { sortByValueProperty } from '../../data/maps/MapFns.js';\nimport { intervalToMs, type Interval } from '../../flow/IntervalType.js';\nimport { throwIntegerTest } from '../../util/GuardNumbers.js';\n\n/**\n * Expiring map options\n */\nexport type Opts = {\n  /**\n   * Capacity limit\n   */\n  readonly capacity?: number;\n  /**\n   * Policy for evicting items if capacity is reached\n   */\n  readonly evictPolicy?: `none` | `oldestGet` | `oldestSet`;\n  /**\n   * Automatic deletion policy.\n   * none: no automatic deletion (default)\n   * get/set: interval based on last get/set\n   * either: if either interval has elapsed\n   */\n  readonly autoDeletePolicy?: `none` | `get` | `set` | `either`;\n  /**\n   * Automatic deletion interval\n   */\n  readonly autoDeleteElapsedMs?: number;\n};\n\ntype Item<V> = {\n  readonly value: V;\n  readonly lastSet: number;\n  readonly lastGet: number;\n};\n\n/**\n * Event from the ExpiringMap\n */\nexport type ExpiringMapEvent<K, V> = {\n  readonly key: K;\n  readonly value: V;\n};\n\nexport type ExpiringMapEvents<K, V> = {\n  /**\n   * Fires when an item is removed due to eviction\n   * or automatic expiry\n   */\n  readonly expired: ExpiringMapEvent<K, V>;\n  /**\n   * Fires when a item with a new key is added\n   */\n  readonly newKey: ExpiringMapEvent<K, V>;\n\n  /**\n   * Fires when an item is manually removed,\n   * removed due to eviction or automatic expiry\n   */\n  readonly removed: ExpiringMapEvent<K, V>;\n};\n\n/**\n * Create a ExpiringMap instance\n * @param options Options when creating map\n * @returns\n */\nexport const create = <K, V>(options: Opts = {}): ExpiringMap<K, V> =>\n  new ExpiringMap(options);\n/***\n * A map that can have a capacity limit. The elapsed time for each get/set\n * operation is maintained allowing for items to be automatically removed.\n * `has()` does not affect the last access time.\n *\n * By default, it uses the `none` eviction policy, meaning that when full\n * an error will be thrown if attempting to add new keys.\n *\n * Eviction policies:\n * `oldestGet` removes the item that hasn't been accessed the longest,\n * `oldestSet` removes the item that hasn't been updated the longest.\n *\n * ```js\n * const map = new ExpiringMap();\n * map.set(`fruit`, `apple`);\n *\n * // Remove all entries that were set more than 100ms ago\n * map.deleteWithElapsed(100, `set`);\n * // Remove all entries that were last accessed more than 100ms ago\n * map.deleteWithElapsed(100, `get`);\n * // Returns the elapsed time since `fruit` was last accessed\n * map.elapsedGet(`fruit`);\n * // Returns the elapsed time since `fruit` was last set\n * map.elapsedSet(`fruit`);\n * ```\n *\n * Last set/get time for a key can be manually reset using {@link touch}.\n *\n *\n * Events:\n * * 'expired': when an item is automatically removed.\n * * 'removed': when an item is manually or automatically removed.\n * * 'newKey': when a new key is added\n *\n * ```js\n * map.addEventListener(`expired`, evt => {\n *  const { key, value } = evt;\n * });\n * ```\n * The map can automatically remove items based on elapsed intervals.\n *\n * @example\n * Automatically delete items that haven't been accessed for one second\n * ```js\n * const map = new ExpiringMap({\n *  autoDeleteElapsed: 1000,\n *  autoDeletePolicy: `get`\n * });\n * ```\n *\n * @example\n * Automatically delete the oldest item if we reach a capacity limit\n * ```js\n * const map = new ExpiringMap({\n *  capacity: 5,\n *  evictPolicy: `oldestSet`\n * });\n * ```\n * @typeParam K - Type of keys\n * @typeParam V - Type of values\n */\nexport class ExpiringMap<K, V> extends SimpleEventEmitter<\n  ExpiringMapEvents<K, V>\n> {\n  private capacity: number;\n  private store: Map<K, Item<V>>;\n  //private keyCount: number;\n  private evictPolicy;\n\n  private autoDeleteElapsedMs: number;\n  private autoDeletePolicy;\n\n  constructor(opts: Opts = {}) {\n    super();\n    this.capacity = opts.capacity ?? -1;\n\n    throwIntegerTest(this.capacity, `nonZero`, `capacity`);\n    this.store = new Map();\n    //this.keyCount = 0;\n\n    if (opts.evictPolicy && this.capacity <= 0) {\n      throw new Error(`evictPolicy is set, but no capacity limit is set`);\n    }\n    this.evictPolicy = opts.evictPolicy ?? `none`;\n    this.autoDeleteElapsedMs = opts.autoDeleteElapsedMs ?? -1;\n    this.autoDeletePolicy = opts.autoDeletePolicy ?? `none`;\n\n    if (this.autoDeleteElapsedMs > 0) {\n      setInterval(\n        () => { this.#maintain(); },\n        Math.max(1000, this.autoDeleteElapsedMs * 2)\n      );\n    }\n  }\n\n  /**\n   * Returns the number of keys being stored.\n   */\n  get keyLength() {\n    return this.store.size;// keyCount;\n  }\n\n  *entries(): IterableIterator<[ k: K, v: V ]> {\n    for (const entry of this.store.entries()) {\n      yield [ entry[ 0 ], entry[ 1 ].value ];\n    }\n  }\n\n  *values(): IterableIterator<V> {\n    for (const v of this.store.values()) {\n      yield v.value;\n    }\n  }\n\n  *keys(): IterableIterator<K> {\n    yield* this.store.keys();\n  }\n\n  /**\n   * Returns the elapsed time since `key`\n   * was set. Returns _undefined_ if `key`\n   * does not exist\n   */\n  elapsedSet(key: K): number | undefined {\n    const v = this.store.get(key);\n    if (!v) return v;\n    return Date.now() - v.lastSet;\n  }\n\n  /**\n   * Returns the elapsed time since `key`\n   * was accessed. Returns _undefined_ if `key`\n   * does not exist\n   */\n  elapsedGet(key: K): number | undefined {\n    const v = this.store.get(key);\n    if (!v) return v;\n    return Date.now() - v.lastGet;\n  }\n\n  /**\n   * Returns true if `key` is stored.\n   * Does not affect the key's last access time.\n   * @param key\n   * @returns\n   */\n  has(key: K): boolean {\n    return this.store.has(key);\n  }\n\n  /**\n   * Gets an item from the map by key, returning\n   * undefined if not present\n   * @param key Key\n   * @returns Value, or undefined\n   */\n  get(key: K): V | undefined {\n    const v = this.store.get(key);\n    if (v) {\n      if (this.autoDeletePolicy === `either` || this.autoDeletePolicy === `get`) {\n        this.store.set(key, {\n          ...v,\n          lastGet: performance.now(),\n        });\n      }\n      return v.value;\n    }\n  }\n\n  /**\n   * Deletes the value under `key`, if present.\n   *\n   * Returns _true_ if something was removed.\n   * @param key\n   * @returns\n   */\n  delete(key: K): boolean {\n    const value = this.store.get(key);\n    if (!value) return false;\n    const d = this.store.delete(key);\n    //this.keyCount = this.keyCount - 1;\n    this.fireEvent(`removed`, {\n      key,\n      value: value.value,\n    });\n    return d;\n  }\n\n  /**\n   * Clears the contents of the map.\n   * Note: does not fire `removed` event\n   */\n  clear() {\n    this.store.clear();\n  }\n\n  /**\n   * Updates the lastSet/lastGet time for a value\n   * under `k`.\n   *\n   * Returns false if key was not found\n   * @param key\n   * @returns\n   */\n  touch(key: K): boolean {\n    const v = this.store.get(key);\n    if (!v) return false;\n    this.store.set(key, {\n      ...v,\n      lastSet: Date.now(),\n      lastGet: Date.now(),\n    });\n    return true;\n  }\n\n  private findEvicteeKey(): K | undefined {\n    if (this.evictPolicy === `none`) return;\n    //eslint-disable-next-line functional/no-let\n    let sortBy = ``;\n    if (this.evictPolicy === `oldestGet`) sortBy = `lastGet`;\n    else if (this.evictPolicy === `oldestSet`) sortBy = `lastSet`;\n    // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n    else throw new Error(`Unknown eviction policy ${ this.evictPolicy }`);\n    const sorted = sortByValueProperty(this.store, sortBy);\n    return sorted[ 0 ][ 0 ];\n  }\n\n  #maintain() {\n    if (this.autoDeletePolicy === `none`) return;\n    this.deleteWithElapsed(this.autoDeleteElapsedMs, this.autoDeletePolicy);\n  }\n\n  /**\n   * Deletes all values where elapsed time has past\n   * for get/set or either.\n   * ```js\n   * // Delete all keys (and associated values) not accessed for a minute\n   * em.deleteWithElapsed({mins:1}, `get`);\n   * // Delete things that were set 1s ago\n   * em.deleteWithElapsed(1000, `set`);\n   * ```\n   * \n   * @param interval Interval\n   * @param property Basis for deletion 'get','set' or 'either'\n   * @returns Items removed\n   */\n  deleteWithElapsed(\n    interval: Interval,\n    property: `get` | `set` | `either`\n  ): Array<[ k: K, v: V ]> {\n    const entries = [ ...this.store.entries() ];\n    const prune: Array<[ k: K, v: V ]> = [];\n    const intervalMs = intervalToMs(interval, 1000);\n    const now = Date.now();\n    for (const entry of entries) {\n      const elapsedGet = now - entry[ 1 ].lastGet;\n      const elapsedSet = now - entry[ 1 ].lastSet;\n      const elapsed =\n        property === `get`\n          ? elapsedGet\n          : (property === `set`\n            ? elapsedSet\n            : Math.max(elapsedGet, elapsedSet));\n      if (elapsed >= intervalMs) {\n        prune.push([ entry[ 0 ], entry[ 1 ].value ]);\n      }\n    }\n\n    for (const entry of prune) {\n      this.store.delete(entry[ 0 ]);\n      //this.keyCount = this.keyCount - 1;\n      const eventArguments = {\n        key: entry[ 0 ],\n        value: entry[ 1 ],\n      };\n      this.fireEvent(`expired`, eventArguments);\n      this.fireEvent(`removed`, eventArguments);\n    }\n    return prune;\n  }\n\n  /**\n   * Sets the `key` to be `value`.\n   *\n   * If the key already exists, it is updated.\n   *\n   * If the map is full, according to its capacity,\n   * another value is selected for removal.\n   * @param key\n   * @param value\n   * @returns\n   */\n  set(key: K, value: V) {\n    const existing = this.store.get(key);\n\n    if (existing) {\n      // Update set time\n      this.store.set(key, {\n        ...existing,\n        lastSet: performance.now(),\n      });\n      return;\n    }\n\n    // New key\n    if (this.keyLength === this.capacity && this.capacity > 0) {\n      // Evict first\n      const key = this.findEvicteeKey();\n      if (!key) {\n        throw new Error(`ExpiringMap full (capacity: ${ this.capacity })`);\n      }\n      const existing = this.store.get(key);\n      this.store.delete(key);\n      //this.keyCount = this.keyCount - 1;\n      if (existing) {\n        const eventArguments = { key, value: existing.value };\n        this.fireEvent(`expired`, eventArguments);\n        this.fireEvent(`removed`, eventArguments);\n      }\n    }\n\n    //this.keyCount++;\n    this.store.set(key, {\n      lastGet: 0,\n      lastSet: Date.now(),\n      value: value,\n    });\n\n    this.fireEvent(`newKey`, { key, value });\n  }\n}\n","import { type EitherKey } from '../Types.js';\nimport type { IMapBase } from './IMapBase.js';\nimport { add, del, set, has } from './MapImmutableFns.js';\n\n/**\n * A mutable map.\n *\n * It is a wrapper around the in-built Map type, but adds roughly the same API as {@link IMapImmutable}.\n *\n * @typeParam K - Type of map keys. Typically `string`\n * @typeParam V - Type of stored values\n */\n//eslint-disable-next-line @typescript-eslint/consistent-type-definitions\nexport interface IMapMutable<K, V> extends IMapBase<K, V> {\n  /**\n   * Adds one or more items to map\n   *\n   * Can add items in the form of [key,value] or `{key, value}`.\n   * @example These all produce the same result\n   * ```js\n   * map.set(`hello`, `samantha`);\n   * map.add([`hello`, `samantha`]);\n   * map.add({key: `hello`, value: `samantha`})\n   * ```\n   * @param itemsToAdd\n   * @param itemsToAdd\n   */\n  add(...itemsToAdd: EitherKey<K, V>): void;\n  /**\n   * Sets a value to a specified key\n   * @param key\n   * @param value\n   */\n  set(key: K, value: V): void;\n  /**\n   * Deletes an item by key\n   * @param key\n   */\n  delete(key: K): void;\n  /**\n   * Clears map\n   */\n  clear(): void;\n}\n\n/**\n * Returns a {@link IMapMutable} (which just wraps the in-built Map)\n * Use {@link Maps.immutable} for the immutable alternative.\n *\n * @example Basic usage\n * ```js\n * const m = mapMutable();\n * // Add one or more entries\n * m.add([\"name\", \"sally\"]);\n * // Alternatively:\n * m.set(\"name\", \"sally\");\n * // Recall\n * m.get(\"name\");           // \"sally\"\n * m.delete(\"name\");\n * m.isEmpty; // True\n * m.clear();\n * ```\n * @param data Optional initial data in the form of an array of `{ key: value }` or `[ key, value ]`\n */\nexport const mutable = <K, V>(...data: EitherKey<K, V>): IMapMutable<K, V> => {\n  // eslint-disable-next-line functional/no-let\n  let m = add(new Map<K, V>(), ...data);\n  return {\n    add: (...data: EitherKey<K, V>) => {\n      m = add(m, ...data);\n    },\n    delete: (key: K) => {\n      m = del(m, key);\n    },\n    clear: () => {\n      m = add(new Map<K, V>());\n    },\n    set: (key: K, value: V): void => {\n      m = set(m, key, value);\n    },\n    get: (key: K): V | undefined => m.get(key),\n    entries: () => m.entries(),\n    values: () => m.values(),\n    isEmpty: () => m.size === 0,\n    has: (key: K) => has(m, key),\n  };\n};\n","import {\n  type IsEqual,\n  isEqualDefault\n} from '../../util/IsEqual.js';\nimport type {\n  MapArrayEvents,\n  IMapOfMutableExtended,\n} from './IMapOfMutableExtended.js';\nimport type { MapMultiOpts, MultiValue } from './MapMulti.js';\nimport { SimpleEventEmitter } from '../../Events.js';\nimport type { IMapOf } from './IMapOf.js';\nimport { toStringDefault, type ToString } from '../../util/index.js';\n\n/**\n * @internal\n */\nexport class MapOfMutableImpl<V, M>\n  extends SimpleEventEmitter<MapArrayEvents<V>>\n  implements IMapOfMutableExtended<V, M> {\n  /* eslint-disable-next-line functional/prefer-readonly-type */\n  readonly #map = new Map<string, M>();\n  readonly groupBy: ToString<V>;\n  readonly type: MultiValue<V, M>;\n\n  constructor(type: MultiValue<V, M>, opts: MapMultiOpts<V> = {}) {\n    super();\n    this.type = type;\n    this.groupBy = opts.groupBy ?? toStringDefault;\n  }\n\n  /**\n   * Returns the type name. For in-built implementations, it will be one of: array, set or circular\n   */\n  get typeName() {\n    return this.type.name;\n  }\n\n  /**\n   * Returns the number of keys\n   */\n  get lengthKeys(): number {\n    return this.#map.size;\n  }\n\n  /**\n   * Returns the length of the longest child list\n   */\n  get lengthMax() {\n    //eslint-disable-next-line functional/no-let\n    let m = 0;\n    for (const v of this.#map.values()) {\n      m = Math.max(m, this.type.count(v));\n    }\n    return m;\n  }\n\n  debugString(): string {\n    const keys = [ ...this.#map.keys() ];\n    // eslint-disable-next-line functional/no-let\n    let r = `Keys: ${ keys.join(`, `) }\\r\\n`;\n    for (const k of keys) {\n      const v = this.#map.get(k);\n      if (v === undefined) {\n        r += ` - ${ k } (undefined)\\r\\n`\n      } else {\n        const asArray = this.type.toArray(v);\n        if (asArray !== undefined) {\n          r += ` - ${ k } (${ this.type.count(v) }) = ${ JSON.stringify(\n            asArray\n          ) }\\r\\n`;\n        }\n      }\n    };\n    return r;\n  }\n\n  get isEmpty(): boolean {\n    return this.#map.size === 0;\n  }\n\n  clear() {\n    this.#map.clear();\n    super.fireEvent(`clear`, true);\n  }\n\n  //eslint-disable-next-line functional/prefer-immutable-types\n  addKeyedValues(key: string, ...values: Array<V>) {\n    const set = this.#map.get(key);\n    if (set === undefined) {\n      this.#map.set(key, this.type.add(undefined, values));\n      super.fireEvent(`addedKey`, { key: key });\n      super.fireEvent(`addedValues`, { values: values });\n    } else {\n      // eslint-disable-next-line functional/immutable-data\n      this.#map.set(key, this.type.add(set, values));\n      super.fireEvent(`addedValues`, { values: values });\n    }\n  }\n  //eslint-disable-next-line functional/prefer-immutable-types\n  set(key: string, values: Array<V>) {\n    this.addKeyedValues(key, ...values);\n    return this;\n  }\n\n  addValue(...values: ReadonlyArray<V>) {\n    for (const v of values) this.addKeyedValues(this.groupBy(v), v);\n  }\n\n  hasKeyValue(key: string, value: V, eq: IsEqual<V>): boolean {\n    const m = this.#map.get(key);\n    if (m === undefined) return false;\n    return this.type.has(m, value, eq);\n  }\n\n  //eslint-disable-next-line functional/prefer-tacit\n  has(key: string): boolean {\n    return this.#map.has(key);\n  }\n\n  deleteKeyValue(key: string, value: V): boolean {\n    const a = this.#map.get(key);\n    if (a === undefined) return false;\n    return this.deleteKeyValueFromMap(a, key, value);\n  }\n\n  private deleteKeyValueFromMap(map: M, key: string, value: V): boolean {\n    const preCount = this.type.count(map);\n    const filtered = this.type.without(map, value);\n    const postCount = filtered.length;\n    this.#map.set(key, this.type.add(undefined, filtered));\n    return preCount > postCount;\n  }\n\n  deleteByValue(value: V): boolean {\n    //eslint-disable-next-line functional/no-let\n    let something = false;\n    [ ...this.#map.keys() ].filter((key) => {\n      const a = this.#map.get(key);\n      if (!a) throw new Error(`Bug: map could not be accessed`);\n      if (this.deleteKeyValueFromMap(a, key, value)) {\n        something = true; // note that something was deleted\n\n        // If key is empty, delete it\n        if (this.count(key) === 0) this.delete(key);\n      }\n    });\n    return something;\n  }\n\n  delete(key: string): boolean {\n    const a = this.#map.get(key);\n    if (a === undefined) return false;\n    this.#map.delete(key);\n    this.fireEvent(`deleteKey`, { key: key });\n    return true;\n  }\n\n  firstKeyByValue(\n    value: V,\n    eq: IsEqual<V> = isEqualDefault\n  ): string | undefined {\n    const keys = [ ...this.#map.keys() ];\n    const found = keys.find((key) => {\n      const a = this.#map.get(key);\n      if (a === undefined) throw new Error(`Bug: map could not be accessed`);\n      const r = this.type.has(a, value, eq);\n      return r;\n    });\n    return found;\n  }\n\n  count(key: string): number {\n    const entry = this.#map.get(key);\n    if (entry === undefined) return 0;\n    return this.type.count(entry);\n  }\n\n  /**\n   * Iterates over values stored under `key`\n   * An empty array is returned if there are no values\n   */\n  *get(key: string): IterableIterator<V> {\n    const m = this.#map.get(key);\n    if (m === undefined) return;\n    yield* this.type.iterable(m);\n  }\n\n  /**\n   * Iterate over the values stored under `key`.\n   * If key does not exist, iteration is essentially a no-op\n   * @param key\n   * @returns\n   */\n  *valuesFor(key: string) {\n    const m = this.#map.get(key);\n    if (m === undefined) return;\n    yield* this.type.iterable(m);\n  }\n\n  //eslint-disable-next-line functional/prefer-tacit\n  getSource(key: string): M | undefined {\n    return this.#map.get(key);\n  }\n\n  /* eslint-disable-next-line functional/prefer-readonly-type */\n  *keys(): IterableIterator<string> {\n    yield* this.#map.keys();\n    //return Array.from(this.#map.keys());\n  }\n\n  *entriesFlat(): IterableIterator<[ key: string, value: V ]> {\n    for (const entry of this.#map.entries()) {\n      for (const v of this.type.iterable(entry[ 1 ])) {\n        yield [ entry[ 0 ], v ];\n      }\n    }\n  }\n\n  *valuesFlat(): IterableIterator<V> {\n    for (const entry of this.#map.entries()) {\n      yield* this.type.iterable(entry[ 1 ]);\n    }\n  }\n\n  *entries(): IterableIterator<[ key: string, value: Array<V> ]> {\n    for (const [ k, v ] of this.#map.entries()) {\n      const temporary = [ ...this.type.iterable(v) ];\n      yield [ k, temporary ];\n    }\n  }\n\n  /* eslint-disable-next-line functional/prefer-readonly-type */\n  *keysAndCounts(): IterableIterator<[ string, number ]> {\n    for (const key of this.keys()) {\n      yield [ key, this.count(key) ];\n    }\n  }\n\n  merge(other: IMapOf<V>) {\n    for (const key of other.keys()) {\n      const data = other.get(key);\n      this.addKeyedValues(key, ...data);\n    }\n  }\n\n  get size() {\n    return this.#map.size;\n  }\n\n\n  get [ Symbol.toStringTag ]() {\n    return this.#map[ Symbol.toStringTag ];\n  }\n}\n","import { toStringDefault } from '../../util/index.js';\nimport { without } from '../../data/arrays/Filter.js';\nimport type { MapSetOpts, MultiValue } from './MapMulti.js';\nimport { MapOfMutableImpl } from './MapOfMultiImpl.js';\nimport {\n  hasAnyValue as mapHasAnyValue,\n  toArray as mapToArray,\n  find as mapFind,\n  filter as mapFilter,\n  addKeepingExisting,\n} from '../../data/maps/MapFns.js';\nimport type { IMapOfMutableExtended } from './IMapOfMutableExtended.js';\n\n/**\n * Returns a {@link IMapOfMutableExtended} that uses a set to hold values.\n * This means that only unique values are stored under each key. By default it\n * uses the JSON representation to compare items.\n *\n * Options: `{ hash: toStringFn } }`\n *\n * `hash` is a {@link Util.ToString} function: `(object) => string`. By default it uses\n * `JSON.stringify`.\n *\n * @example Only storing the newest three items per key\n * ```js\n * const map = mapOfSetMutable();\n * map.add(`hello`, [1, 2, 3, 1, 2, 3]);\n * const hello = map.get(`hello`); // [1, 2, 3]\n * ```\n *\n * @example\n * ```js\n * const hash = (v) => v.name; // Use name as the key\n * const map = mapOfSetMutable(hash);\n * map.add(`hello`, {age:40, name: `Mary`});\n * map.add(`hello`, {age:29, name: `Mary`}); // Value ignored as same name exists\n * ```\n * @param options\n * @returns\n */\nexport const ofSetMutable = <V>(\n  options?: MapSetOpts<V>\n): IMapOfMutableExtended<V, ReadonlyMap<string, V>> => {\n  const hash = options?.hash ?? toStringDefault;\n  const comparer = (a: V, b: V) => hash(a) === hash(b);\n\n  const t: MultiValue<V, ReadonlyMap<string, V>> = {\n    get name() {\n      return `set`;\n    },\n    iterable: (source) => source.values(),\n    add: (dest, values) => addKeepingExisting(dest, hash, ...values),\n    count: (source) => source.size,\n    find: (source, predicate) => mapFind(source, predicate),\n    filter: (source, predicate) => mapFilter(source, predicate),\n    toArray: (source) => mapToArray(source),\n    has: (source, value) => mapHasAnyValue(source, value, comparer),\n    without: (source, value) => without(mapToArray(source), value, comparer),\n  };\n  const m = new MapOfMutableImpl<V, ReadonlyMap<string, V>>(t, options);\n  return m;\n};\n","import { throwIntegerTest } from \"../util/GuardNumbers.js\";\n\n/**\n * The circular array is immutable. It keeps up to `capacity` items.\n * Old items are overridden with new items.\n *\n * `CircularArray` extends the regular JS array. Only use `add` to change the array if you want\n * to keep the `CircularArray` behaviour.\n * @example\n * ```js\n * let a = circularArray(10);\n * a = a.add(`hello`); // Because it's immutable, capture the return result of `add`\n * a.isFull;  // True if circular array is full\n * a.pointer; // The current position in array it will write to\n * ```\n * @class CircularArray\n */\n\n\n// eslint-disable-next-line @typescript-eslint/consistent-type-definitions\nexport interface ICircularArray<V> extends Array<V> {\n  /**\n   * Returns true if the array has filled to capacity and is now\n   * recycling array indexes.\n   */\n  get isFull(): boolean;\n\n  /**\n   * Returns a new Circular with item added\n   *\n   * Items are added at `pointer` position, which automatically cycles through available array indexes.\n   *\n   * @param value Thing to add\n   * @returns Circular with item added\n   */\n  add(value: V): ICircularArray<V>;\n\n  get length(): number;\n\n  /**\n   * Returns the current add position of array.\n   */\n  get pointer(): number;\n}\n\nclass CircularArray<V> extends Array {\n  // ✔ Class is unit tested!\n  /* eslint-disable-next-line functional/prefer-readonly-type */\n  #capacity: number;\n  /* eslint-disable-next-line functional/prefer-readonly-type */\n  #pointer: number;\n\n  constructor(capacity = 0) {\n    super();\n    // Allowed to create with capacity zero\n    throwIntegerTest(capacity, `positive`, `capacity`);\n\n    // Can't throw because .filter won't use ctor proprly\n    this.#capacity = capacity;\n    this.#pointer = 0;\n  }\n\n  /**\n   * Add to array\n   * @param value Thing to add\n   * @returns \n   */\n  add(value: V): CircularArray<V> {\n    const ca = CircularArray.from(this) as CircularArray<V>;\n    /* eslint-disable-next-line functional/immutable-data */\n    ca[ this.#pointer ] = value;\n    /* eslint-disable-next-line functional/immutable-data */\n    ca.#capacity = this.#capacity;\n    if (this.#capacity > 0) {\n      /* eslint-disable-next-line functional/immutable-data */\n      ca.#pointer =\n        this.#pointer + 1 === this.#capacity ? 0 : this.#pointer + 1;\n    } else {\n      /* eslint-disable-next-line functional/immutable-data */\n      ca.#pointer = this.#pointer + 1;\n    }\n    return ca;\n  }\n\n  get pointer(): number {\n    return this.#pointer;\n  }\n\n  get isFull(): boolean {\n    if (this.#capacity === 0) return false;\n    return this.length === this.#capacity;\n  }\n}\n\n/**\n * Returns a new circular array. Immutable. A circular array only keeps up to `capacity` items.\n * Old items are overridden with new items.\n *\n * `CircularArray` extends the regular JS array. Only use `add` to change the array if you want\n * to keep the `CircularArray` behaviour.\n *\n * @example Basic functions\n * ```js\n * let a = circularArray(10);\n * a = a.add(`hello`);  // Because it's immutable, capture the return result of `add`\n * a.isFull;            // True if circular array is full\n * a.pointer;           // The current position in array it will write to\n * ```\n *\n * Since it extends the regular JS array, you can access items as usual:\n * @example Accessing\n * ```js\n * let a = circularArray(10);\n * ... add some stuff ..\n * a.forEach(item => // do something with item);\n * ```\n * @param capacity Maximum capacity before recycling array entries\n * @return Circular array\n */\nexport const circularArray = <V>(capacity: number): ICircularArray<V> =>\n  new CircularArray<V>(capacity);\n","import { isEqualDefault } from '../../util/IsEqual.js';\nimport { type ICircularArray, circularArray } from '../CircularArray.js';\nimport type { MapMultiOpts, MultiValue } from './MapMulti.js';\nimport { MapOfMutableImpl } from './MapOfMultiImpl.js';\nimport type { IMapOfMutableExtended } from './IMapOfMutableExtended.js';\n\nexport type MapCircularOpts<V> = MapMultiOpts<V> & {\n  readonly capacity: number;\n};\n\n/**\n * Returns a {@link IMapOfMutableExtended} that uses a {@link ICircularArray} to hold values. Mutable.\n * This means that the number of values stored under each key will be limited to the defined\n * capacity.\n *\n * Required option:\n * * `capacity`: how many items to hold\n *\n * @example Only store the most recent three items per key\n * ```js\n * const map = ofCircularMutable({capacity: 3});\n * map.add(`hello`, [1, 2, 3, 4, 5]);\n * const hello = map.get(`hello`); // [3, 4, 5]\n * ```\n *\n *\n * @param options\n * @returns\n */\nexport const ofCircularMutable = <V>(\n  options: MapCircularOpts<V>\n): IMapOfMutableExtended<V, ICircularArray<V>> => {\n  const comparer = isEqualDefault;\n\n  const t: MultiValue<V, ICircularArray<V>> = {\n    get name() {\n      return `circular`;\n    },\n    add: (destination, values) => {\n      if (destination === undefined) destination = circularArray<V>(options.capacity);\n      for (const v of values) {\n        //values.forEach(v => dest = dest?.add(v));\n        destination = destination.add(v);\n      }\n      return destination;\n    },\n    count: (source) => source.length,\n    find: (source, predicate) => source.find(predicate),\n    filter: (source, predicate) => source.filter(predicate),\n    toArray: (source) => source,\n    iterable: (source) => source.values(),\n    has: (source, value) =>\n      source.find((v) => comparer(v, value)) !== undefined,\n    without: (source, value) => source.filter((v) => !comparer(v, value)),\n  };\n  return new MapOfMutableImpl<V, ICircularArray<V>>(t, options);\n};\n","import type { ToString } from '../../util/index.js';\nimport { type IsEqual, isEqualDefault } from '../../util/IsEqual.js';\nimport { type IMapOfMutableExtended } from './IMapOfMutableExtended.js';\nimport { type MapMultiOpts, type MultiValue } from './MapMulti.js';\nimport { MapOfMutableImpl } from './MapOfMultiImpl.js';\n\n/**\n * Map of array options\n */\nexport type MapArrayOpts<V> = MapMultiOpts<V> & {\n  /**\n   * Comparer to use\n   */\n  readonly comparer?: IsEqual<V>;\n  /**\n   * Key function\n   */\n  readonly convertToString?: ToString<V>;\n};\n\n/**\n * Returns a {@link IMapOfMutableExtended} to allow storing multiple values under a key, unlike a regular Map.\n * @example\n * ```js\n * const map = ofArrayMutable();\n * map.addKeyedValues(`hello`, [1,2,3,4]); // Adds series of numbers under key `hello`\n *\n * const hello = map.get(`hello`); // Get back values\n * ```\n *\n * Takes options:\n * * `comparer`: {@link IsEqual}\n * * `toString`: {@link Util.ToString}\n *\n * A custom {@link Util.ToString} function can be provided as the `convertToString` opion. This is then used when checking value equality (`has`, `without`)\n * ```js\n * const map = ofArrayMutable({ convertToString:(v) => v.name}); // Compare values based on their `name` field;\n * ```\n *\n * Alternatively, a {@link IsEqual} function can be used:\n * ```js\n * const map = ofArrayMutable({comparer: (a, b) => a.name === b.name });\n * ```\n * @param options Optiosn for mutable array\n * @typeParam V - Data type of items\n * @returns {@link IMapOfMutableExtended}\n */\nexport const ofArrayMutable = <V>(\n  options: MapArrayOpts<V> = {}\n): IMapOfMutableExtended<V, ReadonlyArray<V>> => {\n  // const toStringFunction = opts.toString === undefined ?  \n  // const comparer =\n  //   opts.comparer === undefined\n  //     ? (opts.toString === undefined\n  //       ? (a: V, b: V) => opts.toString(a) === opts.toString(b)\n  //       : isEqualDefault)\n  //     : opts.comparer;\n  // const convertToStringComparer = opts.convertToString === undefined ? undefined : (a: V, b: V) => {\n  //   const r = opts.convertToString(a) === opts.convertToString(b)\n  //   console.log(`ofArrayMutable toString comparer: r: ${ r } a: ${ a } b: ${ b }`);\n  //   console.log(`ofArrayMutable toString comparer: a: ${ opts.toString(a) } b: ${ opts.toString(b) }`);\n  //   return r;\n  // };\n\n  const convertToString = options.convertToString;\n  const toStringFunction: IsEqual<V> = typeof convertToString === `undefined` ? isEqualDefault : (a: V, b: V) => convertToString(a) === convertToString(b)\n\n  const comparer = options.comparer ?? toStringFunction;\n\n  const t: MultiValue<V, ReadonlyArray<V>> = {\n    get name() {\n      return `array`;\n    },\n    add: (destination, values) => {\n      if (destination === undefined) return [ ...values ];\n      return [ ...destination, ...values ];\n    },\n    iterable: (source) => source.values(),\n    count: (source) => source.length,\n    find: (source, predicate) => source.find(f => predicate(f)),\n    filter: (source, predicate) => source.filter(f => predicate(f)),\n    toArray: (source) => source,\n    has: (source, value) => source.some((v) => comparer(v, value)),\n    without: (source, value) => source.filter((v) => !comparer(v, value)),\n    //[Symbol.iterator]: (source) => source[Symbol.iterator]()\n  };\n  const m = new MapOfMutableImpl<V, ReadonlyArray<V>>(t, options);\n  return m;\n};\n","export type WithEvents = {\n  addEventListener(type: string, callbackfn: any): void;\n  removeEventListener(type: string, callbackfn: any): void;\n}\n\nexport const isAsyncIterable = (v: any): v is AsyncIterable<any> =>\n  Symbol.asyncIterator in new Object(v);\n\nexport const isIterable = (v: any): v is Iterable<any> =>\n  Symbol.iterator in new Object(v);\n\nexport const fromEvent = <V>(\n  eventSource: WithEvents,\n  eventType: string\n): AsyncIterator<any> => {\n  const pullQueue: Array<any> = [];\n  const pushQueue: Array<any> = [];\n  let done = false;\n  const pushValue = (args: any) => {\n    if (pullQueue.length > 0) {\n      //eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n      const resolver = pullQueue.shift();\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-call\n      resolver(...args);\n    } else {\n      pushQueue.push(args);\n    }\n  };\n\n  const pullValue = (): Promise<V> =>\n    new Promise<V>((resolve) => {\n      if (pushQueue.length > 0) {\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n        const arguments_ = pushQueue.shift();\n        // @ts-expect-error\n        resolve(...arguments_);\n      } else {\n        pullQueue.push(resolve);\n      }\n    });\n\n  const handler = (...arguments_: any) => {\n    pushValue(arguments_);\n  };\n\n  eventSource.addEventListener(eventType, handler);\n\n  const r: AsyncIterator<V> = {\n    next: async (): Promise<IteratorResult<V>> => {\n      if (done) return { done: true, value: undefined };\n      return {\n        done: false,\n        value: await pullValue(),\n      };\n    },\n    //eslint-disable-next-line @typescript-eslint/require-await\n    return: async (): Promise<IteratorResult<V>> => {\n      done = true;\n      eventSource.removeEventListener(eventType, handler);\n      return { done: true, value: undefined };\n    },\n    //eslint-disable-next-line @typescript-eslint/require-await\n    throw: async (error: any): Promise<IteratorResult<V>> => {\n      done = true;\n      return {\n        done: true,\n        value: Promise.reject(new Error(error)),\n      };\n    },\n  };\n  return r;\n};","export const getErrorMessage = (ex: unknown): string => {\n  if (typeof ex === `string`) return ex;\n  if (ex instanceof Error) {\n    return ex.message;\n  }\n  return ex as string;\n};","import { isIterable } from \"../iterables/Iterable.js\";\nimport type { Passed, PassedSignal, PassedValue, Reactive, ReactiveDiff, ReactiveInitial, ReactiveOrSource, ReactivePingable, ReactiveWritable, Wrapped } from \"./Types.js\";\nimport type { Trigger, TriggerValue, TriggerFunction, TriggerGenerator } from \"./sources/Types.js\";\n\nexport function messageIsSignal<V>(message: Passed<V> | PassedSignal): message is PassedSignal {\n  if (message.value !== undefined) return false;\n  if (`signal` in message && message.signal !== undefined) return true;\n  return false;\n}\n\nexport function messageIsDoneSignal<V>(message: Passed<V> | PassedSignal): boolean {\n  if (message.value !== undefined) return false;\n  if (`signal` in message && message.signal === `done`) return true;\n  return false;\n}\n\n/**\n * Returns _true_ if `v` has a non-undefined value. Note that sometimes\n * _undefined_ is a legal value to pass\n * @param v \n * @returns \n */\nexport function messageHasValue<V>(v: Passed<V> | PassedSignal): v is PassedValue<V> {\n  if (v.value !== undefined) return true;\n  return false;\n}\n\nexport const isPingable = <V>(rx: Reactive<V> | ReactiveDiff<V> | object): rx is ReactivePingable<V> => {\n  if (!isReactive(rx)) return false;\n  if (`ping` in rx) {\n    return true;\n  }\n  return false;\n}\n\nexport const hasLast = <V>(rx: Reactive<V> | ReactiveDiff<V> | object): rx is ReactiveInitial<V> => {\n  if (!isReactive(rx)) return false;\n  if (`last` in rx) {\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-call\n    const v = (rx as any).last();\n    if (v !== undefined) return true;\n  }\n  return false;\n}\n\n/**\n * Returns _true_ if `rx` is a Reactive\n * @param rx \n * @returns \n */\nexport const isReactive = <V>(rx: object): rx is Reactive<V> => {\n  if (typeof rx !== `object`) return false;\n  if (rx === null) return false;\n  return (`on` in rx && `onValue` in rx)\n}\n\n/**\n * Returns true if `rx` is a disposable reactive.\n * @param rx \n * @returns \n */\n// export const isDisposable = <V>(rx: Reactive<V> | ReactiveWritable<V>): rx is ReactiveDisposable<V> => {\n//   if (!isReactive(rx)) return false;\n//   return (`isDisposed` in rx && `dispose` in rx);\n// }\n\n/**\n * Returns _true_ if `rx` is a writable Reactive\n * @param rx \n * @returns \n */\nexport const isWritable = <V>(rx: Reactive<V> | ReactiveWritable<V>): rx is ReactiveWritable<V> => {\n  if (!isReactive(rx)) return false;\n  if (`set` in rx) return true;\n  return false;\n}\n\nexport const isWrapped = <T>(v: any): v is Wrapped<T> => {\n  if (typeof v !== `object`) return false;\n  if (!(`source` in v)) return false;\n  if (!(`annotateElapsed` in v)) return false;\n  return true;\n}\n\n// export const opify = <TIn, TOut = TIn,>(fn: (source: ReactiveOrSource<TIn>, ...args: Array<any>) => Reactive<TOut>, ...args: Array<any>) => {\n//   return (source: ReactiveOrSource<TIn>) => {\n//     return fn(source, ...args);\n//   }\n// }\n\nexport const opify = <TIn, TRxOut = Reactive<TIn>>(fn: (source: ReactiveOrSource<TIn>, ...args: Array<any>) => TRxOut, ...args: Array<any>) => {\n  return (source: ReactiveOrSource<TIn>) => {\n    return fn(source, ...args);\n  }\n}\n\n\nexport const isTriggerValue = <V>(t: Trigger<V>): t is TriggerValue<V> => (`value` in t);\nexport const isTriggerFunction = <V>(t: Trigger<V>): t is TriggerFunction<V> => (`fn` in t);\nexport const isTriggerGenerator = <V>(t: Trigger<V>): t is TriggerGenerator<V> => isIterable(t);\nexport const isTrigger = <V>(t: any): t is Trigger<V> => {\n  if (typeof t !== `object`) return false;\n  if (isTriggerValue(t)) return true;\n  if (isTriggerFunction(t)) return true;\n  if (isTriggerGenerator(t)) return true;\n  return false;\n}\n\nexport type ResolveTriggerValue<V> = [ value: V, false ];\nexport type ResolveTriggerDone = [ undefined, true ];\n\n/**\n * Resolves a trigger value.\n * \n * A trigger can be a value, a function or generator. Value triggers never complete.\n * A trigger function is considered complete if it returns undefined.\n * A trigger generator is considered complete if it returns done.\n * \n * Returns `[value, _false_]` if we have a value and trigger is not completed.\n * Returns `[value, _true_]` trigger is completed\n * @param t \n * @returns \n */\nexport function resolveTriggerValue<V>(t: Trigger<V>): ResolveTriggerDone | ResolveTriggerValue<V> {\n  if (isTriggerValue(t)) return [ t.value, false ];\n  if (isTriggerFunction(t)) {\n    const v = t.fn();\n    if (v === undefined) return [ undefined, true ];\n    return [ v, false ];\n  }\n  if (isTriggerGenerator(t)) {\n    const v = t.gen.next();\n    if (v.done) return [ undefined, true ];\n    return [ v.value, false ];\n  }\n  throw new Error(`Invalid trigger. Missing 'value' or 'fn' fields`);\n}","import { throwNumberTest } from '../util/GuardNumbers.js';\nimport { type Interval, intervalToMs } from './IntervalType.js';\n\nexport type SleepOpts<V> = Interval & Partial<{\n  readonly signal: AbortSignal;\n  readonly value: V;\n}>;\n\nif (typeof window === `undefined` || !(`requestAnimationFrame` in window)) {\n  // eslint-disable-next-line unicorn/no-lonely-if\n  if (typeof window === `undefined`) {\n    // @ts-expect-error\n    globalThis.requestAnimationFrame = (callback) => {\n      setTimeout(callback, 1);\n    }\n  }\n}\n\n/**\n * Returns after timeout period.\n *\n * @example In an async function\n * ```js\n * console.log(`Hello`);\n * await sleep(1000);\n * console.log(`There`); // Prints one second after\n * ```\n *\n * @example As a promise\n * ```js\n * console.log(`Hello`);\n * sleep({ millis: 1000 })\n *  .then(() => console.log(`There`)); // Prints one second after\n * ```\n *\n * If a timeout of 0 is given, `requestAnimationFrame` is used instead of `setTimeout`.\n *\n * {@link delay} and {@link sleep} are similar. `delay()` takes a parameter of what code to execute after the timeout, while `sleep()` just resolves after the timeout.\n *\n * A value can be provided, which is returned on awaking:\n * ```js\n * const v = await sleep({ seconds: 1, value: `hello`);\n * // v = `hello`\n * ```\n *\n * Provide an AbortSignal to cancel the sleep and throwing an exception\n * so code after the sleep doesn't happen.\n *\n * ```js\n * const ac = new AbortController();\n * setTimeout(() => { ac.abort(); }, 1000); // Abort after 1s\n *\n * // Sleep for 1min\n * await sleep({ minutes: 1, signal: ac.signal });\n * console.log(`Awake`); // This line doesn't get called because an exception is thrown when aborting\n * ```\n * @param optsOrMillis Milliseconds to sleep, or options\n * @return\n */\nexport const sleep = <V>(\n  optsOrMillis: SleepOpts<V>\n): Promise<V | undefined> => {\n  const timeoutMs = intervalToMs(optsOrMillis, 1);\n  const signal = optsOrMillis.signal;\n  const value = optsOrMillis.value;\n  throwNumberTest(timeoutMs, `positive`, `timeoutMs`);\n\n  // eslint-disable-next-line unicorn/prefer-ternary\n  if (timeoutMs === 0) {\n    return new Promise<V | undefined>((resolve) =>\n      requestAnimationFrame((_) => {\n        resolve(value);\n      })\n    );\n  } else {\n    return new Promise<V | undefined>((resolve, reject) => {\n      const onAbortSignal = () => {\n        clearTimeout(t);\n        if (signal) {\n          signal.removeEventListener(`abort`, onAbortSignal);\n          reject(new Error(signal.reason));\n        } else {\n          reject(new Error(`Cancelled`));\n        }\n      }\n\n      if (signal) {\n        signal.addEventListener(`abort`, onAbortSignal);\n      }\n      const t = setTimeout(() => {\n        signal?.removeEventListener(`abort`, onAbortSignal);\n        if (signal?.aborted) {\n          reject(new Error(signal.reason));\n          return;\n        }\n        resolve(value);\n      }, timeoutMs);\n    });\n  }\n};\n\n/**\n * Delays until `predicate` returns true.\n * Can be useful for synchronising with other async activities.\n * ```js\n * // Delay until 'count' reaches 5\n * await sleepWhile(() => count >= 5, 100);\n * ```\n * @param predicate \n * @param checkInterval \n */\nexport const sleepWhile = async (predicate: () => boolean, checkInterval: Interval = 100) => {\n  while (predicate()) {\n    await sleep(checkInterval);\n  }\n}","import { hasLast, isReactive } from \"../rx/Util.js\";\nimport type { ReactiveNonInitial } from \"../rx/Types.js\";\nimport type { ValueType } from \"./Types.js\";\nimport { getErrorMessage } from \"../debug/GetErrorMessage.js\";\n\n/**\n * Something that can resolve to a value\n */\nexport type ResolveToValueSync<V> = ValueType | ReactiveNonInitial<V> | Generator<V> | IterableIterator<V> | ((args: any) => V)\nexport type ResolveToValueAsync<V> = AsyncGenerator<V> | AsyncIterableIterator<V> | Promise<V> | ((args: any) => Promise<V>);\nexport type ResolveToValue<V> = ResolveToValueAsync<V> | ResolveToValueSync<V>;\n\n/**\n * Resolves `r` to a value, where `r` is:\n * * primitive value\n * * a/sync function\n * * a/sync generator/iterator\n * * ReactiveNonInitial\n * ```js\n * await resolve(10);       // 10\n * await resolve(() => 10); // 10\n * await resole(async () => {\n *  sleep(100);\n *  return 10;\n * });                // 10\n * ```\n * \n * To resolve an object's properties, use {@link resolveFields}.\n * \n * Resolve is not recursive. So if `r` is an object, it will be returned, even\n * though its properties may be resolvable.\n * @param r \n * @param args \n * @returns \n */\nexport async function resolve<V extends ValueType>(r: ResolveToValue<V>, ...args: any): Promise<V> {\n  if (typeof r === `object`) {\n    if (`next` in r) {\n      const tag = (r as any)[ Symbol.toStringTag ];\n      //console.log(tag);\n      if (tag === `Generator` || tag == `Array Iterator`) {\n        const v = r.next();\n        if (`done` in v && `value` in v) return v.value as V;\n        return v as V;\n      } else if (tag === `AsyncGenerator`) {\n        const v = await r.next() as IteratorResult<V>;\n        //console.log(`  hasDone: ${ `done` in v } value:`, v);\n        if (`done` in v && `value` in v) return v.value as V;\n        return v as V;\n      } else {\n        throw new Error(`Object has 'next' prop, but does not have 'AsyncGenerator', 'Generator' or 'Array Iterator' string tag symbol. Got: '${ tag }'`);\n      }\n    } else if (isReactive<V>(r)) {\n      if (hasLast(r)) return r.last();\n      throw new Error(`Reactive does not have last value`);\n    } else {\n      // Some regular object\n      return r as V;\n    }\n  } else if (typeof r === `function`) {\n    const v = await r(args) as V;\n    return v;\n  } else {\n    // Primitive value?\n    return r as V;\n  }\n}\n\nexport function resolveSync<V extends ValueType>(r: ResolveToValueSync<V>, ...args: any): V {\n  if (typeof r === `object`) {\n    if (`next` in r) {\n      const tag = (r as any)[ Symbol.toStringTag ];\n      if (tag === `Generator` || tag == `Array Iterator`) {\n        const v = r.next();\n        if (`done` in v && `value` in v) return v.value as V;\n        return v as V;\n      } else if (tag === `AsyncGenerator`) {\n        throw new Error(`resolveSync cannot work with an async generator`);\n      } else {\n        throw new Error(`Object has 'next' prop, but does not have 'Generator' or 'Array Iterator' string tag symbol. Got: '${ tag }'`);\n      }\n    } else if (isReactive<V>(r)) {\n      if (hasLast(r)) return r.last();\n      throw new Error(`Reactive does not have last value`);\n    } else {\n      // Some regular object\n      return r as V;\n    }\n  } else if (typeof r === `function`) {\n    return r(args) as V;\n  } else {\n    // Primitive value?\n    return r as V;\n  }\n}\n\n/**\n * Resolves a value as per {@link resolve}, however\n * If an error is thrown or the resolution results in _undefined_ \n * or NaN, `fallbackValue` is returned instead.\n * \n * `null` is an allowed return value.\n * \n * ```js\n * // Function returns undefined 50% of the time or 0\n * const fn = () => {\n *  if (Math.random() >= 0.5) return; // undefined\n *  return 0;\n * }\n * const r = resolveWithFallback(fn, 1);\n * const value = r(); // Always 0 or 1\n * ```\n * @param p Thing to resolve\n * @param fallback Fallback value if an error happens, undefined or NaN\n * @param args \n * @returns \n */\nexport async function resolveWithFallback<T extends ValueType>(p: ResolveToValue<T>, fallback: ResolveFallbackOpts<T>, ...args: any) {\n  let errored = false;\n  let fallbackValue = fallback.value;\n  const overrideWithLast = fallback.overrideWithLast ?? false;\n  if (fallbackValue === undefined) throw new Error(`Needs a fallback value`);\n\n  try {\n    const r = await resolve(p, ...args);\n    if (typeof r === `undefined`) return fallbackValue;\n    if (typeof r === `number` && Number.isNaN(r)) return fallbackValue;\n    if (overrideWithLast) fallbackValue = r;\n    return r;\n  } catch (error) {\n    if (!errored) {\n      errored = true;\n      console.warn(`resolveWithFallback swallowed an error. Additional errors not reported.`, getErrorMessage(error));\n    }\n    return fallbackValue;\n  }\n}\n\nexport function resolveWithFallbackSync<T extends ValueType>(p: ResolveToValueSync<T>, fallback: ResolveFallbackOpts<T>, ...args: any) {\n  let errored = false;\n  let fallbackValue = fallback.value;\n  const overrideWithLast = fallback.overrideWithLast ?? false;\n  if (fallbackValue === undefined) throw new Error(`Needs a fallback value`);\n\n  try {\n    const r = resolveSync(p, ...args);\n    if (typeof r === `undefined`) return fallbackValue;\n    if (typeof r === `number` && Number.isNaN(r)) return fallbackValue;\n    if (overrideWithLast) fallbackValue = r;\n    return r;\n  } catch (error) {\n    if (!errored) {\n      errored = true;\n      console.warn(`resolveWithFallbackSync swallowed an error. Additional errors not reported.`, getErrorMessage(error));\n    }\n    return fallbackValue;\n  }\n}\n\nexport type ResolveFallbackOpts<T> = { value: T, overrideWithLast?: boolean }","import { throwNumberTest } from \"../util/GuardNumbers.js\";\nimport type { ValueType } from '../data/Types.js';\nimport { resolve, resolveSync, type ResolveToValue, type ResolveToValueSync } from '../data/Resolve.js';\nimport { intervalToMs, type Interval } from './IntervalType.js';\nimport { sleep } from './Sleep.js';\nimport type { RequireOnlyOne } from \"src/TsUtil.js\";\n\nexport type RepeatDelayOpts = RepeatOpts & Readonly<Partial<{\n  /**\n * Sleep a fixed period of time regardless of how long each invocation of 'produce' takes\n */\n  delay: Interval;\n  /**\n   * Minimum interval. That is, only sleep if there is time left over after 'produce'\n   * is invoked.\n   */\n  delayMinimum: Interval;\n\n  /**\n * When to perform delay. Default is before 'produce' is invoked.\n * Default: 'before'\n */\n  delayWhen: `before` | `after` | `both`;\n}>>\n\n\n/**\n * Options for repeat\n */\nexport type RepeatOpts = Partial<Readonly<{\n  /**\n   * If specified, repeating stops if this function returns false\n   * @param count\n   * @returns \n   */\n  while: (count: number) => boolean\n  /**\n   * By default, if the callback returns\n   * _undefined_ the repeating exits. Set this to _true_ to\n   * ignore undefined values\n   * @default false\n   */\n  allowUndefined: boolean\n  /**\n   * Optional signal to abort\n   */\n  signal: AbortSignal;\n\n  /**\n   * Maximum times to repeat (default: no limit)\n   */\n  count: number\n  /**\n   * Function to call when initialising\n   * @returns \n   */\n  onStart: () => void\n\n  /**\n   * Function to call when done (or an error occurs)\n   * @returns \n   */\n  onComplete: (withError: boolean) => void\n}>>;\n\n\n/**\n * Generates values from `produce` with a time delay.\n * `produce` can be a simple function that returns a value, an async function, or a generator.\n * If `produce` returns _undefined_, generator exits.\n * \n * @example\n * Produce a random number every 500ms\n * ```js\n * const randomGenerator = repeat(() => Math.random(), 500);\n * for await (const r of randomGenerator) {\n *  // Random value every 1 second\n *  // Warning: does not end by itself, a `break` statement is needed\n * }\n * ```\n *\n * @example\n * Return values from a generator every 500ms\n * ```js\n * import { repeat } from 'https://unpkg.com/ixfx/dist/flow.js'\n * import { count } from 'https://unpkg.com/ixfx/dist/numbers.js'\n * for await (const v of repeat(count(10), { fixed: 1000 })) {\n *  // Do something with `v`\n * }\n * ```\n *\n * Options allow either fixed interval (wait this long between iterations), or a minimum interval (wait at least this long). The latter is useful if `produce` takes some time - it will only wait the remaining time or not at all.\n *\n * If the AbortSignal is triggered, an exception will be thrown, stopping iteration.\n * \n * @see {@link continuously}: loop that runs at a constant speed. Able to be started and stopped\n * @see {@link repeat}: run a function a certain number of times, collecting results\n *\n * @param produce Function/generator to use\n * @param opts\n * @typeParam T - Data type\n * @returns Returns value of `produce` function\n */\nexport async function* repeat<T extends ValueType>(\n  produce: ResolveToValue<T> | ArrayLike<T>,\n  opts: RepeatDelayOpts\n): AsyncGenerator<T> {\n  const signal = opts.signal ?? undefined;\n  const delayWhen = opts.delayWhen ?? `before`;\n  const count = opts.count ?? undefined;\n  const allowUndefined = opts.allowUndefined ?? false;\n  const minIntervalMs = opts.delayMinimum ? intervalToMs(opts.delayMinimum) : undefined;\n  const whileFunc = opts.while;\n\n  let cancelled = false;\n  let sleepMs = intervalToMs(opts.delay, intervalToMs(opts.delayMinimum, 0));\n  let started = performance.now();\n\n  const doDelay = async () => {\n    const elapsed = performance.now() - started;\n    if (typeof minIntervalMs !== `undefined`) {\n      sleepMs = Math.max(0, minIntervalMs - elapsed);\n    }\n    if (sleepMs) {\n      await sleep({ millis: sleepMs, signal });\n    }\n    started = performance.now();\n    if (signal?.aborted) throw new Error(`Signal aborted ${ signal.reason }`);\n  };\n\n  if (Array.isArray(produce)) produce = produce.values();\n\n  if (opts.onStart) opts.onStart();\n\n  let errored = true;\n  let loopedTimes = 0;\n  try {\n    while (!cancelled) {\n      loopedTimes++;\n      if (delayWhen === `before` || delayWhen === `both`) await doDelay();\n      const result = await resolve<T>(produce);\n      if (typeof result === `undefined` && !allowUndefined) {\n        cancelled = true;\n      } else {\n        yield result;\n        if (delayWhen === `after` || delayWhen === `both`) await doDelay();\n        if (count !== undefined && loopedTimes >= count) cancelled = true;\n      }\n      if (whileFunc) {\n        if (!whileFunc(loopedTimes)) {\n          cancelled = true;\n        }\n      }\n    }\n    errored = false\n  } finally {\n    cancelled = true;\n    if (opts.onComplete) opts.onComplete(errored);\n  }\n};\n\n\n/**\n * Generates values from `produce` with a time delay.\n * `produce` can be a simple function that returns a value, an function, or a generator.\n * If `produce` returns _undefined_, generator exits.\n * \n * This is the synchronous version. {@link repeat} allows for delays between loops\n * as well as asynchronous callbacks. \n *\n * If the AbortSignal is triggered, an exception will be thrown, stopping iteration.\n * \n * @param produce Function/generator to use\n * @param opts Options\n * @typeParam T - Data type\n * @returns Returns value of `produce` function\n */\nexport function* repeatSync<T extends ValueType>(\n  produce: ResolveToValueSync<T> | ArrayLike<T>,\n  opts: RepeatOpts\n) {\n  const signal = opts.signal ?? undefined;\n  const count = opts.count ?? undefined;\n  const allowUndefined = opts.allowUndefined ?? false;\n  let cancelled = false;\n\n  if (Array.isArray(produce)) produce = produce.values();\n\n  if (opts.onStart) opts.onStart();\n\n  let errored = true;\n  let loopedTimes = 0;\n\n  try {\n    while (!cancelled) {\n      loopedTimes++;\n      const result = resolveSync<T>(produce);\n      if (typeof result === `undefined` && !allowUndefined) {\n        cancelled = true;\n      } else {\n        yield result;\n        if (count !== undefined && loopedTimes >= count) cancelled = true;\n        if (signal?.aborted) cancelled = true;\n      }\n    }\n    errored = false\n  } finally {\n    cancelled = true;\n    if (opts.onComplete) opts.onComplete(errored);\n  }\n};\n\n/**\n * Logic for continuing repeats\n */\n// export type RepeatPredicate = (\n//   repeats: number,\n//   valuesProduced: number\n// ) => boolean;\n\n\n/**\n * Calls and waits for the async function `fn` repeatedly, yielding each result asynchronously.\n * Use {@link repeat} if `fn` does not need to be awaited.\n *\n * ```js\n * // Eg. iterate\n * const r = Flow.repeat(5, async () => Math.random());\n * for await (const v of r) {\n *\n * }\n * // Eg read into array\n * const results = await Array.fromAsync(Flow.repeatAwait(5, async () => Math.random()));\n * ```\n *\n * The number of repeats is determined by the first parameter. If it's a:\n * - number: how many times to repeat\n * - function: it gets called before each repeat, if it returns _false_ repeating stops.\n *\n * Using a fixed number of repeats:\n * ```js\n * // Calls - and waits - for Flow.sleep(1) 5 times\n * await Flow.repeatAwait(5, async () => {\n *    // some kind of async function where we can use await\n *    // eg. sleep for 1s\n *    await Flow.sleep(1);\n * });\n * ```\n *\n * Using a function to dynamically determine number of repeats. The function gets\n * passed the number of repeats so far as well as the number of values produced. This\n * is count of non-undefined results from `cb` that is being repeated.\n *\n * ```js\n * async function task() {\n *  // do something\n * }\n *\n * await Flow.repeatAwait(\n *  (repeats, valuesProduced) => {\n *    // Logic for deciding whether to repeat or not\n *    if (repeats > 5) return false; // Stop repeating\n *  },\n *  task\n * );\n * ```\n *\n * In the above cases we're not using the return value from `fn`. This would look like:\n * ```js\n * const g = Flow.repeatAwait(5, async () => Math.random);\n * for await (const v of g) {\n *  // Loops 5 times, v is the return value of calling `fn` (Math.random)\n * }\n * ```\n * @param countOrPredicate Number of times to repeat, or a function that returns _false_ to stop the loop.\n * @param fn Function to execute. Asynchronous functions will be awited\n * @typeParam V - Return type of repeating function\n * @returns Asynchronous generator of `fn` results.\n */\n// export function repeatAwait<V>(countOrPredicate: number | RepeatPredicate, fn: (repeats: number, valuesProduced: number) => Promise<V | undefined> | V): AsyncIterable<V> {\n//   return typeof countOrPredicate === `number` ? repeatTimesAwaited(countOrPredicate, fn) : repeatWhileAwaited(countOrPredicate, fn);\n// }\n\n/**\n * Calls `fn` repeatedly, yielding each result.\n * Use {@link repeatAwait} if `fn` is asynchronous and you want to wait for it.\n *\n * The number of repeats is determined by the first parameter. If it's a:\n * - number: how many times to repeat\n * - function: it gets called before each repeat, if it returns _false_ repeating stops.\n *\n * Example: using a fixed number of repeats\n * ```js\n * // Results will be an array with five random numbers\n * const results = [...repeat(5, () => Math.random())];\n *\n * // Or as an generator (note also the simpler expression form)\n * for (const result of repeat(5, Math.random)) {\n * }\n * ```\n *\n * Example: Using a function to dynamically determine number of repeats\n * ```js\n * function task() {\n * }\n *\n * Flow.repeat(\n *  (repeats, valuesProduced) => {\n *    if (repeats > 5) return false; // Stop repeating\n *  },\n *  task\n * );\n * ```\n *\n * In the above cases we're not using the return value from `fn`. To do so,\n * this would look like:\n * ```js\n * const g = Flow.repeat(5, () => Math.random);\n * for (const v of g) {\n *  // Loops 5 times, v is the return value of calling `fn` (Math.random)\n * }\n * ```\n *\n * Alternatives:\n * * {@link Flow.forEach | Flow.forEach} - if you don't need return values\n * * {@link Flow.interval} - if you want to repeatedly call something with an interval between\n * @param countOrPredicate Numnber of repeats, or a function that returns _false_ for when to stop.\n * @param fn Function to execute. Asynchronous functions will be awited\n * @typeParam V - Return type of repeating function\n * @returns Asynchronous generator of `fn` results.\n */\n// export function repeat<V>(countOrPredicate: number | RepeatPredicate, fn: (repeats: number, valuesProduced: number) => V | undefined): Generator<V> {\n//   return typeof countOrPredicate === `number` ? repeatTimes(countOrPredicate, fn) : repeatWhile(countOrPredicate, fn);\n// }\n\n\n/**\n * Calls `fn` until `predicate` returns _false_. Awaits result of `fn` each time.\n * Yields result of `fn` asynchronously\n * @param predicate\n * @param fn\n * @typeParam V - Return type of repeating function\n */\n// async function* repeatWhileAwaited<V>(predicate: RepeatPredicate, fn: (repeats: number, valuesProduced: number) => Promise<V | undefined> | V): AsyncGenerator<V> {\n//   let repeats = 0;\n//   let valuesProduced = 0;\n//   while (predicate(repeats, valuesProduced)) {\n//     repeats++;\n//     const v = await fn(repeats, valuesProduced);\n//     if (v === undefined) continue;\n//     yield v;\n//     valuesProduced++;\n//   }\n// }\n\n/**\n * Calls `fn` until `predicate` returns _false_. Yields result of `fn`.\n * @param predicate Determiner for whether repeating continues\n * @param fn Function to call\n * @typeParam V - Return type of repeating function\n */\n// function* repeatWhile<V>(predicate: RepeatPredicate, fn: (repeats: number, valuesProduced: number) => V | undefined): Generator<V> {\n//   let repeats = 0;\n//   let valuesProduced = 0;\n//   while (predicate(repeats, valuesProduced)) {\n//     repeats++;\n//     const v = fn(repeats, valuesProduced);\n//     if (v === undefined) continue;\n//     yield v;\n//     valuesProduced++;\n//   }\n// }\n\n/**\n * Calls `fn`, `count` number of times, waiting for the result of `fn`.\n * Yields result of `fn` asynchronously\n * @param count Number of times to run\n * @param fn Function to run\n * @typeParam V - Return type of repeating function\n */\n// async function* repeatTimesAwaited<V>(count: number, fn: (repeats: number, valuesProduced: number) => Promise<V | undefined> | V | undefined) {\n//   throwNumberTest(count, `positive`, `count`);\n//   let valuesProduced = 0;\n//   let repeats = 0;\n//   while (count-- > 0) {\n//     repeats++;\n//     const v = await fn(repeats, valuesProduced);\n//     if (v === undefined) continue;\n//     yield v;\n//     valuesProduced++;\n//   }\n// }\n\n/**\n * Calls `fn`, `count` times. Assumes a synchronous function. Yields result of `fn`.\n *\n * Note that if `fn` returns _undefined_ repeats will stop.\n * @typeParam V - Return type of repeating function\n * @param count Number of times to run\n * @param fn Function to run\n */\n// function* repeatTimes<V>(count: number, fn: (repeats: number, valuesProduced: number) => V | undefined): Generator<V> {\n//   throwNumberTest(count, `positive`, `count`);\n//   let valuesProduced = 0;\n//   let repeats = 0;\n//   while (count-- > 0) {\n//     //console.log(`Flow.repeatTimes count: ${ count } repeats: ${ repeats } values: ${ valuesProduced }`);\n//     repeats++;\n//     const v = fn(repeats, valuesProduced);\n//     if (v === undefined) continue;\n//     yield v;\n//     valuesProduced++;\n//   }\n// }\n\n\n/**\n * Repeatedly calls `fn`, reducing via `reduce`.\n *\n * ```js\n * repeatReduce(10, () => 1, (acc, v) => acc + v);\n * // Yields: 10\n *\n * // Multiplies random values against each other 10 times\n * repeatReduce(10, Math.random, (acc, v) => acc * v);\n * // Yields a single number\n * ```\n * @param countOrPredicate Number of times to run, or function to keep running\n * @param fn Function to call\n * @param initial Initial value\n * @param reduce Function to reduce value\n * @typeParam V - Return type of repeating function\n * @returns Final result\n */\n// export const repeatReduce = <V>(\n//   countOrPredicate: number | RepeatPredicate,\n//   fn: () => V | undefined,\n//   reduce: (accumulator: V, value: V) => V,\n//   initial: V\n// ): V => {\n\n//   return IterableReduce(repeat(countOrPredicate, fn), reduce, initial);\n\n//   // if (typeof countOrPredicate === `number`) {\n//   //   throwNumberTest(countOrPredicate, `positive`, `countOrPredicate`);\n//   //   while (countOrPredicate-- > 0) {\n//   //     const v = fn();\n//   //     if (v === undefined) continue;\n//   //     initial = reduce(initial, v);\n//   //   }\n//   // } else {\n//   //   //eslint-disable-next-line functional/no-let\n//   //   let repeats, valuesProduced;\n//   //   repeats = valuesProduced = 0;\n//   //   while (countOrPredicate(repeats, valuesProduced)) {\n//   //     repeats++;\n//   //     const v = fn();\n//   //     if (v === undefined) continue;\n//   //     initial = reduce(initial, v);\n//   //     valuesProduced++;\n//   //   }\n//   // }\n//   // return initial;\n// };","import type { IDictionary } from './IMappish.js';\nexport type GetOrGenerate<K, V, Z> = (key: K, args?: Z) => Promise<V>;\n\n/**\n * @inheritDoc getOrGenerate\n * @param map\n * @param fn\n * @returns\n */\n//eslint-disable-next-line functional/prefer-readonly-type\nexport const getOrGenerateSync =\n  <K, V, Z>(map: IDictionary<K, V>, fn: (key: K, args?: Z) => V) =>\n    (key: K, args?: Z): V => {\n      //eslint-disable-next-line functional/no-let\n      let value = map.get(key);\n      if (value !== undefined) return value;\n      value = fn(key, args);\n      map.set(key, value);\n      return value;\n    };\n\n/**\n * Returns a function that fetches a value from a map, or generates and sets it if not present.\n * Undefined is never returned, because if `fn` yields that, an error is thrown.\n *\n * See {@link getOrGenerateSync} for a synchronous version.\n *\n * ```\n * const m = getOrGenerate(new Map(), (key) => {\n *  return key.toUppercase();\n * });\n *\n * // Not contained in map, so it will run the uppercase function,\n * // setting the value to the key 'hello'.\n * const v = await m(`hello`);  // Yields 'HELLO'\n * const v1 = await m(`hello`); // Value exists, so it is returned ('HELLO')\n * ```\n *\n */\n//eslint-disable-next-line functional/prefer-readonly-type\nexport const getOrGenerate =\n  <K, V, Z>(\n    map: IDictionary<K, V>,\n    fn: (key: K, args?: Z) => Promise<V> | V\n  ): GetOrGenerate<K, V, Z> =>\n    async (key: K, args?: Z): Promise<V> => {\n      //eslint-disable-next-line functional/no-let\n      let value = map.get(key);\n      if (value !== undefined) return value; //Promise.resolve(value);\n      value = await fn(key, args);\n      if (value === undefined) throw new Error(`fn returned undefined`);\n      map.set(key, value);\n      return value;\n    };","import { getOrGenerateSync } from '../data/maps/GetOrGenerate.js';\nimport type { MessageLogger, LogMessage } from \"./Types.js\";\n/**\n * Returns a console logging function which prefixes messages. This is\n * useful for tracing messages from different components. Each prefix\n * is assigned a colour, further helping to distinguish messages.\n *\n * Use {@link logSet} to get a bundled set.\n *\n * ```\n * // Initialise once\n * const log = logger(`a`);\n * const error = logger(`a`, `error`);\n * const warn = logger(`a`, `warn);\n *\n * // And then use\n * log(`Hello`);    // console.log(`a Hello`);\n * error(`Uh-oh`);  // console.error(`a Uh-oh`);\n * warn(`Eek!`);    // console.warn(`a Eeek!`);\n * ```\n *\n * Provide the `colourKey` parameter to make log messages\n * be coloured the same, even though the prefix is different.\n * ```js\n * // Both loggers will use the same colour because they\n * // share the colour key `system`\n * const log = logger(`a`,`log`,`system`);\n * const log2 = logger(`b`, `log`, `system`);\n * ```\n * @param prefix\n * @param kind\n * @param colourKey Optional key to colour log lines by instead of prefix\n * @returns\n */\n\n\n\n//eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport const logger =\n  (\n    prefix: string,\n    kind: `log` | `warn` | `error` = `log`,\n    colourKey?: string\n  ): MessageLogger =>\n    (m: any) => {\n      if (m === undefined) {\n        m = `(undefined)`;\n      } else if (typeof m === `object`) {\n        m = JSON.stringify(m);\n      }\n\n      const colour = colourKey ?? prefix;\n      switch (kind) {\n        case `log`: {\n          console.log(`%c${ prefix } ${ m }`, `color: ${ logColours(colour) }`);\n          break;\n        }\n        case `warn`: {\n          console.warn(prefix, m);\n          break;\n        }\n        case `error`: {\n          console.error(prefix, m);\n          break;\n        }\n      }\n    };\n\n/**\n* Returns a bundled collection of {@link logger}s\n*\n* ```js\n* const con = logSet(`a`);\n* con.log(`Hello`);  // console.log(`a Hello`);\n* con.warn(`Uh-oh`); // console.warn(`a Uh-oh`);\n* con.error(`Eek!`); // console.error(`a Eek!`);\n* ```\n*\n* By default each prefix is assigned a colour. To use\n* another logic, provide the `colourKey` parameter.\n*\n* ```js\n* // Both set of loggers will use same colour\n* const con = logSet(`a`, true, `system`);\n* const con2 = logSet(`b`, true, `system`);\n* ```\n* @param prefix Prefix for log messages\n* @param verbose True by default. If false, log() messages are a no-op\n* @param colourKey If specified, log messages will be coloured by this key instead of prefix (default)\n* @returns\n*/\nexport const logSet = (prefix: string, verbose = true, colourKey?: string) => {\n  if (verbose) {\n    return {\n      log: logger(prefix, `log`, colourKey),\n      warn: logger(prefix, `warn`, colourKey),\n      error: logger(prefix, `error`, colourKey),\n    };\n  }\n  return {\n    //eslint-disable-next-line @typescript-eslint/no-explicit-any\n    log: (_: any) => {\n      /** no-op */\n    },\n    warn: logger(prefix, `warn`, colourKey),\n    error: logger(prefix, `error`, colourKey),\n  };\n};\n\n/**\n * Either a flag for default console logging, or a simple log function\n */\nexport type LogOption = boolean | MessageLogger;\n\n/**\n * Resolve a LogOption to a function\n * @param l\n * @returns\n */\nexport const resolveLogOption = (\n  l?: LogOption,\n  defaults: { readonly category?: string; readonly kind?: string } = {}\n): MessageLogger => {\n  if (l === undefined || (typeof l === `boolean` && !l)) {\n    return (_: LogMessage | string) => {\n      /** no-op */\n    };\n  }\n  const defaultCat = defaults.category ?? ``;\n  const defaultKind = defaults.kind ?? undefined;\n\n  if (typeof l === `boolean`) {\n    return (messageOrString: LogMessage | string) => {\n      const m =\n        typeof messageOrString === `string` ? { msg: messageOrString } : messageOrString;\n      const kind = m.kind ?? defaultKind;\n      const category = m.category ?? defaultCat;\n      let message = m.msg;\n      if (category) message = `[${ category }] ${ message }`;\n      switch (kind) {\n        case `error`: {\n          console.error(message);\n          break;\n        }\n        case `warn`: {\n          console.warn(message);\n          break;\n        }\n        case `info`: {\n          console.info(message);\n          break;\n        }\n        default: {\n          console.log(message);\n        }\n      }\n    };\n  }\n  return l;\n};\n\n\n\n// eslint-disable-next-line functional/no-let\nlet logColourCount = 0;\nexport const logColours = getOrGenerateSync(new Map<string, string>(), () => {\n  const hue = ++logColourCount * 137.508; // use golden angle approximation\n  return `hsl(${ hue },50%,75%)`;\n});","import { isEqualDefault, type IsEqual } from \"../../util/IsEqual.js\";\n\n/**\n * Yield additional values from `values` which are not in `source`.\n *\n * Assuming that `source` is a set of unique values, this function\n * yields items from `values` which are not present in `source`.\n *\n * Duplicate items in `values` are ignored - only the first is yielded.\n *\n * If `eq` function is not provided, values are compared using the\n * default === semantics (via {@link isEqualDefault})\n *\n * ```js\n * const existing = [ 1, 2, 3 ];\n * const newValues = [ 3, 4, 5];\n * const v = [...additionalValues(existing, newValues)];\n * // [ 1, 2, 3, 4, 5]\n * ```\n *\n * ```js\n * const existing = [ 1, 2, 3 ];\n * const newValues = [ 3, 4, 5 ];\n * for (const v of additionalValues(existing, newValues)) {\n *  // 4, 5\n * }\n * To combine one or more iterables, keeping only unique items, use {@link unique}\n * @param source\n * @param values\n */\nexport function* additionalValues<V>(\n  source: Iterable<V>,\n  values: Iterable<V>,\n  eq: IsEqual<V> = isEqualDefault\n): Iterable<V> {\n  const sourceArray = Array.isArray(source) ? source : [ ...source ];\n  const yielded: Array<V> = [];\n  for (const v of values) {\n    const found = sourceArray.find((index) => eq(index, v));\n    if (!found) {\n      const alreadyYielded = yielded.find((ii) => eq(ii, v));\n      if (!alreadyYielded) {\n        //eslint-disable-next-line functional/immutable-data\n        yielded.push(v);\n        yield v;\n      }\n    }\n  }\n}\n","import { isEqualDefault } from \"../../util/IsEqual.js\";\nimport { additionalValues } from \"../../iterables/sync/AdditionalValues.js\";\n\n/**\n * Combines the values of one or more arrays, removing duplicates\n * ```js\n * const v = Arrays.unique([ [1, 2, 3, 4], [ 3, 4, 5, 6] ]);\n * // [ 1, 2, 3, 4, 5, 6]\n * ```\n *\n * A single array can be provided as well:\n * ```js\n * const v = Arrays.unique([ 1, 2, 3, 1, 2, 3 ]);\n * // [ 1, 2, 3 ]\n * ```\n * \n * By default uses JSON.toString() to compare values.\n * \n * See also:\n * * {@link intersection}: Overlap between two arrays\n * * {@link additionalValues}: Yield values from an iterable not present in the other\n * * {@link containsDuplicateValues}: Returns true if array contains duplicates\n * @param arrays\n * @param comparer\n * @returns\n */\nexport const unique = <V>(\n  arrays:\n    | Array<Array<V>>\n    | Array<V>\n    | ReadonlyArray<V>\n    | ReadonlyArray<ReadonlyArray<V>>,\n  comparer = isEqualDefault<V>\n): ReadonlyArray<V> => {\n  const t: Array<V> = [];\n  for (const a of arrays) {\n    if (Array.isArray(a)) {\n      for (const v of additionalValues<V>(t, a, comparer)) {\n        t.push(v);\n      }\n    } else {\n      return [ ...additionalValues<V>([], arrays as Array<V>, comparer) ];\n    }\n  }\n  return t;\n};\n\n","import { type RandomSource, defaultRandom } from \"./Types.js\";\n\n/**\n* Returns a random number from 0..weightings.length, distributed by the weighting values.\n* \n* eg: produces 0 20% of the time, 1 50% of the time, 2 30% of the time\n* ```js\n* weightedIndex([0.2, 0.5, 0.3]);\n* ```\n* @param weightings \n* @param rand \n* @returns \n*/\nexport const weightedIndex = (weightings: Array<number>, rand: RandomSource = defaultRandom): () => number => {\n  const precompute: Array<number> = [];\n  let total = 0;\n  // eslint-disable-next-line unicorn/no-for-loop\n  for (let index = 0; index < weightings.length; index++) {\n    total += weightings[ index ];\n    precompute[ index ] = total;\n  }\n  if (total !== 1) throw new Error(`Weightings should add up to 1. Got: ${ total }`);\n\n  return (): number => {\n    const v = rand();\n    // eslint-disable-next-line unicorn/no-for-loop\n    for (let index = 0; index < precompute.length; index++) {\n      if (v <= precompute[ index ]) return index;\n    }\n    throw new Error(`Bug: weightedIndex could not select index`);\n  }\n}","import { weightedIndex } from \"../../random/WeightedIndex.js\";\nimport type { RandomSource } from \"../../random/Types.js\";\nimport { guardArray } from \"./GuardArray.js\";\n\n/**\n * Returns a random array index.\n *\n * ```js\n * import { Arrays } from 'https://unpkg.com/ixfx/dist/data.js';\n *\n * const v = [`blue`, `red`, `orange`];\n * Arrays.randomIndex(v); // Yields 0, 1 or 2\n * ```\n *\n * Use {@link randomElement} if you want a value from `array`, not index.\n *\n * @param array Array\n * @param rand Random generator. `Math.random` by default.\n * @returns\n */\nexport const randomIndex = <V>(\n  array: ArrayLike<V>,\n  rand: RandomSource = Math.random\n): number => Math.floor(rand() * array.length);\n\n\n/**\n * Removes a random item from an array, returning both the item and the new array as a result.\n * Does not modify the original array unless `mutate` parameter is true.\n *\n * @example Without changing source\n * ```js\n * import { Arrays } from 'https://unpkg.com/ixfx/dist/data.js';\n *\n * const data = [100, 20, 40];\n * const {value, array} = Arrays.randomPluck(data);\n * // value: 20, array: [100, 40], data: [100, 20, 40];\n * ```\n *\n * @example Mutating source\n * ```js\n * import { Arrays } from 'https://unpkg.com/ixfx/dist/data.js';\n *\n * const data = [100, 20, 40];\n * const {value} = Arrays.randomPluck(data, true);\n * // value: 20, data: [100, 40];\n * ```\n *\n * @typeParam V - Type of items in array\n * @param array Array to pluck item from\n * @param mutate If _true_, changes input array. _False_ by default.\n * @param rand Random generatr. `Math.random` by default.\n * @return Returns an object `{value:V|undefined, array:V[]}`\n *\n */\nexport const randomPluck = <V>(\n  array: ReadonlyArray<V> | Array<V>,\n  mutate = false,\n  rand: RandomSource = Math.random\n): { readonly value: V | undefined; readonly array: Array<V> } => {\n  if (array === undefined) throw new Error(`array is undefined`);\n  if (!Array.isArray(array)) throw new Error(`'array' param is not an array`);\n  if (array.length === 0) return { value: undefined, array: [] };\n  const index = randomIndex(array, rand);\n  if (mutate) {\n    return {\n      value: array[ index ],\n      //eslint-disable-next-line functional/immutable-data\n      array: array.splice(index, 1),\n    };\n  } else {\n    // Copy array, remove item from that\n    const t = [ ...array ];\n    //eslint-disable-next-line functional/immutable-data\n    t.splice(index, 1);\n    return {\n      value: array[ index ],\n      array: t,\n    };\n  }\n};\n\n\n/**\n * Returns random element.\n *\n * ```js\n * import { Arrays } from 'https://unpkg.com/ixfx/dist/data.js';\n *\n * const v = [`blue`, `red`, `orange`];\n * Arrays.randomElement(v); // Yields `blue`, `red` or `orange`\n * ```\n *\n * Use {@link randomIndex} if you want a random index within `array`.\n *\n * @param array\n * @param rand Random generator. `Math.random` by default.\n * @returns\n */\nexport const randomElement = <V>(\n  array: ArrayLike<V>,\n  rand: RandomSource = Math.random\n): V => {\n  guardArray(array, `array`);\n  return array[ Math.floor(rand() * array.length) ];\n};\n\n\n/**\n * Selects a random array index, biased by the provided `weightings`.\n * \n * In the below example, `a` will be picked 20% of the time, `b` 50% and so on.\n * ```js\n * const data =    [  `a`,  `b`,  `c`,  `d` ]\n * const weights = [ 0.2,  0.5,  0.1,  0.2 ] \n * ```\n * @param array \n * @param weightings \n * @param randomSource \n */\nexport const randomElementWeightedSource = <V>(array: ArrayLike<V>, weightings: Array<number>, randomSource: RandomSource = Math.random) => {\n  if (array.length !== weightings.length) throw new Error(`Lengths of 'array' and 'weightings' should be the same.`);\n  const r = weightedIndex(weightings, randomSource);\n  return (): V => {\n    const index = r();\n    return array[ index ];\n  }\n}\n\n/**\n * Returns a shuffled copy of the input array.\n * @example\n * ```js\n * import { Arrays } from 'https://unpkg.com/ixfx/dist/data.js';\n *\n * const d = [1, 2, 3, 4];\n * const s = Arrays.shuffle(d);\n * // d: [1, 2, 3, 4], s: [3, 1, 2, 4]\n * ```\n * @param dataToShuffle\n * @param rand Random generator. `Math.random` by default.\n * @returns Copy with items moved around randomly\n * @typeParam V - Type of array items\n */\nexport const shuffle = <V>(\n  dataToShuffle: ReadonlyArray<V>,\n  rand: RandomSource = Math.random\n): Array<V> => {\n  const array = [ ...dataToShuffle ];\n  // eslint-disable-next-line  functional/no-let\n  for (let index = array.length - 1; index > 0; index--) {\n    const index_ = Math.floor(rand() * (index + 1));\n    [ array[ index ], array[ index_ ] ] = [ array[ index_ ], array[ index ] ];\n  }\n  return array;\n};","import { unique } from '../data/arrays/Unique.js';\n\n\n\n/**\n * State machine driver\n */\nexport { init as driver } from './StateMachineDriver.js';\nexport type {\n  DriverOpts,\n  StatesHandler as DriverHandler,\n  Runner,\n  ExpressionOrResult as DriverExpression,\n  Result as DriverResult,\n} from './StateMachineDriver.js';\n\n/**\n * Transition result\n * * 'Ok': transition valid\n * * 'FromNotFound': the from state is missing from machine definition\n * * 'ToNotFound': the 'to' state is missing from machine definition\n * * 'Invalid': not allowed to transition to target state from the current state\n * * 'Terminal':  not allowed to transition because from state is the final state\n */\nexport type TransitionResult =\n  | `Ok`\n  | `FromNotFound`\n  | `ToNotFound`\n  | `Invalid`\n  | `Terminal`;\n\nexport type TransitionCondition<V extends Transitions> = {\n  readonly hasPriorState: ReadonlyArray<StateNames<V>>;\n  readonly isInState: StateNames<V>;\n};\n\nexport type StateTargetStrict<V extends Transitions> = {\n  readonly state: StateNames<V> | null;\n  readonly preconditions?: ReadonlyArray<TransitionCondition<V>>;\n};\n\n/**\n * Possible state transitions, or _null_ if final state.\n */\n//export type StateTarget<V extends Transitions> = StateTargetExt<V> | null;\n\nexport type StateTarget<V extends Transitions> =\n  | string\n  //eslint-disable-next-line functional/prefer-readonly-type\n  | Array<string>\n  | ReadonlyArray<string>\n  | null\n  | StateTargetStrict<V>;\n//eslint-disable-next-line functional/prefer-readonly-type\n// | StateTargetStrict<V>[]\n// | readonly StateTargetStrict<V>[];\n\n/**\n * Maps state to allowable next states\n */\nexport type Transitions = {\n  readonly [ key: string ]: StateTarget<Transitions>;\n};\n\nexport type TransitionsStrict = Readonly<Record<string, ReadonlyArray<StateTargetStrict<Transitions>>>>;\n/**\n * List of possible states\n */\nexport type StateNames<V extends Transitions> = keyof V & string;\n\nexport type Machine<V extends Transitions> = {\n  /**\n   * Allowable state transitions\n   */\n  readonly states: V;\n};\n\n/**\n * Encapsulation of a 'running' machine description and state.\n *\n * See:\n * - {@link cloneState}\n */\nexport type MachineState<V extends Transitions> = {\n  /**\n   * Current state\n   */\n  readonly value: StateNames<V>;\n  /**\n   * List of unique states visited. Won't contain the current\n   * state unless it has already been visited.\n   */\n  readonly visited: ReadonlyArray<StateNames<V>>;\n\n  //readonly machine: Machine<V>;\n  readonly machine: {\n    readonly [ key in StateNames<V> ]: ReadonlyArray<StateTargetStrict<V>>;\n  };\n};\n\n/**\n * Clones machine state\n * @param toClone\n * @returns Cloned of `toClone`\n */\nexport const cloneState = <V extends Transitions>(\n  toClone: MachineState<V>\n): MachineState<V> => {\n  return Object.freeze({\n    value: toClone.value,\n    visited: [ ...toClone.visited ],\n    machine: toClone.machine,\n  });\n};\n/**\n * Initialises a state machine\n * ```js\n * const desc = {\n *  pants: ['shoes','socks'],\n *  socks: ['shoes', 'pants'],\n *  shoes: 'shirt',\n *  shirt: null\n * }\n * // Defaults to first key, 'pants'\n * let sm = StateMachine.init(descr);\n * // Move to 'shoes' state\n * sm = StateMachine.to(sm, 'shoes');\n * sm.state; // 'shoes'\n * sm.visited; // [ 'pants' ]\n * StateMachineLight.isDdone(sm); // false\n * StateMachineLight.possible(sm); // [ 'shirt' ]\n * ```\n * @param stateMachine Settings for state machine\n * @param initialState Initial state name\n * @returns\n */\nexport const init = <V extends Transitions>(\n  stateMachine: Machine<V> | Transitions | TransitionsStrict,\n  initialState?: StateNames<V>\n): MachineState<V> => {\n  const [ machine, machineValidationError ] = validateMachine(stateMachine);\n  if (!machine) throw new Error(machineValidationError);\n\n  const state: StateNames<V> =\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    (initialState!) ?? Object.keys(machine.states)[ 0 ];\n  if (machine.states[ state ] === undefined) {\n    throw new TypeError(`Initial state not found`);\n  }\n\n  // Normalise states\n  const transitions = validateAndNormaliseTransitions(machine.states);\n  if (transitions === undefined) {\n    throw new Error(`Could not normalise transitions`);\n  }\n  // @ts-expect-error\n  return Object.freeze({\n    value: state,\n    visited: [],\n    machine: Object.fromEntries(transitions),\n  });\n};\n\nexport const reset = <V extends Transitions>(\n  sm: MachineState<V>\n): MachineState<V> => {\n  // @ts-expect-error\n  return init<V>(sm.machine);\n};\n\nexport const validateMachine = <V extends Transitions>(\n  smOrTransitions: Machine<V> | Transitions | TransitionsStrict\n): [ machine: Machine<V> | undefined, msg: string ] => {\n  if (smOrTransitions === undefined) {\n    return [ undefined, `Parameter undefined` ];\n  }\n  if (smOrTransitions === null) {\n    return [ undefined, `Parameter null` ];\n  }\n  if (`states` in smOrTransitions) {\n    // Assume Machine type\n    return [ smOrTransitions as Machine<V>, `` ];\n  }\n  if (typeof smOrTransitions === `object`) {\n    return [\n      {\n        // @ts-expect-error\n        states: smOrTransitions,\n      },\n      ``,\n    ];\n  }\n  return [\n    undefined,\n    `Unexpected type: ${ typeof smOrTransitions }. Expected object`,\n  ];\n};\n\n// export const validateMachine = <V extends Transitions>(\n//   sm: Machine<V>\n// ): [machine: Machine<V> | undefined, msg: string] => {\n//   if (typeof sm === 'undefined') {\n//     return [undefined, `Parameter 'sm' is undefined`];\n//   }\n//   if (sm === null) return [undefined, `Parameter 'sm' is null`];\n//   if (`states` in sm) {\n//     const [transitions, validationError] = validateAndNormaliseTransitions(\n//       sm.states\n//     );\n//     if (transitions) {\n//       const machine: Machine<V> = {\n//         // @ts-ignore\n//         states: Object.fromEntries(transitions),\n//       };\n//       return [machine, ''];\n//     } else {\n//       return [undefined, validationError];\n//     }\n//   } else {\n//     return [undefined, `Parameter 'sm.states' is undefined`];\n//   }\n// };\n\n/**\n * Returns _true_ if MachineState `sm` is in its final state.\n * @param sm\n * @returns\n */\nexport const isDone = <V extends Transitions>(sm: MachineState<V>): boolean => {\n  return possible(sm).length === 0;\n};\n\n/**\n * Returns a list of possible state targets for `sm`, or\n * an empty list if no transitions are possible.\n * @param sm\n * @returns\n */\nexport const possibleTargets = <V extends Transitions>(\n  sm: MachineState<V>\n): ReadonlyArray<StateTargetStrict<V>> => {\n  // Validate current state\n  validateMachineState(sm);\n  // get list of possible targets\n  const fromS = sm.machine[ sm.value ];\n\n  if (fromS.length === 1 && fromS[ 0 ].state === null) return [];\n  return fromS;\n};\n\n/**\n * Returns a list of possible state names for `sm`, or\n * an empty list if no transitions are possible.\n *\n * @param sm\n * @returns\n */\nexport const possible = <V extends Transitions>(\n  sm: MachineState<V>\n): Array<StateNames<V> | null> => {\n  const targets = possibleTargets(sm);\n  return targets.map((v) => v.state);\n};\n\nexport const normaliseTargets = <V extends Transitions>(\n  targets:\n    | StateTarget<V>\n    | ReadonlyArray<StateTargetStrict<V>>\n    //eslint-disable-next-line functional/prefer-readonly-type\n    | StateTargetStrict<V>\n): Array<StateTargetStrict<V>> | null | undefined => {\n  const normaliseSingleTarget = (\n    target: string | undefined | null | object\n  ): StateTargetStrict<V> | undefined => {\n    // Terminal target\n    if (target === null) return { state: null };\n    // String is the target state\n    if (typeof target === `string`) {\n      return {\n        state: target,\n      };\n    } else if (typeof target === `object` && `state` in target) {\n      const targetState = target.state;\n      if (typeof targetState !== `string`) {\n        throw new TypeError(\n          `Target 'state' field is not a string. Got: ${ typeof targetState }`\n        );\n      }\n      if (`preconditions` in target) {\n        return {\n          state: targetState,\n          preconditions: target.preconditions as Array<TransitionCondition<V>>,\n        };\n      }\n      return { state: targetState };\n    } else {\n      throw new Error(\n        `Unexpected type: ${ typeof target }. Expected string or object with 'state' field.`\n      );\n    }\n  };\n\n  // Array of targets (either strings or objects)\n  if (Array.isArray(targets)) {\n    //eslint-disable-next-line functional/no-let\n    let containsNull = false;\n    const mapResults = targets.map((t) => {\n      const r = normaliseSingleTarget(t);\n      if (!r) throw new Error(`Invalid target`);\n      containsNull = containsNull || r.state === null;\n      return r;\n    });\n    if (containsNull && mapResults.length > 1) {\n      throw new Error(`Cannot have null as an possible state`);\n    }\n    return mapResults;\n  } else {\n    const target = normaliseSingleTarget(targets);\n    if (!target) return;\n    return [ target ];\n  }\n};\n\nconst validateAndNormaliseTransitions = (\n  d: Transitions\n): Map<string, Array<StateTargetStrict<typeof d>>> | undefined => {\n  const returnMap = new Map<string, Array<StateTargetStrict<typeof d>>>();\n\n  // 1. Index top-level states\n  for (const [ topLevelState, topLevelTargets ] of Object.entries(d)) {\n    if (typeof topLevelState === `undefined`) {\n      throw new TypeError(`Top-level undefined state`);\n    }\n    if (typeof topLevelTargets === `undefined`) {\n      throw new TypeError(`Undefined target state for ${ topLevelState }`);\n    }\n    if (returnMap.has(topLevelState)) {\n      throw new Error(`State defined twice: ${ topLevelState }`);\n    }\n    if (topLevelState.includes(` `)) {\n      throw new Error(`State names cannot contain spaces`);\n    }\n    returnMap.set(topLevelState, []);\n  }\n\n  // 2. Normalise target\n  for (const [ topLevelState, topLevelTargets ] of Object.entries(d)) {\n    const targets = normaliseTargets(topLevelTargets);\n    if (targets === undefined) throw new Error(`Could not normalise target`);\n    if (targets !== null) {\n      // Check that they all exist as top-level states\n      const seenStates = new Set();\n      for (const target of targets) {\n        if (seenStates.has(target.state)) {\n          throw new Error(\n            `Target state '${ target.state }' already exists for '${ topLevelState }'`\n          );\n        }\n        seenStates.add(target.state);\n        if (target.state === null) continue;\n        if (!returnMap.has(target.state)) {\n          throw new Error(\n            `Target state '${ target.state }' is not defined as a top-level state. Defined under: '${ topLevelState }'`\n          );\n        }\n      }\n      returnMap.set(topLevelState, targets);\n    }\n  }\n  return returnMap;\n};\n\n/**\n * Validates machine state, throwing an exception if not valid\n * and returning `StateTargetStrict`\n * @param state\n * @returns\n */\nconst validateMachineState = <V extends Transitions>(\n  state: MachineState<V>\n): void => {\n  if (state === undefined) {\n    throw new TypeError(`Parameter 'state' is undefined`);\n  }\n  if (typeof state.value !== `string`) {\n    throw new TypeError(`Existing state is not a string`);\n  }\n};\n\n/**\n * Attempts to transition to a new state. Either a new\n * `MachineState` is returned reflecting the change, or\n * an exception is thrown.\n * @param sm\n * @param toState\n * @returns\n */\nexport const to = <V extends Transitions>(\n  sm: MachineState<V>,\n  toState: StateNames<V>\n): MachineState<V> => {\n  validateMachineState(sm); // throws if not OK\n  validateTransition(sm, toState); // throws if not OK\n  return Object.freeze({\n    value: toState,\n    machine: sm.machine,\n    visited: unique<string>([ sm.visited as Array<string>, [ sm.value ] as Array<string> ]),\n  });\n};\n\nexport const next = <V extends Transitions>(\n  sm: MachineState<V>\n): MachineState<V> => {\n  //validateMachineState(sm);\n  const first = possibleTargets(sm).at(0);\n  // eslint-disable-next-line @typescript-eslint/prefer-optional-chain\n  if (!first || first.state === null) {\n    throw new Error(\n      `Not possible to move to a next state from '${ sm.value }`\n    );\n  }\n  return to(sm, first.state);\n};\n\n/**\n * Returns _true_ if `toState` is a valid transition from current state of `sm`\n * @param sm\n * @param toState\n * @returns\n */\nexport const isValidTransition = <V extends Transitions>(\n  sm: MachineState<V>,\n  toState: StateNames<V>\n): boolean => {\n  try {\n    validateTransition(sm, toState);\n    return true;\n  } catch {\n    return false;\n  }\n};\n\nexport const validateTransition = <V extends Transitions>(\n  sm: MachineState<V>,\n  toState: StateNames<V>\n): void => {\n  if (toState === null) throw new Error(`Cannot transition to null state`);\n  if (toState === undefined) {\n    throw new Error(`Cannot transition to undefined state`);\n  }\n  if (typeof toState !== `string`) {\n    throw new TypeError(\n      `Parameter 'toState' should be a string. Got: ${ typeof toState }`\n    );\n  }\n\n  //const toS = sm.machine[toState];\n  //if (typeof toS === 'undefined') throw new Error(`Target state '${toState}' not defined`);\n\n  const p = possible(sm);\n  if (p.length === 0) throw new Error(`Machine is in terminal state`);\n  if (!p.includes(toState)) {\n    throw new Error(\n      `Target state '${ toState }' not available at current state '${ sm.value\n      }'. Possible states: ${ p.join(`, `) }`\n    );\n  }\n};\n\n/**\n * Returns state transitions based on a list of strings.\n * The last string is the terminal state.\n *  A -> B -> C -> D\n * \n * See also: {@link fromListBidirectional}\n *\n * ```js\n * const transitions = fromList([`a`, `b`, `c`, `d`]);\n * // Object state machine with events\n * const sm = new StateMachine.WithEvents(transitions);\n * // OR, immutable state machine\n * const sm = StateMachine.init(transitions);\n * ```\n * @param states List of states\n * @return MachineDescription\n */\nexport const fromList = (...states: ReadonlyArray<string>): Transitions => {\n  const t = {};\n  if (!Array.isArray(states)) throw new Error(`Expected array of strings`);\n  if (states.length <= 2) throw new Error(`Expects at least two states`);\n  for (let index = 0; index < states.length; index++) {\n    const s = states[ index ];\n    if (typeof s !== `string`) {\n      throw new TypeError(\n        `Expected array of strings. Got type '${ typeof s }' at index ${ index }`\n      );\n    }\n    // @ts-expect-error\n    t[ s ] = index === states.length - 1 ? null : states[ index + 1 ];\n  }\n  return t;\n};\n\n/**\n * Returns a machine description based on a list of strings. Machine\n * can go back and forth between states:\n *  A <-> B <-> C <-> D\n * \n * See also {@link fromList}.\n * \n * ```js\n * const transitions = fromListBidirectional([`a`, `b`, `c`, `d`]);\n * // Object state machine with events\n * const sm = new StateMachine.WithEvents(transitions);\n * // OR, immutable state machine\n * const sm = StateMachine.init(transitions);\n * ```\n * @param states\n * @returns\n */\nexport const fromListBidirectional = (\n  ...states: ReadonlyArray<string>\n): Transitions => {\n  const t = {};\n  if (!Array.isArray(states)) throw new Error(`Expected array of strings`);\n  if (states.length < 2) throw new Error(`Expects at least two states`);\n\n  for (const [ index, s ] of states.entries()) {\n    if (typeof s !== `string`) {\n      throw new TypeError(\n        `Expected array of strings. Got type '${ typeof s }' at index ${ index }`\n      );\n    }\n\n    /** @ts-expect-error */\n    //eslint-disable-next-line functional/immutable-data\n    t[ s ] = [];\n  }\n\n  for (let index = 0; index < states.length; index++) {\n    /** @ts-expect-error */\n    const v = t[ states[ index ] ] as Array<string>;\n    if (index === states.length - 1) {\n      if (states.length > 1) {\n        //eslint-disable-next-line functional/immutable-data\n        v.push(states[ index - 1 ]);\n      } else {\n        /** @ts-expect-error */\n        //eslint-disable-next-line functional/immutable-data\n        t[ states[ index ] ] = null;\n      }\n    } else {\n      //eslint-disable-next-line functional/immutable-data\n      v.push(states[ index + 1 ]);\n      //eslint-disable-next-line functional/immutable-data\n      if (index > 0) v.push(states[ index - 1 ]);\n    }\n  }\n  return t;\n};\n\nexport { StateMachineWithEvents as WithEvents, type Opts as StateMachineWithEventsOpts, type StateMachineEventMap, type StopEvent } from './StateMachineWithEvents.js';","/* eslint-disable @typescript-eslint/array-type,@typescript-eslint/no-invalid-void-type,@typescript-eslint/prefer-for-of */\nimport { defaultComparer, type Comparer } from '../util/index.js';\nimport { shuffle } from '../data/arrays/Random.js';\n\nexport type ExpressionOrResult<ArgsType, ResultType> =\n  | ResultType\n  | ((\n    args: ArgsType | undefined\n  ) => Promise<ResultType | undefined> | ResultType | undefined | void);\n\n//eslint-disable-next-line functional/no-mixed-types\nexport type RunOpts<ResultType> = {\n  /**\n   * If provided, filters the set of results prior to returning.\n   * @param result\n   * @returns\n   */\n  readonly filter?: (result: ResultType) => boolean;\n  /**\n   * If true, execution order is shuffled each time\n   */\n  readonly shuffle?: boolean;\n  /**\n   * Function to rank results. By default uses {@link defaultComparer} which orders\n   * by numeric value or alphabetical.\n   */\n  readonly rank?: Comparer<ResultType>;\n  /**\n   * If provided, stops execution if _true_ is returned.\n   * Result(s) include most recent execution.\n   * @param latest Latest result\n   * @param sorted Sorted list of current results, not including latest\n   * @returns\n   */\n  readonly stop?: (\n    latest: ResultType | undefined,\n    sorted: readonly ResultType[]\n  ) => boolean;\n};\n\nexport type RunSingleOpts<V> = RunOpts<V> & {\n  readonly at?: number;\n};\n/**\n * Runs a series of async expressions, returning the results.\n * Use {@link runSingle} if it's only a single result you care about.\n *\n * @example Run three functions, returning the highest-ranked result.\n * ```js\n * const result = run([\n *  () => 10,\n *  () => 2,\n *  () => 3\n * ]);\n * // Yields: 10\n * ```\n *\n * Options can be passed for evaluation:\n * ```js\n * const result = run([\n *  (args) => {\n *    if (args === 'apple') return 100;\n *  },\n *  () => {\n *    return 10;\n *  }\n * ])\n * ```\n *\n * ```js\n * const expr = [\n *  (opts) => 10,\n *  (opts) => 2,\n *  (opts) => 3\n * ];\n * const opts = {\n *  rank: (a, b) => {\n *    if (a < b) return -1;\n *    if (a > b) return 1;\n *    return 0;\n *  }\n * }\n * const result = await run(expr, opts);\n * // Returns: 2\n * ```\n *\n * In terms of typing, it takes an generic arguments `ArgsType` and `ResultType`:\n * - `ArgsType`: type of expression arguments. This might be `void` if no arguments are used.\n * - `ResultType`:  return type of expression functions\n *\n * Thus the `expressions` parameter is an array of functions:\n * ```js\n * (args:ArgsType|undefined) => ResultType|undefined\n * // or\n * (args:ArgsType|undefined) => Promise<ResultType|undefined>\n * ```\n *\n * Example:\n * ```js\n * const expressions = [\n *  // Function takes a string arg\n *  (args:string) => return true; // boolean is the necessary return type\n * ];\n * const run<string,boolean>(expressions, opts, 'hello');\n * ```\n * @param expressions\n * @param opts\n * @param args\n * @returns\n */\nexport const run = async <ArgsType, ResultType>(\n  expressions: //eslint-disable-next-line functional/prefer-readonly-type\n    | ExpressionOrResult<ArgsType, ResultType>[]\n    | ExpressionOrResult<ArgsType, ResultType>\n    | readonly ExpressionOrResult<ArgsType, ResultType>[],\n  opts: RunOpts<ResultType> = {},\n  args?: ArgsType\n): Promise<ResultType[]> => {\n  const results: ResultType[] = [];\n  const compareFn = opts.rank ?? defaultComparer;\n  //eslint-disable-next-line functional/no-let\n  let expressionsArray = Array.isArray(expressions)\n    ? (expressions as ExpressionOrResult<ArgsType, ResultType>[])\n    : [ expressions as ExpressionOrResult<ArgsType, ResultType> ];\n  if (opts.shuffle) expressionsArray = shuffle(expressionsArray);\n\n  for (let i = 0; i < expressionsArray.length; i++) {\n    const exp = expressionsArray[ i ];\n    //eslint-disable-next-line functional/no-let\n    let r: ResultType;\n    if (typeof exp === 'function') {\n      // @ts-ignore\n      r = await exp(args);\n    } else {\n      r = exp;\n    }\n    if (r !== undefined) {\n      //eslint-disable-next-line functional/immutable-data\n      results.push(r);\n      //eslint-disable-next-line functional/immutable-data\n      results.sort(compareFn);\n    }\n\n    if (typeof opts.stop !== 'undefined') {\n      if (opts.stop(r, results)) {\n        break;\n      }\n    }\n  }\n\n  if (opts.filter) {\n    return results.filter(opts.filter);\n  }\n  return results;\n};\n\n/**\n * Like {@link run}, but it returns a single result or _undefined_.\n * Use the `at` option to specify which index of results to use.\n * By default it's -1, which is the presumably the highest-ranked result.\n *\n * @param expressions\n * @param opts\n * @param args\n * @returns\n */\nexport const runSingle = async <ArgsType, ResultType>(\n  expressions: readonly ExpressionOrResult<ArgsType, ResultType>[],\n  opts: RunSingleOpts<ResultType> = {},\n  args?: ArgsType\n): Promise<ResultType | undefined> => {\n  const results = await run(expressions, opts, args);\n  if (!results) return;\n  if (results.length === 0) return;\n  const at = opts.at ?? -1;\n  return results.at(at);\n};\n","import * as StateMachine from './StateMachine.js';\nimport * as Execute from './Execute.js';\nimport { type MachineState } from './StateMachine.js';\nimport { defaultComparer } from '../util/index.js';\nimport { randomElement } from '../data/arrays/Random.js';\nimport * as Logger from '../debug/Logger.js';\n\nexport type Result<V extends StateMachine.Transitions> = {\n  /**\n   * Score of this result. This is used when a state\n   * has multiple handlers returning results separately.\n   * If not defined, 0 is used.\n   */\n  readonly score?: number;\n\n  //readonly state?: StateMachine.StateNames<V>;\n  /**\n   * If specified,the state to transition to. Use\n   * _true_ to attempt to automatically advance machine.\n   * This field is 2nd priority.\n   */\n  readonly next?: StateMachine.StateNames<V> | boolean;\n  /**\n   * If true, resets the machine.\n   * This flag is 1st priority, taking precedence over the `next` field.\n   */\n  readonly reset?: boolean;\n};\n\n//eslint-disable-next-line functional/no-mixed-types\nexport type Runner<V extends StateMachine.Transitions> = {\n  readonly run: () => Promise<StateMachine.MachineState<V> | undefined>;\n  readonly getValue: () => StateMachine.StateNames<V>;\n  readonly reset: () => void;\n  readonly to: (\n    state: StateMachine.StateNames<V>\n  ) => StateMachine.MachineState<V>;\n};\n\nexport type StatesHandler<V extends StateMachine.Transitions> = {\n  readonly if:\n  | ReadonlyArray<StateMachine.StateNames<V>>\n  //eslint-disable-next-line functional/prefer-readonly-type\n  | Array<StateMachine.StateNames<V>>\n  | StateMachine.StateNames<V>;\n  readonly then: ReadonlyArray<ExpressionOrResult<V>> | ExpressionOrResult<V>;\n  /**\n   * Logic for choosing which result, if there are multiple expressions.\n   * By default 'highest' (for highest ranked result)\n   */\n  readonly resultChoice?: `first` | `highest` | `lowest` | `random`;\n};\n\n// export type Prerequisite<V extends StateMachine.Transitions> =\n//   | readonly StateMachine.StateNames<V>[]\n//   | ((\n//       potentialState: StateMachine.StateNames<V>,\n//       state: StateMachine.MachineState<V>\n//     ) => boolean);\n\n// export type StatePrerequisites<V extends StateMachine.Transitions> = {\n//   readonly states:\n//     | readonly StateMachine.StateNames<V>[]\n//     | StateMachine.StateNames<V>;\n//   readonly condition?: Prerequisite<V>;\n// };\n\nexport type DriverOpts<V extends StateMachine.Transitions> = {\n  readonly handlers: ReadonlyArray<StatesHandler<V>>;\n  //readonly prereqs?: StatePrerequisites<V>;\n  readonly debug?: Logger.LogOption;\n  /**\n   * If _true_ execution of handlers is shuffled each time\n   */\n  readonly shuffleHandlers?: boolean;\n};\n\n// async function run<V extends StateMachine.Transitions>(\n//   machine: StateMachine.Machine<V>,\n//   handlers: readonly StatesHandler<V>[]\n// );\n\nexport type ExpressionOrResult<Transitions extends StateMachine.Transitions> =\n  | Result<Transitions>\n  | ((\n    machine?: MachineState<Transitions>\n    // eslint-disable-next-line @typescript-eslint/no-invalid-void-type\n  ) => Result<Transitions> | undefined | void);\n\n/**\n * Drives a state machine.\n *\n * Defaults to selecting the highest-ranked result to determine\n * what to do next.\n * @param machine\n * @param handlersOrOpts\n * @returns\n */\n// eslint-disable-next-line @typescript-eslint/require-await\nexport async function init<V extends StateMachine.Transitions>(\n  machine: StateMachine.Machine<V> | StateMachine.Transitions,\n  handlersOrOpts: ReadonlyArray<StatesHandler<V>> | DriverOpts<V>\n): Promise<Runner<V>> {\n  const opts: DriverOpts<V> = Array.isArray(handlersOrOpts)\n    ? {\n      handlers: handlersOrOpts as ReadonlyArray<StatesHandler<V>>,\n    }\n    : (handlersOrOpts as DriverOpts<V>);\n\n  const debug = Logger.resolveLogOption(opts.debug, {\n    category: `StateMachineDriver`,\n  });\n\n  // Index handlers by state, making sure there are not multiple\n  // handlers for a given state.\n  const byState = new Map<string, StatesHandler<V>>();\n  for (const h of opts.handlers) {\n    const ifBlock = Array.isArray(h.if) ? h.if : [ h.if ];\n    for (const state of ifBlock) {\n      if (typeof state !== `string`) {\n        throw new TypeError(\n          `Expected single or array of strings for the 'if' field. Got: '${ typeof state }'.`\n        );\n      }\n\n      if (byState.has(state)) {\n        throw new Error(\n          `Multiple handlers defined for state '${ state\n          }'. There should be at most one.`\n        );\n      }\n      byState.set(state, h);\n    }\n  }\n\n  // const expressions: Expression<V>[] = [\n  //   (_machine) => {\n  //     const r: Result<V> = {\n  //       next: 'hello',\n  //     };\n  //     return r;\n  //   },\n  // ];\n\n  const runOpts: Execute.RunOpts<Result<V>> = {\n    // Rank results by score\n    rank: (a, b) => {\n      return defaultComparer(a.score ?? 0, b.score ?? 0);\n    },\n    shuffle: opts.shuffleHandlers ?? false,\n  };\n\n  //eslint-disable-next-line functional/no-let\n  let sm = StateMachine.init(machine);\n\n  // Check that all 'if' states are actually defined on machine\n  for (const [ ifState ] of byState) {\n    // Check if state is defined\n    if (\n      typeof sm.machine[ ifState ] === `undefined` &&\n      ifState !== `__fallback`\n    ) {\n      throw new Error(\n        `StateMachineDriver handler references a state ('${ ifState }') which is not defined on the machine. Therefore this handler will never run.'`\n      );\n    }\n  }\n\n  const run = async (): Promise<StateMachine.MachineState<V> | undefined> => {\n    debug(`Run. State: ${ sm.value }`);\n    const state = sm.value;\n    //eslint-disable-next-line functional/no-let\n    let handler = byState.get(state);\n    if (handler === undefined) {\n      debug(`  No handler for state '${ state }', trying __fallback`);\n\n      // Is there a fallback?\n      handler = byState.get(`__fallback`);\n    }\n    if (handler === undefined) {\n      debug(`  No __fallback handler`);\n      return;\n    }\n\n    // If the `first` option is given, stop executing fns as soon as we get\n    // a valid result.\n    const runOptionsForHandler =\n      handler.resultChoice === `first`\n        ? {\n          ...runOpts,\n          stop: (latest: Result<V> | undefined) => {\n            if (!latest) return false;\n            if (`reset` in latest) return true;\n            if (`next` in latest && latest.next !== undefined) return true;\n            return false;\n          },\n        }\n        : runOpts;\n\n    const results = await Execute.run<MachineState<V>, Result<V>>(\n      handler.then,\n      runOptionsForHandler,\n      sm\n    );\n    debug(\n      `  In state '${ sm.value }' results: ${ results.length }. Choice: ${ handler.resultChoice\n      }`\n    );\n\n    // Apply selection logic\n    //eslint-disable-next-line functional/no-let\n    let r: Result<V> | undefined;\n    switch (handler.resultChoice ?? `highest`) {\n      case `highest`: {\n        r = results.at(-1);\n        break;\n      }\n      case `first`: {\n        r = results[ 0 ]; // Since we break on the first result\n        break;\n      }\n      case `lowest`: {\n        r = results.at(0);\n        break;\n      }\n      case `random`: {\n        r = randomElement(results);\n        break;\n      }\n      default: {\n        throw new Error(\n          `Unknown 'resultChoice' option: ${ handler.resultChoice }. Expected highest, first, lowest or random`\n        );\n      }\n    }\n\n    debug(`  Chosen result: ${ JSON.stringify(r) }`);\n    // Apply result\n    if (r?.reset) {\n      sm = StateMachine.reset(sm);\n    } else if (r && r.next) {\n      if (typeof r.next === `boolean`) {\n        sm = StateMachine.next(sm);\n      } else {\n        debug(JSON.stringify(results));\n        sm = StateMachine.to(sm, r.next);\n      }\n    }\n    return sm;\n  };\n\n  return {\n    reset: () => {\n      sm = StateMachine.reset(sm);\n    },\n    getValue: () => sm.value,\n    run,\n    to: (state: StateMachine.StateNames<V>) => {\n      sm = StateMachine.to(sm, state);\n      return sm;\n    },\n  };\n}\n","import { intervalToMs, type Interval } from './IntervalType.js';\nimport { elapsedMillisecondsAbsolute, relative } from './Timer.js';\n\nexport type Since = () => number;\n\n/**\n * Returns elapsed time since the initial call.\n * ```js\n * // Record start\n * const elapsed = Stopwatch.since();\n *\n * // Get elapsed time in millis\n * // since Elapsed.since()\n * elapsed(); // Yields number\n * ```\n *\n * If you want to initialise a stopwatch, but not yet start it, consider:\n * ```js\n * // Init\n * let state = {\n *  clicked: Stopwatch.infinity()\n * };\n *\n * state.click(); // Returns a giant value\n *\n * // Later, when click happens:\n * state = { click: Stopwatch.since() }\n * ```\n *\n * See also:\n * * {@link once} if you want to measure a single period, and stop it.\n * * {@link interval} time _between_ calls\n * @returns\n */\nexport const since = (): Since => {\n  const start = performance.now();\n  return (): number => {\n    return performance.now() - start;\n  };\n};\n\n/**\n * Returns the interval between the start and each subsequent call.\n * \n * ```js\n * const interval = Stopwatch.interval();\n * interval(); // Time from Stopwatch.interval()\n * interval(); // Time since last interval() call\n * ```\n * \n * See also:\n * * {@link since}: time since first call\n * * {@link once}: time between two events\n * @returns \n */\nexport const interval = (): Since => {\n  let start = performance.now();\n  return (): number => {\n    const now = performance.now();\n    const x = now - start;\n    start = now;\n    return x;\n  }\n}\n/**\n * Returns elapsed time since initial call, however\n * unlike {@link since}, timer stops when first invoked.\n *\n * ```js\n * const elapsed = Stopwatch.once();\n * // ...do stuff\n * elapsed(); // Yields time since Stopwatch.once() was called\n * // ...do more stuff\n * elapsed(); // Is still the same number as above\n * ```\n * \n * See also:\n * * {@link since}: elapsed time\n * * {@link interval}: time _between_ calls\n * @returns\n */\nexport const once = (): Since => {\n  const start = Date.now();\n  //eslint-disable-next-line functional/no-let\n  let stoppedAt = 0;\n  return (): number => {\n    if (stoppedAt === 0) {\n      stoppedAt = Date.now() - start;\n    }\n    return stoppedAt;\n  };\n};\n/**\n * Returns a function that reports an 'infinite' elapsed time.\n * this can be useful as an initialiser for `Stopwatch.since` et al.\n *\n * ```js\n * // Init clicked to be an infinite time\n * let clicked = Stopwatch.infinity();\n *\n * document.addEventListener('click', () => {\n *  // Now that click has happened, we can assign it properly\n *  clicked = Stopwatch.since();\n * });\n * ```\n * @returns\n */\nexport const infinity = (): Since => {\n  return (): number => {\n    return Number.POSITIVE_INFINITY;\n  };\n};\n\n","import { SimpleEventEmitter } from '../Events.js';\nimport * as StateMachine from './StateMachine.js';\nimport * as Elapsed from './Stopwatch.js';\nimport type { StateNames, Transitions, MachineState } from './StateMachine.js';\n\nexport type StateChangeEvent<V extends Transitions> = {\n  readonly newState: StateNames<V>;\n  readonly priorState: StateNames<V>;\n};\n\nexport type StopEvent<V extends Transitions> = {\n  readonly state: StateNames<V>;\n};\n\nexport type StateMachineEventMap<V extends Transitions> = {\n  readonly change: StateChangeEvent<V>;\n  readonly stop: StopEvent<V>;\n};\n\nexport type Opts<V extends Transitions> = {\n  readonly debug?: boolean;\n  readonly initial?: StateNames<V>;\n};\n\n/**\n * A state machine that fires events when state changes.\n * \n * ```js\n * const transitions = StateMachine.fromList(`a`, `b`, `c`);\n * const m = new StateMachineWithEvents(transitions);\n * m.addEventListener(`change`, event => {\n *  console.log(`${event.priorState} -> ${event.newState}`);\n * });\n * m.addEventListener(`stop`, event => {\n *  console.log(`State machine has reached final state`);\n * });\n * ```\n */\nexport class StateMachineWithEvents<\n  V extends Transitions,\n> extends SimpleEventEmitter<StateMachineEventMap<V>> {\n  #sm: MachineState<V>;\n  #smInitial: MachineState<V>;\n\n  #debug: boolean;\n  #isDoneNeedsFiring = false;\n  #isDone = false;\n  #changedAt = Elapsed.infinity();\n\n  /**\n   * Create a state machine with initial state, description and options\n   * @param m Machine description\n   * @param opts Options for machine (defaults to `{debug:false}`)\n   */\n  constructor(m: V, opts: Opts<V> = {}) {\n    super();\n\n    this.#debug = opts.debug ?? false;\n    this.#sm = StateMachine.init(m, opts.initial);\n    this.#smInitial = StateMachine.cloneState(this.#sm);\n  }\n\n\n\n  #setIsDone(v: boolean) {\n    if (this.#isDone === v) return;\n    this.#isDone = v;\n    if (v) {\n      this.#isDoneNeedsFiring = true;\n      setTimeout(() => {\n        if (!this.#isDoneNeedsFiring) return;\n        this.#isDoneNeedsFiring = false;\n        //console.log(`StateMachine isDone (${this.#state}), firing stop.`);\n        this.fireEvent(`stop`, { state: this.#sm.value });\n      }, 2);\n    } else {\n      this.#isDoneNeedsFiring = false;\n    }\n  }\n\n  /**\n   * Return a list of possible states from current state.\n   *\n   * If list is empty, no states are possible. Otherwise lists\n   * possible states, including 'null' for terminal\n   */\n  get statesPossible(): ReadonlyArray<StateNames<V> | null> {\n    return StateMachine.possible(this.#sm);\n  }\n\n  /**\n   * Return a list of all defined states\n   */\n  get statesDefined(): ReadonlyArray<StateNames<V>> {\n    return Object.keys(this.#sm.machine);\n  }\n\n  /**\n   * Moves to the next state if possible. If multiple states are possible, it will use the first.\n   * If machine is finalised, no error is thrown and null is returned.\n   *\n   * @returns {(string|null)} Returns new state, or null if machine is finalised\n   */\n  next(): string | null {\n    const p = StateMachine.possible(this.#sm);\n    if (p.length === 0) return null;\n    this.state = p[ 0 ]!;\n    return p[ 0 ]!;\n  }\n\n  /**\n   * Returns _true_ if state machine is in its final state\n   *\n   * @returns\n   */\n  get isDone(): boolean {\n    return StateMachine.isDone(this.#sm);\n  }\n\n  /**\n   * Resets machine to initial state\n   */\n  reset() {\n    this.#setIsDone(false);\n    this.#sm = StateMachine.cloneState(this.#smInitial);\n\n    //eslint-disable-next-line functional/immutable-data\n    this.#changedAt = Elapsed.since();\n  }\n\n  /**\n   * Throws if it's not valid to transition to `newState`\n   * @param newState\n   * @returns\n   */\n  validateTransition(newState: StateNames<V>): void {\n    StateMachine.validateTransition(this.#sm, newState);\n  }\n\n  /**\n   * Returns _true_ if `newState` is valid transition from current state.\n   * Use {@link validateTransition} if you want an explanation for the _false_ results.\n   * @param newState\n   * @returns\n   */\n  isValid(newState: StateNames<V>): boolean {\n    return StateMachine.isValidTransition(this.#sm, newState);\n  }\n\n  /**\n   * Gets or sets state. Throws an error if an invalid transition is attempted.\n   * Use `isValid()` to check validity without changing.\n   *\n   * If `newState` is the same as current state, the request is ignored silently.\n   */\n  set state(newState: StateNames<V>) {\n    const priorState = this.#sm.value;\n    if (newState === this.#sm.value) return;\n\n    // Try to change state\n    this.#sm = StateMachine.to(this.#sm, newState);\n    if (this.#debug) {\n      console.log(`StateMachine: ${ priorState } -> ${ newState }`);\n    }\n    this.#changedAt = Elapsed.since();\n    setTimeout(() => {\n      this.fireEvent(`change`, { newState: newState, priorState: priorState });\n    }, 1);\n\n    if (StateMachine.isDone(this.#sm)) this.#setIsDone(true);\n  }\n\n  get state(): string {\n    return this.#sm.value;\n  }\n\n  /**\n   * Returns timestamp when state was last changed.\n   * See also `elapsed`\n   */\n  get changedAt(): number {\n    return this.#changedAt();\n  }\n\n  /**\n   * Returns milliseconds elapsed since last state change.\n   * See also `changedAt`\n   */\n  get elapsed(): number {\n    return this.#changedAt();\n  }\n}\n","import { throwIntegerTest, integerTest } from '../util/GuardNumbers.js';\nimport { type HasCompletion, type HasCompletionRunStates } from './Types.js';\n\nimport { intervalToMs, type Interval } from './IntervalType.js';\n\nexport type TimeoutSyncCallback = (\n  elapsedMs?: number,\n  ...args: ReadonlyArray<unknown>\n) => void;\nexport type TimeoutAsyncCallback = (\n  elapsedMs?: number,\n  ...args: ReadonlyArray<unknown>\n) => Promise<void>;\n\n/**\n * A resettable timeout, returned by {@link timeout}\n */\nexport type Timeout = HasCompletion & {\n  /**\n   * Starts the timer.\n   * If the timer has already been started and has a scheduled execution, this is cancelled \n   * and re-scheduled.\n   * @param altTimeoutMs Optional override for the interval. Use _undefined_ to use the original interval\n   * @param args \n   */\n  start(altTimeoutMs?: number, args?: ReadonlyArray<unknown>): void;\n  /**\n   * Cancels the timer, aborting any scheduled execution.\n   */\n  cancel(): void;\n};\n\n/**\n * Returns a {@link Timeout} that can be triggered, cancelled and reset. Use {@link continuously} for interval-\n * based loops.\n *\n * Once `start()` is called, `callback` will be scheduled to execute after `interval`.\n * If `start()` is called again, the waiting period will be reset to `interval`.\n *\n * @example Essential functionality\n * ```js\n * const fn = () => {\n *  console.log(`Executed`);\n * };\n * const t = timeout(fn, 60*1000);\n * t.start();   // After 1 minute `fn` will run, printing to the console\n * ```\n *\n * @example Control execution functionality\n * ```\n * t.cancel();  // Cancel it from running\n * t.start();   // Schedule again after 1 minute\n * t.start(30*1000); // Cancel that, and now scheduled after 30s\n * \n * // Get the current state of timeout\n * t.runState;    // \"idle\", \"scheduled\" or \"running\"\n * ```\n *\n * Callback function receives any additional parameters passed in from start. This can be useful for passing through event data:\n *\n * @example\n * ```js\n * const t = timeout( (elapsedMs, ...args) => {\n *  // args contains event data\n * }, 1000);\n * el.addEventListener(`click`, t.start);\n * ```\n *\n * Asynchronous callbacks can be used as well:\n * ```js\n * timeout(async () => {...}, 100);\n * ```\n *\n * If you don't expect to need to control the timeout, consider using {@link delay},\n * which can run a given function after a specified delay.\n * @param callback\n * @param interval\n * @returns {@link Timeout}\n */\nexport const timeout = (\n  callback: TimeoutSyncCallback | TimeoutAsyncCallback,\n  interval: Interval\n): Timeout => {\n  if (callback === undefined) {\n    throw new Error(`callback parameter is undefined`);\n  }\n  const intervalMs = intervalToMs(interval);\n  throwIntegerTest(intervalMs, `aboveZero`, `interval`);\n\n  let timer: ReturnType<typeof setTimeout>;\n  let startedAt = 0;\n  let startCount = 0;\n  let startCountTotal = 0;\n  let state: HasCompletionRunStates = `idle`;\n\n  const clear = () => {\n    startedAt = 0;\n    globalThis.clearTimeout(timer);\n    state = `idle`;\n  }\n\n  const start = async (\n    altInterval: Interval = interval,\n    args: Array<unknown>\n  ): Promise<void> => {\n    const p = new Promise<void>((resolve, reject) => {\n      startedAt = performance.now();\n      const altTimeoutMs = intervalToMs(altInterval);\n      const it = integerTest(altTimeoutMs, `aboveZero`, `altTimeoutMs`);\n      if (!it[ 0 ]) {\n        reject(new Error(it[ 1 ]));\n        return;\n      }\n\n      switch (state) {\n        case `scheduled`: {\n          // Cancel other scheduled execution\n          cancel();\n          break;\n        }\n        case `running`: {\n          //console.warn(`Timeout being rescheduled while task is already running`);\n          break;\n        }\n      }\n      state = `scheduled`;\n\n      // eslint-disable-next-line @typescript-eslint/no-misused-promises\n      timer = globalThis.setTimeout(async () => {\n        if (state !== `scheduled`) {\n          console.warn(`Timeout skipping execution since state is not 'scheduled'`);\n          clear();\n          return;\n        }\n        const args_ = args ?? [];\n        startCount++;\n        startCountTotal++;\n        state = `running`;\n        await callback(performance.now() - startedAt, ...args_);\n        state = `idle`\n        clear();\n        resolve();\n      }, altTimeoutMs);\n    });\n    return p;\n  };\n\n  const cancel = () => {\n    if (state === `idle`) return;\n    clear();\n  };\n\n  return {\n    // eslint-disable-next-line @typescript-eslint/no-misused-promises\n    start,\n    cancel,\n    get runState() {\n      return state;\n    },\n    get startCount() {\n      return startCount;\n    },\n    get startCountTotal() {\n      return startCountTotal;\n    }\n  };\n};\n\n\n// const average = movingAverageLight();\n// const rm = rateMinimum({\n//   interval: { secs: 1 },\n//   whatToCall: (distance: number) => {\n//     average(distance);\n//   },\n//   fallback() {\n//     return 0;\n//   }\n// })\n// document.addEventListener(`pointermove`, event => {\n//   rm(event.movementX + event.movementY);\n// });","import type { Interval } from \"./IntervalType.js\";\nimport { timeout } from \"./Timeout.js\";\n\n\nexport type RateMinimumOptions<TInput> = Readonly<{\n  whatToCall: (args: TInput) => void\n  fallback: () => TInput\n  interval: Interval\n  abort?: AbortSignal\n}>;\n\n/**\n * Ensures that `whatToCall` is executed with a given tempo.\n * \n * ```js\n * const rm = rateMinimum({\n *  fallback: () => {\n *    return Math.random();\n *  },\n *  whatToCall: (value:number) => {\n *    console.log(value);\n *  },\n *  interval: { secs: 10 }\n * });\n * \n * // Invokes `whatToCall`, resetting timeout\n * rm(10);\n * \n * // If we don't call rm() before 'interval' has elapsed,\n * // 'fallback' will be invoked\n * ``` \n * \n * A practical use for this is to update calculations based on firing of events\n * as well as when they don't fire. For example user input.\n * \n * ```js\n * // Average distances\n * const average = movingAverageLight();\n * const rm = rateMinimum({\n *  interval: { secs: 1 },\n *  whatToCall: (distance: number) => {\n *    average(distance);\n *  },\n *  // If there are no pointermove events, distance is 0\n *  fallback() {\n *    return 0;\n *  }\n * })\n * \n * // Report total movemeent\n * document.addEventListener(`pointermove`, event => {\n *  rm(event.movementX + event.movementY);\n * });\n * ```\n * \n * @param options \n * @returns \n */\nexport const rateMinimum = <TInput>(options: RateMinimumOptions<TInput>) => {\n  let disposed = false;\n\n  const t = timeout(() => {\n    if (disposed) return;\n    t.start();\n    options.whatToCall(options.fallback());\n  }, options.interval);\n\n\n  if (options.abort) {\n    options.abort.addEventListener(`abort`, _ => {\n      disposed = true;\n      t.cancel();\n    });\n  }\n  t.start();\n\n  return (args: TInput) => {\n    if (disposed) throw new Error(`AbortSignal has been fired`);\n    t.start();\n    options.whatToCall(args);\n  }\n}","import type { QueueOpts } from './QueueTypes.js';\n\nexport const debug = (opts: QueueOpts<any>, message: string): void => {\n  opts.debug ? console.log(`queue:${ message }`) : undefined;\n};\n\nexport const trimQueue = <V>(\n  opts: QueueOpts<V>,\n  queue: ReadonlyArray<V>,\n  toAdd: ReadonlyArray<V>\n): ReadonlyArray<V> => {\n  const potentialLength = queue.length + toAdd.length;\n  const capacity = opts.capacity ?? potentialLength;\n  const toRemove = potentialLength - capacity;\n  const policy = opts.discardPolicy ?? `additions`;\n  // debug(\n  //   opts,\n  //   `queueLen: ${queue.length} potentialLen: ${potentialLength} toRemove: ${toRemove} policy: ${policy} toAdd.length: ${toAdd.length} capacity: ${capacity}`\n  // );\n  // debug(opts, `to add: ${JSON.stringify(toAdd)}`);\n\n  switch (policy) {\n    // Only add what we can from toAdd\n    case `additions`: {\n      // debug(\n      //   opts,\n      //   `trimQueue:DiscardAdditions: queueLen: ${queue.length} slice: ${\n      //     potentialLength - capacity\n      //   } toAddLen: ${toAdd.length} nowFull: ${queue.length === opts.capacity}`\n      // );\n      if (queue.length === 0) return toAdd.slice(0, toAdd.length - toRemove);\n      // eslint-disable-next-line unicorn/prefer-ternary\n      if (queue.length === opts.capacity) {\n        return queue; // Completely full\n      } else {\n        // Only add some from the new array (from the front)\n        return [ ...queue, ...toAdd.slice(0, toRemove - 1) ];\n      }\n    }\n    // Remove from rear of queue (last index) before adding new things\n    case `newer`: {\n      if (toRemove >= queue.length) {\n        // New items will completely flush out old\n        //debug(opts, `slice start: ${toAdd.length - capacity}`);\n        if (queue.length === 0) {\n          // Special case when queue starts off empty\n          // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n          return [ ...toAdd.slice(0, capacity - 1), toAdd.at(-1)! ];\n        }\n        return toAdd.slice(\n          Math.max(0, toAdd.length - capacity),\n          Math.min(toAdd.length, capacity) + 1\n        );\n        //debug(opts, `Final value: ${JSON.stringify(tmp)}`);\n        //return tmp;\n      } else {\n        // Keep some of the old\n        // const toAddFinal = toAdd.slice(\n        //   0,\n        //   Math.min(toAdd.length, capacity - toRemove + 1)\n        // );\n        // Cap 5, queue 5, toAdd: 10.\n        const countToAdd = Math.max(1, toAdd.length - queue.length);\n        const toAddFinal = toAdd.slice(toAdd.length - countToAdd, toAdd.length);\n        const toKeep = queue.slice(0, Math.min(queue.length, capacity - 1)); //toRemove);\n        // debug(\n        //   opts,\n        //   `trimQueue: countToAdd: ${countToAdd} qLen: ${\n        //     queue.length\n        //   } capacity: ${capacity} toRemove: ${toRemove} keeping: ${JSON.stringify(\n        //     toKeep\n        //   )} from orig: ${JSON.stringify(queue)} toAddFinal: ${JSON.stringify(\n        //     toAddFinal\n        //   )}`\n        // );\n        const t = [ ...toKeep, ...toAddFinal ];\n        //debug(opts, `final: ${JSON.stringify(t)}`);\n        return t;\n      }\n    }\n    // Remove from the front of the queue (0 index). ie. older items are discarded\n    case `older`: {\n      // If queue is A, B and toAdd is C, D this yields A, B, C, D\n      return [ ...queue, ...toAdd ].slice(toRemove);\n    }\n    default: {\n      // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n      throw new Error(`Unknown overflow policy ${ policy }`);\n    }\n  }\n};\n\n/**\n * Adds to the back of the queue (last array index)\n * Last item of `toAdd` will potentially be the new end of the queue (depending on capacity limit and overflow policy)\n * @typeParam V - Type of values\n * @param {QueueOpts} opts\n * @param {V[]} queue\n * @param {...V[]} toAdd\n * @returns {V[]}\n */\nexport const enqueue = <V>(\n  opts: QueueOpts<V>,\n  queue: ReadonlyArray<V>,\n  ...toAdd: ReadonlyArray<V>\n): ReadonlyArray<V> => {\n  if (opts === undefined) throw new Error(`opts parameter undefined`);\n\n  const potentialLength = queue.length + toAdd.length;\n  const overSize = opts.capacity && potentialLength > opts.capacity;\n\n  const toReturn = overSize\n    ? trimQueue(opts, queue, toAdd)\n    : [ ...queue, ...toAdd ];\n  if (opts.capacity && toReturn.length !== opts.capacity && overSize) {\n    throw new Error(\n      `Bug! Expected return to be at capacity. Return len: ${ toReturn.length\n      } capacity: ${ opts.capacity } opts: ${ JSON.stringify(opts) }`\n    );\n  }\n  if (!opts.capacity && toReturn.length !== potentialLength) {\n    throw new Error(\n      `Bug! Return length not expected. Return len: ${ toReturn.length\n      } expected: ${ potentialLength } opts: ${ JSON.stringify(opts) }`\n    );\n  }\n  return toReturn;\n};\n\n// Remove from front of queue (0 index)\nexport const dequeue = <V>(\n  opts: QueueOpts<V>,\n  queue: ReadonlyArray<V>\n): ReadonlyArray<V> => {\n  if (queue.length === 0) throw new Error(`Queue is empty`);\n  return queue.slice(1);\n};\n\n/**\n * Returns front of queue (oldest item), or undefined if queue is empty\n *\n * @typeParam V - Type of values stored\n * @param {QueueOpts} opts\n * @param {V[]} queue\n * @returns {(V | undefined)}\n */\nexport const peek = <V>(\n  opts: QueueOpts<V>,\n  queue: ReadonlyArray<V>\n): V | undefined => queue[ 0 ];\n\nexport const isEmpty = <V>(opts: QueueOpts<V>, queue: ReadonlyArray<V>): boolean =>\n  queue.length === 0;\n\nexport const isFull = <V>(\n  opts: QueueOpts<V>,\n  queue: ReadonlyArray<V>\n): boolean => {\n  if (opts.capacity) {\n    return queue.length >= opts.capacity;\n  }\n  return false;\n};\n","import { type IQueueMutable, type IQueueMutableWithEvents, type QueueMutableEvents } from './IQueueMutable.js';\nimport { enqueue, peek, dequeue, isEmpty, isFull } from './QueueFns.js';\nimport { type QueueOpts } from './QueueTypes.js';\nimport { isEqualDefault, type IsEqual } from '../../util/IsEqual.js';\nimport { SimpleEventEmitter } from '../../Events.js';\n\n/**\n * Mutable queue that fires events when manipulated.\n * \n * Queues are useful if you want to treat 'older' or 'newer'\n * items differently. _Enqueing_ adds items at the back of the queue, while\n * _dequeing_ removes items from the front (ie. the oldest).\n *\n * ```js\n * const q = Queues.mutable();       // Create\n * q.enqueue(`a`, `b`);     // Add two strings\n * const front = q.dequeue();  // `a` is at the front of queue (oldest)\n * ```\n *\n * @example Cap size to 5 items, throwing away newest items already in queue.\n * ```js\n * const q = Queues.mutable({capacity: 5, discardPolicy: `newer`});\n * ```\n *\n * Events can be used to monitor data flows.\n * * 'enqueue': fires when item(s) are added\n * * 'dequeue': fires when an item is dequeued from front\n * * 'removed': fires when an item is dequeued, queue is cleared or .removeWhere is used to trim queue\n * \n * Each of the event handlers return the state of the queue as the 'finalData'\n * field.\n * \n * ```js\n * q.addEventListener(`enqueue`, e => {\n *  // e.added, e.finalData\n * });\n * q.addEventListener(`removed`, e => {\n *  // e.removed, e.finalData\n * });\n * q.addEventListener(`dequeue`, e=> {\n *  // e.removed, e.finalData\n * })\n * ```\n * @typeParam V - Data type of items\n */\nexport class QueueMutable<V> extends SimpleEventEmitter<QueueMutableEvents<V>> implements IQueueMutable<V> {\n  readonly options: QueueOpts<V>;\n  data: ReadonlyArray<V>;\n  eq: IsEqual<V>;\n\n  constructor(opts: QueueOpts<V> = {}, data: ReadonlyArray<V> = []) {\n    super();\n    if (opts === undefined) throw new Error(`opts parameter undefined`);\n    this.options = opts;\n    this.data = data;\n    this.eq = opts.eq ?? isEqualDefault;\n  }\n\n  clear() {\n    const copy = [ ...this.data ];\n    this.data = [];\n    this.fireEvent(`removed`, { finalData: this.data, removed: copy });\n    this.onClear();\n  }\n\n  /**\n   * Called when all data is cleared\n   */\n  protected onClear() { /** no-op */\n  }\n\n  at(index: number): V {\n    if (index >= this.data.length) throw new Error(`Index outside bounds of queue`);\n    const v = this.data.at(index);\n    if (v === undefined) throw new Error(`Index appears to be outside range of queue`);\n    return v;\n  }\n\n  enqueue(...toAdd: ReadonlyArray<V>): number {\n    this.data = enqueue(this.options, this.data, ...toAdd);\n    const length = this.data.length;\n    this.onEnqueue(this.data, toAdd);\n    return length;\n  }\n\n  protected onEnqueue(result: ReadonlyArray<V>, attemptedToAdd: ReadonlyArray<V>) {\n    this.fireEvent(`enqueue`, { added: attemptedToAdd, finalData: result });\n  }\n\n  dequeue(): V | undefined {\n    const v = peek(this.options, this.data);\n    if (v === undefined) return;\n    /* eslint-disable-next-line functional/immutable-data */\n    this.data = dequeue(this.options, this.data);\n    this.fireEvent(`dequeue`, { removed: v, finalData: this.data });\n    this.onRemoved([ v ], this.data);\n    return v;\n  }\n\n  protected onRemoved(removed: ReadonlyArray<V>, finalData: ReadonlyArray<V>) {\n    this.fireEvent(`removed`, { removed, finalData });\n  }\n\n  /**\n   * Removes values that match `predicate`.\n   * @param predicate \n   * @returns Returns number of items removed.\n   */\n  removeWhere(predicate: (item: V) => boolean): number {\n    const countPre = this.data.length;\n    const toRemove = this.data.filter(v => predicate(v));\n    if (toRemove.length === 0) return 0;\n    this.data = this.data.filter((element) => !predicate(element));\n    this.onRemoved(toRemove, this.data);\n    return countPre - this.data.length;\n  }\n\n  /**\n * Return a copy of the array\n * @returns \n */\n  toArray(): Array<V> {\n    return [ ...this.data ];\n  }\n\n  get isEmpty(): boolean {\n    return isEmpty(this.options, this.data);\n  }\n\n  get isFull(): boolean {\n    return isFull(this.options, this.data);\n  }\n\n  get length(): number {\n    return this.data.length;\n  }\n\n  get peek(): V | undefined {\n    return peek(this.options, this.data);\n  }\n}\n\n/**\n * Creates a new QueueMutable\n * @param options \n * @param startingItems \n * @returns \n */\nexport function mutable<V>(\n  options: QueueOpts<V> = {},\n  ...startingItems: ReadonlyArray<V>\n): IQueueMutableWithEvents<V> {\n  return new QueueMutable({ ...options }, [ ...startingItems ]);\n}\n\n","/**\n * Clamps a value between min and max (both inclusive)\n * Defaults to a 0-1 range, useful for percentages.\n *\n * @example Usage\n * ```js\n * // 0.5 - just fine, within default of 0 to 1\n * clamp(0.5);\n * // 1 - above default max of 1\n * clamp(1.5);\n * // 0 - below range\n * clamp(-50, 0, 100);\n * // 50 - within range\n * clamp(50, 0, 50);\n * ```\n *\n * For clamping integer ranges, consider {@link clampIndex }\n * For clamping `{ x, y }` points, consider {@link Geometry.Points.clamp | Geometry.Points.clamp}.\n * For clamping bipolar values: {@link Bipolar.clamp}\n * @param value Value to clamp\n * @param min value (inclusive)\n * @param max value (inclusive)\n * @returns Clamped value\n */\nexport const clamp = (value: number, min = 0, max = 1) => {\n  // ✔ UNIT TESTED\n  if (Number.isNaN(value)) throw new Error(`'value' parameter is NaN`);\n  if (Number.isNaN(min)) throw new Error(`'min' parameter is NaN`);\n  if (Number.isNaN(max)) throw new Error(`'max' parameter is NaN`);\n\n  if (value < min) return min;\n  if (value > max) return max;\n  return value;\n};\n\n/**\n * Clamps integer `v` between 0 (inclusive) and array length or length (exclusive).\n * Returns value then will always be at least zero, and a valid array index.\n *\n * @example Usage\n * ```js\n * // Array of length 4\n * const myArray = [`a`, `b`, `c`, `d`];\n * clampIndex(0, myArray);    // 0\n * clampIndex(4, myArray);    // 3\n * clampIndex(-1, myArray);   // 0\n *\n * clampIndex(5, 3); // 2\n * ```\n *\n * Throws an error if `v` is not an integer.\n *\n * For some data it makes sense that data might 'wrap around' if it exceeds the\n * range. For example rotation angle. Consider using {@link wrap} for this.\n *\n * @param v Value to clamp (must be an interger)\n * @param arrayOrLength Array, or length of bounds (must be an integer)\n * @returns Clamped value, minimum will be 0, maximum will be one less than `length`.\n */\n//eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport const clampIndex = (\n  v: number,\n  arrayOrLength: number | ReadonlyArray<any>\n): number => {\n  // ✔ UNIT TESTED\n  if (!Number.isInteger(v)) {\n    throw new TypeError(`v parameter must be an integer (${ v })`);\n  }\n  const length = Array.isArray(arrayOrLength)\n    ? arrayOrLength.length\n    : (arrayOrLength as number);\n\n  if (!Number.isInteger(length)) {\n    throw new TypeError(\n      `length parameter must be an integer (${ length }, ${ typeof length })`\n    );\n  }\n  v = Math.round(v);\n  if (v < 0) return 0;\n  if (v >= length) return length - 1;\n  return v;\n};\n","import { clamp } from '../numbers/Clamp.js';\nimport { intervalToMs, type Interval } from './IntervalType.js';\nimport type { HasCompletion } from './Types.js';\n\n/**\n * Creates a timer\n */\nexport type TimerSource = () => Timer;\n\n/**\n * A timer instance.\n * {@link CompletionTimer} also contains an 'isDone' field.\n * \n * Implementations: {@link elapsedMillisecondsAbsolute}, {@link elapsedTicksAbsolute}, {@link frequencyTimer}\n */\nexport type Timer = {\n  reset(): void\n  get elapsed(): number\n};\n\n/**\n * A {@link Timer} that has a sense of completion, when `isDone` returns _true_.\n * See {@link relative}\n */\nexport type CompletionTimer = Timer & {\n  /**\n   * Returns _true_ if this timer has completed.\n   */\n  get isDone(): boolean\n}\n\nexport type ModulationTimer = CompletionTimer & {\n  mod(amt: number): void;\n};\n\nexport type TimerOpts = {\n  /**\n   * Timer to use. By default {@link elapsedMillisecondsAbsolute}.\n   */\n  readonly timer: Timer;\n};\n\n/**\n * Options for relative timer\n */\nexport type RelativeTimerOpts = TimerOpts & {\n  /**\n   * If true, returned value will be clamped to 0..1. False by default\n   */\n  readonly clampValue: boolean\n  readonly wrapValue: boolean\n};\n\n/**\n * A function that returns _true_ when an interval has elapsed\n *\n * ```js\n * import { hasElapsed } from \"https://unpkg.com/ixfx/dist/flow.js\"\n * const oneSecond = hasElapsed(1000);\n * \n * // Keep calling to check if time has elapsed.\n * // Will return _true_ when it has\n * oneSecond();\n * ```\n * \n * @param elapsed\n * @returns\n */\nexport function hasElapsed(elapsed: Interval): () => boolean {\n  const t = relative(intervalToMs(elapsed, 0), { timer: elapsedMillisecondsAbsolute(), clampValue: true });\n  return () => t.isDone;\n}\n\n// export const frequencyTimerSource =\n//   (frequency: number): TimerSource =>\n//     () =>\n//       frequencyTimer(frequency, { timer: elapsedMillisecondsAbsolute() });\n\n/**\n * Returns a function that returns the percentage of timer completion.\n * Starts when return function is first invoked.\n *\n * ```js\n * import * as Flow from \"https://unpkg.com/ixfx/dist/flow.js\"\n * const timer = Flow.ofTotal(1000);\n * \n * // Call timer() to find out the completion\n * timer(); // Returns 0..1\n * ```\n *\n * Note that timer can exceed 1 (100%). To cap it:\n * ```js\n * Flow.ofTotal(1000, { clampValue: true });\n * ```\n *\n * Takes an {@link Interval} for more expressive time:\n * ```js\n * const timer = Flow.ofTotal({ mins: 4 });\n * ```\n * \n * Is a simple wrapper around {@link relative}.\n * @param duration\n * @see {@link ofTotalTicks} - Use ticks instead of time\n * @see {@link hasElapsed} - Simple _true/false_ if interval has elapsed\n * @returns\n */\nexport function ofTotal(\n  duration: Interval,\n  opts: { readonly clampValue?: boolean, readonly wrapValue?: boolean } = {}\n): () => number {\n  const totalMs = intervalToMs(duration);\n  if (!totalMs) throw new Error(`Param 'duration' not valid`);\n  const timerOpts = {\n    ...opts,\n    timer: elapsedMillisecondsAbsolute(),\n  };\n  let t: ModulationTimer | undefined;\n  return () => {\n    if (!t) {\n      t = relative(totalMs, timerOpts);\n    }\n    return t.elapsed;\n  }\n}\n\n/**\n * Returns a function that returns the percentage of timer completion.\n * Uses 'ticks' as a measure. Use {@link ofTotal} if you want time-based.\n *\n * ```js\n * import * as Flow from \"https://unpkg.com/ixfx/dist/flow.js\"\n * const timer = Flow.ofTotalTicks(1000);\n * timer(); // Returns 0..1\n * ```\n *\n * Note that timer can exceed 1 (100%). To cap it:\n * ```js\n * Flow.ofTotalTicks(1000, { clampValue: true });\n * ```\n *\n * This is a a simple wrapper around {@link relative}.\n * @see {@link ofTotal}\n * @see {@link hasElapsed}: Simple _true/false_ if interval has elapsed\n * @param totalTicks\n * @returns\n */\nexport function ofTotalTicks(totalTicks: number, opts: { readonly clampValue?: boolean, readonly wrapValue?: boolean } = {}\n): () => number {\n  const timerOpts = {\n    ...opts,\n    timer: elapsedTicksAbsolute(),\n  };\n  let t: ModulationTimer | undefined;\n  return () => {\n    if (!t) {\n      t = relative(totalTicks, timerOpts);\n    }\n    return t.elapsed;\n  }\n}\n\n/**\n * Wraps a timer, returning a relative elapsed value based on\n * a given total. ie. percentage complete toward a total value.\n * This is useful because other parts of code don't need to know\n * about the absolute time values, you get a nice relative completion number.\n *\n * If no timer is specified, a milliseconds-based timer is used.\n *\n * ```js\n * const t = relative(1000);\n * t.elapsed;   // returns % completion (0...1)\n * ```\n * It can also use a tick based timer\n * ```js\n * // Timer that is 'done' at 100 ticks\n * const t = relative(100, { timer: ticksElapsedTimer() });\n * ```\n * \n * Additional fields/methods on the timer instance\n * ```js\n * t.isDone;  // _true_ if .elapsed has reached (or exceeded) 1\n * t.reset(); // start from zero again\n * ```\n *\n * Options:\n * * timer: timer to use. If not specified, `elapsedMillisecondsAbsolute()` is used.\n * * clampValue: if _true_, return value is clamped to 0..1 (default: _false_)\n * * wrapValue: if _true_, return value wraps around continously from 0..1..0 etc. (default: _false_)\n * \n * Note that `clampValue` and `wrapValue` are mutually exclusive: only one can be _true_, but both can be _false_.\n * \n * With options\n * ```js\n * // Total duration of 1000 ticks\n * const t = Timer.relative(1000, { timer: ticksElapsedTimer(); clampValue:true });\n * ```\n *\n * @private\n * @param total Total (of milliseconds or ticks, depending on timer source)\n * @param options Options\n * @returns Timer\n */\nexport const relative = (\n  total: number,\n  options: Partial<RelativeTimerOpts> = {}\n): ModulationTimer => {\n\n  const clampValue = options.clampValue ?? false;\n  const wrapValue = options.wrapValue ?? false;\n  if (clampValue && wrapValue) throw new Error(`clampValue and wrapValue cannot both be enabled`);\n\n  let modulationAmount = 1;\n\n  // Create and starts timer\n  const timer = options.timer ?? elapsedMillisecondsAbsolute();\n  // Keep track of value to avoid over-advancing the tick counter\n  let lastValue = 0;\n  const computeElapsed = (value: number) => {\n    lastValue = value;\n    let v = value / (total * modulationAmount);\n    if (clampValue) v = clamp(v);\n    else if (wrapValue && v >= 1) v = v % 1;\n    return v;\n  }\n\n  return {\n    mod(amt: number) {\n      modulationAmount = amt;\n    },\n    get isDone() {\n      //const tmp = computeElapsed();\n      //console.log(`Timer.relative ${ tmp } elapsed: ${ timer.elapsed } total: ${ total }`)\n      return computeElapsed(lastValue) >= 1;\n    },\n    get elapsed() {\n      return computeElapsed(timer.elapsed);\n    },\n    reset: () => {\n      timer.reset();\n    }\n  };\n};\n\n\n/**\n * A timer based on frequency: cycles per unit of time. These timers return a number from\n * 0..1 indicating position with a cycle.\n *\n * In practice, timers are used to 'drive' something like an Oscillator.\n *\n * By default it uses elapsed clock time as a basis for frequency. ie., cycles per second.\n *\n * It returns a `ModulationTimer`, which allows for a modulation amount to be continually applied\n * to the calculation of the 'position' within a cycle.\n *\n * @example Prints around 0/0.5 each second, as timer is half a cycle per second\n * ```js\n * import { frequencyTimer } from \"https://unpkg.com/ixfx/dist/flow.js\"\n * const t = frequencyTimer(0.5);\n * setInterval(() => {\n *  console.log(t.elapsed);\n * }, 1000);\n * ```\n * @param frequency Cycles\n * @param options Options for timer\n * @returns\n */\nexport const frequencyTimer = (\n  frequency: number,\n  options: Partial<TimerOpts> = {}\n): ModulationTimer => {\n  const timer = options.timer ?? elapsedMillisecondsAbsolute();\n  const cyclesPerSecond = frequency / 1000;\n  let modulationAmount = 1;\n\n  const computeElapsed = () => {\n    // Get position in a cycle\n    const v = timer.elapsed * (cyclesPerSecond * modulationAmount);\n\n    // Get fractional part\n    const f = v - Math.floor(v);\n    if (f < 0) {\n      throw new Error(\n        `Unexpected cycle fraction less than 0. Elapsed: ${ v } f: ${ f }`\n      );\n    }\n    if (f > 1) {\n      throw new Error(\n        `Unexpected cycle fraction more than 1. Elapsed: ${ v } f: ${ f }`\n      );\n    }\n    return f;\n  }\n  return {\n    mod: (amt: number) => {\n      modulationAmount = amt;\n    },\n    reset: () => {\n      timer.reset();\n    },\n    get isDone() {\n      return computeElapsed() >= 1;\n    },\n    get elapsed() {\n      return computeElapsed();\n    },\n  };\n};\n\n/**\n * A timer that uses clock time. Start time is from the point of invocation.\n *\n * ```js\n * const t = elapsedMillisecondsAbsolute();\n * t.reset(); // reset start\n * t.elapsed; // milliseconds since start\n * ```\n * @returns {Timer}\n * @see {ticksElapsedTimer}\n */\nexport const elapsedMillisecondsAbsolute = (): Timer => {\n  let start = performance.now();\n  return {\n    /**\n     * Reset timer\n     */\n    reset: () => {\n      start = performance.now();\n    },\n    /**\n     * Returns elapsed time since start\n     */\n    get elapsed() {\n      return performance.now() - start;\n    }\n  };\n};\n\n/**\n * A timer that progresses with each call to `elapsed`.\n *\n * The first call to elapsed will return 1.\n *\n * ```js\n * const timer = elapsedTicksAbsolute();\n * timer.reset(); // Reset to 0\n * timer.elapsed; // Number of ticks (and also increment ticks)\n * timer.peek;    // Number of ticks (without incrementing)\n * ```\n * \n * Like other {@link Timer} functions, returns with a `isDone` field,\n * but this will always return _true_.\n * @returns {Timer}\n * @see {elapsedMillisecondsAbsolute}\n */\nexport const elapsedTicksAbsolute = (): Timer & { peek: number } => {\n  let start = 0;\n  return {\n    /**\n     * Reset ticks to 0. The next call to `elapsed` will return 1.\n     */\n    reset: () => {\n      start = 0;\n    },\n    /**\n     * Get current ticks without incrementing.\n     */\n    get peek() {\n      return start;\n    },\n    /**\n     * Returns the number of elapsed ticks as well as\n     * incrementing the tick count. \n     * \n     * Minimum is 1\n     * \n     * Use {@link peek} to get the current ticks without incrementing.\n     */\n    get elapsed() {\n      return ++start;\n    }\n  };\n};\n\n\n/**\n * Wraps `timer`, computing a value for based on its elapsed value.\n * `fn` creates this value.\n * ```js\n * const t = timerWithFunction(v=>v/2, relativeTimer(1000));\n * t.compute();\n * ```\n * \n * In the above case, `relativeTimer(1000)` creates a timer that goes\n * from 0..1 over one second. `fn` will divide that value by 2, so\n * `t.compute()` will yield values 0..0.5.\n * \n * @param fn \n * @param timer \n * @returns \n */\nexport const timerWithFunction = (\n  fn: ((v: number) => number),\n  timer: CompletionTimer\n): HasCompletion & CompletionTimer & { compute: () => number } => {\n  if (typeof fn !== `function`) throw new Error(`Param 'fn' should be a function. Got: ${ typeof fn }`);\n  let startCount = 1;\n  return {\n    get elapsed() {\n      return timer.elapsed;\n    },\n    get isDone() {\n      return timer.isDone;\n    },\n    get runState() {\n      if (timer.isDone) return `idle`;\n      return `scheduled`;\n    },\n    /**\n     * Returns 1 if it has been created, returns +1 for each additional time the timer has been reset.\n     */\n    get startCount() {\n      return startCount;\n    },\n    get startCountTotal() {\n      return startCount;\n    },\n    compute: () => {\n      const elapsed = timer.elapsed;\n      return fn(elapsed);\n    },\n    reset: () => {\n      timer.reset();\n      startCount++;\n    },\n  };\n};","export * as BehaviourTree from './BehaviourTree.js';\nexport * from './Continuously.js';\nexport * from './Debounce.js';\nexport * from './Delay.js';\nexport * from './DispatchList.js';\nexport * as Elapsed from './Stopwatch.js';\nexport * from './Every.js';\nexport * from './Execute.js';\nexport * from './IntervalType.js';\nexport * from './PromiseFromEvent.js';\nexport * from './PromiseWithResolvers.js';\nexport * from './RateMinimum.js';\nexport * from './Repeat.js';\nexport * from './RequestResponseMatch.js';\nexport * from './Retry.js';\nexport * from './RunOnce.js';\nexport * from './Sleep.js';\n/**\n * State Machine\n *\n * * {@link StateMachine.driver}: Drive a state machine\n * * {@link StateMachine.init}: Create a state machine from initial state and machine description\n * * {@link fromList}: Create a state machine from a simple list of states\n */\nexport * as StateMachine from './StateMachine.js';\nexport * from './SyncWait.js';\nexport * from './TaskQueueMutable.js';\nexport * from './Throttle.js';\nexport * from './Timeout.js';\nexport * from './Timer.js';\nexport * from './Types.js';\nexport * from './UpdateOutdated.js';\nexport * from './WaitFor.js';\nexport * from './WaitForValue.js';\nexport type * from './Types.js';\n\n\n","\n\nexport type TaskState = `Failed` | `Running` | `Success`;\nexport type Task = {\n  readonly state: TaskState\n}\nexport type Traversal = readonly [\n  node: BtNode,\n  path: string\n];\n\n// Sequence runs children until the first one fails (serial)\n// Selector runs children until the first succeeds\n\n/**\n * Node can have conditions as to whether they should even be considered\n * Conditions can have dependencies on values, ideally this is responsive\n * Conditions might abort sibling nodes, as in example: https://docs.unrealengine.com/4.27/en-US/InteractiveExperiences/ArtificialIntelligence/BehaviorTrees/BehaviorTreesOverview/\n */\n\nexport type BtNodeBase = {\n  readonly name?: string\n}\n\nexport type SeqNode = BtNodeBase & {\n  readonly seq: ReadonlyArray<BtNode>\n}\nexport type SelNode = BtNodeBase & {\n  readonly sel: ReadonlyArray<BtNode>\n}\n\nexport type BtNode = SeqNode | SelNode | string;\n\nconst t: BtNode = {\n  name: `root`,\n  seq: [\n    `walk_to_door`,\n    {\n      name: `door_locked`,\n      sel: [\n        `open_door`,\n        {\n          name: `open_locked_door`,\n          seq: [ `unlock_door`, `open_door` ]\n        },\n        `smash_door` ]\n    },\n    `walk_through_door`,\n    `close_door`\n  ]\n};\n\n\n\nconst getName = (t: BtNode, defaultValue = ``) => {\n  if (typeof t === `object` && `name` in t && t.name !== undefined) return t.name;\n  return defaultValue;\n};\n\n//eslint-disable-next-line func-style\nexport function* iterateBreadth(t: BtNode, pathPrefix?: string): Generator<Traversal> {\n  if (typeof pathPrefix === `undefined`) {\n    pathPrefix = getName(t);\n  }\n\n  for (const [ index, n ] of entries(t)) {\n    yield [ n, pathPrefix ];\n  }\n  for (const [ index, n ] of entries(t)) {\n    const name = getName(n, `?`);\n    const prefix = pathPrefix.length > 0 ? pathPrefix + `.` + name : name;\n    yield* iterateBreadth(n, prefix);\n  }\n}\n\n//eslint-disable-next-line func-style\nexport function* iterateDepth(t: BtNode, pathPrefix?: string): Generator<Traversal> {\n  if (typeof pathPrefix === `undefined`) {\n    pathPrefix = getName(t);\n  }\n  for (const [ index, n ] of entries(t)) {\n    yield [ n, pathPrefix ];\n    const name = getName(n, `?`);\n    const prefix = pathPrefix.length > 0 ? pathPrefix + `.` + name : name;\n    yield* iterateBreadth(n, prefix);\n  }\n}\n\ntype ValidateOpts = {\n  readonly duplicatesAllowed: boolean\n}\n\n//eslint-disable-next-line func-style\nfunction isSeqNode(n: BtNode): n is SeqNode {\n  return (n as SeqNode).seq !== undefined;\n}\n\n//eslint-disable-next-line func-style\nfunction isSelNode(n: BtNode): n is SelNode {\n  return (n as SelNode).sel !== undefined;\n}\n\n//eslint-disable-next-line func-style\nfunction* entries(n: BtNode) {\n  if (isSeqNode(n)) {\n    yield* n.seq.entries();\n  } else if (isSelNode(n)) {\n    yield* n.sel.entries();\n  } else if (typeof n === `string`) {\n    // no-op\n  } else {\n    throw new TypeError(`Unexpected shape of node. seq/sel missing`);\n  }\n}\n\n// for (const tn of iterateBreadth(t)) {\n//   console.log(`Path: ${ tn[ 1 ] }`);\n//   console.log(`Node: ${ JSON.stringify(tn[ 0 ]) }`);\n// }\n\n// console.log(`---`);\n\n// for (const tn of iterateDepth(t)) {\n//   console.log(`Path: ${ tn[ 1 ] }`);\n//   console.log(`Node: ${ JSON.stringify(tn[ 0 ]) }`);\n// }\n","import { throwIntegerTest } from '../util/GuardNumbers.js';\nimport { intervalToMs, type Interval } from './IntervalType.js';\nimport type { HasCompletion, HasCompletionRunStates } from './Types.js';\n/**\n * Runs a function continuously, returned by {@link continuously}\n */\nexport type Continuously = HasCompletion & {\n  /**\n   * Starts loop. If already running, does nothing\n   */\n  start(): void;\n\n  /**\n   * (Re-)starts the loop. If an existing iteration has been\n   * scheduled, this is cancelled and started again.\n   *\n   * This can be useful when adjusting the interval\n   */\n  reset(): void;\n  /**\n   * How many milliseconds since loop was started after being stopped.\n   */\n  get elapsedMs(): number;\n  /**\n   * If disposed, the continuously instance won't be re-startable\n   */\n  get isDisposed(): boolean;\n  /**\n   * Stops loop. It can be restarted using .start()\n   */\n  cancel(): void;\n  /**\n   * Sets the interval speed of loop. Change will take effect on next loop. For it to kick\n   * in earlier, call .reset() after changing the value.\n   */\n  set interval(interval: Interval);\n  /**\n   * Gets the current interval, ie. speed of loop.\n   */\n  get interval(): Interval;\n};\n\nexport type ContinuouslySyncCallback = (\n  /**\n   * Number of times loop\n   * Ticks is reset when loop exits.\n   */\n  ticks?: number,\n  /**\n   * Elapsed milliseconds.\n   * Reset when loop exits\n   */\n  elapsedMs?: number\n  // eslint-disable-next-line @typescript-eslint/no-invalid-void-type\n) => boolean | void;\n\nexport type ContinuouslyAsyncCallback = (\n  /**\n   * Number of times loop has run\n   * Reset when loop exits.\n   */\n  ticks?: number,\n  /**\n   * Elapsed milliseconds.\n   * Reset when loop exits.\n   */\n  elapsedMs?: number\n  // eslint-disable-next-line @typescript-eslint/no-invalid-void-type\n) => Promise<boolean | void>;\n\nexport type OnStartCalled = `continue` | `cancel` | `reset` | `dispose`;\n\n/**\n * Options for {@link continuously}\n */\nexport type ContinuouslyOpts = Readonly<{\n  /**\n   * Abort signal to exit loop\n   */\n  signal: AbortSignal;\n  /**\n   * If _true_, callback runs before waiting period.\n   * @defaultValue false\n   */\n  fireBeforeWait: boolean;\n  /**\n   * Called whenever .start() is invoked.\n   * If this function returns:\n   *  - `continue`: the loop starts if it hasn't started yet, or continues if already started\n   *  - `cancel`: loop stops, but can be re-started if .start() is called again\n   *  - `dispose`: loop stops and will throw an error if .start() is attempted to be called\n   *  - `reset`: loop resets (ie. existing scheduled task is cancelled)\n   *\n   */\n  onStartCalled: (\n    /**\n     * Number of times loop has run\n     * Reset when loop is exits.\n     */\n    ticks?: number,\n    /**\n     * Elapsed milliseconds.\n     * Reset when loop is exits.\n     */\n    elapsedMs?: number\n  ) => OnStartCalled;\n}>;\n\n/**\n * Returns a {@link Continuously} that continually executes `callback` at `interval` rate.\n * \n * By default, first the sleep period happens and then the callback happens.\n *\n * Call `start` to begin/reset loop. The looping stops when `cancel` is called, or when `callback` returns _false_.\n *\n * @example\n * Animation loop\n * ```js\n * const draw = () => {\n *  // Draw on canvas\n * }\n *\n * // Run draw() synchronised with monitor refresh rate via `window.requestAnimationFrame`\n * continuously(draw).start();\n * ```\n *\n * @example\n * With delay\n * ```js\n * const fn = () => {\n *  // Runs after one minute\n * }\n * const c = continuously(fn, { mins: 1 } );\n * c.start(); // Runs `fn` every minute\n * ```\n *\n * @example\n * Control a 'continuously'\n * ```js\n * c.cancel();   // Stop the loop, cancelling any up-coming calls to `fn`\n * c.elapsedMs;  // How many milliseconds have elapsed since start\n * c.ticks;      // How many iterations of loop since start\n * c.interval;   // Get/set speed of loop. Change kicks-in at next loop.\n *               // Use .start() to reset to new interval immediately\n * ```\n *\n * Asynchronous callback functions are supported too:\n * ```js\n * continuously(async () => { ..});\n * ```\n *\n * The `callback` function can receive a few arguments:\n * \n * ```js\n * continuously( (ticks, elapsedMs) => {\n *  // ticks: how many times loop has run\n *  // elapsedMs:  how long since last loop\n * }).start();\n * ```\n *\n * If the callback explicitly returns _false_, the loop will be cancelled.\n * \n * ```js\n * continuously(ticks => {\n *  // Stop after 100 iterations\n *  if (ticks > 100) return false;\n * }).start();\n * ```\n *\n * You can intercept the logic for calls to `start()` with `onStartCalled`. It can determine\n * whether the `start()` proceeds, if the loop is cancelled, or the whole thing disposed,\n * so it can't run any longer.\n * \n * ```js\n * continuously(callback, intervalMs, {\n *  onStartCalled:(ticks, elapsedMs) => {\n *    // Cancel the loop after 1000ms has elapsed\n *    if (elapsedMs > 1000) return `cancel`;\n *  }\n * }).start();\n * ```\n *\n * To run `callback` *before* the sleep happens, set `fireBeforeWait`:\n * ```js\n * continuously(callback, intervalMs, { fireBeforeWait: true });\n * ```\n * @param callback - Function to run. If it returns _false_, loop exits.\n * @param options - {@link ContinuouslyOpts ContinuouslyOpts}\n * @param interval - Speed of loop (default: 0)\n * @returns Instance to control looping.\n * @see {@link Timeout} if you want to trigger something once.\n */\nexport const continuously = (\n  callback: ContinuouslyAsyncCallback | ContinuouslySyncCallback,\n  interval?: Interval,\n  options: Partial<ContinuouslyOpts> = {}\n): Continuously => {\n  let intervalMs = intervalToMs(interval, 0);\n  throwIntegerTest(intervalMs, `positive`, `interval`);\n  const fireBeforeWait = options.fireBeforeWait ?? false;\n  const onStartCalled = options.onStartCalled;\n  const signal = options.signal;\n\n  let disposed = false;\n  let runState: HasCompletionRunStates = `idle`;\n  let startCount = 0;\n  let startCountTotal = 0;\n  let startedAt = performance.now();\n  let intervalUsed = interval ?? 0;\n  let cancelled = false;\n  let currentTimer: ReturnType<typeof globalThis.setTimeout> | undefined;\n\n  const deschedule = () => {\n    if (currentTimer === undefined) return;\n    globalThis.clearTimeout(currentTimer);\n    currentTimer = undefined;\n    startCount = 0;\n    startedAt = Number.NaN;\n  }\n\n  const schedule = (scheduledCallback: () => void) => {\n    if (intervalMs === 0) {\n      if (typeof requestAnimationFrame === `undefined`) {\n        currentTimer = globalThis.setTimeout(scheduledCallback, 0);\n      } else {\n        currentTimer = undefined;\n        requestAnimationFrame(scheduledCallback);\n      }\n    } else {\n      currentTimer = globalThis.setTimeout(scheduledCallback, intervalMs);\n    }\n  }\n\n  const cancel = () => {\n    if (cancelled) return;\n    cancelled = true;\n\n    if (runState === `idle`) return; // No need to cancel\n    runState = `idle`;\n    deschedule();\n  };\n\n  const loop = async () => {\n    if (signal?.aborted) {\n      runState = `idle`;\n    }\n    if (runState === `idle`) return;\n\n    runState = `running`\n    startCount++;\n    startCountTotal++;\n    const valueOrPromise = callback(startCount, performance.now() - startedAt);\n    const value = typeof valueOrPromise === `object` ? (await valueOrPromise) : valueOrPromise;\n    if (cancelled) {\n      return;\n    }\n    runState = `scheduled`;\n\n    // Didn't get a value, exit out\n    if (value !== undefined && !value) {\n      cancel();\n      return;\n    }\n    if (cancelled) return; // has been cancelled\n    // eslint-disable-next-line @typescript-eslint/no-misused-promises\n    schedule(loop);\n  };\n\n  const start = () => {\n    if (disposed) throw new Error(`Disposed`);\n    cancelled = false;\n\n    if (onStartCalled !== undefined) {\n      // A function governs whether to allow .start() to go ahead\n      const doWhat = onStartCalled(startCount, performance.now() - startedAt);\n      switch (doWhat) {\n        case `cancel`: {\n          cancel();\n          return;\n        }\n        case `reset`: {\n          reset();\n          return;\n        }\n        case `dispose`: {\n          disposed = true;\n          cancel();\n          return;\n        }\n        // No default\n      }\n    }\n\n    if (runState === `idle`) {\n      // Start running\n      startCount = 0;\n      startedAt = performance.now();\n      runState = `scheduled`;\n      if (fireBeforeWait) {\n        void loop(); // Exec first, then wait\n      } else {\n        // eslint-disable-next-line @typescript-eslint/no-misused-promises\n        schedule(loop); // Wait first, then exec\n      }\n    } // else: already running, ignore\n  };\n\n  const reset = () => {\n    if (disposed) throw new Error(`Disposed`);\n    cancelled = false;\n    startCount = 0;\n    startedAt = Number.NaN;\n\n    // Cancel scheduled iteration\n    if (runState !== `idle`) {\n      cancel();\n    }\n    start();\n  };\n\n  return {\n    start,\n    reset,\n    cancel,\n    get interval() {\n      return intervalUsed;\n    },\n    get runState() {\n      return runState;\n    },\n    get startCountTotal() {\n      return startCountTotal;\n    },\n    get startCount() {\n      return startCount;\n    },\n    set interval(interval: Interval) {\n      const ms = intervalToMs(interval, 0);\n      throwIntegerTest(ms, `positive`, `interval`);\n      intervalMs = ms;\n      intervalUsed = interval;\n    },\n    get isDisposed() {\n      return disposed;\n    },\n    get elapsedMs() {\n      return performance.now() - startedAt;\n    },\n  };\n};\n","import type { Interval } from './IntervalType.js';\nimport {\n  timeout,\n  type TimeoutSyncCallback,\n  type TimeoutAsyncCallback,\n} from './Timeout.js';\n\n/**\n * Returns a debounce function which acts to filter calls to a given function `fn`.\n *\n * Eg, Let's create a debounced wrapped for a function:\n * ```js\n * const fn = () => console.log('Hello');\n * const debouncedFn = debounce(fn, 1000);\n * ```\n *\n * Now we can call `debouncedFn()` as often as we like, but it will only execute\n * `fn()` after 1 second has elapsed since the last invocation. It essentially filters\n * many calls to fewer calls. Each time `debounceFn()` is called, the timeout is\n * reset, so potentially `fn` could never be called if the rate of `debounceFn` being called\n * is faster than the provided timeout.\n *\n * Remember that to benefit from `debounce`, you must call the debounced wrapper, not the original function.\n *\n * ```js\n * // Create\n * const d = debounce(fn, 1000);\n *\n * // Don't do this if we want to benefit from the debounce\n * fn();\n *\n * // Use the debounced wrapper\n * d(); // Only calls fn after 1000s\n * ```\n *\n * A practical use for this is handling high-frequency streams of data, where we don't really\n * care about processing every event, only last event after a period. Debouncing is commonly\n * used on microcontrollers to prevent button presses being counted twice.\n *\n * @example Handle most recent pointermove event after 1000ms\n * ```js\n * // Set up debounced handler\n * const moveDebounced = debounce((elapsedMs, evt) => {\n *    // Handle event\n * }, 500);\n *\n * // Wire up event\n * el.addEventListener(`pointermove`, moveDebounced);\n * ```\n *\n * Arguments can be passed to the debounced function:\n *\n * ```js\n * const fn = (x) => console.log(x);\n * const d = debounce(fn, 1000);\n * d(10);\n * ```\n *\n * If the provided function is asynchronous, it's possible to await the debounced\n * version as well. If the invocation was filtered, it returns instantly.\n *\n * ```js\n * const d = debounce(fn, 1000);\n * await d();\n * ```\n * @param callback Function to filter access to\n * @param interval Minimum time between invocations\n * @returns Debounce function\n */\nexport const debounce = (\n  callback: TimeoutSyncCallback | TimeoutAsyncCallback,\n  interval: Interval\n): DebouncedFunction => {\n  const t = timeout(callback, interval);\n  //eslint-disable-next-line functional/prefer-immutable-types\n  return (...args: Array<unknown>) => { t.start(undefined, args); };\n};\n\n/**\n * Debounced function\n */\nexport type DebouncedFunction = (...args: ReadonlyArray<unknown>) => void;\n","import { intervalToMs, type Interval } from './IntervalType.js';\nimport { sleep } from './Sleep.js';\n\n/**\n * Delay options\n */\nexport type DelayOpts = Interval & {\n  /**\n   * Signal for cancelling delay\n   */\n  readonly signal?: AbortSignal;\n  /**\n   * When delay is applied. \"before\" is default.\n   */\n  readonly delay?: `before` | `after` | `both`;\n};\n\n/**\n * Pauses execution for interval after which the asynchronous `callback` is executed and awaited.\n * Must be called with `await` if you want the pause effect.\n *\n * @example Pause and wait for function\n * ```js\n * const result = await delay(async () => Math.random(), 1000);\n * console.log(result); // Prints out result after one second\n * ```\n *\n * If the `interval` option is a number its treated as milliseconds. {@link Interval} can also be used:\n * ```js\n * const result = await delay(async () => Math.random(), { mins: 1 });\n * ```\n *\n * If `await` is omitted, the function will run after the provided timeout, and code will continue to run.\n *\n * @example Schedule a function without waiting\n * ```js\n * await delay(async () => {\n *  console.log(Math.random())\n * }, 1000);\n * // Prints out a random number after 1 second.\n * ```\n *\n * {@link delay} and {@link sleep} are similar. `delay()` takes a parameter of what code to execute after the timeout, while `sleep()` just resolves after the timeout.\n *\n * Optionally takes an AbortSignal to cancel delay.\n * ```js\n * const ac = new AbortController();\n * // Super long wait\n * await delay(someFn, { signal: ac.signal, hours: 1 }}\n * ...\n * ac.abort(); // Cancels long delay\n * ```\n *\n * It also allows choice of when delay should happen.\n * If you want to be able to cancel or re-run a delayed function, consider using\n * {@link timeout} instead.\n *\n * @typeParam V - Type of callback return value\n * @param callback What to run after interval\n * @param optsOrMillis Options for delay, or millisecond delay. By default delay is before `callback` is executed.\n * @return Returns result of `callback`.\n */\nexport const delay = async <V>(\n  callback: () => Promise<V>,\n  //eslint-disable-next-line functional/prefer-immutable-types\n  optsOrMillis: DelayOpts | number\n): Promise<V> => {\n  const opts =\n    typeof optsOrMillis === `number` ? { millis: optsOrMillis } : optsOrMillis;\n  const delayWhen = opts.delay ?? `before`;\n  if (delayWhen === `before` || delayWhen === `both`) {\n    await sleep(opts);\n  }\n  const r = Promise.resolve(await callback());\n  if (delayWhen === `after` || delayWhen === `both`) {\n    await sleep(opts);\n  }\n  return r;\n};\n\n/**\n * Iterate over a source iterable with some delay between results.\n * Delay can be before, after or both before and after each result from the\n * source iterable.\n *\n * Since it's an async iterable, `for await ... of` is needed.\n *\n * ```js\n * const opts = { intervalMs: 1000, delay: 'before' };\n * const iterable = count(10);\n * for await (const i of delayIterable(iterable, opts)) {\n *  // Prints 0..9 with one second between\n * }\n * ```\n *\n * Use {@link delay} to return a result after some delay\n *\n * @param iter\n * @param opts\n */\n// export async function* delayIterable<V>(\n//   iter: AsyncIterable<V> | Iterable<V>,\n//   //eslint-disable-next-line functional/prefer-immutable-types\n//   opts: DelayOpts\n// ) {\n//   const intervalMs = intervalToMs(opts);\n//   const delayWhen = opts.delay;\n//   const signal = opts.signal;\n\n//   for await (const v of iter) {\n//     // Pre-delay\n//     if (delayWhen === 'before' || delayWhen === 'both') {\n//       await sleep({ millis: intervalMs, signal });\n//       if (signal?.aborted) break;\n//     }\n\n//     // Yield value\n//     yield v;\n\n//     // Post-delay\n//     if (delayWhen === 'after' || delayWhen === 'both') {\n//       await sleep({ millis: intervalMs, signal });\n//       if (signal?.aborted) break;\n//     }\n//   }\n// }\n\n/**\n * Async generator that loops via `requestAnimationFrame`.\n *\n * We can use `for await of` to run code:\n * ```js\n * const loop = delayAnimationLoop();\n * for await (const o of loop) {\n *  // Do something...\n *  // Warning: loops forever\n * }\n * // Warning: execution doesn't continue to this point\n * // unless there is a 'break' in loop.\n * ```\n * \n * Or use the generator in manually:\n * ```js\n * // Loop forever\n * (async () => {\n *  const loop = delayAnimationLoop();\n *  while (true) {\n *    await loop.next();\n *\n *    // Do something...\n *    // Warning: loops forever\n *  }\n * })();\n * ```\n * \n * Practically, these approaches are not so useful\n * because execution blocks until the loop finishes.\n * \n * Instead, we might want to continually loop a bit\n * of code while other bits of code continue to run.\n * \n * The below example shows how to do this.\n * \n * ```js\n * setTimeout(async () => {\n *  for await (const _ of delayAnimationLoop()) {\n *    // Do soething at animation speed\n *  }\n * });\n * \n * // Execution continues while loop also runs\n * ```\n *\n */\n//eslint-disable-next-line func-style\nasync function* delayAnimationLoop() {\n  let resolve: ((value?: undefined) => void) | undefined;\n  let p = new Promise<undefined>((r) => (resolve = r));\n  let timer = 0;\n  const callback = () => {\n    if (resolve) resolve();\n    p = new Promise<undefined>((r) => (resolve = r));\n  };\n\n  try {\n    while (true) {\n      timer = globalThis.requestAnimationFrame(callback);\n      // eslint-disable-next-line @typescript-eslint/no-confusing-void-expression\n      const _ = await p;\n      yield _;\n    }\n  } finally {\n    if (resolve) resolve();\n    globalThis.cancelAnimationFrame(timer);\n  }\n}\n\n/**\n * Async generator that loops at a given interval.\n * \n * @example \n * For Await loop every second\n * ```js\n * const loop = delayLoop(1000);\n * // Or: const loop = delayLoop({ secs: 1 });\n * for await (const o of loop) {\n *  // Do something...\n *  // Warning: loops forever\n * }\n * ```\n * \n * @example \n * Loop runs every second\n * ```js\n * (async () => {\n *  const loop = delayLoop(1000);\n *  // or: loop = delayLoop({ secs: 1 });\n *  while (true) {\n *    await loop.next();\n *\n *    // Do something...\n *    // Warning: loops forever\n *  }\n * })();\n * ```\n * \n * Alternatives:\n * * {@link delay} to run a single function after a delay\n * * {@link sleep} pause execution\n * * {@link continuously} to start/stop/adjust a constantly running loop\n *\n * @param timeout Delay. If 0 is given, `requestAnimationFrame` is used over `setTimeout`.\n */\nexport async function* delayLoop(timeout: Interval) {\n  const timeoutMs = intervalToMs(timeout);\n  if (typeof timeoutMs === `undefined`) throw new Error(`timeout is undefined`);\n  if (timeoutMs < 0) throw new Error(`Timeout is less than zero`);\n  if (timeoutMs === 0) return yield* delayAnimationLoop();\n\n  let resolve: ((value?: undefined) => void) | undefined;\n  let p = new Promise<undefined>((r) => (resolve = r));\n  let timer: ReturnType<typeof globalThis.setTimeout> | undefined;\n  const callback = () => {\n    if (resolve) resolve();\n    p = new Promise<undefined>((r) => (resolve = r));\n  };\n\n  try {\n    while (true) {\n      timer = globalThis.setTimeout(callback, timeoutMs);\n      // eslint-disable-next-line @typescript-eslint/no-confusing-void-expression\n      const _ = await p;\n      yield _;\n    }\n  } finally {\n    if (resolve) resolve();\n    if (timer !== undefined) globalThis.clearTimeout(timer);\n    timer = undefined;\n  }\n}\n","export type Dispatch<V> = (value: V) => void;\n\ntype Wrap<V> = {\n  readonly handler: Dispatch<V>\n  readonly id: string\n  readonly once: boolean\n}\n\nexport class DispatchList<V> {\n  #handlers: Array<Wrap<V>>\n  #counter = 0;\n  readonly #id = Math.floor(Math.random() * 100);\n  constructor() {\n\n    this.#handlers = [];\n  }\n\n  /**\n   * Returns _true_ if list is empty\n   * @returns \n   */\n  isEmpty() {\n    return this.#handlers.length === 0;\n  }\n\n  /**\n   * Adds a handler\n   * @param handler \n   * @param options \n   * @returns \n   */\n  add(handler: Dispatch<V>, options: { once?: boolean } = {}): string {\n    this.#counter++;\n    const once = options.once ?? false;\n    const wrap: Wrap<V> = {\n      id: `${ this.#id } - ${ this.#counter }`,\n      handler,\n      once\n    }\n    this.#handlers.push(wrap);\n    return wrap.id;\n  }\n\n  remove(id: string): boolean {\n    const length = this.#handlers.length;\n    this.#handlers = this.#handlers.filter(handler => handler.id !== id);\n    return this.#handlers.length !== length;\n  }\n\n  notify(value: V) {\n    for (const handler of this.#handlers) {\n      handler.handler(value);\n      if (handler.once) {\n        this.remove(handler.id);\n      }\n    }\n  }\n\n  clear() {\n    this.#handlers = [];\n  }\n}","import { throwIntegerTest } from \"../util/GuardNumbers.js\";\n\n/**\n * Returns true for every _n_th call, eg 2 for every second call.\n *\n * If `nth` is 1, returns true for everything. 0 will be false for everything.\n *\n * Usage:\n * ```js\n * const tenth = everyNth(10);\n * window.addEventListener(`pointermove`, evt => {\n *  if (!tenth(evt)) return; // Filter out\n *  // Continue processing, it is the 10th thing.\n *\n * });\n * ```\n *\n * Alternative:\n * ```js\n * window.addEventListener(`pointermove`, everyNth(10, evt => {\n *  // Do something with tenth item...\n * });\n * ```\n * @param nth Every nth item\n * @param callback\n * @returns Function which in turn returns true if nth call has been hit, false otherwise\n */\nexport const everyNth = <T>(nth: number, callback?: (data: T) => void) => {\n  throwIntegerTest(nth, `positive`, `nth`);\n\n  let counter = 0;\n\n  return (data: T) => {\n    counter++;\n    if (counter === nth) {\n      counter = 0;\n      if (callback) callback(data);\n      return true;\n    }\n    return false;\n  }\n};\n\n","export const promiseFromEvent = (target: EventTarget, name: string): Promise<any> => {\n  return new Promise(resolve => {\n    const handler = (...args: Array<any>) => {\n      target.removeEventListener(name, handler);\n      if (Array.isArray(args) && args.length === 1) resolve(args[ 0 ]);\n      else resolve(args);\n    };\n    target.addEventListener(name, handler);\n  });\n};","export function promiseWithResolvers<T>() {\n  let resolve: undefined | ((value: T) => void);\n  let reject: undefined | ((reason: any) => void);\n  const promise = new Promise<T>(\n    (_resolve, _reject) => {\n      resolve = _resolve;\n      reject = _reject;\n    });\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  return { promise, resolve: resolve!, reject: reject! };\n}","import { SimpleEventEmitter } from \"../Events.js\"\nimport { continuously } from \"./Continuously.js\"\n\nexport type RequestResponseOptions<TRequest, TResp> = {\n  timeoutMs: number\n  key: (requestOrResp: TRequest | TResp) => string\n  keyRequest: (request: TRequest) => string\n  keyResponse: (resp: TResp) => string\n  whenUnmatchedResponse: `ignore` | `throw`\n}\n\ntype SeenRequest<TRequest, TResp> = {\n  expiresAt: number\n  id: string\n  req: TRequest\n  promiseResolve?: (value: TResp) => void\n  promiseReject?: (message: string) => void\n  callback?: (error: boolean, value: TResp | string) => void\n}\n\nexport type RequestResponseMatchEvents<TRequest, TResp> = {\n  match: { request: TRequest, response: TResp }\n  completed: { request: TRequest, response: TResp | string, success: boolean }\n}\n\n/**\n * Matches responses with requests, expiring requests if they do not get a response in a timely manner.\n * \n * Basic usage:\n * ```js\n * const m = new RequestResponseMatch(options);\n * // Listen for when a response matches a request\n * m.addEventListener(`match`, event => {\n *  // event: { request:Req, response:Resp}\n * });\n * // Or alternatively, listen for success and failures\n * m.addEventListener(`completed`, event => {\n *  // { request:Resp, response:Req|undefined, success:boolean }\n *  // 'response' will be data or a string error message\n * });\n * m.request(req); // Note that some request was sent\n * ...\n * m.response(resp); // Call when a response is received\n * ```\n * \n * It's also possible to wait for specific replies:\n * ```js\n * // With a promise\n * const resp = await m.requestAwait(req);\n * // With a callback\n * m.requestCallback(req, (success, resp) => {\n *  // Runs on success or failure\n * })\n * ```\n * It relies on creating an id of a request/response for them to be matched up. Use the `key`\n * option if the function can generate a key from either request or response. Or alternatively set both `keyRequest` and `keyResponse` for two functions that can generate a key for request and response respectively.\n * \n * \n * The easy case is if req & resp both have the same field:\n * ```js\n * const m = new RequestResponseMatch({\n *  key: (reqOrResp) => {\n *    // Requests has an 'id' field\n *    // Response also has an 'id' field that corresponds to the request id\n *    return reqOrResp.id; \n *  }\n * });\n * ```\n * \n * A more complicated case:\n * ```js\n * const m = new RequestResponseMatch({\n *  keyRequest: (req) => {\n *    // Requests have an 'id' field\n *    return req.id; \n *  },\n *  keyResponse: (resp) => {\n *    // Responses have id under a different field\n *    return resp.reply_to\n *  }\n * })\n * ```\n * \n * By default, error will be thrown if a response is received that doesn't match up to any request.\n */\nexport class RequestResponseMatch<TRequest, TResp> extends SimpleEventEmitter<RequestResponseMatchEvents<TRequest, TResp>> {\n  timeoutMs;\n  whenUnmatchedResponse;\n  keyRequest;\n  keyResponse;\n\n  #outgoing = new Map<string, SeenRequest<TRequest, TResp>>();\n  #maintainLoop;\n\n  constructor(options: Partial<RequestResponseOptions<TRequest, TResp>> = {}) {\n    super();\n    if (typeof window === `undefined`) {\n      (globalThis as any).window = {\n        setTimeout: setTimeout,\n        clearTimeout: clearTimeout\n      }\n    }\n    this.timeoutMs = options.timeoutMs ?? 1000;\n    this.whenUnmatchedResponse = options.whenUnmatchedResponse ?? `throw`;\n    this.#maintainLoop = continuously(() => this.#maintain(), this.timeoutMs * 2);\n    if (options.key) {\n      if (options.keyRequest) throw new Error(`Cannot set 'keyRequest' when 'key' is set `);\n      if (options.keyResponse) throw new Error(`Cannot set 'keyResponse' when 'key' is set `);\n\n      this.keyRequest = options.key;\n      this.keyResponse = options.key;\n    } else {\n      if (!options.keyRequest || !options.keyResponse) {\n        throw new Error(`Expects 'keyRequest' & 'keyResponse' fields to be set if 'key' is not set`);\n      }\n      this.keyRequest = options.keyRequest;\n      this.keyResponse = options.keyResponse;\n    }\n  }\n\n  #maintain() {\n    const values = [ ...this.#outgoing.values() ];\n    const now = Date.now();\n    for (const v of values) {\n      if (v.expiresAt <= now) {\n\n        if (v.promiseReject) {\n          v.promiseReject(`Request timeout`);\n        }\n        const callback = v.callback;\n        if (callback) {\n          setTimeout(() => {\n            callback(true, `Request timeout`);\n          }, 1);\n        }\n        this.fireEvent(`completed`, { request: v.req, response: `Request timeout`, success: false });\n        this.#outgoing.delete(v.id);\n      }\n    }\n    this.debugDump();\n    return this.#outgoing.size > 0;\n  }\n\n  debugDump() {\n    const values = [ ...this.#outgoing.values() ];\n    const now = Date.now();\n    for (const v of values) {\n      const expire = now - v.expiresAt;\n      console.log(`${ v.id } Expires in: ${ Math.floor(expire / 1000) }s`);\n    }\n  }\n\n  /**\n   * Make a request and get the outcome via a Promise\n   * @param request \n   */\n  request(request: TRequest): Promise<TResp>;\n\n  /**\n   * Makes a request with a callback for the outcome\n   * @param request \n   * @param callback \n   */\n  request(request: TRequest, callback: (error: boolean, response: TResp | string) => void): void;\n\n  /**\n   * Makes a request.\n   * If `callback` is set, it's equivalent to calling `requestCallback`.\n   * If `callback` is not set, a promise is returned\n   * @param request \n   * @param callback \n   * @returns \n   */\n  // eslint-disable-next-line @typescript-eslint/no-invalid-void-type\n  request(request: TRequest, callback?: (error: boolean, response: TResp | string) => void): void | Promise<TResp> {\n    if (callback !== undefined) { this.#requestCallback(request, callback); return; }\n    return this.#requestAwait(request);\n  }\n\n  /**\n   * Make a request and don't wait for the outcome.\n   * @param request \n   */\n  requestAndForget(request: TRequest) {\n    const id = this.keyRequest(request);\n    if (this.#outgoing.has(id)) throw new Error(`Already a request pending with id '${ id }'`);\n\n    const r: SeenRequest<TRequest, TResp> = {\n      expiresAt: Date.now() + this.timeoutMs,\n      id,\n      req: request\n    };\n    this.#outgoing.set(id, r);\n    this.#maintainLoop.start();\n  }\n\n  /**\n   * Make a request, returning a Promise for the outcome.\n   * Errors will throw an exception.\n   * @param request \n   * @returns \n   */\n  #requestAwait(request: TRequest) {\n    const id = this.keyRequest(request);\n    if (this.#outgoing.has(id)) throw new Error(`Already a request pending with id '${ id }'`);\n\n    const p = new Promise<TResp>((resolve, reject) => {\n      const r: SeenRequest<TRequest, TResp> = {\n        expiresAt: Date.now() + this.timeoutMs,\n        id,\n        req: request,\n        promiseResolve: resolve,\n        promiseReject: reject\n      };\n      this.#outgoing.set(id, r);\n      this.#maintainLoop.start();\n\n    });\n    return p;\n  }\n\n  /**\n   * Make a request, and get notified of outcome with a callback\n   * @param request \n   * @param callback \n   */\n  #requestCallback(request: TRequest, callback: (error: boolean, response: TResp | string) => void) {\n    const id = this.keyRequest(request);\n    if (this.#outgoing.has(id)) throw new Error(`Already a request pending with id '${ id }'`);\n\n    const r: SeenRequest<TRequest, TResp> = {\n      expiresAt: Date.now() + this.timeoutMs,\n      id,\n      req: request,\n      callback\n    };\n    this.#outgoing.set(id, r);\n    this.#maintainLoop.start();\n  }\n\n  /**\n   * Response has been received\n   * @param response Response\n   * @returns _True_ if response matched a request \n   */\n  response(response: TResp, keepAlive: boolean): boolean {\n    const id = this.keyResponse(response);\n    const request = this.#outgoing.get(id);\n    if (!request) {\n      if (this.whenUnmatchedResponse === `throw`) throw new Error(`Unmatched response with id: '${ id }'`, { cause: response });\n      // otherwise ignore\n      return false;\n    }\n\n    if (keepAlive) {\n      // Continue life of request\n      request.expiresAt = Date.now() + this.timeoutMs\n    } else {\n      this.#outgoing.delete(id);\n    }\n    if (request.promiseResolve) {\n      request.promiseResolve(response);\n    }\n    if (request.callback) {\n      request.callback(false, response);\n    }\n    this.fireEvent(`match`, { request: request.req, response: response });\n    if (!keepAlive) {\n      this.fireEvent(`completed`, { request: request.req, response: response, success: true });\n    }\n    return true;\n  }\n}","import { sleep } from './Sleep.js';\nimport { resolveLogOption } from '../debug/Logger.js';\nimport { since } from './Stopwatch.js';\nimport { throwIntegerTest, throwNumberTest } from '../util/GuardNumbers.js';\nimport { getErrorMessage } from '../debug/GetErrorMessage.js';\nimport type { Result } from '../util/Results.js';\nimport { elapsedToHumanString } from './IntervalType.js';\n/**\n * Result of backoff\n */\nexport type RetryResult<V> = {\n  /**\n   * Message describing outcome.\n   *\n   * If retry was aborted, message will be abort reason.\n   */\n  readonly message?: string;\n  /**\n   * True if callback function was invoked once where it returned _true_\n   */\n  readonly success: boolean;\n  /**\n   * Number of times callback was attempted\n   */\n  readonly attempts: number;\n  /**\n   * Total elapsed time since beginning of call to `retry`\n   */\n  readonly elapsed: number;\n\n  /**\n   * Value returned by succeeding function,\n   * or _undefined_ if it failed\n   */\n  readonly value: V | undefined;\n};\n\nexport type BackoffOptions = {\n  /**\n   * Initial value.\n   * Default: 1\n   */\n  startAt: number,\n  /**\n   * Maximum times to run.\n   * Default: continues forever\n   */\n  limitAttempts: number,\n  /**\n   * Stop retrying if this maximum is reached\n   * Default: no limit\n   */\n  limitValue: number\n  /**\n   * Math power. \n   * Default: 1.1\n   */\n  power: number\n};\n\n/**\n * Generates an expoential backoff series of values\n * ```js\n * // Default: start at 1, power 1.1\n * for (const v of backoffGenerator()) {\n *  // v: numeric value\n * }\n * ```\n * \n * By default the generator runs forever. Use either\n * `limitAttempts` or `limitValue` to stop it when it produces a\n * given quantity of values, or when the value itself reaches a threshold.\n * \n * For example:\n * ```js\n * // `values` will have five values in it\n * const values = [...backoffGenerator({ limitAttempts: 5 })];\n * // Keep generating values until max is reached\n * const values = [...backoffGenerator({ limitValue: 1000 })];\n * ```\n * \n * Options:\n * * startAt: start value\n * * limitAttempts: cap the number of values to generate\n * * limitValue: cap the maximum calculated value\n * * power: power value (default 1.1)\n * \n * @param options \n * @returns \n */\nexport function* backoffGenerator(options: Partial<BackoffOptions> = {}) {\n  const startAt = options.startAt ?? 1;\n  let limitAttempts = options.limitAttempts ?? Number.MAX_SAFE_INTEGER;\n  const limitValue = options.limitValue;\n  const power = options.power ?? 1.1;\n  let value = startAt;\n  throwIntegerTest(limitAttempts, `aboveZero`, `limitAttempts`);\n  throwNumberTest(startAt, ``, `startAt`);\n  throwNumberTest(limitAttempts, ``, `limitAttempts`);\n  if (limitValue !== undefined) throwNumberTest(limitValue, ``, `limitValue`);\n  throwNumberTest(power, ``, `power`);\n\n  while (limitAttempts > 0) {\n    // Value has climbed to the limit\n    if (limitValue && value >= limitValue) return;\n    limitAttempts--;\n    yield value;\n\n    // Increase value for next iteration\n    value += Math.pow(value, power);\n  }\n}\n\n/**\n * Backoff options\n */\nexport type RetryOpts<T> = BackoffOptions & {\n  /**\n   * Initial waiting period before first attempt (optional)\n   */\n  readonly predelayMs: number;\n  /**\n   * Optional abort signal\n   */\n  readonly abort: AbortSignal;\n  /**\n   * Log: _true_ monitors the task execution by logging to console\n   */\n  readonly log: boolean;\n\n  /***\n   * Default task value to return if it fails\n   */\n  readonly taskValueFallback: T;\n};\n\nexport type RetryTask<T> = {\n  /**\n   * If `probe` returns {success:true} task is considered\n   * complete and retrying stops\n   * @returns \n   */\n  probe: (attempts: number) => Promise<Result<T>>\n}\n\n/**\n * Keeps calling `callback` until it returns something other than _undefined_. \n * There is an exponentially-increasing delay between each retry attempt.\n * \n * If `callback` throws an exception, the retry is cancelled, bubbling the exception.\n *\n * ```js\n * // A function that only works some of the time\n * const flakyFn = async () => {\n *  // do the thing\n *  if (Math.random() > 0.9) return true; // success\n *  return; // fake failure\n * };\n *\n * // Retry it up to five times,\n * // starting with 1000ms interval\n * const result = await retryFunction(flakyFn, {\n *  limitAttempts: 5\n * });\n *\n * if (result.success) {\n *  // Yay\n * } else {\n *  console.log(`Failed after ${result.attempts} attempts. Elapsed: ${result.elapsed}`);\n *  console.log(result.message);\n * }\n * ```\n *\n * An `AbortSignal` can be used to cancel process.\n * ```js\n * const abort = new AbortController();\n * const result = await retryFunction(cb, { signal: abort.signal });\n *\n * // Somewhere else...\n * abort('Cancel!'); // Trigger abort\n * ```\n * @param callback Function to run\n * @param options Options\n * @returns\n */\nexport const retryFunction = <T>(callback: () => Promise<T | undefined>, options: Partial<RetryOpts<T>> = {}) => {\n  const task: RetryTask<T> = {\n    async probe() {\n      try {\n        const v = await callback();\n        if (v === undefined) return { value: options.taskValueFallback, success: false };\n        return { value: v, success: true };\n      } catch (error) {\n        return { success: false, message: getErrorMessage(error) };\n      }\n    },\n  }\n  return retryTask(task, options);\n}\n\n/**\n * Keeps trying to run `task`.\n * \n * ```js\n * const task = (attempts) => {\n *  // attempts is number of times it has been retried\n *  \n *  if (Math.random() > 0.5) {\n *    // Return a succesful result\n *    return { success: true }\n *  } else {\n *  }\n * \n * }\n * const t = await retryTask(task, opts);\n * ```\n * @param task \n * @param opts \n * @returns \n */\nexport const retryTask = async <V>(\n  task: RetryTask<V>,\n  opts: Partial<RetryOpts<V>> = {}\n): Promise<RetryResult<V>> => {\n  const signal = opts.abort;\n  const log = resolveLogOption(opts.log);\n  const predelayMs = opts.predelayMs ?? 0;\n  const startedAt = since();\n\n  let attempts = 0;\n  const initialValue = opts.startAt ?? 1000;\n  const limitAttempts = opts.limitAttempts ?? Number.MAX_SAFE_INTEGER;\n  const backoffGen = backoffGenerator({ ...opts, startAt: initialValue, limitAttempts });\n\n  if (initialValue <= 0) throw new Error(`Param 'initialValue' must be above zero`);\n\n  if (predelayMs > 0) {\n    try {\n      await sleep({ millis: predelayMs, signal: signal });\n    } catch (error) {\n      // Could happen due to abort signal\n      return {\n        success: false,\n        attempts,\n        value: opts.taskValueFallback,\n        elapsed: startedAt(),\n        message: getErrorMessage(error),\n      };\n    }\n  }\n\n  for (const t of backoffGen) {\n    attempts++;\n\n    // Run task\n    const result = await task.probe(attempts);\n    if (result.success) {\n      return { success: result.success, value: result.value, attempts, elapsed: startedAt() };\n    }\n    log({\n      msg: `retry attempts: ${ attempts } t: ${ elapsedToHumanString(t) }`,\n    });\n\n    // Did not succeed.\n    if (attempts >= limitAttempts) {\n      break; // Out of attempts, no point sleeping again\n    }\n    // Sleep\n    try {\n      await sleep({ millis: t, signal });\n    } catch (error) {\n      // Eg if abort signal fires\n      return {\n        success: false,\n        attempts,\n        value: opts.taskValueFallback,\n        message: getErrorMessage(error),\n        elapsed: startedAt(),\n      };\n    }\n  }\n\n  return {\n    message: `Giving up after ${ attempts } attempts.`,\n    success: false,\n    attempts,\n    value: opts.taskValueFallback,\n    elapsed: startedAt(),\n  };\n};\n","/**\n * Runs a function once\n *\n * ```js\n * const init = runOnce(() => {\n *  // do some initialisation\n * });\n *\n * init(); // Runs once\n * init(); // no-op\n * ```\n * @param onRun\n * @returns\n */\nexport const runOnce = (onRun: () => boolean): (() => boolean) => {\n  //eslint-disable-next-line functional/no-let\n  let run = false;\n  //eslint-disable-next-line functional/no-let\n  let success = false;\n  return () => {\n    if (run) return success;\n    run = true;\n    success = onRun();\n    return success;\n  };\n};\n","/**\n * Simple synchronisation. Supports only a single signal/waiter.\n * Expects one or more calls to .signal() for .forSignal() to resolve\n * \n * ```js\n * const sw = new SyncWait();\n * obj.addEventListener(`click`, () => {\n *  sw.signal();\n * });\n * \n * // Wait until click event\n * await sw.forSignal();\n * ```\n * \n * `forSignal` can also take a maximum time to wait. If the\n * time elapses, an exception is thrown.\n * \n * {@link didSignal} returns _true_/_false_ if signal happened rather\n * than throwing an exception.\n * \n */\nexport class SyncWait {\n  #resolve?: (value?: any) => void;\n  #reject?: (reason?: string) => void;\n  #promise?: Promise<any>;\n\n  signal() {\n    if (this.#resolve) {\n      this.#resolve();\n      this.#resolve = undefined;\n    }\n    this.#promise = Promise.resolve();\n  }\n\n  /**\n   * Throw away any previous signalled state.\n   * This will cause any currently waiters to throw\n   */\n  flush() {\n    if (this.#reject) {\n      this.#reject(`Flushed`);\n      this.#reject = undefined;\n    }\n    this.#resolve = undefined;\n    this.#promise = undefined;\n  }\n\n  #initPromise() {\n    const p = new Promise((resolve, reject) => {\n      this.#resolve = resolve;\n      this.#reject = reject;\n    });\n    this.#promise = p;\n    return p;\n  }\n\n  /**\n   * Call with `await` to wait until .signal() happens.\n   * If a wait period is specified, an exception is thrown if signal does not happen within this time.\n   * @param maximumWaitMs \n   */\n  async forSignal(maximumWaitMs?: number) {\n    let p = this.#promise;\n    if (!p) p = this.#initPromise();\n    if (maximumWaitMs) {\n      const reject = this.#reject;\n      setTimeout(() => {\n        if (reject) {\n          reject(`Timeout elapsed ${ maximumWaitMs }`);\n        }\n      }, maximumWaitMs);\n    }\n    await p;\n    this.#promise = undefined;\n    this.#resolve = undefined;\n    this.#reject = undefined;\n  }\n\n  /**\n   * An alternative to {@link forSignal}, returning _true_\n   * if signalled, or _false_ if wait period was exceeded \n   * \n   * ```js\n   * const s = await sw.didSignal(5000);\n   * ```\n   * @param maximumWaitMs \n   * @returns \n   */\n  async didSignal(maximumWaitMs: number): Promise<boolean> {\n    try {\n      await this.forSignal(maximumWaitMs);\n      return true;\n    } catch {\n      return false;\n    }\n  }\n}","import { SimpleEventEmitter } from '../Events.js';\nimport { mutable } from '../collections/queue/QueueMutable.js';\nimport { continuously } from './Continuously.js';\n\nexport type AsyncTask = () => Promise<void>;\n\nexport type TaskQueueEvents = {\n  /**\n   * Task queue has emptied.\n   * @returns\n   */\n  empty: any\n  /**\n   * Task queue was empty and now processing\n   * @returns \n   */\n  started: any\n}\n\n/**\n * Simple task queue. Each task is awaited and run\n * in turn.\n * \n * The TaskQueueMutable is shared across your code,\n * so you don't create it directly. Rather, use:\n * \n * ```js\n * import { TaskQueueMutable } from \"https://unpkg.com/ixfx/dist/flow.js\"\n * const queue = TaskQueueMutable.shared;\n * ```\n *\n * @example Usage\n * ```js\n * import { TaskQueueMutable, sleep } from \"https://unpkg.com/ixfx/dist/flow.js\"\n * const queue = TaskQueueMutable.shared;\n * q.enqueue(async () => {\n *  // Takes one second to run\n *  await sleep(1000);\n * });\n * ```\n * \n * You can listen to events from the TaskQueue:\n * ```js\n * TaskQueueMutable.shared.addEventListener(`started`, () => {\n *  // Queue was empty, now started processing\n * });\n * \n * TaskQueueMutable.shared.addEventListener(`empty`, () => {\n *  // Queue has finished processing all items\n * });\n * ```\n */\nexport class TaskQueueMutable extends SimpleEventEmitter<TaskQueueEvents> {\n  static readonly shared = new TaskQueueMutable();\n  private _loop;\n  private _queue;\n\n  private constructor() {\n    super();\n    this._queue = mutable<AsyncTask>();\n    this._loop = continuously(() => {\n      return this.processQueue();\n    }, 100);\n  }\n\n  /**\n   * Adds a task. This triggers processing loop if not already started.\n   *\n   * ```js\n   * queue.add(async () => {\n   *  await sleep(1000);\n   * });\n   * ```\n   * @param task Task to run\n   */\n  enqueue(task: () => Promise<void>) {\n    const length = this._queue.enqueue(task);\n    if (this._loop.runState === `idle`) {\n      this.fireEvent(`started`, {});\n      this._loop.start();\n    }\n    return length;\n  }\n\n  dequeue() {\n    return this._queue.dequeue();\n  }\n\n  private async processQueue() {\n    const task = this._queue.dequeue();\n    if (task === undefined) {\n      this.fireEvent(`empty`, {});\n      return false;\n\n    }\n\n    try {\n      await task();\n    } catch (error) {\n      console.error(error);\n    }\n\n  }\n\n  /**\n   * Clears all tasks, and stops any scheduled processing.\n   * Currently running tasks will continue.\n   * @returns \n   */\n  clear() {\n    if (this._queue.length === 0) return;\n    this._queue.clear();\n    this._loop.cancel();\n    this.fireEvent(`empty`, {});\n  }\n\n  /**\n  * Returns true if queue is empty\n  */\n  get isEmpty() {\n    return this._queue.isEmpty;\n  }\n\n\n  /**\n   * Number of items in queue\n   */\n  get length() {\n    return this._queue.length\n  }\n}\n","/***\n * Throttles a function. Callback only allowed to run after minimum of `intervalMinMs`.\n *\n * @example Only handle move event every 500ms\n * ```js\n * const moveThrottled = throttle( (elapsedMs, args) => {\n *  // Handle ar\n * }, 500);\n * el.addEventListener(`pointermove`, moveThrottled)\n * ```\n *\n * Note that `throttle` does not schedule invocations, but rather acts as a filter that\n * sometimes allows follow-through to `callback`, sometimes not. There is an expectation then\n * that the return function from `throttle` is repeatedly called, such as the case for handling\n * a stream of data/events.\n *\n * @example Manual trigger\n * ```js\n * // Set up once\n * const t = throttle( (elapsedMs, args) => { ... }, 5000);\n *\n * // Later, trigger throttle. Sometimes the callback will run,\n * // with data passed in to args[0]\n * t(data);\n * ```\n */\nexport const throttle = (\n  callback: (\n    elapsedMs: number,\n    ...args: readonly unknown[]\n  ) => void | Promise<unknown>,\n  intervalMinMs: number\n) => {\n  //eslint-disable-next-line functional/no-let\n  let trigger = 0;\n  //eslint-disable-next-line functional/prefer-immutable-types\n  return async (...args: unknown[]) => {\n    const elapsed = performance.now() - trigger;\n    if (elapsed >= intervalMinMs) {\n      const r = callback(elapsed, ...args);\n      if (typeof r === `object`) await r;\n      trigger = performance.now();\n    }\n  };\n};\n","import { intervalToMs, type Interval } from \"./IntervalType.js\";\n\nexport type UpdateFailPolicy = `fast` | `slow` | `backoff`;\n/**\n * Calls the async `fn` to generate a value if there is no prior value or\n * `interval` has elapsed since value was last generated.\n * @example\n * ```js\n * const f = updateOutdated(async () => {\n *  const r = await fetch(`blah`);\n *  return await r.json();\n * }, 60*1000);\n *\n * // Result will be JSON from fetch. If fetch happened already in the\n * // last 60s, return cached result. Otherwise it will fetch data\n * const result = await f();\n * ```\n *\n * Callback `fn` is passed how many milliseconds have elapsed since last update. Its minimum value will be `interval`.\n *\n * ```js\n * const f = updateOutdated(async elapsedMs => {\n *  // Do something with elapsedMs?\n * }, 60*1000;\n * ```\n *\n * There are different policies for what to happen if `fn` fails. `slow` is the default.\n * * `fast`: Invocation will happen immediately on next attempt\n * * `slow`: Next invocation will wait `interval` as if it was successful\n * * `backoff`: Attempts will get slower and slower until next success. Interval is multipled by 1.2 each time.\n *\n * @param fn Async function to call. Must return a value.\n * @param interval Maximum age of cached result\n * @param updateFail `slow` by default\n * @typeParam V - Return type of `fn`\n * @returns Value\n */\nexport const updateOutdated = <V>(\n  fn: (elapsedMs?: number) => Promise<V>,\n  interval: Interval,\n  updateFail: UpdateFailPolicy = `slow`\n): (() => Promise<V>) => {\n  let lastRun = 0;\n  let lastValue: V | undefined;\n  let intervalMsCurrent = intervalToMs(interval, 1000);\n\n  return () =>\n    // eslint-disable-next-line @typescript-eslint/no-misused-promises\n    new Promise(async (resolve, reject) => {\n      const elapsed = performance.now() - lastRun;\n      if (lastValue === undefined || elapsed > intervalMsCurrent) {\n        try {\n          lastRun = performance.now();\n          lastValue = await fn(elapsed);\n          intervalMsCurrent = intervalToMs(interval, 1000);\n        } catch (error) {\n          if (updateFail === `fast`) {\n            lastValue = undefined;\n            lastRun = 0;\n          } else if (updateFail === `backoff`) {\n            intervalMsCurrent = Math.floor(intervalMsCurrent * 1.2);\n          }\n          // eslint-disable-next-line @typescript-eslint/prefer-promise-reject-errors\n          reject(error);\n          return;\n        }\n      }\n      resolve(lastValue);\n    });\n};\n","/**\n * Helper function for calling code that should fail after a timeout.\n * In short, it allows you to signal when the function succeeded, to cancel it, or\n * to be notified if it was canceled or completes.\n *\n * It does not execute or track the outcome of execution itself. Rather it's a bit\n * of machinery that needs to be steered by your own logic.\n * \n * `waitFor` takes a timeout, and two lifecycle functions, `onAborted` and `onComplete`.\n * `onAborted` is called if the timeout has elapsed. `onComplete` will run on either success or failure.\n * \n * ```js\n * waitFor(1000, \n * (error) => {\n *  // Failed\n * },\n * (success) => {\n *  if (success) {\n *    // Succeeded\n *  }\n * });\n * ```\n * \n * When calling `waitFor` you get back a function to signal success or failure:\n * ```js\n * const done = waitFor(1000, onAborted, onComplete);\n * done();          // No parameters signals success\n * done('failed');  // A string parameter indicates failure\n * ```\n * \n * @example Compact\n * ```js\n * const done = waitFor(1000,\n *  (reason) => {\n *    console.log(`Aborted: ${reason}`);\n *  });\n *\n * try {\n *  runSomethingThatMightScrewUp();\n *  done(); // Signal it succeeded\n * } catch (e) {\n *  done(e); // Signal there was an error\n * }\n * ```\n * \n * @example Verbose\n * ```js\n * // This function is called by `waitFor` if it was cancelled\n * const onAborted = (reason:string) => {\n *  // 'reason' is a string describing why it has aborted.\n *  // ie: due to timeout or because done() was called with an error\n * };\n *\n * // This function is called by `waitFor` if it completed\n * const onComplete = (success:boolean) => {\n *  // Called if we were aborted or finished succesfully.\n *  // onComplete will be called after onAborted, if it was an error case\n * }\n *\n * // If done() is not called after 1000, onAborted will be called\n * // if done() is called or there was a timeout, onComplete is called\n * const done = waitFor(1000, onAborted, onComplete);\n *\n * // Signal completed successfully (thus calling onComplete(true))\n * done();\n *\n * // Signal there was an error (thus calling onAborted and onComplete(false))\n * done(`Some error`);\n * ```\n *\n * The completion handler is useful for removing event handlers.\n *\n\n * @param timeoutMs\n * @param onAborted\n * @param onComplete\n * @returns\n */\nexport const waitFor = (\n  timeoutMs: number,\n  onAborted: (reason: string) => void,\n  onComplete?: (success: boolean) => void\n) => {\n  let t: ReturnType<typeof globalThis.setTimeout> | undefined;\n\n  let success = false;\n  const done = (error?: string) => {\n    if (t !== undefined) {\n      window.clearTimeout(t);\n      t = undefined;\n    }\n    if (error) {\n      onAborted(error);\n    } else {\n      success = true;\n    }\n    if (onComplete !== undefined) onComplete(success);\n  };\n\n  t = globalThis.setTimeout(() => {\n    t = undefined;\n    try {\n      onAborted(`Timeout after ${ timeoutMs }ms`);\n    } finally {\n      if (onComplete !== undefined) onComplete(success);\n    }\n  }, timeoutMs);\n\n  return done;\n};\n","import { promiseWithResolvers } from \"./PromiseWithResolvers.js\";\n\n/**\n * Queue of a single item, only once.\n * \n * Allows for simple synchronisation.\n * ```js\n * const q = Flow.waitForValue();\n * \n * // In some part of the code add a value\n * const value = q.add();\n * \n * // Somewhere else, wait for value\n * await q.get(value);\n * ```\n * \n * It is not possible to `add` a second item, however\n * it is possible to call `get` as many times as you need.\n * \n * The `.isUsed` property allows you to to check if a value\n * has been already added to the queue.\n * \n * Based on: https://2ality.com/2024/05/proposal-promise-with-resolvers.html\n */\nexport class WaitForValue<T> {\n  #promise\n  #resolve\n  #written = false;\n  constructor() {\n    const { promise, resolve } = promiseWithResolvers<T>();\n    this.#promise = promise;\n    this.#resolve = resolve;\n  }\n\n\n  get(): Promise<T> {\n    return this.#promise;\n  }\n\n  add(value: T) {\n    if (this.#written) throw new Error(`QueueSingleUse has already been used`);\n    this.#written = true;\n    this.#resolve(value);\n  }\n\n  /**\n   * Returns _true_ if a value has been added\n   * and therefore no more values can be written\n   */\n  get isUsed() {\n    return this.#written;\n  }\n}\n\nexport const singleItem = <T>() => new WaitForValue<T>();","/* eslint-disable @typescript-eslint/no-non-null-assertion,functional/immutable-data */\nimport { continuously, delayLoop } from '../flow/index.js';\n\n//eslint-disable-next-line functional/no-mixed-types\nexport type Capturer = {\n  start(): void;\n  cancel(): void;\n  readonly canvasEl: HTMLCanvasElement;\n};\n\n//eslint-disable-next-line functional/no-mixed-types\nexport type ManualCapturer = {\n  capture(): ImageData;\n  readonly canvasEl: HTMLCanvasElement;\n  dispose(): void;\n};\n\n//eslint-disable-next-line functional/no-mixed-types\nexport type CaptureOpts = {\n  /**\n   * Delay between reading frames.\n   * Default: 0, reading as fast as possible\n   */\n  readonly maxIntervalMs?: number;\n  /**\n   * Whether to show the created capture canvas.\n   * Default: false\n   */\n  readonly showCanvas?: boolean;\n  readonly workerScript?: string;\n  readonly onFrame?: (pixels: ImageData) => void;\n};\n\n//eslint-disable-next-line functional/no-mixed-types\nexport type ManualCaptureOpts = {\n  /**\n   * If true, the intermediate canvas is shown\n   * The intermediate canvas is where captures from the source are put in order\n   * to get the ImageData\n   */\n  readonly showCanvas?: boolean;\n  /**\n   * If specified, this function will be called after ImageData is captured\n   * from the intermediate canvs. This allows for drawing on top of the\n   * captured image.\n   */\n  readonly postCaptureDraw?: (\n    ctx: CanvasRenderingContext2D,\n    width: number,\n    height: number\n  ) => void;\n\n  /**\n   * If specified, this is the canvas captured to\n   */\n  readonly canvasEl?: HTMLCanvasElement;\n};\n\n/**\n * Options for frames generator\n */\nexport type FramesOpts = {\n  /**\n   * Max frame rate (millis per frame), or 0 for animation speed\n   */\n  readonly maxIntervalMs?: number;\n  /**\n   * False by default, created canvas will be hidden\n   */\n  readonly showCanvas?: boolean;\n  /**\n   * If provided, this canvas will be used as the buffer rather than creating one.\n   */\n  readonly canvasEl?: HTMLCanvasElement;\n};\n\n/**\n * Generator that yields frames from a video element as [ImageData](https://developer.mozilla.org/en-US/docs/Web/API/ImageData).\n *\n * ```js\n * import { Video } from 'https://unpkg.com/ixfx/dist/visual.js'\n *\n * const ctx = canvasEl.getContext(`2d`);\n * for await (const frame of Video.frames(videoEl)) {\n *   // TODO: Some processing of pixels\n *\n *   // Draw image on to the visible canvas\n *   ctx.putImageData(frame, 0, 0);\n * }\n * ```\n *\n * Under the hood it creates a hidden canvas where frames are drawn to. This is necessary\n * to read back pixel data. An existing canvas can be used if it is passed in as an option.\n *\n * Options:\n * * `canvasEl`: CANVAS element to use as a buffer (optional)\n * * `maxIntervalMs`: Max frame rate (0 by default, ie runs as fast as possible)\n * * `showCanvas`: Whether buffer canvas will be shown (false by default)\n * @param sourceVideoEl\n * @param opts\n */\n//eslint-disable-next-line func-style\nexport async function* frames(\n  sourceVideoEl: HTMLVideoElement,\n  opts: FramesOpts = {}\n): AsyncIterable<ImageData> {\n  // TODO: Ideally use OffscreenCanvas when it has wider support?\n  // TODO: When ImageBitmap has possibility to get pixels, that might also help to avoid having to write to hidden canvas\n\n  const maxIntervalMs = opts.maxIntervalMs ?? 0;\n\n  const showCanvas = opts.showCanvas ?? false;\n  //eslint-disable-next-line functional/no-let\n  let canvasEl = opts.canvasEl;\n  //eslint-disable-next-line functional/no-let\n  let w, h;\n  w = h = 0;\n\n  // Create & setup canvas\n  if (canvasEl === undefined) {\n    canvasEl = document.createElement(`CANVAS`) as HTMLCanvasElement;\n    canvasEl.classList.add(`ixfx-frames`);\n    if (!showCanvas) {\n      canvasEl.style.display = `none`;\n    }\n    document.body.appendChild(canvasEl);\n  }\n\n  // Update size of canvas based on video\n  const updateSize = () => {\n    if (canvasEl === undefined) return;\n    w = sourceVideoEl.videoWidth;\n    h = sourceVideoEl.videoHeight;\n    canvasEl.width = w;\n    canvasEl.height = h;\n  };\n\n  //eslint-disable-next-line functional/no-let\n  let c: CanvasRenderingContext2D | null = null;\n\n  const looper = delayLoop(maxIntervalMs);\n  for await (const _ of looper) {\n    // If we don't yet have the size of video, get it\n    if (w === 0 || h === 0) updateSize();\n\n    // If there is still no dimensions (ie stream has not started), there's nothing to do yet\n    if (w === 0 || h === 0) continue;\n\n    // Draw current frame from video element to hidden canvas\n    if (c === null) c = canvasEl.getContext(`2d`);\n    if (c === null) return;\n    c.drawImage(sourceVideoEl, 0, 0, w, h);\n\n    // Get pixels\n    const pixels = c.getImageData(0, 0, w, h);\n    yield pixels;\n  }\n}\n\n/**\n * Captures frames from a video element. It can send pixel data to a function or post to a worker script.\n *\n * @example Using a function\n * ```js\n * import {Video} from 'https://unpkg.com/ixfx/dist/visual.js'\n *\n * // Capture from a VIDEO element, handling frame data\n * // imageData is ImageData type: https://developer.mozilla.org/en-US/docs/Web/API/ImageData\n * Video.capture(sourceVideoEl, {\n *  onFrame(imageData => {\n *    // Do something with pixels...\n *  });\n * });\n * ```\n *\n * @example Using a worker\n * ```js\n * import {Video} from 'https://unpkg.com/ixfx/dist/visual.js'\n *\n * Video.capture(sourceVideoEl, {\n *  workerScript: `./frameProcessor.js`\n * });\n * ```\n *\n * In frameProcessor.js:\n * ```\n * const process = (frame) => {\n *  // ...process frame\n *\n *  // Send image back?\n *  self.postMessage({frame});\n * };\n *\n * self.addEventListener(`message`, evt => {\n *   const {pixels, width, height} = evt.data;\n *   const frame = new ImageData(new Uint8ClampedArray(pixels),\n *     width, height);\n *\n *   // Process it\n *   process(frame);\n * });\n * ```\n *\n * Options:\n * * `canvasEl`: CANVAS element to use as a buffer (optional)\n * * `maxIntervalMs`: Max frame rate (0 by default, ie runs as fast as possible)\n * * `showCanvas`: Whether buffer canvas will be shown (false by default)\n * * `workerScript`: If this specified, this URL will be loaded as a Worker, and frame data will be automatically posted to it\n *\n * Implementation: frames are captured using a animation-speed loop to a hidden canvas. From there\n * the pixel data is extracted and sent to either destination. In future the intermediate drawing to a\n * canvas could be skipped if it becomes possible to get pixel data from an ImageBitmap.\n * @param sourceVideoEl Source VIDEO element\n * @param opts\n * @returns\n */\nexport const capture = (\n  sourceVideoEl: HTMLVideoElement,\n  opts: CaptureOpts = {}\n): Capturer => {\n  const maxIntervalMs = opts.maxIntervalMs ?? 0;\n  const showCanvas = opts.showCanvas ?? false;\n  const onFrame = opts.onFrame;\n\n  // Ideally use OffscreenCanvas when it has support?\n  const w = sourceVideoEl.videoWidth;\n  const h = sourceVideoEl.videoHeight;\n\n  // Create canvas\n  const canvasEl = document.createElement(`CANVAS`) as HTMLCanvasElement;\n  canvasEl.classList.add(`ixfx-capture`);\n\n  if (!showCanvas) {\n    canvasEl.style.display = `none`;\n  }\n  canvasEl.width = w;\n  canvasEl.height = h;\n  let c: CanvasRenderingContext2D | null = null;\n  let worker: Worker | undefined;\n  if (opts.workerScript) {\n    worker = new Worker(opts.workerScript);\n  }\n\n  // Should we get image data?\n  const getPixels = worker || onFrame;\n  if (!getPixels && !showCanvas) {\n    console.warn(\n      `Video will be captured to hidden element without any processing. Is this what you want?`\n    );\n  }\n\n  const loop = continuously(() => {\n    // Draw current frame from video element to hidden canvas\n    if (c === null) c = canvasEl.getContext(`2d`);\n    if (c === null) return;\n    c.drawImage(sourceVideoEl, 0, 0, w, h);\n    //eslint-disable-next-line functional/no-let\n    let pixels: ImageData | undefined;\n\n    if (getPixels) {\n      // ImageData necessary\n      pixels = c.getImageData(0, 0, w, h);\n    }\n\n    if (worker) {\n      // Send to worker\n      worker.postMessage(\n        {\n          pixels: pixels!.data.buffer,\n          width: w,\n          height: h,\n          channels: 4,\n        },\n        [ pixels!.data.buffer ]\n      );\n    }\n    if (onFrame) {\n      // Send to callback\n      try {\n        onFrame(pixels!);\n      } catch (e) {\n        console.error(e);\n      }\n    }\n  }, maxIntervalMs);\n\n  return {\n    start: () => loop.start(),\n    cancel: () => loop.cancel(),\n    canvasEl,\n  };\n};\n\nexport const manualCapture = (\n  sourceVideoEl: HTMLVideoElement,\n  opts: ManualCaptureOpts = {}\n): ManualCapturer => {\n  const showCanvas = opts.showCanvas ?? false;\n\n  // Ideally use OffscreenCanvas when it has support?\n  const w = sourceVideoEl.videoWidth;\n  const h = sourceVideoEl.videoHeight;\n\n  // Create canvas if necessary\n  const definedCanvasEl = opts.canvasEl !== undefined;\n  //eslint-disable-next-line functional/no-let\n  let canvasEl = opts.canvasEl;\n  if (!canvasEl) {\n    canvasEl = document.createElement(`CANVAS`) as HTMLCanvasElement;\n    canvasEl.classList.add(`ixfx-capture`);\n    document.body.append(canvasEl);\n    if (!showCanvas) canvasEl.style.display = `none`;\n  }\n\n  canvasEl.width = w;\n  canvasEl.height = h;\n\n  const capture = (): ImageData => {\n    //eslint-disable-next-line functional/no-let\n    let c: CanvasRenderingContext2D | undefined | null;\n\n    // Draw current frame from video element to canvas\n    if (!c) c = canvasEl?.getContext(`2d`, { willReadFrequently: true });\n    if (!c) throw new Error(`Could not create graphics context`);\n    c.drawImage(sourceVideoEl, 0, 0, w, h);\n\n    //eslint-disable-next-line functional/no-let\n    const pixels = c.getImageData(0, 0, w, h);\n\n    //eslint-disable-next-line @typescript-eslint/no-explicit-any\n    (pixels as any).currentTime = sourceVideoEl.currentTime;\n\n    if (opts.postCaptureDraw) opts.postCaptureDraw(c, w, h);\n    return pixels;\n  };\n\n  const dispose = (): void => {\n    if (definedCanvasEl) return; // we didn't create it\n    try {\n      canvasEl?.remove();\n    } catch (_) {\n      // no-op\n    }\n  };\n\n  const c: ManualCapturer = {\n    canvasEl,\n    capture,\n    dispose,\n  };\n  return c;\n};\n","\nimport { type RandomOptions, type RandomSource, defaultRandom } from \"./Types.js\";\nimport { throwNumberTest } from '../util/GuardNumbers.js';\n/**\n * Returns a function that produces random float values.\n * Use {@link float} to produce a valued directly.\n *\n * Random float between `max` (exclusive) and 0 (inclusive). Max is 1 if unspecified.\n *\n *\n * ```js\n * // Random number between 0..1 (but not including 1)\n * // (this would be identical to Math.random())\n * const r = floatSource();\n * r(); // Execute to produce random value\n *\n * // Random float between 0..100 (but not including 100)\n * const v = floatSource(100)();\n * ```\n *\n * Options can be used:\n * ```js\n * // Random float between 20..40 (possibly including 20, but always lower than 40)\n * const r = floatSource({ min: 20, max: 40 });\n * ```\n * @param maxOrOptions Maximum value (exclusive) or options\n * @returns Random number\n */\nexport const floatSource = (maxOrOptions: (number | RandomOptions) = 1): RandomSource => {\n  const options = typeof maxOrOptions === `number` ? { max: maxOrOptions } : maxOrOptions;\n  //eslint-disable-next-line functional/no-let\n  let max = options.max;\n  //eslint-disable-next-line functional/no-let\n  let min = options.min ?? 0;\n  const source = options.source ?? defaultRandom;\n\n  throwNumberTest(min, ``, `min`);\n  throwNumberTest(max, ``, `max`);\n\n  if (!options.min && max < 0) {\n    min = max;\n    max = 0;\n  }\n  if (min > max) {\n    throw new Error(`Min is greater than max. Min: ${ min } max: ${ max }`);\n  }\n\n  return () => source() * (max - min) + min;\n};\n\n/**\n * Returns a random float between `max` (exclusive) and 0 (inclusive). Max is 1 if unspecified.\n * Use {@link floatSource} to get a function that produces values. This is used internally.\n *\n * ```js\n * // Random number between 0..1 (but not including 1)\n * // (this would be identical to Math.random())\n * const v = float();\n * // Random float between 0..100 (but not including 100)\n * const v = float(100);\n * ```\n *\n * Options can be used:\n * ```js\n * // Random float between 20..40 (possibly including 20, but always lower than 40)\n * const v = float({ min: 20, max: 40 });\n * ```\n * @param maxOrOptions Maximum value (exclusive) or options\n * @returns Random number\n */\nexport const float = (maxOrOptions: (number | RandomOptions) = 1): number =>\n  floatSource(maxOrOptions)();","import { throwIntegerTest } from \"../util/GuardNumbers.js\";\n\n/**\n * Yields `amount` integers, counting by one from zero. If a negative amount is used,\n * count decreases. If `offset` is provided, this is added to the return result.\n * @example\n * ```js\n * const a = [...count(5)]; // Yields five numbers: [0,1,2,3,4]\n * const b = [...count(-5)]; // Yields five numbers: [0,-1,-2,-3,-4]\n * for (const v of count(5, 5)) {\n *  // Yields: 5, 6, 7, 8, 9\n * }\n * const c = [...count(5,1)]; // Yields [1,2,3,4,5]\n * ```\n *\n * @example Used with forEach\n * ```js\n * // Prints `Hi` 5x\n * forEach(count(5), () => // do something);\n * ```\n *\n * If you want to accumulate return values, consider using Flow.repeat.\n *\n * @example Run some code every 100ms, 10 times:\n * ```js\n * import { interval } from 'https://unpkg.com/ixfx/dist/flow.js'\n * import { count } from 'https://unpkg.com/ixfx/dist/numbers.js'\n * const counter = count(10);\n * for await (const v of interval(counter, { fixedIntervalMs: 100 })) {\n *  // Do something\n * }\n * ```\n * @param amount Number of integers to yield\n * @param offset Added to result\n */\nexport function* count(amount: number, offset = 0): Generator<number, void, void> {\n  // Unit tested.\n  throwIntegerTest(amount, ``, `amount`);\n  throwIntegerTest(offset, ``, `offset`);\n\n  if (amount === 0) return;\n\n  let index = 0;\n  do {\n    yield (amount < 0 ? -index + offset : index + offset);\n  } while (index++ < Math.abs(amount) - 1);\n};","//const sqrt = Math.sqrt;\nconst pow = Math.pow;\n//const pi = Math.PI;\n//const piPi = Math.PI*2;\nconst gaussianA = 1 / Math.sqrt(2 * Math.PI);\n\n/**\n * Returns a roughly gaussian easing function\n * ```js\n * import { Easings } from \"https://unpkg.com/ixfx/dist/modulation.js\";\n * const fn = Easings.gaussian();\n * ```\n *\n * Try different positive and negative values for `stdDev` to pinch\n * or flatten the bell shape.\n * @param standardDeviation\n * @returns\n */\nexport const gaussian = (standardDeviation = 0.4) => {\n  //const a = 1 / sqrt(2 * pi);\n  const mean = 0.5;\n\n  return (t: number) => {\n    const f = gaussianA / standardDeviation;\n    // p:-8 pinched\n    let p = -2.5; // -1/1.25;\n    let c = (t - mean) / standardDeviation;\n    c *= c;\n    p *= c;\n    const v = f * pow(Math.E, p); // * (2/pi);//0.62;\n    if (v > 1) return 1;\n    if (v < 0) return 0;\n    return v;\n  };\n};","import { intervalToMs, type Interval } from \"../flow/IntervalType.js\";\nimport type { Modulate, ModulatorTimed } from \"./Types.js\";\nimport * as Timer from '../flow/Timer.js';\nimport { throwFunctionTest } from \"../util/GuardFunction.js\";\n\n/**\n * Produce values over time. When the modulate is complete, the final\n * value continues to return. Timer starts when return function is first invoked.\n * \n * ```js\n * const fn = (t) => {\n *  // 't' will be values 0..1 where 1 represents end of time period.\n *  // Return some computed value based on 't'\n *  return t*Math.random();\n * }\n * const e = Modulate.time(fn, 1000);\n * \n * // Keep calling e() to get the current value\n * e();\n * ```\n * @param fn Modulate function\n * @param duration Duration\n * @returns \n */\nexport const time = (\n  fn: Modulate,\n  duration: Interval\n): () => number => {\n  throwFunctionTest(fn, `fn`);\n  let relative: undefined | (() => number);\n  return () => {\n    if (relative === undefined) relative = Timer.ofTotal(duration, { clampValue: true });\n    return fn(relative());\n  }\n}\n\n/**\n * Creates an modulator based on clock time. Time\n * starts being counted when modulate function is created.\n * \n * `timeModulator` allows you to reset and check for completion.\n * Alternatively, use {@link time} which is a simple function that just returns a value.\n *\n * @example Time based easing\n * ```\n * import { timeModulator } from \"https://unpkg.com/ixfx/dist/modulation.js\";\n * const fn = (t) => {\n *  // 't' will be a value 0..1 representing time elapsed. 1 being end of period.\n *  return t*Math.random();\n * }\n * const t = timeModulator(fn, 5*1000); // Will take 5 seconds to complete\n * ...\n * t.compute(); // Get current value of modulator\n * t.reset();   // Reset to 0\n * t.isDone;    // _True_ if finished\n * ```\n * @param fn Modulator\n * @param duration Duration\n * @returns ModulatorTimed\n */\nexport const timeModulator = (\n  fn: Modulate,\n  duration: Interval\n): ModulatorTimed => {\n  throwFunctionTest(fn, `fn`);\n\n  const timer = Timer.elapsedMillisecondsAbsolute();\n  const durationMs = intervalToMs(duration);\n  if (durationMs === undefined) throw new Error(`Param 'duration' not provided`);\n  const relativeTimer = Timer.relative(\n    durationMs,\n    {\n      timer,\n      clampValue: true\n    });\n  return Timer.timerWithFunction(fn, relativeTimer);\n};\n\n/**\n * Produce modulate values with each invocation. When the time is complete, the final\n * value continues to return. Timer starts when return function is first invoked.\n * \n * If you need to check if a modulator is done or reset it, consider {@link tickModulator}.\n * \n * ```js\n * const fn = (t) => {\n *  // 't' will be values 0..1 representing elapsed ticks toward totwal\n * }\n * const e = ticks(fn, 100);\n * \n * // Keep calling e() to get the current value\n * e();\n * ```\n * @param fn Function that produces 0..1 scale\n * @param totalTicks Total length of ticks\n * @returns \n */\nexport const ticks = (\n  fn: Modulate,\n  totalTicks: number\n): () => number => {\n  throwFunctionTest(fn, `fn`);\n\n  let relative: undefined | (() => number);\n  return () => {\n    if (relative === undefined) relative = Timer.ofTotalTicks(totalTicks, { clampValue: true });\n    return fn(relative());\n  }\n}\n\n/**\n * Creates an modulator based on ticks. \n * \n * `tickModulator` allows you to reset and check for completion.\n * Alternatively, use {@link ticks} which is a simple function that just returns a value.\n *\n * @example Tick-based modulator\n * ```\n * import { tickModulator } from \"https://unpkg.com/ixfx/dist/modulation.js\";\n * const fn = (t) => {\n *  // 't' will be values 0..1 based on completion\n *  return Math.random() * t;\n * }\n * const t = tickModulator(fn, 1000);   // Will take 1000 ticks to complete\n * t.compute(); // Each call to `compute` progresses the tick count\n * t.reset();   // Reset to 0\n * t.isDone;    // _True_ if finished\n * ```\n * @param fn Modulate function that returns 0..1\n * @param durationTicks Duration in ticks\n * @returns ModulatorTimed\n */\nexport const tickModulator = (\n  fn: Modulate,\n  durationTicks: number\n): ModulatorTimed => {\n  throwFunctionTest(fn, `fn`);\n  const timer = Timer.elapsedTicksAbsolute();\n  const relativeTimer = Timer.relative(\n    durationTicks,\n    {\n      timer,\n      clampValue: true\n    });\n  return Timer.timerWithFunction(fn, relativeTimer);\n};","import * as Named from './EasingsNamed.js';\nimport { throwStringTest } from '../../util/GuardString.js';\nimport { type Interval } from '../../flow/IntervalType.js';\nimport type { Modulate, ModulatorTimed } from '../Types.js';\nexport * as Named from './EasingsNamed.js';\nimport * as ModTimed from '../ModulatorTimed.js';\n\n/**\n * Easing name\n */\nexport type EasingName = keyof typeof Named;\n\nexport type Options = (TickOptions | TimeOptions) & {\n  name?: EasingName\n  fn?: Modulate\n}\n\nexport type TimeOptions = {\n  duration: Interval\n}\nexport type TickOptions = {\n  ticks: number\n}\n\n/**\n * Creates an easing function\n * ```js\n * import { Easings } from \"https://unpkg.com/ixfx/dist/modulation.js\";\n * const e = Easings.create({ duration: 1000, name: `quadIn` });\n * const e = Easings.create({ ticks: 100, name: `sineOut` });\n * const e = Easings.create({ \n *  duration: 1000, \n *  fn: (v) => {\n *    // v will be 0..1 based on time\n *    return Math.random() * v\n *  }\n * });\n * ```\n * @param options \n * @returns \n */\nexport const create = (options: Options): () => number => {\n  let name = resolveEasingName(options.name ?? `quintIn`);\n  const fn = name ?? options.fn;\n  if (!fn) throw new Error(`Either 'name' or 'fn' must be set`);\n\n  if (`duration` in options) {\n    return time(fn, options.duration);\n  } else if (`ticks` in options) {\n    return ticks(fn, options.ticks);\n  } else {\n    throw new Error(`Expected 'duration' or 'ticks' in options`);\n  }\n}\n\n/**\n * Creates an easing based on clock time. Time\n * starts being counted when easing function is created.\n * \n * `timeEasing` allows you to reset and check for completion.\n * Alternatively, use {@link time} which is a simple function that just returns a value.\n *\n * \n * @example Time based easing\n * ```\n * import { Easings } from \"https://unpkg.com/ixfx/dist/modulation.js\";\n * const t = Easings.timeEasing(`quintIn`, 5*1000); // Will take 5 seconds to complete\n * ...\n * t.compute(); // Get current value of easing\n * t.reset();   // Reset to 0\n * t.isDone;    // _True_ if finished\n * ```\n * \n * Thisi function is just a wrapper around Modulator.timedModulator.\n * @param nameOrFunction Name of easing, or an easing function\n * @param duration Duration\n * @returns Easing\n */\nexport const timeEasing = (\n  nameOrFunction: EasingName | ((v: number) => number),\n  duration: Interval\n): ModulatorTimed => {\n  const fn = resolveEasingName(nameOrFunction);\n  return ModTimed.timeModulator(fn, duration);\n  // const timer = Timer.elapsedMillisecondsAbsolute();\n  // const durationMs = intervalToMs(duration);\n  // if (durationMs === undefined) throw new Error(`Param 'duration' not provided`);\n  // const relativeTimer = Timer.relative(\n  //   durationMs,\n  //   {\n  //     timer,\n  //     clampValue: true\n  //   });\n  // return Timer.timerWithFunction(fn, relativeTimer);\n};\n\n/**\n * Produce easing values over time. When the easing is complete, the final\n * value continues to return. Timer starts when return function is first invoked.\n * \n * If you need to check if an easing is done or reset it, consider {@link timeEasing}.\n * \n * ```js\n * import { Easings } from \"https://unpkg.com/ixfx/dist/modulation.js\";\n * // Quad-in easing over one second\n * const e = Easings.time(`quadIn`, 1000);\n * \n * // Keep calling e() to get the current value\n * e();\n * ```\n * \n * This function is just a wrapper around Modulate.time\n * @param nameOrFunction Easing name or a function that produces 0..1 scale\n * @param duration Duration\n * @returns \n */\nexport const time = (\n  nameOrFunction: EasingName | ((v: number) => number),\n  duration: Interval\n): () => number => {\n  const fn = resolveEasingName(nameOrFunction);\n  return ModTimed.time(fn, duration);\n  // let relative: undefined | (() => number);\n  // return () => {\n  //   if (relative === undefined) relative = Timer.ofTotal(duration, { clampValue: true });\n  //   return fn(relative());\n  // }\n}\n\n\n/**\n * Produce easing values with each invocation. When the easing is complete, the final\n * value continues to return. Timer starts when return function is first invoked.\n * \n * If you need to check if an easing is done or reset it, consider {@link tickEasing}.\n * \n * ```js\n * import { Easings } from \"https://unpkg.com/ixfx/dist/modulation.js\";\n * // Quad-in easing over 100 ticks\n * const e = Easings.ticks(`quadIn`, 100);\n * \n * // Keep calling e() to get the current value\n * e();\n * ```\n * \n * This is just a wrapper around Modulator.ticks\n * @param nameOrFunction Easing name or a function that produces 0..1 scale\n * @param totalTicks Total length of ticks\n * @returns \n */\nexport const ticks = (\n  nameOrFunction: EasingName | ((v: number) => number),\n  totalTicks: number\n): () => number => {\n  const fn = resolveEasingName(nameOrFunction);\n  return ModTimed.ticks(fn, totalTicks);\n  // let relative: undefined | (() => number);\n  // return () => {\n  //   if (relative === undefined) relative = Timer.ofTotalTicks(totalTicks, { clampValue: true });\n  //   return fn(relative());\n  // }\n}\n/**\n * Creates an easing based on ticks. \n * \n * `tickEasing` allows you to reset and check for completion.\n * Alternatively, use {@link ticks} which is a simple function that just returns a value.\n *\n * @example Tick-based easing\n * ```\n * import { Easings } from \"https://unpkg.com/ixfx/dist/modulation.js\";\n * const t = Easings.tickEasing(`sineIn`, 1000);   // Will take 1000 ticks to complete\n * t.compute(); // Each call to `compute` progresses the tick count\n * t.reset();   // Reset to 0\n * t.isDone;    // _True_ if finished\n * ```\n * @param nameOrFunction Name of easing, or an easing function\n * @param durationTicks Duration in ticks\n * @returns Easing\n */\nexport const tickEasing = (\n  nameOrFunction: EasingName | ((v: number) => number),\n  durationTicks: number\n): ModulatorTimed => {\n  const fn = resolveEasingName(nameOrFunction);\n  return ModTimed.tickModulator(fn, durationTicks);\n  // const timer = Timer.elapsedTicksAbsolute();\n  // const relativeTimer = Timer.relative(\n  //   durationTicks,\n  //   {\n  //     timer,\n  //     clampValue: true\n  //   });\n  // return Timer.timerWithFunction(fn, relativeTimer);\n};\n\nconst resolveEasingName = (nameOrFunction: EasingName | ((v: number) => number)): Modulate => {\n  const fn = typeof nameOrFunction === `function` ? nameOrFunction : get(nameOrFunction);\n  if (fn === undefined) {\n    const error = typeof nameOrFunction === `string` ? new Error(`Easing function not found: '${ nameOrFunction }'`) : new Error(`Easing function not found`);\n    throw error;\n  }\n  return fn;\n}\n\n\n/**\n * Creates a new easing by name\n *\n * ```js\n * import { Easings } from \"https://unpkg.com/ixfx/dist/modulation.js\";\n * const e = Easings.create(`circInOut`, 1000, elapsedMillisecondsAbsolute);\n * ```\n * @param nameOrFunction Name of easing, or an easing function\n * @param duration Duration (meaning depends on timer source)\n * @param timerSource Timer source\n * @returns\n */\n// const create = function (\n//   nameOrFunction: EasingName | ((v: number) => number),\n//   duration: number,\n//   timerSource: TimerSource\n// ): Easing {\n//   const fn = typeof nameOrFunction === `function` ? nameOrFunction : get(nameOrFunction);\n//   if (fn === undefined) {\n//     const error = typeof nameOrFunction === `string` ? new Error(`Easing function not found: '${ nameOrFunction }'`) : new Error(`Easing function not found`);\n//     throw error;\n//   }\n\n//   // Get a relative version of timer\n//   const timer = relativeTimer(duration, {\n//     timer: timerSource(),\n//     clampValue: true,\n//   });\n//   let startCount = 1;\n\n//   return {\n//     get isDone() {\n//       return timer.isDone;\n//     },\n//     get runState() {\n//       if (timer.isDone) return `idle`;\n//       return `scheduled`;\n//     },\n//     /**\n//      * Returns 1 if it has been created, returns +1 for each additional time the timer has been reset.\n//      */\n//     get startCount() {\n//       return startCount;\n//     },\n//     get startCountTotal() {\n//       return startCount;\n//     },\n//     compute: () => {\n//       const relative = timer.elapsed;\n//       return fn(relative);\n//     },\n//     reset: () => {\n//       timer.reset();\n//       startCount++;\n//     },\n//   };\n// };\n\n\nlet easingsMap: Map<string, ((v: number) => number)> | undefined;\n\n/**\n * Returns an easing function by name. Throws an error if\n * easing is not found.\n *\n * ```js\n * import { Easings } from \"https://unpkg.com/ixfx/dist/modulation.js\";\n * const fn = Easings.get(`sineIn`);\n * // Returns 'eased' transformation of 0.5\n * fn(0.5);\n * ```\n * @param easingName eg `sineIn`\n * @returns Easing function\n */\nexport const get = function (easingName: EasingName): Modulate {\n  throwStringTest(easingName, `non-empty`, `easingName`);\n\n  const found = cacheEasings().get(easingName.toLowerCase());\n  if (found === undefined) throw new Error(`Easing not found: '${ easingName }'`);\n  return found;\n};\n\n// Cache named easings\nfunction cacheEasings() {\n  if (easingsMap === undefined) {\n    easingsMap = new Map();\n    for (const [ k, v ] of Object.entries(Named)) {\n      easingsMap.set(k.toLowerCase(), v);\n    }\n    return easingsMap\n  } else return easingsMap;\n}\n\n/**\n * Iterate over available easings.\n * @private\n * @returns Returns list of available easing names\n */\nexport function* getEasingNames(): Iterable<string> {\n  const map = cacheEasings();\n  yield* map.keys();\n};\n","import { gaussian } from \"../Gaussian.js\";\n// Easings from https://easings.net/\n\nconst sqrt = Math.sqrt;\nconst pow = Math.pow;\nconst cos = Math.cos;\nconst pi = Math.PI;\nconst sin = Math.sin;\n\n\nexport const bounceOut = (x: number) => {\n  const n1 = 7.5625;\n  const d1 = 2.75;\n\n  if (x < 1 / d1) {\n    return n1 * x * x;\n  } else if (x < 2 / d1) {\n    return n1 * (x -= 1.5 / d1) * x + 0.75;\n  } else if (x < 2.5 / d1) {\n    return n1 * (x -= 2.25 / d1) * x + 0.9375;\n  } else {\n    return n1 * (x -= 2.625 / d1) * x + 0.984_375;\n  }\n};\n\nexport const quintIn = (x: number) => x * x * x * x * x;\nexport const quintOut = (x: number) => 1 - pow(1 - x, 5);\nexport const arch = (x: number) => x * (1 - x) * 4;\n\nexport const smoothstep = (x: number) => x * x * (3 - 2 * x);\nexport const smootherstep = (x: number) => (x * (x * 6 - 15) + 10) * x * x * x;\nexport const sineIn = (x: number) => 1 - cos((x * pi) / 2);\nexport const sineOut = (x: number) => sin((x * pi) / 2);\nexport const quadIn = (x: number) => x * x;\nexport const quadOut = (x: number) => 1 - (1 - x) * (1 - x);\nexport const sineInOut = (x: number) => -(cos(pi * x) - 1) / 2;\nexport const quadInOut = (x: number) => x < 0.5 ? 2 * x * x : 1 - pow(-2 * x + 2, 2) / 2;\nexport const cubicIn = (x: number) => x * x * x;\nexport const cubicOut = (x: number) => 1 - pow(1 - x, 3);\nexport const quartIn = (x: number) => x * x * x * x;\nexport const quartOut = (x: number) => 1 - pow(1 - x, 4);\nexport const expoIn = (x: number) => (x === 0 ? 0 : pow(2, 10 * x - 10));\nexport const expoOut = (x: number) => (x === 1 ? 1 : 1 - pow(2, -10 * x));\nexport const quintInOut = (x: number) =>\n  x < 0.5 ? 16 * x * x * x * x * x : 1 - pow(-2 * x + 2, 5) / 2;\nexport const expoInOut = (x: number) =>\n  x === 0\n    ? 0\n    : x === 1\n      ? 1\n      // eslint-disable-next-line unicorn/no-nested-ternary\n      : x < 0.5\n        ? pow(2, 20 * x - 10) / 2\n        : (2 - pow(2, -20 * x + 10)) / 2;\nexport const circIn = (x: number) => 1 - sqrt(1 - pow(x, 2));\nexport const circOut = (x: number) => sqrt(1 - pow(x - 1, 2));\nexport const backIn = (x: number) => {\n  const c1 = 1.701_58;\n  const c3 = c1 + 1;\n\n  return c3 * x * x * x - c1 * x * x;\n};\nexport const backOut = (x: number) => {\n  const c1 = 1.701_58;\n  const c3 = c1 + 1;\n\n  return 1 + c3 * pow(x - 1, 3) + c1 * pow(x - 1, 2);\n};\nexport const circInOut = (x: number) =>\n  x < 0.5\n    ? (1 - sqrt(1 - pow(2 * x, 2))) / 2\n    : (sqrt(1 - pow(-2 * x + 2, 2)) + 1) / 2;\n\nexport const backInOut = (x: number) => {\n  const c1 = 1.701_58;\n  const c2 = c1 * 1.525;\n\n  return x < 0.5\n    ? (pow(2 * x, 2) * ((c2 + 1) * 2 * x - c2)) / 2\n    : (pow(2 * x - 2, 2) * ((c2 + 1) * (x * 2 - 2) + c2) + 2) / 2;\n};\nexport const elasticIn = (x: number) => {\n  const c4 = (2 * pi) / 3;\n\n  return x === 0\n    ? 0\n    : (x === 1\n      ? 1\n      : -pow(2, 10 * x - 10) * sin((x * 10 - 10.75) * c4));\n};\nexport const elasticOut = (x: number) => {\n  const c4 = (2 * pi) / 3;\n\n  return x === 0\n    ? 0\n    : (x === 1\n      ? 1\n      : pow(2, -10 * x) * sin((x * 10 - 0.75) * c4) + 1);\n};\n\nexport const bounceIn = (x: number) => 1 - bounceOut(1 - x);\n\nexport const bell = gaussian();\n\nexport const elasticInOut = (x: number) => {\n  const c5 = (2 * pi) / 4.5;\n\n  return x === 0\n    ? 0\n    : x === 1\n      ? 1\n      // eslint-disable-next-line unicorn/no-nested-ternary\n      : x < 0.5\n        ? -(pow(2, 20 * x - 10) * sin((20 * x - 11.125) * c5)) / 2\n        : (pow(2, -20 * x + 10) * sin((20 * x - 11.125) * c5)) / 2 + 1;\n};\nexport const bounceInOut = (x: number) => x < 0.5 ? (1 - bounceOut(1 - 2 * x)) / 2 : (1 + bounceOut(2 * x - 1)) / 2;\n","/* eslint-disable unicorn/prevent-abbreviations */\nimport { throwNumberTest, throwIntegerTest } from '../util/GuardNumbers.js';\n\n/**\n * Wraps an integer number within a specified range, defaulting to degrees (0-360). Use {@link wrap} for floating-point wrapping.\n *\n * This is useful for calculations involving degree angles and hue, which wrap from 0-360.\n * Eg: to add 200 to 200, we don't want 400, but 40.\n *\n * ```js\n * const v = wrapInteger(200+200, 0, 360); // 40\n * ```\n *\n * Or if we minus 100 from 10, we don't want -90 but 270\n * ```js\n * const v = wrapInteger(10-100, 0, 360); // 270\n * ```\n *\n * `wrapInteger` uses 0-360 as a default range, so both of these\n * examples could just as well be:\n *\n * ```js\n * wrapInteger(200+200);  // 40\n * wrapInteger(10-100);  // 270\n * ```\n *\n * Non-zero starting points can be used. A range of 20-70:\n * ```js\n * const v = wrapInteger(-20, 20, 70); // 50\n * ```\n *\n * Note that the minimum value is inclusive, while the maximum is _exclusive_.\n * So with the default range of 0-360, 360 is never reached:\n *\n * ```js\n * wrapInteger(360); // 0\n * wrapInteger(361); // 1\n * ```\n *\n * If you just want to lock values to a range without wrapping, consider {@link clamp}.\n *\n * @param v Value to wrap\n * @param min Integer minimum of range (default: 0). Inclusive\n * @param max Integer maximum of range (default: 360). Exlusive\n * @returns\n */\nexport const wrapInteger = (v: number, min = 0, max = 360) => {\n  throwIntegerTest(v, undefined, `v`);\n  throwIntegerTest(min, undefined, `min`);\n  throwIntegerTest(max, undefined, `max`);\n\n  if (v === min) return min;\n  if (v === max) return min; // Wraps\n  if (v > 0 && v < min) v += min;\n\n  v -= min;\n  max -= min;\n  v = v % max;\n\n  if (v < 0) v = max - Math.abs(v) + min;\n  return v + min;\n};\n\n/**\n * Wraps floating point numbers to be within a range (default: 0..1). Use {@link wrapInteger} if you want to wrap integer values.\n *\n * This logic makes sense for some things like rotation angle.\n *\n * If you just want to lock values to a range without wrapping, consider {@link clamp}.\n *\n * ```js\n * wrap(1.2);   // 0.2\n * wrap(2);     // 1.0\n * wrap(-0.2); // 0.8\n * ```\n *\n * A range can be provided too:\n * ```js\n * wrap(30, 20, 50);  \t // 30\n * wrap(60, 20, 50);    //  30\n * ```\n * @param v\n * @param min\n * @param max\n * @returns\n */\nexport const wrap = (v: number, min = 0, max = 1) => {\n  throwNumberTest(v, ``, `min`);\n  throwNumberTest(min, ``, `min`);\n  throwNumberTest(max, ``, `max`);\n\n  if (v === min) return min;\n  if (v === max) return min; // Wraps\n\n  while (v <= min || v >= max) {\n    if (v === max) break;\n    if (v === min) break;\n    if (v > max) {\n      v = min + (v - max);\n    } else if (v < min) {\n      v = max - (min - v);\n    }\n  }\n  return v;\n};\n\n/**\n * Performs a calculation within a wrapping number range. This is a lower-level function.\n * See also: {@link wrapInteger} for simple wrapping within a range.\n *\n * `min` and `max` define the start and end of the valid range, inclusive. Eg for hue degrees it'd be 0, 360.\n * `a` and `b` is the range you want to work in.\n *\n * For example, let's say you want to get the middle point between a hue of 30 and a hue of 330 (ie warmer colours):\n * ```js\n * wrapRange(0,360, (distance) => {\n *  // for a:0 and b:330, distance would be 90 from 30 degrees to 330 (via zero)\n *  return distance * 0.5; // eg return middle point\n * }, 30, 330);\n * ```\n *\n * The return value of the callback should be in the range of 0-distance. `wrapRange` will subsequently\n * conform it to the `min` and `max` range before it's returned to the caller.\n *\n * @param a Output start (eg. 60)\n * @param b Output end (eg 300)\n * @param min Range start (eg 0)\n * @param max Range end (eg 360)\n * @param fn Returns a computed value from 0 to `distance`.\n * @returns\n */\nexport const wrapRange = (\n  min: number,\n  max: number,\n  fn: (distance: number) => number,\n  a: number,\n  b: number\n) => {\n  //eslint-disable-next-line functional/no-let\n  let r = 0;\n  const distF = Math.abs(b - a);\n  // When b is wrapped forwards\n  const distFwrap = Math.abs(max - a + b);\n  // When b is wrapped backwards (10, 300)\n  const distBWrap = Math.abs(a + (360 - b));\n\n  const distMin = Math.min(distF, distFwrap, distBWrap);\n  if (distMin === distBWrap) {\n    // (10, 300) = 70\n    r = a - fn(distMin);\n  } else if (distMin === distFwrap) {\n    // (300, 60) = 120\n    r = a + fn(distMin);\n  } else {\n    // Forwards or backwards without wrapping\n    // eslint-disable-next-line unicorn/prefer-ternary\n    if (a > b) {\n      // (240,120) -- backwards\n      r = a - fn(distMin);\n    } else {\n      // (120,240) -- forwards\n      r = a + fn(distMin);\n    }\n  }\n  return wrapInteger(r, min, max);\n};\n","import type { Interval } from '../flow/IntervalType.js';\nimport { wrap } from './Wrap.js';\nimport { ofTotal } from '../flow/Timer.js';\nimport { throwNumberTest } from '../util/GuardNumbers.js';\nimport { clamp } from '../numbers/Clamp.js';\nimport { get as getEasing, type EasingName } from '../modulation/easing/index.js';\nexport const piPi = Math.PI * 2;\n\n/**\n * \n * Limit\n * What to do if interpolation amount exceeds 0..1 range\n * * clamp: lock to A & B (inclusive) Default.\n * * wrap: wrap from end to start again\n * * ignore: allow return values outside of A..B range\n * \n * Easing: name of easing function for non-linear interpolation\n * \n * Transform: name of function to transform `amount` prior to interpolate. \n */\nexport type InterpolateOptions = {\n  limits: `clamp` | `wrap` | `ignore`\n  easing: EasingName,\n  transform: (v: number) => number\n}\n\n\nexport function interpolate(amount: number, options?: Partial<InterpolateOptions>): (a: number, b: number) => number;\nexport function interpolate(amount: number, a: number, b: number, options?: Partial<InterpolateOptions>): number;\nexport function interpolate(a: number, b: number, options?: Partial<InterpolateOptions>): (amount: number) => number;\n/**\n * Interpolates between `a` and `b` by `amount`. Aka `lerp`.\n *\n * [ixfx Guide on Interpolation](https://ixfx.fun/data/interpolation/overview/)\n *\n * @example Get the halfway point between 30 and 60\n * ```js\n * import { interpolate } from 'https://unpkg.com/ixfx/dist/numbers.js';\n * interpolate(0.5, 30, 60);\n * ```\n *\n * Interpolation is often used for animation. In that case, `amount`\n * would start at 0 and you would keep interpolating up to `1`\n * @example\n * ```js\n * import { interpolate } from 'https://unpkg.com/ixfx/dist/numbers.js';\n * import { percentPingPong } from 'https://unpkg.com/ixfx/dist/modulation.js'\n *\n * // Go back and forth between 0 and 1 by 0.1\n * let pp = percentPingPong(0.1);\n * continuously(() => {\n *  // Get position in ping-pong\n *  const amt = pp.next().value;\n *  // interpolate between Math.PI and Math.PI*2\n *  const v = interpolate(amt, Math.PI, Math.PI*2);\n *  // do something with v...\n * }).start();\n * ```\n *\n * See also {@link interpolatorStepped} and {@link interpolatorInterval} for functions\n * which help to manage progression from A->B over steps or interval.\n * \n * If two parameters are given, it instead returns a function which interpolates:\n * ```js\n * const i = interpolate(100, 200);\n * i(0.5); // 150\n * \n * // Compared to:\n * interpolate(0.5, 100, 200); // 150\n * ```\n * \n * This is useful if you want to reuse the interpolator with fixed `a` and `b` values.\n * \n * Usually interpolation amount is on a 0...1 scale, inclusive. What is the interpolation result\n * if this scale is exceeded? By default it is clamped to 0..1, so the return value is always between `a` and `b` (inclusive).\n * \n * Alternatively, set the `limits` option to process `amount`:\n * * 'wrap': wrap amount, eg 1.5 is the same as 0.5, 2 is the same as 1\n * * 'ignore': allow exceeding values. eg 1.5 will yield b*1.5.\n * * 'clamp': default behaviour of clamping interpolation amount to 0..1\n * \n * Interpolation can be non-linear using 'easing' option or 'transform' funciton.\n * ```js\n * interpolate(0.1, 0, 100, { easing: `quadIn` });\n * ```\n * To interpolate certain types: {@link Visual.Colour.interpolator | Visual.Colour.interpolator }, {@link Geometry.Points.interpolate | Points.interpolate}.\n */\nexport function interpolate(pos1: number, pos2?: number | Partial<InterpolateOptions>, pos3?: number | Partial<InterpolateOptions>, pos4?: Partial<InterpolateOptions>) {\n  let amountProcess: undefined | ((v: number) => number);\n  let limits: InterpolateOptions[ 'limits' ] = `clamp`;\n\n  const handleAmount = (amount: number) => {\n    if (amountProcess) amount = amountProcess(amount);\n    if (limits === undefined || limits === `clamp`) {\n      amount = clamp(amount);\n    } else if (limits === `wrap`) {\n      if (amount > 1) amount = amount % 1;\n      else if (amount < 0) {\n        amount = 1 + (amount % 1);\n      }\n    }\n    return amount;\n  }\n\n  const doTheEase = (_amt: number, _a: number, _b: number) => {\n    throwNumberTest(_a, ``, `a`);\n    throwNumberTest(_b, ``, `b`);\n    throwNumberTest(_amt, ``, `amount`);\n    _amt = handleAmount(_amt);\n    return (1 - _amt) * _a + _amt * _b\n  }\n\n\n  const readOpts = (o: Partial<InterpolateOptions> = {}) => {\n    if (o.easing) {\n      const easingFn = getEasing(o.easing);\n      if (!easingFn) throw new Error(`Easing function '${ o.easing }' not found`);\n      amountProcess = easingFn;\n    } else if (o.transform) {\n      if (typeof o.transform !== `function`) throw new Error(`Param 'transform' is expected to be a function. Got: ${ typeof o.transform }`);\n      amountProcess = o.transform;\n    }\n    limits = o.limits ?? `clamp`;\n  }\n\n  const rawEase = (_amt: number, _a: number, _b: number) => (1 - _amt) * _a + _amt * _b\n\n  if (typeof pos1 !== `number`) throw new TypeError(`First param is expected to be a number. Got: ${ typeof pos1 }`);\n  if (typeof pos2 === `number`) {\n    let a: number;\n    let b: number;\n    if (pos3 === undefined || typeof pos3 === `object`) {\n      //interpolate(a: number, b: number, options?: Partial<InterpolateOptions>): (amount: number) => number;\n      a = pos1;\n      b = pos2;\n      readOpts(pos3);\n      return (amount: number) => doTheEase(amount, a, b);\n    } else if (typeof pos3 === `number`) {\n      //interpolate(amount: number, a: number, b: number, options?: Partial<InterpolateOptions>): number;\n      a = pos2;\n      b = pos3;\n      readOpts(pos4);\n      return doTheEase(pos1, a, b);\n    } else {\n      throw new Error(`Values for 'a' and 'b' not defined`);\n    }\n  } else if (pos2 === undefined || typeof pos2 === `object`) {\n    //interpolate(amount: number, options?: Partial<InterpolateOptions>): (a:number,b:number)=>number;\n    let amount = handleAmount(pos1);\n    readOpts(pos2);\n    throwNumberTest(amount, ``, `amount`);\n    return (aValue: number, bValue: number) => rawEase(amount, aValue, bValue);\n  }\n};\n\n\n/**\n * Returns a function that interpolates from A to B.\n * It steps through the interpolation with each call to the returned function.\n * This means that the `incrementAmount` will hinge on the rate\n * at which the function is called. Alternatively, consider {@link interpolatorInterval}\n * which steps on the basis of clock time.\n * \n * ```js\n * // Interpolate from 0..1 by 0.01\n * const v = interpolatorStepped(0.01, 100, 200);\n * v(); // Each call returns a value closer to target\n * // Eg: 100, 110, 120, 130 ...\n * ```\n * \n * Under the hood, it calls `interpolate` with an amount that\n * increases by `incrementAmount` each time.\n * \n * When calling `v()` to step the interpolator, you can also pass\n * in new B and A values. Note that the order is swapped: the B (target) is provided first, and\n * then optionally A.\n * \n * ```js\n * const v = interpolatorStepped(0.1, 100, 200); // Interpolate 100->200\n * v(300, 200); // Retarget to 200->300 and return result\n * v(150); // Retarget 200->150 and return result\n * ```\n * \n * This allows you to maintain the current interpolation progress.\n * @param incrementAmount Amount to increment by\n * @param a Start value. Default: 0\n * @param b End value. Default: 1\n * @param startInterpolationAt Starting interpolation amount. Default: 0\n * @param options Options for interpolation\n * @returns \n */\nexport const interpolatorStepped = (incrementAmount: number, a = 0, b = 1, startInterpolationAt = 0, options?: Partial<InterpolateOptions>) => {\n  let amount = startInterpolationAt;\n  return (retargetB?: number, retargetA?: number) => {\n    if (retargetB !== undefined) b = retargetB;\n    if (retargetA !== undefined) a = retargetA;\n    if (amount >= 1) return b;\n    const value = interpolate(amount, a, b, options);\n    amount += incrementAmount;\n    return value;\n  }\n}\n\n/**\n * Interpolates between A->B over `duration`.\n * Given the same A & B values, steps will be larger if it's a longer\n * duration, and shorter if it's a smaller duration.\n * \n * A function is returned, which when invoked yields a value between A..B.\n * \n * Alternatively to step through by the same amount regardless\n * of time, use {@link interpolatorStepped}.\n * \n * ```js\n * // Interpolate from 0..1 over one minute\n * const v = interpolatorInterval({mins:1});\n * v(); // Compute current value\n * ```\n * \n * Use start and end points:\n * ```js\n * // Interpolate from 100-200 over 10 seconds\n * const v = interpolatorInterval({secs:10}, 100, 200);\n * v(); // Compute current value\n * ```\n * @param duration Duration for interpolation\n * @param a Start point\n * @param b End point\n * @param options Options for interpolation\n * @returns \n */\nexport const interpolatorInterval = (duration: Interval, a = 0, b = 1, options?: Partial<InterpolateOptions>) => {\n  const durationProgression = ofTotal(duration, { clampValue: true });\n  return (retargetB?: number, retargetA?: number) => {\n    const amount = durationProgression();\n    if (retargetB !== undefined) b = retargetB;\n    if (retargetA !== undefined) a = retargetA;\n    if (amount >= 1) return b;\n    const value = interpolate(amount, a, b, options);\n    return value;\n  }\n}\n\n/**\n * Interpolate between angles `a` and `b` by `amount`. Angles are in radians.\n *\n * ```js\n * import { interpolateAngle } from 'https://unpkg.com/ixfx/dist/data.js';\n * interpolateAngle(0.5, Math.PI, Math.PI/2);\n * ```\n * @param amount\n * @param aRadians Start angle (radian)\n * @param bRadians End angle (radian)\n * @returns\n */\nexport const interpolateAngle = (\n  amount: number,\n  aRadians: number,\n  bRadians: number,\n  options?: Partial<InterpolateOptions>\n): number => {\n  const t = wrap(bRadians - aRadians, 0, piPi);\n  return interpolate(amount, aRadians, aRadians + (t > Math.PI ? t - piPi : t), options);\n};\n\n","import { clamp } from './Clamp.js';\nimport { throwNumberTest } from '../util/GuardNumbers.js';\n\n/**\n * Scales `v` from an input range to an output range (aka `map`)\n *\n * For example, if a sensor's useful range is 100-500, scale it to a percentage:\n *\n * ```js\n * import { scale } from 'https://unpkg.com/ixfx/dist/data.js';\n *\n * scale(sensorReading, 100, 500, 0, 1);\n * ```\n *\n * `scale` defaults to a percentage-range output, so you can get away with:\n * ```js\n * scale(sensorReading, 100, 500);\n * ```\n *\n * If `v` is outside of the input range, it will likewise be outside of the output range.\n * Use {@link scaleClamped} to clip value to range.\n *\n * If inMin and inMax are equal, outMax will be returned.\n *\n * An easing function can be provided for non-linear scaling. In this case\n * the input value is 'pre scaled' using the function before it is applied to the\n * output range.\n *\n * ```js\n * scale(sensorReading, 100, 500, 0, 1, Easings.gaussian());\n * ```\n * @param v Value to scale\n * @param inMin Input minimum\n * @param inMax Input maximum\n * @param outMin Output minimum. If not specified, 0\n * @param outMax Output maximum. If not specified, 1\n * @param easing Easing function\n * @returns Scaled value\n */\nexport const scale = (\n  v: number,\n  inMin: number,\n  inMax: number,\n  outMin?: number,\n  outMax?: number,\n  easing?: (v: number) => number\n): number => scaler(inMin, inMax, outMin, outMax, easing)(v);\n\n/**\n * Returns a scaling function\n * @param inMin Input minimum\n * @param inMax Input maximum\n * @param outMin Output minimum. If not specified, 0\n * @param outMax Output maximum. If not specified, 1\n * @param easing Easing function\n * @returns\n */\nexport const scaler = (\n  inMin: number,\n  inMax: number,\n  outMin?: number,\n  outMax?: number,\n  easing?: (v: number) => number\n): ((v: number) => number) => {\n\n  const oMax = outMax ?? 1;\n  const oMin = outMin ?? 0;\n\n  return (v: number): number => {\n    if (inMin === inMax) return oMax;\n\n    let a = (v - inMin) / (inMax - inMin);\n    if (easing !== undefined) a = easing(a);\n    return a * (oMax - oMin) + oMin;\n  };\n};\n\n/**\n * As {@link scale}, but result is clamped to be\n * within `outMin` and `outMax`.\n *\n * @param v\n * @param inMin\n * @param inMax\n * @param outMin 1 by default\n * @param outMax 0 by default d\n * @param easing\n * @returns\n */\nexport const scaleClamped = (\n  v: number,\n  inMin: number,\n  inMax: number,\n  outMin?: number,\n  outMax?: number,\n  easing?: (v: number) => number\n): number => {\n  if (outMax === undefined) outMax = 1;\n  if (outMin === undefined) outMin = 0;\n  if (inMin === inMax) return outMax;\n\n  const x = scale(v, inMin, inMax, outMin, outMax, easing);\n  return clamp(x, outMin, outMax);\n};\n\n/**\n * Scales an input percentage to a new percentage range.\n *\n * If you have an input percentage (0-1), `scalePercentageOutput` maps it to an\n * _output_ percentage of `outMin`-`outMax`.\n *\n * ```js\n * import { scalePercentages } from 'https://unpkg.com/ixfx/dist/data.js';\n *\n * // Scales 50% to a range of 0-10%\n * scalePercentages(0.5, 0, 0.10); // 0.05 - 5%\n * ```\n *\n * An error is thrown if any parameter is outside of percentage range. This added\n * safety is useful for catching bugs. Otherwise, you could just as well call\n * `scale(percentage, 0, 1, outMin, outMax)`.\n *\n * If you want to scale some input range to percentage output range, just use `scale`:\n * ```js\n * import { scale } from 'https://unpkg.com/ixfx/dist/data.js';\n *\n * // Yields 0.5\n * scale(2.5, 0, 5);\n * ```\n * @param percentage Input value, within percentage range\n * @param outMin Output minimum, between 0-1\n * @param outMax Output maximum, between 0-1\n * @returns Scaled value between outMin-outMax.\n */\nexport const scalePercentages = (\n  percentage: number,\n  outMin: number,\n  outMax = 1\n): number => {\n  throwNumberTest(percentage, `percentage`, `v`);\n  throwNumberTest(outMin, `percentage`, `outMin`);\n  throwNumberTest(outMax, `percentage`, `outMax`);\n  return scale(percentage, 0, 1, outMin, outMax);\n};\n\n/**\n * Scales an input percentage value to an output range\n * If you have an input percentage (0-1), `scalePercent` maps it to an output range of `outMin`-`outMax`.\n * ```js\n * import { scalePercent } from 'https://unpkg.com/ixfx/dist/data.js';\n * scalePercent(0.5, 10, 20); // 15\n * ```\n *\n * @see {@link scalerPercent} Returns a function\n * @param v Value to scale\n * @param outMin Minimum for output\n * @param outMax Maximum for output\n * @returns\n */\nexport const scalePercent = (\n  v: number,\n  outMin: number,\n  outMax: number\n): number => scalerPercent(outMin, outMax)(v);\n\n/**\n * Returns a function that scales an input percentage value to an output range\n * @see {@link scalePercent} Calculates value\n * @param outMin\n * @param outMax\n * @returns Function that takes a single argument\n */\nexport const scalerPercent = (outMin: number, outMax: number) => {\n  return (v: number) => {\n    throwNumberTest(v, `percentage`, `v`);\n    return scale(v, 0, 1, outMin, outMax);\n  };\n};\n","\nimport { type RandomOptions, type RandomSource } from '../random/Types.js';\nimport { throwNumberTest } from '../util/GuardNumbers.js';\nimport { interpolate } from './Interpolate.js';\nimport { scaler as numberScaler } from './Scale.js';\nimport { floatSource } from '../random/FloatSource.js';\n\n/**\n * Wrapper around a bipolar value. Immutable.\n * \n * ```js\n * let b = Bipolar.immutable();\n * let b = Bipolar.immutable(0.5);\n * b = b.add(0.1);\n * ```\n */\nexport type BipolarWrapper = {\n  value: number\n  towardZero: (amt: number) => BipolarWrapper\n  add: (amt: number) => BipolarWrapper\n  multiply: (amt: number) => BipolarWrapper\n  inverse: () => BipolarWrapper\n  asScalar: () => number\n  interpolate: (amt: number, b: number) => BipolarWrapper\n  [ Symbol.toPrimitive ]: (hint: string) => number | string | boolean\n}\n\n/**\n * Wrapper for bipolar-based values. Immutable.\n * All functions will clamp to keep it in legal range.\n * \n * ```js\n * let v = immutable(); // Starts with 0 by default\n * v = v.add(0.1);      // v.value is 0.1\n * v = v.inverse();     // v.value is -0.1\n * v = v.multiply(0.2); // v.value is -0.02\n * \n * v = immutable(1);\n * v = v.towardZero(0.1); // 0.9\n * v = v.interpolate(0.1, 1);\n * ```\n * \n * Wrapped values can be coerced into number:\n * ```js\n * const v = immutable(1);\n * const x = +v+10;\n * // x = 11\n * ```\n * @param startingValueOrBipolar Initial numeric value or BipolarWrapper instance\n * @returns \n */\nexport const immutable = (startingValueOrBipolar: number | BipolarWrapper = 0): BipolarWrapper => {\n  if (typeof startingValueOrBipolar === `undefined`) throw new Error(`Start value is undefined`)\n  const startingValue = (typeof startingValueOrBipolar === `number`) ? startingValueOrBipolar : startingValueOrBipolar.value;\n\n  if (startingValue > 1) throw new Error(`Start value cannot be larger than 1`);\n  if (startingValue < -1) throw new Error(`Start value cannot be smaller than -1`);\n  if (Number.isNaN(startingValue)) throw new Error(`Start value is NaN`);\n\n  const v = startingValue;\n  return {\n    [ Symbol.toPrimitive ](hint: string) {\n      if (hint === `number`) return v;\n      else if (hint === `string`) return v.toString();\n      return true;\n    },\n    value: v,\n    towardZero: (amt: number) => {\n      return immutable(towardZero(v, amt));\n    },\n    add: (amt: number) => {\n      return immutable(clamp(v + amt));\n    },\n    multiply: (amt: number) => {\n      return immutable(clamp(v * amt));\n    },\n    inverse: () => {\n      return immutable(-v);\n    },\n    interpolate: (amt: number, b: number) => {\n      return immutable(clamp(interpolate(amt, v, b)));\n    },\n    asScalar: () => {\n      return toScalar(v);\n    }\n  }\n}\n\n/**\n * Converts bipolar value to a scalar\n * ```js\n * import { Bipolar } from 'https://unpkg.com/ixfx/dist/data.js';\n * Bipolar.toScalar(-1); // 0.0\n * Bipolar.toScalar( 0); // 0.5\n * Bipolar.toScalar( 1); // 1.0\n * ```\n * \n * Throws an error if `bipolarValue` is not a number or NaN\n * @param bipolarValue Value to convert to scalar\n * @returns Scalar value on 0..1 range.\n */\nexport const toScalar = (bipolarValue: number) => {\n  if (typeof bipolarValue !== `number`) throw new Error(`Expected v to be a number. Got: ${ typeof bipolarValue }`);\n  if (Number.isNaN(bipolarValue)) throw new Error(`Parameter is NaN`);\n  return (bipolarValue + 1) / 2;\n}\n\n/**\n * Makes a scalar into a bipolar value.\n * \n * That is, input range is 0..1, output range is -1...1\n *\n * ```js\n * import { Bipolar } from 'https://unpkg.com/ixfx/dist/data.js';\n * Bipolar.fromScalar(1);   // 1\n * Bipolar.fromScalar(0);   // -1\n * Bipolar.fromScalar(0.5); // 0\n * ```\n * \n * Throws an error if `scalarValue` is not on 0..1 scale.\n * @param scalarValue Scalar value to convert\n * @returns Bipolar value on -1..1 scale\n */\nexport const fromScalar = (scalarValue: number) => {\n  throwNumberTest(scalarValue, `percentage`, `v`);\n  return (scalarValue * 2) - 1;\n};\n\n/**\n * Scale & clamp resulting number to bipolar range (-1..1)\n * ```js\n * import { Bipolar } from 'https://unpkg.com/ixfx/dist/data.js';\n * \n * // Scale 100 on 0..100 scale\n * Bipolar.scale(100, 0, 100); // 1\n * Bipolar.scale(50, 0, 100);  // 0\n * Bipolar.scale(0, 0, 100);   // -1\n * ```\n * \n * Return value is clamped.\n * @param inputValue Value to scale\n * @param inMin Minimum of scale\n * @param inMax Maximum of scale\n * @returns Bipolar value on -1..1 scale\n */\nexport const scale = (inputValue: number, inMin: number, inMax: number) => {\n  return clamp(numberScaler(inMin, inMax, -1, 1)(inputValue));\n}\n\n/**\n * Scale a number to bipolar range (-1..1). Not clamped to scale.\n * \n * ```js\n * import { Bipolar } from 'https://unpkg.com/ixfx/dist/data.js';\n * \n * // Scale 100 on 0..100 scale\n * Bipolar.scale(100, 0, 100); // 1\n * Bipolar.scale(50, 0, 100);  // 0\n * Bipolar.scale(0, 0, 100);   // -1\n * ```\n * \n * @param inputValue Value to scale\n * @param inMin Minimum of scale\n * @param inMax Maximum of scale\n * @returns Bipolar value on -1..1 scale\n */\nexport const scaleUnclamped = (inputValue: number, inMin: number, inMax: number) => {\n  return numberScaler(inMin, inMax, -1, 1)(inputValue);\n}\n\n/**\n * Source for random bipolar values\n * ```js\n * const r = Bipolar.randomSource();\n * r(); // Produce random value on -1...1 scale\n * ```\n * \n * Options can be provided, for example\n * ```js\n * // -0.5 to 0.5 range\n * Bipolar.randomSource({ max: 0.5 });\n * ```\n * \n * Consider using {@link random} if you just want a one-off random\n * value.\n * @param maxOrOptions Maximum value (number) or options for random generation\n * @returns \n */\nexport const randomSource = (maxOrOptions?: number | RandomOptions): RandomSource => {\n  const source = floatSource(maxOrOptions);\n  return () => (source() * 2) - 1;\n}\n\n/**\n * Returns a random bipolar value\n * ```js\n * const r = Bipolar.random(); // -1...1 random\n * ```\n * \n * Options can be provided, eg.\n * ```js\n * Bipolar.random({ max: 0.5 }); // -0.5..0.5 random\n * ```\n * \n * Use {@link randomSource} if you want to generate random\n * values with same settings repeatedly.\n * @param maxOrOptions \n * @returns \n */\nexport const random = (maxOrOptions?: number | RandomOptions): number => {\n  const source = randomSource(maxOrOptions);\n  return source();\n}\n/**\n * Clamp a bipolar value\n * ```js\n * import { Bipolar } from 'https://unpkg.com/ixfx/dist/data.js';\n * Bipolar.clamp(-1);   // -1\n * Bipolar.clamp(-1.1); // -1\n * ```\n * \n * Throws an error if `bipolarValue` is not a number or NaN.\n * @param bipolarValue Value to clamp\n * @returns Clamped value on -1..1 scale\n */\nexport const clamp = (bipolarValue: number): number => {\n  if (typeof bipolarValue !== `number`) throw new Error(`Param 'bipolarValue' must be a number. Got: ${ typeof bipolarValue }`);\n  if (Number.isNaN(bipolarValue)) throw new Error(`Param 'bipolarValue' is NaN`);\n  if (bipolarValue > 1) return 1;\n  if (bipolarValue < -1) return -1;\n  return bipolarValue;\n}\n\n/**\n * Pushes a bipolar value toward zero by `amount`.\n * Return value is clamped on bipolar range of -1..1\n * \n * ```js\n * import { Bipolar } from 'https://unpkg.com/ixfx/dist/data.js';\n * Bipolar.towardZero(-1, 0.1); // -0.9\n * Bipolar.towardZero( 1, 0.1); //  0.9\n * Bipolar.towardZero( 0, 0.1); //  0.0\n * Bipolar.towardZero( 1, 1.1); //  0.0\n * ```\n * \n * If `amount` is greater than 1, 0 is returned.\n * Throws an error if `bipolarValue` or `amount` are not numbers.\n * Throws an error if `amount` is below zero.\n * @param bipolarValue Bipolar value to nudge toward zero\n * @param amount Amount to nudge by\n * @returns Bipolar value -1...1\n */\nexport const towardZero = (bipolarValue: number, amount: number): number => {\n  if (typeof bipolarValue !== `number`) throw new Error(`Parameter 'v' must be a number. Got: ${ typeof bipolarValue }`);\n  if (typeof amount !== `number`) throw new Error(`Parameter 'amt' must be a number. Got: ${ typeof amount }`);\n  if (amount < 0) throw new Error(`Parameter 'amt' must be positive`);\n  if (bipolarValue < 0) {\n    bipolarValue += amount;\n    if (bipolarValue > 0) bipolarValue = 0;\n  } else if (bipolarValue > 0) {\n    bipolarValue -= amount;\n    if (bipolarValue < 0) bipolarValue = 0;\n  }\n  return bipolarValue;\n}","import { throwNumberTest } from \"../util/GuardNumbers.js\";\nimport type { NumberFunction } from '../data/Types.js';\n\n/**\n * Flips a percentage-scale number: `1 - v`.\n *\n * The utility of this function is that it sanity-checks\n * that `v` is in 0..1 scale.\n *\n * ```js\n * flip(1);   // 0\n * flip(0.5); // 0.5\n * flip(0);   // 1\n * ```\n * @param v\n * @returns\n */\nexport const flip = (v: number | NumberFunction) => {\n  if (typeof v === `function`) v = v();\n  throwNumberTest(v, `percentage`, `v`);\n  return 1 - v;\n};\n","/**\n * Returns _true_ if array contains duplicate instances.\n * Use {@link containsDuplicateValues} if you'd rather compare by value.\n * @param array \n * @returns \n */\nexport const containsDuplicateInstances = <V>(array: Array<V> | ReadonlyArray<V>): boolean => {\n  if (!Array.isArray(array)) throw new Error(`Parameter needs to be an array`);\n  for (let index = 0; index < array.length; index++) {\n    for (let x = 0; x < array.length; x++) {\n      if (index === x) continue;\n      if (array[ index ] === array[ x ]) return true;\n    }\n  }\n  return false;\n}","export function reduce<V>(\n  it: Iterable<V>,\n  f: (accumulator: V, current: V) => V,\n  start: V\n) {\n  // https://surma.github.io/underdash/\n\n  for (const v of it) start = f(start, v);\n  return start;\n}\n","import { type ToString, toStringDefault } from '../util/index.js';\nimport { type IsEqual } from '../util/IsEqual.js';\nimport { isIterable } from './Iterable.js';\nimport { intervalToMs } from '../flow/IntervalType.js';\nimport type { ToArrayOptions } from './Types.js';\nexport { slice } from './sync/Slice.js';\nexport { reduce } from './sync/Reduce.js';\n\nexport function* uniqueByValue<T>(input: Iterable<T>, toString: ToString<T> = toStringDefault, seen: Set<string> = new Set<string>()): Generator<T> {\n  for (const v of input) {\n    const key = toString(v);\n    if (seen.has(key)) continue;\n    seen.add(key);\n    yield v;\n  }\n}\n\n/**\n * Calls `callback` whenever the generator produces a value.\n * \n * When using `asCallback`, call it with `await` to let generator \n * run its course before continuing:\n * ```js\n * await asCallback(tick({ interval:1000, loops:5 }), x => {\n *  // Gets called 5 times, with 1000ms interval\n * });\n * console.log(`Hi`); // Prints after 5 seconds\n * ```\n * \n * Or if you skip the `await`, code continues and callback will still run:\n * ```js\n * asCallback(tick({ interval: 1000, loops: 5}), x => {\n *  // Gets called 5 times, with 1000ms interval\n * });\n * console.log(`Hi`); // Prints immediately\n * ```\n * @param input \n * @param callback \n */\nexport function asCallback<V>(input: Iterable<V>, callback: (v: V) => unknown, onDone?: () => void) {\n  for (const value of input) {\n    callback(value);\n  }\n  if (onDone) onDone();\n}\n\n/**\n * Returns a function that yields a value from a generator.\n * ```js\n * const spring = yieldNumber(Oscillators.spring());\n *\n * spring(); // latest value\n * ```\n *\n * Instead of:\n * ```js\n * const spring = Oscillators.spring();\n *\n * spring.next().value\n * ```\n *\n * A `defaultValue` can be provided if the source generator returns undefined:\n * ```js\n * const spring = yieldNumber(Oscillators.spring(), 0);\n * spring(); // Returns 0 if the generator returns undefined\n * ```\n * @param generator\n * @param defaultValue\n * @returns\n */\nexport function yieldNumber(\n  generator: Generator<number>,\n  defaultValue?: number\n) {\n\n  return (): number | undefined => {\n    const v: number | undefined = generator.next().value as number | undefined;\n    if (v === undefined) return defaultValue;\n    return v;\n  };\n}\n\n/**\n * Return first value from an iterable, or _undefined_ if\n * no values are generated\n * @param it\n * @returns\n */\nexport function first<V>(it: Iterable<V>): V | undefined {\n  for (const value of it) {\n    return value;\n  }\n}\n\n/**\n * Returns last value from an iterable, or _undefined_\n * if no values are generated\n * @param it\n */\nexport function last<V>(it: Iterable<V>): V | undefined {\n  //eslint-disable-next-line functional/no-let\n  let returnValue: V | undefined;\n  for (const value of it) {\n    returnValue = value;\n  }\n  return returnValue;\n}\n\n/**\n * Yields chunks of the iterable `it` such that the end of a chunk is the\n * start of the next chunk.\n *\n * Eg, with the input [1,2,3,4,5] and a size of 2, we would get back\n * [1,2], [2,3], [3,4], [4,5].\n *\n *\n * @param it\n * @param size\n * @returns\n */\nexport function* chunksOverlapping<V>(it: Iterable<V>, size: number) {\n  if (size <= 1) throw new Error(`Size should be at least 2`);\n\n  //eslint-disable-next-line functional/no-let\n  let buffer: Array<V> = [];\n\n  for (const v of it) {\n    //eslint-disable-next-line functional/immutable-data\n    buffer.push(v);\n    if (buffer.length === size) {\n      yield buffer;\n      //eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      buffer = [ buffer.at(-1)! ];\n    }\n  }\n  if (buffer.length <= 1) return;\n\n  if (buffer.length > 0) yield buffer;\n}\n\n\nexport function* chunks<V>(it: Iterable<V>, size: number) {\n  //eslint-disable-next-line functional/no-let\n  let buffer = [];\n\n  for (const v of it) {\n    //eslint-disable-next-line functional/immutable-data\n    buffer.push(v);\n    if (buffer.length === size) {\n      yield buffer;\n      buffer = [];\n    }\n  }\n  if (buffer.length > 0) yield buffer;\n}\n\nexport function* concat<V>(...its: ReadonlyArray<Iterable<V>>) {\n  for (const it of its) yield* it;\n}\n\nexport function* dropWhile<V>(\n  it: Iterable<V>,\n  f: (v: V) => boolean\n) {\n  for (const v of it) {\n    if (!f(v)) {\n      yield v;\n    }\n  }\n}\n\n/**\n* Loops over a generator until it finishes, calling `callback`.\n* Useful if you don't care about the value generator produces, just the number of loops.\n* \n* ```js\n* until(count(5), () => {\n* // do something 5 times\n* });\n* ```\n* \n* If you want the value from the generator, use a `for of` loop as usual.\n* If `callback` explicitly returns _false_, the generator is aborted.\n* @param it Generator to run\n* @param callback Code to call for each iteration\n*/\n// eslint-disable-next-line @typescript-eslint/no-invalid-void-type\nexport const until = (it: Iterable<any>, callback: () => (void | boolean | never)) => {\n  for (const _ of it) {\n    const value = callback();\n    if (typeof value === `boolean` && !value) break;\n  }\n}\n\nexport const next = <T>(it: Generator<T>) => {\n  return () => {\n    const r = it.next();\n    if (r.done) return;\n    return r.value;\n  }\n}\n\n/**\n * Returns true if items in two iterables are equal, as\n * determined by the `equality` function.\n * @param it1\n * @param it2\n * @param equality\n * @returns\n */\nexport function equals<V>(\n  it1: IterableIterator<V>,\n  it2: IterableIterator<V>,\n  equality?: IsEqual<V>\n) {\n  //it1 = it1[Symbol.iterator]();\n  //it2 = it2[Symbol.iterator]();\n  // eslint-disable-next-line no-constant-condition\n  while (true) {\n    const index1 = it1.next(),\n      index2 = it2.next();\n    if (equality !== undefined) {\n      if (!equality(index1.value, index2.value)) return false;\n    } else if (index1.value !== index2.value) return false;\n    if (index1.done ?? index2.done) return index1.done && index2.done;\n  }\n}\n\nexport function every<V>(it: Iterable<V>, f: (v: V) => boolean) {\n  for (const v of it) {\n    const result = f(v);\n    if (!result) return false;\n  }\n  return true;\n}\n\n\nexport function* fill<V>(it: Iterable<V>, v: V) {\n  // https://surma.github.io/underdash/\n\n  //eslint-disable-next-line @typescript-eslint/no-unused-vars\n  for (const _ of it) yield v;\n}\n\n/**\n * Iterates over `iterator` (iterable/array), calling `fn` for each value.\n * If `fn` returns _false_, iterator cancels.\n *\n * Over the default JS `forEach` function, this one allows you to exit the\n * iteration early.\n *\n * @example\n * ```js\n * import { Sync } from \"https://unpkg.com/ixfx/dist/iterables.js\"\n * Sync.forEach(count(5), () => console.log(`Hi`));  // Prints `Hi` 5x\n * Sync.forEach(count(5), i => console.log(i));      // Prints 0 1 2 3 4\n * Sync.forEach([0,1,2,3,4], i => console.log(i));   // Prints 0 1 2 3 4\n * ```\n *\n * Use {@link forEach} if you want to use an async `iterator` and async `fn`.\n * \n * Alternatives:\n * * {@link Flow.repeat}/{@link Flow.repeatSync}: if you want to call something a given number of times and get the result\n * @param iterator Iterable or array\n * @typeParam T Type of iterable's values\n * @param fn Function to call for each item. If function returns _false_, iteration cancels\n */\nexport function forEach<T>(iterator: Iterable<T> | Array<T>, fn: (v: T) => boolean | void) {\n  for (const v of iterator) {\n    const result = fn(v);\n    if (typeof result === `boolean` && !result) break;\n  }\n}\n\n/**\n * ```js\n * filter([1, 2, 3, 4], e => e % 2 == 0);\n * returns [2, 4]\n * ```\n * @param it\n * @param f\n */\nexport function* filter<V>(it: Iterable<V>, f: (v: V) => boolean) {\n  // https://surma.github.io/underdash/\n\n  for (const v of it) {\n    if (!f(v)) continue;\n    yield v;\n  }\n}\n\nexport function find<V>(it: Iterable<V>, f: (v: V) => boolean) {\n  // https://surma.github.io/underdash/\n\n  for (const v of it) {\n    if (f(v)) return v;\n  }\n}\n\nexport function* flatten<V>(it: Iterable<V>) {\n  // https://surma.github.io/underdash/\n  for (const v of it) {\n    if (typeof v === `object`) {\n      if (Array.isArray(v)) {\n        for (const vv of v) yield vv;\n      } else if (isIterable(v)) {\n        for (const vv of v) {\n          yield vv;\n        }\n      }\n    } else {\n      yield v;\n    }\n\n  }\n}\n\n\n/**\n * Maps an iterable of type `V` to type `X`.\n * ```js\n * map([1, 2, 3], e => e*e)\n * returns [1, 4, 9]\n * ```\n * @param it\n * @param f\n */\n//eslint-disable-next-line func-style\nexport function* map<V, X>(it: Iterable<V>, f: (v: V) => X) {\n  // https://surma.github.io/underdash/\n\n  for (const v of it) {\n    yield f(v);\n  }\n}\n\nexport function* max<V>(it: Iterable<V>, gt = (a: V, b: V) => a > b): Generator<V> {\n  let max: V | undefined;\n  for (const v of it) {\n    if (max === undefined) {\n      max = v;\n      yield max;\n      continue;\n    }\n    if (gt(v, max)) {\n      max = v;\n      yield max;\n    }\n  }\n  return max;\n}\n\nexport function* min<V>(it: Iterable<V>, gt = (a: V, b: V) => a > b) {\n  let min: V | undefined;\n  for (const v of it) {\n    if (min === undefined) {\n      min = v;\n      yield min;\n    }\n    if (gt(min, v)) {\n      min = v;\n      yield min;\n    }\n  }\n}\n\n\n\nexport function some<V>(it: Iterable<V>, f: (v: V) => boolean) {\n  // https://surma.github.io/underdash/\n\n  for (const v of it) {\n    if (f(v)) return true;\n  }\n  return false;\n}\n\n// export function* takeWhile<V>(it: Iterable<V>, f: (v: V) => boolean) {\n//   // https://surma.github.io/underdash/\n//   for (const v of it) {\n//     if (!f(v)) return;\n//     yield v;\n//   }\n// }\n\nexport function* repeat<T>(genCreator: () => Iterable<T>, repeatsOrSignal: number | AbortSignal): Generator<T> {\n  const repeats = typeof repeatsOrSignal === `number` ? repeatsOrSignal : Number.POSITIVE_INFINITY;\n  const signal = typeof repeatsOrSignal === `number` ? undefined : repeatsOrSignal;\n  let count = repeats;\n\n  while (true) {\n    for (const v of genCreator()) {\n      yield v;\n      if (signal?.aborted) break;\n    }\n    if (Number.isFinite(repeats)) {\n      count--;\n      if (count === 0) break;\n    }\n    if (signal?.aborted) break;\n  }\n}\n\n\nexport function* unique<V>(\n  iterable: Iterable<V> | Array<Iterable<V>>\n) {\n  // Adapted from https://surma.github.io/underdash/\n  const buffer: Array<any> = [];\n  let itera: Array<Iterable<V>> = [];\n  itera = Array.isArray(iterable) ? iterable : [ iterable ];\n  for (const it of itera) {\n    for (const v of it) {\n      if (buffer.includes(v)) continue;\n      buffer.push(v);\n      yield v;\n    }\n  }\n}\n\n/**\n * Combine same-positioned items from several iterables\n * ```js\n * zip( [1, 2, 3], [4, 5, 6], [7, 8, 9] );\n * Yields: [ [1, 4, 7], [2, 5, 8], [3, 6, 9] ]\n * ```\n * @param its\n * @returns\n */\n//eslint-disable-next-line func-style\nexport function* zip<V>(...its: ReadonlyArray<Iterable<V>>) {\n  // https://surma.github.io/underdash/\n  const iits = its.map((it) => it[ Symbol.iterator ]());\n\n  while (true) {\n    const vs = iits.map((it) => it.next());\n    if (vs.some((v) => v.done)) return;\n    yield vs.map((v) => v.value as V);\n  }\n}\n\nexport function* fromIterable<T>(iterable: Iterable<T>) {\n  for (const v of iterable) {\n    yield v;\n  }\n}\n\n/**\n * Returns an array of values from an iterator.\n *\n * ```js\n * const data = await toArray(adsrIterable(opts, 10));\n * ```\n *\n * Note: If the iterator is infinite, be sure to provide a limit via the options or the function\n * will never return.\n *\n * @param it Asynchronous iterable\n * @param options Options when converting to array.\n * @returns\n */\n//eslint-disable-next-line func-style\nexport function toArray<V>(\n  it: Iterable<V>,\n  options: Partial<ToArrayOptions> = {}\n): Array<V> {\n  const result: Array<V> = [];\n  const started = Date.now();\n  const whileFunc = options.while;\n  const maxItems = options.limit ?? Number.POSITIVE_INFINITY;\n  const maxElapsed = intervalToMs(options.elapsed, Number.POSITIVE_INFINITY);\n  for (const v of it) {\n    if (whileFunc) {\n      if (!whileFunc(result.length)) break;\n    }\n    if (result.length >= maxItems) break;\n    if (Date.now() - started > maxElapsed) break;\n    result.push(v);\n  }\n  return result;\n}\n\n/**\n * Yield values from `array`, one at a time.\n * Use `interval` to add time between each item.\n * The first item is yielded without delay.\n * @param array Array of values\n */\nexport function* fromArray<V>(array: Array<V>): Generator<V> {\n  for (const v of array) {\n    yield v;\n  }\n}","import type { StackOpts } from './Types.js';\n\nexport const trimStack = <V>(\n  opts: StackOpts,\n  stack: ReadonlyArray<V>,\n  toAdd: ReadonlyArray<V>\n): ReadonlyArray<V> => {\n  const potentialLength = stack.length + toAdd.length;\n  const policy = opts.discardPolicy ?? `additions`;\n  const capacity = opts.capacity ?? potentialLength;\n  const toRemove = potentialLength - capacity;\n  if (opts.debug) {\n    console.log(\n      `Stack.push: stackLen: ${ stack.length } potentialLen: ${ potentialLength } toRemove: ${ toRemove } policy: ${ policy }`\n    );\n  }\n  switch (policy) {\n    case `additions`: {\n      if (opts.debug) {\n        console.log(\n          `Stack.push:DiscardAdditions: stackLen: ${ stack.length } slice: ${ potentialLength - capacity\n          } toAddLen: ${ toAdd.length }`\n        );\n      }\n\n      // eslint-disable-next-line unicorn/prefer-ternary\n      if (stack.length === opts.capacity) {\n        return stack; // Completely full\n      } else {\n        // Only add some from the new array\n        return [ ...stack, ...toAdd.slice(0, toAdd.length - toRemove) ];\n      }\n    }\n    case `newer`: {\n      if (toRemove >= stack.length) {\n        // New items will completely flush out old\n        return toAdd.slice(\n          Math.max(0, toAdd.length - capacity),\n          Math.min(toAdd.length, capacity) + 1\n        );\n      } else {\n        // Keep some of the old (from 0)\n        //if (opts.debug) console.log(` orig: ${JSON.stringify(stack)}`);\n        if (opts.debug) {\n          console.log(` from orig: ${ JSON.stringify(stack.slice(0, stack.length - toRemove)) }`);\n        }\n        return [\n          ...stack.slice(0, stack.length - toRemove),\n          ...toAdd.slice(0, Math.min(toAdd.length, capacity - toRemove + 1)),\n        ];\n      }\n    }\n    case `older`: {\n      // Oldest item in stack is position 0\n      return [ ...stack, ...toAdd ].slice(toRemove);\n    }\n    default: {\n      // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n      throw new Error(`Unknown discard policy ${ policy }`);\n    }\n  }\n};\n\n// Add to top (last index)\nexport const push = <V>(\n  opts: StackOpts,\n  stack: ReadonlyArray<V>,\n  ...toAdd: ReadonlyArray<V>\n): ReadonlyArray<V> => {\n  // If stack is A, B and toAdd is C, D this yields A, B, C, D\n  //const mutated = [...stack, ...toAdd];\n  const potentialLength = stack.length + toAdd.length;\n\n  const overSize = opts.capacity && potentialLength > opts.capacity;\n  const toReturn = overSize\n    ? trimStack(opts, stack, toAdd)\n    : [ ...stack, ...toAdd ];\n  return toReturn;\n};\n\n// Remove from top (last index)\nexport const pop = <V>(\n  opts: StackOpts,\n  stack: ReadonlyArray<V>\n): ReadonlyArray<V> => {\n  if (stack.length === 0) throw new Error(`Stack is empty`);\n  return stack.slice(0, - 1);\n};\n\n/**\n * Peek at the top of the stack (end of array)\n *\n * @typeParam V - Type of stored items\n * @param {StackOpts} opts\n * @param {V[]} stack\n * @returns {(V | undefined)}\n */\nexport const peek = <V>(\n  opts: StackOpts,\n  stack: ReadonlyArray<V>\n): V | undefined => stack.at(-1);\n\nexport const isEmpty = <V>(opts: StackOpts, stack: ReadonlyArray<V>): boolean =>\n  stack.length === 0;\n\nexport const isFull = <V>(\n  opts: StackOpts,\n  stack: ReadonlyArray<V>\n): boolean => {\n  if (opts.capacity) {\n    return stack.length >= opts.capacity;\n  }\n  return false;\n};\n","// -------------------------\n// Mutable\n// -------------------------\n\nimport type { IStackMutable } from './IStackMutable.js';\nimport { push, peek, pop, isEmpty, isFull } from './StackFns.js';\nimport type { StackOpts } from './Types.js';\n\n/**\n * Creates a stack. Mutable. Use {@link StackImmutable} for an immutable alternative.\n *\n * @example Basic usage\n * ```js\n * // Create\n * const s = new StackMutable();\n * // Add one or more items\n * s.push(1, 2, 3, 4);\n *\n * // See what's on top\n * s.peek;  // 4\n *\n * // Remove the top-most, and return it\n * s.pop();   // 4\n *\n * // Now there's a new top-most element\n * s.peek;  // 3\n * ```\n */\nexport class StackMutable<V> implements IStackMutable<V> {\n  readonly opts: StackOpts;\n  /* eslint-disable-next-line functional/prefer-readonly-type */\n  data: ReadonlyArray<V>;\n\n  constructor(opts: StackOpts = {}, data: ReadonlyArray<V> = []) {\n    this.opts = opts;\n    this.data = data;\n  }\n\n  /**\n   * Push data onto the stack.\n   * If `toAdd` is empty, nothing happens\n   * @param toAdd Data to add\n   * @returns Length of stack\n   */\n  push(...toAdd: ReadonlyArray<V>): number {\n    if (toAdd.length === 0) return this.data.length;\n    this.data = push(this.opts, this.data, ...toAdd);\n    return this.data.length;\n  }\n\n  forEach(fn: (v: V) => void): void {\n    this.data.forEach(fn);\n  }\n\n  forEachFromTop(fn: (v: V) => void): void {\n    [ ...this.data ].reverse().forEach(fn);\n  }\n\n  pop(): V | undefined {\n    const v = peek(this.opts, this.data);\n    this.data = pop(this.opts, this.data);\n    return v;\n  }\n\n  get isEmpty(): boolean {\n    return isEmpty(this.opts, this.data);\n  }\n\n  get isFull(): boolean {\n    return isFull(this.opts, this.data);\n  }\n\n  get peek(): V | undefined {\n    return peek(this.opts, this.data);\n  }\n\n  get length(): number {\n    return this.data.length;\n  }\n}\n\n/**\n * Creates a stack. Mutable. Use {@link Stacks.immutable} for an immutable alternative.\n *\n * @example Basic usage\n * ```js\n * // Create\n * const s = Stacks.mutable();\n * // Add one or more items\n * s.push(1, 2, 3, 4);\n *\n * // See what's on top\n * s.peek;  // 4\n *\n * // Remove the top-most, and return it\n * s.pop();   // 4\n *\n * // Now there's a new top-most element\n * s.peek;  // 3\n * ```\n */\nexport const mutable = <V>(\n  opts: StackOpts = {},\n  ...startingItems: ReadonlyArray<V>\n): IStackMutable<V> => new StackMutable({ ...opts }, [ ...startingItems ]);\n","import { isEqualDefault, type IsEqual } from \"../../util/IsEqual.js\"\nimport { without } from '../../data/arrays/Filter.js';\nimport { containsDuplicateInstances } from \"../../data/arrays/ContainsDuplicateInstances.js\";\nimport { QueueMutable } from \"../queue/QueueMutable.js\"\nimport { StackMutable } from \"../stack/StackMutable.js\"\nimport { compare as treeCompare } from './Compare.js';\nimport { toStringAbbreviate } from \"../../Text.js\"\nimport type { LabelledSingleValue, TreeNode, SimplifiedNode, TraversableTree } from \"./Types.js\"\n\n/**\n * Compares two nodes.\n * \n * By default uses `isEqualValueIgnoreOrder` to compare nodes. This means\n * values of nodes will be compared, ignoring the order of fields.\n * @param a \n * @param b \n * @param eq Comparison function. Uses `isEqualValueIgnoreOrder` by default.\n * @returns Compare results\n */\nexport const compare = <T>(a: TreeNode<T>, b: TreeNode<T>, eq?: IsEqual<T>) => {\n  return treeCompare(asDynamicTraversable(a), asDynamicTraversable(b), eq);\n}\n\n/**\n * Converts `TreeNode` to `SimplifiedNode`, removing the 'parent' fields.\n * This can be useful because if you have the whole tree, the parent field\n * is redundant and because it makes circular references can make dumping to console etc more troublesome.\n * \n * Recursive: strips parentage of all children and so on too.\n * @param node \n * @returns \n */\nexport const stripParentage = <T>(node: TreeNode<T>): SimplifiedNode<T> => {\n  const n: SimplifiedNode<T> = {\n    value: node.value,\n    childrenStore: node.childrenStore.map(c => stripParentage(c))\n  }\n  return n;\n}\n/**\n * Wraps a {@link TreeNode} for a more object-oriented means of access.\n */\nexport type WrappedNode<T> = TraversableTree<T> & {\n  /**\n   * Underlying Node\n   */\n  wraps: TreeNode<T>,\n  /**\n   * Gets value, if defined\n   * @returns Value of Node\n   */\n  getValue: () => T | undefined\n  /**\n   * Remove node and its children from tree\n   * @returns \n   */\n  remove: () => void\n  /**\n   * Adds a child node\n   * @param child \n   * @returns \n   */\n  add: (child: WrappedNode<T> | TreeNode<T>) => WrappedNode<T>\n  /**\n   * Adds a new child node, with `value` as its value\n   * @param value \n   * @returns \n   */\n  addValue: (value: T) => WrappedNode<T>\n  /**\n   * Returns _true_ if `child` is an immediate child of this node\n   * @param child \n   * @returns \n   */\n  hasChild: (child: WrappedNode<T> | TreeNode<T>) => boolean\n  queryValue: (value: T) => IterableIterator<WrappedNode<T>>\n  /**\n   * Returns _true_ if `child` is contained any any descendant\n   * @param child\n   * @returns \n   */\n  hasAnyChild: (child: WrappedNode<T> | TreeNode<T>) => boolean\n  /**\n   * Returns _true_ if `parent` is the immediate parent for this node\n   * @param parent \n   * @returns \n   */\n  hasParent: (parent: WrappedNode<T> | TreeNode<T>) => boolean\n  /**\n   * Returns _true_ if `parent` is the immediate or ancestor parent for this node\n   * @param parent \n   * @returns \n   */\n  hasAnyParent: (parent: WrappedNode<T> | TreeNode<T>) => boolean\n}\n\nconst unwrapped = <T>(node: TreeNode<T> | WrappedNode<T>) => (`wraps` in node) ? node.wraps : node;\nconst wrapped = <T>(node: TreeNode<T> | WrappedNode<T>) => (`wraps` in node) ? node : wrap(node);\n\n/**\n * Wraps node `n` for a more object-oriented means of access.\n * It will wrap child nodes on demand. For this reason, WrappedNode object\n * identity is not stable\n * @param n Node to wrap\n * @returns \n */\nexport const wrap = <T>(n: TreeNode<T>): WrappedNode<T> => {\n  return {\n    *children() {\n      for (const c of n.childrenStore) {\n        yield wrap(c)\n      }\n    },\n    getValue: () => n.value as T,\n    getIdentity: () => n,\n    *queryValue(value: T): IterableIterator<WrappedNode<T>> {\n      for (const v of queryByValue(value, unwrapped(n))) {\n        yield wrap(v);\n      }\n    },\n    getParent: () => n.parent === undefined ? undefined : wrap(n.parent),\n    hasParent: (parent: WrappedNode<T> | TreeNode<T>): boolean => {\n      return hasParent(n, unwrapped(parent));\n    },\n    hasAnyParent: (parent: WrappedNode<T> | TreeNode<T>): boolean => {\n      return hasAnyParent(n, unwrapped(parent));\n    },\n    hasChild: (child: WrappedNode<T> | TreeNode<T>): boolean => {\n      return hasChild(unwrapped(child), n);\n    },\n    hasAnyChild: (child: WrappedNode<T> | TreeNode<T>): boolean => {\n      return hasAnyChild(unwrapped(child), n);\n    },\n    remove: () => {\n      remove(n);\n    },\n    addValue: (value: T): WrappedNode<T> => {\n      const nodeValue = addValue(value, n);\n      return wrap(nodeValue);\n    },\n    add: (child: WrappedNode<T> | TreeNode<T>): WrappedNode<T> => {\n      add(unwrapped(child), n);\n      return wrapped(child);\n    },\n    wraps: n\n  }\n}\n\n/**\n * Removes `child` from the tree structure it is in.\n * It removes `child` from its parent. Any sub-children of `child` still remain connected.\n * @param child \n * @returns \n */\nexport const remove = <T>(child: TreeNode<T>) => {\n  const p = child.parent;\n  if (p === undefined) return;\n  child.parent = undefined;\n  p.childrenStore = without(p.childrenStore, child);\n};\n\n/**\n * Depth-first iteration of the children of `node`\n * @param node \n * @returns \n */\nexport function* depthFirst<T>(node: TreeNode<T>): IterableIterator<TreeNode<T>> {\n  if (!root) return;\n  const stack = new StackMutable<TreeNode<T>>();\n  stack.push(...node.childrenStore);\n  let entry: TreeNode<T> | undefined = stack.pop();\n  while (entry) {\n    yield entry;\n    if (entry) {\n      stack.push(...entry.childrenStore);\n    }\n    if (stack.isEmpty) break;\n    entry = stack.pop();\n  }\n}\n\n/**\n * Breadth-first iteration of the children of `node`\n * @param node \n * @returns \n */\nexport function* breadthFirst<T>(node: TreeNode<T>): IterableIterator<TreeNode<T>> {\n  if (!node) return;\n  const queue = new QueueMutable<TreeNode<T>>();\n  queue.enqueue(...node.childrenStore);\n  let entry: TreeNode<T> | undefined = queue.dequeue();\n  while (entry) {\n    yield entry;\n    if (entry) {\n      queue.enqueue(...entry.childrenStore);\n    }\n    if (queue.isEmpty) break;\n    entry = queue.dequeue();\n  }\n}\n\n/**\n * Validates the tree from `root` downwards.\n * @param root \n * @param seen \n * @returns \n */\nexport function treeTest<T>(root: TreeNode<T>, seen: Array<TreeNode<T>> = []): [ ok: boolean, msg: string, node: TreeNode<T> ] {\n  if (root.parent === root) return [ false, `Root has itself as parent`, root ];\n  if (seen.includes(root)) return [ false, `Same node instance is appearing further in tree`, root ];\n  seen.push(root);\n  if (containsDuplicateInstances(root.childrenStore)) return [ false, `Children list contains duplicates`, root ];\n\n  for (const c of root.childrenStore) {\n    if (c.parent !== root) return [ false, `Member of childrenStore does not have .parent set`, c ];\n    if (hasAnyChild(root, c)) return [ false, `Child has parent as its own child`, c ];\n    const v = treeTest(c, seen);\n    if (!v[ 0 ]) return v;\n  }\n  return [ true, ``, root ];\n}\n\n/**\n * Throws an exception if `root` fails tree validation\n * @param root \n * @returns \n */\nexport function throwTreeTest<T>(root: TreeNode<T>) {\n  const v = treeTest(root);\n  if (v[ 0 ]) return;\n  throw new Error(`${ v[ 1 ] } Node: ${ toStringAbbreviate(v[ 2 ].value, 30) }`, { cause: v[ 2 ] })\n}\n/**\n * Iterate over direct children of `root`\n * @param root \n */\nexport function* children<T>(root: TreeNode<T>): IterableIterator<TreeNode<T>> {\n  for (const c of root.childrenStore) {\n    yield c;\n  }\n}\n\n/**\n * Iterate over all parents of `root`. First result is the immediate parent.\n * @param root \n */\nexport function* parents<T>(root: TreeNode<T>): IterableIterator<TreeNode<T>> {\n  let p = root.parent;\n  while (p) {\n    yield p;\n    p = p.parent;\n  }\n}\n\n/**\n * Returns the depth of `node`. A root node (ie. with no parents) has a depth of 0.\n * @param node \n * @returns \n */\nexport function nodeDepth(node: TreeNode<any>): number {\n  const p = [ ...parents(node) ];\n  return p.length;\n}\n\nexport const hasChild = <T>(child: TreeNode<T>, parent: TreeNode<T>) => {\n  for (const c of parent.childrenStore) {\n    if (c === child) return true;\n  }\n  return false;\n}\n\nexport const findChildByValue = <T>(value: T, parent: TreeNode<T>, eq: IsEqual<T> = isEqualDefault): TreeNode<T> | undefined => {\n  for (const c of parent.childrenStore) {\n    if (eq(value, c.value as T)) return c;\n  }\n}\n\nexport function* queryByValue<T>(value: T, parent: TreeNode<T>, eq: IsEqual<T> = isEqualDefault): IterableIterator<TreeNode<T>> {\n  for (const c of parent.childrenStore) {\n    if (eq(value, c.value as T)) yield c;\n  }\n}\n\n/**\n * Returns _true_ if `prospectiveChild` is some child node of `parent`,\n * anywhere in the tree structure.\n * \n * Use {@link hasChild} to only check immediate children.\n * @param prospectiveChild \n * @param parent \n * @returns \n */\nexport const hasAnyChild = <T>(prospectiveChild: TreeNode<T>, parent: TreeNode<T>) => {\n  for (const c of breadthFirst(parent)) {\n    if (c === prospectiveChild) return true;\n  }\n  return false;\n}\n\nexport const findAnyChildByValue = <T>(value: T, parent: TreeNode<T>, eq: IsEqual<T> = isEqualDefault) => {\n  for (const c of breadthFirst(parent)) {\n    if (eq(c.value as T, value)) return c;\n  }\n}\n\nexport const getRoot = <T>(node: TreeNode<T>): TreeNode<T> => {\n  if (node.parent) return getRoot(node.parent);\n  return node;\n}\n\n/**\n * Returns _true_ if `prospectiveParent` is any ancestor\n * parent of `child`.\n * \n * Use {@link hasParent} to only check immediate parent.\n * @param child \n * @param prospectiveParent \n * @returns \n */\nexport const hasAnyParent = <T>(child: TreeNode<T>, prospectiveParent: TreeNode<T>) => {\n  for (const p of parents(child)) {\n    if (p === prospectiveParent) return true;\n  }\n  return false;\n}\n\n/**\n * Returns _true_ if `prospectiveParent` is the immediate\n * parent of `child`.\n * \n * Use {@link hasAnyParent} to check for any ancestor parent.\n * @param child \n * @param prospectiveParent \n * @returns \n */\nexport const hasParent = <T>(child: TreeNode<T>, prospectiveParent: TreeNode<T>) => {\n  return child.parent === prospectiveParent;\n}\n\n/**\n * Computes the maximum depth of the tree.\n * That is, how many steps down from `node` it can go.\n * If a tree is: root -> childA -> subChildB\n * ```js\n * // Yields 2, since there are at max two steps down from root\n * computeMaxDepth(root); \n * ```\n * @param node \n * @returns \n */\nexport const computeMaxDepth = <T>(node: TreeNode<T>) => {\n  return computeMaxDepthImpl(node, 0);\n}\n\nconst computeMaxDepthImpl = <T>(node: TreeNode<T>, startingDepth = 0) => {\n  let depth = startingDepth;\n  for (const c of node.childrenStore) {\n    depth = Math.max(depth, computeMaxDepthImpl(c, startingDepth + 1));\n  }\n  return depth;\n}\n\nexport const add = <T>(child: TreeNode<T>, parent: TreeNode<T>) => {\n  throwAttemptedChild(child, parent);\n  //if (hasAnyChild(parent, child)) throw new Error(`Parent already contains child`);\n  //if (hasAnyParent(child, parent)) throw new Error(`Child already has parent`);\n  const p = child.parent;\n  parent.childrenStore = [ ...parent.childrenStore, child ];\n  child.parent = parent;\n  if (p) {\n    p.childrenStore = without(p.childrenStore, child);\n  }\n}\n\nexport const addValue = <T>(value: T | undefined, parent: TreeNode<T>) => {\n  return createNode(value, parent);\n}\n\n/**\n * Creates the root for a tree, with an optional `value`.\n * Use {@link rootWrapped} if you want a more object-oriented mode of access.\n * @param value \n * @returns \n */\nexport const root = <T>(value?: T | undefined) => {\n  return createNode(value);\n}\n\nexport const fromPlainObject = (value: Record<string, any>, label = ``, parent?: TreeNode<any>, seen: Array<any> = []): TreeNode<LabelledSingleValue<any>> => {\n  const entries = Object.entries(value);\n  parent = parent === undefined ? root() : addValue<LabelledSingleValue<any>>({ label, value }, parent);\n  for (const entry of entries) {\n    const value = entry[ 1 ];\n    // Avoid circular references\n    if (seen.includes(value)) continue;\n    seen.push(value);\n\n    if (typeof entry[ 1 ] === `object`) {\n      fromPlainObject(value, entry[ 0 ], parent, seen);\n    } else {\n      addValue<LabelledSingleValue<any>>({ label: entry[ 0 ], value: value }, parent);\n    }\n  }\n  return parent;\n}\n\n/**\n * Creates a tree, returning it as a {@link WrappedNode} for object-oriented access.\n * Use {@link root} alternatively.\n * @param value \n * @returns \n */\nexport const rootWrapped = <T>(value: T | undefined) => {\n  return wrap(createNode(value));\n}\n\nexport const createNode = <T>(value: T | undefined, parent?: TreeNode<T> | undefined): TreeNode<T> => {\n  const n: TreeNode<T> = {\n    childrenStore: [],\n    parent: parent,\n    value: value\n  }\n  if (parent !== undefined) {\n    parent.childrenStore = [ ...parent.childrenStore, n ];\n  }\n  return n;\n}\n\nexport const childrenLength = <T>(node: TreeNode<T>): number => {\n  return node.childrenStore.length;\n}\n\nexport const value = <T>(node: TreeNode<T>): T | undefined => {\n  return node.value;\n}\n\n/**\n * Projects `node` as a dynamic traversable.\n * Dynamic in the sense that it creates the traversable project for nodes on demand.\n * A consequence is that node identities are not stable.\n * @param node \n * @returns \n */\nexport const asDynamicTraversable = <T>(node: TreeNode<T>): TraversableTree<T> => {\n  const t: TraversableTree<T> = {\n    *children() {\n      for (const c of node.childrenStore) {\n        yield asDynamicTraversable(c);\n      }\n    },\n    getParent() {\n      if (node.parent === undefined) return;\n      return asDynamicTraversable(node.parent);\n    },\n    getValue(): any {\n      return node.value;\n    },\n    getIdentity() {\n      return node;\n    },\n  }\n  return t;\n}\n\nconst throwAttemptedChild = <T>(c: TreeNode<T>, parent: TreeNode<T>) => {\n  if (parent === c) throw new Error(`Cannot add self as child`);\n  if (c.parent === parent) return; // skip if it's already a child\n  if (hasAnyParent(parent, c)) throw new Error(`Child contains parent (1)`, { cause: c });\n  if (hasAnyParent(c, parent)) throw new Error(`Parent already contains child`, { cause: c });\n  if (hasAnyChild(parent, c)) throw new Error(`Child contains parent (2)`, { cause: c });\n}\n\nexport const setChildren = <T>(parent: TreeNode<T>, children: Array<TreeNode<T>>) => {\n  // Verify children are legit\n  for (const c of children) {\n    throwAttemptedChild(c, parent);\n  }\n\n  parent.childrenStore = [ ...children ];\n  for (const c of children) {\n    c.parent = parent;\n  }\n}\n\nexport const toStringDeep = <T>(node: TreeNode<T>, indent = 0): string => {\n  const t = `${ `  `.repeat(indent) } + ${ node.value ? JSON.stringify(node.value) : `-` }`;\n  return node.childrenStore.length > 0 ? (\n    t +\n    `\\n` +\n    node.childrenStore.map((d) => toStringDeep(d, indent + 1)).join(`\\n`)\n  ) : t;\n}\n\nexport function* followValue<T>(root: TreeNode<T>, continuePredicate: (nodeValue: T, depth: number) => boolean, depth = 1): IterableIterator<T | undefined> {\n  for (const c of root.childrenStore) {\n    const value = c.value;\n    if (value === undefined) continue;\n    if (continuePredicate(value, depth)) {\n      yield c.value;\n      yield* followValue(c, continuePredicate, depth + 1);\n    }\n  }\n}\n\n// export function* followNode<T>(root: Node<T>, continuePredicate: (nodeValue: T | undefined, depth: number) => boolean, depth = 1): IterableIterator<Node<T>> {\n//   for (const c of root.childrenStore) {\n//     if (continuePredicate(c.value, depth)) {\n//       yield c;\n//       yield* followNode(c, continuePredicate, depth + 1);\n//     }\n//   }\n// }","import { type IsEqual, isEqualValueIgnoreOrder } from \"../../util/IsEqual.js\";\nimport * as TreeMutable from './TreeMutable.js';\nimport type { TreeNode, TraversableTree } from './Types.js';\n\nexport type DiffAnnotation<T> = {\n  /**\n   * In the case of changes, this is old value\n   */\n  a: TraversableTree<T>\n  /**\n   * In the case of changes, this is the new value\n   */\n  b: TraversableTree<T>\n  /**\n   * If true, this node's value has been modified\n   */\n  valueChanged: boolean\n  /**\n   * If true, one of the child values has changed\n   */\n  childChanged: boolean\n  /**\n   * List of new children\n   */\n  added: Array<TraversableTree<T>>\n  /**\n   * List of removed children\n   */\n  removed: Array<TraversableTree<T>>\n}\n\nexport type DiffNode<T> = TreeNode<DiffAnnotation<T>> & {\n  toString: () => string\n};\n\nexport const compare = <T>(a: TraversableTree<T>, b: TraversableTree<T>, eq: IsEqual<T> = isEqualValueIgnoreOrder, parent?: DiffNode<T> | undefined): DiffNode<T> => {\n  const valueEqual = valueOrIdentityEqual(a, b, eq);\n  // if (!valueEqual) {\n  //   nsole.log(`changed compare a: ${ toStringSingle(a) } b: ${ toStringSingle(b) }`);\n  // }\n  const childrenCompare = compareChildren(a, b, eq);\n\n  const diff: DiffAnnotation<T> = {\n    valueChanged: !valueEqual, a, b,\n    added: childrenCompare.added,\n    removed: childrenCompare.removed,\n    childChanged: false\n  }\n  const diffNode: DiffNode<T> = {\n    value: diff,\n    childrenStore: [],\n    parent\n  }\n\n  const childrenDiff = childrenCompare.identical.map(c => compare(c[ 0 ], c[ 1 ], eq, diffNode));\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  const someChildChange = hasChange(diff) || childrenDiff.some(v => hasChange(v.value!));\n  TreeMutable.setChildren(diffNode, childrenDiff);\n  //diffNode.childrenStore = childrenDiff;\n\n  diffNode.toString = () => toString(diffNode, 0);\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  diffNode.value!.childChanged = someChildChange;\n  TreeMutable.throwTreeTest(diffNode);\n\n  return diffNode;\n}\n\nconst hasChange = (vv: DiffAnnotation<any>): boolean => {\n  if (vv === undefined) return false;\n  if (vv.valueChanged) return true;\n  if (vv.childChanged) return true;\n  if (vv.added.length > 0) return true;\n  if (vv.removed.length > 0) return true;\n  return false;\n}\n\n\nconst compareChildren = <T>(a: TraversableTree<T>, b: TraversableTree<T>, eq: IsEqual<T> = isEqualValueIgnoreOrder) => {\n  const childrenOfA = [ ...a.children() ];\n  const childrenOfB = [ ...b.children() ];\n\n  const identical: Array<[ a: TraversableTree<T>, b: TraversableTree<T> ]> = []\n  const removed: Array<TraversableTree<T>> = [];\n  for (const childA of childrenOfA) {\n    let foundIndex = -1;\n    for (const [ index, childOfB ] of childrenOfB.entries()) {\n      const d = valueOrIdentityEqual(childA, childOfB, eq);\n      if (d) {\n        identical.push([ childA, childOfB ]);\n        foundIndex = index;\n        break;\n      }\n    }\n    if (foundIndex === -1) {\n      // A's child not found in B's children\n      removed.push(childA);\n    } else {\n      // Found, remove it from list of B's children\n      childrenOfB.splice(foundIndex, 1);\n    }\n  }\n  const added = [ ...childrenOfB ];\n  return { added, identical, removed }\n}\n\nconst valueOrIdentityEqual = <T>(a: TraversableTree<T>, b: TraversableTree<T>, eq: IsEqual<T>): boolean => {\n  if (a.getIdentity() === b.getIdentity()) return true;\n  if (eq(a.getValue(), b.getValue())) return true;\n  return false;\n}\n\nconst toStringSingle = <T>(n: TraversableTree<T>) => {\n  return JSON.stringify(n.getValue());\n}\n\nconst toString = <T>(n: DiffNode<T>, indent = 0): string => {\n  if (n === undefined) return `(undefined)`;\n  let t = toStringDiff(n.value, indent);\n  for (const c of n.childrenStore) {\n    t += toString(c, indent + 2);\n  }\n  return t;\n}\n\nconst toStringDiff = <T>(n: DiffAnnotation<T> | undefined, indent: number): string => {\n  const spaces = ` `.repeat(indent);\n  if (n === undefined) return `${ spaces }(undefined)`;\n  const t = [];\n  t.push(`a: ${ toStringSingle(n.a) } b: ${ toStringSingle(n.b) }`);\n  if (n.valueChanged) t.push(`Value changed. Child changed: ${ n.childChanged }`);\n  else t.push(`Value unchanged. Child changed: ${ n.childChanged }`);\n\n  if (n.added.length > 0) {\n    t.push(`Added:`);\n    for (const c of n.added) {\n      t.push(` - ` + toStringSingle(c));\n    }\n  }\n  if (n.removed.length > 0) {\n    t.push(`Removed: ${ n.removed.length }`);\n    for (const c of n.removed) {\n      t.push(` - ` + toStringSingle(c));\n    }\n  }\n  t.push(`----\\n`)\n  return t.map(line => spaces + line).join(`\\n`);\n}","import { toStringAbbreviate } from '../../Text.js';\n\nimport { last } from '../../iterables/IterableSync.js';\nimport * as TreeArrayBacked from './TreeMutable.js';\nimport { isPrimitive } from '../../IsPrimitive.js';\nimport type { TraversableTree, TreeNode, SimplifiedNode } from './Types.js';\nimport { throwNullUndef } from '../../util/GuardEmpty.js';\nexport type Entry = Readonly<{ name: string, sourceValue: any, nodeValue: any }>;\nexport type EntryWithAncestors = Readonly<{ name: string, sourceValue: any, nodeValue: any, ancestors: Array<string> }>;\nexport type EntryStatic = Readonly<{ name: string, value: any, ancestors?: Array<string> }>\n\n/**\n * Options for parsing a path\n */\nexport type PathOpts = {\n  /**\n   * Separator for path, eg '.'\n   */\n  readonly separator?: string;\n\n};\n\n/**\n * Helper function to get a 'friendly' string representation of an array of {@link Entry}.\n * @param entries \n * @returns \n */\nexport function prettyPrintEntries(entries: ReadonlyArray<Entry>) {\n  if (entries.length === 0) return `(empty)`;\n  let t = ``;\n  for (const [ index, entry ] of entries.entries()) {\n    t += `  `.repeat(index);\n    t += entry.name + ` = ` + JSON.stringify(entry.nodeValue) + `\\n`;\n  }\n  return t;\n}\n\n/**\n * Returns a human-friendly debug string for a tree-like structure\n * ```js\n * console.log(Trees.prettyPrint(obj));\n * ```\n * @param indent\n * @param node\n * @param options\n * @returns\n */\nexport const prettyPrint = (\n  node: object,\n  indent = 0,\n  options: Partial<ChildrenOptions> = {}\n): string => {\n  throwNullUndef(node, `node`);\n  const defaultName = options.name ?? `node`;\n  const entry = getNamedEntry(node, defaultName);\n  const t = `${ `  `.repeat(indent) } + name: ${ entry.name } value: ${ JSON.stringify(entry.nodeValue) }`;\n  const childrenAsArray = [ ...children(node, options) ];\n  return childrenAsArray.length > 0 ? (\n    t +\n    `\\n` +\n    childrenAsArray.map((d) => prettyPrint(d.nodeValue, indent + 1, { ...options, name: d.name })).join(`\\n`)\n  ) : t;\n};\n\n/**\n * Returns a debug string representation of the node (recursive)\n * @param node \n * @param indent \n * @returns \n */\nexport const toStringDeep = (node: TreeNode<Entry | EntryStatic>, indent = 0) => {\n  let t = ` `.repeat(indent) + ` ${ node.value?.name }`;\n  if (node.value !== undefined) {\n    if (`sourceValue` in node.value && `nodeValue` in node.value) {\n      let sourceValue = toStringAbbreviate(node.value?.sourceValue, 20);\n      const nodeValue = toStringAbbreviate(node.value?.nodeValue, 20);\n      sourceValue = sourceValue === nodeValue ? `` : `source: ` + sourceValue;\n      t += ` = ${ nodeValue } ${ sourceValue }`\n    } else if (`value` in node.value && node.value.value !== undefined) t += ` = ${ node.value.value }`;\n\n    if (`ancestors` in node.value) {\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      t += ` (ancestors: ${ (node.value.ancestors!).join(`, `) })`;\n    }\n  }\n  t += `\\n`\n  for (const c of node.childrenStore) {\n    t += toStringDeep(c, indent + 1);\n  }\n  return t;\n}\n\nexport type ChildrenOptions = Readonly<{\n  filter: `none` | `leaves` | `branches`\n  name: string\n}>;\n\n/**\n * Returns the direct children of a tree-like object as a pairing\n * of node name and value. Supports basic objects, Maps and arrays. \n * \n * Sub-children are included as an object blob.\n * \n * @example Simple object\n * ```js\n * const o = {\n *  colour: {\n *    r: 0.5, g: 0.5, b: 0.5\n *  }\n * };\n * \n * const children = [ ...Trees.children(o) ];\n * // Children:\n * // [\n * //  { name: \"colour\", value: { b: 0.5, g: 0.5, r: 0.5 } }\n * // ]\n * const subChildren = [ ...Trees.children(o.colour) ];\n * // [ { name: \"r\", value: 0.5 }, { name: \"g\", value: 0.5 }, { name: \"b\", value: 0.5 } ]\n * ```\n * \n * Arrays are assigned a name based on index.\n * @example Arrays\n * ```js\n * const colours = [ { r: 1, g: 0, b: 0 }, { r: 0, g: 1, b: 0 }, { r: 0, g: 0, b: 1 } ];\n * // Children: \n * // [\n * //  { name: \"array[0]\", value: {r:1,g:0,b:0} },\n * //  { name: \"array[1]\", value: {r:0,g:1,b:0} },\n * //  { name: \"array[2]\", value: {r:0,g:0,b:1} },\n * // ]\n * ```\n * \n * Pass in `options.name` (eg 'colours') to have names generated as 'colours[0]', etc.\n * Options can also be used to filter children. By default all direct children are returned.\n * @param node \n * @param options  \n */\nexport function* children<T extends object>(\n  node: T,\n  options: Partial<ChildrenOptions> = {}\n): IterableIterator<Entry> {\n  throwNullUndef(node, `node`);\n\n  const filter = options.filter ?? `none`;\n\n  const filterByValue = (v: any): [ filter: boolean, isPrimitive: boolean ] => {\n    if (filter === `none`) return [ true, isPrimitive(v) ];\n    else if (filter === `leaves` && isPrimitive(v)) return [ true, true ];\n    else if (filter === `branches` && !isPrimitive(v)) return [ true, false ];\n    return [ false, isPrimitive(v) ];\n  }\n\n  if (Array.isArray(node)) {\n    //if (options.name === undefined) defaultName = `array`;\n    for (const [ index, element ] of node.entries()) {\n      const f = filterByValue(element);\n      if (f[ 0 ]) {\n        yield { name: index.toString(), sourceValue: element, nodeValue: f[ 1 ] ? element : undefined };\n        //yield { name: defaultName + `[` + index.toString() + `]`, sourceValue: element, nodeValue: f[ 1 ] ? element : undefined };\n      }\n    }\n  } else if (typeof node === `object`) {\n    const entriesIter = (`entries` in node) ? (node as any as Map<any, any>).entries() : Object.entries(node);\n    for (const [ name, value ] of entriesIter) {\n      //onsole.log(`children name: ${ name } type: ${ typeof value } isPrim: ${ isPrimitive(value) } filter: ${ filter }`);\n      const f = filterByValue(value);\n      if (f[ 0 ]) {\n        yield { name: name, sourceValue: value, nodeValue: f[ 1 ] ? value : undefined };\n      }\n    }\n  }\n}\n\nexport function* depthFirst<T extends object>(node: T, options: Partial<ChildrenOptions> = {}, ancestors: Array<string> = []): IterableIterator<EntryWithAncestors> {\n  for (const c of children(node, options)) {\n    //onsole.log(`depthFirst name: ${ c.name } nodeValue: ${ toStringAbbreviate(c.nodeValue) }`)\n    yield { ...c, ancestors: [ ...ancestors ] };\n    yield* depthFirst(c.sourceValue, options, [ ...ancestors, c.name ]);\n  }\n}\n\n/**\n * Finds a given direct child by name\n * @param name\n * @param node\n * @returns\n */\nfunction childByName<T extends object>(\n  name: string,\n  node: T\n): Entry | undefined {\n  for (const d of children(node)) {\n    if (d.name === name) return d;\n  }\n}\n\n/**\n * Returns the closest matching entry, tracing `path` in an array, Map or simple object.\n * Returns an entry with _undefined_ value at the point where tracing stopped.\n * Use {@link traceByPath} to step through all the segments.\n *\n * ```js\n  * const people = {\n    *  jane: {\n *   address: {\n *    postcode: 1000,\n    *    street: 'West St',\n    *    city: 'Blahville'\n *   },\n * colour: 'red'\n  *  }\n * }\n * Trees.getByPath('jane.address.postcode', people); // '.' default separator\n * // ['postcode', 1000]\n * Trees.getByPath('jane.address.country.state', people);\n * // ['country', undefined] - since full path could not be resolved.\n * ```\n * @param path Path, eg `jane.address.postcode`\n * @param node Node to look within\n * @param options Options for parsing path. By default '.' is used as a separator\n * @returns\n */\nexport function getByPath<T extends object>(\n  path: string,\n  node: T,\n  options: PathOpts = {}\n): Entry {\n  // ✔️ Unit tested\n  const v = last(traceByPath(path, node, options));\n  if (!v) throw new Error(`Could not trace path: ${ path } `);\n  return v;\n}\n\n/**\n * Enumerates over children of `node` towards the node named in `path`.\n * This is useful if you want to get the interim steps to the target node.\n * \n * Use {@link getByPath} if you don't care about interim steps.\n *\n * ```js\n  * const people = {\n    *  jane: {\n *   address: {\n *    postcode: 1000,\n    *    street: 'West St',\n    *    city: 'Blahville'\n *   },\n * colour: 'red'\n  *  }\n * }\n * for (const p of Trees.traceByPath('jane.address.street', people)) {\n * // { name: \"jane\", value: { address: { postcode: 1000,street: 'West St', city: 'Blahville' }, colour: 'red'} },\n * // { name: \"address\", value: { postcode: 1000, street: 'West St', city: 'Blahville' } },\n * // { name: \"street\", value: \"West St\" } }\n * }\n * ```\n *\n * Results stop when the path can't be followed any further.\n * The last entry will have a name of the last sought path segment, and _undefined_ as its value.\n * \n * @param path Path to traverse\n * @param node Starting node\n * @param options Options for path traversal logic\n * @returns\n */\nexport function* traceByPath<T extends object>(\n  path: string,\n  node: T,\n  options: PathOpts = {}\n): Iterable<EntryWithAncestors> {\n  // ✔️ Unit tested\n  throwNullUndef(path, `path`);\n  throwNullUndef(node, `node`);\n\n  const separator = options.separator ?? `.`;\n  // const allowArrayIndexes = opts.allowArrayIndexes ?? true;\n  const pathSplit = path.split(separator);\n\n  const ancestors: Array<string> = [];\n  for (const p of pathSplit) {\n    const entry = childByName(p, node);\n    //onsole.log(`traceByPath: entry: ${ entry?.name } path: '${ path }' p: '${ p }' source: ${ JSON.stringify(entry?.sourceValue) }`);\n    // if (allowArrayIndexes) {\n    //   const [ withoutBrackets, arrayIndexString ] = betweenChomp(p, `[`, `]`);\n    //   //onsole.log(`  withoutBrackets: ${ withoutBrackets } str: ${ arrayIndexString } without: ${ withoutBrackets }`);\n    //   const arrayIndex = integerParse(arrayIndexString, `positive`, -1);\n    //   if (arrayIndex >= 0) {\n    //     // Get array by name without the []\n    //     entry = childByName(withoutBrackets, node);\n    //     //onsole.log(`  entry: ${ entry?.name }`);\n    //     if (entry && Array.isArray(entry.sourceValue)) {\n    //       // Result was array as expected\n    //       entry = { name: p, sourceValue: entry.sourceValue[ arrayIndex ], nodeValue: entry.sourceValue[ arrayIndex ] };\n    //     }\n    //   }\n    // }\n\n    if (!entry) {\n      yield { name: p, sourceValue: undefined, nodeValue: undefined, ancestors };\n      return;\n    }\n    node = entry.sourceValue;\n    yield { ...entry, ancestors: [ ...ancestors ] };\n    ancestors.push(p);\n  }\n}\n\n/**\n * Returns a projection of `node` as a dynamic traversable.\n * This means that the tree structure is dynamically created as last-minute as possible.\n * \n * Note that the object identity of TraversableTree return results is not stable.\n * This is because they are created on-the-fly by reading fields of `node`.\n * \n * ```js\n * const c1 = [ ...asDynamicTraversable(someObject).children() ];\n * const c2 = [ ...asDynamicTraversable(someObject).children() ];\n * \n * // Object identity is not the same\n * c1[ 0 ] === c1[ 0 ]; // false\n * // ...even though its referring to the same value\n * c1[ 0 ].getValue() === c1[ 0 ].getValue(); // true\n * ```\n * \n * Instead .getIdentity() to get a stable identity:\n * ```js\n * c1[ 0 ].getIdentity() === c2[ 0 ].getIdentity(); // true\n * ```\n * @param node \n * @param options\n * @param ancestors \n * @param parent \n * @returns \n */\nexport const asDynamicTraversable = <T extends object>(node: T, options: Partial<ChildrenOptions> = {}, ancestors: Array<string> = [], parent?: TraversableTree<EntryStatic> | undefined): TraversableTree<EntryStatic> => {\n  const name = options.name ?? `object`;\n  const t: TraversableTree<EntryStatic> = {\n    *children() {\n      for (const c of children(node, options)) {\n        yield asDynamicTraversable(c.sourceValue, { ...options, name: c.name }, [ ...ancestors, name ], t);\n      }\n    },\n    getParent() {\n      return parent;\n    },\n    getValue() {\n      return { name, value: node, ancestors };\n    },\n    getIdentity() {\n      return node;\n    }\n  }\n  return t;\n}\n\n/**\n * Reads all fields and sub-fields of `node`, returning as a 'wrapped' tree structure.\n * @param node \n * @param options \n * @returns \n */\nexport const createWrapped = <T extends object>(node: T, options: Partial<CreateOptions>): TreeArrayBacked.WrappedNode<any> => {\n  return TreeArrayBacked.wrap(create(node, options));\n};\n\nexport type CreateOptions = {\n  name: string\n  /**\n   * If _true_, only leaf nodes have values. This avoids repetition (important\n   * when comparing trees), with semantics being in the tree itself.\n   * \n   * When _false_ (default) values get decomposed down the tree. This\n   * makes it easy to get all the data for a branch of the tree.\n   * \n   * \n   * Eg if storing { person: { address { state: `qld` } } }\n   * When _true_, the tree would be:\n   * ```\n   * person, value: undefined\n   *  + address, value: undefined\n   *    + state, value: 'qld'\n   * ```\n   * But when _false_, the tree would be:\n   * ```\n   * person, value: { address: { state: `qld } }\n   *  + address, value: { state: `qld` }\n   *    + state, value: `qld`\n   * ```\n   */\n  valuesAtLeaves: boolean\n}\n/**\n * Reads all fields and sub-fields of `node`, returning as a basic tree structure.\n * The structure is a snapshot of the object. If the object changes afterwards, the tree will\n * remain the same.\n * \n * Alternatively, consider {@link asDynamicTraversable} which reads the object dynamically.\n * @param node \n * @param options \n * @returns \n */\nexport const create = <T extends object>(node: T, options: Partial<CreateOptions> = {}): TreeNode<EntryStatic> => {\n  const valuesAtLeaves = options.valuesAtLeaves ?? false;\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n  const valueFor = valuesAtLeaves ? (v: any) => { if (isPrimitive(v)) return v; } : (v: any) => v;\n  return createImpl(node, valueFor(node), options, []);\n}\n\nconst createImpl = <T extends object>(sourceValue: T, nodeValue: T, options: Partial<CreateOptions> = {}, ancestors: Array<string>): TreeNode<EntryStatic> => {\n  const defaultName = options.name ?? `object_ci`;\n  //onsole.log(`createImpl name: ${ defaultName } nodeValue: ${ JSON.stringify(nodeValue) }`);\n  const r = TreeArrayBacked.root<EntryStatic>({ name: defaultName, value: nodeValue, ancestors: [ ...ancestors ] });\n  ancestors = [ ...ancestors, defaultName ];\n  for (const c of children(sourceValue, options)) {\n    const v = options.valuesAtLeaves ? c.nodeValue : c.sourceValue;\n    TreeArrayBacked.add(createImpl(c.sourceValue, v, { ...options, name: c.name }, ancestors), r);\n  }\n  return r;\n}\n\n/**\n * Returns a copy of `node` with its (and all its children's) parent information removed.\n * @param node \n * @param options \n * @returns \n */\nexport const createSimplified = <T extends object>(node: T, options: Partial<CreateOptions> = {}): SimplifiedNode<EntryStatic> => {\n  return TreeArrayBacked.stripParentage(create(node, options));\n}\n\n/**\n * Generates a name for a node.\n * Uses the 'name' property if it exists, otherwise uses `defaultName`\n * @param node\n * @param defaultName\n * @returns\n */\nfunction getNamedEntry<T extends object>(node: T, defaultName = ``): Entry {\n  if (`name` in node && `nodeValue` in node && `sourceValue` in node) return node as Entry;\n  if (`name` in node) {\n    return { name: node.name as string, nodeValue: node, sourceValue: node };\n  }\n  return { name: defaultName, nodeValue: node, sourceValue: node };\n}\n\n// /**\n//  * Depth-first traversal over object, array, Map or TreeNode\n//  * @param root\n//  * @returns\n//  */\n// export function* depthFirst(root: object): IterableIterator<Entry> {\n//   if (!root) return;\n//   const stack = new StackMutable<Entry>();\n//   //eslint-disable-next-line functional/immutable-data\n//   stack.push(getEntry(root, `root`));\n//   //eslint-disable-next-line functional/no-let,functional/immutable-data\n//   let entry = stack.pop();\n//   while (entry) {\n//     yield entry;\n//     if (entry) {\n//       //eslint-disable-next-line functional/immutable-data\n//       stack.push(...directChildren(entry.value, entry.name));\n//     }\n//     if (stack.isEmpty) break;\n//     //eslint-disable-next-line functional/immutable-data\n//     entry = stack.pop();\n//   }\n// }\n\n// /**\n//  * Breadth-first traversal over object, array, Map or TreeNode\n//  * @param root\n//  * @returns\n//  */\n// export function* breadthFirst(root: object): IterableIterator<Entry> {\n//   if (!root) return;\n//   const queue = new QueueMutable<Entry>();\n//   queue.enqueue(getEntry(root, `root`));\n//   //eslint-disable-next-line functional/no-let\n//   let entry = queue.dequeue();\n//   while (entry) {\n//     yield entry;\n//     if (entry) {\n//       queue.enqueue(...directChildren(entry.value, entry.name));\n//     }\n//     if (queue.isEmpty) break;\n//     entry = queue.dequeue();\n//   }\n// }\n\n\n// export const fromUnknown = (node: object, name: string, parents: Array<TreeNode<any>> = []): TreeNode<any> => {\n//   const parentsWithUs = [ ...parents ];\n//   const enumerator = Array.isArray(node) ? enumerateArrayChildren : enumerateObjectChildren;\n\n//   const thisNode: TreeNode<any> = {\n//     getLengthChildren() {\n//       return [ ...enumerator(node, parentsWithUs, name) ].length\n//     },\n//     *children() {\n//       for (const c of enumerator(node, parentsWithUs, name)) {\n//         yield c;\n//       }\n//     },\n//     parents() {\n//       return parents.values()\n//     },\n//     name: name,\n//     value: node\n//   }\n//   parentsWithUs.push(thisNode);\n//   return thisNode;\n// }\n\n// function* enumerateObjectChildren(node: object, name: string): IterableIterator<Entry> {\n//   if (`entries` in node) {\n//     for (const entry of (node as any as Map<any, any>)) {\n//       yield fromUnknown(entry[ 1 ], entry[ 0 ], parents);\n//     }\n//   } else {\n//     for (const entry of Object.entries(node)) {\n//       yield fromUnknown(entry[ 1 ], entry[ 0 ], parents);\n//     }\n//   }\n// }\n\n// function* enumerateArrayChildren(node: object, parents: Array<TreeNode<any>>, name: string): IterableIterator<TreeNode<any>> {\n//   const nodeArray = node as Array<any>;\n\n//   // eslint-disable-next-line unicorn/no-for-loop\n//   for (let index = 0; index < nodeArray.length; index++) {\n//     yield fromUnknown(nodeArray[ index ], name + `[ ` + index.toString() + ` ]`, parents);\n//   }\n// }","import type { Primitive, PrimitiveOrObject } from \"./PrimitiveTypes.js\";\n\n/**\n * Returns _true_ if `value` is number, string, bigint or boolean.\n * Returns _false_ if `value` is an object, null, undefined\n * @param value Value to check\n * @returns _True_ if value is number, string, bigint or boolean.\n */\nexport function isPrimitive(value: any): value is Primitive {\n  if (typeof value === `number`) return true;\n  if (typeof value === `string`) return true;\n  if (typeof value === `bigint`) return true;\n  if (typeof value === `boolean`) return true;\n  return false;\n}\n\nexport function isPrimitiveOrObject(value: any): value is PrimitiveOrObject {\n  if (isPrimitive(value)) return true;\n  if (typeof value === `object`) return true;\n  return false;\n}","// -------------------------\n// Immutable\n// -------------------------\nimport type { IStackImmutable } from './IStackImmutable.js';\nimport { push, pop, isEmpty, isFull, peek } from './StackFns.js';\nimport type { StackOpts } from './Types.js';\n\nexport class StackImmutable<V> implements IStackImmutable<V> {\n  private readonly opts: StackOpts;\n  /* eslint-disable-next-line functional/prefer-readonly-type */\n  readonly data: ReadonlyArray<V>;\n\n  constructor(opts: StackOpts = {}, data: ReadonlyArray<V> = []) {\n    this.opts = opts;\n    this.data = data;\n  }\n\n  push(...toAdd: ReadonlyArray<V>): StackImmutable<V> {\n    return new StackImmutable<V>(\n      this.opts,\n      push(this.opts, this.data, ...toAdd)\n    );\n  }\n\n  pop(): IStackImmutable<V> {\n    return new StackImmutable<V>(this.opts, pop(this.opts, this.data));\n  }\n\n  forEach(fn: (v: V) => void): void {\n    this.data.forEach(fn);\n  }\n\n  forEachFromTop(fn: (v: V) => void): void {\n    [ ...this.data ].reverse().forEach(fn);\n  }\n\n  get isEmpty(): boolean {\n    return isEmpty(this.opts, this.data);\n  }\n\n  get isFull(): boolean {\n    return isFull(this.opts, this.data);\n  }\n\n  get peek(): V | undefined {\n    return peek(this.opts, this.data);\n  }\n\n  get length(): number {\n    return this.data.length;\n  }\n}\n\n/**\n * Returns a stack. Immutable. Use {@link Stacks.mutable} for a mutable alternative.\n *\n * The basic usage is `push`/`pop` to add/remove, returning the modified stack. Use the\n * property `peek` to see what's on top.\n *\n * @example Basic usage\n * ```js\n * // Create\n * let s = stack();\n * // Add one or more items\n * s = s.push(1, 2, 3, 4);\n * // See what's at the top of the stack\n * s.peek;      // 4\n *\n * // Remove from the top of the stack, returning\n * // a new stack without item\n * s = s.pop();\n * s.peek;        // 3\n * ```\n * @param options Options\n * @param startingItems List of items to add to stack. Items will be pushed 'left to right', ie array index 0 will be bottom of the stack.\n */\nexport const immutable = <V>(\n  options: StackOpts = {},\n  ...startingItems: ReadonlyArray<V>\n): IStackImmutable<V> => new StackImmutable({ ...options }, [ ...startingItems ]);\n","\n/**\n * Resolves either a string or HTML element to an element.\n * Useful when an argument is either an HTML element or query.\n *\n * ```js\n * resolveEl(`#someId`);\n * resolveEl(someElement);\n * ```\n * @param domQueryOrEl\n * @returns\n */\nexport const resolveEl = <V extends Element>(domQueryOrEl: string | V | null | undefined): V => {\n  if (typeof domQueryOrEl === `string`) {\n    const d = document.querySelector(domQueryOrEl);\n    if (d === null) {\n      const error = domQueryOrEl.startsWith(`#`) ? new Error(\n        `Query '${ domQueryOrEl }' did not match anything. Try '#id', 'div', or '.class'`\n      ) : new Error(\n        `Query '${ domQueryOrEl }' did not match anything. Did you mean '#${ domQueryOrEl }?`\n      );\n      throw error;\n    }\n    domQueryOrEl = d as V;\n  } else if (domQueryOrEl === null) {\n    throw new Error(`Param 'domQueryOrEl' is null`);\n  } else if (domQueryOrEl === undefined) {\n    throw new Error(`Param 'domQueryOrEl' is undefined`);\n  }\n  const el = domQueryOrEl;\n  return el;\n};\n\nexport type QueryOrElements = string | Array<Element> | Array<HTMLElement> | HTMLElement | Element\n\nexport const resolveEls = (selectors: QueryOrElements): Array<HTMLElement> => {\n  if (selectors === undefined) return [];\n  if (selectors === null) return [];\n  if (Array.isArray(selectors)) return selectors as Array<HTMLElement>;\n  if (typeof selectors === `string`) {\n    const elements = [ ...document.querySelectorAll(selectors) ]\n    return elements as Array<HTMLElement>\n  }\n  return [ selectors as HTMLElement ];\n}","import { guardArray } from \"./GuardArray.js\";\n\n/**\n * Combines values in pairwise fashion.\n * Throws an error if there are less than two entries.\n * \n * ```js\n * pairwise([1, 2, 3, 4, 5]);\n * Yields:\n * [[1,2],[2,3],[3,4],[4,5] ]\n * \n * pairwise([ 1, 2, 3, 4 ]);\n * Yields:\n * [1,2],[2,3],[3,4]\n * ```\n * @param values \n */\nexport function* pairwise<T>(values: Array<T>) {\n  guardArray(values, `values`);\n\n  if (values.length < 2) throw new Error(`Array needs to have at least two entries. Length: ${ values.length }`);\n\n  for (let index = 1; index < values.length; index++) {\n    yield [ values[ index - 1 ], values[ index ] ];\n  }\n}\n\n/**\n * Reduces in a pairwise fashion.\n *\n * Eg, if we have input array of [1, 2, 3, 4, 5], the\n * `reducer` fn will run with 1,2 as parameters, then 2,3, then 3,4 etc.\n * ```js\n * const values = [1, 2, 3, 4, 5]\n * reducePairwise(values, (acc, a, b) => {\n *  return acc + (b - a);\n * }, 0);\n * ```\n *\n * If input array has less than two elements, the initial value is returned.\n *\n * ```js\n * const reducer = (acc:string, a:string, b:string) => acc + `[${a}-${b}]`;\n * const result = reducePairwise(`a b c d e f g`.split(` `), reducer, `!`);\n * Yields: `![a-b][b-c][c-d][d-e][e-f][f-g]`\n * ```\n * @param array\n * @param reducer\n * @param initial\n * @returns\n */\nexport const pairwiseReduce = <V, X>(\n  array: ReadonlyArray<V>,\n  reducer: (accumulator: X, a: V, b: V) => X,\n  initial: X\n) => {\n  guardArray(array, `arr`);\n  if (array.length < 2) return initial;\n  //eslint-disable-next-line functional/no-let\n  for (let index = 0; index < array.length - 1; index++) {\n    initial = reducer(initial, array[ index ], array[ index + 1 ]);\n  }\n  return initial;\n};\n","import Color, { type Range } from 'colorjs.io';\n\nimport { defaultRandom, type RandomSource } from '../random/Types.js';\nimport { throwNumberTest } from '../util/GuardNumbers.js';\nimport { pairwise } from '../data/arrays/Pairwise.js';\nimport { scale as scaleNumber } from '../numbers/Scale.js';\nimport { clamp } from '../numbers/Clamp.js';\n\nexport type Hsl = { h: number; s: number; l: number; opacity: number, space?: `hsl` };\nexport type Rgb = { r: number; g: number; b: number; opacity: number, space?: `srgb` };\nexport type Spaces = `hsl` | `hsluv` | `rgb` | `srgb` | `lch` | `oklch` | `oklab` | `okhsl` | `p3` | `lab` | `hcl` | `cubehelix`;\n\nexport type OkLch = { l: number, c: number, h: number, opacity: number, space: `oklch` }\n\n/**\n * A representation of colour. Eg: `blue`, `rgb(255,0,0)`, `hsl(20,100%,50%)`\n */\nexport type Colourish = Color | Hsl | OkLch | Rgb | string;\n\n// export type ColourRgb = {\n//   space:`rgb`\n//   coords: Rgba\n// }\n// export type ColourHsl = {\n//   space:`hsl`;\n//   coords: Hsla;\n// }\n\n// export type Colour = ColourHsl|ColourRgb;\n\n/**\n * Options for interpolation\n */\nexport type InterpolationOpts = {\n  space: Spaces,\n  hue: `longer` | `shorter` | `increasing` | `decreasing` | `raw`\n};\n\n// export const toHsl = (colour: Colourish): Hsla => {\n//   const hsl = toHsl(colour);\n//   if (`opacity` in hsl) return hsl as Hsla;\n//   else return {\n//     ...hsl,\n//     opacity: 1\n//   }\n// }\n\n/**\n * Parses colour to `{ h, s, l }`, each field being on 0..1 scale.\n * \n * Note that some colours will return NaN for h,s or l. This is because they have\n * indeterminate hue. For example white, black and transparent. Use 'safe = true'\n * to ensure a safe colour is returned.\n * @param colour\n * @param safe When true, returned colour will not include NaN. Default: false\n * @returns\n */\nexport const toHsl = (colour: Colourish, safe = false): Hsl => {\n  if (typeof colour === `string` && colour === `transparent`) return { h: 0, s: 0, l: 0, opacity: 0, space: `hsl` };\n  const c = resolve(colour);\n  const hsl = c.hsl;\n  //console.log(hsl);\n  let hue = hsl[ 0 ];\n  if (Number.isNaN(hue) && safe) hue = 0;\n\n  let sat = hsl[ 1 ];\n  if (Number.isNaN(sat) && safe) sat = 0;\n  const parsedHsl = {\n    h: hue / 360,\n    s: sat / 100,\n    l: hsl[ 2 ] / 100,\n    opacity: 1,\n    space: `hsl`\n  } as const\n  if (c.alpha !== 1) {\n    if (`type` in (c.alpha as any)) {\n      //const alphaType = (c.alpha as any).type;\n      const alphaRaw = Number.parseFloat((c.alpha as any).raw);\n      return { ...parsedHsl, opacity: alphaRaw }\n    }\n    return { ...parsedHsl, opacity: c.alpha / 100 };\n  }\n  return parsedHsl;\n\n  // if (isHsl(colour)) return colour;\n  // const c = resolveColour(colour);\n  // // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n  // if (c === null) throw new Error(`Could not resolve colour ${ colour }`);\n\n  // if (isHsl(c)) {\n  //   if (Number.isNaN(c.h) && Number.isNaN(c.s)) {\n  //     return { h: Number.NaN, s: Number.NaN, l: c.l, opacity: c.opacity }\n  //   }\n  //   return c;\n  // }\n  // if (isRgb(c)) {\n  //   const asHsl = d3Colour.hsl(c);\n  //   if (c.opacity) return { ...asHsl, opacity: c.opacity };\n  //   return asHsl;\n  // }\n  // // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n  // throw new Error(`Could not resolve colour ${ colour }`);\n};\n\nconst hslToColorJs = (hsl: Hsl, safe: boolean): Color => {\n  let h = hsl.h === null ? (safe ? 0 : null) : hsl.h;\n  let opacity = hsl.opacity === undefined ? 1 : hsl.opacity;\n  throwNumberTest(h, `percentage`, `hsl.h`);\n  throwNumberTest(hsl.s, `percentage`, `hsl.s`);\n  throwNumberTest(hsl.l, `percentage`, `hsl.l`);\n  throwNumberTest(opacity, `percentage`, `hsl.opacity`);\n\n  const coords: [ number, number, number ] = [\n    h! * 360,\n    hsl.s * 100,\n    hsl.l * 100\n  ];\n  return new Color(`hsl`, coords, opacity);\n}\n\nconst oklchToColorJs = (oklch: OkLch) => {\n  throwNumberTest(oklch.l, `percentage`, `oklch.l`);\n  throwNumberTest(oklch.c, `percentage`, `oklch.c`);\n  throwNumberTest(oklch.h, `percentage`, `oklch.h`);\n  throwNumberTest(oklch.opacity, `percentage`, `oklch.opacity`);\n  const coords: [ number, number, number ] = [\n    oklch.l,\n    oklch.c * 0.4,\n    oklch.h * 360\n  ]\n  return new Color(`oklch`, coords, oklch.opacity);\n}\n\nconst rgbToColorJs = (rgb: Rgb): Color => {\n  const coords: [ number, number, number ] = [\n    rgb.r,\n    rgb.g,\n    rgb.b\n  ];\n  return `opacity` in rgb ?\n    new Color(`srgb`, coords, rgb.opacity) :\n    new Color(`srgb`, coords);\n}\n\n/**\n * Returns a colour in the best-possible CSS colour form.\n * The return value can be used setting colours in the canvas or DOM manipulations.\n * @param colour \n */\nexport const toString = (colour: Colourish): string => {\n  const c = resolve(colour);\n  return c.display();\n}\n\n\n/**\n * Returns a full HSL colour string (eg `hsl(20,50%,75%)`) based on a index.\n * It's useful for generating perceptually different shades as the index increments.\n *\n * ```\n * el.style.backgroundColor = goldenAgeColour(10);\n * ```\n *\n * Saturation and lightness can be specified, as numeric ranges of 0-1.\n *\n * @param saturation Saturation (0-1), defaults to 0.5\n * @param lightness Lightness (0-1), defaults to 0.75\n * @param alpha Opacity (0-1), defaults to 1.0\n * @returns HSL colour string eg `hsl(20,50%,75%)`\n */\nexport const goldenAngleColour = (\n  index: number,\n  saturation = 0.5,\n  lightness = 0.75,\n  alpha = 1\n) => {\n  throwNumberTest(index, `positive`, `index`);\n  throwNumberTest(saturation, `percentage`, `saturation`);\n  throwNumberTest(lightness, `percentage`, `lightness`);\n  throwNumberTest(alpha, `percentage`, `alpha`);\n\n  // Via Stackoverflow\n  const hue = index * 137.508; // use golden angle approximation\n  return alpha === 1 ? `hsl(${ hue },${ saturation * 100 }%,${ lightness * 100 }%)` : `hsl(${ hue },${ saturation * 100 }%,${ lightness * 100 }%,${ alpha * 100 }%)`;\n};\n\n/**\n * Returns a random hue component (0..359)\n * ```\n * // Generate hue\n * const h =randomHue(); // 0-359\n *\n * // Generate hue and assign as part of a HSL string\n * el.style.backgroundColor = `hsl(${randomHue(), 50%, 75%})`;\n * ```\n * @param rand\n * @returns\n */\nexport const randomHue = (rand: RandomSource = defaultRandom): number => {\n  const r = rand();\n  return r * 360;\n};\n\n/**\n * Returns a Colorjs 'Color' object based on relative hue, saturation, lightness\n * and opacity.\n * @param h Hue (0..1)\n * @param s Saturation (0..1) Default: 1\n * @param l Lightness (0..1) Default: 0.5\n * @param opacity Opacity (0..1) Default: 1\n * @returns \n */\nexport const fromHsl = (h: number, s = 1, l = 0.5, opacity = 1): Color => {\n  throwNumberTest(h, `percentage`, `h`);\n  throwNumberTest(s, `percentage`, `s`);\n  throwNumberTest(l, `percentage`, `l`);\n\n  return resolve({ h, s, l, opacity, space: `hsl` });\n}\n\n/**\n * Parses colour to `{ r, g, b }` where each field is on 0..1 scale.\n * `opacity` field is added if opacity is not 1.\n * [Named colours](https://html-color-codes.info/color-names/)\n * @param colour\n * @returns\n */\nexport const toRgb = (colour: Colourish): Rgb => {\n  const c = resolve(colour);\n  const rgb = c.srgb;\n  return c.alpha < 1 ?\n    { r: rgb.r, g: rgb.g, b: rgb.b, opacity: c.alpha, space: `srgb` } :\n    { r: rgb.r, g: rgb.g, b: rgb.b, opacity: 1, space: `srgb` };\n};\n\n/**\n * Parses a string representation of colour, or a Rgb/Hsl object.\n * If the string starts with '--' it's assumed to be a CSS variable\n * \n * See also {@link resolveToString} to resolve to a CSS colour string.\n * @param colour Colour to resolve\n * @returns Color.js Color object\n */\nexport const resolve = (colour: Colourish, safe: boolean = false): Color => {\n  if (typeof colour === `string`) {\n    if (colour.startsWith(`--`)) {\n      // Resolve CSS variable\n      colour = getComputedStyle(document.body).getPropertyValue(colour);\n    }\n    return new Color(colour);\n  } else {\n    if (isHsl(colour)) return new Color(hslToColorJs(colour, safe));\n    if (isRgb(colour)) return new Color(rgbToColorJs(colour));\n    if (isOklch(colour)) return new Color(oklchToColorJs(colour));\n  }\n\n  return colour;\n};\n\n/**\n * Like {@link resolve}, but returns a CSS-ready string\n * representation.\n * ```js\n * element.style.backgroundColor = resolveToString(`red`);\n * ```\n * \n * Tries each parameter in turn, returning the value\n * for the first that resolves. This can be useful for\n * having fallback values.\n * \n * ```js\n * // Try a CSS variable, a object property or finally fallback to red.\n * element.style.backgroundColor = resolveToString('--some-var', opts.background, `red`);\n * ```\n * @param colours Array of colours to resolve\n * @returns \n */\nexport const resolveToString = (...colours: Array<Colourish | undefined>): string => {\n  for (const colour of colours) {\n    if (colour === undefined) continue;\n    if (colour === null) continue;\n    const c = resolve(colour);\n    try {\n      return c.display();\n    } catch (ex) {\n      if (typeof colour === `string`) return colour\n      throw ex;\n    }\n  }\n  return `rebeccapurple`;\n}\n\n/**\n * Returns a colour in hex format `#000000`. \n * ```js\n * canvas.fillStyle = Colour.toHex(`blue`);\n * canvas.fillStyle = Colour.toHex({ h:0.5, s:0.1, l:1 });\n * canvas.fillStyle = Colour.toHex({ r: 1, g: 0.3, b: 0 });\n * ```\n * \n * Input colour can be a human-friendly colour name (\"blue\"), a HSL\n * colour (eg. \"hsl(0, 50%, 50%)\")\", an object {h,s,l} or {r,g,b}.\n * '#' is included in the return string.\n * \n * Transparent colour is returned as #00000000\n * @param colour\n * @returns Hex format, including #\n */\nexport const toHex = (colour: Colourish, safe = false): string => {\n  if (typeof colour === `string` && colour === `transparent`) return `#00000000`;\n  return resolve(colour, safe).to(`srgb`).toString({ format: `hex`, collapse: false });\n};\n\n/**\n * Returns a variation of colour with its opacity multiplied by `amt`.\n *\n * ```js\n * // Return a colour string for blue that is 50% opaque\n * opacity(`blue`, 0.5);\n * // eg: `rgba(0,0,255,0.5)`\n *\n * // Returns a colour string that is 50% more opaque\n * opacity(`hsla(200,100%,50%,50%`, 0.5);\n * // eg: `hsla(200,100%,50%,25%)`\n * ```\n *\n * [Named colours](https://html-color-codes.info/color-names/)\n * @param colour A valid CSS colour\n * @param amt Amount to multiply opacity by\n * @returns String representation of colour\n */\nexport const opacity = (colour: Colourish, amt: number): string => {\n  const c = resolve(colour);\n  c.alpha *= amt;\n  return c.toString();\n};\n\n/**\n * Gets a CSS variable.\n * ```\n * // Fetch --accent variable, or use `yellow` if not found.\n * getCssVariable(`accent`, `yellow`);\n * ```\n * @param name Name of variable. Leading '--' is unnecessary\n * @param fallbackColour Fallback colour if not found\n * @param root  Element to search variable from\n * @returns Colour or fallback.\n */\nexport const getCssVariable = (\n  name: string,\n  fallbackColour = `black`,\n  root?: HTMLElement\n): string => {\n  if (root === undefined) root = document.body;\n  if (name.startsWith(`--`)) name = name.substring(2);\n  const fromCss = getComputedStyle(root).getPropertyValue(`--${ name }`).trim();\n  if (fromCss === undefined || fromCss.length === 0) return fallbackColour;\n  return fromCss;\n};\n\n\n// export const interpolate = (\n//   amount: number,\n//   from: Colourish,\n//   to: Colourish,\n//   optsOrSpace?: string | InterpolationOpts\n// ): string => {\n//   throwNumberTest(amount, `percentage`, `amount`);\n//   if (typeof from !== `string`)\n//     throw new Error(`Expected string for 'from' param`);\n//   if (typeof to !== `string`) throw new Error(`Expected string for 'to' param`);\n\n//   let opts: InterpolationOpts;\n//   if (typeof optsOrSpace === `undefined`) opts = {};\n//   else if (typeof optsOrSpace === `string`)\n//     opts = { space: optsOrSpace as Spaces };\n//   else opts = optsOrSpace;\n\n//   const inter = getInterpolator(opts, [ from, to ]);\n//   if (inter === undefined) throw new Error(`Could not handle colour/space`);\n//   return inter(amount);\n// };\n\n\n/**\n * Returns a function to interpolate between colours\n * ```js\n * import { Colour } from 'https://unpkg.com/ixfx/dist/visual.js'\n * const i = interpolator([`orange`, `yellow`, `red`]);\n * \n * // Get a random colour on the above spectrum\n * i(Math.random());\n * ```\n * \n * Results will vary depending on the colour space used, play with the options.\n * When using a hue-based colour space, the `hue` option sets the logic for how hue values wrap.\n * \n * ```js\n * interpolator([`orange`, `yellow`, `red`], { space: `hsl`, hue: `longer })\n * ```\n * @param colours Colours to interpolate between\n * @param opts Options for interpolation\n * @returns \n */\nexport const interpolator = (colours: Array<Colourish>, opts: Partial<InterpolationOpts> = {}) => {\n  const space = opts.space ?? `lch`;\n  const hue = opts.hue ?? `shorter`;\n  const pieces = interpolatorInit(colours);\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-return, @typescript-eslint/no-unsafe-call\n  const ranges = pieces.map(piece => (piece[ 0 ] as any).range(piece[ 1 ], { space, hue })) as Array<Range>;\n\n  return (amt: number) => {\n    amt = clamp(amt);\n\n    // Scale to 0..1 to 0...ranges.length\n    const s = scaleNumber(amt, 0, 1, 0, ranges.length);\n    const index = Math.floor(s);\n    const amtAdjusted = s - index;\n    return ranges[ index ](amtAdjusted);\n  }\n}\n\nconst interpolatorInit = (colours: Array<Colourish>) => {\n  if (!Array.isArray(colours)) throw new Error(`Param 'colours' is not an array as expected. Got: ${ typeof colours }`);\n  if (colours.length < 2) throw new Error(`Param 'colours' should be at least two in length. Got: ${ colours.length }`);\n  const c = colours.map(colour => resolve(colour));\n  return [ ...pairwise(c) ];\n}\n\n/**\n * Produces a stepped scale of colours.\n * \n * Return result is an array of Color.js 'Colour' objects.\n * ```js\n * import { Colour } from 'ixfx/visual'\n * const steps = Colour.scale(['red','green'], 10);\n * for (const step of steps) {\n *  // Get a 'hsla(...)' string representation of colour\n *  // This can be used with the canvas, setting DOM properties etc.\n *  const css = Colour.toString(step);\n * }\n * ```\n * \n * {@link cssLinearGradient} can produce a smooth gradient in CSS on the basis\n * of the stepped colours.\n * @param colours \n * @param numberOfSteps \n * @param opts \n * @returns \n */\nexport const scale = (colours: Array<Colourish>, numberOfSteps: number, opts: Partial<InterpolationOpts> = {}) => {\n  const space = opts.space ?? `lch`;\n  const hue = opts.hue ?? `shorter`;\n  const pieces = interpolatorInit(colours);\n  const stepsPerPair = Math.floor(numberOfSteps / pieces.length);\n\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-return, @typescript-eslint/no-unsafe-call\n  const steps = pieces.map(piece => (piece[ 0 ] as any).steps(piece[ 1 ],\n    { space, hue, steps: stepsPerPair, outputSpace: `srgb` }\n  )) as Array<Color>;\n\n  return steps.flat();\n}\n\n/**\n * Returns a CSS `linear-gradient` with stops corresponding to the given list of `colours`.\n * ```js\n * element.style.background = Colour.cssLinearGradient(['red','green','blue']);\n * ```\n * \n *\n * @param colours \n * @returns \n */\nexport const cssLinearGradient = (colours: Array<Colourish>) => {\n  const c = colours.map(c => resolve(c));\n  return `linear-gradient(to right, ${ c.map(v => v.display()).join(`, `) })`;\n}\n\nconst isHsl = (p: Colourish): p is Hsl => {\n  if (p === undefined || p === null) return false;\n  if (typeof p !== `object`) return false;\n\n  // Check if Colourjs\n  if ((p as Color).spaceId !== undefined) return false;\n  if ((p as Color).coords !== undefined) return false;\n\n  const space = p.space;\n  if (space !== `hsl` && space !== undefined) return false;\n  const pp = p as Hsl;\n  if (pp.h === undefined) return false;\n  if (pp.s === undefined) return false;\n  if (pp.l === undefined) return false;\n  return true;\n};\n\nconst isOklch = (p: Colourish): p is OkLch => {\n  if (p === undefined || p === null) return false;\n  if (typeof p !== `object`) return false;\n\n  // Check if Colourjs\n  if ((p as Color).spaceId !== undefined) return false;\n  if ((p as Color).coords !== undefined) return false;\n  if (p.space !== `oklch`) return false;\n  if (p.l === undefined) return false;\n  if (p.c === undefined) return false;\n  if (p.h === undefined) return false;\n  return true;\n}\n\nconst isRgb = (p: Colourish): p is Rgb => {\n  if (p === undefined || p === null) return false;\n  if (typeof p !== `object`) return false;\n  if (p.space !== `srgb` && p.space !== undefined) return false;\n  if ((p as Rgb).r === undefined) return false;\n  if ((p as Rgb).g === undefined) return false;\n  if ((p as Rgb).b === undefined) return false;\n  return true;\n};\n","// A is m x n. B is n x p. product is m x p.\nexport default function multiplyMatrices (A, B) {\n\tlet m = A.length;\n\n\tif (!Array.isArray(A[0])) {\n\t\t// A is vector, convert to [[a, b, c, ...]]\n\t\tA = [A];\n\t}\n\n\tif (!Array.isArray(B[0])) {\n\t\t// B is vector, convert to [[a], [b], [c], ...]]\n\t\tB = B.map(x => [x]);\n\t}\n\n\tlet p = B[0].length;\n\tlet B_cols = B[0].map((_, i) => B.map(x => x[i])); // transpose B\n\tlet product = A.map(row => B_cols.map(col => {\n\t\tlet ret = 0;\n\n\t\tif (!Array.isArray(row)) {\n\t\t\tfor (let c of col) {\n\t\t\t\tret += row * c;\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t}\n\n\t\tfor (let i = 0; i < row.length; i++) {\n\t\t\tret += row[i] * (col[i] || 0);\n\t\t}\n\n\t\treturn ret;\n\t}));\n\n\tif (m === 1) {\n\t\tproduct = product[0]; // Avoid [[a, b, c, ...]]\n\t}\n\n\tif (p === 1) {\n\t\treturn product.map(x => x[0]); // Avoid [[a], [b], [c], ...]]\n\t}\n\n\treturn product;\n}\n","/**\n * Various utility functions\n */\n\nexport {default as multiplyMatrices} from \"./multiply-matrices.js\";\n\n/**\n * Check if a value is a string (including a String object)\n * @param {*} str - Value to check\n * @returns {boolean}\n */\nexport function isString (str) {\n\treturn type(str) === \"string\";\n}\n\n/**\n * Determine the internal JavaScript [[Class]] of an object.\n * @param {*} o - Value to check\n * @returns {string}\n */\nexport function type (o) {\n\tlet str = Object.prototype.toString.call(o);\n\n\treturn (str.match(/^\\[object\\s+(.*?)\\]$/)[1] || \"\").toLowerCase();\n}\n\nexport function serializeNumber (n, {precision, unit }) {\n\tif (isNone(n)) {\n\t\treturn \"none\";\n\t}\n\n\treturn toPrecision(n, precision) + (unit ?? \"\");\n}\n\n/**\n * Check if a value corresponds to a none argument\n * @param {*} n - Value to check\n * @returns {boolean}\n */\nexport function isNone (n) {\n\treturn Number.isNaN(n) || (n instanceof Number && n?.none);\n}\n\n/**\n * Replace none values with 0\n */\nexport function skipNone (n) {\n\treturn isNone(n) ? 0 : n;\n}\n\n/**\n * Round a number to a certain number of significant digits\n * @param {number} n - The number to round\n * @param {number} precision - Number of significant digits\n */\nexport function toPrecision (n, precision) {\n\tif (n === 0) {\n\t\treturn 0;\n\t}\n\tlet integer = ~~n;\n\tlet digits = 0;\n\tif (integer && precision) {\n\t\tdigits = ~~Math.log10(Math.abs(integer)) + 1;\n\t}\n\tconst multiplier = 10.0 ** (precision - digits);\n\treturn Math.floor(n * multiplier + 0.5) / multiplier;\n}\n\nconst angleFactor = {\n\tdeg: 1,\n\tgrad: 0.9,\n\trad: 180 / Math.PI,\n\tturn: 360,\n};\n\n/**\n* Parse a CSS function, regardless of its name and arguments\n* @param String str String to parse\n* @return {{name, args, rawArgs}}\n*/\nexport function parseFunction (str) {\n\tif (!str) {\n\t\treturn;\n\t}\n\n\tstr = str.trim();\n\n\tconst isFunctionRegex = /^([a-z]+)\\((.+?)\\)$/i;\n\tconst isNumberRegex = /^-?[\\d.]+$/;\n\tconst unitValueRegex = /%|deg|g?rad|turn$/;\n\tconst singleArgument = /\\/?\\s*(none|[-\\w.]+(?:%|deg|g?rad|turn)?)/g;\n\tlet parts = str.match(isFunctionRegex);\n\n\tif (parts) {\n\t\t// It is a function, parse args\n\t\tlet args = [];\n\t\tparts[2].replace(singleArgument, ($0, rawArg) => {\n\t\t\tlet match = rawArg.match(unitValueRegex);\n\t\t\tlet arg = rawArg;\n\n\t\t\tif (match) {\n\t\t\t\tlet unit = match[0];\n\t\t\t\t// Drop unit from value\n\t\t\t\tlet unitlessArg = arg.slice(0, -unit.length);\n\n\t\t\t\tif (unit === \"%\") {\n\t\t\t\t\t// Convert percentages to 0-1 numbers\n\t\t\t\t\targ = new Number(unitlessArg / 100);\n\t\t\t\t\targ.type = \"<percentage>\";\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// Multiply angle by appropriate factor for its unit\n\t\t\t\t\targ = new Number(unitlessArg * angleFactor[unit]);\n\t\t\t\t\targ.type = \"<angle>\";\n\t\t\t\t\targ.unit = unit;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (isNumberRegex.test(arg)) {\n\t\t\t\t// Convert numerical args to numbers\n\t\t\t\targ = new Number(arg);\n\t\t\t\targ.type = \"<number>\";\n\t\t\t}\n\t\t\telse if (arg === \"none\") {\n\t\t\t\targ = new Number(NaN);\n\t\t\t\targ.none = true;\n\t\t\t}\n\n\t\t\tif ($0.startsWith(\"/\")) {\n\t\t\t\t// It's alpha\n\t\t\t\targ = arg instanceof Number ? arg : new Number(arg);\n\t\t\t\targ.alpha = true;\n\t\t\t}\n\n\t\t\tif (typeof arg === \"object\" && arg instanceof Number) {\n\t\t\t\targ.raw = rawArg;\n\t\t\t}\n\n\t\t\targs.push(arg);\n\t\t});\n\n\t\treturn {\n\t\t\tname: parts[1].toLowerCase(),\n\t\t\trawName: parts[1],\n\t\t\trawArgs: parts[2],\n\t\t\t// An argument could be (as of css-color-4):\n\t\t\t// a number, percentage, degrees (hue), ident (in color())\n\t\t\targs,\n\t\t};\n\t}\n}\n\nexport function last (arr) {\n\treturn arr[arr.length - 1];\n}\n\nexport function interpolate (start, end, p) {\n\tif (isNaN(start)) {\n\t\treturn end;\n\t}\n\n\tif (isNaN(end)) {\n\t\treturn start;\n\t}\n\n\treturn start + (end - start) * p;\n}\n\nexport function interpolateInv (start, end, value) {\n\treturn (value - start) / (end - start);\n}\n\nexport function mapRange (from, to, value) {\n\treturn interpolate(to[0], to[1], interpolateInv(from[0], from[1], value));\n}\n\nexport function parseCoordGrammar (coordGrammars) {\n\treturn coordGrammars.map(coordGrammar => {\n\t\treturn coordGrammar.split(\"|\").map(type => {\n\t\t\ttype = type.trim();\n\t\t\tlet range = type.match(/^(<[a-z]+>)\\[(-?[.\\d]+),\\s*(-?[.\\d]+)\\]?$/);\n\n\t\t\tif (range) {\n\t\t\t\tlet ret = new String(range[1]);\n\t\t\t\tret.range = [+range[2], +range[3]];\n\t\t\t\treturn ret;\n\t\t\t}\n\n\t\t\treturn type;\n\t\t});\n\t});\n}\n\n/**\n * Clamp value between the minimum and maximum\n * @param {number} min minimum value to return\n * @param {number} val the value to return if it is between min and max\n * @param {number} max maximum value to return\n * @returns number\n */\nexport function clamp (min, val, max) {\n\treturn Math.max(Math.min(max, val), min);\n}\n\n/**\n * Copy sign of one value to another.\n * @param {number} - to number to copy sign to\n * @param {number} - from number to copy sign from\n * @returns number\n */\nexport function copySign (to, from) {\n\treturn Math.sign(to) === Math.sign(from) ? to : -to;\n}\n\n/**\n * Perform pow on a signed number and copy sign to result\n * @param {number} - base the base number\n * @param {number} - exp the exponent\n * @returns number\n */\nexport function spow (base, exp) {\n\treturn copySign(Math.abs(base) ** exp, base);\n}\n\n/**\n * Perform a divide, but return zero if the numerator is zero\n * @param {number} n - the numerator\n * @param {number} d - the denominator\n * @returns number\n */\nexport function zdiv (n, d) {\n\treturn (d === 0) ? 0 : n / d;\n}\n\n/**\n * Perform a bisect on a sorted list and locate the insertion point for\n * a value in arr to maintain sorted order.\n * @param {number[]} arr - array of sorted numbers\n * @param {number} value - value to find insertion point for\n * @param {number} lo - used to specify a the low end of a subset of the list\n * @param {number} hi - used to specify a the high end of a subset of the list\n * @returns number\n */\nexport function bisectLeft (arr, value, lo = 0, hi = arr.length) {\n\twhile (lo < hi) {\n\t\tconst mid = (lo + hi) >> 1;\n\t\tif (arr[mid] < value) {\n\t\t\tlo = mid + 1;\n\t\t}\n\t\telse {\n\t\t\thi = mid;\n\t\t}\n\t}\n\treturn lo;\n}\n","/**\n * A class for adding deep extensibility to any piece of JS code\n */\nexport class Hooks {\n\tadd (name, callback, first) {\n\t\tif (typeof arguments[0] != \"string\") {\n\t\t\t// Multiple hooks\n\t\t\tfor (var name in arguments[0]) {\n\t\t\t\tthis.add(name, arguments[0][name], arguments[1]);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\t(Array.isArray(name) ? name : [name]).forEach(function (name) {\n\t\t\tthis[name] = this[name] || [];\n\n\t\t\tif (callback) {\n\t\t\t\tthis[name][first ? \"unshift\" : \"push\"](callback);\n\t\t\t}\n\t\t}, this);\n\t}\n\n\trun (name, env) {\n\t\tthis[name] = this[name] || [];\n\t\tthis[name].forEach(function (callback) {\n\t\t\tcallback.call(env && env.context ? env.context : env, env);\n\t\t});\n\t}\n}\n\n/**\n * The instance of {@link Hooks} used throughout Color.js\n */\nconst hooks = new Hooks();\n\nexport default hooks;\n","// Global defaults one may want to configure\nexport default {\n\tgamut_mapping: \"css\",\n\tprecision: 5,\n\tdeltaE: \"76\", // Default deltaE method\n\tverbose: globalThis?.process?.env?.NODE_ENV?.toLowerCase() !== \"test\",\n\twarn: function warn (msg) {\n\t\tif (this.verbose) {\n\t\t\tglobalThis?.console?.warn?.(msg);\n\t\t}\n\t},\n};\n","import hooks from \"./hooks.js\";\nimport {multiplyMatrices} from \"./util.js\";\n\nexport const WHITES = {\n\t// for compatibility, the four-digit chromaticity-derived ones everyone else uses\n\tD50: [0.3457 / 0.3585, 1.00000, (1.0 - 0.3457 - 0.3585) / 0.3585],\n\tD65: [0.3127 / 0.3290, 1.00000, (1.0 - 0.3127 - 0.3290) / 0.3290],\n};\n\nexport function getWhite (name) {\n\tif (Array.isArray(name)) {\n\t\treturn name;\n\t}\n\n\treturn WHITES[name];\n}\n\n// Adapt XYZ from white point W1 to W2\nexport default function adapt (W1, W2, XYZ, options = {}) {\n\tW1 = getWhite(W1);\n\tW2 = getWhite(W2);\n\n\tif (!W1 || !W2) {\n\t\tthrow new TypeError(`Missing white point to convert ${!W1 ? \"from\" : \"\"}${!W1 && !W2 ? \"/\" : \"\"}${!W2 ? \"to\" : \"\"}`);\n\t}\n\n\tif (W1 === W2) {\n\t\t// Same whitepoints, no conversion needed\n\t\treturn XYZ;\n\t}\n\n\tlet env = {W1, W2, XYZ, options};\n\n\thooks.run(\"chromatic-adaptation-start\", env);\n\n\tif (!env.M) {\n\t\tif (env.W1 === WHITES.D65 && env.W2 === WHITES.D50) {\n\t\t\tenv.M = [\n\t\t\t\t[ 1.0479297925449969, 0.022946870601609652, -0.05019226628920524 ],\n\t\t\t\t[ 0.02962780877005599, 0.9904344267538799, -0.017073799063418826 ],\n\t\t\t\t[ -0.009243040646204504, 0.015055191490298152, 0.7518742814281371 ],\n\t\t\t];\n\t\t}\n\t\telse if (env.W1 === WHITES.D50 && env.W2 === WHITES.D65) {\n\n\t\t\tenv.M = [\n\t\t\t\t[ 0.955473421488075, -0.02309845494876471, 0.06325924320057072 ],\n\t\t\t\t[ -0.0283697093338637, 1.0099953980813041, 0.021041441191917323 ],\n\t\t\t\t[ 0.012314014864481998, -0.020507649298898964, 1.330365926242124 ],\n\t\t\t];\n\t\t}\n\t}\n\n\thooks.run(\"chromatic-adaptation-end\", env);\n\n\tif (env.M) {\n\t\treturn multiplyMatrices(env.M, env.XYZ);\n\t}\n\telse {\n\t\tthrow new TypeError(\"Only Bradford CAT with white points D50 and D65 supported for now.\");\n\t}\n}\n","import * as util from \"./util.js\";\nimport hooks from \"./hooks.js\";\nimport ColorSpace from \"./space.js\";\nimport defaults from \"./defaults.js\";\n\nconst noneTypes = new Set([\"<number>\", \"<percentage>\", \"<angle>\"]);\n\n/**\n * Validates the coordinates of a color against a format's coord grammar and\n * maps the coordinates to the range or refRange of the coordinates.\n * @param {ColorSpace} space - Colorspace the coords are in\n * @param {object} format - the format object to validate against\n * @param {string} name - the name of the color function. e.g. \"oklab\" or \"color\"\n * @returns {object[]} - an array of type metadata for each coordinate\n */\nfunction coerceCoords (space, format, name, coords) {\n\tlet types = Object.entries(space.coords).map(([id, coordMeta], i) => {\n\t\tlet coordGrammar = format.coordGrammar[i];\n\t\tlet arg = coords[i];\n\t\tlet providedType = arg?.type;\n\n\t\t// Find grammar alternative that matches the provided type\n\t\t// Non-strict equals is intentional because we are comparing w/ string objects\n\t\tlet type;\n\t\tif (arg.none) {\n\t\t\ttype = coordGrammar.find(c => noneTypes.has(c));\n\t\t}\n\t\telse {\n\t\t\ttype = coordGrammar.find(c => c == providedType);\n\t\t}\n\n\t\t// Check that each coord conforms to its grammar\n\t\tif (!type) {\n\t\t\t// Type does not exist in the grammar, throw\n\t\t\tlet coordName = coordMeta.name || id;\n\t\t\tthrow new TypeError(`${providedType ?? arg.raw} not allowed for ${coordName} in ${name}()`);\n\t\t}\n\n\t\tlet fromRange = type.range;\n\n\t\tif (providedType === \"<percentage>\") {\n\t\t\tfromRange ||= [0, 1];\n\t\t}\n\n\t\tlet toRange = coordMeta.range || coordMeta.refRange;\n\n\t\tif (fromRange && toRange) {\n\t\t\tcoords[i] = util.mapRange(fromRange, toRange, coords[i]);\n\t\t}\n\n\t\treturn type;\n\t});\n\n\treturn types;\n}\n\n\n/**\n * Convert a CSS Color string to a color object\n * @param {string} str\n * @param {object} [options]\n * @param {object} [options.meta] - Object for additional information about the parsing\n * @returns {Color}\n */\nexport default function parse (str, {meta} = {}) {\n\tlet env = {\"str\": String(str)?.trim()};\n\thooks.run(\"parse-start\", env);\n\n\tif (env.color) {\n\t\treturn env.color;\n\t}\n\n\tenv.parsed = util.parseFunction(env.str);\n\n\tif (env.parsed) {\n\t\t// Is a functional syntax\n\t\tlet name = env.parsed.name;\n\n\t\tif (name === \"color\") {\n\t\t\t// color() function\n\t\t\tlet id = env.parsed.args.shift();\n\t\t\t// Check against both <dashed-ident> and <ident> versions\n\t\t\tlet alternateId = id.startsWith(\"--\") ? id.substring(2) : `--${id}`;\n\t\t\tlet ids = [id, alternateId];\n\t\t\tlet alpha = env.parsed.rawArgs.indexOf(\"/\") > 0 ? env.parsed.args.pop() : 1;\n\n\t\t\tfor (let space of ColorSpace.all) {\n\t\t\t\tlet colorSpec = space.getFormat(\"color\");\n\n\t\t\t\tif (colorSpec) {\n\t\t\t\t\tif (ids.includes(colorSpec.id) || colorSpec.ids?.filter((specId) => ids.includes(specId)).length) {\n\t\t\t\t\t\t// From https://drafts.csswg.org/css-color-4/#color-function\n\t\t\t\t\t\t// If more <number>s or <percentage>s are provided than parameters that the colorspace takes, the excess <number>s at the end are ignored.\n\t\t\t\t\t\t// If less <number>s or <percentage>s are provided than parameters that the colorspace takes, the missing parameters default to 0. (This is particularly convenient for multichannel printers where the additional inks are spot colors or varnishes that most colors on the page won’t use.)\n\t\t\t\t\t\tconst coords = Object.keys(space.coords).map((_, i) => env.parsed.args[i] || 0);\n\n\t\t\t\t\t\tlet types;\n\n\t\t\t\t\t\tif (colorSpec.coordGrammar) {\n\t\t\t\t\t\t\ttypes = coerceCoords(space, colorSpec, \"color\", coords);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (meta) {\n\t\t\t\t\t\t\tObject.assign(meta, {formatId: \"color\", types});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (colorSpec.id.startsWith(\"--\") && !id.startsWith(\"--\")) {\n\t\t\t\t\t\t\tdefaults.warn(`${space.name} is a non-standard space and not currently supported in the CSS spec. ` +\n\t\t\t\t\t\t\t              `Use prefixed color(${colorSpec.id}) instead of color(${id}).`);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (id.startsWith(\"--\") && !colorSpec.id.startsWith(\"--\")) {\n\t\t\t\t\t\t\tdefaults.warn(`${space.name} is a standard space and supported in the CSS spec. ` +\n\t\t\t\t\t\t\t              `Use color(${colorSpec.id}) instead of prefixed color(${id}).`);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn {spaceId: space.id, coords, alpha};\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Not found\n\t\t\tlet didYouMean = \"\";\n\t\t\tlet registryId = id in ColorSpace.registry ? id : alternateId;\n\t\t\tif (registryId in ColorSpace.registry) {\n\t\t\t\t// Used color space id instead of color() id, these are often different\n\t\t\t\tlet cssId = ColorSpace.registry[registryId].formats?.color?.id;\n\n\t\t\t\tif (cssId) {\n\t\t\t\t\tdidYouMean = `Did you mean color(${cssId})?`;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthrow new TypeError(`Cannot parse color(${id}). ` + (didYouMean || \"Missing a plugin?\"));\n\t\t}\n\t\telse {\n\t\t\tfor (let space of ColorSpace.all) {\n\t\t\t\t// color space specific function\n\t\t\t\tlet format = space.getFormat(name);\n\t\t\t\tif (format && format.type === \"function\") {\n\t\t\t\t\tlet alpha = 1;\n\n\t\t\t\t\tif (format.lastAlpha || util.last(env.parsed.args).alpha) {\n\t\t\t\t\t\talpha = env.parsed.args.pop();\n\t\t\t\t\t}\n\n\t\t\t\t\tlet coords = env.parsed.args;\n\n\t\t\t\t\tlet types;\n\n\t\t\t\t\tif (format.coordGrammar) {\n\t\t\t\t\t\ttypes = coerceCoords(space, format, name, coords);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (meta) {\n\t\t\t\t\t\tObject.assign(meta, {formatId: format.name, types});\n\t\t\t\t\t}\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tspaceId: space.id,\n\t\t\t\t\t\tcoords, alpha,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\telse {\n\t\t// Custom, colorspace-specific format\n\t\tfor (let space of ColorSpace.all) {\n\t\t\tfor (let formatId in space.formats) {\n\t\t\t\tlet format = space.formats[formatId];\n\n\t\t\t\tif (format.type !== \"custom\") {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (format.test && !format.test(env.str)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tlet color = format.parse(env.str);\n\n\t\t\t\tif (color) {\n\t\t\t\t\tcolor.alpha ??= 1;\n\n\t\t\t\t\tif (meta) {\n\t\t\t\t\t\tmeta.formatId = formatId;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn color;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\n\t// If we're here, we couldn't parse\n\tthrow new TypeError(`Could not parse ${str} as a color. Missing a plugin?`);\n}\n","import ColorSpace from \"./space.js\";\nimport {isString} from \"./util.js\";\nimport parse from \"./parse.js\";\n\n/**\n * Resolves a color reference (object or string) to a plain color object\n * @param {Color | {space, coords, alpha} | string | Array<Color | {space, coords, alpha} | string> } color\n * @returns {{space, coords, alpha} | Array<{space, coords, alpha}}>\n */\nexport default function getColor (color) {\n\tif (Array.isArray(color)) {\n\t\treturn color.map(getColor);\n\t}\n\n\tif (!color) {\n\t\tthrow new TypeError(\"Empty color reference\");\n\t}\n\n\tif (isString(color)) {\n\t\tcolor = parse(color);\n\t}\n\n\t// Object fixup\n\tlet space = color.space || color.spaceId;\n\n\tif (!(space instanceof ColorSpace)) {\n\t\t// Convert string id to color space object\n\t\tcolor.space = ColorSpace.get(space);\n\t}\n\n\tif (color.alpha === undefined) {\n\t\tcolor.alpha = 1;\n\t}\n\n\treturn color;\n}\n","import {type, parseCoordGrammar, serializeNumber, mapRange} from \"./util.js\";\nimport {getWhite} from \"./adapt.js\";\nimport hooks from \"./hooks.js\";\nimport getColor from \"./getColor.js\";\n\nconst ε = .000075;\n\n/**\n * Class to represent a color space\n */\nexport default class ColorSpace {\n\tconstructor (options) {\n\t\tthis.id = options.id;\n\t\tthis.name = options.name;\n\t\tthis.base = options.base ? ColorSpace.get(options.base) : null;\n\t\tthis.aliases = options.aliases;\n\n\t\tif (this.base) {\n\t\t\tthis.fromBase = options.fromBase;\n\t\t\tthis.toBase = options.toBase;\n\t\t}\n\n\t\t// Coordinate metadata\n\n\t\tlet coords = options.coords ?? this.base.coords;\n\n\t\tfor (let name in coords) {\n\t\t\tif (!(\"name\" in coords[name])) {\n\t\t\t\tcoords[name].name = name;\n\t\t\t}\n\t\t}\n\t\tthis.coords = coords;\n\n\t\t// White point\n\n\t\tlet white = options.white ?? this.base.white ?? \"D65\";\n\t\tthis.white = getWhite(white);\n\n\t\t// Sort out formats\n\n\t\tthis.formats = options.formats ?? {};\n\n\t\tfor (let name in this.formats) {\n\t\t\tlet format = this.formats[name];\n\t\t\tformat.type ||= \"function\";\n\t\t\tformat.name ||= name;\n\t\t}\n\n\t\tif (!this.formats.color?.id) {\n\t\t\tthis.formats.color = {\n\t\t\t\t...this.formats.color ?? {},\n\t\t\t\tid: options.cssId || this.id,\n\t\t\t};\n\t\t}\n\n\t\t// Gamut space\n\n\t\tif (options.gamutSpace) {\n\t\t\t// Gamut space explicitly specified\n\t\t\tthis.gamutSpace = options.gamutSpace === \"self\" ? this : ColorSpace.get(options.gamutSpace);\n\t\t}\n\t\telse {\n\t\t\t// No gamut space specified, calculate a sensible default\n\t\t\tif (this.isPolar) {\n\t\t\t\t// Do not check gamut through polar coordinates\n\t\t\t\tthis.gamutSpace = this.base;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.gamutSpace =  this;\n\t\t\t}\n\t\t}\n\n\t\t// Optimize inGamut for unbounded spaces\n\t\tif (this.gamutSpace.isUnbounded) {\n\t\t\tthis.inGamut = (coords, options) => {\n\t\t\t\treturn true;\n\t\t\t};\n\t\t}\n\n\t\t// Other stuff\n\t\tthis.referred = options.referred;\n\n\t\t// Compute ancestors and store them, since they will never change\n\t\tObject.defineProperty(this, \"path\", {\n\t\t\tvalue: getPath(this).reverse(),\n\t\t\twritable: false,\n\t\t\tenumerable: true,\n\t\t\tconfigurable: true,\n\t\t});\n\n\t\thooks.run(\"colorspace-init-end\", this);\n\t}\n\n\tinGamut (coords, {epsilon = ε} = {}) {\n\t\tif (!this.equals(this.gamutSpace)) {\n\t\t\tcoords = this.to(this.gamutSpace, coords);\n\t\t\treturn this.gamutSpace.inGamut(coords, {epsilon});\n\t\t}\n\n\t\tlet coordMeta = Object.values(this.coords);\n\n\t\treturn coords.every((c, i) => {\n\t\t\tlet meta = coordMeta[i];\n\n\t\t\tif (meta.type !== \"angle\" && meta.range) {\n\t\t\t\tif (Number.isNaN(c)) {\n\t\t\t\t\t// NaN is always in gamut\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tlet [min, max] = meta.range;\n\t\t\t\treturn (min === undefined || c >= min - epsilon)\n\t\t\t\t    && (max === undefined || c <= max + epsilon);\n\t\t\t}\n\n\t\t\treturn true;\n\t\t});\n\t}\n\n\tget isUnbounded () {\n\t\treturn Object.values(this.coords).every(coord => !(\"range\" in coord));\n\t}\n\n\tget cssId () {\n\t\treturn this.formats?.color?.id || this.id;\n\t}\n\n\tget isPolar () {\n\t\tfor (let id in this.coords) {\n\t\t\tif (this.coords[id].type === \"angle\") {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tgetFormat (format) {\n\t\tif (typeof format === \"object\") {\n\t\t\tformat = processFormat(format, this);\n\t\t\treturn format;\n\t\t}\n\n\t\tlet ret;\n\t\tif (format === \"default\") {\n\t\t\t// Get first format\n\t\t\tret = Object.values(this.formats)[0];\n\t\t}\n\t\telse {\n\t\t\tret = this.formats[format];\n\t\t}\n\n\t\tif (ret) {\n\t\t\tret = processFormat(ret, this);\n\t\t\treturn ret;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t/**\n\t * Check if this color space is the same as another color space reference.\n\t * Allows proxying color space objects and comparing color spaces with ids.\n\t * @param {string | ColorSpace} space ColorSpace object or id to compare to\n\t * @returns {boolean}\n\t */\n\tequals (space) {\n\t\tif (!space) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this === space || this.id === space || this.id === space.id;\n\t}\n\n\tto (space, coords) {\n\t\tif (arguments.length === 1) {\n\t\t\tconst color = getColor(space);\n\t\t\t[space, coords] = [color.space, color.coords];\n\t\t}\n\n\t\tspace = ColorSpace.get(space);\n\n\t\tif (this.equals(space)) {\n\t\t\t// Same space, no change needed\n\t\t\treturn coords;\n\t\t}\n\n\t\t// Convert NaN to 0, which seems to be valid in every coordinate of every color space\n\t\tcoords = coords.map(c => Number.isNaN(c) ? 0 : c);\n\n\t\t// Find connection space = lowest common ancestor in the base tree\n\t\tlet myPath = this.path;\n\t\tlet otherPath = space.path;\n\n\t\tlet connectionSpace, connectionSpaceIndex;\n\n\t\tfor (let i = 0; i < myPath.length; i++) {\n\t\t\tif (myPath[i].equals(otherPath[i])) {\n\t\t\t\tconnectionSpace = myPath[i];\n\t\t\t\tconnectionSpaceIndex = i;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (!connectionSpace) {\n\t\t\t// This should never happen\n\t\t\tthrow new Error(`Cannot convert between color spaces ${this} and ${space}: no connection space was found`);\n\t\t}\n\n\t\t// Go up from current space to connection space\n\t\tfor (let i = myPath.length - 1; i > connectionSpaceIndex; i--) {\n\t\t\tcoords = myPath[i].toBase(coords);\n\t\t}\n\n\t\t// Go down from connection space to target space\n\t\tfor (let i = connectionSpaceIndex + 1; i < otherPath.length; i++) {\n\t\t\tcoords = otherPath[i].fromBase(coords);\n\t\t}\n\n\t\treturn coords;\n\t}\n\n\tfrom (space, coords) {\n\t\tif (arguments.length === 1) {\n\t\t\tconst color = getColor(space);\n\t\t\t[space, coords] = [color.space, color.coords];\n\t\t}\n\n\t\tspace = ColorSpace.get(space);\n\n\t\treturn space.to(this, coords);\n\t}\n\n\ttoString () {\n\t\treturn `${this.name} (${this.id})`;\n\t}\n\n\tgetMinCoords () {\n\t\tlet ret = [];\n\n\t\tfor (let id in this.coords) {\n\t\t\tlet meta = this.coords[id];\n\t\t\tlet range = meta.range || meta.refRange;\n\t\t\tret.push(range?.min ?? 0);\n\t\t}\n\n\t\treturn ret;\n\t}\n\n\tstatic registry = {};\n\n\t// Returns array of unique color spaces\n\tstatic get all () {\n\t\treturn [...new Set(Object.values(ColorSpace.registry))];\n\t}\n\n\tstatic register (id, space) {\n\t\tif (arguments.length === 1) {\n\t\t\tspace = arguments[0];\n\t\t\tid = space.id;\n\t\t}\n\n\t\tspace = this.get(space);\n\n\t\tif (this.registry[id] && this.registry[id] !== space) {\n\t\t\tthrow new Error(`Duplicate color space registration: '${id}'`);\n\t\t}\n\t\tthis.registry[id] = space;\n\n\t\t// Register aliases when called without an explicit ID.\n\t\tif (arguments.length === 1 && space.aliases) {\n\t\t\tfor (let alias of space.aliases) {\n\t\t\t\tthis.register(alias, space);\n\t\t\t}\n\t\t}\n\n\t\treturn space;\n\t}\n\n\t/**\n\t * Lookup ColorSpace object by name\n\t * @param {ColorSpace | string} name\n\t */\n\tstatic get (space, ...alternatives) {\n\t\tif (!space || space instanceof ColorSpace) {\n\t\t\treturn space;\n\t\t}\n\n\t\tlet argType = type(space);\n\n\t\tif (argType === \"string\") {\n\t\t\t// It's a color space id\n\t\t\tlet ret = ColorSpace.registry[space.toLowerCase()];\n\n\t\t\tif (!ret) {\n\t\t\t\tthrow new TypeError(`No color space found with id = \"${space}\"`);\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t}\n\n\t\tif (alternatives.length) {\n\t\t\treturn ColorSpace.get(...alternatives);\n\t\t}\n\n\t\tthrow new TypeError(`${space} is not a valid color space`);\n\t}\n\n\t/**\n\t * Get metadata about a coordinate of a color space\n\t *\n\t * @static\n\t * @param {Array | string} ref\n\t * @param {ColorSpace | string} [workingSpace]\n\t * @return {Object}\n\t */\n\tstatic resolveCoord (ref, workingSpace) {\n\t\tlet coordType = type(ref);\n\t\tlet space, coord;\n\n\t\tif (coordType === \"string\") {\n\t\t\tif (ref.includes(\".\")) {\n\t\t\t\t// Absolute coordinate\n\t\t\t\t[space, coord] = ref.split(\".\");\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Relative coordinate\n\t\t\t\t[space, coord] = [, ref];\n\t\t\t}\n\t\t}\n\t\telse if (Array.isArray(ref)) {\n\t\t\t[space, coord] = ref;\n\t\t}\n\t\telse {\n\t\t\t// Object\n\t\t\tspace = ref.space;\n\t\t\tcoord = ref.coordId;\n\t\t}\n\n\t\tspace = ColorSpace.get(space);\n\n\t\tif (!space) {\n\t\t\tspace = workingSpace;\n\t\t}\n\n\t\tif (!space) {\n\t\t\tthrow new TypeError(`Cannot resolve coordinate reference ${ref}: No color space specified and relative references are not allowed here`);\n\t\t}\n\n\t\tcoordType = type(coord);\n\n\t\tif (coordType === \"number\" || coordType === \"string\" && coord >= 0) {\n\t\t\t// Resolve numerical coord\n\t\t\tlet meta = Object.entries(space.coords)[coord];\n\n\t\t\tif (meta) {\n\t\t\t\treturn {space, id: meta[0], index: coord, ...meta[1]};\n\t\t\t}\n\t\t}\n\n\t\tspace = ColorSpace.get(space);\n\n\t\tlet normalizedCoord = coord.toLowerCase();\n\n\t\tlet i = 0;\n\t\tfor (let id in space.coords) {\n\t\t\tlet meta = space.coords[id];\n\n\t\t\tif (id.toLowerCase() === normalizedCoord || meta.name?.toLowerCase() === normalizedCoord) {\n\t\t\t\treturn {space, id, index: i, ...meta};\n\t\t\t}\n\n\t\t\ti++;\n\t\t}\n\n\t\tthrow new TypeError(`No \"${coord}\" coordinate found in ${space.name}. Its coordinates are: ${Object.keys(space.coords).join(\", \")}`);\n\t}\n\n\tstatic DEFAULT_FORMAT = {\n\t\ttype: \"functions\",\n\t\tname: \"color\",\n\t};\n}\n\nfunction getPath (space) {\n\tlet ret = [space];\n\n\tfor (let s = space; s = s.base;) {\n\t\tret.push(s);\n\t}\n\n\treturn ret;\n}\n\nfunction processFormat (format, {coords} = {}) {\n\tif (format.coords && !format.coordGrammar) {\n\t\tformat.type ||= \"function\";\n\t\tformat.name ||= \"color\";\n\n\t\t// Format has not been processed\n\t\tformat.coordGrammar = parseCoordGrammar(format.coords);\n\n\t\tlet coordFormats = Object.entries(coords).map(([id, coordMeta], i) => {\n\t\t\t// Preferred format for each coord is the first one\n\t\t\tlet outputType = format.coordGrammar[i][0];\n\n\t\t\tlet fromRange = coordMeta.range || coordMeta.refRange;\n\t\t\tlet toRange = outputType.range, suffix = \"\";\n\n\t\t\t// Non-strict equals intentional since outputType could be a string object\n\t\t\tif (outputType == \"<percentage>\") {\n\t\t\t\ttoRange = [0, 100];\n\t\t\t\tsuffix = \"%\";\n\t\t\t}\n\t\t\telse if (outputType == \"<angle>\") {\n\t\t\t\tsuffix = \"deg\";\n\t\t\t}\n\n\t\t\treturn  {fromRange, toRange, suffix};\n\t\t});\n\n\t\tformat.serializeCoords = (coords, precision) => {\n\t\t\treturn coords.map((c, i) => {\n\t\t\t\tlet {fromRange, toRange, suffix} = coordFormats[i];\n\n\t\t\t\tif (fromRange && toRange) {\n\t\t\t\t\tc = mapRange(fromRange, toRange, c);\n\t\t\t\t}\n\n\t\t\t\tc = serializeNumber(c, {precision, unit: suffix});\n\n\t\t\t\treturn c;\n\t\t\t});\n\t\t};\n\t}\n\n\treturn format;\n}\n","import ColorSpace from \"../space.js\";\n\nexport default new ColorSpace({\n\tid: \"xyz-d65\",\n\tname: \"XYZ D65\",\n\tcoords: {\n\t\tx: {name: \"X\"},\n\t\ty: {name: \"Y\"},\n\t\tz: {name: \"Z\"},\n\t},\n\twhite: \"D65\",\n\tformats: {\n\t\tcolor: {\n\t\t\tids: [\"xyz-d65\", \"xyz\"],\n\t\t},\n\t},\n\taliases: [\"xyz\"],\n});\n","import ColorSpace from \"./space.js\";\nimport {multiplyMatrices} from \"./util.js\";\nimport adapt from \"./adapt.js\";\nimport XYZ_D65 from \"./spaces/xyz-d65.js\";\n\n/**\n * Convenience class for RGB color spaces\n * @extends {ColorSpace}\n */\nexport default class RGBColorSpace extends ColorSpace {\n\t/**\n\t * Creates a new RGB ColorSpace.\n\t * If coords are not specified, they will use the default RGB coords.\n\t * Instead of `fromBase()` and `toBase()` functions,\n\t * you can specify to/from XYZ matrices and have `toBase()` and `fromBase()` automatically generated.\n\t * @param {*} options - Same options as {@link ColorSpace} plus:\n\t * @param {number[][]} options.toXYZ_M - Matrix to convert to XYZ\n\t * @param {number[][]} options.fromXYZ_M - Matrix to convert from XYZ\n\t */\n\tconstructor (options) {\n\t\tif (!options.coords) {\n\t\t\toptions.coords = {\n\t\t\t\tr: {\n\t\t\t\t\trange: [0, 1],\n\t\t\t\t\tname: \"Red\",\n\t\t\t\t},\n\t\t\t\tg: {\n\t\t\t\t\trange: [0, 1],\n\t\t\t\t\tname: \"Green\",\n\t\t\t\t},\n\t\t\t\tb: {\n\t\t\t\t\trange: [0, 1],\n\t\t\t\t\tname: \"Blue\",\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\n\t\tif (!options.base) {\n\t\t\toptions.base = XYZ_D65;\n\t\t}\n\n\t\tif (options.toXYZ_M && options.fromXYZ_M) {\n\t\t\toptions.toBase ??= rgb => {\n\t\t\t\tlet xyz = multiplyMatrices(options.toXYZ_M, rgb);\n\n\t\t\t\tif (this.white !== this.base.white) {\n\t\t\t\t\t// Perform chromatic adaptation\n\t\t\t\t\txyz = adapt(this.white, this.base.white, xyz);\n\t\t\t\t}\n\n\t\t\t\treturn xyz;\n\t\t\t};\n\n\t\t\toptions.fromBase ??= xyz => {\n\t\t\t\txyz = adapt(this.base.white, this.white, xyz);\n\t\t\t\treturn multiplyMatrices(options.fromXYZ_M, xyz);\n\t\t\t};\n\t\t}\n\n\t\toptions.referred ??= \"display\";\n\n\t\tsuper(options);\n\t}\n}\n","import ColorSpace from \"./space.js\";\nimport getColor from \"./getColor.js\";\n\n/**\n * Get the coordinates of a color in any color space\n * @param {Color} color\n * @param {string | ColorSpace} [space = color.space] The color space to convert to. Defaults to the color's current space\n * @returns {number[]} The color coordinates in the given color space\n */\nexport default function getAll (color, space) {\n\tcolor = getColor(color);\n\n\tif (!space || color.space.equals(space)) {\n\t\t// No conversion needed\n\t\treturn color.coords.slice();\n\t}\n\n\tspace = ColorSpace.get(space);\n\treturn space.from(color);\n}\n","import ColorSpace from \"./space.js\";\nimport getAll from \"./getAll.js\";\nimport getColor from \"./getColor.js\";\n\nexport default function get (color, prop) {\n\tcolor = getColor(color);\n\n\tlet {space, index} = ColorSpace.resolveCoord(prop, color.space);\n\tlet coords = getAll(color, space);\n\treturn coords[index];\n}\n","import ColorSpace from \"./space.js\";\nimport getColor from \"./getColor.js\";\n\nexport default function setAll (color, space, coords) {\n\tcolor = getColor(color);\n\n\tspace = ColorSpace.get(space);\n\tcolor.coords = space.to(color.space, coords);\n\treturn color;\n}\n\nsetAll.returns = \"color\";\n","import ColorSpace from \"./space.js\";\nimport getColor from \"./getColor.js\";\nimport get from \"./get.js\";\nimport getAll from \"./getAll.js\";\nimport setAll from \"./setAll.js\";\nimport {type} from \"./util.js\";\n\n// Set properties and return current instance\nexport default function set (color, prop, value) {\n\tcolor = getColor(color);\n\n\tif (arguments.length === 2 && type(arguments[1]) === \"object\") {\n\t\t// Argument is an object literal\n\t\tlet object = arguments[1];\n\t\tfor (let p in object) {\n\t\t\tset(color, p, object[p]);\n\t\t}\n\t}\n\telse {\n\t\tif (typeof value === \"function\") {\n\t\t\tvalue = value(get(color, prop));\n\t\t}\n\n\t\tlet {space, index} = ColorSpace.resolveCoord(prop, color.space);\n\t\tlet coords = getAll(color, space);\n\t\tcoords[index] = value;\n\t\tsetAll(color, space, coords);\n\t}\n\n\treturn color;\n}\n\nset.returns = \"color\";\n","import ColorSpace from \"../space.js\";\nimport adapt from \"../adapt.js\";\nimport XYZ_D65 from \"./xyz-d65.js\";\n\nexport default new ColorSpace({\n\tid: \"xyz-d50\",\n\tname: \"XYZ D50\",\n\twhite: \"D50\",\n\tbase: XYZ_D65,\n\tfromBase: coords => adapt(XYZ_D65.white, \"D50\", coords),\n\ttoBase: coords => adapt(\"D50\", XYZ_D65.white, coords),\n});\n","import ColorSpace from \"../space.js\";\nimport {WHITES} from \"../adapt.js\";\nimport xyz_d50 from \"./xyz-d50.js\";\n\n// κ * ε  = 2^3 = 8\nconst ε = 216 / 24389;  // 6^3/29^3 == (24/116)^3\nconst ε3 = 24 / 116;\nconst κ = 24389 / 27;   // 29^3/3^3\n\nlet white = WHITES.D50;\n\nexport default new ColorSpace({\n\tid: \"lab\",\n\tname: \"Lab\",\n\tcoords: {\n\t\tl: {\n\t\t\trefRange: [0, 100],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t\ta: {\n\t\t\trefRange: [-125, 125],\n\t\t},\n\t\tb: {\n\t\t\trefRange: [-125, 125],\n\t\t},\n\t},\n\n\t// Assuming XYZ is relative to D50, convert to CIE Lab\n\t// from CIE standard, which now defines these as a rational fraction\n\twhite,\n\n\tbase: xyz_d50,\n\t// Convert D50-adapted XYX to Lab\n\t//  CIE 15.3:2004 section 8.2.1.1\n\tfromBase (XYZ) {\n\t\t// compute xyz, which is XYZ scaled relative to reference white\n\t\tlet xyz = XYZ.map((value, i) => value / white[i]);\n\n\t\t// now compute f\n\t\tlet f = xyz.map(value => value > ε ? Math.cbrt(value) : (κ * value + 16) / 116);\n\n\t\treturn [\n\t\t\t(116 * f[1]) - 16,   // L\n\t\t\t500 * (f[0] - f[1]), // a\n\t\t\t200 * (f[1] - f[2]),  // b\n\t\t];\n\t},\n\t// Convert Lab to D50-adapted XYZ\n\t// Same result as CIE 15.3:2004 Appendix D although the derivation is different\n\t// http://www.brucelindbloom.com/index.html?Eqn_RGB_XYZ_Matrix.html\n\ttoBase (Lab) {\n\t\t// compute f, starting with the luminance-related term\n\t\tlet f = [];\n\t\tf[1] = (Lab[0] + 16) / 116;\n\t\tf[0] = Lab[1] / 500 + f[1];\n\t\tf[2] = f[1] - Lab[2] / 200;\n\n\t\t// compute xyz\n\t\tlet xyz = [\n\t\t\tf[0]   > ε3 ? Math.pow(f[0], 3)                : (116 * f[0] - 16) / κ,\n\t\t\tLab[0] > 8  ? Math.pow((Lab[0] + 16) / 116, 3) : Lab[0] / κ,\n\t\t\tf[2]   > ε3 ? Math.pow(f[2], 3)                : (116 * f[2] - 16) / κ,\n\t\t];\n\n\t\t// Compute XYZ by scaling xyz by reference white\n\t\treturn xyz.map((value, i) => value * white[i]);\n\t},\n\n\tformats: {\n\t\t\"lab\": {\n\t\t\tcoords: [\"<number> | <percentage>\", \"<number> | <percentage>[-1,1]\", \"<number> | <percentage>[-1,1]\"],\n\t\t},\n\t},\n});\n","export function constrain (angle) {\n\treturn ((angle % 360) + 360) % 360;\n}\n\nexport function adjust (arc, angles) {\n\tif (arc === \"raw\") {\n\t\treturn angles;\n\t}\n\n\tlet [a1, a2] = angles.map(constrain);\n\n\tlet angleDiff = a2 - a1;\n\n\tif (arc === \"increasing\") {\n\t\tif (angleDiff < 0) {\n\t\t\ta2 += 360;\n\t\t}\n\t}\n\telse if (arc === \"decreasing\") {\n\t\tif (angleDiff > 0) {\n\t\t\ta1 += 360;\n\t\t}\n\t}\n\telse if (arc === \"longer\") {\n\t\tif (-180 < angleDiff && angleDiff < 180) {\n\t\t\tif (angleDiff > 0) {\n\t\t\t\ta1 += 360;\n\t\t\t}\n\t\t\telse {\n\t\t\t\ta2 += 360;\n\t\t\t}\n\t\t}\n\t}\n\telse if (arc === \"shorter\") {\n\t\tif (angleDiff > 180) {\n\t\t\ta1 += 360;\n\t\t}\n\t\telse if (angleDiff < -180) {\n\t\t\ta2 += 360;\n\t\t}\n\t}\n\n\treturn [a1, a2];\n}\n","import ColorSpace from \"../space.js\";\nimport Lab from \"./lab.js\";\nimport {constrain as constrainAngle} from \"../angles.js\";\n\nexport default new ColorSpace({\n\tid: \"lch\",\n\tname: \"LCH\",\n\tcoords: {\n\t\tl: {\n\t\t\trefRange: [0, 100],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t\tc: {\n\t\t\trefRange: [0, 150],\n\t\t\tname: \"Chroma\",\n\t\t},\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t},\n\n\tbase: Lab,\n\tfromBase (Lab) {\n\t\t// Convert to polar form\n\t\tlet [L, a, b] = Lab;\n\t\tlet hue;\n\t\tconst ε = 0.02;\n\n\t\tif (Math.abs(a) < ε && Math.abs(b) < ε) {\n\t\t\thue = NaN;\n\t\t}\n\t\telse {\n\t\t\thue = Math.atan2(b, a) * 180 / Math.PI;\n\t\t}\n\n\t\treturn [\n\t\t\tL, // L is still L\n\t\t\tMath.sqrt(a ** 2 + b ** 2), // Chroma\n\t\t\tconstrainAngle(hue), // Hue, in degrees [0 to 360)\n\t\t];\n\t},\n\ttoBase (LCH) {\n\t\t// Convert from polar form\n\t\tlet [Lightness, Chroma, Hue] = LCH;\n\t\t// Clamp any negative Chroma\n\t\tif (Chroma < 0) {\n\t\t\tChroma = 0;\n\t\t}\n\t\t// Deal with NaN Hue\n\t\tif (isNaN(Hue)) {\n\t\t\tHue = 0;\n\t\t}\n\t\treturn [\n\t\t\tLightness, // L is still L\n\t\t\tChroma * Math.cos(Hue * Math.PI / 180), // a\n\t\t\tChroma * Math.sin(Hue * Math.PI / 180),  // b\n\t\t];\n\t},\n\n\tformats: {\n\t\t\"lch\": {\n\t\t\tcoords: [\"<number> | <percentage>\", \"<number> | <percentage>\", \"<number> | <angle>\"],\n\t\t},\n\t},\n});\n","import defaults from \"../defaults.js\";\nimport lab from \"../spaces/lab.js\";\nimport lch from \"../spaces/lch.js\";\nimport getColor from \"../getColor.js\";\n\n// deltaE2000 is a statistically significant improvement\n// and is recommended by the CIE and Idealliance\n// especially for color differences less than 10 deltaE76\n// but is wicked complicated\n// and many implementations have small errors!\n// DeltaE2000 is also discontinuous; in case this\n// matters to you, use deltaECMC instead.\n\nconst Gfactor = 25 ** 7;\nconst π = Math.PI;\nconst r2d = 180 / π;\nconst d2r = π / 180;\n\nfunction pow7 (x) {\n\t// Faster than x ** 7 or Math.pow(x, 7)\n\n\tconst x2 = x * x;\n\tconst x7 = x2 * x2 * x2 * x;\n\n\treturn x7;\n}\n\nexport default function (color, sample, {kL = 1, kC = 1, kH = 1} = {}) {\n\t[color, sample] = getColor([color, sample]);\n\n\t// Given this color as the reference\n\t// and the function parameter as the sample,\n\t// calculate deltaE 2000.\n\n\t// This implementation assumes the parametric\n\t// weighting factors kL, kC and kH\n\t// for the influence of viewing conditions\n\t// are all 1, as sadly seems typical.\n\t// kL should be increased for lightness texture or noise\n\t// and kC increased for chroma noise\n\n\tlet [L1, a1, b1] = lab.from(color);\n\tlet C1 = lch.from(lab, [L1, a1, b1])[1];\n\tlet [L2, a2, b2] = lab.from(sample);\n\tlet C2 = lch.from(lab, [L2, a2, b2])[1];\n\n\t// Check for negative Chroma,\n\t// which might happen through\n\t// direct user input of LCH values\n\n\tif (C1 < 0) {\n\t\tC1 = 0;\n\t}\n\tif (C2 < 0) {\n\t\tC2 = 0;\n\t}\n\n\tlet Cbar = (C1 + C2) / 2; // mean Chroma\n\n\t// calculate a-axis asymmetry factor from mean Chroma\n\t// this turns JND ellipses for near-neutral colors back into circles\n\tlet C7 = pow7(Cbar);\n\n\tlet G = 0.5 * (1 - Math.sqrt(C7 / (C7 + Gfactor)));\n\n\t// scale a axes by asymmetry factor\n\t// this by the way is why there is no Lab2000 colorspace\n\tlet adash1 = (1 + G) * a1;\n\tlet adash2 = (1 + G) * a2;\n\n\t// calculate new Chroma from scaled a and original b axes\n\tlet Cdash1 = Math.sqrt(adash1 ** 2 + b1 ** 2);\n\tlet Cdash2 = Math.sqrt(adash2 ** 2 + b2 ** 2);\n\n\t// calculate new hues, with zero hue for true neutrals\n\t// and in degrees, not radians\n\n\tlet h1 = (adash1 === 0 && b1 === 0) ? 0 : Math.atan2(b1, adash1);\n\tlet h2 = (adash2 === 0 && b2 === 0) ? 0 : Math.atan2(b2, adash2);\n\n\tif (h1 < 0) {\n\t\th1 += 2 * π;\n\t}\n\tif (h2 < 0) {\n\t\th2 += 2 * π;\n\t}\n\n\th1 *= r2d;\n\th2 *= r2d;\n\n\t// Lightness and Chroma differences; sign matters\n\tlet ΔL = L2 - L1;\n\tlet ΔC = Cdash2 - Cdash1;\n\n\t// Hue difference, getting the sign correct\n\tlet hdiff = h2 - h1;\n\tlet hsum = h1 + h2;\n\tlet habs = Math.abs(hdiff);\n\tlet Δh;\n\n\tif (Cdash1 * Cdash2 === 0) {\n\t\tΔh = 0;\n\t}\n\telse if (habs <= 180) {\n\t\tΔh = hdiff;\n\t}\n\telse if (hdiff > 180) {\n\t\tΔh = hdiff - 360;\n\t}\n\telse if (hdiff < -180) {\n\t\tΔh = hdiff + 360;\n\t}\n\telse {\n\t\tdefaults.warn(\"the unthinkable has happened\");\n\t}\n\n\t// weighted Hue difference, more for larger Chroma\n\tlet ΔH = 2 * Math.sqrt(Cdash2 * Cdash1) * Math.sin(Δh * d2r / 2);\n\n\t// calculate mean Lightness and Chroma\n\tlet Ldash = (L1 + L2) / 2;\n\tlet Cdash = (Cdash1 + Cdash2) / 2;\n\tlet Cdash7 = pow7(Cdash);\n\n\t// Compensate for non-linearity in the blue region of Lab.\n\t// Four possibilities for hue weighting factor,\n\t// depending on the angles, to get the correct sign\n\tlet hdash;\n\tif (Cdash1 * Cdash2 === 0) {\n\t\thdash = hsum;   // which should be zero\n\t}\n\telse if (habs <= 180) {\n\t\thdash = hsum / 2;\n\t}\n\telse if (hsum < 360) {\n\t\thdash = (hsum + 360) / 2;\n\t}\n\telse {\n\t\thdash = (hsum - 360) / 2;\n\t}\n\n\t// positional corrections to the lack of uniformity of CIELAB\n\t// These are all trying to make JND ellipsoids more like spheres\n\n\t// SL Lightness crispening factor\n\t// a background with L=50 is assumed\n\tlet lsq = (Ldash - 50) ** 2;\n\tlet SL = 1 + ((0.015 * lsq) / Math.sqrt(20 + lsq));\n\n\t// SC Chroma factor, similar to those in CMC and deltaE 94 formulae\n\tlet SC = 1 + 0.045 * Cdash;\n\n\t// Cross term T for blue non-linearity\n\tlet T = 1;\n\tT -= (0.17 * Math.cos((     hdash - 30)  * d2r));\n\tT += (0.24 * Math.cos(  2 * hdash        * d2r));\n\tT += (0.32 * Math.cos(((3 * hdash) + 6)  * d2r));\n\tT -= (0.20 * Math.cos(((4 * hdash) - 63) * d2r));\n\n\t// SH Hue factor depends on Chroma,\n\t// as well as adjusted hue angle like deltaE94.\n\tlet SH = 1 + 0.015 * Cdash * T;\n\n\t// RT Hue rotation term compensates for rotation of JND ellipses\n\t// and Munsell constant hue lines\n\t// in the medium-high Chroma blue region\n\t// (Hue 225 to 315)\n\tlet Δθ = 30 * Math.exp(-1 * (((hdash - 275) / 25) ** 2));\n\tlet RC = 2 * Math.sqrt(Cdash7 / (Cdash7 + Gfactor));\n\tlet RT = -1 * Math.sin(2 * Δθ * d2r) * RC;\n\n\t// Finally calculate the deltaE, term by term as root sume of squares\n\tlet dE = (ΔL / (kL * SL)) ** 2;\n\tdE += (ΔC / (kC * SC)) ** 2;\n\tdE += (ΔH / (kH * SH)) ** 2;\n\tdE += RT * (ΔC / (kC * SC)) * (ΔH / (kH * SH));\n\treturn Math.sqrt(dE);\n\t// Yay!!!\n}\n","import ColorSpace from \"../space.js\";\nimport {multiplyMatrices} from \"../util.js\";\nimport XYZ_D65 from \"./xyz-d65.js\";\n\n// Recalculated for consistent reference white\n// see https://github.com/w3c/csswg-drafts/issues/6642#issuecomment-943521484\nconst XYZtoLMS_M = [\n\t[ 0.8190224379967030, 0.3619062600528904, -0.1288737815209879 ],\n\t[ 0.0329836539323885, 0.9292868615863434,  0.0361446663506424 ],\n\t[ 0.0481771893596242, 0.2642395317527308,  0.6335478284694309 ],\n];\n// inverse of XYZtoLMS_M\nconst LMStoXYZ_M = [\n\t[  1.2268798758459243, -0.5578149944602171,  0.2813910456659647 ],\n\t[ -0.0405757452148008,  1.1122868032803170, -0.0717110580655164 ],\n\t[ -0.0763729366746601, -0.4214933324022432,  1.5869240198367816 ],\n];\nconst LMStoLab_M = [\n\t[ 0.2104542683093140,  0.7936177747023054, -0.0040720430116193 ],\n\t[ 1.9779985324311684, -2.4285922420485799,  0.4505937096174110 ],\n\t[ 0.0259040424655478,  0.7827717124575296, -0.8086757549230774 ],\n];\n// LMStoIab_M inverted\nconst LabtoLMS_M = [\n\t[ 1.0000000000000000,  0.3963377773761749,  0.2158037573099136 ],\n\t[ 1.0000000000000000, -0.1055613458156586, -0.0638541728258133 ],\n\t[ 1.0000000000000000, -0.0894841775298119, -1.2914855480194092 ],\n];\n\nexport default new ColorSpace({\n\tid: \"oklab\",\n\tname: \"Oklab\",\n\tcoords: {\n\t\tl: {\n\t\t\trefRange: [0, 1],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t\ta: {\n\t\t\trefRange: [-0.4, 0.4],\n\t\t},\n\t\tb: {\n\t\t\trefRange: [-0.4, 0.4],\n\t\t},\n\t},\n\n\t// Note that XYZ is relative to D65\n\twhite: \"D65\",\n\tbase: XYZ_D65,\n\tfromBase (XYZ) {\n\t\t// move to LMS cone domain\n\t\tlet LMS = multiplyMatrices(XYZtoLMS_M, XYZ);\n\n\t\t// non-linearity\n\t\tlet LMSg = LMS.map(val => Math.cbrt(val));\n\n\t\treturn multiplyMatrices(LMStoLab_M, LMSg);\n\n\t},\n\ttoBase (OKLab) {\n\t\t// move to LMS cone domain\n\t\tlet LMSg = multiplyMatrices(LabtoLMS_M, OKLab);\n\n\t\t// restore linearity\n\t\tlet LMS = LMSg.map(val => val ** 3);\n\n\t\treturn multiplyMatrices(LMStoXYZ_M, LMS);\n\t},\n\n\tformats: {\n\t\t\"oklab\": {\n\t\t\tcoords: [\"<percentage> | <number>\", \"<number> | <percentage>[-1,1]\", \"<number> | <percentage>[-1,1]\"],\n\t\t},\n\t},\n});\n","// More accurate color-difference formulae\n// than the simple 1976 Euclidean distance in CIE Lab\n\nimport oklab from \"../spaces/oklab.js\";\nimport getColor from \"../getColor.js\";\n\nexport default function (color, sample) {\n\t[color, sample] = getColor([color, sample]);\n\n\t// Given this color as the reference\n\t// and a sample,\n\t// calculate deltaEOK, term by term as root sum of squares\n\tlet [L1, a1, b1] = oklab.from(color);\n\tlet [L2, a2, b2] = oklab.from(sample);\n\tlet ΔL = L1 - L2;\n\tlet Δa = a1 - a2;\n\tlet Δb = b1 - b2;\n\treturn Math.sqrt(ΔL ** 2 + Δa ** 2 + Δb ** 2);\n}\n","import ColorSpace from \"./space.js\";\nimport getColor from \"./getColor.js\";\n\nconst ε = .000075;\n\n/**\n * Check if a color is in gamut of either its own or another color space\n * @return {Boolean} Is the color in gamut?\n */\nexport default function inGamut (color, space, {epsilon = ε} = {}) {\n\tcolor = getColor(color);\n\n\tif (!space) {\n\t\tspace = color.space;\n\t}\n\n\tspace = ColorSpace.get(space);\n\tlet coords = color.coords;\n\n\tif (space !== color.space) {\n\t\tcoords = space.from(color);\n\t}\n\n\treturn space.inGamut(coords, {epsilon});\n}\n","export default function clone (color) {\n\treturn {\n\t\tspace: color.space,\n\t\tcoords: color.coords.slice(),\n\t\talpha: color.alpha,\n\t};\n}\n","import ColorSpace from \"./space.js\";\n\n/**\n * Euclidean distance of colors in an arbitrary color space\n */\nexport default function distance (color1, color2, space = \"lab\") {\n\tspace = ColorSpace.get(space);\n\n\t// Assume getColor() is called on color in space.from()\n\tlet coords1 = space.from(color1);\n\tlet coords2 = space.from(color2);\n\n\treturn Math.sqrt(coords1.reduce((acc, c1, i) => {\n\t\tlet c2 = coords2[i];\n\t\tif (isNaN(c1) || isNaN(c2)) {\n\t\t\treturn acc;\n\t\t}\n\n\t\treturn acc + (c2 - c1) ** 2;\n\t}, 0));\n}\n","import distance from \"../distance.js\";\nimport getColor from \"../getColor.js\";\n\nexport default function deltaE76 (color, sample) {\n\t// Assume getColor() is called in the distance function\n\treturn distance(color, sample, \"lab\");\n}\n","import lab from \"../spaces/lab.js\";\nimport lch from \"../spaces/lch.js\";\nimport getColor from \"../getColor.js\";\n\n// More accurate color-difference formulae\n// than the simple 1976 Euclidean distance in Lab\n\n// CMC by the Color Measurement Committee of the\n// Bradford Society of Dyeists and Colorsts, 1994.\n// Uses LCH rather than Lab,\n// with different weights for L, C and H differences\n// A nice increase in accuracy for modest increase in complexity\nconst π = Math.PI;\nconst d2r = π / 180;\n\nexport default function (color, sample, {l = 2, c = 1} = {}) {\n\t[color, sample] = getColor([color, sample]);\n\n\t// Given this color as the reference\n\t// and a sample,\n\t// calculate deltaE CMC.\n\n\t// This implementation assumes the parametric\n\t// weighting factors l:c are 2:1\n\t// which is typical for non-textile uses.\n\n\tlet [L1, a1, b1] = lab.from(color);\n\tlet [, C1, H1] = lch.from(lab, [L1, a1, b1]);\n\tlet [L2, a2, b2] = lab.from(sample);\n\tlet C2 = lch.from(lab, [L2, a2, b2])[1];\n\n\t// let [L1, a1, b1] = color.getAll(lab);\n\t// let C1 = color.get(\"lch.c\");\n\t// let H1 = color.get(\"lch.h\");\n\t// let [L2, a2, b2] = sample.getAll(lab);\n\t// let C2 = sample.get(\"lch.c\");\n\n\t// Check for negative Chroma,\n\t// which might happen through\n\t// direct user input of LCH values\n\n\tif (C1 < 0) {\n\t\tC1 = 0;\n\t}\n\tif (C2 < 0) {\n\t\tC2 = 0;\n\t}\n\n\t// we don't need H2 as ΔH is calculated from Δa, Δb and ΔC\n\n\t// Lightness and Chroma differences\n\t// These are (color - sample), unlike deltaE2000\n\tlet ΔL = L1 - L2;\n\tlet ΔC = C1 - C2;\n\n\tlet Δa = a1 - a2;\n\tlet Δb = b1 - b2;\n\n\t// weighted Hue difference, less for larger Chroma difference\n\n\tlet H2 = (Δa ** 2) + (Δb ** 2) - (ΔC ** 2);\n\t// due to roundoff error it is possible that, for zero a and b,\n\t// ΔC > Δa + Δb is 0, resulting in attempting\n\t// to take the square root of a negative number\n\n\t// trying instead the equation from Industrial Color Physics\n\t// By Georg A. Klein\n\n\t// let ΔH = ((a1 * b2) - (a2 * b1)) / Math.sqrt(0.5 * ((C2 * C1) + (a2 * a1) + (b2 * b1)));\n\t// console.log({ΔH});\n\t// This gives the same result to 12 decimal places\n\t// except it sometimes NaNs when trying to root a negative number\n\n\t// let ΔH = Math.sqrt(H2); we never actually use the root, it gets squared again!!\n\n\t// positional corrections to the lack of uniformity of CIELAB\n\t// These are all trying to make JND ellipsoids more like spheres\n\n\t// SL Lightness crispening factor, depends entirely on L1 not L2\n\tlet SL = 0.511;\t// linear portion of the Y to L transfer function\n\tif (L1 >= 16) {\t// cubic portion\n\t\tSL = (0.040975 * L1) / (1 + 0.01765 * L1);\n\t}\n\n\t// SC Chroma factor\n\tlet SC = ((0.0638 * C1) / (1 + 0.0131 * C1)) + 0.638;\n\n\t// Cross term T for blue non-linearity\n\tlet T;\n\tif (Number.isNaN(H1)) {\n\t\tH1 = 0;\n\t}\n\n\tif (H1 >= 164 && H1 <= 345) {\n\t\tT = 0.56 + Math.abs(0.2 * Math.cos((H1 + 168) * d2r));\n\t}\n\telse {\n\t\tT = 0.36 + Math.abs(0.4 * Math.cos((H1 + 35) * d2r));\n\t}\n\t// console.log({T});\n\n\t// SH Hue factor also depends on C1,\n\tlet C4 = Math.pow(C1, 4);\n\tlet F = Math.sqrt(C4 / (C4 + 1900));\n\tlet SH = SC * ((F * T) + 1 - F);\n\n\t// Finally calculate the deltaE, term by term as root sume of squares\n\tlet dE = (ΔL / (l * SL)) ** 2;\n\tdE += (ΔC / (c * SC)) ** 2;\n\tdE += (H2 / (SH ** 2));\n\t// dE += (ΔH / SH)  ** 2;\n\treturn Math.sqrt(dE);\n\t// Yay!!!\n}\n","import ColorSpace from \"../space.js\";\nimport XYZ_D65 from \"./xyz-d65.js\";\n\nconst Yw = 203;\t// absolute luminance of media white\n\nexport default new ColorSpace({\n// Absolute CIE XYZ, with a D65 whitepoint,\n// as used in most HDR colorspaces as a starting point.\n// SDR spaces are converted per BT.2048\n// so that diffuse, media white is 203 cd/m²\n\tid: \"xyz-abs-d65\",\n\tcssId: \"--xyz-abs-d65\",\n\tname: \"Absolute XYZ D65\",\n\tcoords: {\n\t\tx: {\n\t\t\trefRange: [0, 9504.7],\n\t\t\tname: \"Xa\",\n\t\t},\n\t\ty: {\n\t\t\trefRange: [0, 10000],\n\t\t\tname: \"Ya\",\n\t\t},\n\t\tz: {\n\t\t\trefRange: [0, 10888.3],\n\t\t\tname: \"Za\",\n\t\t},\n\t},\n\n\tbase: XYZ_D65,\n\tfromBase (XYZ) {\n\t\t// Make XYZ absolute, not relative to media white\n\t\t// Maximum luminance in PQ is 10,000 cd/m²\n\t\t// Relative XYZ has Y=1 for media white\n\t\treturn XYZ.map (v => Math.max(v * Yw, 0));\n\t},\n\ttoBase (AbsXYZ) {\n\t\t// Convert to media-white relative XYZ\n\t\treturn AbsXYZ.map(v => Math.max(v / Yw, 0));\n\t},\n});\n","import ColorSpace from \"../space.js\";\nimport {multiplyMatrices} from \"../util.js\";\nimport XYZ_Abs_D65 from \"./xyz-abs-d65.js\";\n\nconst b = 1.15;\nconst g = 0.66;\nconst n = 2610 / (2 ** 14);\nconst ninv = (2 ** 14) / 2610;\nconst c1 = 3424 / (2 ** 12);\nconst c2 = 2413 / (2 ** 7);\nconst c3 = 2392 / (2 ** 7);\nconst p = 1.7 * 2523 / (2 ** 5);\nconst pinv = (2 ** 5) / (1.7 * 2523);\nconst d = -0.56;\nconst d0 = 1.6295499532821566E-11;\n\nconst XYZtoCone_M = [\n\t[  0.41478972, 0.579999,  0.0146480 ],\n\t[ -0.2015100,  1.120649,  0.0531008 ],\n\t[ -0.0166008,  0.264800,  0.6684799 ],\n];\n// XYZtoCone_M inverted\nconst ConetoXYZ_M = [\n\t[  1.9242264357876067,  -1.0047923125953657,  0.037651404030618   ],\n\t[  0.35031676209499907,  0.7264811939316552, -0.06538442294808501 ],\n\t[ -0.09098281098284752, -0.3127282905230739,  1.5227665613052603  ],\n];\nconst ConetoIab_M = [\n\t[  0.5,       0.5,       0        ],\n\t[  3.524000, -4.066708,  0.542708 ],\n\t[  0.199076,  1.096799, -1.295875 ],\n];\n// ConetoIab_M inverted\nconst IabtoCone_M = [\n\t[ 1,                   0.1386050432715393,   0.05804731615611886 ],\n\t[ 0.9999999999999999, -0.1386050432715393,  -0.05804731615611886 ],\n\t[ 0.9999999999999998, -0.09601924202631895, -0.8118918960560388  ],\n];\n\nexport default new ColorSpace({\n\tid: \"jzazbz\",\n\tname: \"Jzazbz\",\n\tcoords: {\n\t\tjz: {\n\t\t\trefRange: [0, 1],\n\t\t\tname: \"Jz\",\n\t\t},\n\t\taz: {\n\t\t\trefRange: [-0.5, 0.5],\n\t\t},\n\t\tbz: {\n\t\t\trefRange: [-0.5, 0.5],\n\t\t},\n\t},\n\n\tbase: XYZ_Abs_D65,\n\tfromBase (XYZ) {\n\t\t// First make XYZ absolute, not relative to media white\n\t\t// Maximum luminance in PQ is 10,000 cd/m²\n\t\t// Relative XYZ has Y=1 for media white\n\t\t// BT.2048 says media white Y=203 at PQ 58\n\n\t\tlet [ Xa, Ya, Za ] = XYZ;\n\n\t\t// modify X and Y\n\t\tlet Xm = (b * Xa) - ((b - 1) * Za);\n\t\tlet Ym = (g * Ya) - ((g - 1) * Xa);\n\n\t\t// move to LMS cone domain\n\t\tlet LMS = multiplyMatrices(XYZtoCone_M, [ Xm, Ym, Za ]);\n\n\t\t// PQ-encode LMS\n\t\tlet PQLMS = LMS.map (function (val) {\n\t\t\tlet num = c1 + (c2 * ((val / 10000) ** n));\n\t\t\tlet denom = 1 + (c3 * ((val / 10000) ** n));\n\n\t\t\treturn (num / denom)  ** p;\n\t\t});\n\n\t\t// almost there, calculate Iz az bz\n\t\tlet [ Iz, az, bz] = multiplyMatrices(ConetoIab_M, PQLMS);\n\t\t// console.log({Iz, az, bz});\n\n\t\tlet Jz = ((1 + d) * Iz) / (1 + (d * Iz)) - d0;\n\t\treturn [Jz, az, bz];\n\t},\n\ttoBase (Jzazbz) {\n\t\tlet [Jz, az, bz] = Jzazbz;\n\t\tlet Iz = (Jz + d0) / (1 + d - d * (Jz + d0));\n\n\t\t// bring into LMS cone domain\n\t\tlet PQLMS = multiplyMatrices(IabtoCone_M, [ Iz, az, bz ]);\n\n\t\t// convert from PQ-coded to linear-light\n\t\tlet LMS = PQLMS.map(function (val) {\n\t\t\tlet num = (c1 - (val ** pinv));\n\t\t\tlet denom = (c3 * (val ** pinv)) - c2;\n\t\t\tlet x = 10000 * ((num / denom) ** ninv);\n\n\t\t\treturn (x); \t// luminance relative to diffuse white, [0, 70 or so].\n\t\t});\n\n\t\t// modified abs XYZ\n\t\tlet [ Xm, Ym, Za ] = multiplyMatrices(ConetoXYZ_M, LMS);\n\n\t\t// restore standard D50 relative XYZ, relative to media white\n\t\tlet Xa = (Xm + ((b - 1) * Za)) / b;\n\t\tlet Ya = (Ym + ((g - 1) * Xa)) / g;\n\t\treturn [ Xa, Ya, Za ];\n\t},\n\n\tformats: {\n\t\t// https://drafts.csswg.org/css-color-hdr/#Jzazbz\n\t\t\"color\": {\n\t\t\tcoords: [\"<number> | <percentage>\", \"<number> | <percentage>[-1,1]\", \"<number> | <percentage>[-1,1]\"],\n\t\t},\n\t},\n});\n","import ColorSpace from \"../space.js\";\nimport Jzazbz from \"./jzazbz.js\";\nimport {constrain as constrainAngle} from \"../angles.js\";\n\nexport default new ColorSpace({\n\tid: \"jzczhz\",\n\tname: \"JzCzHz\",\n\tcoords: {\n\t\tjz: {\n\t\t\trefRange: [0, 1],\n\t\t\tname: \"Jz\",\n\t\t},\n\t\tcz: {\n\t\t\trefRange: [0, 1],\n\t\t\tname: \"Chroma\",\n\t\t},\n\t\thz: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t},\n\n\tbase: Jzazbz,\n\tfromBase (jzazbz) {\n\t\t// Convert to polar form\n\t\tlet [Jz, az, bz] = jzazbz;\n\t\tlet hue;\n\t\tconst ε = 0.0002; // chromatic components much smaller than a,b\n\n\t\tif (Math.abs(az) < ε && Math.abs(bz) < ε) {\n\t\t\thue = NaN;\n\t\t}\n\t\telse {\n\t\t\thue = Math.atan2(bz, az) * 180 / Math.PI;\n\t\t}\n\n\t\treturn [\n\t\t\tJz, // Jz is still Jz\n\t\t\tMath.sqrt(az ** 2 + bz ** 2), // Chroma\n\t\t\tconstrainAngle(hue), // Hue, in degrees [0 to 360)\n\t\t];\n\t},\n\ttoBase (jzczhz) {\n\t\t// Convert from polar form\n\t\t// debugger;\n\t\treturn [\n\t\t\tjzczhz[0], // Jz is still Jz\n\t\t\tjzczhz[1] * Math.cos(jzczhz[2] * Math.PI / 180), // az\n\t\t\tjzczhz[1] * Math.sin(jzczhz[2] * Math.PI / 180),  // bz\n\t\t];\n\t},\n});\n","import jzczhz from \"../spaces/jzczhz.js\";\nimport getColor from \"../getColor.js\";\n\n// More accurate color-difference formulae\n// than the simple 1976 Euclidean distance in Lab\n\n// Uses JzCzHz, which has improved perceptual uniformity\n// and thus a simple Euclidean root-sum of ΔL² ΔC² ΔH²\n// gives good results.\n\nexport default function (color, sample) {\n\t[color, sample] = getColor([color, sample]);\n\n\t// Given this color as the reference\n\t// and a sample,\n\t// calculate deltaE in JzCzHz.\n\tlet [Jz1, Cz1, Hz1] = jzczhz.from(color);\n\tlet [Jz2, Cz2, Hz2] = jzczhz.from(sample);\n\n\t// Lightness and Chroma differences\n\t// sign does not matter as they are squared.\n\tlet ΔJ = Jz1 - Jz2;\n\tlet ΔC = Cz1 - Cz2;\n\n\t// length of chord for ΔH\n\tif ((Number.isNaN(Hz1)) && (Number.isNaN(Hz2))) {\n\t\t// both undefined hues\n\t\tHz1 = 0;\n\t\tHz2 = 0;\n\t}\n\telse if (Number.isNaN(Hz1)) {\n\t\t// one undefined, set to the defined hue\n\t\tHz1 = Hz2;\n\t}\n\telse if (Number.isNaN(Hz2)) {\n\t\tHz2 = Hz1;\n\t}\n\n\tlet Δh = Hz1 - Hz2;\n\tlet ΔH = 2 * Math.sqrt(Cz1 * Cz2) * Math.sin((Δh / 2) * (Math.PI / 180));\n\n\treturn Math.sqrt(ΔJ ** 2 + ΔC ** 2 + ΔH ** 2);\n}\n","import ColorSpace from \"../space.js\";\nimport {multiplyMatrices} from \"../util.js\";\nimport XYZ_Abs_D65 from \"./xyz-abs-d65.js\";\n\nconst c1 = 3424 / 4096;\nconst c2 = 2413 / 128;\nconst c3 = 2392 / 128;\nconst m1 = 2610 / 16384;\nconst m2 = 2523 / 32;\nconst im1 = 16384 / 2610;\nconst im2 = 32 / 2523;\n\n// The matrix below includes the 4% crosstalk components\n// and is from the Dolby \"What is ICtCp\" paper\"\nconst XYZtoLMS_M = [\n\t[  0.3592832590121217,  0.6976051147779502, -0.0358915932320290 ],\n\t[ -0.1920808463704993,  1.1004767970374321,  0.0753748658519118 ],\n\t[  0.0070797844607479,  0.0748396662186362,  0.8433265453898765 ],\n];\n// linear-light Rec.2020 to LMS, again with crosstalk\n// rational terms from Jan Fröhlich,\n// Encoding High Dynamic Range andWide Color Gamut Imagery, p.97\n// and ITU-R BT.2124-0 p.2\n/*\nconst Rec2020toLMS_M = [\n\t[ 1688 / 4096,  2146 / 4096,   262 / 4096 ],\n\t[  683 / 4096,  2951 / 4096,   462 / 4096 ],\n\t[   99 / 4096,   309 / 4096,  3688 / 4096 ]\n];\n*/\n// this includes the Ebner LMS coefficients,\n// the rotation, and the scaling to [-0.5,0.5] range\n// rational terms from Fröhlich p.97\n// and ITU-R BT.2124-0 pp.2-3\nconst LMStoIPT_M = [\n\t[  2048 / 4096,   2048 / 4096,       0      ],\n\t[  6610 / 4096, -13613 / 4096,  7003 / 4096 ],\n\t[ 17933 / 4096, -17390 / 4096,  -543 / 4096 ],\n];\n\n// inverted matrices, calculated from the above\nconst IPTtoLMS_M = [\n\t[ 0.9999999999999998,  0.0086090370379328,  0.1110296250030260 ],\n\t[ 0.9999999999999998, -0.0086090370379328, -0.1110296250030259 ],\n\t[ 0.9999999999999998,  0.5600313357106791, -0.3206271749873188 ],\n];\n/*\nconst LMStoRec2020_M = [\n\t[ 3.4375568932814012112,   -2.5072112125095058195,   0.069654319228104608382],\n\t[-0.79142868665644156125,   1.9838372198740089874,  -0.19240853321756742626 ],\n\t[-0.025646662911506476363, -0.099240248643945566751, 1.1248869115554520431  ]\n];\n*/\nconst LMStoXYZ_M = [\n\t[  2.0701522183894223, -1.3263473389671563,  0.2066510476294053 ],\n\t[  0.3647385209748072,  0.6805660249472273, -0.0453045459220347 ],\n\t[ -0.0497472075358123, -0.0492609666966131,  1.1880659249923042 ],\n];\n\n// Only the PQ form of ICtCp is implemented here. There is also an HLG form.\n// from Dolby, \"WHAT IS ICTCP?\"\n// https://professional.dolby.com/siteassets/pdfs/ictcp_dolbywhitepaper_v071.pdf\n// and\n// Dolby, \"Perceptual Color Volume\n// Measuring the Distinguishable Colors of HDR and WCG Displays\"\n// https://professional.dolby.com/siteassets/pdfs/dolby-vision-measuring-perceptual-color-volume-v7.1.pdf\nexport default new ColorSpace({\n\tid: \"ictcp\",\n\tname: \"ICTCP\",\n\t// From BT.2100-2 page 7:\n\t// During production, signal values are expected to exceed the\n\t// range E′ = [0.0 : 1.0]. This provides processing headroom and avoids\n\t// signal degradation during cascaded processing. Such values of E′,\n\t// below 0.0 or exceeding 1.0, should not be clipped during production\n\t// and exchange.\n\t// Values below 0.0 should not be clipped in reference displays (even\n\t// though they represent “negative” light) to allow the black level of\n\t// the signal (LB) to be properly set using test signals known as “PLUGE”\n\tcoords: {\n\t\ti: {\n\t\t\trefRange: [0, 1],\t// Constant luminance,\n\t\t\tname: \"I\",\n\t\t},\n\t\tct: {\n\t\t\trefRange: [-0.5, 0.5],\t// Full BT.2020 gamut in range [-0.5, 0.5]\n\t\t\tname: \"CT\",\n\t\t},\n\t\tcp: {\n\t\t\trefRange: [-0.5, 0.5],\n\t\t\tname: \"CP\",\n\t\t},\n\t},\n\n\tbase: XYZ_Abs_D65,\n\tfromBase (XYZ) {\n\t\t// move to LMS cone domain\n\t\tlet LMS = multiplyMatrices(XYZtoLMS_M, XYZ);\n\n\t\treturn LMStoICtCp(LMS);\n\t},\n\ttoBase (ICtCp) {\n\t\tlet LMS = ICtCptoLMS(ICtCp);\n\n\t\treturn multiplyMatrices(LMStoXYZ_M, LMS);\n\t},\n});\n\nfunction LMStoICtCp (LMS) {\n\t// apply the PQ EOTF\n\t// we can't ever be dividing by zero because of the \"1 +\" in the denominator\n\tlet PQLMS = LMS.map (function (val) {\n\t\tlet num = c1 + (c2 * ((val / 10000) ** m1));\n\t\tlet denom = 1 + (c3 * ((val / 10000) ** m1));\n\n\t\treturn (num / denom)  ** m2;\n\t});\n\n\t// LMS to IPT, with rotation for Y'C'bC'r compatibility\n\treturn multiplyMatrices(LMStoIPT_M, PQLMS);\n}\n\nfunction ICtCptoLMS (ICtCp) {\n\tlet PQLMS = multiplyMatrices(IPTtoLMS_M, ICtCp);\n\n\t// From BT.2124-0 Annex 2 Conversion 3\n\tlet LMS = PQLMS.map (function (val) {\n\t\tlet num  = Math.max((val ** im2) - c1, 0);\n\t\tlet denom = (c2 - (c3 * (val ** im2)));\n\t\treturn 10000 * ((num / denom) ** im1);\n\t});\n\n\treturn LMS;\n}\n","import ictcp from \"../spaces/ictcp.js\";\nimport getColor from \"../getColor.js\";\n\n// Delta E in ICtCp space,\n// which the ITU calls Delta E ITP, which is shorter\n// formulae from ITU Rec. ITU-R BT.2124-0\n\nexport default function (color, sample) {\n\t[color, sample] = getColor([color, sample]);\n\n\t// Given this color as the reference\n\t// and a sample,\n\t// calculate deltaE in ICtCp\n\t// which is simply the Euclidean distance\n\n\tlet [ I1, T1, P1 ] = ictcp.from(color);\n\tlet [ I2, T2, P2 ] = ictcp.from(sample);\n\n\t// the 0.25 factor is to undo the encoding scaling in Ct\n\t// the 720 is so that 1 deltaE = 1 JND\n\t// per  ITU-R BT.2124-0 p.3\n\n\treturn 720 * Math.sqrt((I1 - I2) ** 2 + (0.25 * (T1 - T2) ** 2) + (P1 - P2) ** 2);\n}\n","import ColorSpace from \"../space.js\";\nimport {multiplyMatrices, interpolate, copySign, spow, zdiv, bisectLeft} from \"../util.js\";\nimport {constrain} from \"../angles.js\";\nimport xyz_d65 from \"./xyz-d65.js\";\nimport {WHITES} from \"../adapt.js\";\n\nconst white = WHITES.D65;\nconst adaptedCoef = 0.42;\nconst adaptedCoefInv = 1 / adaptedCoef;\nconst tau = 2 * Math.PI;\n\nconst cat16 = [\n\t[  0.401288,  0.650173, -0.051461 ],\n\t[ -0.250268,  1.204414,  0.045854 ],\n\t[ -0.002079,  0.048952,  0.953127 ],\n];\n\nconst cat16Inv = [\n\t[1.8620678550872327, -1.0112546305316843, 0.14918677544445175],\n\t[0.38752654323613717, 0.6214474419314753, -0.008973985167612518],\n\t[-0.015841498849333856, -0.03412293802851557, 1.0499644368778496],\n];\n\nconst m1 = [\n\t[460.0, 451.0, 288.0],\n\t[460.0, -891.0, -261.0],\n\t[460.0, -220.0, -6300.0],\n];\n\nconst surroundMap = {\n\tdark: [0.8, 0.525, 0.8],\n\tdim: [0.9, 0.59, 0.9],\n\taverage: [1, 0.69, 1],\n};\n\nconst hueQuadMap = {\n\t// Red, Yellow, Green, Blue, Red\n\th: [20.14, 90.00, 164.25, 237.53, 380.14],\n\te: [0.8, 0.7, 1.0, 1.2, 0.8],\n\tH: [0.0, 100.0, 200.0, 300.0, 400.0],\n};\n\nconst rad2deg = 180 / Math.PI;\nconst deg2rad = Math.PI / 180;\n\nexport function adapt (coords, fl) {\n\tconst temp = coords.map(c => {\n\t\tconst x = spow(fl * Math.abs(c) * 0.01, adaptedCoef);\n\t\treturn 400 * copySign(x, c) / (x + 27.13);\n\t});\n\treturn temp;\n}\n\nexport function unadapt (adapted, fl) {\n\tconst constant = 100 / fl * (27.13 ** adaptedCoefInv);\n\treturn adapted.map(c => {\n\t\tconst cabs = Math.abs(c);\n\t\treturn copySign(constant * spow(cabs / (400 - cabs), adaptedCoefInv), c);\n\t});\n}\n\nexport function hueQuadrature (h) {\n\tlet hp = constrain(h);\n\tif (hp <= hueQuadMap.h[0]) {\n\t\thp += 360;\n\t}\n\n\tconst i = bisectLeft(hueQuadMap.h, hp) - 1;\n\tconst [hi, hii] = hueQuadMap.h.slice(i, i + 2);\n\tconst [ei, eii] = hueQuadMap.e.slice(i, i + 2);\n\tconst Hi = hueQuadMap.H[i];\n\n\tconst t = (hp - hi) / ei;\n\treturn Hi + (100 * t) / (t + (hii - hp) / eii);\n}\n\nexport function invHueQuadrature (H) {\n\tlet Hp = ((H % 400 + 400) % 400);\n\tconst i = Math.floor(0.01 * Hp);\n\tHp = Hp % 100;\n\tconst [hi, hii] = hueQuadMap.h.slice(i, i + 2);\n\tconst [ei, eii] = hueQuadMap.e.slice(i, i + 2);\n\n\treturn constrain(\n\t\t(Hp * (eii * hi - ei * hii) - 100 * hi * eii) /\n\t\t(Hp * (eii - ei) - 100 * eii),\n\t);\n}\n\nexport function environment (\n\trefWhite,\n\tadaptingLuminance,\n\tbackgroundLuminance,\n\tsurround,\n\tdiscounting,\n) {\n\n\tconst env = {};\n\n\tenv.discounting = discounting;\n\tenv.refWhite = refWhite;\n\tenv.surround = surround;\n\tconst xyzW = refWhite.map(c => {\n\t\treturn c * 100;\n\t});\n\n\t// The average luminance of the environment in `cd/m^2cd/m` (a.k.a. nits)\n\tenv.la = adaptingLuminance;\n\t// The relative luminance of the nearby background\n\tenv.yb = backgroundLuminance;\n\t// Absolute luminance of the reference white.\n\tconst yw = xyzW[1];\n\n\t// Cone response for reference white\n\tconst rgbW = multiplyMatrices(cat16, xyzW);\n\n\t// Surround: dark, dim, and average\n\tsurround = surroundMap[env.surround];\n\tconst f = surround[0];\n\tenv.c = surround[1];\n\tenv.nc = surround[2];\n\n\tconst k = 1 / (5 * env.la + 1);\n\tconst k4 = k ** 4;\n\n\t// Factor of luminance level adaptation\n\tenv.fl = (k4 * env.la + 0.1 * (1 - k4) * (1 - k4) * Math.cbrt(5 * env.la));\n\tenv.flRoot = env.fl ** 0.25;\n\n\tenv.n = env.yb / yw;\n\tenv.z = 1.48 + Math.sqrt(env.n);\n\tenv.nbb = 0.725 * (env.n ** -0.2);\n\tenv.ncb = env.nbb;\n\n\t// Degree of adaptation calculating if not discounting\n\t// illuminant (assumed eye is fully adapted)\n\tconst d = (discounting) ?\n\t\t1 :\n\t\tMath.max(\n\t\t\tMath.min(f * (1 - 1 / 3.6 * Math.exp((-env.la - 42) / 92)), 1),\n\t\t\t0,\n\t\t);\n\tenv.dRgb = rgbW.map(c => {\n\t\treturn interpolate(1, yw / c, d);\n\t});\n\tenv.dRgbInv = env.dRgb.map(c => {\n\t\treturn 1 / c;\n\t});\n\n\t// Achromatic response\n\tconst rgbCW = rgbW.map((c, i) => {\n\t\treturn c * env.dRgb[i];\n\t});\n\tconst rgbAW = adapt(rgbCW, env.fl);\n\tenv.aW = env.nbb * (2 * rgbAW[0] + rgbAW[1] + 0.05 * rgbAW[2]);\n\n\t// console.log(env);\n\n\treturn env;\n}\n\n// Pre-calculate everything we can with the viewing conditions\nconst viewingConditions = environment(\n\twhite,\n\t64 / Math.PI * 0.2, 20,\n\t\"average\",\n\tfalse,\n);\n\nexport function fromCam16 (cam16, env) {\n\n\t// These check ensure one, and only one attribute for a\n\t// given category is provided.\n\tif (!((cam16.J !== undefined) ^ (cam16.Q !== undefined))) {\n\t\tthrow new Error(\"Conversion requires one and only one: 'J' or 'Q'\");\n\t}\n\n\tif (!((cam16.C !== undefined) ^ (cam16.M !== undefined) ^ (cam16.s !== undefined))) {\n\t\tthrow new Error(\"Conversion requires one and only one: 'C', 'M' or 's'\");\n\t}\n\n\t// Hue is absolutely required\n\tif (!((cam16.h !== undefined) ^ (cam16.H !== undefined))) {\n\t\tthrow new Error(\"Conversion requires one and only one: 'h' or 'H'\");\n\t}\n\n\t// Black\n\tif (cam16.J === 0.0 || cam16.Q === 0.0) {\n\t\treturn [0.0, 0.0, 0.0];\n\t}\n\n\t// Break hue into Cartesian components\n\tlet hRad = 0.0;\n\tif (cam16.h !== undefined) {\n\t\thRad = constrain(cam16.h) * deg2rad;\n\t}\n\telse {\n\t\thRad = invHueQuadrature(cam16.H) * deg2rad;\n\t}\n\n\tconst cosh = Math.cos(hRad);\n\tconst sinh = Math.sin(hRad);\n\n\t// Calculate `Jroot` from one of the lightness derived coordinates.\n\tlet Jroot = 0.0;\n\tif (cam16.J !== undefined) {\n\t\tJroot = spow(cam16.J, 1 / 2) * 0.1;\n\t}\n\telse if (cam16.Q !== undefined) {\n\t\tJroot = 0.25 * env.c * cam16.Q / ((env.aW + 4) * env.flRoot);\n\t}\n\n\t// Calculate the `t` value from one of the chroma derived coordinates\n\tlet alpha = 0.0;\n\tif (cam16.C !== undefined) {\n\t\talpha = cam16.C / Jroot;\n\t}\n\telse if (cam16.M !== undefined) {\n\t\talpha = (cam16.M / env.flRoot) / Jroot;\n\t}\n\telse if (cam16.s !== undefined) {\n\t\talpha = 0.0004 * (cam16.s ** 2) * (env.aW + 4) / env.c;\n\t}\n\tconst t = spow(\n\t\talpha * Math.pow(1.64 - Math.pow(0.29, env.n), -0.73),\n\t\t10 / 9,\n\t);\n\n\t// Eccentricity\n\tconst et = 0.25 * (Math.cos(hRad + 2) + 3.8);\n\n\t// Achromatic response\n\tconst A = env.aW * spow(Jroot, 2 / env.c / env.z);\n\n\t// Calculate red-green and yellow-blue components\n\tconst p1 = 5e4 / 13 * env.nc * env.ncb * et;\n\tconst p2 = A / env.nbb;\n\tconst r = (\n\t\t23 * (p2 + 0.305) *\n\t\tzdiv(t, 23 * p1 + t * (11 * cosh + 108 * sinh))\n\t);\n\tconst a = r * cosh;\n\tconst b = r * sinh;\n\n\t// Calculate back from cone response to XYZ\n\tconst rgb_c = unadapt(\n\t\tmultiplyMatrices(m1, [p2, a, b]).map(c => {\n\t\t\treturn c * 1 / 1403;\n\t\t}),\n\t\tenv.fl,\n\t);\n\treturn multiplyMatrices(\n\t\tcat16Inv,\n\t\trgb_c.map((c, i) => {\n\t\t\treturn c * env.dRgbInv[i];\n\t\t}),\n\t).map(c => {\n\t\treturn c / 100;\n\t});\n}\n\n\nexport function toCam16 (xyzd65, env) {\n\t// Cone response\n\tconst xyz100 = xyzd65.map(c => {\n\t\treturn c * 100;\n\t});\n\tconst rgbA = adapt(\n\t\tmultiplyMatrices(cat16, xyz100).map((c, i) => {\n\t\t\treturn c * env.dRgb[i];\n\t\t}),\n\t\tenv.fl,\n\t);\n\n\t// Calculate hue from red-green and yellow-blue components\n\tconst a = rgbA[0] + (-12 * rgbA[1] + rgbA[2]) / 11;\n\tconst b = (rgbA[0] + rgbA[1] - 2 * rgbA[2]) / 9;\n\tconst hRad = ((Math.atan2(b, a) % tau) + tau) % tau;\n\n\t// Eccentricity\n\tconst et = 0.25 * (Math.cos(hRad + 2) + 3.8);\n\n\tconst t = (\n\t\t5e4 / 13 * env.nc * env.ncb *\n\t\tzdiv(\n\t\t\tet * Math.sqrt(a ** 2 + b ** 2),\n\t\t\trgbA[0] + rgbA[1] + 1.05 * rgbA[2] + 0.305,\n\t\t)\n\t);\n\tconst alpha = spow(t, 0.9) * Math.pow(1.64 - Math.pow(0.29, env.n), 0.73);\n\n\t// Achromatic response\n\tconst A = env.nbb * (2 * rgbA[0] + rgbA[1] + 0.05 * rgbA[2]);\n\n\tconst Jroot = spow(A / env.aW, 0.5 * env.c * env.z);\n\n\t// Lightness\n\tconst J = 100 * spow(Jroot, 2);\n\n\t// Brightness\n\tconst Q = (4 / env.c * Jroot * (env.aW + 4) * env.flRoot);\n\n\t// Chroma\n\tconst C = alpha * Jroot;\n\n\t// Colorfulness\n\tconst M = C * env.flRoot;\n\n\t// Hue\n\tconst h = constrain(hRad * rad2deg);\n\n\t// Hue quadrature\n\tconst H = hueQuadrature(h);\n\n\t// Saturation\n\tconst s = 50 * spow(env.c * alpha / (env.aW + 4), 1 / 2);\n\n\t// console.log({J: J, C: C, h: h, s: s, Q: Q, M: M, H: H});\n\n\treturn {J: J, C: C, h: h, s: s, Q: Q, M: M, H: H};\n}\n\n\n// Provided as a way to directly evaluate the CAM16 model\n// https://observablehq.com/@jrus/cam16: reference implementation\n// https://arxiv.org/pdf/1802.06067.pdf: Nico Schlömer\n// https://onlinelibrary.wiley.com/doi/pdf/10.1002/col.22324: hue quadrature\n// https://www.researchgate.net/publication/318152296_Comprehensive_color_solutions_CAM16_CAT16_and_CAM16-UCS\n// Results compared against: https://github.com/colour-science/colour\nexport default new ColorSpace({\n\tid: \"cam16-jmh\",\n\tcssId: \"--cam16-jmh\",\n\tname: \"CAM16-JMh\",\n\tcoords: {\n\t\tj: {\n\t\t\trefRange: [0, 100],\n\t\t\tname: \"J\",\n\t\t},\n\t\tm: {\n\t\t\trefRange: [0, 105.0],\n\t\t\tname: \"Colorfulness\",\n\t\t},\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t},\n\n\tbase: xyz_d65,\n\n\tfromBase (xyz) {\n\t\tconst cam16 = toCam16(xyz, viewingConditions);\n\t\treturn [cam16.J, cam16.M, cam16.h];\n\t},\n\ttoBase (cam16) {\n\t\treturn fromCam16(\n\t\t\t{J: cam16[0], M: cam16[1], h: cam16[2]},\n\t\t\tviewingConditions,\n\t\t);\n\t},\n});\n","import ColorSpace from \"../space.js\";\nimport {constrain} from \"../angles.js\";\nimport xyz_d65 from \"./xyz-d65.js\";\nimport {fromCam16, toCam16, environment} from \"./cam16.js\";\nimport {WHITES} from \"../adapt.js\";\n\nconst white = WHITES.D65;\nconst ε = 216 / 24389;  // 6^3/29^3 == (24/116)^3\nconst κ = 24389 / 27;   // 29^3/3^3\n\nfunction toLstar (y) {\n\t// Convert XYZ Y to L*\n\n\tconst fy = (y > ε) ? Math.cbrt(y) : (κ * y + 16) / 116;\n\treturn (116.0 * fy) - 16.0;\n}\n\nfunction fromLstar (lstar) {\n\t// Convert L* back to XYZ Y\n\n\treturn (lstar > 8) ?  Math.pow((lstar + 16) / 116, 3) : lstar / κ;\n}\n\nfunction fromHct (coords, env) {\n\t// Use Newton's method to try and converge as quick as possible or\n\t// converge as close as we can. While the requested precision is achieved\n\t// most of the time, it may not always be achievable. Especially past the\n\t// visible spectrum, the algorithm will likely struggle to get the same\n\t// precision. If, for whatever reason, we cannot achieve the accuracy we\n\t// seek in the allotted iterations, just return the closest we were able to\n\t// get.\n\n\tlet [h, c, t] = coords;\n\tlet xyz = [];\n\tlet j = 0;\n\n\t// Shortcut out for black\n\tif (t === 0) {\n\t\treturn [0.0, 0.0, 0.0];\n\t}\n\n\t// Calculate the Y we need to target\n\tlet y = fromLstar(t);\n\n\t// A better initial guess yields better results. Polynomials come from\n\t// curve fitting the T vs J response.\n\tif (t > 0) {\n\t\tj = 0.00379058511492914 * t ** 2 + 0.608983189401032 * t + 0.9155088574762233;\n\t}\n\telse {\n\t\tj = 9.514440756550361e-06 * t ** 2 + 0.08693057439788597 * t - 21.928975842194614;\n\t}\n\n\t// Threshold of how close is close enough, and max number of attempts.\n\t// More precision and more attempts means more time spent iterating. Higher\n\t// required precision gives more accuracy but also increases the chance of\n\t// not hitting the goal. 2e-12 allows us to convert round trip with\n\t// reasonable accuracy of six decimal places or more.\n\tconst threshold = 2e-12;\n\tconst max_attempts = 15;\n\n\tlet attempt = 0;\n\tlet last = Infinity;\n\tlet best = j;\n\n\t// Try to find a J such that the returned y matches the returned y of the L*\n\twhile (attempt <= max_attempts) {\n\t\txyz = fromCam16({J: j, C: c, h: h}, env);\n\n\t\t// If we are within range, return XYZ\n\t\t// If we are closer than last time, save the values\n\t\tconst delta = Math.abs(xyz[1] - y);\n\t\tif (delta < last) {\n\t\t\tif (delta <= threshold) {\n\t\t\t\treturn xyz;\n\t\t\t}\n\t\t\tbest = j;\n\t\t\tlast = delta;\n\t\t}\n\n\t\t// f(j_root) = (j ** (1 / 2)) * 0.1\n\t\t// f(j) = ((f(j_root) * 100) ** 2) / j - 1 = 0\n\t\t// f(j_root) = Y = y / 100\n\t\t// f(j) = (y ** 2) / j - 1\n\t\t// f'(j) = (2 * y) / j\n\t\tj = j - (xyz[1] - y) * j / (2 * xyz[1]);\n\n\t\tattempt += 1;\n\t}\n\n\t// We could not acquire the precision we desired,\n\t// return our closest attempt.\n\treturn fromCam16({J: j, C: c, h: h}, env);\n}\n\nfunction toHct (xyz, env) {\n\t// Calculate HCT by taking the L* of CIE LCh D65 and CAM16 chroma and hue.\n\n\tconst t = toLstar(xyz[1]);\n\tif (t === 0.0) {\n\t\treturn [0.0, 0.0, 0.0];\n\t}\n\tconst cam16 = toCam16(xyz, viewingConditions);\n\treturn [constrain(cam16.h), cam16.C, t];\n}\n\n// Pre-calculate everything we can with the viewing conditions\nexport const viewingConditions = environment(\n\twhite, 200 / Math.PI * fromLstar(50.0),\n\tfromLstar(50.0) * 100,\n\t\"average\",\n\tfalse,\n);\n\n// https://material.io/blog/science-of-color-design\n// This is not a port of the material-color-utilities,\n// but instead implements the full color space as described,\n// combining CAM16 JCh and Lab D65. This does not clamp conversion\n// to HCT to specific chroma bands and provides support for wider\n// gamuts than Google currently supports and does so at a greater\n// precision (> 8 bits back to sRGB).\n// This implementation comes from https://github.com/facelessuser/coloraide\n// which is licensed under MIT.\nexport default new ColorSpace({\n\tid: \"hct\",\n\tname: \"HCT\",\n\tcoords: {\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t\tc: {\n\t\t\trefRange: [0, 145],\n\t\t\tname: \"Colorfulness\",\n\t\t},\n\t\tt: {\n\t\t\trefRange: [0, 100],\n\t\t\tname: \"Tone\",\n\t\t},\n\t},\n\n\tbase: xyz_d65,\n\n\tfromBase (xyz) {\n\t\treturn toHct(xyz, viewingConditions);\n\t},\n\ttoBase (hct) {\n\t\treturn fromHct(hct, viewingConditions);\n\t},\n\tformats: {\n\t\tcolor: {\n\t\t\tid: \"--hct\",\n\t\t\tcoords: [\"<number> | <angle>\", \"<percentage> | <number>\", \"<percentage> | <number>\"],\n\t\t},\n\t},\n});\n","import hct from \"../spaces/hct.js\";\nimport {viewingConditions} from \"../spaces/hct.js\";\nimport getColor from \"../getColor.js\";\n\nconst rad2deg = 180 / Math.PI;\nconst deg2rad = Math.PI / 180;\nconst ucsCoeff = [1.00, 0.007, 0.0228];\n\n/**\n* Convert HCT chroma and hue (CAM16 JMh colorfulness and hue) using UCS logic for a and b.\n* @param {number[]} coords - HCT coordinates.\n* @return {number[]}\n*/\nfunction convertUcsAb (coords) {\n\t// We want the distance between the actual color.\n\t// If chroma is negative, it will throw off our calculations.\n\t// Normally, converting back to the base and forward will correct it.\n\t// If we have a negative chroma after this, then we have a color that\n\t// cannot resolve to positive chroma.\n\tif (coords[1] < 0) {\n\t\tcoords = hct.fromBase(hct.toBase(coords));\n\t}\n\n\t// Only in extreme cases (usually outside the visible spectrum)\n\t// can the input value for log become negative.\n\t// Avoid domain error by forcing a zero result via \"max\" if necessary.\n\tconst M = Math.log(Math.max(1 + ucsCoeff[2] * coords[1] * viewingConditions.flRoot, 1.0)) / ucsCoeff[2];\n\tconst hrad = coords[0] * deg2rad;\n\tconst a = M * Math.cos(hrad);\n\tconst b = M * Math.sin(hrad);\n\n\treturn [coords[2], a, b];\n}\n\n\n/**\n* Color distance using HCT.\n* @param {Color} color - Color to compare.\n* @param {Color} sample - Color to compare.\n* @return {number[]}\n*/\nexport default function (color, sample) {\n\t[color, sample] = getColor([color, sample]);\n\n\tlet [ t1, a1, b1 ] = convertUcsAb(hct.from(color));\n\tlet [ t2, a2, b2 ] = convertUcsAb(hct.from(sample));\n\n\t// Use simple euclidean distance with a and b using UCS conversion\n\t// and LCh lightness (HCT tone).\n\treturn Math.sqrt((t1 - t2) ** 2 + (a1 - a2) ** 2 + (b1 - b2) ** 2);\n}\n","import deltaE76 from \"./deltaE76.js\";\nimport deltaECMC from \"./deltaECMC.js\";\nimport deltaE2000 from \"./deltaE2000.js\";\nimport deltaEJz from \"./deltaEJz.js\";\nimport deltaEITP from \"./deltaEITP.js\";\nimport deltaEOK from \"./deltaEOK.js\";\nimport deltaEHCT from \"./deltaEHCT.js\";\n\nexport {\n\tdeltaE76,\n\tdeltaECMC,\n\tdeltaE2000,\n\tdeltaEJz,\n\tdeltaEITP,\n\tdeltaEOK,\n\tdeltaEHCT,\n};\n\nexport default {\n\tdeltaE76,\n\tdeltaECMC,\n\tdeltaE2000,\n\tdeltaEJz,\n\tdeltaEITP,\n\tdeltaEOK,\n\tdeltaEHCT,\n};\n","import * as util from \"./util.js\";\nimport ColorSpace from \"./space.js\";\nimport defaults from \"./defaults.js\";\nimport deltaE2000 from \"./deltaE/deltaE2000.js\";\nimport deltaEOK from \"./deltaE/deltaEOK.js\";\nimport inGamut from \"./inGamut.js\";\nimport to from \"./to.js\";\nimport get from \"./get.js\";\nimport oklab from \"./spaces/oklab.js\";\nimport set from \"./set.js\";\nimport clone from \"./clone.js\";\nimport getColor from \"./getColor.js\";\nimport deltaEMethods from \"./deltaE/index.js\";\nimport {WHITES} from \"./adapt.js\";\n\n/**\n * Calculate the epsilon to 2 degrees smaller than the specified JND.\n * @param {Number} jnd - The target \"just noticeable difference\".\n * @returns {Number}\n */\nfunction calcEpsilon (jnd) {\n\t// Calculate the epsilon to 2 degrees smaller than the specified JND.\n\n\tconst order = (!jnd) ? 0 : Math.floor(Math.log10(Math.abs(jnd)));\n\t// Limit to an arbitrary value to ensure value is never too small and causes infinite loops.\n\treturn Math.max(parseFloat(`1e${order - 2}`), 1e-6);\n}\n\nconst GMAPPRESET = {\n\t\"hct\": {\n\t\tmethod: \"hct.c\",\n\t\tjnd: 2,\n\t\tdeltaEMethod: \"hct\",\n\t\tblackWhiteClamp: {},\n\t},\n\t\"hct-tonal\": {\n\t\tmethod: \"hct.c\",\n\t\tjnd: 0,\n\t\tdeltaEMethod: \"hct\",\n\t\tblackWhiteClamp: { channel: \"hct.t\", min: 0, max: 100 },\n\t},\n};\n\n/**\n * Force coordinates to be in gamut of a certain color space.\n * Mutates the color it is passed.\n * @param {Object|string} options object or spaceId string\n * @param {string} options.method - How to force into gamut.\n *        If \"clip\", coordinates are just clipped to their reference range.\n *        If \"css\", coordinates are reduced according to the CSS 4 Gamut Mapping Algorithm.\n *        If in the form [colorSpaceId].[coordName], that coordinate is reduced\n *        until the color is in gamut. Please note that this may produce nonsensical\n *        results for certain coordinates (e.g. hue) or infinite loops if reducing the coordinate never brings the color in gamut.\n * @param {ColorSpace|string} options.space - The space whose gamut we want to map to\n * @param {string} options.deltaEMethod - The delta E method to use while performing gamut mapping.\n *        If no method is specified, delta E 2000 is used.\n * @param {Number} options.jnd - The \"just noticeable difference\" to target.\n * @param {Object} options.blackWhiteClamp - Used to configure SDR black and clamping.\n *        \"channel\" indicates the \"space.channel\" to use for determining when to clamp.\n *        \"min\" indicates the lower limit for black clamping and \"max\" indicates the upper\n *        limit for white clamping.\n */\n\nexport default function toGamut (\n\tcolor,\n\t{\n\t\tmethod = defaults.gamut_mapping,\n\t\tspace = undefined,\n\t\tdeltaEMethod = \"\",\n\t\tjnd = 2,\n\t\tblackWhiteClamp = {},\n\t} = {},\n) {\n\tcolor = getColor(color);\n\n\tif (util.isString(arguments[1])) {\n\t\tspace = arguments[1];\n\t}\n\telse if (!space) {\n\t\tspace = color.space;\n\t}\n\n\tspace = ColorSpace.get(space);\n\n\t// 3 spaces:\n\t// color.space: current color space\n\t// space: space whose gamut we are mapping to\n\t// mapSpace: space with the coord we're reducing\n\n\tif (inGamut(color, space, { epsilon: 0 })) {\n\t\treturn color;\n\t}\n\n\tlet spaceColor;\n\tif (method === \"css\") {\n\t\tspaceColor = toGamutCSS(color, { space });\n\t}\n\telse {\n\t\tif (method !== \"clip\" && !inGamut(color, space)) {\n\n\t\t\tif (Object.prototype.hasOwnProperty.call(GMAPPRESET, method)) {\n\t\t\t\t({method, jnd, deltaEMethod, blackWhiteClamp} = GMAPPRESET[method]);\n\t\t\t}\n\n\t\t\t// Get the correct delta E method\n\t\t\tlet de = deltaE2000;\n\t\t\tif (deltaEMethod !== \"\") {\n\t\t\t\tfor (let m in deltaEMethods) {\n\t\t\t\t\tif (\"deltae\" + deltaEMethod.toLowerCase() === m.toLowerCase()) {\n\t\t\t\t\t\tde = deltaEMethods[m];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet clipped = toGamut(to(color, space), { method: \"clip\", space });\n\t\t\tif (de(color, clipped) > jnd) {\n\n\t\t\t\t// Clamp to SDR white and black if required\n\t\t\t\tif (Object.keys(blackWhiteClamp).length === 3) {\n\t\t\t\t\tlet channelMeta = ColorSpace.resolveCoord(blackWhiteClamp.channel);\n\t\t\t\t\tlet channel = get(to(color, channelMeta.space), channelMeta.id);\n\t\t\t\t\tif (util.isNone(channel)) {\n\t\t\t\t\t\tchannel = 0;\n\t\t\t\t\t}\n\t\t\t\t\tif (channel >= blackWhiteClamp.max) {\n\t\t\t\t\t\treturn to({ space: \"xyz-d65\", coords: WHITES[\"D65\"] }, color.space);\n\t\t\t\t\t}\n\t\t\t\t\telse if (channel <= blackWhiteClamp.min) {\n\t\t\t\t\t\treturn to({ space: \"xyz-d65\", coords: [0, 0, 0] }, color.space);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Reduce a coordinate of a certain color space until the color is in gamut\n\t\t\t\tlet coordMeta = ColorSpace.resolveCoord(method);\n\t\t\t\tlet mapSpace = coordMeta.space;\n\t\t\t\tlet coordId = coordMeta.id;\n\n\t\t\t\tlet mappedColor = to(color, mapSpace);\n\t\t\t\t// If we were already in the mapped color space, we need to resolve undefined channels\n\t\t\t\tmappedColor.coords.forEach((c, i) => {\n\t\t\t\t\tif (util.isNone(c)) {\n\t\t\t\t\t\tmappedColor.coords[i] = 0;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tlet bounds = coordMeta.range || coordMeta.refRange;\n\t\t\t\tlet min = bounds[0];\n\t\t\t\tlet ε = calcEpsilon(jnd);\n\t\t\t\tlet low = min;\n\t\t\t\tlet high = get(mappedColor, coordId);\n\n\t\t\t\twhile (high - low > ε) {\n\t\t\t\t\tlet clipped = clone(mappedColor);\n\t\t\t\t\tclipped = toGamut(clipped, { space, method: \"clip\" });\n\t\t\t\t\tlet deltaE = de(mappedColor, clipped);\n\n\t\t\t\t\tif (deltaE - jnd < ε) {\n\t\t\t\t\t\tlow = get(mappedColor, coordId);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\thigh = get(mappedColor, coordId);\n\t\t\t\t\t}\n\n\t\t\t\t\tset(mappedColor, coordId, (low + high) / 2);\n\t\t\t\t}\n\n\t\t\t\tspaceColor = to(mappedColor, space);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tspaceColor = clipped;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tspaceColor = to(color, space);\n\t\t}\n\n\t\tif (method === \"clip\" // Dumb coord clipping\n\t\t\t// finish off smarter gamut mapping with clip to get rid of ε, see #17\n\t\t\t|| !inGamut(spaceColor, space, { epsilon: 0 })\n\t\t) {\n\t\t\tlet bounds = Object.values(space.coords).map(c => c.range || []);\n\n\t\t\tspaceColor.coords = spaceColor.coords.map((c, i) => {\n\t\t\t\tlet [min, max] = bounds[i];\n\n\t\t\t\tif (min !== undefined) {\n\t\t\t\t\tc = Math.max(min, c);\n\t\t\t\t}\n\n\t\t\t\tif (max !== undefined) {\n\t\t\t\t\tc = Math.min(c, max);\n\t\t\t\t}\n\n\t\t\t\treturn c;\n\t\t\t});\n\t\t}\n\t}\n\n\tif (space !== color.space) {\n\t\tspaceColor = to(spaceColor, color.space);\n\t}\n\n\tcolor.coords = spaceColor.coords;\n\treturn color;\n}\n\ntoGamut.returns = \"color\";\n\n// The reference colors to be used if lightness is out of the range 0-1 in the\n// `Oklch` space. These are created in the `Oklab` space, as it is used by the\n// DeltaEOK calculation, so it is guaranteed to be imported.\nconst COLORS = {\n\tWHITE: { space: oklab, coords: [1, 0, 0] },\n\tBLACK: { space: oklab, coords: [0, 0, 0] },\n};\n\n/**\n * Given a color `origin`, returns a new color that is in gamut using\n * the CSS Gamut Mapping Algorithm. If `space` is specified, it will be in gamut\n * in `space`, and returned in `space`. Otherwise, it will be in gamut and\n * returned in the color space of `origin`.\n * @param {Object} origin\n * @param {Object} options\n * @param {ColorSpace|string} options.space\n * @returns {Color}\n */\nexport function toGamutCSS (origin, {space} = {}) {\n\tconst JND = 0.02;\n\tconst ε = 0.0001;\n\n\torigin = getColor(origin);\n\n\tif (!space) {\n\t\tspace = origin.space;\n\t}\n\n\tspace = ColorSpace.get(space);\n\tconst oklchSpace = ColorSpace.get(\"oklch\");\n\n\tif (space.isUnbounded) {\n\t\treturn to(origin, space);\n\t}\n\n\tconst origin_OKLCH = to(origin, oklchSpace);\n\tlet L = origin_OKLCH.coords[0];\n\n\t// return media white or black, if lightness is out of range\n\tif (L >= 1) {\n\t\tconst white = to(COLORS.WHITE, space);\n\t\twhite.alpha = origin.alpha;\n\t\treturn to(white, space);\n\t}\n\tif (L <= 0) {\n\t\tconst black = to(COLORS.BLACK, space);\n\t\tblack.alpha = origin.alpha;\n\t\treturn to(black, space);\n\t}\n\n\tif (inGamut(origin_OKLCH, space, {epsilon: 0})) {\n\t\treturn to(origin_OKLCH, space);\n\t}\n\n\tfunction clip (_color) {\n\t\tconst destColor = to(_color, space);\n\t\tconst spaceCoords = Object.values(space.coords);\n\t\tdestColor.coords = destColor.coords.map((coord, index) => {\n\t\t\tif (\"range\" in spaceCoords[index]) {\n\t\t\t\tconst [min, max] =  spaceCoords[index].range;\n\t\t\t\treturn util.clamp(min, coord, max);\n\t\t\t}\n\t\t\treturn coord;\n\t\t});\n\t\treturn destColor;\n\t}\n\tlet min = 0;\n\tlet max = origin_OKLCH.coords[1];\n\tlet min_inGamut = true;\n\tlet current = clone(origin_OKLCH);\n\tlet clipped = clip(current);\n\n\tlet E = deltaEOK(clipped, current);\n\tif (E < JND) {\n\t\treturn clipped;\n\t}\n\n\twhile ((max - min) > ε) {\n\t\tconst chroma = (min + max) / 2;\n\t\tcurrent.coords[1] = chroma;\n\t\tif (min_inGamut && inGamut(current, space, {epsilon: 0})) {\n\t\t\tmin = chroma;\n\t\t}\n\t\telse {\n\t\t\tclipped = clip(current);\n\t\t\tE = deltaEOK(clipped, current);\n\t\t\tif (E < JND) {\n\t\t\t\tif ((JND - E < ε)) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tmin_inGamut = false;\n\t\t\t\t\tmin = chroma;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tmax = chroma;\n\t\t\t}\n\t\t}\n\t}\n\treturn clipped;\n}\n","import getColor from \"./getColor.js\";\nimport ColorSpace from \"./space.js\";\nimport toGamut from \"./toGamut.js\";\n\n/**\n * Convert to color space and return a new color\n * @param {Object|string} space - Color space object or id\n * @param {Object} options\n * @param {boolean} options.inGamut - Whether to force resulting color in gamut\n * @returns {Color}\n */\nexport default function to (color, space, {inGamut} = {}) {\n\tcolor = getColor(color);\n\tspace = ColorSpace.get(space);\n\n\tlet coords = space.from(color);\n\tlet ret = {space, coords, alpha: color.alpha};\n\n\tif (inGamut) {\n\t\tret = toGamut(ret, inGamut === true ? undefined : inGamut);\n\t}\n\n\treturn ret;\n}\n\nto.returns = \"color\";\n","import * as util from \"./util.js\";\nimport ColorSpace from \"./space.js\";\nimport defaults from \"./defaults.js\";\nimport getColor from \"./getColor.js\";\nimport checkInGamut from \"./inGamut.js\";\nimport toGamut from \"./toGamut.js\";\nimport clone from \"./clone.js\";\n\n/**\n * Generic toString() method, outputs a color(spaceId ...coords) function, a functional syntax, or custom formats defined by the color space\n * @param {Object} options\n * @param {number} options.precision - Significant digits\n * @param {boolean} options.inGamut - Adjust coordinates to fit in gamut first? [default: false]\n */\nexport default function serialize (color, {\n\tprecision = defaults.precision,\n\tformat = \"default\",\n\tinGamut = true,\n\t...customOptions\n} = {}) {\n\tlet ret;\n\n\tcolor = getColor(color);\n\n\tlet formatId = format;\n\tformat = color.space.getFormat(format)\n\t       ?? color.space.getFormat(\"default\")\n\t       ?? ColorSpace.DEFAULT_FORMAT;\n\n\t// The assignment to coords and inGamut needs to stay in the order they are now\n\t// The order of the assignment was changed as a workaround for a bug in Next.js\n\t// See this issue for details: https://github.com/color-js/color.js/issues/260\n\n\tlet coords = color.coords.slice(); // clone so we can manipulate it\n\n\tinGamut ||= format.toGamut;\n\n\tif (inGamut && !checkInGamut(color)) {\n\t\t// FIXME what happens if the color contains NaNs?\n\t\tcoords = toGamut(clone(color), inGamut === true ? undefined : inGamut).coords;\n\t}\n\n\tif (format.type === \"custom\") {\n\t\tcustomOptions.precision = precision;\n\n\t\tif (format.serialize) {\n\t\t\tret = format.serialize(coords, color.alpha, customOptions);\n\t\t}\n\t\telse {\n\t\t\tthrow new TypeError(`format ${formatId} can only be used to parse colors, not for serialization`);\n\t\t}\n\t}\n\telse {\n\t\t// Functional syntax\n\t\tlet name = format.name || \"color\";\n\n\t\tif (format.serializeCoords) {\n\t\t\tcoords = format.serializeCoords(coords, precision);\n\t\t}\n\t\telse {\n\t\t\tif (precision !== null) {\n\t\t\t\tcoords = coords.map(c => {\n\t\t\t\t\treturn util.serializeNumber(c, {precision});\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tlet args = [...coords];\n\n\t\tif (name === \"color\") {\n\t\t\t// If output is a color() function, add colorspace id as first argument\n\t\t\tlet cssId = format.id || format.ids?.[0] || color.space.id;\n\t\t\targs.unshift(cssId);\n\t\t}\n\n\t\tlet alpha = color.alpha;\n\t\tif (precision !== null) {\n\t\t\talpha = util.serializeNumber(alpha, {precision});\n\t\t}\n\n\t\tlet strAlpha = color.alpha >= 1 || format.noAlpha ? \"\" : `${format.commas ? \",\" : \" /\"} ${alpha}`;\n\t\tret = `${name}(${args.join(format.commas ? \", \" : \" \")}${strAlpha})`;\n\t}\n\n\treturn ret;\n}\n","import RGBColorSpace from \"../rgbspace.js\";\n\n// convert an array of linear-light rec2020 values to CIE XYZ\n// using  D65 (no chromatic adaptation)\n// http://www.brucelindbloom.com/index.html?Eqn_RGB_XYZ_Matrix.html\n// 0 is actually calculated as  4.994106574466076e-17\nconst toXYZ_M = [\n\t[ 0.6369580483012914, 0.14461690358620832,  0.1688809751641721  ],\n\t[ 0.2627002120112671, 0.6779980715188708,   0.05930171646986196 ],\n\t[ 0.000000000000000,  0.028072693049087428, 1.060985057710791   ],\n];\n\n// from ITU-R BT.2124-0 Annex 2 p.3\nconst fromXYZ_M = [\n\t[  1.716651187971268,  -0.355670783776392, -0.253366281373660  ],\n\t[ -0.666684351832489,   1.616481236634939,  0.0157685458139111 ],\n\t[  0.017639857445311,  -0.042770613257809,  0.942103121235474  ],\n];\n\nexport default new RGBColorSpace({\n\tid: \"rec2020-linear\",\n\tcssId: \"--rec2020-linear\",\n\tname: \"Linear REC.2020\",\n\twhite: \"D65\",\n\ttoXYZ_M,\n\tfromXYZ_M,\n});\n","import RGBColorSpace from \"../rgbspace.js\";\nimport REC2020Linear from \"./rec2020-linear.js\";\n// import sRGB from \"./srgb.js\";\n\nconst α = 1.09929682680944;\nconst β = 0.018053968510807;\n\nexport default new RGBColorSpace({\n\tid: \"rec2020\",\n\tname: \"REC.2020\",\n\tbase: REC2020Linear,\n\t// Non-linear transfer function from Rec. ITU-R BT.2020-2 table 4\n\ttoBase (RGB) {\n\t\treturn RGB.map(function (val) {\n\t\t\tif (val < β * 4.5) {\n\t\t\t\treturn val / 4.5;\n\t\t\t}\n\n\t\t\treturn Math.pow((val + α - 1) / α, 1 / 0.45);\n\t\t});\n\t},\n\tfromBase (RGB) {\n\t\treturn RGB.map(function (val) {\n\t\t\tif (val >= β) {\n\t\t\t\treturn α * Math.pow(val, 0.45) - (α - 1);\n\t\t\t}\n\n\t\t\treturn 4.5 * val;\n\t\t});\n\t},\n});\n","import RGBColorSpace from \"../rgbspace.js\";\n\nconst toXYZ_M = [\n\t[0.4865709486482162, 0.26566769316909306, 0.1982172852343625],\n\t[0.2289745640697488, 0.6917385218365064,  0.079286914093745],\n\t[0.0000000000000000, 0.04511338185890264, 1.043944368900976],\n];\n\nconst fromXYZ_M = [\n\t[ 2.493496911941425,   -0.9313836179191239, -0.40271078445071684],\n\t[-0.8294889695615747,   1.7626640603183463,  0.023624685841943577],\n\t[ 0.03584583024378447, -0.07617238926804182, 0.9568845240076872],\n];\n\nexport default new RGBColorSpace({\n\tid: \"p3-linear\",\n\tcssId: \"--display-p3-linear\",\n\tname: \"Linear P3\",\n\twhite: \"D65\",\n\ttoXYZ_M,\n\tfromXYZ_M,\n});\n","import RGBColorSpace from \"../rgbspace.js\";\n\n// This is the linear-light version of sRGB\n// as used for example in SVG filters\n// or in Canvas\n\n// This matrix was calculated directly from the RGB and white chromaticities\n// when rounded to 8 decimal places, it agrees completely with the official matrix\n// see https://github.com/w3c/csswg-drafts/issues/5922\nconst toXYZ_M = [\n\t[ 0.41239079926595934, 0.357584339383878,   0.1804807884018343  ],\n\t[ 0.21263900587151027, 0.715168678767756,   0.07219231536073371 ],\n\t[ 0.01933081871559182, 0.11919477979462598, 0.9505321522496607  ],\n];\n\n// This matrix is the inverse of the above;\n// again it agrees with the official definition when rounded to 8 decimal places\nexport const fromXYZ_M = [\n\t[  3.2409699419045226,  -1.537383177570094,   -0.4986107602930034  ],\n\t[ -0.9692436362808796,   1.8759675015077202,   0.04155505740717559 ],\n\t[  0.05563007969699366, -0.20397695888897652,  1.0569715142428786  ],\n];\n\nexport default new RGBColorSpace({\n\tid: \"srgb-linear\",\n\tname: \"Linear sRGB\",\n\twhite: \"D65\",\n\ttoXYZ_M,\n\tfromXYZ_M,\n});\n","/* List of CSS color keywords\n * Note that this does not include currentColor, transparent,\n * or system colors\n */\n\n// To produce: Visit https://www.w3.org/TR/css-color-4/#named-colors\n// and run in the console:\n// copy($$(\"tr\", $(\".named-color-table tbody\")).map(tr => `\"${tr.cells[2].textContent.trim()}\": [${tr.cells[4].textContent.trim().split(/\\s+/).map(c => c === \"0\"? \"0\" : c === \"255\"? \"1\" : c + \" / 255\").join(\", \")}]`).join(\",\\n\"))\nexport default {\n\t\"aliceblue\": [240 / 255, 248 / 255, 1],\n\t\"antiquewhite\": [250 / 255, 235 / 255, 215 / 255],\n\t\"aqua\": [0, 1, 1],\n\t\"aquamarine\": [127 / 255, 1, 212 / 255],\n\t\"azure\": [240 / 255, 1, 1],\n\t\"beige\": [245 / 255, 245 / 255, 220 / 255],\n\t\"bisque\": [1, 228 / 255, 196 / 255],\n\t\"black\": [0, 0, 0],\n\t\"blanchedalmond\": [1, 235 / 255, 205 / 255],\n\t\"blue\": [0, 0, 1],\n\t\"blueviolet\": [138 / 255, 43 / 255, 226 / 255],\n\t\"brown\": [165 / 255, 42 / 255, 42 / 255],\n\t\"burlywood\": [222 / 255, 184 / 255, 135 / 255],\n\t\"cadetblue\": [95 / 255, 158 / 255, 160 / 255],\n\t\"chartreuse\": [127 / 255, 1, 0],\n\t\"chocolate\": [210 / 255, 105 / 255, 30 / 255],\n\t\"coral\": [1, 127 / 255, 80 / 255],\n\t\"cornflowerblue\": [100 / 255, 149 / 255, 237 / 255],\n\t\"cornsilk\": [1, 248 / 255, 220 / 255],\n\t\"crimson\": [220 / 255, 20 / 255, 60 / 255],\n\t\"cyan\": [0, 1, 1],\n\t\"darkblue\": [0, 0, 139 / 255],\n\t\"darkcyan\": [0, 139 / 255, 139 / 255],\n\t\"darkgoldenrod\": [184 / 255, 134 / 255, 11 / 255],\n\t\"darkgray\": [169 / 255, 169 / 255, 169 / 255],\n\t\"darkgreen\": [0, 100 / 255, 0],\n\t\"darkgrey\": [169 / 255, 169 / 255, 169 / 255],\n\t\"darkkhaki\": [189 / 255, 183 / 255, 107 / 255],\n\t\"darkmagenta\": [139 / 255, 0, 139 / 255],\n\t\"darkolivegreen\": [85 / 255, 107 / 255, 47 / 255],\n\t\"darkorange\": [1, 140 / 255, 0],\n\t\"darkorchid\": [153 / 255, 50 / 255, 204 / 255],\n\t\"darkred\": [139 / 255, 0, 0],\n\t\"darksalmon\": [233 / 255, 150 / 255, 122 / 255],\n\t\"darkseagreen\": [143 / 255, 188 / 255, 143 / 255],\n\t\"darkslateblue\": [72 / 255, 61 / 255, 139 / 255],\n\t\"darkslategray\": [47 / 255, 79 / 255, 79 / 255],\n\t\"darkslategrey\": [47 / 255, 79 / 255, 79 / 255],\n\t\"darkturquoise\": [0, 206 / 255, 209 / 255],\n\t\"darkviolet\": [148 / 255, 0, 211 / 255],\n\t\"deeppink\": [1, 20 / 255, 147 / 255],\n\t\"deepskyblue\": [0, 191 / 255, 1],\n\t\"dimgray\": [105 / 255, 105 / 255, 105 / 255],\n\t\"dimgrey\": [105 / 255, 105 / 255, 105 / 255],\n\t\"dodgerblue\": [30 / 255, 144 / 255, 1],\n\t\"firebrick\": [178 / 255, 34 / 255, 34 / 255],\n\t\"floralwhite\": [1, 250 / 255, 240 / 255],\n\t\"forestgreen\": [34 / 255, 139 / 255, 34 / 255],\n\t\"fuchsia\": [1, 0, 1],\n\t\"gainsboro\": [220 / 255, 220 / 255, 220 / 255],\n\t\"ghostwhite\": [248 / 255, 248 / 255, 1],\n\t\"gold\": [1, 215 / 255, 0],\n\t\"goldenrod\": [218 / 255, 165 / 255, 32 / 255],\n\t\"gray\": [128 / 255, 128 / 255, 128 / 255],\n\t\"green\": [0, 128 / 255, 0],\n\t\"greenyellow\": [173 / 255, 1, 47 / 255],\n\t\"grey\": [128 / 255, 128 / 255, 128 / 255],\n\t\"honeydew\": [240 / 255, 1, 240 / 255],\n\t\"hotpink\": [1, 105 / 255, 180 / 255],\n\t\"indianred\": [205 / 255, 92 / 255, 92 / 255],\n\t\"indigo\": [75 / 255, 0, 130 / 255],\n\t\"ivory\": [1, 1, 240 / 255],\n\t\"khaki\": [240 / 255, 230 / 255, 140 / 255],\n\t\"lavender\": [230 / 255, 230 / 255, 250 / 255],\n\t\"lavenderblush\": [1, 240 / 255, 245 / 255],\n\t\"lawngreen\": [124 / 255, 252 / 255, 0],\n\t\"lemonchiffon\": [1, 250 / 255, 205 / 255],\n\t\"lightblue\": [173 / 255, 216 / 255, 230 / 255],\n\t\"lightcoral\": [240 / 255, 128 / 255, 128 / 255],\n\t\"lightcyan\": [224 / 255, 1, 1],\n\t\"lightgoldenrodyellow\": [250 / 255, 250 / 255, 210 / 255],\n\t\"lightgray\": [211 / 255, 211 / 255, 211 / 255],\n\t\"lightgreen\": [144 / 255, 238 / 255, 144 / 255],\n\t\"lightgrey\": [211 / 255, 211 / 255, 211 / 255],\n\t\"lightpink\": [1, 182 / 255, 193 / 255],\n\t\"lightsalmon\": [1, 160 / 255, 122 / 255],\n\t\"lightseagreen\": [32 / 255, 178 / 255, 170 / 255],\n\t\"lightskyblue\": [135 / 255, 206 / 255, 250 / 255],\n\t\"lightslategray\": [119 / 255, 136 / 255, 153 / 255],\n\t\"lightslategrey\": [119 / 255, 136 / 255, 153 / 255],\n\t\"lightsteelblue\": [176 / 255, 196 / 255, 222 / 255],\n\t\"lightyellow\": [1, 1, 224 / 255],\n\t\"lime\": [0, 1, 0],\n\t\"limegreen\": [50 / 255, 205 / 255, 50 / 255],\n\t\"linen\": [250 / 255, 240 / 255, 230 / 255],\n\t\"magenta\": [1, 0, 1],\n\t\"maroon\": [128 / 255, 0, 0],\n\t\"mediumaquamarine\": [102 / 255, 205 / 255, 170 / 255],\n\t\"mediumblue\": [0, 0, 205 / 255],\n\t\"mediumorchid\": [186 / 255, 85 / 255, 211 / 255],\n\t\"mediumpurple\": [147 / 255, 112 / 255, 219 / 255],\n\t\"mediumseagreen\": [60 / 255, 179 / 255, 113 / 255],\n\t\"mediumslateblue\": [123 / 255, 104 / 255, 238 / 255],\n\t\"mediumspringgreen\": [0, 250 / 255, 154 / 255],\n\t\"mediumturquoise\": [72 / 255, 209 / 255, 204 / 255],\n\t\"mediumvioletred\": [199 / 255, 21 / 255, 133 / 255],\n\t\"midnightblue\": [25 / 255, 25 / 255, 112 / 255],\n\t\"mintcream\": [245 / 255, 1, 250 / 255],\n\t\"mistyrose\": [1, 228 / 255, 225 / 255],\n\t\"moccasin\": [1, 228 / 255, 181 / 255],\n\t\"navajowhite\": [1, 222 / 255, 173 / 255],\n\t\"navy\": [0, 0, 128 / 255],\n\t\"oldlace\": [253 / 255, 245 / 255, 230 / 255],\n\t\"olive\": [128 / 255, 128 / 255, 0],\n\t\"olivedrab\": [107 / 255, 142 / 255, 35 / 255],\n\t\"orange\": [1, 165 / 255, 0],\n\t\"orangered\": [1, 69 / 255, 0],\n\t\"orchid\": [218 / 255, 112 / 255, 214 / 255],\n\t\"palegoldenrod\": [238 / 255, 232 / 255, 170 / 255],\n\t\"palegreen\": [152 / 255, 251 / 255, 152 / 255],\n\t\"paleturquoise\": [175 / 255, 238 / 255, 238 / 255],\n\t\"palevioletred\": [219 / 255, 112 / 255, 147 / 255],\n\t\"papayawhip\": [1, 239 / 255, 213 / 255],\n\t\"peachpuff\": [1, 218 / 255, 185 / 255],\n\t\"peru\": [205 / 255, 133 / 255, 63 / 255],\n\t\"pink\": [1, 192 / 255, 203 / 255],\n\t\"plum\": [221 / 255, 160 / 255, 221 / 255],\n\t\"powderblue\": [176 / 255, 224 / 255, 230 / 255],\n\t\"purple\": [128 / 255, 0, 128 / 255],\n\t\"rebeccapurple\": [102 / 255, 51 / 255, 153 / 255],\n\t\"red\": [1, 0, 0],\n\t\"rosybrown\": [188 / 255, 143 / 255, 143 / 255],\n\t\"royalblue\": [65 / 255, 105 / 255, 225 / 255],\n\t\"saddlebrown\": [139 / 255, 69 / 255, 19 / 255],\n\t\"salmon\": [250 / 255, 128 / 255, 114 / 255],\n\t\"sandybrown\": [244 / 255, 164 / 255, 96 / 255],\n\t\"seagreen\": [46 / 255, 139 / 255, 87 / 255],\n\t\"seashell\": [1, 245 / 255, 238 / 255],\n\t\"sienna\": [160 / 255, 82 / 255, 45 / 255],\n\t\"silver\": [192 / 255, 192 / 255, 192 / 255],\n\t\"skyblue\": [135 / 255, 206 / 255, 235 / 255],\n\t\"slateblue\": [106 / 255, 90 / 255, 205 / 255],\n\t\"slategray\": [112 / 255, 128 / 255, 144 / 255],\n\t\"slategrey\": [112 / 255, 128 / 255, 144 / 255],\n\t\"snow\": [1, 250 / 255, 250 / 255],\n\t\"springgreen\": [0, 1, 127 / 255],\n\t\"steelblue\": [70 / 255, 130 / 255, 180 / 255],\n\t\"tan\": [210 / 255, 180 / 255, 140 / 255],\n\t\"teal\": [0, 128 / 255, 128 / 255],\n\t\"thistle\": [216 / 255, 191 / 255, 216 / 255],\n\t\"tomato\": [1, 99 / 255, 71 / 255],\n\t\"turquoise\": [64 / 255, 224 / 255, 208 / 255],\n\t\"violet\": [238 / 255, 130 / 255, 238 / 255],\n\t\"wheat\": [245 / 255, 222 / 255, 179 / 255],\n\t\"white\": [1, 1, 1],\n\t\"whitesmoke\": [245 / 255, 245 / 255, 245 / 255],\n\t\"yellow\": [1, 1, 0],\n\t\"yellowgreen\": [154 / 255, 205 / 255, 50 / 255],\n};\n","import RGBColorSpace from \"../rgbspace.js\";\nimport sRGBLinear from \"./srgb-linear.js\";\nimport KEYWORDS from \"../keywords.js\";\n\nlet coordGrammar = Array(3).fill(\"<percentage> | <number>[0, 255]\");\nlet coordGrammarNumber = Array(3).fill(\"<number>[0, 255]\");\n\nexport default new RGBColorSpace({\n\tid: \"srgb\",\n\tname: \"sRGB\",\n\tbase: sRGBLinear,\n\tfromBase: rgb => {\n\t\t// convert an array of linear-light sRGB values in the range 0.0-1.0\n\t\t// to gamma corrected form\n\t\t// https://en.wikipedia.org/wiki/SRGB\n\t\treturn rgb.map(val => {\n\t\t\tlet sign = val < 0 ? -1 : 1;\n\t\t\tlet abs = val * sign;\n\n\t\t\tif (abs > 0.0031308) {\n\t\t\t\treturn sign * (1.055 * (abs ** (1 / 2.4)) - 0.055);\n\t\t\t}\n\n\t\t\treturn 12.92 * val;\n\t\t});\n\t},\n\ttoBase: rgb => {\n\t\t// convert an array of sRGB values in the range 0.0 - 1.0\n\t\t// to linear light (un-companded) form.\n\t\t// https://en.wikipedia.org/wiki/SRGB\n\t\treturn rgb.map(val => {\n\t\t\tlet sign = val < 0 ? -1 : 1;\n\t\t\tlet abs = val * sign;\n\n\t\t\tif (abs <= 0.04045) {\n\t\t\t\treturn val / 12.92;\n\t\t\t}\n\n\t\t\treturn sign * (((abs + 0.055) / 1.055) ** 2.4);\n\t\t});\n\t},\n\tformats: {\n\t\t\"rgb\": {\n\t\t\tcoords: coordGrammar,\n\t\t},\n\t\t\"rgb_number\": {\n\t\t\tname: \"rgb\",\n\t\t\tcommas: true,\n\t\t\tcoords: coordGrammarNumber,\n\t\t\tnoAlpha: true,\n\t\t},\n\t\t\"color\": { /* use defaults */ },\n\t\t\"rgba\": {\n\t\t\tcoords: coordGrammar,\n\t\t\tcommas: true,\n\t\t\tlastAlpha: true,\n\t\t},\n\t\t\"rgba_number\": {\n\t\t\tname: \"rgba\",\n\t\t\tcommas: true,\n\t\t\tcoords: coordGrammarNumber,\n\t\t},\n\t\t\"hex\": {\n\t\t\ttype: \"custom\",\n\t\t\ttoGamut: true,\n\t\t\ttest: str => /^#([a-f0-9]{3,4}){1,2}$/i.test(str),\n\t\t\tparse (str) {\n\t\t\t\tif (str.length <= 5) {\n\t\t\t\t\t// #rgb or #rgba, duplicate digits\n\t\t\t\t\tstr = str.replace(/[a-f0-9]/gi, \"$&$&\");\n\t\t\t\t}\n\n\t\t\t\tlet rgba = [];\n\t\t\t\tstr.replace(/[a-f0-9]{2}/gi, component => {\n\t\t\t\t\trgba.push(parseInt(component, 16) / 255);\n\t\t\t\t});\n\n\t\t\t\treturn {\n\t\t\t\t\tspaceId: \"srgb\",\n\t\t\t\t\tcoords: rgba.slice(0, 3),\n\t\t\t\t\talpha: rgba.slice(3)[0],\n\t\t\t\t};\n\t\t\t},\n\t\t\tserialize: (coords, alpha, {\n\t\t\t\tcollapse = true, // collapse to 3-4 digit hex when possible?\n\t\t\t} = {}) => {\n\t\t\t\tif (alpha < 1) {\n\t\t\t\t\tcoords.push(alpha);\n\t\t\t\t}\n\n\t\t\t\tcoords = coords.map(c => Math.round(c * 255));\n\n\t\t\t\tlet collapsible = collapse && coords.every(c => c % 17 === 0);\n\n\t\t\t\tlet hex = coords.map(c => {\n\t\t\t\t\tif (collapsible) {\n\t\t\t\t\t\treturn (c / 17).toString(16);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn c.toString(16).padStart(2, \"0\");\n\t\t\t\t}).join(\"\");\n\n\t\t\t\treturn \"#\" + hex;\n\t\t\t},\n\t\t},\n\t\t\"keyword\": {\n\t\t\ttype: \"custom\",\n\t\t\ttest: str => /^[a-z]+$/i.test(str),\n\t\t\tparse (str) {\n\t\t\t\tstr = str.toLowerCase();\n\t\t\t\tlet ret = {spaceId: \"srgb\", coords: null, alpha: 1};\n\n\t\t\t\tif (str === \"transparent\") {\n\t\t\t\t\tret.coords = KEYWORDS.black;\n\t\t\t\t\tret.alpha = 0;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tret.coords = KEYWORDS[str];\n\t\t\t\t}\n\n\t\t\t\tif (ret.coords) {\n\t\t\t\t\treturn ret;\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t},\n});\n","import RGBColorSpace from \"../rgbspace.js\";\nimport P3Linear from \"./p3-linear.js\";\nimport sRGB from \"./srgb.js\";\n\nexport default new RGBColorSpace({\n\tid: \"p3\",\n\tcssId: \"display-p3\",\n\tname: \"P3\",\n\tbase: P3Linear,\n\t// Gamma encoding/decoding is the same as sRGB\n\tfromBase: sRGB.fromBase,\n\ttoBase: sRGB.toBase,\n});\n","import { isNone, skipNone } from \"./util.js\";\nimport defaults from \"./defaults.js\";\nimport to from \"./to.js\";\nimport serialize from \"./serialize.js\";\nimport clone from \"./clone.js\";\nimport REC2020 from \"./spaces/rec2020.js\";\nimport P3 from \"./spaces/p3.js\";\nimport Lab from \"./spaces/lab.js\";\nimport sRGB from \"./spaces/srgb.js\";\n\n// Default space for CSS output. Code in Color.js makes this wider if there's a DOM available\ndefaults.display_space = sRGB;\n\nlet supportsNone;\n\nif (typeof CSS !== \"undefined\" && CSS.supports) {\n\t// Find widest supported color space for CSS\n\tfor (let space of [Lab, REC2020, P3]) {\n\t\tlet coords = space.getMinCoords();\n\t\tlet color = {space, coords, alpha: 1};\n\t\tlet str = serialize(color);\n\n\t\tif (CSS.supports(\"color\", str)) {\n\t\t\tdefaults.display_space = space;\n\t\t\tbreak;\n\t\t}\n\t}\n}\n\n/**\n * Returns a serialization of the color that can actually be displayed in the browser.\n * If the default serialization can be displayed, it is returned.\n * Otherwise, the color is converted to Lab, REC2020, or P3, whichever is the widest supported.\n * In Node.js, this is basically equivalent to `serialize()` but returns a `String` object instead.\n *\n * @export\n * @param {{space, coords} | Color | string} color\n * @param {*} [options={}] Options to be passed to serialize()\n * @param {ColorSpace | string} [options.space = defaults.display_space] Color space to use for serialization if default is not supported\n * @returns {String} String object containing the serialized color with a color property containing the converted color (or the original, if no conversion was necessary)\n */\nexport default function display (color, {space = defaults.display_space, ...options} = {}) {\n\tlet ret = serialize(color, options);\n\n\tif (typeof CSS === \"undefined\" || CSS.supports(\"color\", ret) || !defaults.display_space) {\n\t\tret = new String(ret);\n\t\tret.color = color;\n\t}\n\telse {\n\t\t// If we're here, what we were about to output is not supported\n\t\tlet fallbackColor = color;\n\n\t\t// First, check if the culprit is none values\n\t\tlet hasNone = color.coords.some(isNone) || isNone(color.alpha);\n\n\t\tif (hasNone) {\n\t\t\t// Does the browser support none values?\n\t\t\tif (!(supportsNone ??= CSS.supports(\"color\", \"hsl(none 50% 50%)\"))) {\n\t\t\t\t// Nope, try again without none\n\t\t\t\tfallbackColor = clone(color);\n\t\t\t\tfallbackColor.coords = fallbackColor.coords.map(skipNone);\n\t\t\t\tfallbackColor.alpha = skipNone(fallbackColor.alpha);\n\n\t\t\t\tret = serialize(fallbackColor, options);\n\n\t\t\t\tif (CSS.supports(\"color\", ret)) {\n\t\t\t\t\t// We're done, now it's supported\n\t\t\t\t\tret = new String(ret);\n\t\t\t\t\tret.color = fallbackColor;\n\t\t\t\t\treturn ret;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// If we're here, the color function is not supported\n\t\t// Fall back to fallback space\n\t\tfallbackColor = to(fallbackColor, space);\n\t\tret = new String(serialize(fallbackColor, options));\n\t\tret.color = fallbackColor;\n\t}\n\n\treturn ret;\n}\n","import getColor from \"./getColor.js\";\n\nexport default function equals (color1, color2) {\n\tcolor1 = getColor(color1);\n\tcolor2 = getColor(color2);\n\n\treturn color1.space === color2.space\n\t       && color1.alpha === color2.alpha\n\t       && color1.coords.every((c, i) => c === color2.coords[i]);\n}\n","/**\n * Relative luminance\n */\nimport get from \"./get.js\";\nimport set from \"./set.js\";\nimport xyz_d65 from \"./spaces/xyz-d65.js\";\n\nexport function getLuminance (color) {\n\t// Assume getColor() is called on color in get()\n\treturn get(color, [xyz_d65, \"y\"]);\n}\n\nexport function setLuminance (color, value) {\n\t// Assume getColor() is called on color in set()\n\tset(color, [xyz_d65, \"y\"], value);\n}\n\nexport function register (Color) {\n\tObject.defineProperty(Color.prototype, \"luminance\", {\n\t\tget () {\n\t\t\treturn getLuminance(this);\n\t\t},\n\t\tset (value) {\n\t\t\tsetLuminance(this, value);\n\t\t},\n\t});\n}\n","// WCAG 2.0 contrast https://www.w3.org/TR/WCAG20-TECHS/G18.html\n// Simple contrast, with fixed 5% viewing flare contribution\n// Symmetric, does not matter which is foreground and which is background\n\nimport getColor from \"../getColor.js\";\nimport {getLuminance} from \"../luminance.js\";\n\nexport default function contrastWCAG21 (color1, color2) {\n\tcolor1 = getColor(color1);\n\tcolor2 = getColor(color2);\n\n\tlet Y1 = Math.max(getLuminance(color1), 0);\n\tlet Y2 = Math.max(getLuminance(color2), 0);\n\n\tif (Y2 > Y1) {\n\t\t[Y1, Y2] = [Y2, Y1];\n\t}\n\n\treturn (Y1 + .05) / (Y2 + .05);\n}\n","// APCA 0.0.98G\n// https://github.com/Myndex/apca-w3\n// see also https://github.com/w3c/silver/issues/643\n\nimport getColor from \"../getColor.js\";\nimport to from \"../to.js\";\n\n// exponents\nconst normBG = 0.56;\nconst normTXT = 0.57;\nconst revTXT = 0.62;\nconst revBG = 0.65;\n\n// clamps\nconst blkThrs = 0.022;\nconst blkClmp = 1.414;\nconst loClip = 0.1;\nconst deltaYmin = 0.0005;\n\n// scalers\n// see https://github.com/w3c/silver/issues/645\nconst scaleBoW = 1.14;\nconst loBoWoffset = 0.027;\nconst scaleWoB = 1.14;\nconst loWoBoffset = 0.027;\n\nfunction fclamp (Y) {\n\tif (Y >= blkThrs) {\n\t\treturn Y;\n\t}\n\treturn Y + (blkThrs - Y) ** blkClmp;\n}\n\nfunction linearize (val) {\n\tlet sign = val < 0 ? -1 : 1;\n\tlet abs = Math.abs(val);\n\treturn sign * Math.pow(abs, 2.4);\n}\n\n// Not symmetric, requires a foreground (text) color, and a background color\nexport default function contrastAPCA (background, foreground) {\n\tforeground = getColor(foreground);\n\tbackground = getColor(background);\n\n\tlet S;\n\tlet C;\n\tlet Sapc;\n\n\t// Myndex as-published, assumes sRGB inputs\n\tlet R, G, B;\n\n\tforeground = to(foreground, \"srgb\");\n\t// Should these be clamped to in-gamut values?\n\n\t// Calculates \"screen luminance\" with non-standard simple gamma EOTF\n\t// weights should be from CSS Color 4, not the ones here which are via Myndex and copied from Lindbloom\n\t[R, G, B] = foreground.coords;\n\tlet lumTxt = linearize(R) * 0.2126729 + linearize(G) * 0.7151522 + linearize(B) * 0.0721750;\n\n\tbackground = to(background, \"srgb\");\n\t[R, G, B] = background.coords;\n\tlet lumBg = linearize(R) * 0.2126729 + linearize(G) * 0.7151522 + linearize(B) * 0.0721750;\n\n\t// toe clamping of very dark values to account for flare\n\tlet Ytxt = fclamp(lumTxt);\n\tlet Ybg = fclamp(lumBg);\n\n\t// are we \"Black on White\" (dark on light), or light on dark?\n\tlet BoW = Ybg > Ytxt;\n\n\t// why is this a delta, when Y is not perceptually uniform?\n\t// Answer: it is a noise gate, see\n\t// https://github.com/LeaVerou/color.js/issues/208\n\tif (Math.abs(Ybg - Ytxt) < deltaYmin) {\n\t\tC = 0;\n\t}\n\telse {\n\t\tif (BoW) {\n\t\t\t// dark text on light background\n\t\t\tS = Ybg ** normBG - Ytxt ** normTXT;\n\t\t\tC = S * scaleBoW;\n\t\t}\n\t\telse {\n\t\t\t// light text on dark background\n\t\t\tS = Ybg ** revBG - Ytxt ** revTXT;\n\t\t\tC = S * scaleWoB;\n\t\t}\n\t}\n\tif (Math.abs(C) < loClip) {\n\t\tSapc = 0;\n\t}\n\telse if (C > 0) {\n\t\t// not clear whether Woffset is loBoWoffset or loWoBoffset\n\t\t// but they have the same value\n\t\tSapc = C - loBoWoffset;\n\t}\n\telse {\n\t\tSapc = C + loBoWoffset;\n\t}\n\n\treturn Sapc * 100;\n}\n","// Michelson  luminance contrast\n// the relation between the spread and the sum of the two luminances\n// Symmetric, does not matter which is foreground and which is background\n// No black level compensation for flare.\n\nimport getColor from \"../getColor.js\";\nimport {getLuminance} from \"../luminance.js\";\n\nexport default function contrastMichelson (color1, color2) {\n\tcolor1 = getColor(color1);\n\tcolor2 = getColor(color2);\n\n\tlet Y1 = Math.max(getLuminance(color1), 0);\n\tlet Y2 = Math.max(getLuminance(color2), 0);\n\n\tif (Y2 > Y1) {\n\t\t[Y1, Y2] = [Y2, Y1];\n\t}\n\n\tlet denom = (Y1 + Y2);\n\treturn denom === 0 ? 0 : (Y1 - Y2) / denom;\n}\n","// Weber luminance contrast\n// The difference between the two luminances divided by the lower luminance\n// Symmetric, does not matter which is foreground and which is background\n// No black level compensation for flare.\n\nimport getColor from \"../getColor.js\";\nimport {getLuminance} from \"../luminance.js\";\n\n// the darkest sRGB color above black is #000001 and this produces\n// a plain Weber contrast of ~45647.\n// So, setting the divide-by-zero result at 50000 is a reasonable\n// max clamp for the plain Weber\nconst max = 50000;\n\nexport default function contrastWeber (color1, color2) {\n\tcolor1 = getColor(color1);\n\tcolor2 = getColor(color2);\n\n\tlet Y1 = Math.max(getLuminance(color1), 0);\n\tlet Y2 = Math.max(getLuminance(color2), 0);\n\n\tif (Y2 > Y1) {\n\t\t[Y1, Y2] = [Y2, Y1];\n\t}\n\n\treturn Y2 === 0 ? max : (Y1 - Y2) / Y2;\n}\n","// CIE Lightness difference, as used by Google Material Design\n// Google HCT Tone is the same as CIE Lightness\n// https://material.io/blog/science-of-color-design\n\nimport getColor from \"../getColor.js\";\nimport get from \"../get.js\";\nimport lab from \"../spaces/lab.js\";\n\nexport default function contrastLstar (color1, color2) {\n\tcolor1 = getColor(color1);\n\tcolor2 = getColor(color2);\n\n\tlet L1 = get(color1, [lab, \"l\"]);\n\tlet L2 = get(color2, [lab, \"l\"]);\n\n\treturn Math.abs(L1 - L2);\n}\n","import ColorSpace from \"../space.js\";\nimport {WHITES} from \"../adapt.js\";\nimport xyz_d65 from \"./xyz-d65.js\";\n\n// κ * ε  = 2^3 = 8\nconst ε = 216 / 24389;  // 6^3/29^3 == (24/116)^3\nconst ε3 = 24 / 116;\nconst κ = 24389 / 27;   // 29^3/3^3\n\nlet white = WHITES.D65;\n\nexport default new ColorSpace({\n\tid: \"lab-d65\",\n\tname: \"Lab D65\",\n\tcoords: {\n\t\tl: {\n\t\t\trefRange: [0, 100],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t\ta: {\n\t\t\trefRange: [-125, 125],\n\t\t},\n\t\tb: {\n\t\t\trefRange: [-125, 125],\n\t\t},\n\t},\n\n\t// Assuming XYZ is relative to D65, convert to CIE Lab\n\t// from CIE standard, which now defines these as a rational fraction\n\twhite,\n\n\tbase: xyz_d65,\n\t// Convert D65-adapted XYZ to Lab\n\t//  CIE 15.3:2004 section 8.2.1.1\n\tfromBase (XYZ) {\n\t\t// compute xyz, which is XYZ scaled relative to reference white\n\t\tlet xyz = XYZ.map((value, i) => value / white[i]);\n\n\t\t// now compute f\n\t\tlet f = xyz.map(value => value > ε ? Math.cbrt(value) : (κ * value + 16) / 116);\n\n\t\treturn [\n\t\t\t(116 * f[1]) - 16,   // L\n\t\t\t500 * (f[0] - f[1]), // a\n\t\t\t200 * (f[1] - f[2]),  // b\n\t\t];\n\t},\n\t// Convert Lab to D65-adapted XYZ\n\t// Same result as CIE 15.3:2004 Appendix D although the derivation is different\n\t// http://www.brucelindbloom.com/index.html?Eqn_RGB_XYZ_Matrix.html\n\ttoBase (Lab) {\n\t\t// compute f, starting with the luminance-related term\n\t\tlet f = [];\n\t\tf[1] = (Lab[0] + 16) / 116;\n\t\tf[0] = Lab[1] / 500 + f[1];\n\t\tf[2] = f[1] - Lab[2] / 200;\n\n\t\t// compute xyz\n\t\tlet xyz = [\n\t\t\tf[0]   > ε3 ? Math.pow(f[0], 3)                : (116 * f[0] - 16) / κ,\n\t\t\tLab[0] > 8  ? Math.pow((Lab[0] + 16) / 116, 3) : Lab[0] / κ,\n\t\t\tf[2]   > ε3 ? Math.pow(f[2], 3)                : (116 * f[2] - 16) / κ,\n\t\t];\n\n\t\t// Compute XYZ by scaling xyz by reference white\n\t\treturn xyz.map((value, i) => value * white[i]);\n\t},\n\n\tformats: {\n\t\t\"lab-d65\": {\n\t\t\tcoords: [\"<number> | <percentage>\", \"<number> | <percentage>[-1,1]\", \"<number> | <percentage>[-1,1]\"],\n\t\t},\n\t},\n});\n","// Delta Phi Star perceptual lightness contrast\n// See https://github.com/Myndex/deltaphistar\n// The (difference between two Lstars each raised to phi) raised to (1/phi)\n// Symmetric, does not matter which is foreground and which is background\n\n\nimport getColor from \"../getColor.js\";\nimport get from \"../get.js\";\nimport lab_d65 from \"../spaces/lab-d65.js\";\n\nconst phi = Math.pow(5, 0.5) * 0.5 + 0.5; // Math.phi can be used if Math.js\n\nexport default function contrastDeltaPhi (color1, color2) {\n\tcolor1 = getColor(color1);\n\tcolor2 = getColor(color2);\n\n\tlet Lstr1 = get(color1, [lab_d65, \"l\"]);\n\tlet Lstr2 = get(color2, [lab_d65, \"l\"]);\n\n\tlet deltaPhiStar = Math.abs(Math.pow(Lstr1, phi) - Math.pow(Lstr2, phi));\n\n\tlet contrast = Math.pow(deltaPhiStar, (1 / phi)) * Math.SQRT2 - 40;\n\n\treturn (contrast < 7.5) ? 0.0 : contrast ;\n}\n","import getColor from \"./getColor.js\";\n// import defaults from \"./defaults.js\";\nimport {isString} from \"./util.js\";\nimport * as contrastAlgorithms from \"./contrast/index.js\";\n\nexport default function contrast (background, foreground, o = {}) {\n\tif (isString(o)) {\n\t\to = {algorithm: o};\n\t}\n\n\tlet {algorithm, ...rest} = o;\n\n\tif (!algorithm) {\n\t\tlet algorithms = Object.keys(contrastAlgorithms).map(a => a.replace(/^contrast/, \"\")).join(\", \");\n\t\tthrow new TypeError(`contrast() function needs a contrast algorithm. Please specify one of: ${algorithms}`);\n\t}\n\n\tbackground = getColor(background);\n\tforeground = getColor(foreground);\n\n\tfor (let a in contrastAlgorithms) {\n\t\tif (\"contrast\" + algorithm.toLowerCase() === a.toLowerCase()) {\n\t\t\treturn contrastAlgorithms[a](background, foreground, rest);\n\t\t}\n\t}\n\n\tthrow new TypeError(`Unknown contrast algorithm: ${algorithm}`);\n}\n","import xyz_d65 from \"./spaces/xyz-d65.js\";\nimport getAll from \"./getAll.js\";\n\n// Chromaticity coordinates\nexport function uv (color) {\n\t// Assumes getAll() calls getColor() on color\n\tlet [X, Y, Z] = getAll(color, xyz_d65);\n\tlet denom = X + 15 * Y + 3 * Z;\n\treturn [4 * X / denom, 9 * Y / denom];\n}\n\nexport function xy (color) {\n\t// Assumes getAll() calls getColor() on color\n\tlet [X, Y, Z] = getAll(color, xyz_d65);\n\tlet  sum = X + Y + Z;\n\treturn [X / sum, Y / sum];\n}\n\nexport function register (Color) {\n\t// no setters, as lightness information is lost\n\t// when converting color to chromaticity\n\tObject.defineProperty(Color.prototype, \"uv\", {\n\t\tget () {\n\t\t\treturn uv(this);\n\t\t},\n\t});\n\n\tObject.defineProperty(Color.prototype, \"xy\", {\n\t\tget () {\n\t\t\treturn xy(this);\n\t\t},\n\t});\n}\n","import defaults from \"./defaults.js\";\nimport {isString} from \"./util.js\";\nimport deltaEMethods from \"./deltaE/index.js\";\n\nexport default function deltaE (c1, c2, o = {}) {\n\tif (isString(o)) {\n\t\to = {method: o};\n\t}\n\n\tlet {method = defaults.deltaE, ...rest} = o;\n\n\tfor (let m in deltaEMethods) {\n\t\tif (\"deltae\" + method.toLowerCase() === m.toLowerCase()) {\n\t\t\treturn deltaEMethods[m](c1, c2, rest);\n\t\t}\n\t}\n\n\tthrow new TypeError(`Unknown deltaE method: ${method}`);\n}\n","import ColorSpace from \"./space.js\";\nimport set from \"./set.js\";\n\nexport function lighten (color, amount = .25) {\n\tlet space = ColorSpace.get(\"oklch\", \"lch\");\n\tlet lightness = [space, \"l\"];\n\treturn set(color, lightness, l => l * (1 + amount));\n}\n\nexport function darken (color, amount = .25) {\n\tlet space = ColorSpace.get(\"oklch\", \"lch\");\n\tlet lightness = [space, \"l\"];\n\treturn set(color, lightness, l => l * (1 - amount));\n}\n","/**\n * Functions related to color interpolation\n */\nimport ColorSpace from \"./space.js\";\nimport {type, interpolate} from \"./util.js\";\nimport getColor from \"./getColor.js\";\nimport clone from \"./clone.js\";\nimport to from \"./to.js\";\nimport toGamut from \"./toGamut.js\";\nimport get from \"./get.js\";\nimport set from \"./set.js\";\nimport defaults from \"./defaults.js\";\nimport * as angles from \"./angles.js\";\nimport deltaE from \"./deltaE.js\";\n\n/**\n * Return an intermediate color between two colors\n * Signatures: mix(c1, c2, p, options)\n *             mix(c1, c2, options)\n *             mix(color)\n * @param {Color | string} c1 The first color\n * @param {Color | string} [c2] The second color\n * @param {number} [p=.5] A 0-1 percentage where 0 is c1 and 1 is c2\n * @param {Object} [o={}]\n * @return {Color}\n */\nexport function mix (c1, c2, p = .5, o = {}) {\n\t[c1, c2] = [getColor(c1), getColor(c2)];\n\n\tif (type(p) === \"object\") {\n\t\t[p, o] = [.5, p];\n\t}\n\n\tlet r = range(c1, c2, o);\n\treturn r(p);\n}\n\n/**\n *\n * @param {Color | string | Function} c1 The first color or a range\n * @param {Color | string} [c2] The second color if c1 is not a range\n * @param {Object} [options={}]\n * @return {Color[]}\n */\nexport function steps (c1, c2, options = {}) {\n\tlet colorRange;\n\n\tif (isRange(c1)) {\n\t\t// Tweaking existing range\n\t\t[colorRange, options] = [c1, c2];\n\t\t[c1, c2] = colorRange.rangeArgs.colors;\n\t}\n\n\tlet {\n\t\tmaxDeltaE, deltaEMethod,\n\t\tsteps = 2, maxSteps = 1000,\n\t\t...rangeOptions\n\t} = options;\n\n\tif (!colorRange) {\n\t\t[c1, c2] = [getColor(c1), getColor(c2)];\n\t\tcolorRange = range(c1, c2, rangeOptions);\n\t}\n\n\tlet totalDelta = deltaE(c1, c2);\n\tlet actualSteps = maxDeltaE > 0 ? Math.max(steps, Math.ceil(totalDelta / maxDeltaE) + 1) : steps;\n\tlet ret = [];\n\n\tif (maxSteps !== undefined) {\n\t\tactualSteps = Math.min(actualSteps, maxSteps);\n\t}\n\n\tif (actualSteps === 1) {\n\t\tret = [{p: .5, color: colorRange(.5)}];\n\t}\n\telse {\n\t\tlet step = 1 / (actualSteps - 1);\n\t\tret = Array.from({length: actualSteps}, (_, i) => {\n\t\t\tlet p = i * step;\n\t\t\treturn {p, color: colorRange(p)};\n\t\t});\n\t}\n\n\tif (maxDeltaE > 0) {\n\t\t// Iterate over all stops and find max deltaE\n\t\tlet maxDelta = ret.reduce((acc, cur, i) => {\n\t\t\tif (i === 0) {\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\tlet ΔΕ = deltaE(cur.color, ret[i - 1].color, deltaEMethod);\n\t\t\treturn Math.max(acc, ΔΕ);\n\t\t}, 0);\n\n\t\twhile (maxDelta > maxDeltaE) {\n\t\t\t// Insert intermediate stops and measure maxDelta again\n\t\t\t// We need to do this for all pairs, otherwise the midpoint shifts\n\t\t\tmaxDelta = 0;\n\n\t\t\tfor (let i = 1; (i < ret.length) && (ret.length < maxSteps); i++) {\n\t\t\t\tlet prev = ret[i - 1];\n\t\t\t\tlet cur = ret[i];\n\n\t\t\t\tlet p = (cur.p + prev.p) / 2;\n\t\t\t\tlet color = colorRange(p);\n\t\t\t\tmaxDelta = Math.max(maxDelta, deltaE(color, prev.color), deltaE(color, cur.color));\n\t\t\t\tret.splice(i, 0, {p, color: colorRange(p)});\n\t\t\t\ti++;\n\t\t\t}\n\t\t}\n\t}\n\n\tret = ret.map(a => a.color);\n\n\treturn ret;\n}\n\n/**\n * Interpolate to color2 and return a function that takes a 0-1 percentage\n * @param {Color | string | Function} color1 The first color or an existing range\n * @param {Color | string} [color2] If color1 is a color, this is the second color\n * @param {Object} [options={}]\n * @returns {Function} A function that takes a 0-1 percentage and returns a color\n */\nexport function range (color1, color2, options = {}) {\n\tif (isRange(color1)) {\n\t\t// Tweaking existing range\n\t\tlet [r, options] = [color1, color2];\n\n\t\treturn range(...r.rangeArgs.colors, {...r.rangeArgs.options, ...options});\n\t}\n\n\tlet {space, outputSpace, progression, premultiplied} = options;\n\n\tcolor1 = getColor(color1);\n\tcolor2 = getColor(color2);\n\n\t// Make sure we're working on copies of these colors\n\tcolor1 = clone(color1);\n\tcolor2 = clone(color2);\n\n\tlet rangeArgs = {colors: [color1, color2], options};\n\n\tif (space) {\n\t\tspace = ColorSpace.get(space);\n\t}\n\telse {\n\t\tspace = ColorSpace.registry[defaults.interpolationSpace] || color1.space;\n\t}\n\n\toutputSpace = outputSpace ? ColorSpace.get(outputSpace) : space;\n\n\tcolor1 = to(color1, space);\n\tcolor2 = to(color2, space);\n\n\t// Gamut map to avoid areas of flat color\n\tcolor1 = toGamut(color1);\n\tcolor2 = toGamut(color2);\n\n\t// Handle hue interpolation\n\t// See https://github.com/w3c/csswg-drafts/issues/4735#issuecomment-635741840\n\tif (space.coords.h && space.coords.h.type === \"angle\") {\n\t\tlet arc = options.hue = options.hue || \"shorter\";\n\n\t\tlet hue = [space, \"h\"];\n\t\tlet [θ1, θ2] = [get(color1, hue), get(color2, hue)];\n\t\t// Undefined hues must be evaluated before hue fix-up to properly\n\t\t// calculate hue arcs between undefined and defined hues.\n\t\t// See https://github.com/w3c/csswg-drafts/issues/9436#issuecomment-1746957545\n\t\tif (isNaN(θ1) && !isNaN(θ2)) {\n\t\t\tθ1 = θ2;\n\t\t}\n\t\telse if (isNaN(θ2) && !isNaN(θ1)) {\n\t\t\tθ2 = θ1;\n\t\t}\n\t\t[θ1, θ2] = angles.adjust(arc, [θ1, θ2]);\n\t\tset(color1, hue, θ1);\n\t\tset(color2, hue, θ2);\n\t}\n\n\tif (premultiplied) {\n\t\t// not coping with polar spaces yet\n\t\tcolor1.coords = color1.coords.map(c => c * color1.alpha);\n\t\tcolor2.coords = color2.coords.map(c => c * color2.alpha);\n\t}\n\n\treturn Object.assign(p => {\n\t\tp = progression ? progression(p) : p;\n\t\tlet coords = color1.coords.map((start, i) => {\n\t\t\tlet end = color2.coords[i];\n\t\t\treturn interpolate(start, end, p);\n\t\t});\n\n\t\tlet alpha = interpolate(color1.alpha, color2.alpha, p);\n\t\tlet ret = {space, coords, alpha};\n\n\t\tif (premultiplied) {\n\t\t\t// undo premultiplication\n\t\t\tret.coords = ret.coords.map(c => c / alpha);\n\t\t}\n\n\t\tif (outputSpace !== space) {\n\t\t\tret = to(ret, outputSpace);\n\t\t}\n\n\t\treturn ret;\n\t}, {\n\t\trangeArgs,\n\t});\n}\n\nexport function isRange (val) {\n\treturn type(val) === \"function\" && !!val.rangeArgs;\n}\n\ndefaults.interpolationSpace = \"lab\";\n\nexport function register (Color) {\n\tColor.defineFunction(\"mix\", mix, {returns: \"color\"});\n\tColor.defineFunction(\"range\", range, {returns: \"function<color>\"});\n\tColor.defineFunction(\"steps\", steps, {returns: \"array<color>\"});\n}\n","import ColorSpace from \"../space.js\";\nimport sRGB from \"./srgb.js\";\n\nexport default new ColorSpace({\n\tid: \"hsl\",\n\tname: \"HSL\",\n\tcoords: {\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t\ts: {\n\t\t\trange: [0, 100],\n\t\t\tname: \"Saturation\",\n\t\t},\n\t\tl: {\n\t\t\trange: [0, 100],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t},\n\n\tbase: sRGB,\n\n\t// Adapted from https://drafts.csswg.org/css-color-4/better-rgbToHsl.js\n\tfromBase: rgb => {\n\t\tlet max = Math.max(...rgb);\n\t\tlet min = Math.min(...rgb);\n\t\tlet [r, g, b] = rgb;\n\t\tlet [h, s, l] = [NaN, 0, (min + max) / 2];\n\t\tlet d = max - min;\n\n\t\tif (d !== 0) {\n\t\t\ts = (l === 0 || l === 1) ? 0 : (max - l) / Math.min(l, 1 - l);\n\n\t\t\tswitch (max) {\n\t\t\t\tcase r: h = (g - b) / d + (g < b ? 6 : 0); break;\n\t\t\t\tcase g: h = (b - r) / d + 2; break;\n\t\t\t\tcase b: h = (r - g) / d + 4;\n\t\t\t}\n\n\t\t\th = h * 60;\n\t\t}\n\n\t\t// Very out of gamut colors can produce negative saturation\n\t\t// If so, just rotate the hue by 180 and use a positive saturation\n\t\t// see https://github.com/w3c/csswg-drafts/issues/9222\n\t\tif (s < 0) {\n\t\t\th += 180;\n\t\t\ts = Math.abs(s);\n\t\t}\n\n\t\tif (h >= 360) {\n\t\t\th -= 360;\n\t\t}\n\n\t\treturn [h, s * 100, l * 100];\n\t},\n\n\t// Adapted from https://en.wikipedia.org/wiki/HSL_and_HSV#HSL_to_RGB_alternative\n\ttoBase: hsl => {\n\t\tlet [h, s, l] = hsl;\n\t\th = h % 360;\n\n\t\tif (h < 0) {\n\t\t\th += 360;\n\t\t}\n\n\t\ts /= 100;\n\t\tl /= 100;\n\n\t\tfunction f (n) {\n\t\t\tlet k = (n + h / 30) % 12;\n\t\t\tlet a = s * Math.min(l, 1 - l);\n\t\t\treturn l - a * Math.max(-1, Math.min(k - 3, 9 - k, 1));\n\t\t}\n\n\t\treturn [f(0), f(8), f(4)];\n\t},\n\n\tformats: {\n\t\t\"hsl\": {\n\t\t\tcoords: [\"<number> | <angle>\", \"<percentage>\", \"<percentage>\"],\n\t\t},\n\t\t\"hsla\": {\n\t\t\tcoords: [\"<number> | <angle>\", \"<percentage>\", \"<percentage>\"],\n\t\t\tcommas: true,\n\t\t\tlastAlpha: true,\n\t\t},\n\t},\n});\n","import ColorSpace from \"../space.js\";\nimport HSL from \"./hsl.js\";\n\n// The Hue, Whiteness Blackness (HWB) colorspace\n// See https://drafts.csswg.org/css-color-4/#the-hwb-notation\n// Note that, like HSL, calculations are done directly on\n// gamma-corrected sRGB values rather than linearising them first.\n\nexport default new ColorSpace({\n\tid: \"hsv\",\n\tname: \"HSV\",\n\tcoords: {\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t\ts: {\n\t\t\trange: [0, 100],\n\t\t\tname: \"Saturation\",\n\t\t},\n\t\tv: {\n\t\t\trange: [0, 100],\n\t\t\tname: \"Value\",\n\t\t},\n\t},\n\n\tbase: HSL,\n\t// https://en.wikipedia.org/wiki/HSL_and_HSV#Interconversion\n\tfromBase (hsl) {\n\t\tlet [h, s, l] = hsl;\n\t\ts /= 100;\n\t\tl /= 100;\n\n\t\tlet v = l + s * Math.min(l, 1 - l);\n\n\t\treturn [\n\t\t\th, // h is the same\n\t\t\tv === 0 ? 0 : 200 * (1 - l / v), // s\n\t\t\t100 * v,\n\t\t];\n\t},\n\t// https://en.wikipedia.org/wiki/HSL_and_HSV#Interconversion\n\ttoBase (hsv) {\n\t\tlet [h, s, v] = hsv;\n\n\t\ts /= 100;\n\t\tv /= 100;\n\n\t\tlet l = v * (1 - s / 2);\n\n\t\treturn [\n\t\t\th, // h is the same\n\t\t\t(l === 0 || l === 1) ? 0 : ((v - l) / Math.min(l, 1 - l)) * 100,\n\t\t\tl * 100,\n\t\t];\n\t},\n\n\tformats: {\n\t\tcolor: {\n\t\t\tid: \"--hsv\",\n\t\t\tcoords: [\"<number> | <angle>\", \"<percentage> | <number>\", \"<percentage> | <number>\"],\n\t\t},\n\t},\n});\n","import ColorSpace from \"../space.js\";\nimport HSV from \"./hsv.js\";\n\n// The Hue, Whiteness Blackness (HWB) colorspace\n// See https://drafts.csswg.org/css-color-4/#the-hwb-notation\n// Note that, like HSL, calculations are done directly on\n// gamma-corrected sRGB values rather than linearising them first.\n\nexport default new ColorSpace({\n\tid: \"hwb\",\n\tname: \"HWB\",\n\tcoords: {\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t\tw: {\n\t\t\trange: [0, 100],\n\t\t\tname: \"Whiteness\",\n\t\t},\n\t\tb: {\n\t\t\trange: [0, 100],\n\t\t\tname: \"Blackness\",\n\t\t},\n\t},\n\n\tbase: HSV,\n\tfromBase (hsv) {\n\t\tlet [h, s, v] = hsv;\n\n\t\treturn [h, v * (100 - s) / 100, 100 - v];\n\t},\n\ttoBase (hwb) {\n\t\tlet [h, w, b] = hwb;\n\n\t\t// Now convert percentages to [0..1]\n\t\tw /= 100;\n\t\tb /= 100;\n\n\t\t// Achromatic check (white plus black >= 1)\n\t\tlet sum = w + b;\n\t\tif (sum >= 1) {\n\t\t\tlet gray = w / sum;\n\t\t\treturn [h, 0, gray * 100];\n\t\t}\n\n\t\tlet v = (1 - b);\n\t\tlet s = (v === 0) ? 0 : 1 - w / v;\n\t\treturn [h, s * 100, v * 100];\n\t},\n\n\tformats: {\n\t\t\"hwb\": {\n\t\t\tcoords: [\"<number> | <angle>\", \"<percentage> | <number>\", \"<percentage> | <number>\"],\n\t\t},\n\t},\n});\n","import RGBColorSpace from \"../rgbspace.js\";\n\n// convert an array of linear-light a98-rgb values to CIE XYZ\n// http://www.brucelindbloom.com/index.html?Eqn_RGB_XYZ_Matrix.html\n// has greater numerical precision than section 4.3.5.3 of\n// https://www.adobe.com/digitalimag/pdfs/AdobeRGB1998.pdf\n// but the values below were calculated from first principles\n// from the chromaticity coordinates of R G B W\nconst toXYZ_M = [\n\t[ 0.5766690429101305,   0.1855582379065463,   0.1882286462349947  ],\n\t[ 0.29734497525053605,  0.6273635662554661,   0.07529145849399788 ],\n\t[ 0.02703136138641234,  0.07068885253582723,  0.9913375368376388  ],\n];\n\nconst fromXYZ_M = [\n\t[  2.0415879038107465,    -0.5650069742788596,   -0.34473135077832956 ],\n\t[ -0.9692436362808795,     1.8759675015077202,    0.04155505740717557 ],\n\t[  0.013444280632031142,  -0.11836239223101838,   1.0151749943912054  ],\n];\n\nexport default new RGBColorSpace({\n\tid: \"a98rgb-linear\",\n\tcssId: \"--a98-rgb-linear\",\n\tname: \"Linear Adobe® 98 RGB compatible\",\n\twhite: \"D65\",\n\ttoXYZ_M,\n\tfromXYZ_M,\n});\n","import RGBColorSpace from \"../rgbspace.js\";\nimport A98Linear from \"./a98rgb-linear.js\";\n\nexport default new RGBColorSpace({\n\tid: \"a98rgb\",\n\tcssId: \"a98-rgb\",\n\tname: \"Adobe® 98 RGB compatible\",\n\tbase: A98Linear,\n\ttoBase: RGB => RGB.map(val => Math.pow(Math.abs(val), 563 / 256) * Math.sign(val)),\n\tfromBase: RGB => RGB.map(val => Math.pow(Math.abs(val), 256 / 563) * Math.sign(val)),\n});\n","import RGBColorSpace from \"../rgbspace.js\";\nimport XYZ_D50 from \"./xyz-d50.js\";\n\n// convert an array of  prophoto-rgb values to CIE XYZ\n// using  D50 (so no chromatic adaptation needed afterwards)\n// matrix cannot be expressed in rational form, but is calculated to 64 bit accuracy\n// see https://github.com/w3c/csswg-drafts/issues/7675\nconst toXYZ_M = [\n\t[ 0.79776664490064230,  0.13518129740053308,  0.03134773412839220 ],\n\t[ 0.28807482881940130,  0.71183523424187300,  0.00008993693872564 ],\n\t[ 0.00000000000000000,  0.00000000000000000,  0.82510460251046020 ],\n];\n\nconst fromXYZ_M = [\n\t[  1.34578688164715830, -0.25557208737979464, -0.05110186497554526 ],\n\t[ -0.54463070512490190,  1.50824774284514680,  0.02052744743642139 ],\n\t[  0.00000000000000000,  0.00000000000000000,  1.21196754563894520 ],\n];\n\nexport default new RGBColorSpace({\n\tid: \"prophoto-linear\",\n\tcssId: \"--prophoto-rgb-linear\",\n\tname: \"Linear ProPhoto\",\n\twhite: \"D50\",\n\tbase: XYZ_D50,\n\ttoXYZ_M,\n\tfromXYZ_M,\n});\n","import RGBColorSpace from \"../rgbspace.js\";\nimport ProPhotoLinear from \"./prophoto-linear.js\";\n\nconst Et = 1 / 512;\nconst Et2 = 16 / 512;\n\nexport default new RGBColorSpace({\n\tid: \"prophoto\",\n\tcssId: \"prophoto-rgb\",\n\tname: \"ProPhoto\",\n\tbase: ProPhotoLinear,\n\ttoBase (RGB) {\n\t\t// Transfer curve is gamma 1.8 with a small linear portion\n\t\treturn RGB.map(v => v < Et2 ? v / 16 : v ** 1.8);\n\t},\n\tfromBase (RGB) {\n\t\treturn RGB.map(v => v >= Et ? v ** (1 / 1.8) : 16 * v);\n\t},\n});\n","import ColorSpace from \"../space.js\";\nimport OKLab from \"./oklab.js\";\nimport {constrain as constrainAngle} from \"../angles.js\";\n\nexport default new ColorSpace({\n\tid: \"oklch\",\n\tname: \"Oklch\",\n\tcoords: {\n\t\tl: {\n\t\t\trefRange: [0, 1],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t\tc: {\n\t\t\trefRange: [0, 0.4],\n\t\t\tname: \"Chroma\",\n\t\t},\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t},\n\twhite: \"D65\",\n\n\tbase: OKLab,\n\tfromBase (oklab) {\n\t\t// Convert to polar form\n\t\tlet [L, a, b] = oklab;\n\t\tlet h;\n\t\tconst ε = 0.0002; // chromatic components much smaller than a,b\n\n\t\tif (Math.abs(a) < ε && Math.abs(b) < ε) {\n\t\t\th = NaN;\n\t\t}\n\t\telse {\n\t\t\th = Math.atan2(b, a) * 180 / Math.PI;\n\t\t}\n\n\t\treturn [\n\t\t\tL, // OKLab L is still L\n\t\t\tMath.sqrt(a ** 2 + b ** 2), // Chroma\n\t\t\tconstrainAngle(h), // Hue, in degrees [0 to 360)\n\t\t];\n\t},\n\t// Convert from polar form\n\ttoBase (oklch) {\n\t\tlet [L, C, h] = oklch;\n\t\tlet a, b;\n\n\t\t// check for NaN hue\n\t\tif (isNaN(h)) {\n\t\t\ta = 0;\n\t\t\tb = 0;\n\t\t}\n\t\telse {\n\t\t\ta = C * Math.cos(h * Math.PI / 180);\n\t\t\tb = C * Math.sin(h * Math.PI / 180);\n\t\t}\n\n\t\treturn [ L, a, b ];\n\t},\n\n\tformats: {\n\t\t\"oklch\": {\n\t\t\tcoords: [\"<percentage> | <number>\", \"<number> | <percentage>[0,1]\", \"<number> | <angle>\"],\n\t\t},\n\t},\n});\n","import ColorSpace from \"../space.js\";\nimport {WHITES} from \"../adapt.js\";\nimport xyz_d65 from \"./xyz-d65.js\";\nimport {uv} from \"../chromaticity.js\";\nimport {isNone, skipNone} from \"../util.js\";\n\nlet white = WHITES.D65;\n\nconst ε = 216 / 24389;  // 6^3/29^3 == (24/116)^3\nconst κ = 24389 / 27;   // 29^3/3^3\nconst [U_PRIME_WHITE, V_PRIME_WHITE] = uv({space: xyz_d65, coords: white});\n\nexport default new ColorSpace({\n\tid: \"luv\",\n\tname: \"Luv\",\n\tcoords: {\n\t\tl: {\n\t\t\trefRange: [0, 100],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t\t// Reference ranges from https://facelessuser.github.io/coloraide/colors/luv/\n\t\tu: {\n\t\t\trefRange: [-215, 215],\n\t\t},\n\t\tv: {\n\t\t\trefRange: [-215, 215],\n\t\t},\n\t},\n\n\twhite: white,\n\tbase: xyz_d65,\n\n\t// Convert D65-adapted XYZ to Luv\n\t// https://en.wikipedia.org/wiki/CIELUV#The_forward_transformation\n\tfromBase (XYZ) {\n\t\tlet xyz = [skipNone(XYZ[0]), skipNone(XYZ[1]), skipNone(XYZ[2])];\n\t\tlet y = xyz[1];\n\n\t\tlet [up, vp] = uv({space: xyz_d65, coords: xyz});\n\n\t\t// Protect against XYZ of [0, 0, 0]\n\t\tif (!Number.isFinite(up) || !Number.isFinite(vp)) {\n\t\t\treturn [0, 0, 0];\n\t\t}\n\n\t\tlet L = y <= ε ? κ * y : 116 * Math.cbrt(y) - 16;\n\t\treturn [\n\t\t\tL,\n\t\t\t13 * L * (up - U_PRIME_WHITE),\n\t\t\t13 * L * (vp - V_PRIME_WHITE),\n\t\t ];\n\t},\n\n\t// Convert Luv to D65-adapted XYZ\n\t// https://en.wikipedia.org/wiki/CIELUV#The_reverse_transformation\n\ttoBase (Luv) {\n\t\tlet [L, u, v] = Luv;\n\n\t\t// Protect against division by zero and NaN Lightness\n\t\tif (L === 0 || isNone(L)) {\n\t\t\treturn [0, 0, 0];\n\t\t}\n\n\t\tu = skipNone(u);\n\t\tv = skipNone(v);\n\n\t\tlet up = (u / (13 * L)) + U_PRIME_WHITE;\n\t\tlet vp = (v / (13 * L)) + V_PRIME_WHITE;\n\n\t\tlet y = L <= 8 ? L / κ : Math.pow((L + 16) / 116, 3);\n\n\t\treturn [\n\t\t\ty * ((9 * up) / (4 * vp)),\n\t\t\ty,\n\t\t\ty * ((12 - 3 * up - 20 * vp) / (4 * vp)),\n\t\t];\n\t},\n\n\tformats: {\n\t\tcolor: {\n\t\t\tid: \"--luv\",\n\t\t\tcoords: [\"<number> | <percentage>\", \"<number> | <percentage>[-1,1]\", \"<number> | <percentage>[-1,1]\"],\n\t\t},\n\t},\n});\n","import ColorSpace from \"../space.js\";\nimport Luv from \"./luv.js\";\nimport {constrain as constrainAngle} from \"../angles.js\";\n\nexport default new ColorSpace({\n\tid: \"lchuv\",\n\tname: \"LChuv\",\n\tcoords: {\n\t\tl: {\n\t\t\trefRange: [0, 100],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t\tc: {\n\t\t\trefRange: [0, 220],\n\t\t\tname: \"Chroma\",\n\t\t},\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t},\n\n\tbase: Luv,\n\tfromBase (Luv) {\n\t\t// Convert to polar form\n\t\tlet [L, u, v] = Luv;\n\t\tlet hue;\n\t\tconst ε = 0.02;\n\n\t\tif (Math.abs(u) < ε && Math.abs(v) < ε) {\n\t\t\thue = NaN;\n\t\t}\n\t\telse {\n\t\t\thue = Math.atan2(v, u) * 180 / Math.PI;\n\t\t}\n\n\t\treturn [\n\t\t\tL, // L is still L\n\t\t\tMath.sqrt(u ** 2 + v ** 2), // Chroma\n\t\t\tconstrainAngle(hue), // Hue, in degrees [0 to 360)\n\t\t];\n\t},\n\ttoBase (LCH) {\n\t\t// Convert from polar form\n\t\tlet [Lightness, Chroma, Hue] = LCH;\n\t\t// Clamp any negative Chroma\n\t\tif (Chroma < 0) {\n\t\t\tChroma = 0;\n\t\t}\n\t\t// Deal with NaN Hue\n\t\tif (isNaN(Hue)) {\n\t\t\tHue = 0;\n\t\t}\n\t\treturn [\n\t\t\tLightness, // L is still L\n\t\t\tChroma * Math.cos(Hue * Math.PI / 180), // u\n\t\t\tChroma * Math.sin(Hue * Math.PI / 180),  // v\n\t\t];\n\t},\n\n\tformats: {\n\t\tcolor: {\n\t\t\tid: \"--lchuv\",\n\t\t\tcoords: [\"<number> | <percentage>\", \"<number> | <percentage>\", \"<number> | <angle>\"],\n\t\t},\n\t},\n});\n","/*\nAdapted from: https://github.com/hsluv/hsluv-javascript/blob/14b49e6cf9a9137916096b8487a5372626b57ba4/src/hsluv.ts\n\nCopyright (c) 2012-2022 Alexei Boronine\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\nimport ColorSpace from \"../space.js\";\nimport LCHuv from \"./lchuv.js\";\nimport sRGB from \"./srgb.js\";\nimport {fromXYZ_M} from \"./srgb-linear.js\";\nimport {skipNone} from \"../util.js\";\n\nconst ε = 216 / 24389;  // 6^3/29^3 == (24/116)^3\nconst κ = 24389 / 27;   // 29^3/3^3\n\nconst m_r0 = fromXYZ_M[0][0];\nconst m_r1 = fromXYZ_M[0][1];\nconst m_r2 = fromXYZ_M[0][2];\nconst m_g0 = fromXYZ_M[1][0];\nconst m_g1 = fromXYZ_M[1][1];\nconst m_g2 = fromXYZ_M[1][2];\nconst m_b0 = fromXYZ_M[2][0];\nconst m_b1 = fromXYZ_M[2][1];\nconst m_b2 = fromXYZ_M[2][2];\n\nfunction distanceFromOriginAngle (slope, intercept, angle) {\n\tconst d = intercept / (Math.sin(angle) - slope * Math.cos(angle));\n\treturn d < 0 ? Infinity : d;\n}\n\nexport function calculateBoundingLines (l) {\n\tconst sub1 = Math.pow(l + 16, 3) / 1560896;\n\tconst sub2 = sub1 > ε ? sub1 : l / κ;\n\tconst s1r = sub2 * (284517 * m_r0 - 94839 * m_r2);\n\tconst s2r = sub2 * (838422 * m_r2 + 769860 * m_r1 + 731718 * m_r0);\n\tconst s3r = sub2 * (632260 * m_r2 - 126452 * m_r1);\n\tconst s1g = sub2 * (284517 * m_g0 - 94839 * m_g2);\n\tconst s2g = sub2 * (838422 * m_g2 + 769860 * m_g1 + 731718 * m_g0);\n\tconst s3g = sub2 * (632260 * m_g2 - 126452 * m_g1);\n\tconst s1b = sub2 * (284517 * m_b0 - 94839 * m_b2);\n\tconst s2b = sub2 * (838422 * m_b2 + 769860 * m_b1 + 731718 * m_b0);\n\tconst s3b = sub2 * (632260 * m_b2 - 126452 * m_b1);\n\n\treturn {\n\t\tr0s: s1r / s3r,\n\t\tr0i: s2r * l / s3r,\n\t\tr1s: s1r / (s3r + 126452),\n\t\tr1i: (s2r - 769860) * l / (s3r + 126452),\n\t\tg0s: s1g / s3g,\n\t\tg0i: s2g * l / s3g,\n\t\tg1s: s1g / (s3g + 126452),\n\t\tg1i: (s2g - 769860) * l / (s3g + 126452),\n\t\tb0s: s1b / s3b,\n\t\tb0i: s2b * l / s3b,\n\t\tb1s: s1b / (s3b + 126452),\n\t\tb1i: (s2b - 769860) * l / (s3b + 126452),\n\t};\n}\n\nfunction calcMaxChromaHsluv (lines, h) {\n\tconst hueRad = h / 360 * Math.PI * 2;\n\tconst r0 = distanceFromOriginAngle(lines.r0s, lines.r0i, hueRad);\n\tconst r1 = distanceFromOriginAngle(lines.r1s, lines.r1i, hueRad);\n\tconst g0 = distanceFromOriginAngle(lines.g0s, lines.g0i, hueRad);\n\tconst g1 = distanceFromOriginAngle(lines.g1s, lines.g1i, hueRad);\n\tconst b0 = distanceFromOriginAngle(lines.b0s, lines.b0i, hueRad);\n\tconst b1 = distanceFromOriginAngle(lines.b1s, lines.b1i, hueRad);\n\n\treturn Math.min(r0, r1, g0, g1, b0, b1);\n}\n\nexport default new ColorSpace({\n\tid: \"hsluv\",\n\tname: \"HSLuv\",\n\tcoords: {\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t\ts: {\n\t\t\trange: [0, 100],\n\t\t\tname: \"Saturation\",\n\t\t},\n\t\tl: {\n\t\t\trange: [0, 100],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t},\n\n\tbase: LCHuv,\n\tgamutSpace: sRGB,\n\n\t// Convert LCHuv to HSLuv\n\tfromBase (lch) {\n\t\tlet [l, c, h] = [skipNone(lch[0]), skipNone(lch[1]), skipNone(lch[2])];\n\t\tlet s;\n\n\t\tif (l > 99.9999999) {\n\t\t\ts = 0;\n\t\t\tl = 100;\n\t\t}\n\t\telse if (l < 0.00000001) {\n\t\t\ts = 0;\n\t\t\tl = 0;\n\t\t}\n\t\telse {\n\t\t\tlet lines = calculateBoundingLines(l);\n\t\t\tlet max = calcMaxChromaHsluv(lines, h);\n\t\t\ts = c / max * 100;\n\t\t}\n\n\t\treturn [h, s, l];\n\t},\n\n\t// Convert HSLuv to LCHuv\n\ttoBase (hsl) {\n\t\tlet [h, s, l] = [skipNone(hsl[0]), skipNone(hsl[1]), skipNone(hsl[2])];\n\t\tlet c;\n\n\t\tif (l > 99.9999999) {\n\t\t\tl = 100;\n\t\t\tc = 0;\n\t\t}\n\t\telse if (l < 0.00000001) {\n\t\t\tl = 0;\n\t\t\tc = 0;\n\t\t}\n\t\telse {\n\t\t\tlet lines = calculateBoundingLines(l);\n\t\t\tlet max = calcMaxChromaHsluv(lines, h);\n\t\t\tc = max / 100 * s;\n\t\t}\n\n\t\treturn [l, c, h];\n\t},\n\n\tformats: {\n\t\tcolor: {\n\t\t\tid: \"--hsluv\",\n\t\t\tcoords: [\"<number> | <angle>\", \"<percentage> | <number>\", \"<percentage> | <number>\"],\n\t\t},\n\t},\n});\n","/*\nAdapted from: https://github.com/hsluv/hsluv-javascript/blob/14b49e6cf9a9137916096b8487a5372626b57ba4/src/hsluv.ts\n\nCopyright (c) 2012-2022 Alexei Boronine\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\nimport ColorSpace from \"../space.js\";\nimport LCHuv from \"./lchuv.js\";\nimport {fromXYZ_M} from \"./srgb-linear.js\";\nimport {skipNone} from \"../util.js\";\nimport {calculateBoundingLines} from \"./hsluv.js\";\n\nconst ε = 216 / 24389;  // 6^3/29^3 == (24/116)^3\nconst κ = 24389 / 27;   // 29^3/3^3\n\nconst m_r0 = fromXYZ_M[0][0];\nconst m_r1 = fromXYZ_M[0][1];\nconst m_r2 = fromXYZ_M[0][2];\nconst m_g0 = fromXYZ_M[1][0];\nconst m_g1 = fromXYZ_M[1][1];\nconst m_g2 = fromXYZ_M[1][2];\nconst m_b0 = fromXYZ_M[2][0];\nconst m_b1 = fromXYZ_M[2][1];\nconst m_b2 = fromXYZ_M[2][2];\n\nfunction distanceFromOrigin (slope, intercept) {\n\treturn Math.abs(intercept) / Math.sqrt(Math.pow(slope, 2) + 1);\n}\n\nfunction calcMaxChromaHpluv (lines) {\n\tlet r0 = distanceFromOrigin(lines.r0s, lines.r0i);\n\tlet r1 = distanceFromOrigin(lines.r1s, lines.r1i);\n\tlet g0 = distanceFromOrigin(lines.g0s, lines.g0i);\n\tlet g1 = distanceFromOrigin(lines.g1s, lines.g1i);\n\tlet b0 = distanceFromOrigin(lines.b0s, lines.b0i);\n\tlet b1 = distanceFromOrigin(lines.b1s, lines.b1i);\n\n\treturn Math.min(r0, r1, g0, g1, b0, b1);\n}\n\nexport default new ColorSpace({\n\tid: \"hpluv\",\n\tname: \"HPLuv\",\n\tcoords: {\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t\ts: {\n\t\t\trange: [0, 100],\n\t\t\tname: \"Saturation\",\n\t\t},\n\t\tl: {\n\t\t\trange: [0, 100],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t},\n\n\tbase: LCHuv,\n\tgamutSpace: \"self\",\n\n\t// Convert LCHuv to HPLuv\n\tfromBase (lch) {\n\t\tlet [l, c, h] = [skipNone(lch[0]), skipNone(lch[1]), skipNone(lch[2])];\n\t\tlet s;\n\n\t\tif (l > 99.9999999) {\n\t\t\ts = 0;\n\t\t\tl = 100;\n\t\t}\n\t\telse if (l < 0.00000001) {\n\t\t\ts = 0;\n\t\t\tl = 0;\n\t\t}\n\t\telse {\n\t\t\tlet lines = calculateBoundingLines(l);\n\t\t\tlet max = calcMaxChromaHpluv(lines);\n\t\t\ts = c / max * 100;\n\t\t}\n\t\treturn [h, s, l];\n\t},\n\n\t// Convert HPLuv to LCHuv\n\ttoBase (hsl) {\n\t\tlet [h, s, l] = [skipNone(hsl[0]), skipNone(hsl[1]), skipNone(hsl[2])];\n\t\tlet c;\n\n\t\tif (l > 99.9999999) {\n\t\t\tl = 100;\n\t\t\tc = 0;\n\t\t}\n\t\telse if (l < 0.00000001) {\n\t\t\tl = 0;\n\t\t\tc = 0;\n\t\t}\n\t\telse {\n\t\t\tlet lines = calculateBoundingLines(l);\n\t\t\tlet max = calcMaxChromaHpluv(lines, h);\n\t\t\tc = max / 100 * s;\n\t\t}\n\n\t\treturn [l, c, h];\n\t},\n\n\tformats: {\n\t\tcolor: {\n\t\t\tid: \"--hpluv\",\n\t\t\tcoords: [\"<number> | <angle>\", \"<percentage> | <number>\", \"<percentage> | <number>\"],\n\t\t},\n\t},\n});\n","import RGBColorSpace from \"../rgbspace.js\";\nimport REC2020Linear from \"./rec2020-linear.js\";\n\nconst Yw = 203;\t// absolute luminance of media white, cd/m²\nconst n = 2610 / (2 ** 14);\nconst ninv = (2 ** 14) / 2610;\nconst m = 2523 / (2 ** 5);\nconst minv = (2 ** 5) / 2523;\nconst c1 = 3424 / (2 ** 12);\nconst c2 = 2413 / (2 ** 7);\nconst c3 = 2392 / (2 ** 7);\n\nexport default new RGBColorSpace({\n\tid: \"rec2100pq\",\n\tcssId: \"rec2100-pq\",\n\tname: \"REC.2100-PQ\",\n\tbase: REC2020Linear,\n\ttoBase (RGB) {\n\t\t// given PQ encoded component in range [0, 1]\n\t\t// return media-white relative linear-light\n\t\treturn RGB.map(function (val) {\n\t\t\tlet x = ((Math.max(((val ** minv) - c1), 0) / (c2 - (c3 * (val ** minv)))) ** ninv);\n\t\t\treturn (x * 10000 / Yw); \t// luminance relative to diffuse white, [0, 70 or so].\n\t\t});\n\t},\n\tfromBase (RGB) {\n\t\t// given media-white relative linear-light\n\t\t// returnPQ encoded component in range [0, 1]\n\t\treturn RGB.map(function (val) {\n\t\t\tlet x = Math.max(val * Yw / 10000, 0); \t// absolute luminance of peak white is 10,000 cd/m².\n\t\t\tlet num = (c1 + (c2 * (x ** n)));\n\t\t\tlet denom = (1 + (c3 * (x ** n)));\n\n\t\t\treturn ((num / denom)  ** m);\n\t\t});\n\t},\n});\n","import RGBColorSpace from \"../rgbspace.js\";\nimport REC2020Linear from \"./rec2020-linear.js\";\n\n// FIXME see https://github.com/LeaVerou/color.js/issues/190\n\nconst a = 0.17883277;\nconst b = 0.28466892; // 1 - (4 * a)\nconst c = 0.55991073; // 0.5 - a * Math.log(4 *a)\n\nconst scale = 3.7743;\t// Place 18% grey at HLG 0.38, so media white at 0.75\n\nexport default new RGBColorSpace({\n\tid: \"rec2100hlg\",\n\tcssId: \"rec2100-hlg\",\n\tname: \"REC.2100-HLG\",\n\treferred: \"scene\",\n\n\tbase: REC2020Linear,\n\ttoBase (RGB) {\n\t\t// given HLG encoded component in range [0, 1]\n\t\t// return media-white relative linear-light\n\t\treturn RGB.map(function (val) {\n\t\t\t// first the HLG EOTF\n\t\t\t// ITU-R BT.2390-10 p.30 section\n\t\t\t// 6.3 The hybrid log-gamma electro-optical transfer function (EOTF)\n\t\t\t// Then scale by 3 so media white is 1.0\n\t\t\tif (val <= 0.5) {\n\t\t\t\treturn (val ** 2) / 3 * scale;\n\t\t\t}\n\t\t\treturn ((Math.exp((val - c) / a) + b) / 12) * scale;\n\t\t});\n\t},\n\tfromBase (RGB) {\n\t\t// given media-white relative linear-light\n\t\t// where diffuse white is 1.0,\n\t\t// return HLG encoded component in range [0, 1]\n\t\treturn RGB.map(function (val) {\n\t\t\t// first scale to put linear-light media white at 1/3\n\t\t\tval /= scale;\n\t\t\t// now the HLG OETF\n\t\t\t// ITU-R BT.2390-10 p.23\n\t\t\t// 6.1 The hybrid log-gamma opto-electronic transfer function (OETF)\n\t\t\tif (val <= 1 / 12) {\n\t\t\t\treturn Math.sqrt(3 * val);\n\t\t\t}\n\t\t\treturn a * Math.log(12 * val - b) + c;\n\t\t});\n\t},\n});\n","import hooks from \"./hooks.js\";\nimport {multiplyMatrices} from \"./util.js\";\nimport {WHITES} from \"./adapt.js\";\n\nexport const CATs = {};\n\nhooks.add(\"chromatic-adaptation-start\", env => {\n\tif (env.options.method) {\n\t\tenv.M = adapt(env.W1, env.W2, env.options.method);\n\t}\n});\n\nhooks.add(\"chromatic-adaptation-end\", env => {\n\tif (!env.M) {\n\t\tenv.M = adapt(env.W1, env.W2, env.options.method);\n\t}\n});\n\nexport function defineCAT ({id, toCone_M, fromCone_M}) {\n\t// Use id, toCone_M, fromCone_M like variables\n\tCATs[id] = arguments[0];\n}\n\nexport function adapt (W1, W2, id = \"Bradford\") {\n\t// adapt from a source whitepoint or illuminant W1\n\t// to a destination whitepoint or illuminant W2,\n\t// using the given chromatic adaptation transform (CAT)\n\t// debugger;\n\tlet method = CATs[id];\n\n\tlet [ρs, γs, βs] = multiplyMatrices(method.toCone_M, W1);\n\tlet [ρd, γd, βd] = multiplyMatrices(method.toCone_M, W2);\n\n\t// all practical illuminants have non-zero XYZ so no division by zero can occur below\n\tlet scale = [\n\t\t[ρd / ρs,  0,        0      ],\n\t\t[0,        γd / γs,  0      ],\n\t\t[0,        0,        βd / βs],\n\t];\n\t// console.log({scale});\n\n\tlet scaled_cone_M = multiplyMatrices(scale, method.toCone_M);\n\tlet adapt_M\t= multiplyMatrices(method.fromCone_M, scaled_cone_M);\n\t// console.log({scaled_cone_M, adapt_M});\n\treturn adapt_M;\n}\n\ndefineCAT({\n\tid: \"von Kries\",\n\ttoCone_M: [\n\t\t[  0.4002400,  0.7076000, -0.0808100 ],\n\t\t[ -0.2263000,  1.1653200,  0.0457000 ],\n\t\t[  0.0000000,  0.0000000,  0.9182200 ],\n\t],\n\tfromCone_M: [\n\t\t[ 1.8599363874558397, -1.1293816185800916,   0.21989740959619328     ],\n\t\t[ 0.3611914362417676,  0.6388124632850422,  -0.000006370596838649899 ],\n\t\t[ 0,                   0,                    1.0890636230968613      ],\n\t],\n});\n\ndefineCAT({\n\tid: \"Bradford\",\n\t// Convert an array of XYZ values in the range 0.0 - 1.0\n\t// to cone fundamentals\n\ttoCone_M: [\n\t\t[  0.8951000,  0.2664000, -0.1614000 ],\n\t\t[ -0.7502000,  1.7135000,  0.0367000 ],\n\t\t[  0.0389000, -0.0685000,  1.0296000 ],\n\t],\n\t// and back\n\tfromCone_M: [\n\t\t[  0.9869929054667121, -0.14705425642099013, 0.15996265166373122  ],\n\t\t[  0.4323052697233945,  0.5183602715367774,  0.049291228212855594 ],\n\t\t[ -0.00852866457517732, 0.04004282165408486, 0.96848669578755     ],\n\t],\n});\n\ndefineCAT({\n\tid: \"CAT02\",\n\t// with complete chromatic adaptation to W2, so D = 1.0\n\ttoCone_M: [\n\t\t[  0.7328000,  0.4296000, -0.1624000 ],\n\t\t[ -0.7036000,  1.6975000,  0.0061000 ],\n\t\t[  0.0030000,  0.0136000,  0.9834000 ],\n\t],\n\tfromCone_M: [\n\t\t[  1.0961238208355142,   -0.27886900021828726, 0.18274517938277307 ],\n\t\t[  0.4543690419753592,    0.4735331543074117,  0.07209780371722911 ],\n\t\t[ -0.009627608738429355, -0.00569803121611342, 1.0153256399545427  ],\n\t],\n});\n\ndefineCAT({\n\tid: \"CAT16\",\n\ttoCone_M: [\n\t\t[  0.401288,  0.650173, -0.051461 ],\n\t\t[ -0.250268,  1.204414,  0.045854 ],\n\t\t[ -0.002079,  0.048952,  0.953127 ],\n\t],\n\t// the extra precision is needed to avoid roundtripping errors\n\tfromCone_M: [\n\t\t[  1.862067855087233,   -1.0112546305316845,  0.14918677544445172  ],\n\t\t[  0.3875265432361372,   0.6214474419314753, -0.008973985167612521 ],\n\t\t[ -0.01584149884933386, -0.03412293802851557, 1.0499644368778496   ],\n\t],\n});\n\nObject.assign(WHITES, {\n\t// whitepoint values from ASTM E308-01 with 10nm spacing, 1931 2 degree observer\n\t// all normalized to Y (luminance) = 1.00000\n\t// Illuminant A is a tungsten electric light, giving a very warm, orange light.\n\tA:   [1.09850, 1.00000, 0.35585],\n\n\t// Illuminant C was an early approximation to daylight: illuminant A with a blue filter.\n\tC:   [0.98074, 1.000000, 1.18232],\n\n\t// The daylight series of illuminants simulate natural daylight.\n\t// The color temperature (in degrees Kelvin/100) ranges from\n\t// cool, overcast daylight (D50) to bright, direct sunlight (D65).\n\tD55: [0.95682, 1.00000, 0.92149],\n\tD75: [0.94972, 1.00000, 1.22638],\n\n\t// Equal-energy illuminant, used in two-stage CAT16\n\tE:   [1.00000, 1.00000, 1.00000],\n\n\t// The F series of illuminants represent fluorescent lights\n\tF2:  [0.99186, 1.00000, 0.67393],\n\tF7:  [0.95041, 1.00000, 1.08747],\n\tF11: [1.00962, 1.00000, 0.64350],\n});\n","import RGBColorSpace from \"../rgbspace.js\";\nimport {WHITES} from \"../adapt.js\";\nimport \"../CATs.js\"; // because of the funky whitepoint\n\n// The ACES whitepoint\n// see TB-2018-001 Derivation of the ACES White Point CIE Chromaticity Coordinates\n// also https://github.com/ampas/aces-dev/blob/master/documents/python/TB-2018-001/aces_wp.py\n// Similar to D60\nWHITES.ACES = [0.32168 / 0.33767, 1.00000, (1.00000 - 0.32168 - 0.33767) / 0.33767];\n\n// convert an array of linear-light ACEScc values to CIE XYZ\nconst toXYZ_M = [\n\t[  0.6624541811085053,   0.13400420645643313,  0.1561876870049078  ],\n\t[  0.27222871678091454,  0.6740817658111484,   0.05368951740793705 ],\n\t[ -0.005574649490394108, 0.004060733528982826, 1.0103391003129971  ],\n];\nconst fromXYZ_M = [\n\t[  1.6410233796943257,   -0.32480329418479,    -0.23642469523761225  ],\n\t[ -0.6636628587229829,    1.6153315916573379,   0.016756347685530137 ],\n\t[  0.011721894328375376, -0.008284441996237409, 0.9883948585390215   ],\n];\n\nexport default new RGBColorSpace({\n\tid: \"acescg\",\n\tcssId: \"--acescg\",\n\tname: \"ACEScg\",\n\n\t// ACEScg – A scene-referred, linear-light encoding of ACES Data\n\t// https://docs.acescentral.com/specifications/acescg/\n\t// uses the AP1 primaries, see section 4.3.1 Color primaries\n\tcoords: {\n\t\tr: {\n\t\t\trange: [0, 65504],\n\t\t\tname: \"Red\",\n\t\t},\n\t\tg: {\n\t\t\trange: [0, 65504],\n\t\t\tname: \"Green\",\n\t\t},\n\t\tb: {\n\t\t\trange: [0, 65504],\n\t\t\tname: \"Blue\",\n\t\t},\n\t},\n\n\treferred: \"scene\",\n\n\twhite: WHITES.ACES,\n\n\ttoXYZ_M,\n\tfromXYZ_M,\n});\n\n// export default Color;\n","import RGBColorSpace from \"../rgbspace.js\";\nimport \"../CATs.js\"; // because of the funky whitepoint\nimport ACEScg from \"./acescg.js\";\n\nconst ε = 2 ** -16;\n\n// the smallest value which, in the 32bit IEEE 754 float encoding,\n// decodes as a non-negative value\nconst ACES_min_nonzero = -0.35828683;\n\n// brightest encoded value, decodes to 65504\nconst ACES_cc_max = (Math.log2(65504) + 9.72) / 17.52; // 1.468\n\nexport default new RGBColorSpace({\n\tid: \"acescc\",\n\tcssId: \"--acescc\",\n\tname: \"ACEScc\",\n\t// see S-2014-003 ACEScc – A Logarithmic Encoding of ACES Data\n\t// https://docs.acescentral.com/specifications/acescc/\n\t// uses the AP1 primaries, see section 4.3.1 Color primaries\n\n\t// Appendix A: \"Very small ACES scene referred values below 7 1/4 stops\n\t// below 18% middle gray are encoded as negative ACEScc values.\n\t// These values should be preserved per the encoding in Section 4.4\n\t// so that all positive ACES values are maintained.\"\n\tcoords: {\n\t\tr: {\n\t\t\trange: [ACES_min_nonzero, ACES_cc_max],\n\t\t\tname: \"Red\",\n\t\t},\n\t\tg: {\n\t\t\trange: [ACES_min_nonzero, ACES_cc_max],\n\t\t\tname: \"Green\",\n\t\t},\n\t\tb: {\n\t\t\trange: [ACES_min_nonzero, ACES_cc_max],\n\t\t\tname: \"Blue\",\n\t\t},\n\t},\n\treferred: \"scene\",\n\n\tbase: ACEScg,\n\t// from section 4.4.2 Decoding Function\n\ttoBase (RGB) {\n\t\tconst low = (9.72 - 15) / 17.52; // -0.3014\n\n\t\treturn RGB.map(function (val) {\n\t\t\tif (val <= low) {\n\t\t\t\treturn (2 ** ((val * 17.52) - 9.72) - ε) * 2; // very low values, below -0.3014\n\t\t\t}\n\t\t\telse if (val < ACES_cc_max) {\n\t\t\t\treturn 2 ** ((val * 17.52) - 9.72);\n\t\t\t}\n\t\t\telse { // val >= ACES_cc_max\n\t\t\t\treturn 65504;\n\t\t\t}\n\t\t});\n\t},\n\n\t// Non-linear encoding function from S-2014-003, section 4.4.1 Encoding Function\n\tfromBase (RGB) {\n\t\treturn RGB.map(function (val) {\n\t\t\tif (val <= 0) {\n\t\t\t\treturn (Math.log2(ε) + 9.72) / 17.52; // -0.3584\n\t\t\t}\n\t\t\telse if (val < ε) {\n\t\t\t\treturn  (Math.log2(ε + val * 0.5) + 9.72) / 17.52;\n\t\t\t}\n\t\t\telse { // val >= ε\n\t\t\t\treturn  (Math.log2(val) + 9.72) / 17.52;\n\t\t\t}\n\t\t});\n\t},\n\t// encoded media white (rgb 1,1,1) => linear  [ 222.861, 222.861, 222.861 ]\n\t// encoded media black (rgb 0,0,0) => linear [ 0.0011857, 0.0011857, 0.0011857]\n});\n","import * as util from \"./util.js\";\nimport hooks from \"./hooks.js\";\nimport defaults from \"./defaults.js\";\nimport ColorSpace from \"./space.js\";\nimport {WHITES} from \"./adapt.js\";\nimport {\n\tgetColor,\n\tparse,\n\tto,\n\tserialize,\n\tinGamut,\n\ttoGamut,\n\tdistance,\n\tequals,\n\tget,\n\tgetAll,\n\tset,\n\tsetAll,\n\tdisplay,\n} from \"./index-fn.js\";\n\n\nimport \"./spaces/xyz-d50.js\";\nimport \"./spaces/srgb.js\";\n\n/**\n * Class that represents a color\n */\nexport default class Color {\n\t/**\n\t * Creates an instance of Color.\n\t * Signatures:\n\t * - `new Color(stringToParse)`\n\t * - `new Color(otherColor)`\n\t * - `new Color({space, coords, alpha})`\n\t * - `new Color(space, coords, alpha)`\n\t * - `new Color(spaceId, coords, alpha)`\n\t */\n\tconstructor (...args) {\n\t\tlet color;\n\n\t\tif (args.length === 1) {\n\t\t\tcolor = getColor(args[0]);\n\t\t}\n\n\t\tlet space, coords, alpha;\n\n\t\tif (color) {\n\t\t\tspace = color.space || color.spaceId;\n\t\t\tcoords = color.coords;\n\t\t\talpha = color.alpha;\n\t\t}\n\t\telse {\n\t\t\t// default signature new Color(ColorSpace, array [, alpha])\n\t\t\t[space, coords, alpha] = args;\n\t\t}\n\n\t\tObject.defineProperty(this, \"space\", {\n\t\t\tvalue: ColorSpace.get(space),\n\t\t\twritable: false,\n\t\t\tenumerable: true,\n\t\t\tconfigurable: true, // see note in https://262.ecma-international.org/8.0/#sec-proxy-object-internal-methods-and-internal-slots-get-p-receiver\n\t\t});\n\n\t\tthis.coords = coords ? coords.slice() : [0, 0, 0];\n\n\t\t// Clamp alpha to [0, 1]\n\t\tthis.alpha = alpha > 1 || alpha === undefined ? 1 : (alpha < 0 ? 0 : alpha);\n\n\t\t// Convert \"NaN\" to NaN\n\t\tfor (let i = 0; i < this.coords.length; i++) {\n\t\t\tif (this.coords[i] === \"NaN\") {\n\t\t\t\tthis.coords[i] = NaN;\n\t\t\t}\n\t\t}\n\n\t\t// Define getters and setters for each coordinate\n\t\tfor (let id in this.space.coords) {\n\t\t\tObject.defineProperty(this, id, {\n\t\t\t\tget: () => this.get(id),\n\t\t\t\tset: value => this.set(id, value),\n\t\t\t});\n\t\t}\n\t}\n\n\tget spaceId () {\n\t\treturn this.space.id;\n\t}\n\n\tclone () {\n\t\treturn new Color(this.space, this.coords, this.alpha);\n\t}\n\n\ttoJSON () {\n\t\treturn {\n\t\t\tspaceId: this.spaceId,\n\t\t\tcoords: this.coords,\n\t\t\talpha: this.alpha,\n\t\t};\n\t}\n\n\tdisplay (...args) {\n\t\tlet ret = display(this, ...args);\n\n\t\t// Convert color object to Color instance\n\t\tret.color = new Color(ret.color);\n\n\t\treturn ret;\n\t}\n\n\t/**\n\t * Get a color from the argument passed\n\t * Basically gets us the same result as new Color(color) but doesn't clone an existing color object\n\t */\n\tstatic get (color, ...args) {\n\t\tif (color instanceof Color) {\n\t\t\treturn color;\n\t\t}\n\n\t\treturn new Color(color, ...args);\n\t}\n\n\tstatic defineFunction (name, code, o = code) {\n\t\tlet {instance = true, returns} = o;\n\n\t\tlet func = function (...args) {\n\t\t\tlet ret = code(...args);\n\n\t\t\tif (returns === \"color\") {\n\t\t\t\tret = Color.get(ret);\n\t\t\t}\n\t\t\telse if (returns === \"function<color>\") {\n\t\t\t\tlet f = ret;\n\t\t\t\tret = function (...args) {\n\t\t\t\t\tlet ret = f(...args);\n\t\t\t\t\treturn Color.get(ret);\n\t\t\t\t};\n\t\t\t\t// Copy any function metadata\n\t\t\t\tObject.assign(ret, f);\n\t\t\t}\n\t\t\telse if (returns === \"array<color>\") {\n\t\t\t\tret = ret.map(c => Color.get(c));\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t};\n\n\t\tif (!(name in Color)) {\n\t\t\tColor[name] = func;\n\t\t}\n\n\t\tif (instance) {\n\t\t\tColor.prototype[name] = function (...args) {\n\t\t\t\treturn func(this, ...args);\n\t\t\t};\n\t\t}\n\t}\n\n\tstatic defineFunctions (o) {\n\t\tfor (let name in o) {\n\t\t\tColor.defineFunction(name, o[name], o[name]);\n\t\t}\n\t}\n\n\tstatic extend (exports) {\n\t\tif (exports.register) {\n\t\t\texports.register(Color);\n\t\t}\n\t\telse {\n\t\t\t// No register method, just add the module's functions\n\t\t\tfor (let name in exports) {\n\t\t\t\tColor.defineFunction(name, exports[name]);\n\t\t\t}\n\t\t}\n\t}\n}\n\nColor.defineFunctions({\n\tget,\n\tgetAll,\n\tset,\n\tsetAll,\n\tto,\n\tequals,\n\tinGamut,\n\ttoGamut,\n\tdistance,\n\ttoString: serialize,\n});\n\nObject.assign(Color, {\n\tutil,\n\thooks,\n\tWHITES,\n\tSpace: ColorSpace,\n\tspaces: ColorSpace.registry,\n\tparse,\n\n\t// Global defaults one may want to configure\n\tdefaults,\n});\n","import ColorSpace from \"../space.js\";\nimport * as spaces from \"./index-fn.js\";\n\nexport * as spaces from \"./index-fn.js\";\n\nfor (let key of Object.keys(spaces)) {\n\tColorSpace.register(spaces[key]);\n}\n","/**\n * This plugin defines getters and setters for color[spaceId]\n * e.g. color.lch on *any* color gives us the lch coords\n */\nimport ColorSpace from \"./space.js\";\nimport Color from \"./color.js\";\nimport hooks from \"./hooks.js\";\n\n// Add space accessors to existing color spaces\nfor (let id in ColorSpace.registry) {\n\taddSpaceAccessors(id, ColorSpace.registry[id]);\n}\n\n// Add space accessors to color spaces not yet created\nhooks.add(\"colorspace-init-end\", space => {\n\taddSpaceAccessors(space.id, space);\n\tspace.aliases?.forEach(alias => {\n\t\taddSpaceAccessors(alias, space);\n\t});\n});\n\nfunction addSpaceAccessors (id, space) {\n\tlet propId = id.replace(/-/g, \"_\");\n\n\tObject.defineProperty(Color.prototype, propId, {\n\t\t// Convert coords to coords in another colorspace and return them\n\t\t// Source colorspace: this.spaceId\n\t\t// Target colorspace: id\n\t\tget () {\n\t\t\tlet ret = this.getAll(id);\n\n\t\t\tif (typeof Proxy === \"undefined\") {\n\t\t\t\t// If proxies are not supported, just return a static array\n\t\t\t\treturn ret;\n\t\t\t}\n\n\t\t\t// Enable color.spaceId.coordName syntax\n\t\t\treturn new Proxy(ret, {\n\t\t\t\thas: (obj, property) => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tColorSpace.resolveCoord([space, property]);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\tcatch (e) {}\n\n\t\t\t\t\treturn Reflect.has(obj, property);\n\t\t\t\t},\n\t\t\t\tget: (obj, property, receiver) => {\n\t\t\t\t\tif (property && typeof property !== \"symbol\" && !(property in obj)) {\n\t\t\t\t\t\tlet {index} = ColorSpace.resolveCoord([space, property]);\n\n\t\t\t\t\t\tif (index >= 0) {\n\t\t\t\t\t\t\treturn obj[index];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn Reflect.get(obj, property, receiver);\n\t\t\t\t},\n\t\t\t\tset: (obj, property, value, receiver) => {\n\t\t\t\t\tif (property && typeof property !== \"symbol\" && !(property in obj) || property >= 0) {\n\t\t\t\t\t\tlet {index} = ColorSpace.resolveCoord([space, property]);\n\n\t\t\t\t\t\tif (index >= 0) {\n\t\t\t\t\t\t\tobj[index] = value;\n\n\t\t\t\t\t\t\t// Update color.coords\n\t\t\t\t\t\t\tthis.setAll(id, obj);\n\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn Reflect.set(obj, property, value, receiver);\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t\t// Convert coords in another colorspace to internal coords and set them\n\t\t// Target colorspace: this.spaceId\n\t\t// Source colorspace: id\n\t\tset (coords) {\n\t\t\tthis.setAll(id, coords);\n\t\t},\n\t\tconfigurable: true,\n\t\tenumerable: true,\n\t});\n}\n","// Import all modules of Color.js\nimport Color from \"./color.js\";\n\n// Import all color spaces\nimport \"./spaces/index.js\";\n\n// Import all DeltaE methods\nimport deltaE from \"./deltaE.js\";\nimport deltaEMethods from \"./deltaE/index.js\";\n\nColor.extend(deltaEMethods);\nColor.extend({deltaE});\nObject.assign(Color, {deltaEMethods});\n\n// Import optional modules\nimport * as variations from \"./variations.js\";\nColor.extend(variations);\n\nimport contrast from \"./contrast.js\";\nColor.extend({contrast});\n\nimport * as chromaticity from \"./chromaticity.js\";\nColor.extend(chromaticity);\n\nimport * as luminance from \"./luminance.js\";\nColor.extend(luminance);\n\nimport * as interpolation from \"./interpolation.js\";\nColor.extend(interpolation);\n\nimport * as contrastMethods from \"./contrast/index.js\";\nColor.extend(contrastMethods);\n\nimport \"./CATs.js\";\nimport \"./space-accessors.js\";\n\n// Re-export everything\nexport default Color;\n","/**\n * Inserts `values` at position `index`, shuffling remaining\n * items further down.\n * @param data \n * @param index \n * @param values \n * @returns \n */\nexport const insertAt = <V>(\n  //eslint-disable-next-line functional/prefer-readonly-type\n  data: ReadonlyArray<V> | Array<V>,\n  index: number,\n  ...values: Array<V>\n): Array<V> => {\n  if (!Array.isArray(data)) {\n    throw new TypeError(`Param 'data' is not an arry`);\n  }\n  return [ ...data.slice(0, index), ...values, ...data.slice(index + 1) ];\n};","import { guardIndex } from \"./GuardIndex.js\";\n\n/**\n * Removes an element at `index` index from `data`, returning the resulting array without modifying the original.\n *\n * ```js\n * import { Arrays } from 'https://unpkg.com/ixfx/dist/data.js';\n *\n * const v = [ 100, 20, 50 ];\n * const vv = Arrays.remove(2);\n *\n * Yields:\n *  v: [ 100, 20, 50 ]\n * vv: [ 100, 20 ]\n * ```\n *\n * Consider {@link without} if you want to remove an item by value.\n *\n * Throws an exception if `index` is outside the range of `data` array.\n * @param data Input array\n * @param index Index to remove\n * @typeParam V Type of array\n * @returns\n */\nexport const remove = <V>(\n  //eslint-disable-next-line functional/prefer-readonly-type\n  data: ReadonlyArray<V> | Array<V>,\n  index: number\n): Array<V> => {\n  // ✔️ Unit tested\n  if (!Array.isArray(data)) {\n    throw new TypeError(`'data' parameter should be an array`);\n  }\n  guardIndex(data, index, `index`);\n  return [ ...data.slice(0, index), ...data.slice(index + 1) ];\n};","import { isEqualDefault, type IsEqual } from \"../util/IsEqual.js\";\n\n/**\n * Returns the 'max' of some iterable using the provided scoring function.\n * It only yields a value when iterator finishes.\n * @param iterable\n * @param scorer \n * @returns \n */\nexport const maxScore = <V>(iterable: Iterable<V>, scorer: (v: V) => number): V | undefined => {\n  let highestValue: V | undefined;\n  let highestScore = Number.MIN_SAFE_INTEGER;\n  for (const value of iterable) {\n    const score = scorer(value);\n    if (score >= highestScore) {\n      highestScore = score;\n      highestValue = value;\n    }\n  }\n  return highestValue;\n}\n\n/**\n * Returns the 'min' of some iterable using the provided scoring function.\n * It only yields a value when iterator finishes.\n * @param iterable \n * @param scorer \n * @returns \n */\nexport const min = <V>(iterable: Iterable<V>, scorer: (v: V) => number): V | undefined => {\n  let lowestValue: V | undefined;\n  let lowestScore\n    = Number.MAX_SAFE_INTEGER;\n  for (const value of iterable) {\n    const score = scorer(value);\n    if (score <= lowestScore) {\n      lowestScore = score;\n      lowestValue = value;\n    }\n  }\n  return lowestValue;\n}\n\n\n/**\n * Returns _true_ if all values in iterables are equal, regardless\n * of their position. Uses === equality semantics by default.\n * \n * Is NOT recursive.\n * \n * @example Default equality checking\n * ```js\n * const a = ['apples','oranges','pears'];\n * const b = ['pears','oranges','apples'];\n * hasEqualValues(a, b); // True\n * ```\n *\n * @example Custom equality checking\n * ```js\n * const a = [ { name: 'John' }];\n * const b = [ { name: 'John' }];\n * // False, since object identies are different\n * hasEqualValues(a, b); \n * // True, since now we're comparing by value\n * hasEqualValues(a, b, (aa,bb) => aa.name === bb.name);\n * ```\n * @param arrays\n * @param eq\n */\nexport const hasEqualValuesShallow = <V>(\n  iterableA: Iterable<V>,\n  iterableB: Iterable<V>,\n  eq?: IsEqual<V>\n): boolean => {\n  const returnValue = compareValuesShallow(iterableA, iterableB, eq);\n  return returnValue.a.length === 0 && returnValue.b.length === 0;\n};\n\n/**\n * Compares the values of two iterables, returning a list\n * of items they have in common and those unique in `a` or `b`.\n * Ignores ordering of values, and is NOT recursive.\n *\n * ```js\n * const a = ['apples', 'oranges', 'pears' ]\n * const b = ['pears', 'kiwis', 'bananas' ];\n *\n * const r = compareValuesShallow(a, b);\n * r.shared;  // [ 'pears' ]\n * r.a;       // [ 'apples', 'oranges' ]\n * r.b;       // [ 'kiwis', 'bananas' ]\n * ```\n * \n * By default uses === semantics for comparison.\n * @param a\n * @param b\n * @param eq\n * @returns\n */\nexport const compareValuesShallow = <V>(\n  a: Iterable<V>,\n  b: Iterable<V>,\n  eq = isEqualDefault<V>\n) => {\n  const shared = [];\n  const aUnique = [];\n  const bUnique = [];\n\n  for (const elementOfA of a) {\n    let seenInB = false;\n    // Does B contain this thing from A?\n    for (const elementOfB of b) {\n      if (eq(elementOfA, elementOfB)) {\n        seenInB = true;\n        break;\n      }\n    }\n\n    if (seenInB) {\n      // Common in A & B\n      shared.push(elementOfA);\n    } else {\n      // No, it's only found in A\n      aUnique.push(elementOfA);\n    }\n  }\n\n  for (const elementOfB of b) {\n    let seenInA = false;\n    // Does A contain this thing from B?\n    for (const elementOfA of a) {\n      if (eq(elementOfB, elementOfA)) {\n        seenInA = true;\n      }\n    }\n    if (!seenInA) {\n      // No, something unique to B\n      bUnique.push(elementOfB);\n    }\n  }\n\n  // Are the two iterables the same?\n  const isSame = aUnique.length === 0 && bUnique.length === 0;\n\n  return {\n    shared,\n    isSame,\n    a: aUnique,\n    b: bUnique\n  };\n};\n","import { mapKeys } from '../util/MapKeys.js';\nimport { isEqualDefault, type IsEqual } from '../util/IsEqual.js';\nimport { compareValuesShallow as IterableCompareValues } from '../iterables/CompareValues.js';\nexport type ChangeKind = `mutate` | `add` | `del`\nexport type ChangeRecord<TKey extends string | number | symbol> = [ kind: ChangeKind, path: TKey, value: any ];\n\n/**\n * Result of {@link compareData}\n */\nexport type CompareChangeSet<TKey extends string | number> = {\n  /**\n   * _True_ if there are any changes\n   */\n  hasChanged: boolean\n  /**\n   * Results for child objects\n   */\n  children: Record<TKey, CompareChangeSet<any>>\n  /**\n   * Values that have changed\n   */\n  changed: Record<TKey, any>\n  /**\n   * Fields that have been added\n   */\n  added: Record<TKey, any>\n  /**\n   * Fields that have been removed\n   */\n  removed: Array<TKey>\n  isArray: boolean\n  /**\n   * Summary of changes\n   */\n  summary: Array<ChangeRecord<TKey>>\n}\n\n/**\n * Compares the keys of two objects, returning a set of those in\n * common, and those in either A or B exclusively.\n * ```js\n * const a = { colour: `red`, intensity: 5 };\n * const b = { colour: `pink`, size: 10 };\n * const c = compareKeys(a, b);\n * // c.shared = [ `colour` ]\n * // c.a = [ `intensity` ]\n * // c.b = [ `size`  ]\n * ```\n * @param a \n * @param b \n * @returns \n */\nexport const compareKeys = (a: object, b: object) => {\n  const c = IterableCompareValues(Object.keys(a), Object.keys(b));\n  return c;\n}\n\n/**\n * Returns the changed fields from A -> B. It's assumed that A and B have the same shape.\n * ie. returns an object that only consists of fields which have changed in B compared to A.\n * \n * ```js\n * const a = { msg: `hi`, v: 10 };\n * \n * changedDataFields(a, { msg: `hi`,   v: 10 }); // {}\n * changedDataFields(a, { msg: `hi!!`, v: 10 }); // { msg: `hi!!` }\n * changedDataFields(a, { msg: `hi!!` });       // { msg: `hi!!`, v: undefined }\n * ```\n * \n * Under the hood, we use {@link compareData}(a, b, true). If B has additional or removed fields,\n * this is considered an error.\n * \n * If a field is an array, the whole array is returned, rather than a diff.\n * @param a \n * @param b \n */\nexport const changedDataFields = (a: object, b: object) => {\n  const r = compareData(a, b, true);\n  if (Object.entries(r.added).length > 0) throw new Error(`Shape of data has changed`);\n  if (Object.entries(r.removed).length > 0) throw new Error(`Shape of data has changed`);\n\n  const output = compareResultToObject(r, b);\n  return output;\n}\n\nconst compareResultToObject = (r: CompareChangeSet<any>, b: object): Record<string, any> | Array<any> => {\n  const output = {}\n\n  if (r.isArray) {\n    return b;\n  }\n\n  for (const entry of Object.entries(r.changed)) {\n    (output as any)[ entry[ 0 ] ] = entry[ 1 ];\n  }\n\n  for (const entry of Object.entries(r.added)) {\n    (output as any)[ entry[ 0 ] ] = entry[ 1 ];\n  }\n\n\n  for (const childEntry of Object.entries(r.children)) {\n    if (childEntry[ 1 ].hasChanged) {\n      (output as any)[ childEntry[ 0 ] ] = compareResultToObject(childEntry[ 1 ], (b as any)[ childEntry[ 0 ] ]);\n    }\n  }\n  return output;\n}\n\n/**\n * Produces a {@link CompareChangeSet} between two arrays.\n * \n * @param a Earlier array to compare\n * @param b Later array to compare\n * @param eq Equality comparison for values\n * @returns Change set.\n */\nexport const compareArrays = <TValue>(a: Array<TValue>, b: Array<TValue>, eq: IsEqual<TValue> = isEqualDefault<TValue>): CompareChangeSet<number> => {\n  if (!Array.isArray(a)) throw new Error(`Param 'a' is not an array`);\n  if (!Array.isArray(b)) throw new Error(`Param 'b' is not an array`);\n  const c = compareData(a, b, false, eq);\n  if (!c.isArray) throw new Error(`Change set does not have arrays as parameters`);\n\n  const convert = (key: string) => {\n    if (key.startsWith(`_`)) {\n      return Number.parseInt(key.slice(1));\n    } else throw new Error(`Unexpected key '${ key }'`);\n  }\n  const cc: CompareChangeSet<number> = {\n    ...c,\n    added: mapKeys(c.added, convert),\n    changed: mapKeys(c.changed, convert),\n    removed: c.removed.map(v => convert(v)),\n    summary: c.summary.map(value => {\n      return [ value[ 0 ], convert(value[ 1 ]), value[ 2 ] ];\n    })\n  }\n  return cc;\n}\n\n/**\n * Compares A to B. Assumes they are simple objects, essentially key-value pairs, where the \n * values are primitive values or other simple objects. It also works with arrays.\n * \n * Uses === equality semantics by default.\n * @param a \n * @param b \n */\nexport const compareData = (a: object, b: object, assumeSameShape = false, eq: IsEqual<any> = isEqualDefault): CompareChangeSet<string> => {\n  const entriesA = Object.entries(a);\n  const entriesB = Object.entries(b);\n\n  const scannedKeys = new Set<string>();\n  const changed = {}\n  const added = {}\n  const children = {}\n  const removed: Array<string> = [];\n  const isArray = Array.isArray(a);\n\n  const summary = new Array<ChangeRecord<string>>();\n  let hasChanged = false;\n\n  // Look for existing entries of A that are modified\n  for (const entry of entriesA) {\n    const outputKey = isArray ? `_${ entry[ 0 ] }` : entry[ 0 ]\n    const aValue = entry[ 1 ];\n    const bValue = (b as any)[ entry[ 0 ] ];\n    scannedKeys.add(entry[ 0 ]);\n\n    if (bValue === undefined) {\n      // B does not have a key from A\n      hasChanged = true;\n      if (assumeSameShape && !isArray) {\n        // If we're assuming it's the same shape, then _undefined_ is actually the value\n        (changed as any)[ outputKey ] = bValue;\n        summary.push([ `mutate`, outputKey, bValue ]);\n      } else {\n        // Key removed\n        removed.push(outputKey);\n        summary.push([ `del`, outputKey, aValue ]);\n      }\n      continue;\n    }\n\n    if (typeof aValue === `object`) {\n      const r = compareData(aValue, bValue, assumeSameShape, eq);\n      if (r.hasChanged) hasChanged = true;\n      (children as any)[ outputKey ] = r;\n      const childSummary = r.summary.map(sum => { return [ sum[ 0 ], outputKey + `.` + sum[ 1 ], sum[ 2 ] ] }) as Array<ChangeRecord<string>>;\n      summary.push(...childSummary);\n    } else {\n      if (!eq(aValue, bValue)) {\n        (changed as any)[ outputKey ] = bValue;\n        hasChanged = true;\n        summary.push([ `mutate`, outputKey, bValue ]);\n      }\n    }\n  }\n\n  // Look for entries in B that weren't in A\n  if (!assumeSameShape || isArray) {\n    for (const entry of entriesB) {\n      const key = isArray ? `_${ entry[ 0 ] }` : entry[ 0 ]\n\n      if (scannedKeys.has(entry[ 0 ])) continue;\n      (added as any)[ key ] = entry[ 1 ];\n      hasChanged = true;\n      summary.push([ `add`, key, entry[ 1 ] ])\n    }\n  }\n  return {\n    changed, added, removed, children, hasChanged, isArray, summary\n  }\n}","/* eslint-disable @typescript-eslint/unbound-method */\n//#region imports\nimport type { Reactive, ReactiveOrSource, ReactiveWritable, ReactiveOp, InitStreamOptions, WithValueOptions, CombineLatestOptions, RxValueTypes, RxValueTypeObject, PipeSet, ReactivePingable, ReactiveStream } from \"./Types.js\";\nimport type { ChunkOptions, DebounceOptions, FieldOptions, SingleFromArrayOptions, SplitOptions, FilterPredicate, SwitcherOptions, SyncOptions, ThrottleOptions } from \"./ops/Types.js\";\nimport type { RankFunction, RankOptions } from \"../data/Types.js\";\nimport type { TimeoutPingOptions, TimeoutValueOptions } from \"./sources/Types.js\";\nimport { type Interval, intervalToMs } from '../flow/IntervalType.js';\nimport { isWritable, messageHasValue, messageIsDoneSignal, opify } from \"./Util.js\";\nimport { initStream } from \"./InitStream.js\";\nimport { resolveSource } from './ResolveSource.js';\nimport * as SinkFns from './sinks/index.js';\nimport * as OpFns from './ops/index.js';\n\n//#endregion\n\n//#region exports\n//export * from './Chain.js';\nexport * from './ops/index.js';\nexport * from './sinks/index.js';\nexport * from './Graph.js';\nexport * from './Types.js';\nexport * from './ToArray.js';\nexport * from './ToGenerator.js';\nexport * from './Util.js';\nexport * from './Wrap.js';\nexport * from './ResolveSource.js';\nexport * from './Count.js';\nexport * as Dom from './Dom.js';\nexport * as From from './sources/index.js';\n//#endregion\n\nexport function run<TIn, TOut>(source: ReactiveOrSource<any>, ...ops: Array<ReactiveOp<any, any>>) {\n  let s = resolveSource(source);\n  for (const op of ops) {\n    // @ts-ignore\n    s = op(s);\n  }\n  return s;\n  //return s as Reactive<T2 | T3 | T4 | T5 | T6>;\n  //const raw = chainer<T1, T2, T3, T4, T5, T6>(...ops);\n  //return raw(source);\n}\n\nexport function writable<TIn, TOut>(source: ReactiveOrSource<TIn>, ...ops: Array<ReactiveOp<any, any>>): ReactiveWritable<TIn, TOut> {\n  let s = resolveSource(source);\n  const head = s;\n  for (const op of ops) {\n    // @ts-ignore\n    s = op(s);\n  }\n  let ss = s as any as Reactive<TOut>;\n  return {\n    ...ss,\n    set(value: TIn) {\n      if (isWritable(head)) {\n        head.set(value);\n      } else throw new Error(`Original source is not writable`);\n    }\n  } as ReactiveWritable<TIn, TOut>\n  //return s as Reactive<T2 | T3 | T4 | T5 | T6>;\n  //const raw = chainer<T1, T2, T3, T4, T5, T6>(...ops);\n  //return raw(source);\n}\n\n/**\n * Initialises a reactive that pipes values to listeners directly.\n * @returns \n */\nexport function manual<V>(options: Partial<InitStreamOptions> = {}): Reactive<V> & ReactiveWritable<V> {\n  const events = initStream<V>(options);\n  return {\n    dispose: events.dispose,\n    isDisposed: events.isDisposed,\n    set(value: V) {\n      events.set(value);\n    },\n    on: events.on,\n    onValue: events.onValue\n  };\n}\n\nexport const Sinks = {\n  setHtmlText: (options: SinkFns.SetHtmlOptions) => {\n    return (source: ReactiveOrSource<string>) => {\n      SinkFns.setHtmlText(source, options);\n    }\n  }\n}\n\nexport const Ops = {\n  /**\n * Annotates values with the result of a function.\n * The input value needs to be an object.\n * \n * For every value `input` emits, run it through `annotator`, which should\n * return the original value with additional fields.\n * \n * Conceptually the same as `transform`, just with typing to enforce result\n * values are V & TAnnotation\n * @param annotator \n * @returns \n */\n  annotate: <V, TAnnotation>(annotator: (input: V) => V & TAnnotation) => opify(OpFns.annotate, annotator),\n  /**\n   * Annotates the input stream using {@link ReactiveOp} as the source of annotations.\n   * The output values will have the shape of `{ value: TIn, annotation: TAnnotation }`.\n   * Meaning that the original value is stored under `.value`, and the annotation under `.annotation`.\n   * \n   * ```js\n   * // Emit values from an array\n   * const r1 = Rx.run(\n   *  Rx.From.array([ 1, 2, 3 ]),\n   *  Rx.Ops.annotateWithOp(\n   *    // Add the 'max' operator to emit the largest-seen value\n   *    Rx.Ops.sum()\n   *  )\n   * );\n   * const data = await Rx.toArray(r1);\n   * // Data =  [ { value: 1, annotation: 1 }, { value: 2, annotation: 3 }, { value: 3, annotation: 6 } ]\n   * ```\n   * @param annotatorOp \n   * @returns \n   */\n  annotateWithOp: <TIn, TAnnotation>(annotatorOp: ReactiveOp<TIn, TAnnotation>) => opify(OpFns.annotateWithOp, annotatorOp),\n  /**\n   * Takes a stream of values and chunks them up (by quantity or time elapsed),\n   * emitting them as an array.\n   * @param options \n   * @returns \n   */\n  chunk: <V>(options: Partial<ChunkOptions>): ReactiveOp<V, Array<V>> => {\n    return (source: ReactiveOrSource<V>) => {\n      return OpFns.chunk(source, options);\n    }\n  },\n\n  cloneFromFields: <V>(): ReactiveOp<V, V> => {\n    return (source: ReactiveOrSource<V>) => {\n      return OpFns.cloneFromFields(source);\n    }\n  },\n  /**\n * Merges values from several sources into a single source that emits values as an array.\n * @param options \n * @returns \n */\n  combineLatestToArray: <const T extends ReadonlyArray<ReactiveOrSource<any>>>(options: Partial<CombineLatestOptions> = {}) => {\n    return (sources: T) => {\n      return OpFns.combineLatestToArray(sources, options);\n    }\n  },\n  /**\n   * Merges values from several sources into a single source that emits values as an object.\n   * @param options\n   * @returns \n   */\n  combineLatestToObject: <const T extends Record<string, ReactiveOrSource<any>>>(options: Partial<CombineLatestOptions> = {}) => {\n    return (reactiveSources: T) => {\n      return OpFns.combineLatestToObject(reactiveSources, options);\n    }\n  },\n  /**\n * Debounce values from the stream. It will wait until a certain time\n * has elapsed before emitting latest value.\n * \n * Effect is that no values are emitted if input emits faster than the provided\n * timeout.\n * \n * See also: throttle\n * @param options \n * @returns \n */\n  debounce: <V>(options: Partial<DebounceOptions>): ReactiveOp<V, V> => {\n    return (source: ReactiveOrSource<V>) => {\n      return OpFns.debounce(source, options);\n    }\n  },\n  elapsed: <V>(): ReactiveOp<V, number> => opify(OpFns.elapsed),\n  /**\n   * Yields the value of a field from an input stream of values.\n   * Eg if the source reactive emits `{ colour: string, size: number }`,\n   * we might use `field` to pluck out the `colour` field, thus returning\n   * a stream of string values.\n   * @param fieldName \n   * @param options \n   * @returns \n   */\n  field: <TSource extends object, TFieldType>(fieldName: keyof TSource, options: FieldOptions<TSource, TFieldType>) => {\n    return (source: ReactiveOrSource<TSource>) => {\n      return OpFns.field(source, fieldName, options);\n    }\n  },\n  /**\n   * Filters the input stream, only re-emitting values that pass the predicate\n   * @param predicate \n   * @returns \n   */\n  filter: <V>(predicate: (value: V) => boolean) => opify(OpFns.filter, predicate),\n  /**\n   * Every upstream value is considered the target for interpolation.\n   * Output value interpolates by a given amount toward the target.\n   * @param options \n   * @returns \n   */\n  interpolate: <TIn = number>(options?: Partial<OpFns.OpInterpolateOptions>) => opify<TIn, ReactivePingable<number>>(OpFns.interpolate as any, options),\n  /**\n * Outputs the minimum numerical value of the stream.\n * A value is only emitted when minimum decreases.\n * @returns \n */\n  min: <TIn = number>(options?: OpFns.OpMathOptions) => opify<TIn, Reactive<number>>(OpFns.min, options),\n  /**\n   * Outputs the maxium numerical value of the stream.\n   * A value is only emitted when maximum increases.\n   * @returns \n   */\n  max: <TIn = number>(options?: OpFns.OpMathOptions) => opify<TIn, Reactive<number>>(OpFns.max, options),\n  sum: <TIn = number>(options?: OpFns.OpMathOptions) => opify<TIn, Reactive<number>>(OpFns.sum, options),\n  average: <TIn = number>(options?: OpFns.OpMathOptions) => opify<TIn, Reactive<number>>(OpFns.average, options),\n  tally: <TIn>(options?: OpFns.TallyOptions) => opify<TIn, Reactive<number>>(OpFns.tally, options),\n  rank: <TIn>(rank: RankFunction<TIn>, options?: RankOptions & OpFns.OpMathOptions) => opify<TIn>(OpFns.rank, rank, options),\n\n  pipe: <TInput, TOutput>(...streams: Array<Reactive<any> & ReactiveWritable<any>>) => {\n    return (source: ReactiveOrSource<TInput>) => {\n      const resolved = resolveSource(source);\n      const s = [ resolved, ...streams ] as PipeSet<TInput, TOutput>;\n      return OpFns.pipe(...s);\n    }\n  },\n\n  singleFromArray: <V>(options: Partial<SingleFromArrayOptions<V>> = {}) => {\n    return (source: ReactiveOrSource<Array<V>>) => {\n      return OpFns.singleFromArray(source, options)\n    }\n  },\n\n  split: <V>(options: Partial<SplitOptions> = {}) => {\n    return (source: ReactiveOrSource<V>) => {\n      return OpFns.split(source, options);\n    }\n  },\n  splitLabelled: <V>(labels: Array<string>) => {\n    return (source: ReactiveOrSource<V>) => {\n      return OpFns.splitLabelled(source, labels);\n    }\n  },\n  switcher: <TValue, TRec extends Record<string, FilterPredicate<TValue>>, TLabel extends keyof TRec>(cases: TRec, options: Partial<SwitcherOptions> = {}) => {\n    return (source: ReactiveOrSource<TValue>): Record<TLabel, Reactive<TValue>> => {\n      return OpFns.switcher(source, cases, options);\n    }\n  },\n  syncToArray: <const T extends ReadonlyArray<ReactiveOrSource<any>>>(options: Partial<SyncOptions> = {}) => {\n    return (reactiveSources: T): Reactive<RxValueTypes<T>> => {\n      return OpFns.syncToArray(reactiveSources, options);\n    }\n  },\n  syncToObject: <const T extends Record<string, ReactiveOrSource<any>>>(options: Partial<SyncOptions> = {}) => {\n    return (reactiveSources: T): Reactive<RxValueTypeObject<T>> => {\n      return OpFns.syncToObject(reactiveSources, options);\n    }\n  },\n  tapProcess: <In>(processor: ((value: In) => any)): ReactiveOp<In, In> => {\n    return (source: ReactiveOrSource<In>) => {\n      return OpFns.tapProcess(source, processor);\n    }\n  },\n  tapStream: <In>(divergedStream: ReactiveWritable<In>): ReactiveOp<In, In> => {\n    return (source: ReactiveOrSource<In>) => {\n      return OpFns.tapStream(source, divergedStream);\n    }\n  },\n  tapOps: <In, Out>(...ops: Array<ReactiveOp<In, Out>>) => {\n    return (source: ReactiveOrSource<In>) => {\n      return OpFns.tapOps(source, ...ops);\n    }\n  },\n\n  /**\n * Throttle values from the stream.\n * Only emits a value if some minimum time has elapsed.\n * @param options \n * @returns \n */\n  throttle: <V>(options: Partial<ThrottleOptions>) => opify<V>(OpFns.throttle, options),\n  /**\n   * Trigger a value if 'source' does not emit a value within an interval.\n   * Trigger value can be a fixed value, result of function, or step through an iterator.\n   * @param options \n   * @returns \n   */\n  timeoutValue: <V, TTriggerValue>(options: TimeoutValueOptions<TTriggerValue>) => {\n    return (source: ReactiveOrSource<V>) => {\n      return OpFns.timeoutValue<V, TTriggerValue>(source, options);\n    }\n  },\n\n  timeoutPing: <V>(options: TimeoutPingOptions) => {\n    return (source: ReactiveOrSource<V>) => {\n      return OpFns.timeoutPing(source, options);\n    }\n  },\n  transform: <In, Out>(transformer: ((value: In) => Out), options: Partial<OpFns.TransformOpts> = {}): ReactiveOp<In, Out> => {\n    return (source: ReactiveOrSource<In>) => {\n      return OpFns.transform(source, transformer, options);\n    }\n  },\n\n  /**\n  * Reactive where last (or a given initial) value is available to read\n  * @param opts \n  * @returns \n  */\n  withValue: <V>(opts: Partial<WithValueOptions<V>>): ReactiveOp<V, V> => {\n    return opify<V>(OpFns.withValue, opts);\n  },\n} as const;\n\n\n// export const chain = <TIn, TOut>(...ops: Array<ReactiveOp<TIn, TOut>>) => {\n//   return (source: ReactiveOrSource<TIn>) => {\n//     for (const op of ops) {\n//       // @ts-expect-error\n//       source = op(source);\n//     }\n//     return source as any as Reactive<TOut>;\n//   }\n// }\n\n// export const chainStream = <TIn, TOut>(...ops: Array<ReactiveOp<TIn, TOut>>): ReactiveStream<TIn, TOut> => {\n//   const stream = manual<TIn>();\n//   const c = chain(...ops);\n//   const x = c(stream);\n//   return x;\n// }\n\n\n\n// function chainx<TIn, TOut>(...ops: Array<ReactiveOp<any, any>>) {\n//   return (source: ReactiveOrSource<TIn>) => {\n//     for (const op of ops) {\n//       source = op(source);\n//     }\n//     return source as any as Reactive<TOut>;\n//   }\n// }\n\n\n\n// export function runWithInitial<TIn, TOut>(initial: TOut, source: ReactiveOrSource<TIn>, ...ops: Array<ReactiveOp<any, any>>): ReactiveInitial<TOut> & ReactiveDisposable<TOut> {\n//   let lastValue = initial;\n//   const raw = prepareOps<TIn, TOut>(...ops);\n//   const r = raw(source);\n//   let disposed = false;\n\n//   r.onValue(value => {\n//     lastValue = value;\n//   });\n\n//   return {\n//     ...r,\n//     isDisposed() {\n//       return disposed\n//     },\n//     dispose(reason) {\n//       if (disposed) return;\n//       if (isDisposable(r)) {\n//         r.dispose(reason);\n//       }\n//       disposed = true;\n//     },\n//     last() {\n//       return lastValue;\n//     },\n//   }\n// }\n\n/**\n * Grabs the next value emitted from `source`.\n * By default waits up to a maximum of one second.\n * Handles subscribing and unsubscribing.\n * \n * ```js\n * const value = await Rx.takeNextValue(source);\n * ```\n * \n * Throws an error if the source closes without\n * a value or the timeout is reached.\n * \n * @param source \n * @param maximumWait \n * @returns \n */\nexport async function takeNextValue<V>(source: ReactiveOrSource<V>, maximumWait: Interval = 1000): Promise<V> {\n  const rx = resolveSource(source);\n  let off = () => {/** no-op */ };\n  let watchdog: ReturnType<typeof globalThis.setTimeout> | undefined;\n\n  const p = new Promise<V>((resolve, reject) => {\n    off = rx.on(message => {\n      if (watchdog) clearTimeout(watchdog);\n      if (messageHasValue(message)) {\n        off();\n        resolve(message.value);\n      } else {\n        if (messageIsDoneSignal(message)) {\n          reject(new Error(`Source closed. ${ message.context ?? `` }`));\n          off();\n        }\n      }\n    });\n\n    watchdog = setTimeout(() => {\n      watchdog = undefined;\n      off();\n      reject(new Error(`Timeout waiting for value (${ JSON.stringify(maximumWait) })`))\n    }, intervalToMs(maximumWait));\n  });\n  return p;\n}\n\n/**\n * Connects reactive A to B, optionally transforming the value as it does so.\n * \n * Returns a function to unsubcribe A->B\n * @param a \n * @param b \n * @param transform \n */\nexport const to = <TA, TB>(a: Reactive<TA>, b: ReactiveWritable<TB>, transform?: (valueA: TA) => TB, closeBonA = false) => {\n  const unsub = a.on(message => {\n    if (messageHasValue(message)) {\n      const value = transform ? transform(message.value) : message.value as TB;\n      b.set(value);\n    } else if (messageIsDoneSignal(message)) {\n      unsub();\n      if (closeBonA) {\n        b.dispose(`Source closed (${ message.context ?? `` })`);\n      }\n    } else {\n      // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n      console.warn(`Unsupported message: ${ JSON.stringify(message) }`);\n    }\n\n  });\n  return unsub;\n}","import { getErrorMessage } from \"../../debug/GetErrorMessage.js\";\nimport { continuously } from \"../../flow/Continuously.js\";\nimport { intervalToMs } from \"../../flow/IntervalType.js\";\nimport { sleep } from \"../../flow/Sleep.js\";\nimport { initLazyStream } from \"../InitStream.js\";\nimport type { ReactivePingable } from \"../Types.js\";\nimport type { FunctionFunction, FunctionOptions } from \"./Types.js\";\n\n\n/**\n * Produces a reactive from the basis of a function. `callback` is executed, with its result emitted via the returned reactive.\n * \n * ```js\n * // Produce a random number every second\n * const r = Rx.From.func(Math.random, { interval: 1000 });\n * ```\n * \n * `callback` can be called repeatedly by providing the `interval` option to set the rate of repeat.\n * Looping can be limited with `options.maximumRepeats`, or passing a signal `options.signal`\n * and then activating it. \n * ```js\n * // Reactive that emits a random number every second, five times\n * const r1 = Rx.From.func(Math.random, { interval: 1000, maximumRepeats: 5 }\n * ```\n * \n * ```js\n * // Generate a random number every second until ac.abort() is called\n * const ac = new AbortController();\n * const r2 = Rx.From.func(Math.random, { interval: 1000, signal: ac.signal });\n * ```\n * \n * The third option is for `callback` to fire the provided abort function.\n * ```js\n * Rx.From.func((abort) => {\n *  if (Math.random() > 0.5) abort('Random exit');\n *  return 1;\n * });\n * ```\n *\n * By default has a laziness of 'very' meaning that `callback` is run only when there's a subscriber \n * By default stream closes if `callback` throws an error. Use `options.closeOnError:'ignore'` to change.\n * @param callback \n * @param options \n * @returns \n */\n// eslint-disable-next-line unicorn/prevent-abbreviations\nexport function func<V>(callback: FunctionFunction<V>, options: Partial<FunctionOptions> = {}): ReactivePingable<V> {\n  const maximumRepeats = options.maximumRepeats ?? Number.MAX_SAFE_INTEGER;\n  const closeOnError = options.closeOnError ?? true;\n  const intervalMs = options.interval ? intervalToMs(options.interval) : -1;\n  let manual = options.manual ?? false;\n\n  // If niether interval or manual is set, assume manual\n  if (options.interval === undefined && options.manual === undefined) manual = true;\n\n  if (manual && options.interval) throw new Error(`If option 'manual' is set, option 'interval' cannot be used`);\n  const predelay = intervalToMs(options.predelay, 0);\n  const lazy = options.lazy ?? `very`;\n  const signal = options.signal;\n\n  const internalAbort = new AbortController();\n  const internalAbortCallback = (reason: string) => { internalAbort.abort(reason) };\n  let sentResults = 0;\n  let enabled = false;\n\n  const done = (reason: string) => {\n    events.dispose(reason);\n    enabled = false;\n    if (run) run.cancel();\n  }\n\n  const ping = async () => {\n    if (!enabled) return false;\n    if (predelay) await sleep(predelay);\n    if (sentResults >= maximumRepeats) {\n      done(`Maximum repeats reached ${ maximumRepeats.toString() }`);\n      return false;\n    }\n    //console.log(`sent: ${ sentResults } max: ${ maximumRepeats }`);\n    try {\n      if (signal?.aborted) {\n        done(`Signal (${ signal.aborted })`);\n        return false;\n      }\n      const value = await callback(internalAbortCallback);\n      sentResults++;\n      events.set(value);\n      return true;\n    } catch (error) {\n      if (closeOnError) {\n        done(`Function error: ${ getErrorMessage(error) }`);\n        return false;\n      } else {\n        events.signal(`warn`, getErrorMessage(error));\n        return true;\n      }\n    }\n  }\n\n  const run = manual ? undefined : continuously(async () => {\n    const pingResult = await ping();\n    if (!pingResult) return false;\n\n    // if (!loop) {\n    //   done(`fromFunction done`);\n    //   return false; // Stop loop\n    // }\n    if (internalAbort.signal.aborted) {\n      done(`callback function aborted (${ internalAbort.signal.reason })`);\n      return false\n    }\n\n  }, intervalMs);\n\n  const events = initLazyStream<V>({\n    lazy,\n    onStart() {\n      enabled = true;\n      if (run) run.start();\n    },\n    onStop() {\n      console.log(`onStop`);\n      enabled = false;\n      if (run) run.cancel();\n    },\n  });\n\n  if (lazy === `never` && run) run.start();\n  return { ...events, ping };\n}\n\n","import { intervalToMs, type Interval } from '../flow/IntervalType.js';\nimport { type IsEqual } from '../util/IsEqual.js';\nimport { sleep, type SleepOpts } from '../flow/Sleep.js';\nimport { isAsyncIterable, isIterable } from './Iterable.js';\nimport { toStringDefault } from '../util/ToString.js';\nimport type { ForEachOptions, ToArrayOptions } from './Types.js';\n\n/**\n * Yield values from `array`, one at a time.\n * Use `interval` to add time between each item.\n * The first item is yielded without delay.\n * \n * @param array Array of values\n * @param interval Interval (defaults: 1ms)\n */\nexport async function* fromArray<V>(array: Array<V>, interval: Interval = 1): AsyncGenerator<V> {\n  for (const v of array) {\n    yield v;\n    await sleep(interval);\n  }\n}\n\n/**\n * Yield values from `iterable`, one at a time.\n * Use `interval` to add time between each item.\n * The first item is yielded without delay.\n * @param iterable Iterable or AsyncIterable\n * @param [interval=1] Interval to wait between yield\n */\nexport async function* fromIterable<V>(iterable: Iterable<V> | AsyncIterable<V>, interval: Interval = 1): AsyncGenerator<V> {\n  for await (const v of iterable) {\n    yield v;\n    await sleep(interval);\n  }\n}\n\nexport async function* chunks<V>(it: AsyncIterable<V>, size: number) {\n  // Source: https://surma.github.io/underdash/\n  let buffer = [];\n  for await (const v of it) {\n    buffer.push(v);\n    if (buffer.length === size) {\n      yield buffer;\n      buffer = [];\n    }\n  }\n  if (buffer.length > 0) yield buffer;\n}\n\n\nexport async function* concat<V>(...its: ReadonlyArray<AsyncIterable<V>>) {\n  // Source: https://surma.github.io/underdash/\n  for await (const it of its) yield* it;\n}\n\nexport async function* dropWhile<V>(\n  it: AsyncIterable<V>,\n  f: (v: V) => boolean\n) {\n  for await (const v of it) {\n    if (!f(v)) {\n      yield v;\n    }\n  }\n}\n\n/**\n * Loops over a generator until it finishes, calling `callback`.\n * Useful if you don't care about the value generator produces, just the number of loops.\n * \n * In this version, we do a `for await of` over `gen`, and also `await callback()`. \n\n * ```js\n * await until(count(5), () => {\n * // do something 5 times\n * });\n * ```\n * \n * If you want the value from the generator, use a `for of` loop as usual.\n * \n * If `callback` explicitly returns _false_, the generator is aborted.\n * @param it Generator to run\n * @param callback Code to call for each iteration\n */\n// eslint-disable-next-line @typescript-eslint/no-invalid-void-type\nexport const until = async (it: AsyncIterable<any> | Iterable<any>, callback: () => (void | Promise<boolean> | undefined | boolean | Promise<undefined> | Promise<void>)): Promise<undefined> => {\n  for await (const _ of it) {\n    const value = await callback();\n    if (typeof value === `boolean` && !value) break;\n  }\n}\n\n/**\n * This generator will repeat another generator up until some condition. This is the version\n * that can handle async generators.\n * \n * For example, {@link count} will count from 0..number and then finish:\n * ```js\n * for (const v of count(5)) {\n *  // v: 0, 1, 2, 3, 4\n * }\n * ```\n * \n * But what if we want to repeat the count? We have to provide a function to create the generator,\n * rather than using the generator directly, since it's \"one time use\"\n * ```js\n * for await (const v of repeat(() => count(5))) {\n *  // v: 0, 1, 2, 3, 4, 0, 1, 2, 3, 4, 0, ...\n *  // warning: never ends\n * }\n * ```\n * \n * Limiting the number of repeats can be done by passing in extra parameters\n * ```js\n * repeat(generator, { count: 5} ); // Iterate over `generator` five times\n * ```\n * \n * ```js\n * const ac = new AbortController();\n * repeat(generator, { signal: ac.signal }); // Pass in signal\n * ...\n * ac.abort(); // Trigger signal at some point\n * ```\n * @param genCreator \n * @param repeatsOrSignal \n */\nexport const repeat = async function*<T>(genCreator: () => Iterable<T> | AsyncIterable<T>, repeatsOrSignal: number | AbortSignal): AsyncGenerator<T> {\n  const repeats = typeof repeatsOrSignal === `number` ? repeatsOrSignal : Number.POSITIVE_INFINITY;\n  const signal = typeof repeatsOrSignal === `number` ? undefined : repeatsOrSignal;\n  let count = repeats;\n\n  while (true) {\n    for await (const v of genCreator()) {\n      yield v;\n      if (signal?.aborted) break;\n    }\n    if (Number.isFinite(repeats)) {\n      count--;\n      if (count === 0) break;\n    }\n    if (signal?.aborted) break;\n  }\n}\n\n/**\n * Returns true if items in two iterables are equal, as\n * determined by the `equality` function.\n * Order matters. It compares items at the same 'step' of each iterable.\n * @param it1\n * @param it2\n * @param equality\n * @returns\n */\nexport async function equals<V>(\n  it1: AsyncIterable<V>,\n  it2: AsyncIterable<V>,\n  equality?: IsEqual<V>\n) {\n  // https://surma.github.io/underdash/\n  const iit1 = it1[ Symbol.asyncIterator ]();// it1[ Symbol.iterator ]();\n  const iit2 = it2[ Symbol.asyncIterator ]();\n  while (true) {\n    const index1 = await iit1.next();\n    const index2 = await iit2.next();\n    if (equality !== undefined) {\n      if (!equality(index1.value, index2.value)) return false;\n    } else if (index1.value !== index2.value) return false;\n    if (index1.done ?? index2.done) return index1.done && index2.done;\n  }\n}\n\nexport async function every<V>(it: AsyncIterable<V>, f: (v: V) => boolean | Promise<boolean>) {\n  for await (const v of it) {\n    const result = await f(v);\n    if (!result) return false;\n  }\n  return true;\n}\n\nexport async function* fill<V>(it: AsyncIterable<V>, v: V) {\n  // https://surma.github.io/underdash/\n  for await (const _ of it) yield v;\n}\n\n/**\n * Filters an iterable, only yielding items which match `f`.\n *\n * ```js\n * filter([1, 2, 3, 4], e => e % 2 == 0);\n * returns [2, 4]\n * ```\n * @param it\n * @param f\n */\nexport async function* filter<V>(it: AsyncIterable<V>, f: (v: V) => boolean | Promise<boolean>) {\n  // https://surma.github.io/underdash/\n  for await (const v of it) {\n    if (!await f(v)) continue;\n    yield v;\n  }\n}\n\n\nexport async function find<V>(it: AsyncIterable<V>, f: (v: V) => boolean | Promise<boolean>) {\n  // https://surma.github.io/underdash/\n  for await (const v of it) {\n    if (await f(v)) return v;\n  }\n}\n\n\nexport async function* flatten<V>(it: AsyncIterable<V>) {\n  // https://surma.github.io/underdash/\n  for await (const v of it) {\n    if (typeof v === `object`) {\n      if (Array.isArray(v)) {\n        for (const vv of v) yield vv;\n      } else if (isAsyncIterable(v)) {\n        for await (const vv of v) {\n          yield vv;\n        }\n      } else if (isIterable(v)) {\n        for (const vv of v) {\n          yield vv;\n        }\n      }\n    } else {\n      yield v;\n    }\n\n  }\n}\n\n/**\n * Iterates over an async iterable or array, calling `fn` for each value, with optional\n * interval between each loop. If the async `fn` returns _false_, iterator cancels.\n *\n * ```\n * import { forEach } from \"https://unpkg.com/ixfx/dist/flow.js\"\n * // Prints items from array every second\n * await forEach([0,1,2,3], i => console.log(i), 1000);\n * ```\n *\n * ```\n * // Retry up to five times, with 5 seconds between each attempt\n * await forEach(count(5), i=> {\n *  try {\n *    await doSomething();\n *    return false; // Succeeded, exit early\n *  } catch (ex) {\n *    console.log(ex);\n *    return true; // Keep trying\n *  }\n * }, 5000);\n * ```\n * @param iterator Iterable thing to loop over\n * @param fn Function to invoke on each item. If it returns _false_ loop ends.\n * @param options Options\n * @typeParam V Type of iterable\n */\nexport const forEach = async function <T>(\n  iterator: AsyncIterable<T> | Array<T>,\n  fn: (v?: T) => Promise<boolean> | Promise<void> | boolean | void,\n  options: Partial<ForEachOptions> = {}\n) {\n  const interval = options.interval;\n  if (Array.isArray(iterator)) {\n    // Handle array\n    for (const x of iterator) {\n      const r = await fn(x);\n      if (typeof r === `boolean` && !r) break;\n      if (interval) await sleep(interval);\n    }\n  } else {\n    // Handle an async iterator\n    for await (const x of iterator) {\n      const r = await fn(x);\n      if (typeof r === `boolean` && !r) break;\n      if (interval) await sleep(interval);\n    }\n  }\n};\n// eslint-disable-next-line @typescript-eslint/no-invalid-void-type\n// export async function forEach<V>(it: AsyncIterable<V>, f: (v: V) => void | boolean | Promise<boolean | void>) {\n//   // https://surma.github.io/underdash/\n//   for await (const v of it) {\n//     const result = await f(v);\n//     if (typeof result === `boolean` && !result) break;\n//   }\n// }\n\n/**\n * Maps an iterable through function `f`\n * ```js\n * // For every input value, multiply it by itself\n * map([1, 2, 3], e => e*e)\n * // Yields: 1, 4, 9\n * ```\n * \n * It can also be used to transform types:\n * ```js\n * map([1, 2, 3], e => { value: e });\n * // Yields: { value: 1 }, { value: 2 }, { value: 3 }\n * ```\n * @param it\n * @param f\n */\n//eslint-disable-next-line func-style\nexport async function* map<V, X>(it: AsyncIterable<V>, f: (v: V) => X) {\n  // https://surma.github.io/underdash/\n\n  for await (const v of it) {\n    yield f(v);\n  }\n}\n\n\nexport async function* max<V>(it: AsyncIterable<V>, gt = ((a: V, b: V) => a > b)) {\n  let max: V | undefined;\n  for await (const v of it) {\n    if (max === undefined) {\n      max = v;\n      yield (max);\n      continue;\n    }\n    // If V is bigger than max, we have a new max\n    if (gt(v, max)) {\n      max = v;\n      yield v;\n    }\n  }\n}\n\n/**\n * Returns the minimum seen of an iterable as it changes.\n * Streaming result: works with endless iterables.\n * \n * Note that `gt` function returns true if A is _greater_ than B, even\n * though we're looking for the minimum.\n * \n * ```js\n * // Rank objects based on 'v' value\n * const rank = (a,b) => a.v > b.v;\n * min([\n *  {i:0,v:1},\n *  {i:1,v:9},\n *  {i:2,v:-2}\n * ], rank);\n * // Yields: {i:2, v:1}, {i:2,v:-2}\n * ```\n * @param it Iterable\n * @param gt Should return _true_ if `a` is greater than `b`.\n * @returns\n */\nexport async function* min<V>(it: AsyncIterable<V>, gt = (a: V, b: V) => a > b) {\n  let min: V | undefined;\n  for await (const v of it) {\n    if (min === undefined) {\n      min = v;\n      yield min;\n      continue;\n    }\n    // If min is bigger than V, V is the new min\n    if (gt(min, v)) {\n      min = v;\n      yield v;\n    }\n  }\n  return min;\n}\n\nexport async function reduce<V>(\n  it: AsyncIterable<V>,\n  f: (accumulator: V, current: V) => V,\n  start: V\n) {\n  // https://surma.github.io/underdash/\n\n  for await (const v of it) start = f(start, v);\n  return start;\n}\n\n/**\n * Calls `callback` whenever the async generator produces a value.\n * \n * When using `asCallback`, call it with `await` to let generator \n * run its course before continuing:\n * ```js\n * await asCallback(tick({ interval:1000, loops:5 }), x => {\n *  // Gets called 5 times, with 1000ms interval\n * });\n * console.log(`Hi`); // Prints after 5 seconds\n * ```\n * \n * Or if you skip the `await`, code continues and callback will still run:\n * ```js\n * asCallback(tick({ interval: 1000, loops: 5}), x => {\n *  // Gets called 5 times, with 1000ms interval\n * });\n * console.log(`Hi`); // Prints immediately\n * ```\n * @param input \n * @param callback \n */\nexport async function asCallback<V>(input: AsyncIterable<V>, callback: (v: V) => unknown, onDone?: () => void) {\n  for await (const value of input) {\n    callback(value);\n  }\n  if (onDone) onDone();\n}\n\nexport async function* slice<V>(\n  it: AsyncIterable<V>,\n  start = 0,\n  end = Number.POSITIVE_INFINITY\n) {\n  // https://surma.github.io/underdash/\n  const iit = it[ Symbol.asyncIterator ]();\n  if (end < start) throw new Error(`Param 'end' should be more than 'start'`);\n\n  for (; start > 0; start--, end--) await iit.next();\n\n  for await (const v of it) {\n    if (end-- > 0) {\n      yield v;\n    } else {\n      break;\n    }\n  }\n}\n\n/**\n * Enumerates over an input iterable, with a delay between items.\n * @param it \n * @param delay \n */\nexport async function* withDelay<V>(it: Iterable<V>, delay: Interval) {\n  for (const v of it) {\n    await sleep(delay);\n    yield v;\n  }\n}\n\n/***\n * Returns the next IteratorResult,\n * throwing an error if it does not happen\n * within `interval` (default: 1s)\n */\nexport async function nextWithTimeout<V>(it: AsyncIterableIterator<V> | IterableIterator<V>, options: SleepOpts<any>) {\n  const ms = intervalToMs(options, 1000);\n\n  const value: IteratorResult<V> | undefined = await Promise.race([\n    (async () => {\n      await sleep({ millis: ms, signal: options.signal });\n      // eslint-disable-next-line unicorn/no-useless-undefined\n      return undefined;\n    })(),\n    (async () => {\n      return await it.next();\n    })()\n  ]);\n  if (value === undefined) throw new Error(`Timeout`);\n  return value;\n}\n\nexport async function some<V>(it: AsyncIterable<V>, f: (v: V) => boolean | Promise<boolean>) {\n  // https://surma.github.io/underdash/\n  for await (const v of it) {\n    if (await f(v)) return true;\n  }\n  return false;\n}\n\n// export async function* takeWhile<V>(\n//   it: AsyncIterable<V>,\n//   f: (v: V) => boolean\n// ) {\n//   // https://surma.github.io/underdash/\n\n//   for await (const v of it) {\n//     if (!f(v)) return;\n//     yield v;\n//   }\n// }\n\n/**\n * Returns an array of values from an iterator.\n *\n * ```js\n * const data = await toArray(adsrIterable(opts, 10));\n * ```\n *\n * Note: If the iterator is infinite, be sure to provide limits via the options.\n * ```js\n * // Return maximum five items\n * const data = await toArray(iterable, { limit: 5 });\n * // Return results for a maximum of 5 seconds\n * const data = await toArray(iterable, { elapsed: 5000 });\n * ```\n * Note that limits are ORed, `toArray` will finish if either of them is true.\n * \n * @param it Asynchronous iterable\n * @param options Options when converting to array\n * @returns\n */\nexport async function toArray<V>(it: AsyncIterable<V>, options: Partial<ToArrayOptions> = {}): Promise<Array<V>> {\n  // https://2ality.com/2016/10/asynchronous-iteration.html\n  const result = [];\n  const iterator = it[ Symbol.asyncIterator ]();\n  const started = Date.now();\n  const maxItems = options.limit ?? Number.POSITIVE_INFINITY;\n  const whileFunc = options.while;\n  const maxElapsed = intervalToMs(options.elapsed, Number.POSITIVE_INFINITY);\n\n  while (result.length < maxItems && (Date.now() - started < maxElapsed)) {\n    if (whileFunc) {\n      if (!whileFunc(result.length)) break;\n    }\n    const r = await iterator.next();\n    if (r.done) break;\n    //eslint-disable-next-line functional/immutable-data\n    result.push(r.value);\n  }\n  return result;\n}\n\n\nexport async function* unique<V>(\n  iterable: AsyncIterable<V> | Array<AsyncIterable<V>>\n) {\n  const buffer: Array<any> = [];\n  const itera: Array<AsyncIterable<V>> = Array.isArray(iterable) ? iterable : [ iterable ];\n  for await (const it of itera) {\n    for await (const v of it) {\n      if (buffer.includes(v)) continue;\n      buffer.push(v);\n      yield v;\n    }\n  }\n}\n\nexport async function* uniqueByValue<T>(input: AsyncIterable<T>, toString: (value: T) => string = toStringDefault, seen: Set<string> = new Set<string>()): AsyncGenerator<T> {\n  for await (const v of input) {\n    const key = toString(v);\n    if (seen.has(key)) continue;\n    seen.add(key);\n    yield v;\n  }\n}\n\n/**\n * Returns unique items from iterables, given a particular key function\n * ```js\n * unique([{i:0,v:2},{i:1,v:3},{i:2,v:2}], e => e.v);\n * Yields:  [{i:0,v:2},{i:1,v:3}]\n * @param it\n * @param f\n */\n//eslint-disable-next-line func-style\n// export async function* unique<V>(\n//   it: AsyncIterable<V>,\n//   f: (id: V) => V = (id) => id\n// ) {\n//   // https://surma.github.io/underdash/\n//   const buffer: Array<V> = [];\n\n//   for await (const v of it) {\n//     const fv = f(v);\n//     if (buffer.includes(fv)) continue;\n//     buffer.push(fv);\n//     yield v;\n//   }\n// }\n\n/**\n * Combine same-positioned items from several iterables\n * ```js\n * zip( [1, 2, 3], [4, 5, 6], [7, 8, 9] );\n * Yields: [ [1, 4, 7], [2, 5, 8], [3, 6, 9] ]\n * ```\n * @param its\n * @returns\n */\nexport async function* zip<V>(...its: ReadonlyArray<AsyncIterable<V>>) {\n  // https://surma.github.io/underdash/\n  const iits = its.map((it) => it[ Symbol.asyncIterator ]());\n\n  while (true) {\n    const vs = await Promise.all(iits.map((it) => it.next()));\n    if (vs.some((v) => v.done)) return;\n    yield vs.map((v) => v.value as V);\n  }\n}\n","/* eslint-disable @typescript-eslint/unbound-method */\nimport { nextWithTimeout } from \"../../iterables/IterableAsync.js\";\nimport { intervalToMs } from \"../../flow/IntervalType.js\";\nimport { initLazyStream } from \"../InitStream.js\";\nimport { isAsyncIterable } from \"../../iterables/Iterable.js\";\nimport type { Reactive } from \"../Types.js\";\nimport type { GeneratorOptions } from \"./Types.js\";\nimport { StateMachine } from \"../../flow/index.js\";\n\n/**\n * Creates a Reactive from an AsyncGenerator or Generator\n * @param gen \n * @returns \n */\n// export function readFromGenerator<V>(gen: AsyncGenerator<V> | Generator<V>) {\n//   const rx = initStream<V>();\n//   // eslint-disable-next-line @typescript-eslint/no-misused-promises\n//   setTimeout(async () => {\n//     try {\n//       for await (const value of gen) {\n//         rx.set(value);\n//       }\n//       rx.dispose(`Source generator complete`);\n//     } catch (error) {\n//       console.error(error);\n//       rx.dispose(`Error while iterating`);\n//     }\n//   }, 1);\n//   return rx;\n// }\n\n/**\n * Creates a readable reactive based on a (async)generator or iterator\n * ```js\n * // Generator a random value every 5 seconds\n * const valuesOverTime = Flow.interval(() => Math.random(), 5000);\n * // Wrap the generator\n * const r = Rx.From.iterator(time);\n * // Get notified when there is a new value\n * r.onValue(v => {\n *   console.log(v);\n * });\n * ```\n * \n * Awaiting values could potentially hang code. Thus there is a `readTimeout`, the maximum time to wait for a value from the generator. Default: 5 minutes.\n * If `signal` is given, this will also cancel waiting for the value.\n * @param source \n */\nexport function iterator<V>(source: IterableIterator<V> | Array<V> | AsyncIterableIterator<V> | Generator<V> | AsyncGenerator<V>, options: Partial<GeneratorOptions> = {}): Reactive<V> {\n  const lazy = options.lazy ?? `very`;\n  const log = options.traceLifecycle ? (message: string) => { console.log(`Rx.From.iterator ${ message }`); } : (_: string) => {/* no-up */ }\n\n  const readIntervalMs = intervalToMs(options.readInterval, 5);\n  const readTimeoutMs = intervalToMs(options.readTimeout, 5 * 60 * 1000);\n  const whenStopped = options.whenStopped ?? `continue`;\n\n  let iterator: IterableIterator<V> | AsyncIterableIterator<V> | undefined;\n  //let reading = false;\n  let ourAc: AbortController | undefined;\n  let sm = StateMachine.init({\n    idle: [ `wait_for_next` ],\n    wait_for_next: [ `processing_result`, `stopping`, `disposed` ],\n    processing_result: [ `queued`, `disposed`, `stopping` ],\n    queued: [ `wait_for_next`, `disposed`, `stopping` ],\n    stopping: `idle`,\n    // eslint-disable-next-line unicorn/no-null\n    disposed: null\n  }, `idle`);\n\n  const onExternalSignal = () => {\n    log(`onExternalSignal`);\n    ourAc?.abort(options.signal?.reason);\n  }\n  if (options.signal) {\n    options.signal.addEventListener(`abort`, onExternalSignal, { once: true });\n  };\n\n  const read = async () => {\n    log(`read. State: ${ sm.value }`);\n    ourAc = new AbortController();\n    try {\n      sm = StateMachine.to(sm, `wait_for_next`);\n      // @ts-expect-error\n      const v = await nextWithTimeout(iterator, { signal: ourAc.signal, millis: readTimeoutMs });\n      sm = StateMachine.to(sm, `processing_result`);\n      ourAc?.abort(`nextWithTimeout completed`);\n\n      if (v.done) {\n        log(`read v.done true`);\n        events.dispose(`Generator complete`);\n        //reading = false;\n        sm = StateMachine.to(sm, `disposed`);\n      }\n      //if (!reading) return;\n      if (sm.value === `stopping`) {\n        log(`read. sm.value = stopping`)\n        sm = StateMachine.to(sm, `idle`);\n        return;\n      }\n      if (sm.value === `disposed`) {\n        log(`read. sm.value = disposed`);\n        return;\n      }\n      events.set(v.value);\n\n    } catch (error) {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-call\n      events.dispose(`Generator error: ${ (error as any).toString() }`);\n      return;\n    }\n    //if (events.isDisposed()) return;\n    //if (!reading) return;\n\n    if (sm.value === `processing_result`) {\n      sm = StateMachine.to(sm, `queued`);\n      log(`scheduling read. State: ${ sm.value }`);\n      // eslint-disable-next-line @typescript-eslint/no-misused-promises\n      setTimeout(read, readIntervalMs);\n    } else {\n      sm = StateMachine.to(sm, `idle`);\n    }\n  }\n\n  const events = initLazyStream<V>({\n    ...options,\n    lazy,\n    onStart() {\n      log(`onStart state: ${ sm.value } whenStopped: ${ whenStopped }`);\n      if (sm.value !== `idle`) return;\n      if ((sm.value === `idle` && whenStopped === `reset`) || iterator === undefined) {\n        iterator = isAsyncIterable(source) ? source[ Symbol.asyncIterator ]() : source[ Symbol.iterator ]();\n      }\n      //reading = true;\n      void read();\n    },\n    onStop() {\n      log(`onStop state: ${ sm.value } whenStopped: ${ whenStopped }`);\n      //reading = false;\n      sm = StateMachine.to(sm, `stopping`);\n      if (whenStopped === `reset`) {\n        log(`onStop reiniting iterator`);\n        iterator = isAsyncIterable(source) ? source[ Symbol.asyncIterator ]() : source[ Symbol.iterator ]();\n      }\n    },\n    onDispose(reason: string) {\n      log(`onDispose (${ reason })`);\n      ourAc?.abort(`Rx.From.iterator disposed (${ reason })`);\n      if (options.signal) options.signal.removeEventListener(`abort`, onExternalSignal);\n    },\n  });\n\n  // const readingStart = () => {\n\n  // }\n  //if (!lazy) readingStart();\n\n  // return {\n  //   on: events.on,\n  //   value: events.value,\n  //   dispose: events.dispose,\n  //   isDisposed: events.isDisposed\n  // }\n  return events;\n}\n","import { isAsyncIterable, isIterable } from \"../iterables/Iterable.js\";\nimport { func } from \"./sources/Function.js\";\nimport { iterator } from \"./sources/Iterator.js\";\nimport type { GeneratorOptions, FunctionOptions } from \"./sources/Types.js\";\nimport type { Reactive, ReactiveOrSource } from \"./Types.js\";\nimport { isReactive, isWrapped } from \"./Util.js\";\n\nexport type ResolveSourceOptions = {\n  /**\n   * Options when creating a reactive from a generator\n   * Default:  `{ lazy: true, interval: 5 }`\n   */\n  generator: GeneratorOptions\n  /**\n   * Options when creating a reactive from a function.\n   */\n  function: FunctionOptions\n}\n\n/**\n * Resolves various kinds of sources into a Reactive.\n * If `source` is an iterable/generator, it gets wrapped via `generator()`.\n * \n * Default options:\n * * generator: `{ lazy: true, interval: 5 }`\n * @param source \n * @returns \n */\nexport const resolveSource = <V>(source: ReactiveOrSource<V>, options: Partial<ResolveSourceOptions> = {}): Reactive<V> => {\n  if (isReactive(source)) return source;\n  const generatorOptions = options.generator ?? { lazy: `initial`, interval: 5 }\n  const functionOptions = options.function ?? { lazy: `very` }\n  // eslint-disable-next-line unicorn/prefer-ternary\n  if (Array.isArray(source)) {\n    return iterator(source.values(), generatorOptions);\n  } else if (typeof source === `function`) {\n    return func<V>(source, functionOptions)\n  } else if (typeof source === `object`) {\n    //console.log(`resolveSource is object`);\n    if (isWrapped<V>(source)) {\n      //console.log(`resolveSource is object - wrapped`);\n      return source.source;\n    }\n    if (isIterable(source) || isAsyncIterable(source)) {\n      //console.log(`resolveSource is object - iterable`);\n      return iterator(source, generatorOptions);\n    }\n  }\n  throw new TypeError(`Unable to resolve source. Supports: array, Reactive, Async/Iterable. Got type: ${ typeof source }`);\n}","import type { Reactive, ReactiveInitial, ReactiveNonInitial, ReactiveWritable } from \"./Types.js\";\n\nexport type CacheStream<T> = {\n  resetCachedValue: () => void\n  last: () => T | undefined\n}\n\nexport type CacheStreamInitial<T> = CacheStream<T> & {\n  last: () => T\n}\n\nexport function cache<TValue, RT extends Reactive<TValue>>(r: RT, initialValue: TValue): CacheStreamInitial<TValue> & RT;\n\nexport function cache<TValue, RT extends Reactive<TValue>>(r: RT, initialValue: TValue | undefined): CacheStream<TValue> & RT {\n  let lastValue: TValue | undefined = initialValue;\n  r.onValue(value => {\n    lastValue = value;\n  });\n  return {\n    ...r,\n    last() {\n      return lastValue\n    },\n    resetCachedValue() {\n      lastValue = undefined;\n    }\n  }\n}","import { type Dispatch, DispatchList } from \"../flow/DispatchList.js\";\nimport { resolveSource } from \"./ResolveSource.js\";\nimport type { InitLazyStreamInitedOptions, InitLazyStreamOptions, InitStreamOptions, Passed, ReactiveInitialStream, ReactiveOrSource, ReactiveStream, SignalKinds, UpstreamOptions } from \"./Types.js\";\nimport { messageHasValue, messageIsSignal } from \"./Util.js\";\nimport { cache } from \"./Cache.js\";\n\n\n/**\n * Initialise a stream based on an upstream source.\n * Calls initLazyStream under the hood.\n * \n * Options:\n * * onValue: called when upstream emits a value (default: does nothing with upstream value)\n * * lazy: laziness of stream (default: 'initial')\n * * disposeIfSourceDone: disposes stream if upstream disposes (default: true)\n * @ignore\n * @param upstreamSource \n * @param options \n * @returns \n */\nexport function initUpstream<In, Out>(upstreamSource: ReactiveOrSource<In>, options: Partial<UpstreamOptions<In>>): ReactiveStream<Out> {\n  const lazy = options.lazy ?? `initial`;\n  const disposeIfSourceDone = options.disposeIfSourceDone ?? true;\n  const onValue = options.onValue ?? ((_v: In) => {/** no-op */ })\n  const source = resolveSource(upstreamSource);\n  let unsub: undefined | (() => void);\n  const debugLabel = options.debugLabel ? `[${ options.debugLabel }]` : ``;\n  //console.log(`initUpstream${ debugLabel } creating`);\n  const onStart = () => {\n    //console.log(`Rx.initStream${ debugLabel } start unsub ${ unsub !== undefined }`);\n    if (unsub !== undefined) return;\n    if (options.onStart) options.onStart();\n\n    unsub = source.on(value => {\n      //console.log(`Rx.initStream${ debugLabel } onValue`, value);\n      if (messageIsSignal(value)) {\n        if (value.signal === `done`) {\n          stop();\n          events.signal(value.signal, value.context);\n          if (disposeIfSourceDone) events.dispose(`Upstream source ${ debugLabel } has completed (${ value.context ?? `` })`);\n        } else {\n          //events.through_(value);\n          events.signal(value.signal, value.context);\n        }\n      } else if (messageHasValue(value)) {\n        //lastValue = value.value;\n        onValue(value.value);\n      }\n    });\n  }\n\n  const onStop = () => {\n    //console.log(`Rx.initStream${ debugLabel } stop`);\n    if (unsub === undefined) return;\n    unsub();\n    unsub = undefined;\n    if (options.onStop) options.onStop();\n  }\n\n  //const initOpts = \n  // const events:ReactiveInitialStream<Out>|ReactiveStream<Out> = ((`initialValue` in options) && options.initialValue !== undefined) ?\n  //   initLazyStreamWithInitial<Out>({ ...initOpts, initialValue: options.initialValue }) :\n  //   initLazyStream<Out>(initOpts);\n  //console.log(`initUpstream${ debugLabel } creating initLazyStream`);\n\n  const events = initLazyStream<Out>({\n    ...options,\n    lazy,\n    onStart,\n    onStop\n  });\n  return events;\n}\n\n\nexport function initLazyStreamWithInitial<V>(options: InitLazyStreamInitedOptions<V>): ReactiveInitialStream<V> {\n  const r = initLazyStream<V>(options);\n  const c = cache<V, typeof r>(r, options.initialValue);\n  return c;\n}\n\nexport function initLazyStream<V>(options: InitLazyStreamOptions): ReactiveStream<V> {\n  const lazy = options.lazy ?? `initial`;\n  const onStop = options.onStop ?? (() => { /* no-op*/ })\n  const onStart = options.onStart ?? (() => {/* no-op*/ })\n  const debugLabel = options.debugLabel ? `[${ options.debugLabel }]` : ``;\n  const events = initStream<V>({\n    ...options,\n    onFirstSubscribe() {\n      if (lazy !== `never`) {\n        //console.log(`initLazyStream${ debugLabel } onFirstSubscribe, lazy: ${ lazy }. Calling onStart`);\n        onStart();\n      }\n    },\n    onNoSubscribers() {\n      if (lazy === `very`) {\n        //console.log(`initLazyStream${ debugLabel } onNoSubscribers, lazy: ${ lazy }. Calling onStop`);\n        onStop();\n      }\n    },\n  });\n  if (lazy === `never`) onStart();\n  return events;\n}\n\n/**\n * Initialises a new stream.\n * \n * Options:\n * * onFirstSubscribe: Called when there is a subscriber after there have been no subscribers.\n * * onNoSubscribers: Called when there are no more subscribers. 'onFirstSubscriber' will be called next time a subscriber is added.\n * @ignore\n * @param options \n * @returns \n */\nexport function initStream<V>(options: Partial<InitStreamOptions> = {}): ReactiveStream<V> {\n  let dispatcher: DispatchList<Passed<V>> | undefined;\n  let disposed = false;\n  let firstSubscribe = false;\n  let emptySubscriptions = true;\n  const onFirstSubscribe = options.onFirstSubscribe ?? undefined;\n  const onNoSubscribers = options.onNoSubscribers ?? undefined;\n  const debugLabel = options.debugLabel ? `[${ options.debugLabel }]` : ``;\n\n  const isEmpty = () => {\n    if (dispatcher === undefined) return;\n    if (!dispatcher.isEmpty) return;\n    if (!emptySubscriptions) {\n      emptySubscriptions = true;\n      firstSubscribe = false;\n      if (onNoSubscribers) onNoSubscribers();\n    }\n  }\n\n  const subscribe = (handler: Dispatch<Passed<V>>) => {\n    if (disposed) throw new Error(`Disposed, cannot subscribe ${ debugLabel }`);\n    if (dispatcher === undefined) dispatcher = new DispatchList();\n    //console.log(`initStream${ debugLabel } subscribe handler:`, handler);\n    const id = dispatcher.add(handler);\n    emptySubscriptions = false;\n    if (!firstSubscribe) {\n      firstSubscribe = true;\n      //if (onFirstSubscribe) setTimeout(() => { onFirstSubscribe() }, 10);\n      if (onFirstSubscribe) onFirstSubscribe();\n    }\n    return () => {\n      dispatcher?.remove(id);\n      isEmpty();\n    }\n  }\n\n  return {\n    dispose: (reason: string) => {\n      if (disposed) return;\n      dispatcher?.notify({ value: undefined, signal: `done`, context: `Disposed: ${ reason }` });\n      disposed = true;\n      if (options.onDispose) options.onDispose(reason);\n    },\n    isDisposed: () => {\n      return disposed\n    },\n    removeAllSubscribers: () => {\n      dispatcher?.clear();\n      isEmpty();\n    },\n    set: (v: V) => {\n      if (disposed) throw new Error(`${ debugLabel } Disposed, cannot set`);\n      dispatcher?.notify({ value: v });\n    },\n    // through: (pass: Passed<V>) => {\n    //   if (disposed) throw new Error(`Disposed, cannot through`);\n    //   dispatcher?.notify(pass)\n    // },\n    signal: (signal: SignalKinds, context?: string) => {\n      if (disposed) throw new Error(`${ debugLabel } Disposed, cannot signal`);\n      dispatcher?.notify({ signal, value: undefined, context });\n    },\n    on: (handler: Dispatch<Passed<V>>) => subscribe(handler),\n    onValue: (handler: (value: V) => void) => {\n      const unsub = subscribe(message => {\n        //console.log(`initStream${ debugLabel } onValue wrapper`, message);\n        if (messageHasValue(message)) {\n          handler(message.value);\n        }\n      });\n      return unsub;\n    }\n  }\n}\n","import { resolveEls, type QueryOrElements } from \"./ResolveEl.js\";\n\nexport function setText(selectors: QueryOrElements): (value: any) => string;\nexport function setText(selectors: QueryOrElements, value?: any): string;\nexport function setText(selectors: QueryOrElements, value?: any): string | ((value: any) => string) {\n  return setProperty(`textContent`, selectors, value)\n};\n\nexport function setHtml(selectors: QueryOrElements): (value: any) => string;\nexport function setHtml(selectors: QueryOrElements, value?: any): string;\nexport function setHtml(selectors: QueryOrElements, value?: any): string | ((value: any) => string) {\n  return setProperty(`innerHTML`, selectors, value)\n};\n\nexport function setProperty(property: string, selectors: QueryOrElements): (value: any) => string;\nexport function setProperty(property: string, selectors: QueryOrElements, value: any): string;\n\nexport function setProperty(property: string, selectors: QueryOrElements, value?: any): string | ((value: any) => string) {\n  let elements: Array<HTMLElement> = [];\n  const set = (v: any) => {\n    const typ = typeof v;\n    const vv = (typ === `string` || typ === `number` || typ === `boolean`) ? v as string :\n      JSON.stringify(v);\n\n    if (elements.length === 0) {\n      elements = resolveEls(selectors);\n    }\n    for (const element of elements) {\n      (element as any)[ property ] = vv;\n    }\n    return vv;\n  }\n  return value === undefined ? set : set(value);\n};","import { setProperty } from \"../../dom/SetProperty.js\";\nimport { resolveSource } from \"../ResolveSource.js\";\nimport type { ReactiveOrSource } from \"../Types.js\";\n\nexport type SetHtmlOptionsQuery = {\n  query: string\n}\n\nexport type SetHtmlOptionsElement = {\n  el: HTMLElement\n}\n\nexport type SetHtmlOptions = (SetHtmlOptionsQuery | SetHtmlOptionsElement) & {\n  /**\n   * If _true_ .innerHTML is used\n   * If _false_ (default) .textContent is used\n   */\n  asHtml?: boolean;\n};\n\n/**\n * Values from `input` are set to the textContent/innerHTML of an element.\n * ```js\n * const rxSource = Rx.From.string('hello');\n * const rxSet = Rx.Sinks.setHtmlText(rxSource, { query: })\n * ```\n * @param rxOrSource \n * @param optionsOrElementOrQuery \n */\nexport const setHtmlText = (rxOrSource: ReactiveOrSource<any>, optionsOrElementOrQuery: SetHtmlOptions | string | HTMLElement) => {\n  let el: HTMLElement | null | undefined;\n  let options: SetHtmlOptions | undefined;\n  if (typeof optionsOrElementOrQuery === `string`) {\n    options = { query: optionsOrElementOrQuery };\n  }\n  if (typeof optionsOrElementOrQuery === `object`) {\n    // eslint-disable-next-line unicorn/prefer-ternary\n    if (`nodeName` in optionsOrElementOrQuery) {\n      options = { el: optionsOrElementOrQuery };\n    } else {\n      options = optionsOrElementOrQuery;\n    }\n  }\n  if (options === undefined) throw new TypeError(`Missing element as second parameter or option`);\n  if (`el` in options) {\n    el = options.el;\n  } else if (`query` in options) {\n    el = document.querySelector<HTMLElement>(options.query);\n  } else {\n    throw new TypeError(`Options does not include 'el' or 'query' fields`);\n  }\n  if (el === null || el === undefined) throw new Error(`Element could not be resolved.`);\n\n  const stream = resolveSource(rxOrSource);\n  const setter = setProperty(options.asHtml ? `innerHTML` : `textContent`, el);\n  const off = stream.onValue(value => {\n    setter(value)\n  });\n  return off;\n}","/* eslint-disable @typescript-eslint/unbound-method */\nimport type { Reactive, ReactiveStream } from \"./Types.js\";\n\n/***\n * Returns a read-only version of `stream`\n */\nexport const toReadable = <V>(stream: ReactiveStream<V>): Reactive<V> => ({\n  on: stream.on,\n  dispose: stream.dispose,\n  isDisposed: stream.isDisposed,\n  onValue: stream.onValue\n});\n","import { initUpstream } from \"../InitStream.js\";\nimport type { ReactiveOrSource, Reactive, ReactiveOp } from \"../Types.js\";\nimport { toReadable } from \"../ToReadable.js\";\nimport type { TransformOpts } from \"./Types.js\";\nimport { resolveSource, syncToObject } from \"../index.js\";\n\n/**\n * Annotates values from `source`. Output values will be\n * in the form `{ value: TIn, annotation: TAnnotation }`.\n * Where `TIn` is the type of the input, and `TAnnotation` is\n * the return type of the annotator function.\n * \n * Example calculating area from width & height:\n * ```js\n * const data = Rx.From.array(\n *  { w: 1, h: 3 }, { w: 1, h: 1 }, { w: 2, h: 2 }\n * );\n * const annotated = Rx.Ops.annotate(data, v => {\n *  return { area: v.w * v.h }\n * });\n * const data = await Rx.toArray(annotated);\n * // Data =  [ { value: { w:1, h:3 }, annotation: { area:3 } } ...]\n * ```\n * \n * If you would rather annotate and have values merge with the input,\n * use `transform`:\n * ```js\n * const data = Rx.From.array(\n *  { w: 1, h: 3 }, { w: 1, h: 1 }, { w: 2, h: 2 }\n * );\n * const withArea = Rx.Ops.transform(data, v => {\n *  return { ...v, area: v.w * v.h }\n * });\n * const data = await Rx.toArray(withArea);\n * // Data =  [ { w:1, h:3, area:3 }, ...]\n * ```\n */\nexport function annotate<In, TAnnotation>(input: ReactiveOrSource<In>, annotator: (value: In) => TAnnotation, options: Partial<TransformOpts> = {}): Reactive<{ value: In, annotation: TAnnotation }> {\n  const upstream = initUpstream<In, { value: In, annotation: TAnnotation }>(input, {\n    ...options,\n    onValue(value) {\n      const annotation = annotator(value);\n      upstream.set({ value, annotation });\n    },\n  })\n  return toReadable(upstream);\n}\n\n/**\n * Annotates the input stream using {@link ReactiveOp} as the source of annotations.\n * The output values will have the shape of `{ value: TIn, annotation: TAnnotation }`.\n * Meaning that the original value is stored under `.value`, and the annotation under `.annotation`.\n * \n * ```js\n * const data = Rx.From.array([ 1, 2, 3 ]);\n * const annotated = Rx.Ops.annotateWithOp(data, Rx.Ops.sum());\n * const data = await annotated.toArray(annotated);\n * // Data =  [ { value: 1, annotation: 1 }, { value: 2, annotation: 3 }, { value: 3, annotation: 6 } ]\n * ```\n * @param annotatorOp Operator to generate annotations\n * @param input Input stream\n * @returns \n */\nexport function annotateWithOp<In, TAnnotation>(input: ReactiveOrSource<In>, annotatorOp: ReactiveOp<In, TAnnotation>): Reactive<{ value: In, annotation: TAnnotation }> {\n\n  const inputStream = resolveSource(input);\n\n  // Create annotations from input\n  const stream = annotatorOp(inputStream);\n\n  const synced = syncToObject({\n    value: inputStream,\n    annotation: stream\n  })\n  return synced as Reactive<{ value: In, annotation: TAnnotation }>;\n}\n\n","import { QueueMutable } from \"../../collections/queue/QueueMutable.js\";\nimport { timeout } from \"../../flow/Timeout.js\";\nimport { initUpstream } from \"../InitStream.js\";\nimport type { ReactiveOrSource, Reactive } from \"../Types.js\";\nimport { toReadable } from \"../ToReadable.js\";\nimport type { ChunkOptions } from \"./Types.js\";\n\n/**\n * Queue from `source`, emitting when thresholds are reached. \n * The resulting Reactive produces arrays.\n * \n * Can use a combination of elapsed time or number of data items.\n * \n * By default options are OR'ed together.\n *\n * ```js\n * // Emit data in chunks of 5 items\n * chunk(source, { quantity: 5 });\n * // Emit a chunk of data every second\n * chunk(source, { elapsed: 1000 });\n * ```\n * @param source \n * @param options \n * @returns \n */\nexport function chunk<V>(source: ReactiveOrSource<V>, options: Partial<ChunkOptions> = {}): Reactive<Array<V>> {\n  const queue = new QueueMutable<V>();\n  const quantity = options.quantity ?? 0;\n  //const logic = options.logic ?? `or`;\n  const returnRemainder = options.returnRemainder ?? true;\n\n  //let lastFire = performance.now();\n  const upstreamOpts = {\n    ...options,\n    onStop() {\n      if (returnRemainder && !queue.isEmpty) {\n        const data = queue.toArray();\n        queue.clear();\n        upstream.set(data);\n      }\n    },\n    onValue(value: V) {\n      queue.enqueue(value);\n      if (quantity > 0 && queue.length >= quantity) {\n        // Reached quantity limit\n        send();\n      }\n      // Start timer\n      if (timer !== undefined && timer.runState === `idle`) {\n        timer.start();\n      }\n    },\n  }\n  const upstream = initUpstream<V, Array<V>>(source, upstreamOpts);\n\n  const send = () => {\n    if (queue.isEmpty) return;\n\n    // Reset timer\n    if (timer !== undefined) timer.start();\n\n    // Fire queued data\n    const data = queue.toArray();\n    queue.clear();\n    upstream.set(data);\n  }\n\n  const timer = options.elapsed ? timeout(send, options.elapsed) : undefined\n\n  // const trigger = () => {\n  //   const now = performance.now();\n  //   let byElapsed = false;\n  //   let byLimit = false;\n  //   if (elapsed > 0 && (now - lastFire > elapsed)) {\n  //     lastFire = now;\n  //     byElapsed = true;\n  //   }\n  //   if (limit > 0 && queue.length >= limit) {\n  //     byLimit = true;\n  //   }\n  //   if (logic === `or` && (!byElapsed && !byLimit)) return;\n  //   if (logic === `and` && (!byElapsed || !byLimit)) return;\n\n  //   send();\n  // }\n\n  return toReadable(upstream);\n}\n","import { initUpstream } from \"../InitStream.js\";\nimport type { Reactive, ReactiveOrSource } from \"../Types.js\";\nimport { toReadable } from \"../ToReadable.js\";\nimport type { TransformOpts } from \"./Types.js\";\n\n/**\n * Transforms values from `source` using the `transformer` function.\n * @param transformer \n * @returns \n */\nexport function transform<In, Out>(input: ReactiveOrSource<In>, transformer: (value: In) => Out, options: Partial<TransformOpts> = {}): Reactive<Out> {\n  const traceInput = options.traceInput ?? false;\n  const traceOutput = options.traceOutput ?? false;\n\n  const upstream = initUpstream<In, Out>(input, {\n    lazy: `initial`,\n    ...options,\n    onValue(value) {\n      const t = transformer(value);\n      if (traceInput && traceOutput) {\n        console.log(`Rx.Ops.transform input: ${ JSON.stringify(value) } output: ${ JSON.stringify(t) }`);\n      } else if (traceInput) {\n        console.log(`Rx.Ops.transform input: ${ JSON.stringify(value) }`);\n      } else if (traceOutput) {\n        console.log(`Rx.Ops.transform output: ${ JSON.stringify(t) }`);\n      }\n\n      upstream.set(t);\n    },\n  })\n  return toReadable(upstream);\n}\n\n","\nimport { isPlainObjectOrPrimitive } from \"../../util/GuardObject.js\";\nimport type { ReactiveOrSource } from \"../Types.js\";\nimport { transform } from \"./Transform.js\";\n\n/**\n * Create a new object from input, based on cloning fields rather than a destructured copy.\n * This is useful for event args.\n * @param source \n * @returns \n */\nexport const cloneFromFields = <In>(source: ReactiveOrSource<In>) => {\n  return transform<In, In>(source, (v): In => {\n    const entries: Array<[ key: string, value: any ]> = [];\n    for (const field in v) {\n      const value = (v)[ field ];\n      if (isPlainObjectOrPrimitive(value as unknown)) {\n        entries.push([ field, value ]);\n      }\n    }\n    return Object.fromEntries(entries) as In;\n  })\n}","/* eslint-disable @typescript-eslint/unbound-method */\nimport { initStream } from \"../InitStream.js\";\nimport { resolveSource } from \"../ResolveSource.js\";\nimport type { ReactiveOrSource, CombineLatestOptions, Reactive, RxValueTypes } from \"../Types.js\";\nimport { messageIsDoneSignal, messageHasValue } from \"../Util.js\";\n\n/**\n * Monitors input reactive values, storing values as they happen to an array.\n * Whenever a new value is emitted, the whole array is sent out, containing current\n * values from each source, or _undefined_ if not yet emitted.\n * \n * See {@link combineLatestToObject} to combine streams by name into an object, rather than array.\n * \n * ```\n * const sources = [\n *  Rx.fromFunction(Math.random, { loop: true, interval: 100 }),\n *  Rx.fromFunction(Math.random, { loop: true, interval: 200 })\n * ];\n * const r = Rx.combineLatestToArray(sources);\n * r.onValue(value => {\n *  // Value will be an array of last value from each source:\n *  // [number,number]  \n * });\n * ```\n * \n * The tempo of this stream will be set by the fastest source stream.\n * See {@link syncToArray} to have pace determined by slowest source, and only\n * send when each source has produce a new value compared to last time.\n * \n * Set `onSourceDone` to choose behaviour if a source stops. By default it\n * is 'break', meaning the whole merged stream stops.\n * \n * Note: unlike RxJS's `combineLatest`, does not wait for each source to emit once\n * before emitting first value.\n * @param reactiveSources Sources to merge\n * @param options Options for merging \n * @returns \n */\nexport function combineLatestToArray<const T extends ReadonlyArray<ReactiveOrSource<any>>>(reactiveSources: T, options: Partial<CombineLatestOptions> = {}): Reactive<RxValueTypes<T>> {\n  const event = initStream<RxValueTypes<T>>();\n  const onSourceDone = options.onSourceDone ?? `break`;\n  const data: Array<RxValueTypes<T> | undefined> = [];\n  const sources = reactiveSources.map(source => resolveSource(source));\n  const noop = () => {/** no-op */ };\n  const sourceOff = sources.map(_ => noop);\n  const doneSources = sources.map(_ => false);\n\n  const unsub = () => {\n    for (const v of sourceOff) { v() }\n  }\n\n  for (const [ index, v ] of sources.entries()) {\n    data[ index ] = undefined;\n    sourceOff[ index ] = v.on(message => {\n      if (messageIsDoneSignal(message)) {\n        doneSources[ index ] = true;\n        sourceOff[ index ]();\n        sourceOff[ index ] = noop;\n        if (onSourceDone === `break`) {\n          unsub();\n          event.dispose(`Source has completed and 'break' is set`);\n          return;\n        }\n        if (!doneSources.includes(false)) {\n          // All sources are done\n          unsub();\n          event.dispose(`All sources completed`);\n        }\n      } else if (messageHasValue(message)) {\n        data[ index ] = message.value;\n        event.set([ ...data ] as RxValueTypes<T>);\n      }\n    });\n  }\n\n  return {\n    dispose: event.dispose,\n    isDisposed: event.isDisposed,\n    on: event.on,\n    onValue: event.onValue\n  }\n}\n","import * as TraversableObject from '../collections/tree/TraverseObject.js';\nimport { isPrimitive } from '../IsPrimitive.js';\nimport { isPlainObjectOrPrimitive } from '../util/GuardObject.js';\nimport { isInteger } from '../util/IsInteger.js';\nimport { isEqualContextString, type IsEqualContext } from './Util.js';\nimport { compareKeys } from './Compare.js';\nimport type { Result } from '../util/Results.js';\n\nexport type PathData<V> = {\n  path: string\n  value: V\n}\n\nexport type PathDataChange<V> = PathData<V> & {\n  previous?: V\n  state: `change` | `added` | `removed`\n}\n\nexport type CompareDataOptions<V> = {\n  /**\n   * If _true_, it treats the B value as a partial\n   * version of B. Only the things present in B are compared.\n   * Omissions from B are not treated as removed keys.\n   */\n  asPartial: boolean\n  /**\n   * If _true_ (default), if a value is undefined,\n   * it signals that the key itself is removed.\n   */\n  undefinedValueMeansRemoved: boolean\n  pathPrefix: string\n  /**\n   * Comparison function for values. By default uses\n   * JSON.stringify() to compare by value.\n   */\n  eq: IsEqualContext<V>\n  /**\n   * If true, inherited fields are also compared.\n   * This is necessary for events, for example.\n   * \n   * Only plain-object values are used, the other keys are ignored.\n   */\n  deepEntries: boolean\n\n  /**\n   * If _true_, includes fields that are present in B, but missing in A.\n   * _False_ by default.\n   */\n  includeMissingFromA: boolean\n\n  /**\n   * If _true_, emits a change under the path of a parent if its child has changed.\n   * If _false_ (default) only changed keys are emitted.\n   * \n   * Eg if data is: \n   * `{ colour: { h:0.5, s: 0.3, l: 0.5 }}`\n   * and we compare with:\n   * `{ colour: { h:1, s: 0.3, l: 0.5 }}`\n   * \n   * By default only 'colour.h' is emitted. If _true_ is set, 'colour' and 'colour.h' is emitted.\n   */\n  includeParents: boolean\n}\n\nconst getEntries = <V extends Record<string, any>>(target: V, deepProbe: boolean) => {\n  if (target === undefined) throw new Error(`Param 'target' is undefined`);\n  if (target === null) throw new Error(`Param 'target' is null`);\n  if (typeof target !== `object`) throw new Error(`Param 'target' is not an object (got: ${ typeof target })`);\n  if (deepProbe) {\n    const entries: Array<[ key: string, value: any ]> = [];\n    for (const field in target) {\n      const value = (target as any)[ field ];\n      if (isPlainObjectOrPrimitive(value as unknown)) {\n        entries.push([ field, value ]);\n      }\n    }\n    return entries;\n  } else {\n    return Object.entries(target);\n  }\n}\n\n/**\n * Scans object, producing a list of changed fields where B's value (newer) differs from A (older).\n * \n * Options:\n * - `deepEntries` (_false_): If _false_ Object.entries are used to scan the object. However this won't work for some objects, eg event args, thus _true_ is needed.\n * - `eq` (JSON.stringify): By-value comparison function\n * - `includeMissingFromA` (_false): If _true_ includes fields present on B but missing on A.\n * - `asPartial` (_false): If _true_, treats B as a partial update to B. This means that things missing from B are not considered removals.\n * @param a 'Old' value\n * @param b 'New' value\n * @param options Options for comparison\n * @returns \n */\nexport function* compareData<V extends Record<string, any>>(a: V, b: Partial<V>, options: Partial<CompareDataOptions<V>> = {}): Generator<PathDataChange<any>> {\n  if (a === undefined) {\n    yield {\n      path: options.pathPrefix ?? ``,\n      value: b,\n      state: `added`\n    };\n    return;\n  }\n  if (b === undefined) {\n    yield { path: options.pathPrefix ?? ``, previous: a, value: undefined, state: `removed` }\n    return;\n  }\n  const asPartial = options.asPartial ?? false;\n  const undefinedValueMeansRemoved = options.undefinedValueMeansRemoved ?? false;\n  const pathPrefix = options.pathPrefix ?? ``;\n  const deepEntries = options.deepEntries ?? false;\n  const eq = options.eq ?? isEqualContextString;\n  const includeMissingFromA = options.includeMissingFromA ?? false;\n  const includeParents = options.includeParents ?? false;\n\n  //console.log(`Pathed.compareData: a: ${ JSON.stringify(a) } b: ${ JSON.stringify(b) } prefix: ${ pathPrefix }`);\n\n  if (isPrimitive(a) && isPrimitive(b)) {\n    if (a !== b) yield { path: pathPrefix, value: b, previous: a, state: `change` };\n    return;\n  }\n  if (isPrimitive(b)) {\n    yield { path: pathPrefix, value: b, previous: a, state: `change` };\n    return;\n  }\n  const entriesA = getEntries(a, deepEntries);\n  const entriesAKeys = new Set<string>();\n  for (const [ key, valueA ] of entriesA) {\n    entriesAKeys.add(key);\n\n    const keyOfAInB = key in b;\n    const valueOfKeyInB = b[ key ];\n    //console.log(`Pathed.compareData Pathed.compareDataA key: ${ key } valueA: ${ JSON.stringify(valueA) }`);\n\n    if (typeof valueA === `object` && valueA !== null) {\n      if (keyOfAInB) {\n        //console.log(`Pathed.compareData key ${ key } exists in B. value:`, valueB);\n        if (valueOfKeyInB === undefined) {\n          throw new Error(`Pathed.compareData Value for key ${ key } is undefined`);\n        } else {\n          const sub = [ ...compareData(valueA, valueOfKeyInB, {\n            ...options,\n            pathPrefix: pathPrefix + key + `.`\n          }) ];\n          if (sub.length > 0) {\n            for (const s of sub) yield s;\n            if (includeParents) {\n              yield { path: pathPrefix + key, value: b[ key ], previous: valueA, state: `change` };\n            }\n          }\n        }\n      } else {\n        if (asPartial) continue;\n        //throw new Error(`Key does not exist in B. Key: '${ key }'. B: ${ JSON.stringify(b) } A: ${ JSON.stringify(a) }`);\n        yield { path: pathPrefix + key, value: undefined, previous: valueA, state: `removed` }\n      }\n    } else {\n      const subPath = pathPrefix + key;\n      if (keyOfAInB) {\n        // B contains key from A\n        if (valueOfKeyInB === undefined && undefinedValueMeansRemoved) {\n          //console.error(`Pathed.compareData (2) value for B is undefined. key: ${ key }. B: ${ JSON.stringify(b) } A: ${ JSON.stringify(a) }`);\n          yield { path: subPath, previous: valueA, value: undefined, state: `removed` };\n        } else {\n          if (!eq(valueA, valueOfKeyInB, subPath)) {\n            //console.log(`Pathed.compareData  value changed. A: ${ valueA } B: ${ valueB } subPath: ${ subPath }`)\n            yield { path: subPath, previous: valueA, value: valueOfKeyInB, state: `change` };\n          }\n        }\n      } else {\n        // B does not contain key from A\n        if (asPartial) continue; // Ignore\n        yield { path: subPath, previous: valueA, value: undefined, state: `removed` };\n      }\n    }\n  }\n\n  if (includeMissingFromA) {\n    const entriesB = getEntries(b, deepEntries);\n    for (const [ key, valueB ] of entriesB) {\n      if (entriesAKeys.has(key)) continue;\n      // Key in B that's not in A\n      //console.log(`Pathed.compareDataB key: ${ key } value: ${ valueB }`);\n      yield { path: pathPrefix + key, previous: undefined, value: valueB, state: `added` };\n    }\n  }\n}\n\n/**\n * Returns a copy of `source` with `changes` applied.\n * @param source \n * @param changes \n */\nexport const applyChanges = <V extends Record<string, any>>(source: V, changes: Array<PathDataChange<any>>): V => {\n  for (const change of changes) {\n    source = updateByPath(source, change.path, change.value);\n  }\n  return source;\n}\n\n/**\n * Returns a copy of `target` object with a specified path changed to `value`.\n * \n * ```js\n * const a = {\n *  message: `Hello`,\n *  position: { x: 10, y: 20 }\n * }\n * \n * const a1 = updateByPath(a, `message`, `new message`);\n * // a1 = { message: `new message`, position: { x: 10, y: 20 }}\n * const a2 = updateByPath(a, `position.x`, 20);\n * // a2 = { message: `hello`, position: { x: 20, y: 20 }}\n * ```\n * \n * Paths can also be array indexes:\n * ```js\n * updateByPath([`a`,`b`,`c`], 2, `d`);\n * // Yields: [ `a`, `b`, `d` ]\n * ```\n * \n * By default, only existing array indexes can be updated. Use the `allowShapeChange` parameter \n * to allow setting arbitrary indexes.\n * ```js\n * // Throws because array index 3 is undefined\n * updateByPath([ `a`, `b`, `c` ], `3`, `d`);\n * \n * // With allowShapeChange flag\n * updateByPath([ `a`, `b`, `c` ], `3`, `d`, true);\n * // Returns: [ `a`, `b`, `c`, `d` ]\n * ```\n * \n * Throws an error if:\n * * `path` cannot be resolved (eg. `position.z` in the above example)\n * * `value` applied to `target` results in the object having a different shape (eg missing a field, field\n * changing type, or array index out of bounds). Use `allowShapeChange` to suppress this error.\n * * Path is undefined or not a string\n * * Target is undefined/null\n * @param target Object to update\n * @param path Path to set value\n * @param value Value to set\n * @param allowShapeChange By default _false_, throwing an error if an update change the shape of the original object.\n * @returns \n */\nexport const updateByPath = <V extends Record<string, any>>(target: V, path: string, value: any, allowShapeChange = false): V => {\n  if (path === undefined) throw new Error(`Parameter 'path' is undefined`);\n  if (typeof path !== `string`) throw new Error(`Parameter 'path' should be a string. Got: ${ typeof path }`);\n  if (target === undefined) throw new Error(`Parameter 'target' is undefined`);\n  if (target === null) throw new Error(`Parameter 'target' is null`);\n\n  const split = path.split(`.`);\n  const r = updateByPathImpl(target, split, value, allowShapeChange);\n  return r as V;\n}\n\nconst updateByPathImpl = (o: any, split: Array<string>, value: any, allowShapeChange: boolean): any => {\n  if (split.length === 0) {\n    //console.log(`Pathed.updateByPathImpl o: ${ JSON.stringify(o) } value: ${ JSON.stringify(value) }`);\n\n    if (allowShapeChange) return value; // yolo\n\n    if (Array.isArray(o) && !Array.isArray(value)) throw new Error(`Expected array value, got: '${ JSON.stringify(value) }'. Set allowShapeChange=true to ignore.`);\n    if (!Array.isArray(o) && Array.isArray(value)) throw new Error(`Unexpected array value, got: '${ JSON.stringify(value) }'. Set allowShapeChange=true to ignore.`);\n\n    if (typeof o !== typeof value) throw new Error(`Cannot reassign object type. (${ typeof o } -> ${ typeof value }). Set allowShapeChange=true to ignore.`);\n\n    // Make sure new value has the same set of keys\n    if (typeof o === `object` && !Array.isArray(o)) {\n      const c = compareKeys(o, value);\n      if (c.a.length > 0) {\n        throw new Error(`New value is missing key(s): ${ c.a.join(`,`) }`);\n      }\n      if (c.b.length > 0) {\n        throw new Error(`New value cannot add new key(s): ${ c.b.join(`,`) }`);\n      }\n    }\n    return value;\n  }\n  const start = split.shift();\n  if (!start) return value;\n\n  const isInt = isInteger(start);\n  if (isInt && Array.isArray(o)) {\n    const index = Number.parseInt(start);\n    if (index >= o.length && !allowShapeChange) throw new Error(`Array index ${ index.toString() } is outside of the existing length of ${ o.length.toString() }. Use allowShapeChange=true to permit this.`);\n    const copy = [ ...o ];\n    copy[ index ] = updateByPathImpl(copy[ index ], split, value, allowShapeChange);\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n    return copy;\n  } else if (start in o) {\n    const copy = { ...o };\n    copy[ start ] = updateByPathImpl(copy[ start ], split, value, allowShapeChange);\n    return copy;\n  } else {\n    throw new Error(`Path ${ start } not found in data`);\n  }\n}\n\n/**\n * Gets the data at `path` in `object`. Assumes '.' separates each segment of path.\n * ```js\n * getField({ name: { first: `Thom`, last: `Yorke` }}, `name.first`); // 'Thom'\n * getField({ colours: [`red`, `green`, `blue` ]}, `colours.1`); // `green`\n * ```\n * \n * Returns _undefined_ if path could not be resolved.\n * \n * Throws if:\n * * `path` is not a string or empty\n * * `object` is _undefined_ or null\n * @param object \n * @param path \n * @returns \n */\nexport const getField = <V>(object: Record<string, any>, path: string): Result<V> => {\n  if (typeof path !== `string`) throw new Error(`Param 'path' ought to be a string. Got: '${ typeof path }'`);\n  if (path.length === 0) throw new Error(`Param string 'path' is empty`);\n  if (object === undefined) throw new Error(`Param 'object' is undefined`);\n  if (object === null) throw new Error(`Param 'object' is null`);\n\n  const split = path.split(`.`);\n  const v = getFieldImpl<V>(object, split);\n  return v;\n}\n\nconst getFieldImpl = <V>(object: Record<string, any>, split: Array<string>): Result<V> => {\n  if (object === undefined) throw new Error(`Param 'object' is undefined`);\n  if (split.length === 0) throw new Error(`Path has run out`);\n  const start = split.shift();\n  if (!start) throw new Error(`Unexpected empty split path`);\n\n  const isInt = isInteger(start);\n  if (isInt && Array.isArray(object)) { //(arrayStart === 0 && arrayEnd === start.length - 1 && Array.isArray(o)) {\n    const index = Number.parseInt(start); //start.slice(1, -1));\n    //console.log(`getFieldImpl index: ${ index } value: ${ object[ index ] }`);\n    if (typeof object[ index ] === `undefined`) {\n      return { success: false, error: `Index ${ index } is not present` };\n    }\n    // eslint-disable-next-line unicorn/prefer-ternary\n    if (split.length === 0) {\n      return { value: object[ index ] as V, success: true };\n    } else {\n      return getFieldImpl(object[ index ], split);\n    }\n  } else if (typeof object === `object` && start in object) {\n    //console.log(`start in object. Start: ${ start } Len: ${ split.length } Object`, object);\n    // eslint-disable-next-line unicorn/prefer-ternary\n    if (split.length === 0) {\n      return { value: object[ start ] as V, success: true };\n    } else {\n      return getFieldImpl(object[ start ], split);\n    }\n  } else {\n    return { success: false, error: `Path '${ start }' not found` };\n  }\n}\n\n\n/**\n * Iterates 'paths' for all the fields on `o`\n * ```\n * const d = {\n *  accel: { x: 1, y: 2, z: 3 },\n *  gyro: { x: 4, y: 5, z: 6 }\n * };\n * const paths = [...getFieldPaths(d)];\n * // Yields [ `accel`, `gyro`, `accel.x`, `accel.y`,`accel.z`,`gyro.x`,`gyro.y`,`gyro.z` ]\n * ```\n *\n * Use {@link getField} to fetch data based on a path\n *\n * If object is _null_ or _undefined_, no results are returned.\n * \n * If `onlyLeaves` is _true_ (default: _false_), only 'leaf' nodes are included. \n * Leaf nodes are those that contain a primitive value.\n * ```js\n * const paths = getFieldPaths(d, true);\n * // Yields [ `accel.x`, `accel.y`,`accel.z`,`gyro.x`,`gyro.y`,`gyro.z` ]\n * ```\n *\n * @param object Object to get paths for.\n * @param onlyLeaves If true, only paths with a primitive value are returned.\n * @returns\n */\nexport function* getPaths(object: object | null, onlyLeaves = false): Generator<string> {\n  if (object === undefined || object === null) return;\n  const iter = TraversableObject.depthFirst(object);\n  for (const c of iter) {\n    if (c.nodeValue === undefined && onlyLeaves) continue;\n    let path = c.name;\n    if (c.ancestors.length > 0) path = c.ancestors.join(`.`) + `.` + path;\n    yield path;\n  }\n};\n\n/**\n * Returns a representation of the object as a set of paths and data.\n * ```js\n * const o = { name: `hello`, size: 20, colour: { r:200, g:100, b:40 } }\n * const pd = [...getPathsAndData(o)];\n * // Yields:\n * // [ \n * // { path: `name`, value: `hello` },\n * // { path: `size`, value: `20` },\n * // { path: `colour.r`, value: `200` },\n * // { path: `colour.g`, value: `100` },\n * // { path: `colour.b`, value: `40` }\n * //]\n * ```\n * @param o Object to get paths and data for\n * @param maxDepth Set maximum recursion depth. By default unlimited.\n * @param prefix Manually set a path prefix if it's necessary\n * @returns \n */\nexport function* getPathsAndData(o: object, onlyLeaves = false, maxDepth = Number.MAX_SAFE_INTEGER, prefix = ``): Generator<PathData<any>> {\n  if (o === null) return;\n  if (o === undefined) return;\n  yield* getPathsAndDataImpl(o, prefix, onlyLeaves, maxDepth);\n}\n\nfunction* getPathsAndDataImpl(o: object, prefix: string, onlyLeaves = false, maxDepth: number): Generator<PathData<any>> {\n  if (maxDepth <= 0) return;\n  if (typeof o !== `object`) return;\n  for (const entries of Object.entries(o)) {\n    const sub = (prefix.length > 0 ? prefix + `.` : ``) + entries[ 0 ];\n    const value = entries[ 1 ];\n    const leaf = (typeof value !== `object`);\n\n    if (onlyLeaves && leaf || !onlyLeaves) {\n      yield { path: sub, value };\n    }\n    yield* getPathsAndDataImpl(value, sub, onlyLeaves, maxDepth - 1);\n  }\n}","//import { stringify } from 'json5';\n\n/**\n * Returns _true_ if Object.entries() is empty for `value`\n * @param value \n * @returns \n */\nexport const isEmptyEntries = (value: object) => [ ...Object.entries(value) ].length === 0;\n\n/**\n * Return _true_ if `a` and `b` ought to be considered equal\n * at a given path\n */\nexport type IsEqualContext<V> = (a: V, b: V | undefined, path: string) => boolean\n\n/**\n * Returns _true_ if `a` and `b are equal based on their JSON representations.\n * `path` is ignored.\n * @param a \n * @param b \n * @param path \n * @returns \n */\nexport const isEqualContextString: IsEqualContext<any> = (a: any, b: any, _path: string): boolean => {\n  return JSON.stringify(a) === JSON.stringify(b);\n}","/* eslint-disable @typescript-eslint/unbound-method */\nimport { DispatchList } from \"../../flow/DispatchList.js\";\nimport * as Pathed from \"../../data/Pathed.js\";\nimport { initStream } from \"../InitStream.js\";\nimport type { ObjectFieldHandler, ReactiveDiff, ReactiveInitial, ReactiveNonInitial } from \"../Types.js\";\nimport type { ObjectOptions } from \"./Types.js\";\nimport { isEqualContextString } from \"../../data/Util.js\";\nimport { throwResult } from \"../../util/Results.js\";\nimport { wildcard } from \"../../Text.js\";\n\n//type ObjectFieldHandler = (value: any, fieldName: string) => void\n\nexport function object<V extends Record<string, any>>(initialValue: V, options?: Partial<ObjectOptions<V>>): ReactiveDiff<V> & ReactiveInitial<V>;\nexport function object<V extends Record<string, any>>(initialValue: undefined, options?: Partial<ObjectOptions<V>>): ReactiveDiff<V> & ReactiveNonInitial<V>;\n\n\n/**\n * Creates a Reactive wrapper with the shape of the input object.\n * \n * Changing the wrapped object directly does not update the Reactive. \n * Instead, to update values use:\n * * `set()`, 'resets' the whole object\n * * `update()` changes a particular field\n * \n * Consider using {@link Rx.From.objectProxy} to return a object with properties that can be\n * set in the usual way yet is also Reactive.\n * \n * ```js\n * const o = Rx.From.object({ name: `bob`, level: 2 });\n * o.onValue(changed => {\n * });\n * o.set({ name: `mary`, level: 3 });\n * \n * // `onValue` will get called, with `changed` having a value of:\n * // { name: `mary`, level: 3 }\n * ```\n * \n * Use `last()` to get the most recently set value.\n * \n * `onDiff` subscribes to a rough diff of the object.\n * \n * ```js\n * const o = Rx.From.object({ name: `bob`, level: 2 });\n * o.onDiff(diffValue => {\n *  const diff = diffValue.value;\n * })\n * o.set({ name: `mary`, level: 3 });\n * \n * // onDiff would fire with `diff` of:\n * [\n *  { path: `name`, previous: `bob`, value: `mary` },\n *  { path: `level`, previous: 2, value: 3 }\n * ]\n * ```\n * \n * You can also listen to updates on a field via `onField`.\n * ```js\n * o.onField(`name`, value => {\n *  // Called whenever the 'name' field is updated\n * });\n * ```\n * @param initialValue  Initial value\n * @param options Options\n * @returns \n */\nexport function object<V extends Record<string, any>>(initialValue?: V, options: Partial<ObjectOptions<V>> = {}): ReactiveDiff<V> & (ReactiveInitial<V> | ReactiveNonInitial<V>) {\n  const eq = options.eq ?? isEqualContextString;\n  const setEvent = initStream<V>();\n  const diffEvent = initStream<Array<Pathed.PathDataChange<any>>>();\n\n  //const fieldChangeEvents = new Map<string, DispatchList<ObjectFieldHandler>>;\n  const fieldChangeEvents: Array<[ matcher: (value: string) => boolean, pattern: string, DispatchList<ObjectFieldHandler> ]> = [];\n\n  let value: V | undefined = initialValue;\n  let disposed = false;\n\n  const set = (v: V) => {\n    const diff = [ ...Pathed.compareData(value ?? {} as V, v, { ...options, includeMissingFromA: true }) ];\n    if (diff.length === 0) return;\n    value = v;\n    setEvent.set(v);\n    diffEvent.set(diff);\n  }\n\n  const fireFieldUpdate = (field: string, value: any) => {\n    for (const [ matcher, pattern, list ] of fieldChangeEvents) {\n      if (matcher(field)) {\n        list.notify({ fieldName: field, pattern, value });\n      }\n    }\n    //const l = fieldChangeEvents.get(field.toLowerCase());\n    //if (l === undefined) return;\n    //l.notify(value);\n  }\n\n  const updateCompareOptions: Partial<Pathed.CompareDataOptions<V>> = {\n    asPartial: true,\n    includeParents: true\n  }\n\n  const update = (toMerge: Partial<V>) => {\n    //console.log(`Rx.From.object update: toMerge: ${ JSON.stringify(toMerge) } value: ${ JSON.stringify(value) }`);\n    // eslint-disable-next-line unicorn/prefer-ternary\n    if (value === undefined) {\n      value = toMerge as V;\n      setEvent.set(value);\n      for (const [ k, v ] of Object.entries(toMerge as V)) {\n        fireFieldUpdate(k, v);\n      }\n      return value;\n    } else {\n      const diff = [ ...Pathed.compareData(value, toMerge, updateCompareOptions) ];\n      //const diffWithoutRemoved = diff.filter(d => d.state !== `removed`);\n      if (diff.length === 0) return value; // No changes\n      value = {\n        ...value,\n        ...toMerge\n      }\n      setEvent.set(value);\n      diffEvent.set(diff);\n      //console.log(`diff`, diff);\n      for (const d of diff) {\n        fireFieldUpdate(d.path, d.value);\n      }\n      return value;\n    }\n  }\n\n  const updateField = (path: string, valueForField: any) => {\n    if (value === undefined) throw new Error(`Cannot update value when it has not already been set`);\n    //console.log(`Rx.fromObject.updateField path: ${ path } value: ${ JSON.stringify(valueForField) }`);\n\n    const existing = Pathed.getField<any>(value, path);\n    throwResult(existing); // Eg if path not found\n\n    //console.log(`Rx.fromObject.updateField path: ${ path } existing: ${ JSON.stringify(existing) }`);\n    if (eq(existing.value, valueForField, path)) {\n      //console.log(`Rx.object.updateField identical existing: ${ existing } value: ${ valueForField } path: ${ path }`);\n      return;\n    }\n    let diff = [ ...Pathed.compareData(existing.value, valueForField, { ...options, includeMissingFromA: true }) ];\n    diff = diff.map(d => {\n      if (d.path.length > 0) return { ...d, path: path + `.` + d.path };\n      return { ...d, path };\n    })\n\n    //console.log(`Rx.fromObject.updateField diff path: ${ path }`, diff);\n    const o = Pathed.updateByPath(value, path, valueForField, true);\n    value = o;\n    //diffEvent.set([ { path, value: valueForField, previous: existing } ]);\n\n    setEvent.set(o);\n    diffEvent.set(diff);\n    fireFieldUpdate(path, valueForField);\n    //console.log(`Rx.fromObject.updateField: path: '${ path }' value: '${ JSON.stringify(valueForField) }' o: ${ JSON.stringify(o) }`);\n  }\n\n  const dispose = (reason: string) => {\n    if (disposed) return;\n    diffEvent.dispose(reason);\n    setEvent.dispose(reason);\n    disposed = true;\n  }\n\n  return {\n    dispose,\n    isDisposed() {\n      return disposed\n    },\n    /**\n     * Update a field.\n     * Exception is thrown if field does not exist\n     */\n    updateField,\n    last: () => value,\n    on: setEvent.on,\n    onValue: setEvent.onValue,\n    onDiff: diffEvent.onValue,\n    onField(fieldPattern: string, handler: (result: ObjectFieldHandler) => void) {\n      const matcher = wildcard(fieldPattern);\n      const listeners = new DispatchList<ObjectFieldHandler>();\n      fieldChangeEvents.push([ matcher, fieldPattern, listeners ]);\n      const id = listeners.add(handler);\n      return () => listeners.remove(id);\n      // let listeners = fieldChangeEvents.get(fieldName.toLowerCase());\n      // if (listeners === undefined) {\n      //   listeners = new DispatchList();\n      //   fieldChangeEvents.set(fieldName.toLowerCase(), listeners);\n      // }\n      // const id = listeners.add((value) => {\n      //   setTimeout(() => { handler(value, fieldName) }, 1);\n      // });\n      // return () => listeners.remove(id);\n    },\n    /**\n     * Set the whole object\n     */\n    set,\n    /**\n     * Update the object with a partial set of fields and values\n     */\n    update\n  }\n}\n","/* eslint-disable @typescript-eslint/unbound-method */\nimport * as MapFns from \"../../data/maps/MapFns.js\"\nimport { initStream } from \"../InitStream.js\"\nimport { resolveSource } from \"../ResolveSource.js\"\nimport type { ReactiveOrSource, CombineLatestOptions, Reactive, RxValueTypeObject, ReactiveInitial, RxValueTypeRx, ReactiveDiff } from \"../Types.js\"\nimport { messageIsDoneSignal, messageHasValue, isWritable } from \"../Util.js\"\nimport { object } from \"../sources/Object.js\"\n\nexport type CombineLatestToObject<T extends Record<string, ReactiveOrSource<any>>> = {\n  hasSource: (field: string) => boolean,\n  replaceSource: (field: Extract<keyof T, string>, source: ReactiveOrSource<any>) => void\n  /**\n   * Reactive sources being combined\n   */\n  sources: RxValueTypeRx<T>\n  /**\n   * Updates writable sources with values.\n   * @param data \n   * @returns Keys and values set to writable source(s)\n   */\n  setWith: (data: Partial<RxValueTypeObject<T>>) => Partial<RxValueTypeObject<T>>\n} & ReactiveDiff<RxValueTypeObject<T>> & ReactiveInitial<RxValueTypeObject<T>>;\n\n/**\n * Monitors input reactive values, storing values as they happen to an object.\n * Whenever a new value is emitted, the whole object is sent out, containing current\n * values from each source (or _undefined_ if not yet emitted)\n * \n * See {@link combineLatestToArray} to combine streams by name into an array instead.\n * \n * ```\n * const sources = {\n *  fast: Rx.fromFunction(Math.random, { loop: true, interval: 100 }),\n *  slow: Rx.fromFunction(Math.random, { loop: true, interval: 200 })\n * ];\n * const r = Rx.combineLatestToObject(sources);\n * r.onValue(value => {\n *  // 'value' will be an object containing the labelled latest\n *  // values from each source.\n *  // { fast: number, slow: number }\n * });\n * ```\n * \n * The tempo of this stream will be set by the fastest source stream.\n * See {@link syncToObject} to have pace determined by slowest source, and only\n * send when each source has produce a new value compared to last time.\n * \n * This source ends if all source streams end.\n * @param reactiveSources Sources to merge\n * @param options Options for merging \n * @returns \n */\nexport function combineLatestToObject<const T extends Record<string, ReactiveOrSource<any>>>(reactiveSources: T, options: Partial<CombineLatestOptions> = {}): CombineLatestToObject<T> {// { sources: RxValueTypeRx<T> } & Reactive<RxValueTypeObject<T>> & ReactiveInitial<RxValueTypeObject<T>> {\n  type State<V> = {\n    source: Reactive<V>\n    done: boolean\n    data: V | undefined\n    off: () => void\n  }\n  const disposeSources = options.disposeSources ?? true;\n  const event = object<RxValueTypeObject<T>>(undefined);\n  const onSourceDone = options.onSourceDone ?? `break`;\n  const emitInitial = options.emitInitial ?? true;\n  let emitInitialDone = false;\n\n  const states = new Map<string, State<any>>();\n  for (const [ key, source ] of Object.entries(reactiveSources)) {\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-call\n    const initialData = (`last` in source) ? (source as any).last() : undefined;\n    const s: State<any> = {\n      source: resolveSource(source),\n      done: false,\n      data: initialData,\n      off: () => { /** no-op */ }\n    }\n    states.set(key, s);\n  }\n  const sources = Object.fromEntries(Object.entries(states).map(entry => [ entry[ 0 ], entry[ 1 ].source ])) as RxValueTypeRx<T>;\n  // eslint-disable-next-line unicorn/no-array-callback-reference, unicorn/no-array-method-this-argument\n  const someUnfinished = () => MapFns.some(states, v => !v.done);\n\n  const unsub = () => {\n    //console.log(`Rx.MergeToObject.unsub states: ${ [ ...states.keys() ].join(`,`) }`);\n    for (const state of states.values()) state.off();\n  }\n\n  const getData = () => {\n    const r = {};\n    for (const [ key, state ] of states) {\n      const d = state.data;\n      if (d !== undefined) {\n        (r as any)[ key ] = state.data;\n      }\n    }\n    //console.log(`Rx.Ops.CombineLatestToObject getData`, r);\n\n    return r as RxValueTypeObject<T>;\n  }\n\n  const trigger = () => {\n    emitInitialDone = true;\n    const d = getData();\n    //console.log(`Rx.Ops.combineLatestToObject trigger`, d);\n    event.set(d);\n  }\n\n  const wireUpState = (state: State<any>) => {\n    state.off = state.source.on(message => {\n      if (messageIsDoneSignal(message)) {\n        state.done = true;\n        state.off();\n        state.off = () => {/**no-op */ }\n        if (onSourceDone === `break`) {\n          unsub();\n          event.dispose(`Source has completed and 'break' is behaviour`);\n          return;\n        }\n        if (!someUnfinished()) {\n          // All sources are done\n          unsub();\n          event.dispose(`All sources completed`);\n        }\n      } else if (messageHasValue(message)) {\n        state.data = message.value;\n        trigger();\n      }\n    });\n  }\n\n  for (const state of states.values()) {\n    wireUpState(state);\n  }\n\n  if (!emitInitialDone && emitInitial) {\n    //console.log(`Rx.Ops.CombineLatestToObject emitting initial`);\n    trigger();\n  }\n  return {\n    ...event,\n    hasSource(field: string) {\n      return states.has(field)\n    },\n    replaceSource(field, source) {\n      const state = states.get(field);\n      if (state === undefined) throw new Error(`Field does not exist: '${ field }'`);\n      state.off();\n      const s = resolveSource(source);\n      state.source = s;\n      wireUpState(state);\n    },\n    setWith(data) {\n      let written = {};\n      for (const [ key, value ] of Object.entries(data)) {\n        const state = states.get(key);\n        if (state !== undefined) {\n          if (isWritable(state.source)) {\n            state.source.set(value);\n            (written as any)[ key ] = value;\n          }\n          state.data = value;\n        }\n      }\n      return written;\n    },\n    sources,\n    last() {\n      return getData()\n    },\n    dispose(reason: string) {\n      unsub();\n      event.dispose(reason);\n      if (disposeSources) {\n        for (const v of states.values()) {\n          v.source.dispose(`Part of disposed mergeToObject`)\n        }\n      }\n    }\n  }\n}","import { initUpstream } from \"../InitStream.js\";\nimport { toReadable } from \"../ToReadable.js\";\nimport type { ReactiveOrSource, Reactive, ReactivePingable } from \"../Types.js\";\nimport { hasLast } from \"../Util.js\";\n\n/**\n * When there is a value from `input`, or the reactive is pinged,\n * this reactive emits the result of `fn`.\n * \n * `fn` is provided the previous value as well as the most recent value.\n * \n * If no previous value is available, the current value is emitted and `fn` is not called.\n * @param input \n * @param fn \n * @returns \n */\nexport function computeWithPrevious<TIn>(input: ReactiveOrSource<TIn>, fn: (previous: TIn, current: TIn) => TIn): ReactivePingable<TIn> {\n  let previousValue: TIn | undefined;\n  let currentValue: TIn | undefined;\n  if (hasLast(input)) {\n    currentValue = previousValue = input.last();\n  }\n\n  const trigger = () => {\n    if (previousValue === undefined && currentValue !== undefined) {\n      previousValue = currentValue;\n      upstream.set(previousValue);\n    } else if (previousValue !== undefined && currentValue !== undefined) {\n      const vv = fn(previousValue, currentValue);\n      //console.log(`vv: ${ vv } prev: ${ previousValue } target: ${ target }`)\n      previousValue = vv;\n      upstream.set(vv);\n    }\n  }\n\n  const upstream = initUpstream<TIn, TIn>(input, {\n    lazy: \"very\",\n    debugLabel: `computeWithPrevious`,\n    onValue(value) {\n      //console.log(`onValue ${ value }`);\n      currentValue = value;\n      trigger();\n    },\n  })\n  if (currentValue) trigger();\n\n  return {\n    ...toReadable(upstream),\n    ping: () => {\n      if (currentValue !== undefined) trigger()\n    }\n  }\n}","import { intervalToMs } from \"../../flow/IntervalType.js\";\nimport { timeout } from \"../../flow/Timeout.js\";\nimport { initUpstream } from \"../InitStream.js\";\nimport type { ReactiveOrSource, Reactive } from \"../Types.js\";\nimport { toReadable } from \"../ToReadable.js\";\nimport type { DebounceOptions } from \"./Types.js\";\n\n/**\n * Debounce waits for `elapsed` time after the last received value before emitting it.\n * \n * If a flurry of values are received that are within the interval, it won't emit anything. But then\n * as soon as there is a gap in the messages that meets the interval, the last received value is sent out.\n * \n * `debounce` always emits with at least `elapsed` as a delay after a value received. While {@link throttle} potentially\n * sends immediately, if it's outside of the elapsed period.\n * \n * This is a subtly different logic to {@link throttle}. `throttle` more eagerly sends the first value, potentially\n * not sending later values. `debouce` however will send later values, potentially ignoring earlier ones.\n * @param source \n * @param options \n * @returns \n */\nexport function debounce<V>(source: ReactiveOrSource<V>, options: Partial<DebounceOptions> = {}): Reactive<V> {\n  const elapsed = intervalToMs(options.elapsed, 50);\n  let lastValue: V | undefined;\n\n  const timer = timeout(() => {\n    const v = lastValue;\n    if (v) {\n      upstream.set(v);\n      lastValue = undefined;\n    }\n  }, elapsed);\n\n  const upstream = initUpstream<V, V>(source, {\n    ...options,\n    onValue(value) {\n      lastValue = value;\n      timer.start();\n    }\n  });\n  return toReadable(upstream);\n}\n\n","import type { ReactiveOrSource } from \"../Types.js\";\nimport { transform } from \"./Transform.js\";\n\n/**\n * Emits time in milliseconds since last message.\n * If it is the first value, 0 is used.\n * @param input \n * @returns \n */\nexport const elapsed = <In>(input: ReactiveOrSource<In>) => {\n  let last = 0;\n  return transform<In, number>(input, (_ignored) => {\n    const elapsed = last === 0 ? 0 : Date.now() - last;\n    last = Date.now();\n    return elapsed;\n  });\n}","/* eslint-disable @typescript-eslint/unbound-method */\nimport { initUpstream } from \"../InitStream.js\";\nimport type { ReactiveOrSource, Reactive } from \"../Types.js\";\nimport { toReadable } from \"../ToReadable.js\";\nimport type { FieldOptions } from \"./Types.js\";\n\n/**\n * From a source value, yields a field from it. Only works\n * if stream values are objects.\n * \n * If a source value doesn't have that field, it is skipped.\n *\n * @returns \n */\nexport function field<TIn extends object, TFieldType>(fieldSource: ReactiveOrSource<TIn>, fieldName: keyof TIn, options: Partial<FieldOptions<TIn, TFieldType>> = {}): Reactive<TFieldType> {\n  const fallbackFieldValue = options.fallbackFieldValue;\n  const fallbackObject = options.fallbackObject;\n\n  const upstream = initUpstream<TIn, TFieldType>(fieldSource, {\n    disposeIfSourceDone: true,\n    ...options,\n    onValue(value) {\n      let v: TFieldType | undefined;\n      // 1. Try to read from value\n      if (fieldName in value) {\n        v = value[ fieldName ] as TFieldType;\n      } else if (fallbackObject && fieldName in fallbackObject) {\n        // 2. Read from fallback object\n        v = fallbackObject[ fieldName ] as TFieldType;\n      }\n      // 3. Use fallback value\n      if (v === undefined) {\n        v = fallbackFieldValue;\n      }\n      if (v !== undefined) {\n        upstream.set(v);\n      }\n    },\n  })\n  return toReadable(upstream);\n}","import { initUpstream } from \"../InitStream.js\";\nimport type { ReactiveOrSource, InitStreamOptions, Reactive } from \"../Types.js\";\nimport { toReadable } from \"../ToReadable.js\";\nimport type { FilterPredicate } from \"./Types.js\";\n\n/**\n * Passes all values where `predicate` function returns _true_.\n */\nexport function filter<In>(input: ReactiveOrSource<In>, predicate: FilterPredicate<In>, options: Partial<InitStreamOptions>): Reactive<In> {\n  const upstream = initUpstream<In, In>(input, {\n    ...options,\n    onValue(value) {\n      if (predicate(value)) {\n        upstream.set(value);\n      }\n    },\n  })\n  return toReadable(upstream);\n}\n\n\n/**\n * Drops all values where `predicate` function returns _true_.\n */\nexport function drop<In>(input: ReactiveOrSource<In>, predicate: FilterPredicate<In>, options: Partial<InitStreamOptions>): Reactive<In> {\n  const upstream = initUpstream<In, In>(input, {\n    ...options,\n    onValue(value) {\n      if (!predicate(value)) {\n        upstream.set(value);\n      }\n    },\n  })\n  return toReadable(upstream);\n}\n","import type { ReactiveOrSource, ReactivePingable } from \"../Types.js\";\nimport { interpolate as interpolateFunction, type InterpolateOptions } from \"../../numbers/Interpolate.js\";\nimport { computeWithPrevious } from \"./ComputeWithPrevious.js\";\n\nexport type OpInterpolateOptions = InterpolateOptions & {\n  amount: number\n  /**\n   * Percentage of value that we consider 'done'.\n   * Since interpolation can never converge to target exactly, this allows us to snap to completion.\n   * Default: 0.99, meaning if value gets to within 99%, return the target.\n   */\n  snapAt: number\n}\n\n/**\n * Interpolates to the source value.\n * \n * Outputs one value for every input value. Thus, to interpolation\n * over time, it's necessary to get the source to emit values at the desired rate.\n * \n * Options can specify an easing name or custom transform of easing progress.\n * @param input \n * @param options \n * @returns \n */\nexport function interpolate(input: ReactiveOrSource<number>, options: Partial<OpInterpolateOptions> = {}): ReactivePingable<number> {\n  const amount = options.amount ?? 0.1;\n  const snapAt = options.snapAt ?? 0.99;\n\n  const i = interpolateFunction(amount, options);\n\n  return computeWithPrevious<number>(input, (previous, target) => {\n    const v = i(previous, target);\n    if (target > previous) {\n      if (v / target >= snapAt) return target;\n    }\n    return v;\n  });\n}\n\n\n/**\n * From the basis of an input stream of values, run a function over\n * each value. The function takes in the last value from the stream as well as the current.\n * @param input\n * @param fn\n * @returns\n */\n// export function interpolateToTarget<TIn>(input: ReactiveOrSource<TIn>, fn: (previous: TIn, target: TIn) => TIn): ReactivePingable<TIn> {\n//   let previousValue: TIn | undefined;\n//   let target: TIn | undefined;\n//   if (hasLast(input)) {\n//     target = previousValue = input.last();\n//   }\n\n//   const ping = () => {\n//     if (previousValue === undefined && target !== undefined) {\n//       previousValue = target;\n//     } else if (previousValue !== undefined && target !== undefined) {\n//       previousValue = fn(previousValue, target);\n//     }\n//     upstream.set(previousValue!);\n//   }\n\n//   const upstream = initUpstream<TIn, TIn>(input, {\n//     lazy: \"very\",\n//     debugLabel: `computeWithPrevious`,\n//     onValue(value) {\n//       target = value;\n//       ping();\n//     },\n//   })\n//   if (target) ping();\n\n//   return {\n//     ...toReadable(upstream),\n//     ping: () => {\n//       if (target !== undefined) ping()\n//     }\n//   }\n// }","import type { Process } from \"./Process.js\";\nimport type { RankFunction, RankOptions } from \"./Types.js\";\n\n/**\n * Outputs the current largest-seen value\n * @returns \n */\nexport const max = (): Process<number | Array<number>, number> => {\n  let max = Number.MIN_SAFE_INTEGER;\n  const compute = (value: number | Array<number>) => {\n    const valueArray = Array.isArray(value) ? value : [ value ];\n    for (const subValue of valueArray) {\n      if (typeof subValue !== `number`) break;\n      max = Math.max(subValue, max);\n    }\n    return max;\n  }\n  return compute;\n}\n\n/**\n * Outputs the current smallest-seen value\n * @returns\n */\nexport const min = (): Process<number | Array<number>, number> => {\n  let min = Number.MAX_SAFE_INTEGER;\n  const compute = (value: number | Array<number>) => {\n    const valueArray = Array.isArray(value) ? value : [ value ];\n    for (const subValue of valueArray) {\n      if (typeof subValue !== `number`) break;\n      min = Math.min(subValue, min);\n    }\n    return min;\n  }\n  return compute;\n}\n\n/**\n * Returns a sum of values\n * @returns \n */\nexport const sum = (): Process<number | Array<number>, number> => {\n  let t = 0;\n  const compute = (value: number | Array<number>) => {\n    const valueArray = Array.isArray(value) ? value : [ value ];\n    for (const subValue of valueArray) {\n      if (typeof subValue !== `number`) continue;\n      t += subValue;\n    }\n    return t;\n  }\n  return compute;\n}\n\n/**\n * Returns the current average of input values\n * @returns \n */\nexport const average = (): Process<number | Array<number>, number> => {\n  let total = 0;\n  let tally = 0;\n  const compute = (value: number | Array<number>) => {\n    const valueArray = Array.isArray(value) ? value : [ value ];\n    for (const subValue of valueArray) {\n      if (typeof subValue !== `number`) continue;\n      tally++;\n      total += subValue;\n    }\n    return total / tally;\n  }\n  return compute;\n}\n\n/**\n * Returns the tally (ie number of) values\n * @param countArrayItems \n * @returns \n */\nexport const tally = (countArrayItems: boolean): Process<any, number> => {\n  let t = 0;\n  const compute = (value: number | Array<number>) => {\n    if (countArrayItems) {\n      if (Array.isArray(value)) t += value.length;\n      else t++;\n    } else {\n      t++;\n    }\n    return t;\n  }\n  return compute;\n}\n\n\n\n/**\n * Returns the 'best' value seen so far as determined by a ranking function.\n * This is similar to min/max but usable for objects.\n * @param r \n * @param options \n * @returns \n */\nexport function rank<In>(r: RankFunction<In>, options: Partial<RankOptions> = {}) {\n  const includeType = options.includeType;\n  const emitEqualRanked = options.emitEqualRanked ?? false;\n  const emitRepeatHighest = options.emitRepeatHighest ?? false;\n  let best: In | undefined;\n  return (value: In) => {\n    if (includeType && typeof value !== includeType) return;\n    if (best === undefined) {\n      best = value;\n      return best;\n    } else {\n      const result = r(value, best);\n      //console.log(`result: ${ result } value: ${ JSON.stringify(value) } best: ${ JSON.stringify(best) }`);\n      if (result == `a`) {\n        // New value is the current best\n        best = value;\n        return best;\n      } else if (result === `eq` && emitEqualRanked) {\n        // New value is same rank as previous, but we have flag on\n        return best;\n      } else if (emitRepeatHighest) {\n        // Emit current highest due to flag\n        return best;\n      }\n    }\n  }\n}\n\n\n","import { initUpstream } from \"../InitStream.js\";\nimport { toReadable } from \"../ToReadable.js\";\nimport type { Reactive, ReactiveOrSource } from \"../Types.js\";\nimport * as BasicProcessors from '../../data/BasicProcessors.js';\nimport type { Process } from \"../../data/Process.js\";\nimport type { OpAsAnnotation, OpMathOptions } from \"./Types.js\";\nimport type { RankFunction, RankOptions } from \"../../data/Types.js\";\n\nexport function max(input: ReactiveOrSource<any>, options: OpMathOptions): Reactive<number>;\nexport function max(input: ReactiveOrSource<any>, options: OpAsAnnotation & OpMathOptions): Reactive<{ value: number, max: number }>;\nexport function max(input: ReactiveOrSource<any>, options: OpMathOptions): Reactive<number> | Reactive<{ value: number, max: number }> {\n  const p = BasicProcessors.max();\n  return process(p, `max`, input, options);\n}\n\nexport function min(input: ReactiveOrSource<any>, options: OpMathOptions): Reactive<number>;\nexport function min(input: ReactiveOrSource<any>, options: OpAsAnnotation & OpMathOptions): Reactive<{ value: number, min: number }>;\nexport function min(input: ReactiveOrSource<any>, options: OpMathOptions): Reactive<number> | Reactive<{ value: number, min: number }> {\n  const p = BasicProcessors.min();\n  return process(p, `min`, input, options);\n}\n\nexport function average(input: ReactiveOrSource<any>, options: OpMathOptions): Reactive<number>;\nexport function average(input: ReactiveOrSource<any>, options: OpAsAnnotation & OpMathOptions): Reactive<{ value: number, average: number }>;\nexport function average(input: ReactiveOrSource<any>, options: OpMathOptions): Reactive<number> | Reactive<{ value: number, average: number }> {\n  const p = BasicProcessors.average();\n  return process(p, `average`, input, options);\n}\n\nexport function sum(input: ReactiveOrSource<any>, options: OpMathOptions): Reactive<number>;\nexport function sum(input: ReactiveOrSource<any>, options: OpAsAnnotation & OpMathOptions): Reactive<{ value: number, sum: number }>;\nexport function sum(input: ReactiveOrSource<any>, options: OpMathOptions): Reactive<number> | Reactive<{ value: number, sum: number }> {\n  const p = BasicProcessors.sum();\n  return process(p, `sum`, input, options);\n}\n\nexport type TallyOptions = OpMathOptions & {\n  countArrayItems: boolean\n}\n\nexport function tally(input: ReactiveOrSource<any>, options: Partial<TallyOptions>): Reactive<number>;\nexport function tally<TIn>(input: ReactiveOrSource<TIn>, options: OpAsAnnotation & Partial<TallyOptions>): Reactive<{ value: TIn, tally: number }>;\nexport function tally<TIn>(input: ReactiveOrSource<TIn>, options: Partial<TallyOptions> = {}): Reactive<number> | Reactive<{ value: TIn, tally: number }> {\n  const countArrayItems = options.countArrayItems ?? true;\n  const p = BasicProcessors.tally(countArrayItems);\n  return process(p, `tally`, input, options);\n}\n\nexport function rank<TIn>(input: ReactiveOrSource<any>, rank: RankFunction<TIn>, options: Partial<RankOptions & OpMathOptions>): Reactive<TIn>;\nexport function rank<TIn>(input: ReactiveOrSource<any>, rank: RankFunction<TIn>, options: OpAsAnnotation & Partial<RankOptions & OpMathOptions>): Reactive<{ value: TIn, rank: TIn }>;\nexport function rank<TIn>(input: ReactiveOrSource<any>, rank: RankFunction<TIn>, options: Partial<RankOptions & OpMathOptions>): Reactive<TIn> | Reactive<{ value: TIn, rank: TIn }> {\n  const p = BasicProcessors.rank(rank, options);\n  return process(p, `rank`, input, options);\n}\n\nfunction process(processor: Process<any, any>, annotationField: string, input: ReactiveOrSource<any>, options: OpMathOptions = {}) {\n  const annotate = options.annotate;\n  let previous: number | undefined;\n  const skipUndefined = options.skipUndefined ?? true;\n  const skipIdentical = options.skipIdentical ?? true;\n  const upstream = initUpstream<any, any>(input, {\n    ...options,\n    onValue(value) {\n      const x = processor(value);\n      if (x === undefined && skipUndefined) return;\n      if (skipIdentical && x === previous) return;\n      previous = x;\n      if (annotate) {\n        // eslint-disable-next-line unicorn/prevent-abbreviations\n        const ret: any = { value };\n        ret[ annotationField ] = x;\n        upstream.set(ret);\n      } else {\n        upstream.set(x);\n      }\n    },\n  })\n  return toReadable(upstream);\n}\n\n//todo testing for annotation and non - annotated\n\n\n// rankArray\n\n// chunk, reduce\n\n// debounce, delay\n\n// duration, take","/* eslint-disable @typescript-eslint/unbound-method */\nimport { initStream } from \"../InitStream.js\";\nimport type { PipeSet, Reactive, Passed } from \"../Types.js\";\nimport { messageHasValue, messageIsDoneSignal } from \"../Util.js\";\n\n/**\n * Pipes the output of one stream into another, in order.\n * The stream returned is a new stream which captures the final output.\n * \n * If any stream in the pipe closes the whole pipe is closed.\n * @param streams \n * @returns \n */\nexport const pipe = <TInput, TOutput>(...streams: PipeSet<TInput, TOutput>): Reactive<TOutput> => {\n  const event = initStream<TOutput>();\n  const unsubs: Array<() => void> = [];\n  const performDispose = (reason: string) => {\n    for (const s of streams) {\n      if (!s.isDisposed) s.dispose(reason);\n    }\n    for (const s of unsubs) {\n      s();\n    }\n    event.dispose(reason);\n  }\n\n  for (let index = 0; index < streams.length; index++) {\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-call\n    unsubs.push(streams[ index ].on((message: Passed<unknown>) => {\n      const isLast = index === streams.length - 1;\n      if (messageHasValue(message)) {\n        if (isLast) {\n          // Last stream, send to output\n          event.set(message.value as TOutput);\n        } else {\n          // @ts-expect-error\n          // eslint-disable-next-line @typescript-eslint/no-unsafe-call\n          streams[ index + 1 ].set(message.value);\n        }\n      } else if (messageIsDoneSignal(message)) {\n        performDispose(`Upstream disposed`);\n      }\n    }));\n  }\n  return {\n    on: event.on,\n    onValue: event.onValue,\n    dispose(reason) {\n      performDispose(reason);\n    },\n    isDisposed() {\n      return event.isDisposed();\n    },\n  };\n}","import { shuffle } from \"../../data/arrays/Random.js\";\nimport { initUpstream } from \"../InitStream.js\";\nimport type { ReactiveOrSource, Reactive } from \"../Types.js\";\nimport type { SingleFromArrayOptions } from \"./Types.js\";\n\n/**\n * For a stream that emits arrays of values, this op will select a single value.\n * \n * Can select based on:\n * * predicate: a function that returns _true_ for a value\n * * at: selection based on array index (can be combined with random ordering to select a random value)\n * \n * ```js\n * // If source is Reactive<Array<number>>, picks the first even number\n * singleFromArray(source, { \n *  predicate: v => v % 2 === 0\n * });\n * \n * // Selects a random value from source\n * singleFromArray(source, { \n *  order: `random`,\n *  at: 0\n * });\n * ```\n * \n * If neither `predicate` or `at` options are given, exception is thrown.\n * @param source Source to read from\n * @param options Options for selection\n * @returns \n */\nexport function singleFromArray<V>(source: ReactiveOrSource<Array<V>>, options: Partial<SingleFromArrayOptions<V>> = {}): Reactive<V> {\n  const order = options.order ?? `default`;\n  if (!options.at && !options.predicate) throw new Error(`Options must have 'predicate' or 'at' fields`);\n\n  let preprocess = (values: Array<V>) => values;\n  if (order === `random`) preprocess = shuffle;\n  else if (typeof order === `function`) preprocess = (values) => values.toSorted(order);\n\n  const upstream = initUpstream<Array<V>, V>(source, {\n    onValue(values) {\n      values = preprocess(values);\n      if (options.predicate) {\n        for (const v of values) {\n          if (options.predicate(v)) {\n            upstream.set(v);\n          }\n        }\n      } else if (options.at) {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        upstream.set(values.at(options.at)!);\n      }\n    },\n  });\n  return upstream;\n}\n","import { initUpstream } from \"../InitStream.js\";\nimport { resolveSource } from \"../ResolveSource.js\";\nimport type { ReactiveOrSource, ReactiveStream, Reactive } from \"../Types.js\";\nimport type { SplitOptions } from \"./Types.js\";\n\n/**\n * Creates a set of streams each of which receives data from `source`.\n * By default these are lazy and dispose if the upstream source closes.\n * \n * See also {@link splitLabelled} to split into named streams.\n * @param rxOrSource \n * @param options \n * @returns \n */\nexport const split = <T>(rxOrSource: ReactiveOrSource<T>, options: Partial<SplitOptions> = {}) => {\n  const quantity = options.quantity ?? 2;\n  const outputs: Array<ReactiveStream<T>> = [];\n  const source = resolveSource(rxOrSource);\n  for (let index = 0; index < quantity; index++) {\n    outputs.push(initUpstream(source, { disposeIfSourceDone: true, lazy: `initial` }));\n  }\n  return outputs;\n}\n\n/**\n * Splits `source` into several duplicated streams. \n * Returns an object with keys according to `labels`.\n * Each value is a stream which echos the values from `source`.\n * ```js\n * const { a, b, c} = splitLabelled(source, `a`, `b`, `c`);\n * // a, b, c are Reactive types\n * ```\n * \n * See also {@link split} to get an unlabelled split\n * @param rxOrSource \n * @param labels \n * @returns \n */\nexport const splitLabelled = <T, K extends PropertyKey>(rxOrSource: ReactiveOrSource<T>, labels: Array<K>): Record<K, Reactive<T>> => {\n  const source = resolveSource(rxOrSource);\n  const t: Partial<Record<K, Reactive<T>>> = {}\n  for (const label of labels) {\n    t[ label ] = initUpstream(source, { lazy: `initial`, disposeIfSourceDone: true });\n  }\n  return t as Record<K, Reactive<T>>;\n}","import { initStream } from \"../InitStream.js\";\nimport { resolveSource } from \"../ResolveSource.js\";\nimport type { ReactiveOrSource, Reactive, ReactiveStream } from \"../Types.js\";\nimport { messageHasValue, messageIsDoneSignal } from \"../Util.js\";\nimport type { FilterPredicate, SwitcherOptions } from \"./Types.js\";\n\n/**\n * Switcher generates several output streams, labelled according to the values of `cases`.\n * Values from `source` are fed to the output streams if their associated predicate function returns _true_.\n * \n * In this way, we can split one input stream into several output streams, each potentially getting a different\n * subset of the input.\n * \n * With `options`, you can specify whether to send to multiple outputs if several match, or just the first (default behaviour).\n * \n * The below example shows setting up a switcher and consuming the output streams.\n * @example\n * ```js\n * // Initialise a reactive number, starting at 0\n * const switcherSource = Reactive.number(0);\n * // Set up the switcher\n * const x = Reactive.switcher(switcherSource, {\n *  even: v => v % 2 === 0,\n *  odd: v => v % 2 !== 0\n * });\n * // Listen for outputs from each of the resulting streams\n * x.even.on(msg => {\n *   log(`even: ${msg.value}`);\n * });\n * x.odd.on(msg => {\n *   log(`odd: ${msg.value}`);\n * })\n * // Set new values to the number source, counting upwards\n * // ...this will in turn trigger the outputs above\n * setInterval(() => {\n *   switcherSource.set(switcherSource.last() + 1);\n * }, 1000);\n * ```\n * \n * If `source` closes, all the output streams will be closed as well.\n * @param reactiveOrSource \n * @param cases \n * @param options \n * @returns \n */\nexport const switcher = <TValue, TRec extends Record<string, FilterPredicate<TValue>>, TLabel extends keyof TRec>(reactiveOrSource: ReactiveOrSource<TValue>, cases: TRec, options: Partial<SwitcherOptions> = {}): Record<TLabel, Reactive<TValue>> => {\n  // return (r: ReactiveOrSource<TValue>): Record<TLabel, Reactive<TValue>> => {\n  const match = options.match ?? `first`;\n  const source = resolveSource(reactiveOrSource);\n  let disposed = false;\n  // Setup output streams\n  const t: Partial<Record<TLabel, ReactiveStream<TValue>>> = {}\n  for (const label of Object.keys(cases)) {\n    (t as any)[ label ] = initStream<TValue>();\n  }\n\n  const performDispose = () => {\n    if (disposed) return;\n    unsub();\n    disposed = true;\n    for (const stream of Object.values(t)) {\n      (stream as ReactiveStream<any>).dispose(`switcher source dispose`);\n    }\n  }\n\n  // Listen to source\n  const unsub = source.on(message => {\n    // Got a value\n    if (messageHasValue(message)) {\n      for (const [ lbl, pred ] of Object.entries(cases)) {\n        if (pred(message.value)) {\n          ((t as any)[ lbl ] as ReactiveStream<TValue>).set(message.value);\n          if (match === `first`) break;\n        }\n      }\n    } else if (messageIsDoneSignal(message)) {\n      performDispose();\n    }\n  })\n  return t as Record<TLabel, Reactive<TValue>>;\n  // }\n}\n","/* eslint-disable @typescript-eslint/unbound-method */\nimport { intervalToMs } from \"../../flow/IntervalType.js\";\nimport { initStream } from \"../InitStream.js\";\nimport { resolveSource } from \"../ResolveSource.js\";\nimport type { ReactiveOrSource, Reactive, RxValueTypes } from \"../Types.js\";\nimport { messageIsSignal } from \"../Util.js\";\nimport type { SyncOptions } from \"./Types.js\";\n\n/**\n * Waits for all sources to produce a value, sending the combined results as an array.\n * After sending, it waits again for each source to send at least one value.\n * \n * Use {@link syncToObject} to output objects based on labelled sources rather than an array of values.\n * \n * Pace will be set by the slowest source. Alternatively, use {@link combineLatestToArray} where the rate is determined by fastest source.\n * \n * Only complete results are sent. For example if source A & B finish and source C is still producing values,\n * synchronisation is not possible because A & B stopped producing values. Thus the stream will self-terminate\n * after `maximumWait` (2 seconds). The newer values from C are lost.\n */\nexport function syncToArray<const T extends ReadonlyArray<ReactiveOrSource<any>>>(reactiveSources: T, options: Partial<SyncOptions> = {}): Reactive<RxValueTypes<T>> {\n  const onSourceDone = options.onSourceDone ?? `break`;\n  const finalValue = options.finalValue ?? `undefined`;\n  const maximumWait = intervalToMs(options.maximumWait, 2000);\n\n  let watchdog: ReturnType<typeof globalThis.setTimeout> | undefined;\n\n  type State<V> = {\n    done: boolean,\n    finalData: V | undefined,\n    source: Reactive<V>\n    unsub: () => void\n  }\n\n  const data: Array<RxValueTypes<T> | undefined> = [];\n  //const finalData: Array<RxValueTypes<T> | undefined> = [];\n\n  // Resolve sources\n  //const sources = reactiveSources.map(source => resolveSource(source));\n  //const noop = () => {/*no-op*/ }\n  //const sourcesUnsub: Array<Unsubscriber> = sources.map(_ => noop);\n\n  const states: Array<State<any>> = reactiveSources.map(source => ({\n    finalData: undefined,\n    done: false,\n    source: resolveSource(source),\n    unsub: () => {/**no-op */ }\n  }));\n\n\n  const unsubscribe = () => {\n    for (const s of states) {\n      s.unsub();\n      s.unsub = () => {/**no-op */ }\n    }\n  }\n\n  const isDataSetComplete = () => {\n    // eslint-disable-next-line unicorn/no-for-loop\n    for (let index = 0; index < data.length; index++) {\n      if (onSourceDone === `allow` && states[ index ].done) continue;\n      if (data[ index ] === undefined) return false;\n    }\n    return true;\n  }\n\n  const hasIncompleteSource = () => states.some(s => !s.done);\n  const resetDataSet = () => {\n    for (let index = 0; index < data.length; index++) {\n      if (finalValue === `last` && states[ index ].done) continue; // Don't overwrite\n      data[ index ] = undefined;\n    }\n  }\n\n  const onWatchdog = () => {\n    done(`Sync timeout exceeded (${ maximumWait.toString() })`);\n  }\n\n  const done = (reason: string) => {\n    if (watchdog) clearTimeout(watchdog);\n    unsubscribe();\n    event.dispose(reason);\n  }\n\n  const init = () => {\n    watchdog = setTimeout(onWatchdog, maximumWait);\n\n    for (const [ index, state ] of states.entries()) {\n      data[ index ] = undefined; // init array positions to be undefined\n\n      state.unsub = state.source.on(valueChanged => {\n        if (messageIsSignal(valueChanged)) {\n          if (valueChanged.signal === `done`) {\n            state.finalData = data[ index ];\n            state.unsub();\n            state.done = true;\n            state.unsub = () => { /** no-op */ }\n            if (finalValue === `undefined`) data[ index ] = undefined;\n            if (onSourceDone === `break`) {\n              done(`Source '${ index.toString() }' done, and onSourceDone:'break' is set`);\n              return;\n            }\n            if (!hasIncompleteSource()) {\n              done(`All sources done`);\n              return;\n            }\n          }\n          return;\n        }\n        data[ index ] = valueChanged.value;\n\n        if (isDataSetComplete()) {\n          // All array elements contain values\n          // Emit data and reset\n          event.set([ ...data ] as RxValueTypes<T>);\n          resetDataSet();\n          if (watchdog) clearTimeout(watchdog);\n          watchdog = setTimeout(onWatchdog, maximumWait);\n        }\n      });\n    }\n  }\n\n  const event = initStream<RxValueTypes<T>>({\n    onFirstSubscribe() {\n      unsubscribe();\n      init();\n    },\n    onNoSubscribers() {\n      if (watchdog) clearTimeout(watchdog);\n      unsubscribe();\n\n    },\n  });\n\n  return {\n    dispose: event.dispose,\n    isDisposed: event.isDisposed,\n    on: event.on,\n    onValue: event.onValue\n  }\n\n}\n","import { zipKeyValue } from \"../../data/maps/MapFns.js\";\nimport type { ReactiveOrSource, Reactive, RxValueTypeObject } from \"../Types.js\";\nimport { syncToArray } from \"./SyncToArray.js\";\nimport { transform } from \"./Transform.js\";\nimport type { SyncOptions } from \"./Types.js\";\n\nexport function syncToObject<const T extends Record<string, ReactiveOrSource<any>>>(reactiveSources: T, options: Partial<SyncOptions> = {}): Reactive<RxValueTypeObject<T>> {\n  const keys = Object.keys(reactiveSources)\n  const values = Object.values(reactiveSources);\n\n  const s = syncToArray(values, options);\n  const st = transform(s, (streamValues) => {\n    return zipKeyValue(keys, streamValues);\n  });\n  return st as Reactive<RxValueTypeObject<T>>;\n}","import { toStringDefault } from \"../util/ToString.js\";\nimport { isEqualDefault } from \"../util/IsEqual.js\";\nexport { average, max, min, tally, sum, rank } from './BasicProcessors.js';\n\nexport type Process<TIn, TOut> = (value: TIn) => TOut;\nexport type ProcessFactory<TIn, TOut> = () => Process<TIn, TOut>;\n\nexport type Processors1<T1, T2> = [\n  Process<T1, T2>\n]\n\nexport type Processors2<T1, T2, T3> = [\n  Process<T1, T2>,\n  Process<T2, T3>\n]\n\nexport type Processors3<T1, T2, T3, T4> = [\n  Process<T1, T2>,\n  Process<T2, T3>,\n  Process<T3, T4>\n]\n\nexport type Processors4<T1, T2, T3, T4, T5> = [\n  Process<T1, T2>,\n  Process<T2, T3>,\n  Process<T3, T4>,\n  Process<T4, T5>\n]\n\nexport type Processors5<T1, T2, T3, T4, T5, T6> = [\n  Process<T1, T2>,\n  Process<T2, T3>,\n  Process<T3, T4>,\n  Process<T4, T5>,\n  Process<T5, T6>\n]\nexport type Processors<T1, T2, T3, T4, T5, T6> = Processors1<T1, T2> | Processors2<T1, T2, T3> | Processors3<T1, T2, T3, T4> | Processors4<T1, T2, T3, T4, T5> | Processors5<T1, T2, T3, T4, T5, T6>;\n\nexport function flow<T1, T2>(...processors: [ Process<T1, T2> ]): (value: T1) => T2;\nexport function flow<T1, T2, T3>(...processors: [ Process<T1, T2>, Process<T2, T3> ]): (value: T1) => T3;\nexport function flow<T1, T2, T3, T4>(...processors: [ Process<T1, T2>, Process<T2, T3>, Process<T3, T4> ]): (value: T1) => T4;\nexport function flow<T1, T2, T3, T4, T5>(...processors: [ Process<T1, T2>, Process<T2, T3>, Process<T3, T4>, Process<T4, T5> ]): (value: T1) => T5;\nexport function flow<T1, T2, T3, T4, T5, T6>(...processors: [ Process<T1, T2>, Process<T2, T3>, Process<T3, T4>, Process<T4, T5>, Process<T5, T6> ]): (value: T1) => T6;\n\n/**\n * Creates a flow of data processors (up to 5 are supported).\n * The flow is encapsulated in a function that accepts an input value an returns an output.\n * \n * ```js\n * const p = flow(\n *  (value:string) => value.toUpperCase(), // Convert to uppercase\n *  (value:string) => value.at(0) === 'A') // If first letter is an A, return true\n * );\n * p('apple'); // True\n * ```\n * \n * Each processing function is expected to take in one input value and return one value.\n * @param processors \n * @returns \n */\nexport function flow<T1, T2, T3, T4, T5, T6>(...processors: Processors<T1, T2, T3, T4, T5, T6>): (value: T1) => T2 | T3 | T4 | T5 | T6 {\n  return (value: T1) => {\n    let v = value;\n    for (const p of processors) {\n      try {\n        // @ts-expect-error\n        v = p(v);\n      } catch (err) {\n        if (err instanceof CancelError) {\n          break;\n        } else {\n          throw err;\n        }\n      }\n    }\n    return v as T2 | T3 | T4 | T5 | T6;\n  }\n}\n\n/**\n * If a value is same as the previous value, _undefined_ is emitted instead.\n * @param eq Equality function. If not specified, === semantics are used.\n * @returns \n */\nexport function seenLastToUndefined<TIn>(eq?: (a: TIn, b: TIn) => boolean): Process<TIn, TIn | undefined> {\n  if (eq === undefined) eq = isEqualDefault;\n  let lastValue: TIn | undefined;\n  return (value: TIn) => {\n    if (value !== lastValue) {\n      lastValue = value;\n      return value;\n    }\n    return undefined;\n  }\n}\n\n/**\n * If a value is same as any previously-seen value, _undefined_ is emitted instead.\n * It stores all previous values and compares against them for each new value. \n * This would likely be not very efficient compared to {@link seenToUndefinedByKey} which uses a one-time computed\n * key and efficient storage of only the keys (using a Set).\n *  \n * @param eq Equality function. If not specified, === semantics are used.\n * @returns \n */\nexport function seenToUndefined<TIn>(eq?: (a: TIn, b: TIn) => boolean): Process<TIn, TIn | undefined> {\n  let seen: TIn[] = [];\n  if (eq === undefined) eq = isEqualDefault;\n  return (value: TIn) => {\n    if (value === undefined) return;\n    for (const s of seen) {\n      if (eq(s, value)) return;\n    }\n    seen.push(value);\n    return value;\n  }\n}\n\n/**\n * If a value is the same as any previously-seen value, _undefined_ is emitted instead.\n * This version uses a function to create a string key of the object, by default JSON.stringify.\n * Thus we don't need to store all previously seen objects, just their keys.\n * \n * Alternatively, if a key function doesn't make sense for the value, use\n * {@link seenToUndefined}, which stores the values (less efficient).\n * \n * @param toString \n * @returns \n */\nexport function seenToUndefinedByKey<TIn>(toString?: (value: TIn) => string): Process<TIn, TIn | undefined> {\n  let seen = new Set<string>();\n  if (toString === undefined) toString = toStringDefault;\n  return (value: TIn) => {\n    if (value === undefined) return;\n    const key = toString(value);\n    if (seen.has(key)) return;\n    seen.add(key);\n    return value;\n  }\n}\n/**\n * Calls a function if the input value is not undefined.\n * Return value from function is passed to next function in flow.\n * \n * ```js\n * const flow = Process.flow(\n *  Process.max(),\n *  Process.seenLastToUndefined(),\n *  Process.ifNotUndefined(v => {\n *    console.log(`v:`, v);\n *  })\n * );\n * flow(100); // Prints 'v:100'\n * flow(90);  // Nothing happens max value has not changed\n * flow(110); // Prints 'v:110'\n * ```\n * @param fn \n * @returns \n */\nexport function ifNotUndefined<TIn, TOut>(fn: (value: Exclude<TIn, undefined>) => TOut) {\n  return (value: TIn) => {\n    if (value === undefined) return value;\n    const v = fn(value as Exclude<TIn, undefined>);\n    return v;\n  }\n}\n\nexport class CancelError extends Error {\n  constructor(message: any) {\n    super(message);\n    this.name = `CancelError`;\n  }\n}\n\n/**\n * Cancels the remaining flow operations if _undefined_ is an input.\n * See also {@link ifUndefined} or {@link ifNotUndefined}.\n * \n * ```js\n * const c3 = Process.flow(\n *  Basic.max(),\n *  Process.seenLastToUndefined(),\n *  Process.cancelIfUndefined(),\n *  (v => {\n *   console.log(v);\n *  })\n * );\n * c3(100); // Prints '100'\n * c3(90);  // Doesn't print anything since max does not change\n * c3(110); // Prints '110'\n * ```\n * @returns \n */\nexport function cancelIfUndefined<TIn>() {\n  return (value: TIn | undefined) => {\n    if (value === undefined) throw new CancelError(`cancel`);\n    return value as TIn;\n  }\n}\n/**\n * Returns the output of `fn` if the input value is _undefined_.\n * See also: {@link ifNotUndefined} and {@link cancelIfUndefined}.\n * @param fn \n * @returns \n */\nexport function ifUndefined<TIn, TOut>(fn: () => TOut) {\n  return (value: TIn) => {\n    if (value === undefined) return fn();\n    else return value;\n  }\n}","import * as Process from \"../../data/Process.js\";\nimport { resolveSource } from \"../ResolveSource.js\";\nimport type { ReactiveOrSource, Reactive, ReactiveWritable, ReactiveOp } from \"../Types.js\";\n\n/**\n * 'Taps' the values from 'input', passing them to the 'process' function.\n * Return stream is the input stream, unaffected by what 'process' does.\n * @param input Input stream\n * @param processors List of processors\n * @returns \n */\nexport function tapProcess<In, T2, T3, T4, T5, T6>(input: ReactiveOrSource<In>, ...processors: Process.Processors<In, T2, T3, T4, T5, T6>): Reactive<In> {\n  const inputStream = resolveSource(input);\n  // @ts-expect-error\n  const chain = Process.chain(...processors);\n  inputStream.onValue(value => {\n    chain(value);\n  });\n  return inputStream;\n}\n\n/**\n * 'Taps' the values from 'input', passing them to 'diverged'\n * Returns the original input stream, unaffected by what 'diverged' does.\n * @param input Input stream\n * @param diverged Stream to write to \n * @returns \n */\nexport function tapStream<In>(input: ReactiveOrSource<In>, diverged: ReactiveWritable<In>): Reactive<In> {\n  const inputStream = resolveSource(input);\n  inputStream.onValue(value => {\n    diverged.set(value);\n  });\n  return inputStream;\n}\n\n/**\n * Create a parallel 'tap' of processing\n * @param input Input stream\n * @param ops Series of ops to process data\n * @returns \n */\nexport const tapOps = <TIn, TOut>(input: ReactiveOrSource<TIn>, ...ops: Array<ReactiveOp<TIn, TOut>>): Reactive<TOut> => {\n  for (const op of ops) {\n    // @ts-expect-error\n    input = op(input);\n  }\n  return input as any as Reactive<TOut>;\n}","import { intervalToMs } from \"../../flow/IntervalType.js\";\nimport { initUpstream } from \"../InitStream.js\";\nimport type { ReactiveOrSource, Reactive } from \"../Types.js\";\nimport { toReadable } from \"../ToReadable.js\";\nimport type { ThrottleOptions } from \"./Types.js\";\n\n/**\n * Only allow a value through if a minimum amount of time has elapsed.\n * since the last value. This effectively slows down a source to a given number\n * of values/ms. Values emitted by the source which are too fast are discarded.\n * \n * Throttle will fire on the first value received.\n * \n * In more detail:\n * Every time throttle passes a value, it records the time it allowed something through. For every\n * value received, it checks the elapsed time against this timestamp, throwing away values if\n * the period hasn't elapsed.\n * \n * With this logic, a fury of values of the source might be discarded if they fall within the elapsed time\n * window. But then if there is not a new value for a while, the actual duration between values can be longer\n * than expected. This is in contrast to {@link debounce}, which will emit the last value received after a duration, \n * even if the source stops sending.\n * @param options \n * @returns \n */\nexport function throttle<V>(throttleSource: ReactiveOrSource<V>, options: Partial<ThrottleOptions> = {}): Reactive<V> {\n  const elapsed = intervalToMs(options.elapsed, 0);\n  let lastFire = performance.now();\n  let lastValue: V | undefined;\n\n  const upstream = initUpstream<V, V>(throttleSource, {\n    ...options,\n    onValue(value) {\n      lastValue = value;\n      trigger();\n    },\n  });\n\n  const trigger = () => {\n    const now = performance.now();\n    if (elapsed > 0 && (now - lastFire > elapsed)) {\n      lastFire = now;\n      if (lastValue !== undefined) {\n        upstream.set(lastValue);\n      }\n    }\n  }\n\n\n  return toReadable(upstream);\n\n}\n","import { intervalToMs } from \"../../flow/IntervalType.js\";\nimport { initUpstream } from \"../InitStream.js\";\nimport type { ReactiveOrSource, Reactive } from \"../Types.js\";\nimport { isTrigger, resolveTriggerValue } from \"../Util.js\";\nimport type { TimeoutValueOptions } from \"../sources/Types.js\";\n\n/**\n * Emits a value if `source` does not emit a value after `interval`\n * has elapsed. This can be useful to reset a reactive to some\n * 'zero' state if nothing is going on.\n * \n * If `source` emits faster than the `interval`, it won't get triggered.\n * \n * Default for 'timeout': 1000s.\n * \n * ```js\n * // Emit 'hello' if 'source' doesn't emit a value after 1 minute\n * const r = Rx.timeoutValue(source, { value: 'hello', interval: { mins: 1 } });\n * ```\n * \n * Can also emit results from a function or generator\n * ```js\n * // Emits a random number if 'source' doesn't emit a value after 500ms\n * const r = Rx.timeoutValue(source, { fn: Math.random, interval: 500 });\n * ```\n * \n * If `immediate` option is _true_ (default), the timer starts from stream initialisation.\n * Otherwise it won't start until it observes the first value from `source`.\n * @param source \n * @param options \n */\nexport function timeoutValue<TSource, TTriggerValue>(source: ReactiveOrSource<TSource>, options: TimeoutValueOptions<TTriggerValue>): Reactive<TSource | TTriggerValue> {\n  let timer: ReturnType<typeof setTimeout> | undefined;\n  const immediate = options.immediate ?? true;\n  const repeat = options.repeat ?? false;\n  const timeoutMs = intervalToMs(options.interval, 1000);\n  if (!isTrigger(options)) {\n    throw new Error(`Param 'options' does not contain trigger 'value' or 'fn' fields`);\n  }\n\n  // Send value from trigger\n  const sendFallback = () => {\n    const [ value, done ] = resolveTriggerValue(options);\n    if (done) {\n      events.dispose(`Trigger completed`);\n    } else {\n      if (events.isDisposed()) return;\n      events.set(value);\n      if (repeat) {\n        timer = setTimeout(sendFallback, timeoutMs);\n      }\n    }\n  }\n\n  const events = initUpstream<TSource, TSource | TTriggerValue>(source, {\n    disposeIfSourceDone: true,\n    // Received a value from upstream source\n    onValue(v) {\n      // Reset timeout\n      if (timer) clearTimeout(timer);\n      timer = setTimeout(sendFallback, timeoutMs);\n      // Emit value\n      events.set(v);\n    },\n    onDispose() {\n      if (timer) clearTimeout(timer);\n    },\n  });\n\n  if (immediate && !timer) {\n    timer = setTimeout(sendFallback, timeoutMs);\n  }\n  return events;\n}\n","import { intervalToMs } from \"../../flow/IntervalType.js\";\nimport { initUpstream } from \"../InitStream.js\";\nimport { resolveSource } from \"../ResolveSource.js\";\nimport type { ReactiveOrSource, Reactive, ReactivePingable } from \"../Types.js\";\nimport { isPingable, isTrigger, messageHasValue, messageIsDoneSignal, resolveTriggerValue } from \"../Util.js\";\nimport type { TimeoutPingOptions, TimeoutValueOptions } from \"../sources/Types.js\";\n\n/**\n * Pings a reactive if no value is emitted at after `interval`.\n * Returns `source`.\n * \n * ```js\n * // Ping `source` if no value is emitted after one minute\n * const r = Rx.timeoutPing(source, { mins: 1 });\n * ```\n * \n * Behavior can be stopped using an abort signal.\n * @see {@link ReactivePingable}\n * @param source \n * @param options \n */\nexport function timeoutPing<TSource>(source: ReactiveOrSource<TSource>, options: TimeoutPingOptions): Reactive<TSource> {\n  let timer: ReturnType<typeof setTimeout> | undefined;\n  const rx = resolveSource(source);\n  const abort = options.abort;\n  const timeoutMs = intervalToMs(options, 1000);\n\n  // Send ping\n  const sendPing = () => {\n    if (abort?.aborted || rx.isDisposed()) {\n      off();\n      return;\n    }\n    if (isPingable(rx)) rx.ping(); // ignore if not pingable\n    timer = setTimeout(sendPing, timeoutMs);\n  }\n\n  const cancel = () => {\n    if (timer) clearTimeout(timer);\n  }\n\n  const off = rx.on(msg => {\n    if (messageHasValue(msg)) {\n      // Reset timeout\n      cancel();\n      timer = setTimeout(sendPing, timeoutMs);\n    } else if (messageIsDoneSignal(msg)) {\n      off();\n      cancel();\n    }\n  });\n\n  timer = setTimeout(sendPing, timeoutMs);\n  return rx;\n}\n","import { initStream } from \"../InitStream.js\";\nimport { resolveSource } from \"../ResolveSource.js\";\nimport type { ValueToPingOptions } from \"../sources/Types.js\";\nimport type { Reactive, ReactiveOrSource, ReactivePingable, Unsubscriber } from \"../Types.js\";\nimport { messageHasValue, messageIsDoneSignal, messageIsSignal } from \"../Util.js\";\n\n/**\n * Pings `target` whenever `source` emits a value. The value itself is ignored, it just\n * acts as a trigger.\n * \n * Returns a new stream capturing the output of `target`.\n * \n * It `source` or `target` closes, output stream closes too.\n * \n * @returns \n */\nexport function valueToPing<TSource, TTarget>(source: ReactiveOrSource<TSource>, target: ReactivePingable<TTarget>, options: Partial<ValueToPingOptions<TSource>> = {}): Reactive<TTarget> {\n  const lazy = options.lazy ?? `initial`;\n  const signal = options.signal;\n  const sourceRx = resolveSource(source);\n  const gate = options.gate ?? ((value: TSource) => true);\n  let upstreamOff: Unsubscriber | undefined;\n  let downstreamOff: Unsubscriber | undefined;\n\n  if (signal) {\n    signal.addEventListener(`abort`, () => {\n      done(`Abort signal ${ signal.reason }`);\n    }, { once: true });\n  }\n\n  const events = initStream<TTarget>({\n    onFirstSubscribe() {\n      if (lazy !== `never` && upstreamOff === undefined) start();\n    },\n    onNoSubscribers() {\n      // Unsubscribe from source if we're very lazy\n      // Stay subscribed if we're only initially lazy or not lazy at all\n      if (lazy === `very` && upstreamOff !== undefined) {\n        upstreamOff();\n        upstreamOff = undefined;\n      }\n    },\n  })\n\n  const start = () => {\n    //console.log(`Rx.valueToPing  start`);\n\n    upstreamOff = sourceRx.on(message => {\n      if (messageIsDoneSignal(message)) {\n        done(`Upstream closed`);\n      } else if (messageIsSignal(message)) {\n        events.signal(message.signal);\n      } else if (messageHasValue(message)) {\n        //console.log(`Rx.valueToPing got value: ${ message.value }`);\n        if (gate(message.value)) {\n          target.ping();\n        }\n      }\n    });\n    downstreamOff = target.on(message => {\n      if (messageIsDoneSignal(message)) {\n        done(`Downstream closed`);\n      } else if (messageIsSignal(message)) {\n        events.signal(message.signal, message.context);\n      } else if (messageHasValue(message)) {\n        events.set(message.value);\n      }\n    });\n  }\n\n  const done = (reason: string) => {\n    events.dispose(reason);\n    if (upstreamOff) upstreamOff();\n    if (downstreamOff) downstreamOff();\n  }\n\n  if (lazy === `never`) start();\n  return events;\n}","import { initUpstream } from \"../InitStream.js\";\nimport type { ReactiveOrSource, WithValueOptions, ReactiveInitial } from \"../Types.js\";\nimport { toReadable } from \"../ToReadable.js\";\n\n/**\n * A reactive where the last value can be read at any time.\n * An initial value must be provided.\n * ```js\n * const r = Rx.withValue(source, { initial: `hello` });\n * r.last(); // Read last value\n * ```\n * @param input \n * @param options \n * @returns \n */\nexport function withValue<In>(input: ReactiveOrSource<In>, options: WithValueOptions<In>): ReactiveInitial<In> {\n  let lastValue: In | undefined = options.initial;\n  const upstream = initUpstream<In, In>(input, {\n    ...options,\n    onValue(value) {\n      lastValue = value;\n      upstream.set(value);\n    },\n  })\n\n  const readable = toReadable(upstream);\n  return {\n    ...readable,\n    // @ts-expect-error\n    last() {\n      return lastValue;\n    },\n  }\n}","/* eslint-disable @typescript-eslint/no-non-null-assertion */\nimport { StackMutable } from \"../stack/StackMutable.js\"\nimport { QueueMutable } from \"../queue/QueueMutable.js\"\nimport { PriorityMutable } from \"../../collections/queue/PriorityMutable.js\"\nimport { immutable as immutableMap, type IMapImmutable } from \"../../collections/map/Map.js\"\nimport { NumberMap } from \"../../collections/map/NumberMap.js\"\nimport * as Sync from \"../../iterables/IterableSync.js\"\nimport { Table } from \"../Table.js\"\nimport { throwStringTest } from \"../../util/GuardString.js\"\n\nexport type DistanceCompute = (graph: DirectedGraph, edge: Edge) => number;\n\n/**\n * Vertex. These are the _nodes_ of the graph. Immutable.\n * \n * They keep track of all of their outgoing edges, and\n * a unique id.\n * \n * Ids are used for accessing/updating vertices as well as in the\n * {@link Edge} type. They must be unique.\n */\nexport type Vertex = Readonly<{\n  out: ReadonlyArray<Edge>\n  id: string\n}>\n\n/**\n * Edge. Immutable.\n * \n * Only encodes the destination vertex. The from\n * is known since edges are stored on the from vertex.\n */\nexport type Edge = Readonly<{\n  /**\n   * Vertex id edge connects to (ie. destination)\n   */\n  id: string,\n  /**\n   * Optional weight of edge\n   */\n  weight?: number\n}>\n\n/**\n * Create a vertex with given id\n * @param id \n * @returns \n */\nexport const createVertex = (id: string): Vertex => {\n  return {\n    id,\n    out: []\n  }\n}\n\n/**\n * Options for connecting vertices\n */\nexport type ConnectOptions = Readonly<{\n  /**\n   * From, or source of connection\n   */\n  from: string\n  /**\n   * To, or destination of connection. Can be multiple vertices for quick use\n   */\n  to: string | Array<string>\n  /**\n   * If true, edges in opposite direction are made as well\n   */\n  bidi?: boolean\n  /**\n   * Weight for this connection (optional)\n   */\n  weight?: number\n}>\n\n/**\n * Directed graph. Immutable.\n * \n * Consists of {@link Vertex|vertices}, which all have zero or more outgoing {@link Edge|Edges}.\n */\nexport type DirectedGraph = Readonly<{\n  vertices: IMapImmutable<string, Vertex>\n}>\n\n/**\n * Returns _true_ if graph contains `key`.\n * \n * ```js\n * // Same as\n * g.vertices.has(key)\n * ```\n * @param graph\n * @param key \n * @returns \n */\nexport function hasKey(graph: DirectedGraph, key: string): boolean {\n  throwGraphTest(graph);\n  return graph.vertices.has(key);\n}\n\n/**\n * Returns {@link Vertex} under `key`, or _undefined_\n * if not found.\n * \n * ```js\n * // Same as\n * g.vertices.get(key)\n * ```\n * @param graph \n * @param key \n * @returns \n */\nexport function get(graph: DirectedGraph, key: string): Vertex | undefined {\n  throwGraphTest(graph);\n  throwStringTest(key, `non-empty`, `key`);\n  return graph.vertices.get(key);\n\n}\n\n// export function fromAdjacenyMatrix(m: Array<Array<boolean>>): DirectedGraph {\n//   let g = graph();\n//   for (const row of m) {\n//     connect(g, { from, to })\n//   }\n//   return g;\n// }\n\n/**\n * Returns the graph connections as an adjacency matrix\n * @param graph \n * @returns \n */\nexport function toAdjacencyMatrix(graph: DirectedGraph): Table<boolean> {\n  throwGraphTest(graph);\n\n  const v = [ ...graph.vertices.values() ];\n  //const m: Array<Array<boolean>> = [];\n  const table = new Table<boolean>();\n  table.labelColumns(...v.map(vv => vv.id));\n  table.labelRows(...v.map(vv => vv.id));\n\n  // const row: Array<boolean> = [];\n  // for (let index = 0; index < v.length; index++) {\n  //   row[ index ] = false;\n  // }\n\n  // eslint-disable-next-line @typescript-eslint/prefer-for-of, unicorn/prevent-abbreviations\n  for (let i = 0; i < v.length; i++) {\n    //m[ i ] = [ ...row ];\n    table.setRow(i, v.length, false);\n    const ii = v[ i ];\n    // eslint-disable-next-line unicorn/prevent-abbreviations\n    for (const [ j, jj ] of v.entries()) {\n      if (ii.out.some(o => o.id === jj.id)) {\n        //m[ i ][ j ] = true;\n        table.set(i, j, true);\n      }\n    }\n  }\n  return table;\n}\n\n/**\n * Return a string representation of the graph for debug inspection\n * @param graph \n * @returns \n */\nexport const dumpGraph = (graph: DirectedGraph | Iterable<Vertex>): string => {\n  const lines = debugGraphToArray(graph);\n  return lines.join(`\\n`);\n}\n\n/**\n * Return an array of a debug-print of every vertex.\n * @param graph \n * @returns \n */\nconst debugGraphToArray = (graph: DirectedGraph | Iterable<Vertex>): Array<string> => {\n\n  const r: Array<string> = [];\n  const vertices = (`vertices` in graph) ? graph.vertices.values() : graph;\n\n  for (const v of vertices) {\n    // eslint-disable-next-line unicorn/prevent-abbreviations\n    const str = debugDumpVertex(v);\n    r.push(...str.map(line => ` ${ line }`));\n  }\n  return r;\n}\n\n\nexport const distance = (graph: DirectedGraph, edge: Edge): number => {\n  if (edge.weight !== undefined) return edge.weight;\n  return 1;\n}\n\n/**\n * Iterate over all the edges in the graph\n * @param graph \n */\nexport function* edges(graph: DirectedGraph) {\n  throwGraphTest(graph);\n\n  const vertices = [ ...graph.vertices.values() ];\n  for (const vertex of vertices) {\n    for (const edge of vertex.out) {\n      yield edge;\n    }\n  }\n}\n\n/**\n * Iterate over all the vertices of the graph\n * @param graph \n */\nexport function* vertices(graph: DirectedGraph) {\n  throwGraphTest(graph);\n\n  const vertices = [ ...graph.vertices.values() ];\n  for (const vertex of vertices) {\n    yield vertex;\n  }\n}\n\nfunction testGraph(g: DirectedGraph, paramName = `graph`) {\n  if (g === undefined) return [ false, `Param '${ paramName }' is undefined. Expected Graph` ];\n  if (g === null) return [ false, `Param '${ paramName }' is null. Expected Graph` ];\n  if (typeof g === `object`) {\n    if (!(`vertices` in g)) return [ false, `Param '${ paramName }.vertices' does not exist. Is it a Graph type?` ]\n  } else {\n    return [ false, `Param '${ paramName } is type '${ typeof g }'. Expected an object Graph` ];\n  }\n  return [ true ];\n}\n\nfunction throwGraphTest(g: DirectedGraph, paramName = `graph`) {\n  const r = testGraph(g, paramName);\n  if (r[ 0 ]) return;\n  throw new Error(r[ 1 ] as string)\n}\n/**\n * Iterate over all the vertices connected to `context` vertex\n * @param graph Graph\n * @param context id or Vertex.\n * @returns \n */\nexport function* adjacentVertices(graph: DirectedGraph, context: Vertex | string | undefined) {\n  throwGraphTest(graph);\n  if (context === undefined) return;\n  const vertex = typeof context === `string` ? graph.vertices.get(context) : context;\n  if (vertex === undefined) throw new Error(`Vertex not found ${ JSON.stringify(context) }`);\n\n  for (const edge of vertex.out) {\n    const edgeV = graph.vertices.get(edge.id);\n    if (edgeV === undefined) throw new Error(`Could not find vertex: ${ edge.id }`);\n    yield edgeV;\n  }\n}\n\n/**\n * Returns _true_ if `vertex` has an outgoing connection to\n * the supplied id or vertex.\n * \n * If `vertex` is undefined, _false_ is returned.\n * @param vertex From vertex\n * @param outIdOrVertex To vertex\n * @returns \n */\nexport const vertexHasOut = (vertex: Vertex, outIdOrVertex: string | Vertex): boolean => {\n  if (vertex === undefined) return false;\n  const outId = typeof outIdOrVertex === `string` ? outIdOrVertex : outIdOrVertex.id;\n  return vertex.out.some(edge => edge.id === outId);\n}\n\n/**\n * Returns _true_ if `vertex` has no outgoing connections\n * @param graph \n * @param vertex \n * @returns \n */\nexport const hasNoOuts = (graph: DirectedGraph, vertex: string | Vertex): boolean => {\n  throwGraphTest(graph);\n\n  const context = typeof vertex === `string` ? graph.vertices.get(vertex) : vertex;\n  if (context === undefined) return false;\n  return context.out.length === 0;\n}\n\n/**\n * Returns _true_ if `vertex` only has the given list of vertices.\n * Returns _false_ early if the length of the list does not match up with `vertex.out`\n * @param graph \n * @param vertex \n * @param outIdOrVertex \n * @returns \n */\nexport const hasOnlyOuts = (graph: DirectedGraph, vertex: string | Vertex, ...outIdOrVertex: Array<string | Vertex>): boolean => {\n  throwGraphTest(graph);\n\n  const context = resolveVertex(graph, vertex);\n  const outs = outIdOrVertex.map(o => resolveVertex(graph, o));\n\n  if (outs.length !== context.out.length) {\n    //console.log(`length mismatch. context: ${ JSON.stringify(context.out) } out ${ JSON.stringify(outIdOrVertex) }`);\n    return false;\n  }\n  for (const out of outs) {\n    //console.log(`Testing ${ context.id } -> ${ out.id }`);\n    if (!hasOut(graph, context, out)) {\n      //console.log(`  no`);\n      return false;\n    }\n  }\n  return true;\n}\n\n/**\n * Returns _true_ if `vertex` has an outgoing connection to the given vertex.\n * @param graph \n * @param vertex \n * @param outIdOrVertex \n * @returns \n */\nexport const hasOut = (graph: DirectedGraph, vertex: string | Vertex, outIdOrVertex: string | Vertex): boolean => {\n  throwGraphTest(graph);\n\n  const context = resolveVertex(graph, vertex);\n  const outId = typeof outIdOrVertex === `string` ? outIdOrVertex : outIdOrVertex.id;\n  return context.out.some(edge => edge.id === outId);\n}\n\n// export const hasIn = (graph: Graph, contextIdOrVertex: string | Vertex, id: string): boolean => {\n//   const context = typeof contextIdOrVertex === `string` ? graph.vertices.get(contextIdOrVertex) : contextIdOrVertex;\n\n//   if (context === undefined) return false;\n//   if (context.in === undefined) return false;\n//   return context.in.some(edge => edge.id === id);\n// }\n\n/**\n * Gets a vertex by id, creating it if it does not exist.\n * @param graph \n * @param id \n * @returns \n */\nexport const getOrCreate = (graph: DirectedGraph, id: string): Readonly<{ graph: DirectedGraph, vertex: Vertex }> => {\n  throwGraphTest(graph);\n\n  const v = graph.vertices.get(id);\n  if (v !== undefined) return { graph, vertex: v };\n\n  const vv = createVertex(id);\n  const gg = updateGraphVertex(graph, vv);\n  return { graph: gg, vertex: vv };\n}\n\n/**\n * Gets a vertex by id, throwing an error if it does not exist\n * @param graph \n * @param id \n * @returns \n */\nexport const getOrFail = (graph: DirectedGraph, id: string): Vertex => {\n  throwGraphTest(graph);\n\n  const v = graph.vertices.get(id);\n  if (v === undefined) throw new Error(`Vertex '${ id }' not found in graph`);\n  return v;\n}\n\n/**\n * Updates a vertex by returning a mutated graph\n * @param graph Graph\n * @param vertex Newly changed vertex\n * @returns \n */\nexport const updateGraphVertex = (graph: DirectedGraph, vertex: Vertex): DirectedGraph => {\n  throwGraphTest(graph);\n\n  const gr = {\n    ...graph,\n    vertices: graph.vertices.set(vertex.id, vertex)\n  }\n  return gr;\n}\n\n/**\n * Default distance computer. Uses `weight` property of edge, or `1` if not found.\n * @param graph \n * @param edge \n * @returns \n */\nexport const distanceDefault = (graph: DirectedGraph, edge: Edge): number => {\n  if (edge.weight !== undefined) return edge.weight;\n  return 1;\n}\n\n/**\n * Returns a mutation of `graph`, with a given edge removed.\n * \n * If edge was not there, original graph is returned.\n * @param graph \n * @param from \n * @param to \n * @returns \n */\nexport function disconnect(graph: DirectedGraph, from: string | Vertex, to: string | Vertex): DirectedGraph {\n  throwGraphTest(graph);\n\n  const fromV = resolveVertex(graph, from);\n  const toV = resolveVertex(graph, to);\n\n  return hasOut(graph, fromV, toV) ? updateGraphVertex(graph, {\n    ...fromV,\n    out: fromV.out.filter(t => t.id !== toV.id)\n  }) : graph;\n}\n\n/**\n * Make a connection between two vertices with a given weight.\n * It returns the new graph as wll as the created edge.\n * @param graph \n * @param from \n * @param to \n * @param weight \n * @returns \n */\nexport function connectTo(graph: DirectedGraph, from: string, to: string, weight?: number): { graph: DirectedGraph, edge: Edge } {\n  throwGraphTest(graph);\n\n  const fromResult = getOrCreate(graph, from);\n  graph = fromResult.graph;\n  const toResult = getOrCreate(graph, to);\n  graph = toResult.graph;\n\n  const edge: Edge = {\n    id: to,\n    weight\n  }\n\n  if (!hasOut(graph, fromResult.vertex, toResult.vertex)) {\n    graph = updateGraphVertex(graph, {\n      ...fromResult.vertex,\n      // Add new edge to list of edges for this node\n      out: [ ...fromResult.vertex.out, edge ]\n    });\n  }\n  return { graph, edge }\n}\n\n/**\n * Connect from -> to. Same as {@link connectWithEdges}, but this version just returns the graph.\n * \n * By default unidirectional, meaning a connection is made only from->to. Use `bidi` option to set a bidirection connection, adding also to->from.\n * \n * Returns a result of `{ graph, edges }`, where `graph` is the new {@link DirectedGraph} and `edges`\n * is an array of {@link Edge Edges}. One for unidirectional, or two for bidirectional.\n * @param graph \n * @param options \n * @returns \n */\nexport function connect(graph: DirectedGraph, options: ConnectOptions): DirectedGraph {\n  const result = connectWithEdges(graph, options);\n  return result.graph;\n}\n\n/**\n * Connect from -> to. Same as {@link connect} except you get back the edges as well. \n * \n * By default unidirectional, meaning a connection is made only from->to. Use `bidi` option to set a bidirection connection, adding also to->from.\n * \n * Returns a result of `{ graph, edges }`, where `graph` is the new {@link DirectedGraph} and `edges`\n * is an array of {@link Edge Edges}. One for unidirectional, or two for bidirectional.\n * @param graph \n * @param options \n * @returns \n */\nexport function connectWithEdges(graph: DirectedGraph, options: ConnectOptions): { graph: DirectedGraph, edges: Edge[] } {\n  throwGraphTest(graph);\n\n  const { to, weight, from } = options;\n  const bidi = options.bidi ?? false;\n  const toList = Array.isArray(to) ? to : [ to ];\n\n  let edges: Edge[] = []\n  // Connect from -> to\n  for (const toSingle of toList) {\n    const result = connectTo(graph, from, toSingle, weight);\n    graph = result.graph;\n    edges.push(result.edge);\n  }\n\n  if (!bidi) return { graph, edges };\n\n  // Bidirectional connection\n  // Connect to -> from\n  for (const toSingle of toList) {\n    const result = connectTo(graph, toSingle, from, weight);\n    graph = result.graph;\n    edges.push(result.edge);\n  }\n  return { graph, edges };\n}\n\n/**\n * Returns an array of debug-representations for the given vertex.\n * @param v \n * @returns \n */\nconst debugDumpVertex = (v: Vertex): Array<string> => {\n  const r = [\n    v.id\n  ]\n  const stringForEdge = (edge: Edge) => edge.weight === undefined ? edge.id : `${ edge.id } (${ edge.weight })`\n\n  // for (const edge of v.in) {\n  //   r.push(` <- ${ stringForEdge(edge) }`);\n  // }\n  for (const edge of v.out) {\n    r.push(` -> ${ stringForEdge(edge) }`);\n  }\n  if (v.out.length === 0) r[ 0 ] += ` (terminal)`;\n\n  return r;\n}\n\n/**\n * Returns _true_ if a->b or b->a\n * @param graph \n * @param a \n * @param b \n * @returns \n */\nexport function areAdjacent(graph: DirectedGraph, a: Vertex, b: Vertex) {\n  throwGraphTest(graph);\n\n  if (hasOut(graph, a, b.id)) return true;\n  if (hasOut(graph, b, a.id)) return true;\n}\n\n/**\n * Resolves the id or vertex into a Vertex.\n * throws an error if vertex is not found\n * @param graph \n * @param idOrVertex \n * @returns \n */\nfunction resolveVertex(graph: DirectedGraph, idOrVertex: string | Vertex): Vertex {\n  throwGraphTest(graph);\n\n  if (idOrVertex === undefined) throw new Error(`Param 'idOrVertex' is undefined. Expected string or Vertex`);\n\n  const v = typeof idOrVertex === `string` ? graph.vertices.get(idOrVertex) : idOrVertex;\n  if (v === undefined) throw new Error(`Id not found ${ idOrVertex as string }`);\n  return v;\n}\n\n/**\n * Iterates over vertices from a starting vertex in an bread-first-search\n * @param graph \n * @param startIdOrVertex \n * @param targetIdOrVertex \n * @returns \n */\nexport function* bfs(graph: DirectedGraph, startIdOrVertex: string | Vertex, targetIdOrVertex?: string | Vertex) {\n  throwGraphTest(graph);\n\n  const start = resolveVertex(graph, startIdOrVertex);\n  const target = targetIdOrVertex === undefined ? undefined : resolveVertex(graph, targetIdOrVertex);\n\n  const queue = new QueueMutable<Vertex>();\n  const seen = new Set<string>();\n  queue.enqueue(start);\n  while (!queue.isEmpty) {\n    const v = queue.dequeue()!;\n    yield v;\n    if (target !== undefined && target === v) return;\n    for (const edge of adjacentVertices(graph, v)) {\n      if (!seen.has(edge.id)) {\n        seen.add(edge.id);\n        queue.enqueue(resolveVertex(graph, edge.id));\n      }\n    }\n  }\n}\n\n/**\n * Iterates over vertices from a starting vertex in an depth-first-search\n * @param graph \n * @param startIdOrVertex \n */\nexport function* dfs(graph: DirectedGraph, startIdOrVertex: string | Vertex) {\n  throwGraphTest(graph);\n\n  const source = resolveVertex(graph, startIdOrVertex);\n\n  const s = new StackMutable<Vertex>();\n  const seen = new Set<string>();\n  s.push(source);\n  while (!s.isEmpty) {\n    const v = s.pop();\n    if (v === undefined) continue;\n    if (!seen.has(v.id)) {\n      seen.add(v.id);\n      yield v;\n      for (const edge of v.out) {\n        const destination = graph.vertices.get(edge.id);\n        if (destination) {\n          s.push(destination);\n        }\n      }\n    }\n  }\n}\n\n/**\n * Compute shortest distance from the source vertex to the rest of the graph.\n * @param graph \n * @param sourceOrId \n * @returns \n */\nexport const pathDijkstra = (graph: DirectedGraph, sourceOrId: Vertex | string) => {\n  throwGraphTest(graph);\n\n  const source = typeof sourceOrId === `string` ? graph.vertices.get(sourceOrId) : sourceOrId;\n  if (source === undefined) throw new Error(`source vertex not found`);\n\n  const distances = new Map<string, number>();\n  const previous = new Map<string, Vertex | null>();\n\n  distances.set(source.id, 0);\n\n  const pq = new PriorityMutable<string>();\n\n  const vertices = [ ...graph.vertices.values() ];\n  for (const v of vertices) {\n    if (v.id !== source.id) {\n      distances.set(v.id, Number.MAX_SAFE_INTEGER);\n      // eslint-disable-next-line unicorn/no-null\n      previous.set(v.id, null);\n    }\n    pq.enqueueWithPriority(v.id, Number.MAX_SAFE_INTEGER);\n  }\n\n  while (!pq.isEmpty) {\n    const u = pq.dequeueMin();\n    if (u === undefined) throw new Error(`Bug. Queue unexpectedly empty`);\n    const vertexU = graph.vertices.get(u)!;\n    for (const neighbour of vertexU.out) {\n      //const vertexNeigbour = graph.vertices.get(neighbour.to)!;\n      const alt = distances.get(u)! + distance(graph, neighbour);\n      if (alt < distances.get(neighbour.id)!) {\n        distances.set(neighbour.id, alt);\n        previous.set(neighbour.id, vertexU);\n        pq.changePriority(neighbour.id, alt, true);\n      }\n    }\n  }\n\n  const pathTo = (id: string): Array<Edge> => {\n    const path: Array<Edge> = [];\n    while (true) {\n      if (id === source.id) break;\n      const v = previous.get(id);\n      if (v === undefined || v === null) throw new Error(`Id not present: ${ id }`);\n      path.push({ id, weight: distances.get(id) });\n      id = v.id;\n    }\n    return path;\n  }\n  return {\n    distances, previous, pathTo\n  }\n}\n\n/**\n * Clones the graph. Uses shallow clone, because it's all immutable\n * @param graph \n * @returns \n */\nexport const clone = (graph: DirectedGraph): DirectedGraph => {\n  throwGraphTest(graph);\n\n  const g: DirectedGraph = {\n    vertices: immutableMap<string, Vertex>([ ...graph.vertices.entries() ])\n  }\n  return g;\n}\n\n/**\n * Create a graph\n * ```js\n * let g = graph();\n * ```\n * \n * Can optionally provide initial connections:\n * ```js\n * let g = graph(\n *  { from: `a`, to: `b` },\n *  { from: `b`, to: `c` }\n * )\n * ```\n * @param initialConnections \n * @returns \n */\nexport const graph = (...initialConnections: Array<ConnectOptions>): DirectedGraph => {\n  let g: DirectedGraph = {\n    vertices: immutableMap()\n  }\n  for (const ic of initialConnections) {\n    g = connect(g, ic);\n  }\n  return g;\n}\n\n/**\n * Internal type for Tarjan algorithm\n */\ntype TarjanVertex = Vertex & {\n  lowlink: number\n  index: number\n  onStack: boolean\n}\n\n/**\n * Returns _true_ if the graph contains is acyclic - that is, it has no loops\n * @param graph \n */\nexport function isAcyclic(graph: DirectedGraph): boolean {\n  throwGraphTest(graph);\n\n  const cycles = getCycles(graph);\n  return cycles.length === 0;\n}\n\n/**\n * Topological sort using Kahn's algorithm.\n * Returns a new graph that is sorted\n * @param graph \n */\nexport function topologicalSort(graph: DirectedGraph): DirectedGraph {\n  throwGraphTest(graph);\n\n  const indegrees = new NumberMap(0);\n\n  // Increment indegrees for each edge leading to a vertex\n  for (const edge of edges(graph)) {\n    indegrees.add(edge.id, 1);\n  }\n\n  // Enqueue all vertices with an indegree of 0\n  const queue = new QueueMutable<Vertex>();\n  let vertexCount = 0;\n  for (const vertex of vertices(graph)) {\n    if (indegrees.get(vertex.id) === 0) {\n      queue.enqueue(vertex);\n    }\n    vertexCount++;\n  }\n\n  const topOrder: Array<Vertex> = [];\n  while (!queue.isEmpty) {\n    // Add to topological order\n    const u = queue.dequeue()!;\n    topOrder.push(u);\n\n    // Iterate through neighbours\n    for (const neighbour of u.out) {\n      const result = indegrees.subtract(neighbour.id, 1);\n      if (result === 0) {\n        queue.enqueue(graph.vertices.get(neighbour.id)!);\n      }\n    }\n  }\n\n  if (topOrder.length !== vertexCount) {\n    throw new Error(`Graph contains cycles`);\n  }\n  return graphFromVertices(topOrder);\n}\n\n/**\n * Create a graph from an iterable of vertices\n * @param vertices \n * @returns \n */\nexport function graphFromVertices(vertices: Iterable<Vertex>): DirectedGraph {\n  // eslint-disable-next-line unicorn/no-array-callback-reference, unicorn/no-array-method-this-argument\n  const keyValues = Sync.map(vertices, f => {\n    return [ f.id, f ] as [ string, Vertex ]\n  });\n  const m = immutableMap<string, Vertex>([ ...keyValues ]);\n  return {\n    vertices: m\n  }\n}\n\n/**\n * Get all the cycles ('strongly-connected-components') within the graph\n * [Read more](https://en.wikipedia.org/wiki/Strongly_connected_component)\n * @param graph \n * @returns \n */\nexport function getCycles(graph: DirectedGraph): Array<Array<Vertex>> {\n  throwGraphTest(graph);\n\n  let index = 0;\n  const stack = new StackMutable<TarjanVertex>();\n  const vertices = new Map<string, TarjanVertex>();\n  const scc: Array<Array<Vertex>> = [];\n\n  for (const v of graph.vertices.values()) {\n    vertices.set(v.id, {\n      ...v,\n      lowlink: Number.NaN,\n      index: Number.NaN,\n      onStack: false\n    });\n  }\n\n  const strongConnect = (vertex: TarjanVertex) => {\n    vertex.index = index;\n    vertex.lowlink = index;\n    index++;\n    stack.push(vertex);\n    vertex.onStack = true;\n\n    for (const edge of vertex.out) {\n      const edgeV = vertices.get(edge.id)!;\n      if (Number.isNaN(edgeV.index)) {\n        strongConnect(edgeV);\n        vertex.lowlink = Math.min(vertex.lowlink, edgeV.lowlink);\n      } else if (edgeV.onStack) {\n        vertex.lowlink = Math.min(vertex.lowlink, edgeV.lowlink);\n      }\n    }\n\n    if (vertex.lowlink === vertex.index) {\n      const stronglyConnected: Array<Vertex> = [];\n      let w: TarjanVertex | undefined;\n      while (vertex !== w) {\n        w = stack.pop()!;\n        w.onStack = false;\n        stronglyConnected.push({ id: w.id, out: w.out });\n\n      }\n      if (stronglyConnected.length > 1)\n        scc.push(stronglyConnected);\n    }\n  }\n\n  for (const v of vertices.values()) {\n    if (Number.isNaN(v.index)) {\n      strongConnect(v);\n    }\n  }\n  return scc;\n}\n\n/**\n * Returns a new graph which is transitively reduced.\n * That is, redundant edges are removed\n * @param graph \n * @returns \n */\nexport function transitiveReduction(graph: DirectedGraph) {\n  throwGraphTest(graph);\n\n  for (const u of vertices(graph)) {\n    for (const v of adjacentVertices(graph, u)) {\n      for (const v1 of dfs(graph, v)) {\n        if (v.id === v1.id) continue;\n        if (hasOut(graph, u, v1)) {\n          const g = disconnect(graph, u, v1);\n          return transitiveReduction(g);\n        }\n      }\n    }\n  }\n  return graph;\n}","import { throwNumberTest } from \"../../util/GuardNumbers.js\";\nimport { isEqualDefault, type IsEqual } from \"../../util/IsEqual.js\";\nimport { maxScore as IterablesMax, min as IterablesMin } from \"../../iterables/CompareValues.js\";\nimport type { IPriorityQueueMutable, PriorityItem } from \"./IPriorityQueueMutable.js\";\nimport { QueueMutable } from \"./QueueMutable.js\";\nimport type { QueueOpts } from \"./QueueTypes.js\";\n\n/**\n * Simple priority queue implementation.\n * Higher numbers mean higher priority.\n * \n * ```js\n * const pm = new PriorityMutable();\n * \n * // Add items with a priority (higher numeric value = higher value)\n * pm.enqueueWithPriority(`hello`, 4);\n * pm.enqueueWithPriotity(`there`, 1);\n * \n * ```\n */\nexport class PriorityMutable<V> extends QueueMutable<PriorityItem<V>> implements IPriorityQueueMutable<V> {\n  constructor(opts: QueueOpts<PriorityItem<V>> = {}) {\n    if (opts.eq === undefined) {\n      opts = {\n        ...opts,\n        eq: (a, b) => {\n          return isEqualDefault(a.item, b.item);\n        }\n      }\n    }\n    super(opts);\n  }\n\n  /**\n   * Adds an item with a given priority\n   * @param item Item\n   * @param priority Priority (higher numeric value means higher priority)\n   */\n  enqueueWithPriority(item: V, priority: number) {\n    throwNumberTest(priority, `positive`)\n    super.enqueue({ item, priority });\n  }\n\n  changePriority(item: V, priority: number, addIfMissing = false, eq?: IsEqual<V>) {\n    if (item === undefined) throw new Error(`Item cannot be undefined`);\n    let toDelete: PriorityItem<V> | undefined;\n    for (const d of this.data) {\n      if (eq) {\n        if (eq(d.item, item)) {\n          toDelete = d;\n          break;\n        }\n      } else {\n        if (this.eq(d, { item, priority: 0 })) {\n          toDelete = d;\n          break;\n        }\n      }\n    }\n    if (toDelete === undefined && !addIfMissing) throw new Error(`Item not found in priority queue. Item: ${ JSON.stringify(item) }`);\n    if (toDelete !== undefined) {\n      this.removeWhere(item => toDelete === item)\n    }\n    this.enqueueWithPriority(item, priority);\n  }\n\n  dequeueMax(): V | undefined {\n    const m = IterablesMax(this.data, v => v.priority);\n    if (m === undefined) return;\n    this.removeWhere(item => item === m);\n    return m.item;\n  }\n\n  dequeueMin(): V | undefined {\n    const m = IterablesMin(this.data, v => v.priority);\n    if (m === undefined) return;\n    this.removeWhere(item => item === m);\n    return m.item;\n  }\n\n  peekMax(): V | undefined {\n    const m = IterablesMax(this.data, v => v.priority);\n    if (m === undefined) return;\n    return m.item;\n  }\n\n  peekMin(): V | undefined {\n    const m = IterablesMin(this.data, v => v.priority);\n    if (m === undefined) return;\n    return m.item;\n  }\n}\n\n/**\n * Creates a {@link PriorityMutable} queue.\n * \n * Options:\n * * eq: Equality function\n * * capacity: limit on number of items\n * * discardPolicy: what to do if capacity is reached\n * @param opts \n * @returns \n */\nexport function priority<V>(\n  opts: QueueOpts<PriorityItem<V>> = {}\n): IPriorityQueueMutable<V> {\n  return new PriorityMutable(opts);\n}","\nexport class Table<V> {\n  rows: Array<Array<V | undefined>> = [];\n  rowLabels: Array<string> = [];\n  colLabels: Array<string> = [];\n\n  labelColumns(...labels: Array<string>) {\n    this.colLabels = labels;\n  }\n\n  labelColumn(columnNumber: number, label: string) {\n    this.colLabels[ columnNumber ] = label;\n  }\n\n  getColumnLabelIndex(label: string): number | undefined {\n    for (const [ index, l ] of this.colLabels.entries()) {\n      if (l === label) return index;\n    }\n  }\n\n  print() {\n    console.table([ ...this.rowsWithLabelsObject() ]);\n  }\n\n  *rowsWithLabelsArray() {\n    for (let index = 0; index < this.rows.length; index++) {\n      const labelledRow = this.getRowWithLabelsArray(index);\n      yield labelledRow;\n    }\n  }\n\n  /**\n   * Return a copy of table as nested array\n   * ```js\n   * const t = new Table();\n   * // add stuff\n   * // ...\n   * const m = t.asArray();\n   * for (const row of m) {\n   *  for (const colValue of row) {\n   *    // iterate over all column values for this row\n   *  }\n   * }\n   * ```\n   * \n   * Alternative: get value at row Y and column X\n   * ```js\n   * const value = m[y][x];\n   * ```\n   * @returns \n   */\n  asArray(): Array<Array<V | undefined>> {\n    const r: Array<Array<V | undefined>> = [];\n    for (const row of this.rows) {\n      if (row === undefined) r.push([]);\n      else r.push([ ...row ]);\n    }\n    return r;\n  }\n\n  /**\n   * Return the number of rows\n   */\n  get rowCount() {\n    return this.rows.length;\n  }\n\n  /**\n   * Return the maximum number of columns in any row\n   */\n  get columnCount() {\n    const lengths = this.rows.map(row => row.length);\n    return Math.max(...lengths);\n  }\n\n  *rowsWithLabelsObject() {\n    for (let index = 0; index < this.rows.length; index++) {\n      const labelledRow = this.getRowWithLabelsObject(index);\n      yield labelledRow;\n    }\n  }\n\n  labelRows(...labels: Array<string>) {\n    this.rowLabels = labels;\n  }\n\n  appendRow(...data: Array<V | undefined>) {\n    this.rows.push(data);\n  }\n\n  getRowWithLabelsArray(rowNumber: number): Array<[ label: string | undefined, value: V | undefined ]> | undefined {\n    const row = this.rows.at(rowNumber);\n    if (row === undefined) return undefined;\n    return row.map((value, index) => [ this.colLabels.at(index), value ]);\n  }\n\n  /**\n   * Return a row of objects. Keys use the column labels.\n   * \n   * ```js\n   * const row = table.getRowWithLabelsObject(10);\n   * // eg:\n   * // [{ colour: red, size: 10}, { colour: blue, size: 20 }]\n   * ```\n   * @param rowNumber \n   * @returns \n   */\n  getRowWithLabelsObject(rowNumber: number): object | undefined {\n    const row = this.rows.at(rowNumber);\n    if (row === undefined) return undefined;\n    const object = {};\n    for (let index = 0; index < this.colLabels.length; index++) {\n      const label = this.colLabels.at(index) ?? index.toString();\n      // @ts-expect-error\n      object[ label ] = row[ index ];\n    }\n    return object;\n  }\n\n  /**\n   * Gets or creates a row at `rowNumber`.\n   * @param rowNumber \n   * @returns \n   */\n  private getOrCreateRow(rowNumber: number): Array<V | undefined> {\n    let row = this.rows.at(rowNumber);\n    if (row === undefined) {\n      row = [];\n      this.rows[ rowNumber ] = row;\n    }\n    return row;\n  }\n\n  /**\n   * Gets the values at `rowNumber`\n   * @param rowNumber \n   * @returns \n   */\n  row(rowNumber: number): Array<V | undefined> | undefined {\n    return this.rows.at(rowNumber);\n  }\n\n  /**\n   * Set the value of row,column to `value`\n   * @param rowNumber \n   * @param columnNumber \n   * @param value \n   */\n  set(rowNumber: number, columnNumber: number, value: V | undefined) {\n    const row = this.getOrCreateRow(rowNumber);\n    row[ columnNumber ] = value;\n  }\n\n  get(rowNumber: number, column: number | string) {\n    const row = this.getOrCreateRow(rowNumber);\n    const index = typeof column === `number` ? column : this.getColumnLabelIndex(column);\n    if (index === undefined) throw new Error(`Column not found: ${ column }`);\n    return row[ index ];\n  }\n\n  /**\n   * For a given row number, set all the columns to `value`.\n   * `cols` gives the number of columns to set\n   * @param rowNumber \n   * @param cols \n   * @param value \n   */\n  setRow(rowNumber: number, cols: number, value: V | undefined) {\n    const row = this.getOrCreateRow(rowNumber);\n    for (let columnNumber = 0; columnNumber < cols; columnNumber++) {\n      row[ columnNumber ] = value;\n    }\n  }\n}","import * as DiGraph from \"../collections/graphs/DirectedGraph.js\";\nimport { initStream } from \"./InitStream.js\";\nimport type { Reactive } from \"./Types.js\";\nimport { isReactive } from \"./Util.js\";\ntype RxNodeBase = {\n  type: `primitive` | `rx` | `object`\n}\n\ntype RxNodeRx = RxNodeBase & {\n  type: `rx`,\n  value: Reactive<any>\n}\n\ntype RxNodePrimitive = RxNodeBase & {\n  type: `primitive`,\n  value: any\n}\n\ntype RxNode = RxNodeRx | RxNodePrimitive;\n\n// function isReactive(o: object): o is Reactive<any> {\n//   if (typeof o !== `object`) return false;\n//   if (`on` in o) {\n//     return (typeof o.on === `function`);\n//   }\n//   return false;\n// }\n\n/**\n * Build a graph of reactive dependencies for `rx`\n * @param _rx \n */\nexport function prepare<V extends Record<string, any>>(_rx: V): Reactive<V> {\n  let g = DiGraph.graph();\n  const nodes = new Map<string, RxNode>();\n  const events = initStream<V>();\n\n  const process = (o: object, path: string) => {\n    for (const [ key, value ] of Object.entries(o)) {\n      const subPath = path + `.` + key;\n      g = DiGraph.connect(g, {\n        from: path,\n        to: subPath\n      });\n      if (isReactive(value)) {\n        nodes.set(subPath, { value, type: `rx` });\n        value.on(v => {\n          console.log(`Rx.prepare value: ${ JSON.stringify(v) } path: ${ subPath }`);\n        });\n      } else {\n        const valueType = typeof value;\n        // eslint-disable-next-line unicorn/prefer-switch\n        if (valueType === `bigint` || valueType === `boolean` || valueType === `number` || valueType === `string`) {\n          nodes.set(subPath, { type: `primitive`, value });\n        } else if (valueType === `object`) {\n          process(value, subPath)\n        } else if (valueType === `function`) {\n          console.log(`Rx.process - not handling functions`);\n        }\n      }\n    }\n  }\n\n  // const produce = () => {\n  //   Object.fromEntries(entries);\n  // }\n\n  // process(rx, `_root`);\n  // console.log(DiGraph.dumpGraph(g));\n\n  // console.log(`--- Map ---`);\n\n  // for (const entries of nodes.entries()) {\n  //   console.log(entries[ 0 ]);\n  //   console.log(entries[ 1 ]);\n  //   console.log(``)\n  // }\n\n\n  const returnValue = {\n    // eslint-disable-next-line @typescript-eslint/unbound-method\n    dispose: events.dispose,\n    // eslint-disable-next-line @typescript-eslint/unbound-method\n    isDisposed: events.isDisposed,\n    graph: g,\n    // eslint-disable-next-line @typescript-eslint/unbound-method\n    on: events.on,\n    // eslint-disable-next-line @typescript-eslint/unbound-method\n    onValue: events.onValue\n  }\n  return returnValue;\n}\n\n","import type { Primitive } from '../PrimitiveTypes.js';\nimport type { Interval } from '../flow/IntervalType.js';\nimport * as Immutable from '../data/Pathed.js';\nimport type { ChunkOptions, DebounceOptions, FieldOptions, FilterPredicate, SplitOptions, SyncOptions, SwitcherOptions, TransformOpts, ThrottleOptions, OpMathOptions } from './ops/Types.js';\nimport type { TimeoutPingOptions, TimeoutValueOptions } from './sources/Types.js';\nimport type { SetHtmlOptions } from './sinks/Dom.js';\nimport type { Processors } from '../data/Process.js';\nimport type { TallyOptions } from './ops/Math.js';\nimport type { ChangeRecord } from '../data/Compare.js';\nimport type { RecursivePartial } from 'src/TsUtil.js';\n\n\nexport type CombineLatestOptions = {\n  /**\n   * If _true_, disposes all the merged sources when the merged reactive closes.\n   * Default: _true_.\n   */\n  disposeSources: boolean\n  /**\n   * How to handle when a source ends.\n   * * 'allow': continue combined stream, last value for done stream will kept\n   * * 'break': stop combined stream\n   * \n   * Default: 'break'\n   */\n  onSourceDone: `allow` | `break`\n  /**\n   * If _true_ (default), emits a value when initialised.\n   */\n  emitInitial: boolean\n}\n\nexport type Optional<T, K extends keyof T> = Pick<Partial<T>, K> & Omit<T, K>;\n\nexport const symbol = Symbol(`Rx`);\n\nexport type SignalKinds = `done` | `warn`;\nexport type Passed<V> = {\n  value: V | undefined\n  signal?: SignalKinds\n  context?: string\n}\n\nexport type PassedSignal = Passed<any> & {\n  value: undefined\n  signal: SignalKinds\n  context: string\n}\n\nexport type PassedValue<V> = Passed<V> & {\n  value: V\n}\n\nexport type UpstreamOptions<In> = {\n  lazy: Lazy\n  /**\n   * If _true_ (default), we dispose the underlying stream if the upstream closes. This happens after onStop() is called.\n   */\n  disposeIfSourceDone: boolean\n  onValue: (v: In) => void\n  /**\n   * Called just before we subscribe to source\n   * @returns \n   */\n  onStart: () => void\n  /**\n   * Called after we unsubscribe from source\n   * @returns\n   */\n  onStop: () => void\n  debugLabel: string\n  onDispose: (reason: string) => void\n}\n\nexport type UpstreamInitialOptions<In> = UpstreamOptions<In> & {\n  initialValue: In\n}\n\n//export type Processor = <TIn, TOptions>(source: ReactiveOrSource<TIn>) => (options: TOptions) => () => void;\n\n/**\n * Wrapped Reactive for object-oriented access\n */\nexport type Wrapped<TIn> = {\n  enacts: {\n    setHtmlText: (options: SetHtmlOptions) => () => void\n  }\n  source: Reactive<TIn>,\n\n  /**\n   * Annotate values with output from the `annotation` function.\n   * Returned values will be in the form `{ value:TIn, annotation:TAnnotation }`\n   * @param transformer \n   * @returns \n   */\n  annotate: <TAnnotation>(transformer: (value: TIn) => TAnnotation) => Wrapped<{ value: TIn, annotation: TAnnotation }>\n  annotateWithOp: <TOut>(op: ReactiveOp<TIn, TOut>) => Wrapped<{ value: TIn, annotation: TOut }>\n  /**\n  * Accumulate a chunk of values, emitted as an array\n  * @param options \n  * @returns \n  */\n  chunk: (options: Partial<ChunkOptions>) => Wrapped<Array<TIn>>\n\n  debounce: (options: Partial<DebounceOptions>) => Wrapped<TIn>\n\n\n  /**\n   * Pluck and emit a single field from values\n   * @param fieldName \n   * @param options \n   * @returns \n   */\n  field: <TSource, TFieldType>(fieldName: keyof TIn, options: Partial<FieldOptions<TSource, TFieldType>>) => Wrapped<TFieldType>\n  /**\n   * Throws away values that don't match `predicate`\n   * @param predicate \n   * @param options \n   * @returns \n   */\n  filter: (predicate: FilterPredicate<TIn>, options: Partial<InitStreamOptions>) => Wrapped<TIn>\n\n  combineLatestToArray: <const T extends ReadonlyArray<ReactiveOrSource<any>>>(sources: T, options: Partial<CombineLatestOptions>) => Wrapped<RxValueTypes<T>>\n  combineLatestToObject: <const T extends Record<string, ReactiveOrSource<any>>>(sources: T, options: { name: string } & Partial<CombineLatestOptions>) => Wrapped<RxValueTypeObject<T>>\n\n  min: (options?: Partial<OpMathOptions>) => Wrapped<number>\n  max: (options?: Partial<OpMathOptions>) => Wrapped<number>\n  average: (options?: Partial<OpMathOptions>) => Wrapped<number>\n  sum: (options?: Partial<OpMathOptions>) => Wrapped<number>\n  tally: (options?: Partial<TallyOptions>) => Wrapped<number>\n\n  /**\n   * Converts one source stream into two, with values being emitted by both\n   * @param options \n   * @returns \n   */\n  split: (options?: Partial<SplitOptions>) => Array<Wrapped<TIn>>\n  /**\n * Emits values when this stream and any additional streams produce a value. The resulting stream is\n * thus an array of values, each source at a given index.\n * Waits to output a value until each stream has produced a value. Thus, the pace is determined by\n * the slowest stream.\n * @returns \n */\n  syncToArray: <const T extends ReadonlyArray<ReactiveOrSource<any>>>(reactiveSources: T, options?: Partial<SyncOptions>) => Wrapped<[ TIn, ...RxValueTypes<T> ]>\n\n  syncToObject: <const T extends Record<string, ReactiveOrSource<any>>>(reactiveSources: T, options?: { name?: string } & Partial<SyncOptions>) => Wrapped<RxValueTypeObject<T>>\n\n  /**\n   * Creates new streams for each case, sending values to the stream if they match the filter predicate\n   * @param cases \n   * @param options \n   * @returns \n   */\n  switcher: <TRec extends Record<string, FilterPredicate<TIn>>, TLabel extends keyof TRec>(cases: TRec, options: Partial<SwitcherOptions>) => Record<TLabel, Wrapped<TIn>>\n  /**\n   * Creates new streams for each case\n   * @param labels \n   * @returns \n   */\n  splitLabelled: <K extends keyof TIn>(...labels: Array<K>) => Record<K, Wrapped<TIn>>\n  /**\n   * Taps the stream, passing values to one or more 'processor' functions.\n   * This processing essentially happens in parallel, not affecting the main stream.\n   * \n   * ```js\n   * // Stream of pointermove events with {x:0,y:0} as default\n   * const move = Rx.From.event(document.body, `pointermove`, {x:0,y:0});\n   * // Wrap it for fluent access\n   * const ptr = Rx.wrap(move)\n   *  .tapProcess(\n   *    // Create a string representation\n   *    v => `${v.x},${v.y}`\n   *    // Set to DOM\n   *    v => {\n   *      document.getElementById(`coords`).innerText = v;\n   *    }\n   *   )\n   *  .onValue(value => {\n   *    // 'value' will be original PointerEvent, since .tapProcess happened in parallel,\n   *    // not affecting stream\n   *  });\n   * ```\n   * @param processors One-five processing functions\n   * @returns \n   */\n  tapProcess: <T2, T3, T4, T5, T6>(...processors: Processors<TIn, T2, T3, T4, T5, T6>) => Wrapped<TIn>\n  tapStream: (divergedStream: ReactiveWritable<TIn>) => Wrapped<TIn>\n  tapOps: <TOut>(source: ReactiveOrSource<TIn>, ...ops: Array<ReactiveOp<TIn, TOut>>) => Wrapped<TIn>\n  /**\n   * Transforms all values\n   * @param transformer \n   * @param options \n   * @returns \n   */\n  transform: <TOut>(transformer: (value: TIn) => TOut, options?: Partial<TransformOpts>) => Wrapped<TOut>\n  /**\n   * Only allow values through if a minimum of time has elapsed. Throws away values.\n   * Ie. converts a fast stream into a slower one.\n   * @param options \n   * @returns \n   */\n  throttle: (options: Partial<ThrottleOptions>) => Wrapped<TIn>\n  /**\n   * Emits a value if `source` does not emit a value after `interval`\n   * has elapsed. This can be useful to reset a reactive to some\n   * 'zero' state if nothing is going on.\n   * \n   * If `source` emits faster than the `interval`, it won't get triggered.\n   * \n   * Default for 'timeout': 1000s.\n   * \n   * ```js\n   * // Emit 'hello' if 'source' doesn't emit a value after 1 minute\n   * const r = Rx.timeoutValue(source, { value: 'hello', interval: { mins: 1 } });\n   * ```\n   * \n   * Can also emit results from a function or generator\n   * ```js\n   * // Emits a random number if 'source' doesn't emit a value after 500ms\n   * const r = Rx.timeoutValue(source, { fn: Math.random, interval: 500 });\n   * ```\n   * \n   * If `immediate` option is _true_ (default), the timer starts from stream initialisation.\n   * Otherwise it won't start until it observes the first value from `source`.\n   * @param options \n   */\n  timeoutValue: <TTriggerValue>(options: TimeoutValueOptions<TTriggerValue>) => Wrapped<TIn | TTriggerValue>\n  /**\n   * 'Pings' reactive (if it supports it) if a value is not received within a given interval.\n   * Behaviour can be stopped using an abort signal.\n   * @param options \n   * @returns \n   */\n  timeoutPing: (options: TimeoutPingOptions) => Wrapped<TIn>\n\n  /**\n   * Copies values from source into an array, throwing\n   * an error if expected number of items is not reached\n   * @param options \n   * @returns \n   */\n  toArrayOrThrow: (options: Partial<ToArrayOptions<TIn>>) => Promise<Array<TIn>>\n  /**\n   * Copies values from source into an array.\n   * @param options \n   * @returns \n   */\n  toArray: (options: Partial<ToArrayOptions<TIn>>) => Promise<Array<TIn | undefined>>\n  /**\n   * Listen for values\n   * @param callback \n   * @returns \n   */\n  onValue: (callback: (value: TIn) => void) => void\n\n}\n\nexport type ToArrayOptions<V> = {\n  /**\n   * Maximim time to wait for `limit` to be reached. 10s by default.\n   */\n  maximumWait: Interval\n  /**\n   * Number of items to read\n   */\n  limit: number\n  /**\n   * Behaviour if threshold is not reached.\n   * partial: return partial results\n   * throw: throw an error\n   * fill: fill remaining array slots with `fillValue`\n   */\n  underThreshold: `partial` | `throw` | `fill`\n  /**\n   * Value to fill empty slots with if `underThreshold = 'fill'`.\n   */\n  fillValue: V\n}\n\n/**\n * Laziness\n * * start: only begins on first subscriber. Keeps running even when there are no subscribers\n * * very: only begins on first subscriber. Stops looping if there are no subscribers\n * * never: begins calling function when initalised and doesn't stop until Reactive is disposed\n */\nexport type Lazy = `initial` | `never` | `very`\nexport type InitLazyStreamOptions = Partial<InitStreamOptions> & {\n  lazy: Lazy\n  debugLabel?: string\n  onStart: () => void\n  onStop: () => void\n};\n\nexport type InitLazyStreamInitedOptions<T> = InitLazyStreamOptions & {\n  initialValue: T\n}\n\nexport type CountOptions = { lazy: Lazy, amount: number, offset: number, interval: Interval, signal: AbortSignal }\nexport type ReactiveOrSource<V> = Wrapped<V> | Reactive<V> | IterableIterator<V> | AsyncIterableIterator<V> | Generator<V> | AsyncGenerator<V> | Array<V> | (() => V)\n\nexport type BindUpdateOpts<V> = {\n  initial: (v: V, el: HTMLElement) => void,\n  binds: Record<string, DomBindValueTarget & {\n    transform?: (value: any) => string\n  }>\n}\n\nexport type Reactive<V> = {\n  /**\n   * Subscribes to a reactive. Receives\n   * data as well as signals. Use `onValue` if you\n   * just care about values.\n   * \n   * Return result unsubscribes.\n   * \n   * ```js\n   * const unsub = someReactive.on(msg => {\n   *    // Do something with msg.value\n   * });\n   * \n   * unsub(); // Unsubscribe\n   * ```\n   * @param handler \n   */\n  on(handler: (value: Passed<V>) => void): Unsubscriber\n  /**\n   * Subscribes to a reactive's values.\n   * Returns a function that unsubscribes.\n   * @param handler\n   */\n  onValue(handler: (value: V) => void): Unsubscriber\n\n  dispose(reason: string): void\n  isDisposed(): boolean\n  set?(value: V): void\n}\n\n/**\n * A reactive that can be 'pinged' to produce a value.\n * \n * Use {@link isPingable} to check if a reactive is pingable.\n * \n * Pingable reactives are returned from\n * * interpolate\n * * computeWithPrevious\n * * valueToPing\n */\nexport type ReactivePingable<V> = Reactive<V> & {\n  ping(): void\n}\n\nexport type Unsubscriber = () => void;\n\nexport type ReactiveNonInitial<V> = Reactive<V> & {\n  last(): V | undefined\n}\n\nexport type ReactiveWritable<TIn, TOut = TIn> = Reactive<TOut> & {\n  set(value: TIn): void\n}\n\nexport type ReactiveInitial<V> = Reactive<V> & {\n  last(): V\n}\n\nexport type ReactiveFinite = {\n  isDone(): boolean\n}\n\nexport type ReactiveArray<V> = ReactiveWritable<Array<V>> & {\n  push(value: V): void\n  deleteAt(index: number): void\n  deleteWhere(filter: (value: V) => boolean): number\n  setAt(index: number, value: V): void\n  insertAt(index: number, value: V): void\n  onArray(handler: (changes: Passed<Array<ChangeRecord<number>>>) => void): () => void\n}\nexport type ObjectFieldHandler = { value: any, fieldName: string, pattern: string };\n\nexport type ReactiveDiff<V> = Reactive<V> & ReactiveWritable<V> & {\n  /**\n   * Notifies when the value of `fieldName` is changed.\n   * \n   * Use the returned function to unsubscribe.\n   * @param fieldName \n   * @param handler \n   */\n  onField(fieldName: string, handler: (result: ObjectFieldHandler) => void): () => void\n  /**\n   * Notifies of which field(s) were changed.\n   * If you just care about the whole, changed data use the `value` event.\n   * \n   * Use the returned function to unsubscribe.\n   * @param changes \n   */\n  onDiff(changes: (changes: Array<Immutable.PathDataChange<any>>) => void): () => void\n  /**\n   * Updates the reactive with some partial key-value pairs.\n   * Keys omitted are left the same as the current value.\n   * @param changedPart \n   * @returns Returns new value\n   */\n  update(changedPart: RecursivePartial<V>): V\n  /**\n   * Updates a particular field by its path\n   * @param field \n   * @param value \n   */\n  updateField(field: string, value: any): void\n}\n\nexport type ReactiveStream<V> = Reactive<V> & ReactiveWritable<V> & {\n  //through_(message: Passed<V>): void\n  /**\n   * Removes all the subscribers from this stream.\n   */\n  removeAllSubscribers(): void\n  /**\n   * Dispatches a signal\n   * @param signal \n   * @param context \n   */\n  signal(signal: SignalKinds, context?: string): void\n}\n\nexport type ReactiveInitialStream<V> = ReactiveStream<V> & ReactiveInitial<V>;\n\nexport type DomBindValueTarget = {\n  /**\n   * If _true_ `innerHTML` is set (a shortcut for elField:`innerHTML`)\n   */\n  htmlContent?: boolean\n  /**\n   * If _true_, 'textContent' is set (a shortcut for elField:'textContext')\n   */\n  textContent?: boolean\n  /**\n   * If set, this DOM element field is set. Eg 'textContent'\n   */\n  elField?: string\n  /**\n   * If set, this DOM attribute is set, Eg 'width'\n   */\n  attribName?: string\n  /**\n   * If set, this CSS variable is set, Eg 'hue' (sets '--hue')\n   */\n  cssVariable?: string\n  /**\n   * If set, this CSS property is set, Eg 'background-color'\n   */\n  cssProperty?: string\n}\n\nexport type ElementBind = {\n  /**\n   * Tag name for this binding.\n   * Overrides `defaultTag`\n   */\n  tagName?: string\n  /**\n   * If _true_, sub-paths are appended to element, rather than `container`\n   */\n  nestChildren?: boolean\n  transform?: (value: any) => string\n}\nexport type ElementsOptions = {\n  container: HTMLElement | string\n  defaultTag: string,\n  binds: Record<string, DomBindValueTarget & ElementBind>\n}\n\nexport type DomBindTargetNode = {\n  query?: string\n  element?: HTMLElement\n}\n\nexport type DomBindTargetNodeResolved = {\n  element: HTMLElement\n}\n\nexport type DomBindUnresolvedSource<TSource, TDestination> = DomBindTargetNode & DomBindSourceValue<TSource, TDestination> & DomBindValueTarget;\nexport type DomBindResolvedSource<TSource, TDestination> = DomBindTargetNodeResolved & DomBindSourceValue<TSource, TDestination> & DomBindValueTarget;\n\nexport type DomBindSourceValue<TSource, TDestination> = {\n  twoway?: boolean\n  /**\n   * Field from source value to pluck and use.\n   * This will also be the value passed to the transform\n   */\n  sourceField?: keyof TSource\n  transform?: (input: TSource) => TDestination\n  transformValue?: (input: any) => TDestination\n}\n\nexport type DomBindInputOptions<TSource, TDestination> = DomBindSourceValue<TSource, TDestination> & {\n  transformFromInput: (input: TDestination) => TSource\n}\n\n// export type PipeSet<In, Out> = [\n//   Reactive<In>,\n//   ...Array<Reactive<any> & ReactiveWritable<any>>,\n//   ReactiveWritable<Out> & Reactive<any>\n// ]\nexport type PipeSet<In, Out> = [\n  Reactive<In>,\n  ...Array<Reactive<any> & ReactiveWritable<any>>\n]\n\nexport type InitStreamOptions = {\n  /**\n   * Optional label to associate with this stream. Useful for debugging.\n   */\n  debugLabel: string\n  /**\n   * Called when there is a subscriber after there were no subscribers.\n   * Useful for 'startup' types of things that we want to run only when someone is actually listening.\n   * \n   * During the lifeycle of a stream, this could be called multiple times. Eg if all subscribers are removed\n   * next time someone subscribes it will get called again.\n   * @returns \n   */\n  onFirstSubscribe: () => void\n  /**\n   * Called when there are no longer any subscribers. Useful for shutting down\n   * activities now that no-one is listening.\n   * \n   * During the lifecycle of a stream, this could be called multiple times.\n   * @returns\n   */\n  onNoSubscribers: () => void\n  /**\n   * Called whenever the stream disposes. Useful for cleaning up.\n   * @param reason \n   * @returns \n   */\n  onDispose: (reason: string) => void\n}\n\n\nexport type DomCreateOptions = {\n  tagName: string\n  parentEl: string | HTMLElement\n}\n\nexport type PipeDomBinding = {\n  /**\n   * Remove binding and optionally delete element(s) (false by default)\n   */\n  remove(deleteElements: boolean): void\n}\n\n\n/**\n * WithValue stream options\n */\nexport type WithValueOptions<V> = Partial<InitStreamOptions> & {\n  /**\n   * Initial value\n   */\n  initial: V,\n  /**\n   * Laziness\n   */\n  lazy?: Lazy\n}\n\n\n\n\nexport type ResolveOptions = {\n  /**\n   * How many times to return value or call function.\n   * If _infinite_ is set to true, this value is ignored\n   */\n  loops: number\n  /**\n   * If _true_ loops forever\n   */\n  infinite: boolean\n  /**\n   * Delay before value\n   */\n  interval: Interval\n\n  lazy: Lazy\n}\n\nexport type ReactiveOpInit<TIn, TOut, TOpts> = (options: Partial<TOpts>) => ReactiveOp<TIn, TOut>\nexport type ReactiveOp<TIn, TOut> = (source: ReactiveOrSource<TIn>) => Reactive<TOut>\n\nexport type ReactiveOpLinks<In, Out> = [\n  ReactiveOrSource<In>,\n  ...Array<ReactiveOp<any, any>>,\n  ReactiveOp<any, Out>\n]\n\nexport type RxValueTypes<T extends ReadonlyArray<ReactiveOrSource<any>>> =\n  { [ K in keyof T ]: T[ K ] extends Reactive<infer V> ? V | undefined :\n    T[ K ] extends Wrapped<infer V> ? V | undefined :\n    T[ K ] extends Generator<infer V> ? V | undefined :\n    T[ K ] extends AsyncGenerator<infer V> ? V | undefined :\n    T[ K ] extends IterableIterator<infer V> ? V | undefined :\n    T[ K ] extends AsyncIterableIterator<infer V> ? V | undefined :\n    T[ K ] extends Array<infer V> ? V | undefined :\n    never };\n\nexport type RxValueTypeObject<T extends Record<string, ReactiveOrSource<any>>> =\n  { [ K in keyof T ]: T[ K ] extends Reactive<infer V> ? V :\n    T[ K ] extends Wrapped<infer V> ? V :\n    T[ K ] extends Generator<infer V> ? V :\n    T[ K ] extends AsyncGenerator<infer V> ? V :\n    T[ K ] extends IterableIterator<infer V> ? V :\n    T[ K ] extends AsyncIterableIterator<infer V> ? V :\n    T[ K ] extends Array<infer V> ? V :\n    never };\n\nexport type RxValueTypeObjectOrUndefined<T extends Record<string, ReactiveOrSource<any>>> =\n  { [ K in keyof T ]: T[ K ] extends Reactive<infer V> ? V | undefined :\n    T[ K ] extends Wrapped<infer V> ? V | undefined :\n    T[ K ] extends Generator<infer V> ? V | undefined :\n    T[ K ] extends AsyncGenerator<infer V> ? V | undefined :\n    T[ K ] extends IterableIterator<infer V> ? V | undefined :\n    T[ K ] extends AsyncIterableIterator<infer V> ? V | undefined :\n    T[ K ] extends Array<infer V> ? V | undefined :\n    never };\n\nexport type RxValueTypeRx<T extends Record<string, ReactiveOrSource<any>>> =\n  { [ K in keyof T ]: T[ K ] extends Reactive<infer V> ? Reactive<V> :\n    T[ K ] extends Wrapped<infer V> ? Reactive<V> :\n    T[ K ] extends Generator<infer V> ? Reactive<V> :\n    T[ K ] extends AsyncGenerator<infer V> ? Reactive<V> :\n    T[ K ] extends IterableIterator<infer V> ? Reactive<V> :\n    T[ K ] extends AsyncIterableIterator<infer V> ? Reactive<V> :\n    T[ K ] extends Array<infer V> ? Reactive<V> :\n    never };\n\nexport type PrimitiveValueTypeObject<T extends Record<string, Primitive>> =\n  { [ K in keyof T ]:\n    T[ K ] extends number ? number | undefined :\n    T[ K ] extends string ? string | undefined :\n    T[ K ] extends boolean ? boolean | undefined :\n    T[ K ] extends bigint ? bigint | undefined :\n    never };\n\n\n","import { intervalToMs } from \"../flow/IntervalType.js\";\nimport type { ReactiveOrSource, ToArrayOptions } from \"./Types.js\";\nimport { resolveSource } from \"./ResolveSource.js\";\nimport { messageHasValue, messageIsDoneSignal } from \"./Util.js\";\n\n/**\n * Reads a set number of values from `source`, returning as an array. May contain\n * empty values if desired values is not reached.\n * \n * After the limit is reached (or `source` completes), `source` is unsubscribed from.\n * \n * If no limit is set, it will read until `source` completes or `maximumWait` is reached.\n * `maximumWait` is 10 seconds by default.\n * \n * Use {@link toArrayOrThrow} to throw if desired limit is not reached.\n * \n * ```js\n * // Read from `source` for 5 seconds\n * const data = await toArray()(source);\n * // Read 5 items from `source`\n * const data = await toArray({ limit: 5 })(source);\n * // Read for 10s\n * const data = await toArray({ maximumWait: 10_1000 })(source);\n * ```\n * @param source \n * @param options \n * @returns \n */\nexport async function toArray<V>(source: ReactiveOrSource<V>, options: Partial<ToArrayOptions<V>> = {}): Promise<Array<V | undefined>> {\n  const limit = options.limit ?? Number.MAX_SAFE_INTEGER;\n  const maximumWait = intervalToMs(options.maximumWait, 10 * 1000);\n  const underThreshold = options.underThreshold ?? `partial`\n  const read: Array<V | undefined> = [];\n\n  const rx = resolveSource(source);\n\n  const promise = new Promise<Array<V | undefined>>((resolve, reject) => {\n    const done = () => {\n      clearTimeout(maxWait);\n      unsub();\n      if (read.length < limit && underThreshold === `throw`) {\n        reject(new Error(`Threshold not reached. Wanted: ${ limit } got: ${ read.length }. Maximum wait: ${ maximumWait }`));\n        return;\n      }\n      if (read.length < limit && underThreshold === `fill`) {\n        for (let index = 0; index < limit; index++) {\n          if (read[ index ] === undefined) {\n            //console.log(`Rx.toArray filling at index: ${ index }`);\n            read[ index ] = options.fillValue;\n          }\n        }\n      }\n      resolve(read);\n    }\n\n    const maxWait = setTimeout(() => {\n      done();\n    }, maximumWait);\n\n    const unsub = rx.on(message => {\n      //console.log(`Rx.toArray: ${ JSON.stringify(message) }`);\n      if (messageIsDoneSignal(message)) {\n        done();\n      } else if (messageHasValue(message)) {\n        read.push(message.value);\n        //console.log(`Rx.toArray read buffer: ${ JSON.stringify(read) }`);\n        if (read.length === limit) {\n          done();\n        }\n      }\n    });\n  });\n\n  return promise;\n}\n\n\n/**\n * By default, reads all the values from `source`, or until 5 seconds has elapsed.\n * \n * If `limit` is provided as an option, it will exit early, or throw if that number of values was not acheived.\n * \n * ```js\n * // Read from `source` for 5 seconds\n * const data = await toArrayOrThrow()(source);\n * // Read 5 items from `source`\n * const data = await toArrayOrThrow({ limit: 5 })(source);\n * // Read for 10s\n * const data = await toArrayOrThrow({ maximumWait: 10_1000 })(source);\n * ```\n * @param source \n * @param options \n * @returns \n */\nexport async function toArrayOrThrow<V>(source: ReactiveOrSource<V>, options: Partial<ToArrayOptions<V>> = {}): Promise<Array<V>> {\n  const limit = options.limit ?? Number.MAX_SAFE_INTEGER;\n  const maximumWait = options.maximumWait ?? 5 * 1000;\n  const v = await toArray(source, { limit, maximumWait, underThreshold: `partial` });\n\n  // There was a limit, but it wasn't reached\n  if (options.limit && v.length < options.limit) throw new Error(`Threshold not reached. Wanted: ${ options.limit }, got ${ v.length }`);\n\n  // Otherwise, we may have been reading for a specified duration\n  return v as Array<V>;\n\n}","import { resolveSource } from \"./ResolveSource.js\";\nimport type { ReactiveOrSource } from \"./Types.js\";\nimport { messageHasValue, messageIsDoneSignal } from \"./Util.js\";\n\n/**\n * Returns an AsyncGenerator wrapper around Reactive.\n * This allows values to be iterated over using a `for await` loop,\n * like Chains.\n *\n * ```js\n * // Reactive numerical value\n * const number = Reactive.number(10);\n * \n * const g = Reactive.toGenerator(number);\n * for await (const v of g) {\n *  console.log(v); // Prints out whenever the reactive value changes\n * }\n * // Execution doesn't continue until Reactive finishes\n * ```\n * \n * When/if `source` closes, an exception is thrown.\n * To catch this, wrap the calling `for await` in a try-catch block\n * ```js\n * try {\n *  for await (const v of g) {\n *  }\n * } catch (error) {\n * }\n * // Completed\n * ``` \n * \n * Use something like `setTimeout` to loop over the generator\n * without impeding the rest of your code flow. For example:\n * ```js\n * // Listen for every pointerup event\n * const ptr = Reactive.fromEvent(document.body, `pointerup`);\n * // Start iterating\n * setTimeout(async () => {\n *  const gen = Reactive.toGenerator(ptr);\n *  try {\n *    for await (const v of gen) {\n *      // Prints out whenever there is a click\n *      console.log(v);\n *    }\n *  } catch (e) { }\n *  console.log(`Iteration done`);\n * });\n * \n * // Execution continues here immediately\n * ```\n * @param source \n */\nexport async function* toGenerator<V>(source: ReactiveOrSource<V>): AsyncGenerator<V> {\n  const s = resolveSource(source);\n  let promiseResolve: ((value: V | PromiseLike<V>) => void) = (_) => {/** noop */ };\n  let promiseReject: ((reason: string) => void) = (_) => {/** no-op */ }\n\n  const promiseInit = () => (new Promise<V>((resolve, reject) => {\n    promiseResolve = resolve;\n    promiseReject = reject;\n  }));\n  let promise = promiseInit();\n  let keepRunning = true;\n\n  s.on(message => {\n    if (messageHasValue(message)) {\n      promiseResolve(message.value);\n      promise = promiseInit();\n    } else if (messageIsDoneSignal(message)) {\n      keepRunning = false;\n      promiseReject(`Source has completed`);\n    }\n  });\n\n  while (keepRunning) {\n    yield await promise;\n  }\n}\n","import type { RemapObjectPropertyType } from \"../TsUtil.js\";\n\n/**\n * Maps the top-level properties of an object through a map function.\n * That is, run each of the values of an object through a function,\n * setting the result onto the same key structure as original.\n * \n * It is NOT recursive.\n *\n * The mapping function gets a single args object, consisting of `{ value, field, index }`,\n * where 'value' is the value of the field, 'field' the name, and 'index' a numeric count.\n * @example Double the value of all fields\n * ```js\n * const rect = { width: 100, height: 250 };\n * const doubled = mapObjectShallow(rect, args => {\n *  return args.value*2;\n * });\n * // Yields: { width: 200, height: 500 }\n * ```\n *\n * Since the map callback gets the name of the property, it can do context-dependent things.\n * ```js\n * const rect = { width: 100, height: 250, colour: 'red' }\n * const doubled = mapObjectShallow(rect, args => {\n *  if (args.field === 'width') return args.value*3;\n *  else if (typeof args.value === 'number') return args.value*2;\n *  return args.value;\n * });\n * // Yields: { width: 300, height: 500, colour: 'red' }\n * ```\n * In addition to bulk processing, it allows remapping of property types.\n *\n * In terms of type-safety, the mapped properties are assumed to have the\n * same type.\n *\n * ```js\n * const o = {\n *  x: 10,\n *  y: 20,\n *  width: 200,\n *  height: 200\n * }\n *\n * // Make each property use an averager instead\n * const oAvg = mapObjectShallow(o, args => {\n *  return movingAverage(10);\n * });\n *\n * // Instead of { x:number, y:number... }, we now have { x:movingAverage(), y:movingAverage()... }\n * // Add a value to the averager\n * oAvg.x.add(20);\n * ```\n */\nexport const mapObjectShallow = <\n  TSource extends Record<string, any>,\n  TFieldValue,\n>(\n  // eslint-disable-next-line indent\n  object: TSource,\n  // eslint-disable-next-line indent\n  mapFunction: (args: MapObjectArgs) => TFieldValue\n  // eslint-disable-next-line indent\n): RemapObjectPropertyType<TSource, TFieldValue> => {\n  type MapResult = [ field: string, value: TFieldValue ];\n  const entries = Object.entries(object);\n  const mapped = entries.map(([ sourceField, sourceFieldValue ], index) => [\n    sourceField,\n    mapFunction({ value: sourceFieldValue, field: sourceField, index, path: sourceField }),\n  ]) as Array<MapResult>;\n  // @ts-expect-error\n  return Object.fromEntries(mapped);\n};\n\nexport type MapObjectArgs = {\n  field: string\n  path: string\n  value: any\n  index: number\n}\n\n/**\n * Maps the contents of `data` using `mapper` as a structured set of map functions.\n * ```js\n * const a = {\n *  person: {\n *    size: 20\n *  }\n *  hello: `there`\n * }\n * mapObjectByObject(a, {\n *  person: {\n *    size: (value, context) => {\n *      return value * 2\n *    }\n *  }\n * });\n * // Yields: { person: { size: 40 }, hello: `there` }\n * ```\n * @param data \n * @param mapper \n * @returns \n */\nexport function mapObjectByObject(data: any, mapper: Record<string, (value: any, context: any) => any>) {\n  const entries = Object.entries(data);\n  for (let i = 0; i < entries.length; i++) {\n    const e = entries[ i ];\n    if (e[ 0 ] in mapper) {\n      const m = mapper[ e[ 0 ] ];\n      e[ 1 ] = (typeof m === `object`) ?\n        mapObjectByObject(e[ 1 ], m) :\n        m(e[ 1 ], data);\n    }\n  }\n  return Object.fromEntries(entries);\n}","import * as Ops from \"./ops/index.js\";\nimport { resolveSource } from \"./ResolveSource.js\";\nimport { toArray, toArrayOrThrow } from \"./ToArray.js\";\nimport type { ReactiveOrSource, Wrapped, ToArrayOptions, InitStreamOptions, Reactive, RxValueTypes, CombineLatestOptions, ReactiveOp, } from \"./Types.js\";\nimport type { ChunkOptions, FieldOptions, FilterPredicate, DebounceOptions, SwitcherOptions, SplitOptions, ThrottleOptions, TransformOpts, SyncOptions, } from './ops/Types.js'\nimport type { TimeoutPingOptions, TimeoutValueOptions } from './sources/Types.js'\nimport { messageHasValue } from \"./Util.js\";\nimport { mapObjectShallow } from '../data/MapObject.js';\nimport * as Enacts from './sinks/index.js';\nimport type { Processors } from \"../data/Process.js\";\n\n/**\n * Wrap a reactive source to allow for chained\n * function calls.\n * \n * Example:\n * For every `pointerup` event on the body, chunk the events over\n * periods of 200ms, get the number of events in that period,\n * and print it out.\n * \n * eg. detecting single or double-clicks\n * ```js\n * wrap(Rx.fromEvent<{ x: number, y: number }>(document.body, `pointerup`))\n *  .chunk({ elapsed: 200 })\n *  .transform(v => v.length)\n *  .onValue(v => { console.log(v) });\n * ```\n * @param source \n * @returns \n */\nexport function wrap<TIn>(source: ReactiveOrSource<TIn>): Wrapped<TIn> {\n  return {\n    source: resolveSource(source),\n    enacts: {\n      setHtmlText: (options) => {\n        return Enacts.setHtmlText(source, options);\n      },\n    },\n    annotate: <TAnnotation>(transformer: (value: TIn) => TAnnotation): Wrapped<{ value: TIn, annotation: TAnnotation }> => {\n      const a = Ops.annotate<TIn, TAnnotation>(source, transformer);\n      return wrap(a);\n    },\n    annotateWithOp: <TOut>(op: ReactiveOp<TIn, TOut>): Wrapped<{ value: TIn, annotation: TOut }> => {\n      const a = Ops.annotateWithOp<TIn, TOut>(source, op);\n      return wrap(a);\n    },\n\n    chunk: (options: Partial<ChunkOptions>): Wrapped<Array<TIn>> => {\n      const w = wrap<Array<TIn>>(Ops.chunk(source, options));\n      return w;\n    },\n    debounce: (options: Partial<DebounceOptions> = {}) => {\n      return wrap(Ops.debounce<TIn>(source, options));\n    },\n    field: <TSource, TFieldType>(fieldName: keyof TIn, options: Partial<FieldOptions<TSource, TFieldType>> = {}) => {\n      // Ops.field requires TIn extends object\n      // Would be good if `wrap` returns different versions depending on TIn, so .field\n      // would not be present at all if we had Reactive<number>, for example\n      // @ts-expect-error\n      const f = Ops.field<TIn, TFieldType>(source, fieldName, options);\n      return wrap<TFieldType>(f);\n    },\n    filter: (predicate: FilterPredicate<TIn>, options: Partial<InitStreamOptions>) => {\n      return wrap(Ops.filter(source, predicate, options));\n    },\n    combineLatestToArray: <const T extends ReadonlyArray<ReactiveOrSource<any>>>(sources: T, options: Partial<CombineLatestOptions> = {}) => {\n      const srcs = [ source, ...sources ] as any as T;\n      return wrap(Ops.combineLatestToArray(srcs, options));\n    },\n    combineLatestToObject: <const T extends Record<string, ReactiveOrSource<any>>>(sources: T, options: { name?: string } & Partial<CombineLatestOptions>) => {\n      const name = options.name ?? `source`;\n      const o = { ...sources };\n      (o as any)[ name ] = source;\n      return wrap(Ops.combineLatestToObject(o, options));\n    },\n    min: (options: Partial<Ops.OpMathOptions> = {}) => {\n      return wrap(Ops.min(source, options));\n    },\n    max: (options: Partial<Ops.OpMathOptions> = {}) => {\n      return wrap(Ops.max(source, options));\n    },\n    average: (options: Partial<Ops.OpMathOptions> = {}) => {\n      return wrap(Ops.average(source, options));\n    },\n    sum: (options: Partial<Ops.OpMathOptions> = {}) => {\n      return wrap(Ops.sum(source, options));\n    },\n    tally: (options: Partial<Ops.TallyOptions> = {}) => {\n      return wrap(Ops.tally(source, options));\n    },\n    split: (options: Partial<SplitOptions> = {}) => {\n      const streams = Ops.split<TIn>(source, options).map(v => wrap(v));\n      return streams;\n    },\n    splitLabelled: <K extends keyof TIn>(...labels: Array<K>) => {\n      const l = Ops.splitLabelled<TIn, keyof TIn>(source, labels);\n      const m = mapObjectShallow<typeof l, Wrapped<TIn>>(l, args => wrap(args.value as Reactive<TIn>)) as Record<K, Wrapped<TIn>>;\n      return m;\n    },\n    switcher: <TRec extends Record<string, FilterPredicate<TIn>>, TLabel extends keyof TRec>(cases: TRec, options: Partial<SwitcherOptions> = {}) => {\n      const s = Ops.switcher<TIn, TRec, TLabel>(source, cases, options);\n      const m = mapObjectShallow<typeof s, Wrapped<TIn>>(s, args => wrap(args.value as Reactive<TIn>));\n      return m as Record<TLabel, Wrapped<TIn>>;\n    },\n    syncToArray: <const T extends ReadonlyArray<ReactiveOrSource<any>>>(additionalSources: T, options: Partial<SyncOptions> = {}) => {\n      const unwrapped = [ source, ...additionalSources ].map(v => resolveSource(v));\n      const x = Ops.syncToArray(unwrapped, options) as Reactive<[ TIn, ...RxValueTypes<T> ]>;\n      return wrap(x); //synchronise<TIn>([ source, ...unwrapped ] as const));\n    },\n    syncToObject: <const T extends Record<string, ReactiveOrSource<any>>>(sources: T, options: { name?: string } & Partial<SyncOptions> = {}) => {\n      const name = options.name ?? `source`;\n      const o = { ...sources };\n      (o as any)[ name ] = source;\n      return wrap(Ops.syncToObject(o, options));\n    },\n    tapProcess: <T2, T3, T4, T5, T6>(...processors: Processors<TIn, T2, T3, T4, T5, T6>) => {\n      Ops.tapProcess(source, ...processors)\n      return wrap(source);\n    },\n    tapStream: (divergedStream) => {\n      Ops.tapStream(source, divergedStream);\n      return wrap(source);\n    },\n    tapOps: <TOut>(source: ReactiveOrSource<TIn>, ...ops: Array<ReactiveOp<TIn, TOut>>) => {\n      Ops.tapOps(source, ...ops);\n      return wrap(source);\n    },\n    throttle: (options: Partial<ThrottleOptions> = {}) => {\n      return wrap(Ops.throttle<TIn>(source, options));\n    },\n    transform: <TOut>(transformer: (value: TIn) => TOut, options: Partial<TransformOpts> = {}) => {\n      return wrap(Ops.transform(source, transformer, options));\n    },\n    timeoutValue: <TTrigger>(options: TimeoutValueOptions<TTrigger>) => {\n      return wrap(Ops.timeoutValue<TIn, TTrigger>(source, options));\n    },\n    timeoutPing: (options: TimeoutPingOptions) => {\n      return wrap(Ops.timeoutPing(source, options));\n    },\n    toArray: (options: Partial<ToArrayOptions<TIn>>) => {\n      return toArray(source, options);\n    },\n    toArrayOrThrow: (options: Partial<ToArrayOptions<TIn>>) => {\n      return toArrayOrThrow(source, options);\n    },\n    onValue: (callback: ((value: TIn) => void)) => {\n      const s = resolveSource(source);\n      s.on(message => {\n        if (messageHasValue(message)) callback(message.value);\n      })\n    }\n  }\n}\n","import { intervalToMs } from \"../flow/IntervalType.js\";\nimport { continuously } from \"../flow/Continuously.js\";\nimport type { CountOptions } from \"./Types.js\";\nimport { initLazyStream } from \"./InitStream.js\";\n\n/**\n * Produces an incrementing value. By default starts at 0 and counts\n * forever, incrementing every second.\n * \n * ```js\n * const r = Rx.count();\n * r.onValue(c => {\n *  // 0, 1, 2, 3 ... every second\n * });\n * ```\n * \n * The `limit` is exclusive\n * ```js\n * const r = Rx.count({limit:5});\n * // Yields 0,1,2,3,4\n * ```\n * \n * If limit is less than start, it will count down instead.\n * ```js\n * const r = Rx.count({start:5, limit: 0});\n * // Yie:ds 5,4,3,2,1\n * ```\n * \n * ```js\n * // Count 10, 12, 14 ... every 500ms\n * const r = Rx.count({ start: 10, amount: 2, interval: 500 });\n * ```\n * \n * In addition to setting `limit` (which is exclusive), you can stop with an abort signal\n * ```js\n * const ac = new AbortController();\n * const r = Rx.count({signal:ac.signal});\n * ...\n * ac.abort(`stop`);\n * ```\n * @param options \n */\nexport function count(options: Partial<CountOptions> = {}) {\n\n  const lazy = options.lazy ?? `initial`;\n  const interval = intervalToMs(options.interval, 1000);\n  const amount = options.amount ?? 1;\n  const offset = options.offset ?? 0;\n\n  let produced = 0;\n  let value = offset;\n\n  const done = (reason: string) => {\n    events.dispose(reason);\n  }\n\n  const timer = continuously(() => {\n    if (options.signal?.aborted) {\n      done(`Aborted (${ options.signal.reason })`);\n      return false;\n    }\n    events.set(value);\n    value += 1;\n    produced++;\n    if (produced >= amount) {\n      done(`Limit reached`);\n      return false;\n    }\n  }, interval);\n\n  const events = initLazyStream<number>({\n    onStart() {\n      timer.start();\n    },\n    onStop() {\n      timer.cancel();\n    },\n    onDispose() {\n      timer.cancel();\n    },\n    lazy\n  });\n  return events;\n}\n","import * as Immutable from \"../data/Pathed.js\";\nimport { resolveEl } from \"../dom/ResolveEl.js\";\nimport * as Rx from \"./index.js\";\nimport type { ElementsOptions, PipeDomBinding, BindUpdateOpts, DomBindResolvedSource, DomBindSourceValue, DomBindValueTarget, ElementBind } from './Types.js';\nimport { hasLast, messageHasValue, messageIsSignal } from \"./Util.js\";\nimport { getFromKeys } from \"../data/maps/MapFns.js\";\nimport { afterMatch, beforeMatch } from \"../Text.js\";\nimport { stringSegmentsWholeToEnd, stringSegmentsWholeToFirst } from \"../text/Segments.js\";\nimport { QueueMutable } from \"../collections/queue/QueueMutable.js\";\nimport { object } from \"./sources/Object.js\";\n\n/**\n * Reactive stream of array of elements that match `query`.\n * @param query \n * @returns \n */\nexport function fromDomQuery(query: string) {\n  const elements = [ ...document.querySelectorAll(query) ] as Array<HTMLElement>;\n\n  return object(elements);\n  /// TODO: MutationObserver to update element list\n}\n\n/**\n * Updates an element's `textContent` when the source value changes.\n * ```js\n * bindText(source, `#blah`);\n * ```\n * @param elOrQuery \n * @param source \n * @param bindOpts \n */\nexport const bindText = <TSource>(source: Rx.Reactive<TSource>, elOrQuery: string | HTMLElement | null, bindOpts: Partial<Rx.DomBindSourceValue<TSource, string>> = {}) => {\n  return bindElement(source, elOrQuery, { ...bindOpts, elField: `textContent` });\n}\n\n/**\n * Updates an element's `value` (as well as the 'value' attribute) when the source value changes.s\n * @param source \n * @param elOrQuery \n * @param bindOpts \n * @returns \n */\nexport const bindValueText = <TSource>(source: Rx.Reactive<TSource>, elOrQuery: string | HTMLInputElement | null, bindOpts: Partial<Rx.DomBindSourceValue<TSource, string>> = {}) => {\n  return bindElement(source, elOrQuery, { ...bindOpts, elField: `value`, attribName: `value` });\n}\n\n/**\n * Updates an element's `valueAsNumber` (as well as the 'value' attribute) when the source value changes.\n * ```js\n * // Create a reactive number, with a default value of 10\n * const r1 = Rx.From.number(10);\n * // Bind reactive to HTML input element with id 'inputRange'\n * const b1 = Rx.Dom.bindValueRange(r1,`#inputRange`);\n *\n * // Demo: Change the reactive value every second\n * // ...changing the reactive in turn updates the HTML\n * setInterval(() => {\n *  r1.set(Math.floor(Math.random()*100));\n * }, 1000);\n * ```\n * @param source \n * @param elOrQuery \n * @param bindOpts \n * @returns \n */\n// export const bindValueRange = (source: Rx.Reactive<number>, elOrQuery: string | HTMLInputElement | null, bindOpts: Partial<Rx.DomBindInputOptions<number, number>> = {}) => {\n//   const el = validateElement(elOrQuery, `range`);\n//   const b = bindElement<number, number>(source, el, { ...bindOpts, elField: `valueAsNumber`, attribName: `value` });\n//   const twoway = bindOpts.twoway ?? false;\n\n//   const transformFromInput = bindOpts.transformFromInput ?? ((value) => {\n//     if (typeof value === `number`) return value;\n//     return Number.parseFloat(value);\n//   });\n//   const input = Rx.From.domValueAsNumber(el);\n//   return setupInput(b, input, source, twoway, transformFromInput);\n// }\n\n// export const bindValueColour = (source: Rx.Reactive<Colour.Colourish>, elOrQuery: string | HTMLInputElement | null, bindOpts: Partial<Rx.DomBindInputOptions<Colour.Colourish, string>> = {}) => {\n//   const el = validateElement(elOrQuery, `color`);\n//   const b = bindElement<Colour.Colourish, string>(source, el, {\n//     ...bindOpts,\n//     elField: `value`,\n//     attribName: `value`,\n//     transform(input) {\n//       console.log(`transform from: ${ JSON.stringify(input) } to hex`);\n//       const c = Colour.resolve(input);\n//       return c.to(`srgb`).toString({ format: `hex`, collapse: false });\n//     },\n//   });\n\n//   const twoway = bindOpts.twoway ?? false;\n\n//   const transformFromInput = bindOpts.transformFromInput ?? ((value) => {\n//     const x = Colour.toHsl(value);\n//     console.log(`transformFromInput: ${ value } x: ${ JSON.stringify(x) }`);\n//     return x;\n//   });\n\n//   const input = Rx.From.domValue<Colour.Hsl>(el, {\n//     domToValue: transformFromInput\n//   });\n//   return setupInput(b, input, source, twoway, transformFromInput);\n// }\n\nconst setupInput = <TSource, TDestination>(b: PipeDomBinding, input: Rx.Reactive<TDestination>, source: Rx.Reactive<TSource>, twoway: boolean, transformFromInput: (value: TDestination) => TSource) => {\n  input.onValue(value => {\n    const v = transformFromInput(value);\n    if (twoway && Rx.isWritable(source)) {\n      source.set(v);\n    }\n  });\n  const dispose = () => {\n    input.dispose(`bindInput twoway dispose`);\n    b.remove(false);\n  }\n  return { ...b, dispose, input };\n}\n\nconst validateElement = (elOrQuery: string | HTMLInputElement | null, type?: string): HTMLInputElement => {\n  const el = resolveEl(elOrQuery);\n  if (el.nodeName !== `INPUT`) throw new Error(`HTML INPUT element expected. Got: ${ el.nodeName }`);\n  if (type !== undefined && el.type !== type) throw new Error(`HTML INPUT element expected with type 'range'. Got: ${ el.type }`);\n  return el;\n}\n\n\n/**\n * Updates an element's `innerHTML` when the source value changes\n * ```js\n * bindHtml(source, `#blah`);\n * ```\n * \n * Uses {@link bindElement}, with `{elField:'innerHTML'}` as the options.\n * @param elOrQuery\n * @param source \n * @param bindOpts \n * @returns \n */\nexport const bindHtml = <TSource>(source: Rx.Reactive<TSource>, elOrQuery: string | HTMLElement | null, bindOpts: DomBindSourceValue<TSource, string> = {}) => {\n  return bindElement(source, elOrQuery, { ...bindOpts, elField: `innerHTML` });\n}\n\n\n/**\n * Shortcut to bind to an elements attribute\n * @param elOrQuery\n * @param source \n * @param attribute \n * @param bindOpts \n * @returns \n */\n// export const bindAttribute = <V>(elOrQuery: string | HTMLElement, source: Rx.Reactive<V>, attribute: string, bindOpts: Partial<DomBindOptions<V>> = {}) => {\n//   return bind(elOrQuery, source, { ...bindOpts, attribName: attribute });\n// }\n\n/**\n * Shortcut to bind to a CSS variable\n * @param elOrQuery\n * @param source \n * @param cssVariable \n * @param bindOpts \n * @returns \n */\n// export const bindCssVariable = <V>(elOrQuery: string | HTMLElement, source: Rx.Reactive<V>, cssVariable: string, bindOpts: Partial<DomBindOptions<V>> = {}) => {\n//   return bind(elOrQuery, source, { ...bindOpts, cssVariable: cssVariable });\n// }\n\n/**\n * Creates a new HTML element, calling {@link bind} on it to update when `source` emits new values.\n * \n * \n * ```js\n * // Set textContent of a SPAN with values from `source`\n * create(source, { tagName: `span`, parentEl: document.body })\n * ```\n * \n * If `parentEl` is not given in the options, the created element needs to be manually added\n * ```js\n * const b = create(source);\n * someEl.append(b.el); // Append manually\n * ```\n * \n * ```\n * // Set 'title' attribute based on values from `source`\n * create(source, { parentEl: document.body, attribName: `title` })\n * ```\n * @param source \n * @param options \n * @returns \n */\n// export const create = <V>(source: Rx.Reactive<V>, options: Partial<DomCreateOptions> & Partial<DomBindOptions<V>> = {}): PipeDomBinding => {\n//   const nodeType = options.tagName ?? `DIV`;\n\n//   const el = document.createElement(nodeType);\n//   const b = bind(el, source, options);\n\n//   if (options.parentEl) {\n//     const parentElementOrQuery = resolveEl(options.parentEl);\n//     if (parentElementOrQuery === undefined) throw new Error(`Parent element could not be resolved`);\n//     parentElementOrQuery.append(el);\n//   }\n//   return b;\n// }\n\n/**\n * Update a DOM element's field, attribute or CSS variable when `source` produces a value.\n * \n * ```js\n * // Access via DOM query. Binds to 'textContent' by default\n * bind(readableSource, `#someEl`);\n * \n * // Set innerHTML instead\n * bind(readableSource, someEl, { elField: `innerHTML` });\n * \n * // An attribute\n * bind(readableSource, someEl, { attribName: `width` });\n * \n * // A css variable ('--' optiona)\n * bind(readableSource, someEl, { cssVariable: `hue` });\n * \n * // Pluck a particular field from source data.\n * // Ie someEl.textContent = value.colour\n * bind(readableSource, someEl, { sourceField: `colour` });\n * \n * // Transform value before setting it to field\n * bind(readableSource, someEl, { \n *  field: `innerHTML`, \n *  transform: (v) => `Colour: ${v.colour}`\n * })\n * ```\n * \n * If `source` has an initial value, this is used when first bound.\n * \n * Returns {@link PipeDomBinding} to control binding:\n * ```js\n * const bind = bind(source, `#someEl`);\n * bind.remove();     // Unbind\n * bind.remove(true); // Unbind and remove HTML element\n * ```\n * \n * If several fields need to be updated based on a new value, consider using {@link bindUpdate} instead.\n * @param elOrQuery Element to update to, or query string such as '#someid'\n * @param source Source of data\n * @param binds Bindings\n */\nexport const bindElement = <TSource, TDestination>(source: Rx.Reactive<TSource>, elOrQuery: string | HTMLElement | null, ...binds: Array<DomBindSourceValue<TSource, TDestination> & Rx.DomBindValueTarget>): PipeDomBinding => {\n  if (elOrQuery === null) throw new Error(`Param 'elOrQuery' is null`);\n  if (elOrQuery === undefined) throw new Error(`Param 'elOrQuery' is undefined`);\n\n  const el = resolveEl(elOrQuery);\n  let b = [];\n  if (binds.length === 0) {\n    b.push({ elField: `textContent` });\n  } else {\n    b = [ ...binds ];\n  }\n  const bb = b.map(bind => {\n    if (`element` in bind) return bind as DomBindResolvedSource<TSource, TDestination>;\n    return { ...bind, element: el } as DomBindResolvedSource<TSource, TDestination>\n  });\n  return bind<TSource, TDestination>(source, ...bb);\n}\n\nconst resolveBindUpdater = (bind: DomBindValueTarget, element: HTMLElement): (value: any) => void => {\n  const b = resolveBindUpdaterBase(bind);\n  return (value: any) => {\n    b(value, element);\n  }\n}\n\nconst resolveBindUpdaterBase = (bind: DomBindValueTarget): (value: any, element: HTMLElement) => void => {\n  if (bind.elField !== undefined || (bind.cssVariable === undefined && bind.attribName === undefined && bind.cssProperty === undefined && bind.textContent === undefined && bind.htmlContent === undefined)) {\n    const field = bind.elField ?? `textContent`;\n    return (v: any, element: HTMLElement) => {\n      (element as any)[ field ] = v;\n    }\n  }\n  if (bind.attribName !== undefined) {\n    const attrib = bind.attribName;\n    return (v: any, element: HTMLElement) => {\n      element.setAttribute(attrib, v);\n    }\n  }\n  if (bind.textContent) {\n    return (v: any, element: HTMLElement) => {\n      element.textContent = v;\n    }\n  }\n  if (bind.htmlContent) {\n    return (v: any, element: HTMLElement) => {\n      element.innerHTML = v;\n    }\n  }\n  if (bind.cssVariable !== undefined) {\n    let css = bind.cssVariable;\n    if (!css.startsWith(`--`)) css = `--` + css;\n    return (v: any, element: HTMLElement) => {\n      element.style.setProperty(css, v);\n    }\n  }\n  if (bind.cssProperty !== undefined) {\n    return (v: any, element: HTMLElement) => {\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      (element.style as any)[ bind.cssProperty! ] = v;\n    }\n  }\n  return (_: any, _element: HTMLElement) => {\n    /** no-op */\n  }\n}\n\nconst resolveTransform = <TSource, TDestination>(bind: DomBindSourceValue<TSource, TDestination>) => {\n  if (!bind.transform && !bind.transformValue) return;\n  if (bind.transformValue) {\n    if (bind.sourceField === undefined) throw new Error(`Expects 'sourceField' to be set when 'transformValue' is set`);\n    return (value: TSource) => {\n      const fieldValue = (value as any)[ bind.sourceField ]\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      return bind.transformValue!(fieldValue);\n    }\n  } else if (bind.transform) {\n    if (bind.sourceField !== undefined) throw new Error(`If 'transform' is set, 'sourceField' is ignored`);\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    return (value: TSource) => bind.transform!(value);\n  }\n}\n\n/**\n * Binds `source` to one or more element(s). One or more bindings for the same source\n * can be provided.\n * \n * ```js\n * bind(source, \n *  // Binds .name field of source values to textContent of #some-element\n *  { query: `#some-element`, sourceField: `name` },\n *  { query: `section`, }\n * );\n * ```\n * \n * Can update\n * * CSS variables\n * * CSS styles\n * * textContent / innerHTML\n * * HTML DOM attributes and object fields\n * \n * Can use a particular field on source values, or use the whole value. These can\n * pass through `transformValue` or `transform` respectively.\n * \n * Returns a function to unbind from source and optionally remove HTML element\n * ```js\n * const unbind = bind( . . . );\n * unbind();     // Unbind\n * unbind(true); // Unbind and remove HTML element(s)\n * ```\n * @param source \n * @param bindsUnresolvedElements \n * @returns \n */\nexport const bind = <TSource, TDestination>(source: Rx.Reactive<TSource>, ...bindsUnresolvedElements: Array<Rx.DomBindUnresolvedSource<TSource, TDestination>>): PipeDomBinding => {\n  const binds: Array<DomBindResolvedSource<TSource, TDestination>> = bindsUnresolvedElements.map(bind => {\n    if (bind.element && bind.element !== undefined) return bind as DomBindResolvedSource<TSource, TDestination>;\n    if (bind.query) return {\n      ...bind,\n      element: resolveEl<HTMLElement>(bind.query)\n    }\n    throw new Error(`Unable to resolve element. Missing 'element' or 'query' values on bind. ${ JSON.stringify(bind) }`);\n  });\n\n  const bindsResolved = binds.map(bind => ({\n    update: resolveBindUpdater(bind, bind.element),\n    transformer: resolveTransform(bind),\n    sourceField: bind.sourceField\n  }));\n\n  const update = (value: TSource) => {\n    for (const bind of bindsResolved) {\n      if (bind.transformer) {\n        bind.update(bind.transformer(value));\n      } else {\n        const v = (bind.sourceField) ? value[ bind.sourceField ] : value;\n\n        if (typeof v === `object`) {\n          if (bind.sourceField) {\n            bind.update(JSON.stringify(v));\n          } else {\n            bind.update(JSON.stringify(v));\n          }\n        } else bind.update(v as string);\n      }\n    }\n  }\n  const unsub = source.on(message => {\n    if (messageHasValue(message)) {\n      update(message.value);\n    } else if (messageIsSignal(message)) {\n      console.warn(message);\n    }\n  });\n\n  if (hasLast(source)) {\n    update(source.last());\n  }\n\n  return {\n    remove: (removeElements: boolean) => {\n      unsub();\n      if (removeElements) {\n        for (const bind of binds) {\n          bind.element.remove();\n        }\n      }\n    }\n  }\n}\n\n/**\n * Calls `updater` whenever `source` produces a value. Useful when several fields from a value\n * are needed to update an element.\n * ```js\n * bindUpdate(source, `#someEl`, (v, el) => {\n *  el.setAttribute(`width`, v.width);\n *  el.setAttribute(`height`, v.height);\n * });\n * ```\n * \n * Returns a {@link PipeDomBinding} to manage binding\n * ```js\n * const b = bindUpdate(...);\n * b.remove();     // Disconnect binding\n * b.remove(true); // Disconnect binding and remove element\n * b.el;           // HTML element\n * ```\n * @param elOrQuery \n * @param source \n * @param updater \n * @returns \n */\nexport const bindUpdate = <V>(source: Rx.Reactive<V>, elOrQuery: string | HTMLElement, updater: (v: V, el: HTMLElement) => void): PipeDomBinding => {\n  const el = resolveEl(elOrQuery);\n\n  const update = (value: V) => {\n    updater(value, el);\n  }\n\n  const unsub = source.on(message => {\n    if (messageHasValue(message)) {\n      console.log(message);\n      update(message.value);\n    } else {\n      console.warn(message);\n    }\n  });\n\n  if (hasLast(source)) {\n    update(source.last());\n  }\n\n  return {\n    remove: (removeElement: boolean) => {\n      unsub();\n      if (removeElement) {\n        el.remove();\n      }\n    }\n  }\n}\n\n/**\n * Updates a HTML element based on diffs on an object.\n * ```js\n * // Wrap an object\n * const o = Rx.object({ name: `Jane`, ticks: 0 });\n * const b = bindDiffUpdate(`#test`, o, (diffs, el) => {\n *  // el = reference to #test\n * // diff = Array of Changes, \n * //  eg [ { path: `ticks`, value: 797, previous: 0 } ]\n *  for (const diff of diffs) {\n *    if (diff.path === `ticks`) el.textContent = `${diff.previous} -> ${diff.value}`\n *  }\n * })\n * \n * // Eg. update field\n * o.updateField(`ticks`, Math.floor(Math.random()*1000));\n * ```\n * \n * If `initial` is provided as an option, this will be called if `source` has an initial value. Without this, the DOM won't be updated until the first data\n * update happens.\n * ```js\n * bindDiffUpdate(el, source, updater, { \n *  initial: (v, el) => {\n *    el.innerHTML = v.name;\n *  }\n * })\n * ```\n * @param elOrQuery \n * @param source \n * @param updater \n * @param opts \n * @returns \n */\nexport const bindDiffUpdate = <V>(\n  source: Rx.ReactiveDiff<V>,\n  elOrQuery: string | HTMLElement | null,\n  updater: (diffs: Array<Immutable.PathDataChange<any>>, el: HTMLElement) => void,\n  opts: Partial<BindUpdateOpts<V>> = {}\n): PipeDomBinding & { refresh: () => void } => {\n  if (elOrQuery === null) throw new Error(`Param 'elOrQuery' is null`);\n  if (elOrQuery === undefined) throw new Error(`Param 'elOrQuery' is undefined`);\n\n  const el = resolveEl(elOrQuery);\n  //const binds = opts.binds;\n  const update = (value: Array<Immutable.PathDataChange<any>>) => {\n    updater(value, el);\n  }\n\n  const unsub = source.onDiff(value => {\n    update(value);\n  });\n\n  const init = () => {\n    if (Rx.hasLast(source) && opts.initial) opts.initial(source.last(), el);\n  }\n\n  init();\n\n  return {\n    refresh: () => {\n      init();\n    },\n    remove: (removeElement: boolean) => {\n      unsub();\n      if (removeElement) {\n        el.remove();\n      }\n    }\n  }\n}\n\n/**\n * Creates a new HTML element and calls `bindUpdate` so values from `source` can be used\n * to update it.\n * \n * \n * ```js\n * // Creates a span, adding it to <body>\n * const b = createUpdate(dataSource, (value, el) => {\n *  el.width = value.width;\n *  el.height = value.height;\n * }, { \n *  tagName: `SPAN`,\n *  parentEl: document.body\n * })\n * ```\n * @param source \n * @param updater \n * @param options \n * @returns \n */\n// export const createUpdate = <V>(source: Rx.Reactive<V>, updater: (v: V, el: HTMLElement) => void, options: Partial<DomCreateOptions> = {}): PipeDomBinding => {\n//   const tag = options.tagName ?? `DIV`;\n//   const el = document.createElement(tag);\n//   if (options.parentEl) {\n//     const parent = resolveEl(options.parentEl);\n//     parent.append(el);\n//   }\n//   const b = bindUpdate(source, el, updater);\n//   return b;\n// }\n\n\n/**\n * Creates, updates & deletes elements based on pathed values from a reactive.\n * \n * This means that elements are only manipulated if its associated data changes,\n * and elements are not modified if there's no need to.\n * @param source \n * @param options \n */\nexport const elements = <T>(source: Rx.ReactiveDiff<T> | (Rx.ReactiveDiff<T> & Rx.ReactiveInitial<T>), options: Partial<ElementsOptions>) => {\n  const containerEl = options.container ? resolveEl(options.container) : document.body;\n  const defaultTag = options.defaultTag ?? `div`\n  const elByField = new Map<string, HTMLElement>();\n  const binds = new Map<string, ElementBind & {\n    update: ((value: any, el: HTMLElement) => void)\n    path: string\n  }>();\n\n  for (const [ key, value ] of Object.entries(options.binds ?? {})) {\n    const tagName = value.tagName ?? defaultTag;\n    //console.log(`key: ${ key }`);\n    binds.set(key, {\n      ...value,\n      update: resolveBindUpdaterBase(value),\n      transform: resolveTransform(value),\n      tagName,\n      path: key\n    });\n  }\n\n  const findBind = (path: string) => {\n    const bind = getFromKeys(binds, stringSegmentsWholeToEnd(path));\n    if (bind !== undefined) return bind;\n    if (!path.includes(`.`)) return binds.get(`_root`);\n  }\n\n  function* ancestorBinds(path: string) {\n    for (const p of stringSegmentsWholeToFirst(path)) {\n      //console.log(` ancestorBinds path: ${ path } segment: ${ p }`)\n\n      if (binds.has(p)) {\n        //console.log(`  bind: ${ p } found: ${ JSON.stringify(binds.get(p)) }`);\n        yield binds.get(p);\n      } else {\n        //console.log(` bind: ${ p } not found`);\n      }\n    }\n    if (binds.has(`_root`) && path.includes(`.`)) yield binds.get(`_root`);\n  }\n\n\n  const create = (path: string, value: any) => {\n    const rootedPath = getRootedPath(path);\n    console.log(`Rx.Dom.elements.create: ${ path } rooted: ${ rootedPath } value: ${ JSON.stringify(value) }`);\n\n    // Create\n    const bind = findBind(getRootedPath(path));\n    let tagName = defaultTag;\n    if (bind?.tagName) tagName = bind.tagName;\n\n    const el = document.createElement(tagName);\n    el.setAttribute(`data-path`, path);\n    update(path, el, value);\n\n    let parentForEl;\n    for (const b of ancestorBinds(rootedPath)) {\n      //console.log(`  path: ${ rootedPath } b: ${ JSON.stringify(b) }`);\n      if (b?.nestChildren) {\n        // Get root of path\n        const absoluteRoot = beforeMatch(path, `.`);\n        const findBy = b.path.replace(`_root`, absoluteRoot);\n\n        parentForEl = elByField.get(findBy);\n        if (parentForEl === undefined) {\n          //console.log(`    could not find parent. path: ${ path } b.path: ${ b.path } findBy: ${ findBy }`);\n        } else {\n          //console.log(`    found parent`);\n          break;\n        }\n      }\n    }\n    (parentForEl ?? containerEl).append(el);\n    elByField.set(path, el);\n    console.log(`Added el: ${ path }`);\n  }\n\n  const update = (path: string, el: HTMLElement, value: any) => {\n    console.log(`Rx.dom.update path: ${ path } value:`, value);\n\n    const bind = findBind(getRootedPath(path));\n    if (bind === undefined) {\n      //console.log(`Rx.dom.update   no bind for ${ path }`)\n      if (typeof value === `object`) value = JSON.stringify(value);\n      el.textContent = value;\n    } else {\n      //console.log(`Rx.dom.update   got bind! ${ path } `);\n      if (bind.transform) value = bind.transform(value);\n      bind.update(value, el);\n    }\n  }\n\n  const changes = (changes: Array<Immutable.PathDataChange<any> | Immutable.PathData<any>>) => {\n    const queue = new QueueMutable({}, changes);\n    let d = queue.dequeue();\n    const seenPaths = new Set<string>();\n    while (d !== undefined) {\n      //for (const d of changes) {\n      const path = d.path;\n      if (!(`previous` in d) || d.previous === undefined) {\n        // Create\n        console.log(`Rx.Dom.elements.changes no previous. path: ${ path }`);\n\n        create(path, d.value);\n        const subdata = [ ...Immutable.getPathsAndData(d.value, false, Number.MAX_SAFE_INTEGER, path) ];\n        console.log(subdata);\n        for (const dd of subdata) {\n          if (!seenPaths.has(dd.path)) {\n            queue.enqueue(dd);\n            seenPaths.add(dd.path);\n          }\n        }\n      } else if (d.value === undefined) {\n        // Delete\n        const el = elByField.get(path);\n        if (el === undefined) {\n          console.warn(`No element to delete? ${ path } `);\n        } else {\n          console.log(`Rx.Dom.elements.changes delete ${ path }`);\n          el.remove();\n        }\n      } else {\n        // Update\n        const el = elByField.get(path);\n        if (el === undefined) {\n          console.warn(`Rx.Dom.elements.changes No element to update ? ${ path } `);\n          create(path, d.value);\n        } else {\n          //console.log(`Rx.Dom.elements.changes Updating ${ path } `, el);\n          update(path, el, d.value);\n        }\n      }\n      d = queue.dequeue();\n    }\n  }\n\n  /**\n   * Source has changed\n   */\n  source.onDiff(value => {\n    //console.log(`Rx.Dom.elements diff ${ JSON.stringify(value) } `);\n    changes(value);\n  });\n\n  // Source has an initial value, use that\n  if (hasLast(source)) {\n    const last = source.last();\n    // Get data of value as a set of paths and data\n    // but only at first level of depth, because changes() will probe\n    // deeper itself\n    changes([ ...Immutable.getPathsAndData(last as object, false, 1) ]);\n  }\n};\n\n/**\n * Replaces the root portion of `path` with the magic keyword `_root`\n * @param path \n * @returns \n */\nconst getRootedPath = (path: string) => {\n  const after = afterMatch(path, `.`);\n  return after === path ? `_root` : `_root.` + after;\n}\n\nexport function win() {\n  const generateRect = () => ({ width: window.innerWidth, height: window.innerHeight });\n\n  const size = Rx.From.event(window, `resize`, {\n    lazy: `very`,\n    transform: () => generateRect(),\n  });\n  const pointer = Rx.From.event(window, `pointermove`, {\n    lazy: `very`,\n    transform: (args: Event | undefined) => {\n      if (args === undefined) return { x: 0, y: 0 };\n      const pe = args as PointerEvent;\n      return { x: pe.x, y: pe.y }\n    }\n  });\n  const dispose = (reason = `Reactive.win.dispose`) => {\n    size.dispose(reason);\n    pointer.dispose(reason);\n  }\n  return { dispose, size, pointer };\n}\n","import { afterMatch, beforeAfterMatch, beforeMatch } from '../Text.js';\n/**\n * Returns chunks of `source`, broken up by `delimiter` (default '.').\n * \n * Whittles down from whole string to last token.\n * \n * If `delimiter` is not found, no results are yielded.\n * \n * ```js\n * stringSegmentsWholeToEnd(`a.b.c.d`);\n * // Yields:\n * // `a.b.c.d`\n * // `b.c.d`\n * // `c.d`\n * // `d`\n * ```\n * @param source \n * @param delimiter \n */\nexport function* stringSegmentsWholeToEnd(source: string, delimiter = `.`) {\n  while (source.length > 0) {\n    yield source;\n    const trimmed = afterMatch(source, delimiter);\n    if (trimmed === source) {\n      // Delimiter not found\n      break;\n    }\n    source = trimmed;\n  }\n}\n\n/**\n * Returns chunks of `source`, broken up by `delimiter` (default '.').\n * \n * Starts with last token, builds to whole.\n * \n * If `delimiter` is not found, no results are yielded.\n * \n * ````js\n * stringSegmentsLastToWhole(`a.b.c.d`);\n * // Yields:\n * // `d`\n * // `c.d`\n * // `b.c.d`\n * // `a.b.c.d`\n * ```\n * @param source \n * @param delimiter \n */\nexport function* stringSegmentsLastToWhole(source: string, delimiter = `.`) {\n  let accumulator = ``;\n  const orig = source;\n  while (source.length > 0) {\n    const ba = beforeAfterMatch(source, delimiter, { fromEnd: true, ifNoMatch: `original` });\n    if (ba[ 0 ] === ba[ 1 ] && ba[ 1 ] === source) {\n      // Delimiter not found\n      break;\n    }\n    const v = ba[ 1 ] + accumulator;\n    yield v;\n    accumulator = delimiter + v;\n    source = ba[ 0 ];\n  }\n  yield orig;\n}\n\n/**\n * Returns chunks of `source`, broken up by `delimiter` (default '.').\n * \n * We start with the first token and build up until end.\n * \n * If `delimiter` is not found, no results are yielded.\n * \n * ```js\n * stringSegmentsFirstToWhole(`a.b.c.d`);\n * // Yields:\n * // `a`\n * // `a.b`\n * // `a.b.c`\n * // `a.b.c.d`\n * ```\n * @param source \n * @param delimiter \n */\nexport function* stringSegmentsFirstToWhole(source: string, delimiter = `.`) {\n  let accumulator = ``;\n  const orig = source;\n  while (source.length > 0) {\n    const ba = beforeAfterMatch(source, delimiter, { ifNoMatch: `original` });\n    if (ba[ 0 ] === source && ba[ 1 ] === source) break;\n    accumulator += ba[ 0 ];\n    yield accumulator;\n    accumulator += delimiter;\n    source = ba[ 1 ];\n  }\n  yield orig;\n}\n\n/**\n * Returns chunks of `source`, broken up by `delimiter` (default '.').\n * \n * We start with whole string and whittle down to starting token.\n * \n * If `delimiter` is not found, no results are yielded.\n * \n * ```js\n * stringSegmentsWholeToFirst(`a.b.c.d`);\n * // Yields:\n * // `a.b.c.d`\n * // `a.b.c`,\n * // `a.b`,\n * // `a`,\n * ```\n * @param source \n * @param delimiter \n */\nexport function* stringSegmentsWholeToFirst(source: string, delimiter = `.`) {\n  while (source.length > 0) {\n    yield source;\n\n    const b = beforeMatch(source, delimiter, { ifNoMatch: `original`, fromEnd: true });\n    if (b === source) break;\n    source = b;\n  }\n}\n\n\n","export * from './Array.js';\nexport * from './ArrayObject.js';\nexport * from './Boolean.js';\nexport * from './Colour.js';\nexport * from './Derived.js';\nexport * from './Dom.js';\nexport * from './Event.js';\nexport * from './Function.js';\nexport * from './Iterator.js';\nexport * from './Number.js';\nexport * from './Object.js';\nexport * from './ObjectProxy.js';\nexport * from './Observable.js';\nexport * from './String.js';\nexport * from './Types.js';","\nimport { continuously } from \"../../flow/Continuously.js\";\nimport { intervalToMs } from \"../../flow/IntervalType.js\";\nimport { initLazyStream } from \"../InitStream.js\";\nimport type { Reactive, ReactiveFinite, ReactiveInitial } from \"../Types.js\";\nimport type { ArrayOptions } from \"./Types.js\";\n\nexport const of = <V>(source: Array<V> | Iterable<V>, options: Partial<ArrayOptions> = {}) => {\n  if (Array.isArray(source)) {\n    return array(source, options);\n  } else {}\n}\n\n/**\n * Reads the contents of `array` into a Reactive, with optional time interval\n * between values. A copy of the array is used, so changes will not\n * affect the reactive.\n * \n * See also {@link arrayObject} which monitors changes to array values.\n *\n * Reads items from an array with a given interval, by default 5ms\n * \n * ```js\n * const data = [`apples`, `oranges`, `pears` ];\n * const rx = Rx.From.array(data);\n * rx.onValue(v => {\n *  // v will be each fruit in turn\n * })\n * ```\n * \n * Note that there is the possibility of missing values since there is delay between subscribing and when items start getting emitted.\n * If a new subscriber connects to the reactive, they won't get values already emitted.\n * @param sourceArray \n * @param options \n * @returns \n */\nexport const array = <V>(sourceArray: Array<V>, options: Partial<ArrayOptions> = {}): Reactive<V> & ReactiveFinite & ReactiveInitial<V> => {\n  const lazy = options.lazy ?? `initial`;\n  const signal = options.signal;\n  const whenStopped = options.whenStopped ?? `continue`;\n  const debugLifecycle = options.debugLifecycle ?? false;\n  const array = [ ...sourceArray ];\n\n  if (lazy !== `very` && whenStopped === `reset`) throw new Error(`whenStopped:'reset' has no effect with 'lazy:${ lazy }'. Use lazy:'very' instead.`);\n\n  const intervalMs = intervalToMs(options.interval, 5);\n  let index = 0;\n  let lastValue = array[ 0 ];\n\n  const s = initLazyStream<V>({\n    ...options,\n    lazy,\n    onStart() {\n      if (debugLifecycle) console.log(`Rx.readFromArray:onStart`);\n      c.start();\n    },\n    onStop() {\n      if (debugLifecycle) console.log(`Rx.readFromArray:onStop. whenStopped: ${ whenStopped } index: ${ index }`);\n\n      c.cancel();\n      if (whenStopped === `reset`) index = 0;\n    },\n    // onFirstSubscribe() {\n    //   if (debugLifecycle) console.log(`Rx.readFromArray:onFirstSubscribe lazy: ${ lazy } runState: '${ c.runState }'`);\n    //   // Start if in lazy mode and not running\n    //   if (lazy !== `never` && c.runState === `idle`) c.start();\n    // },\n    // onNoSubscribers() {\n    //   if (debugLifecycle) console.log(`Rx.readFromArray:onNoSubscribers lazy: ${ lazy } runState: '${ c.runState }' whenStopped: '${ whenStopped }'`);\n    //   if (lazy === `very`) {\n    //     c.cancel();\n    //     if (whenStopped === `reset`) {\n    //       index = 0;\n    //     }\n    //   }\n    // }\n  });\n\n  const c = continuously(() => {\n    if (signal?.aborted) {\n      s.dispose(`Signalled (${ signal.reason })`);\n      return false; // stop looping\n    }\n    lastValue = array[ index ];\n    index++;\n\n    s.set(lastValue)\n    if (index === array.length) {\n      s.dispose(`Source array complete`);\n      return false; // stop loop\n    }\n  }, intervalMs);\n\n  if (!lazy) c.start();\n\n  return {\n    // eslint-disable-next-line @typescript-eslint/unbound-method\n    dispose: s.dispose,\n    // eslint-disable-next-line @typescript-eslint/unbound-method\n    isDisposed: s.isDisposed,\n    isDone() {\n      return index === array.length;\n    },\n    last() {\n      return lastValue;\n    },\n    // eslint-disable-next-line @typescript-eslint/unbound-method\n    on: s.on,\n    // eslint-disable-next-line @typescript-eslint/unbound-method\n    onValue: s.onValue\n  }\n}","/* eslint-disable @typescript-eslint/unbound-method */\nimport { isEqualValueDefault } from \"../../util/IsEqual.js\";\nimport { initStream } from \"../InitStream.js\";\nimport type { ReactiveInitial, ReactiveNonInitial, ReactiveArray, Reactive } from \"../Types.js\";\nimport type { ArrayObjectOptions } from \"./Types.js\";\nimport { compareArrays, type ChangeRecord } from \"../../data/Compare.js\";\nimport { remove as ArraysRemove } from '../../data/arrays/Remove.js';\nimport { insertAt as ArraysInsertAt } from \"../../data/arrays/InsertAt.js\";\n/**\n * Wraps an array object.\n * \n * It returns an reactive along with some array-ish functions to manipulating it.\n * @param initialValue \n * @param options \n * @returns \n */\nexport function arrayObject<V>(initialValue: ReadonlyArray<V> = [], options: Partial<ArrayObjectOptions<V>> = {}): Reactive<ReadonlyArray<V>> & ReactiveArray<V> & (ReactiveInitial<ReadonlyArray<V>> | ReactiveNonInitial<ReadonlyArray<V>>) {\n  const eq = options.eq ?? isEqualValueDefault;\n  const setEvent = initStream<Array<V>>();\n  //const diffEvent = initStream<Array<Immutable.Change<any>>>();\n  const arrayEvent = initStream<Array<ChangeRecord<number>>>();\n  let value: ReadonlyArray<V> = initialValue;\n  let disposed = false;\n\n  const set = (replacement: Array<V> | ReadonlyArray<V>) => {\n    const diff = compareArrays<V>(value as Array<V>, replacement as Array<V>, eq);\n    //console.log(`Rx.fromArray.set diff`, diff);\n    //if (diff.length === 0) return;\n    //diffEvent.set(diff);\n    value = replacement;\n    setEvent.set([ ...replacement ]);\n  }\n\n  const setAt = (index: number, v: V) => {\n    (value as Array<V>)[ index ] = v;\n    setEvent.set([ ...value ]);\n  }\n\n  const push = (v: V) => {\n    value = [ ...value, v ];\n    setEvent.set([ ...value ]);\n    const cr: ChangeRecord<number> = [ `add`, value.length - 1, v ];\n    arrayEvent.set([ cr ]);\n  }\n\n  const deleteAt = (index: number) => {\n    const valueChanged = ArraysRemove(value, index);\n    if (valueChanged.length === value.length) return; // no change\n    const diff = compareArrays<V>(value as Array<V>, valueChanged, eq);\n    //console.log(diff.summary);\n    value = valueChanged;\n    setEvent.set([ ...value ]);\n    arrayEvent.set(diff.summary);\n  }\n\n  const deleteWhere = (filter: (value: V) => boolean) => {\n    const valueChanged = value.filter(v => !filter(v));\n    const count = value.length - valueChanged.length;\n    const diff = compareArrays<V>(value as Array<V>, valueChanged, eq);\n    value = valueChanged;\n    setEvent.set([ ...value ]);\n    arrayEvent.set(diff.summary);\n    return count;\n  }\n\n  const insertAt = (index: number, v: V) => {\n    const valueChanged = ArraysInsertAt(value, index, v);\n    const diff = compareArrays<V>(value as Array<V>, valueChanged, eq);\n    value = valueChanged;\n    setEvent.set([ ...value ]);\n    arrayEvent.set(diff.summary);\n  }\n\n  // const update = (toMerge: Partial<V>) => {\n  //   // eslint-disable-next-line unicorn/prefer-ternary\n  //   if (value === undefined) {\n  //     value = toMerge as V;\n  //   } else {\n  //     const diff = Immutable.compareData(toMerge, value);\n  //     // console.log(`Rx.fromObject.update value: ${ JSON.stringify(value) }`);\n  //     // console.log(`Rx.fromObject.update  diff: ${ JSON.stringify(diff) }`);\n  //     if (diff.length === 0) return; // No changes\n  //     value = {\n  //       ...value,\n  //       ...toMerge\n  //     }\n  //     diffEvent.set(diff);\n  //   }\n  //   setEvent.set(value);\n  // }\n\n  const dispose = (reason: string) => {\n    if (disposed) return;\n    //diffEvent.dispose(reason);\n    setEvent.dispose(reason);\n    disposed = true;\n  }\n\n  const r = {\n    dispose,\n    isDisposed() {\n      return disposed\n    },\n    last: () => value,\n    on: setEvent.on,\n    onArray: arrayEvent.on,\n    onValue: setEvent.onValue,\n    setAt,\n    push,\n    deleteAt,\n    deleteWhere,\n    insertAt,\n    /**\n     * Set the whole object\n     */\n    set\n  }\n  return r;\n}\n","/* eslint-disable @typescript-eslint/unbound-method */\nimport { initStream } from \"../InitStream.js\";\nimport type { ReactiveWritable, ReactiveInitial, ReactiveNonInitial } from \"../Types.js\";\n\nexport function boolean(initialValue: boolean): ReactiveWritable<boolean> & ReactiveInitial<boolean>;\nexport function boolean(): ReactiveWritable<boolean> & ReactiveNonInitial<boolean>;\nexport function boolean(initialValue?: boolean): ReactiveWritable<boolean> & (ReactiveNonInitial<boolean> | ReactiveInitial<boolean>) {\n  let value = initialValue;\n  const events = initStream<boolean>();\n\n  const set = (v: boolean) => {\n    value = v;\n    events.set(v);\n  }\n\n  return {\n    dispose: events.dispose,\n    isDisposed: events.isDisposed,\n    last: () => value,\n    on: events.on,\n    onValue: events.onValue,\n    set\n  }\n}","/* eslint-disable @typescript-eslint/unbound-method */\nimport type Color from \"colorjs.io\";\nimport * as Colour from '../../visual/Colour.js';\nimport { initStream } from \"../InitStream.js\";\nimport type { ReactiveWritable, ReactiveInitial, ReactiveNonInitial } from \"../Types.js\";\n\nexport type ReactiveColour = ReactiveWritable<Color> & {\n  setHsl: (hsl: Colour.Hsl) => void;\n}\n\nexport function colour(initialValue: Color): ReactiveColour & ReactiveInitial<Color>;\nexport function colour(): ReactiveColour & ReactiveNonInitial<Color>;\nexport function colour(initialValue?: Color): ReactiveColour & (ReactiveNonInitial<Color> | ReactiveInitial<Color>) {\n  let value = initialValue;\n  const events = initStream<Color>();\n\n  const set = (v: Color) => {\n    value = v;\n    events.set(v);\n  }\n\n  return {\n    dispose: events.dispose,\n    isDisposed: events.isDisposed,\n    last: () => value,\n    on: events.on,\n    onValue: events.onValue,\n    set,\n    setHsl: (hsl: Colour.Hsl) => {\n      set(Colour.resolve(hsl))\n    }\n  }\n}\n","import { isEqualValueDefault } from \"../../util/IsEqual.js\";\nimport { cache } from \"../Cache.js\";\nimport { initUpstream } from \"../InitStream.js\";\nimport { type CombineLatestToObject, combineLatestToObject } from \"../ops/CombineLatestToObject.js\";\nimport type { ReactiveNonInitial, ReactiveOrSource, RxValueTypeObject } from \"../Types.js\";\nimport type { DerivedOptions } from \"./Types.js\";\n\nexport function derived<TResult, const T extends Record<string, ReactiveOrSource<any>>>(fn: (combined: RxValueTypeObject<T>) => TResult | undefined, reactiveSources: T, options: Partial<DerivedOptions<TResult, CombineLatestToObject<T>>> = {}): ReactiveNonInitial<TResult> {\n  const ignoreIdentical = options.ignoreIdentical ?? true;\n  const eq = options.eq ?? isEqualValueDefault<TResult>;\n\n  const sources = combineLatestToObject(reactiveSources);\n\n  const handle = (v: RxValueTypeObject<T>) => {\n    const last = output.last();\n    const vv = fn(v);\n    if (vv !== undefined) {\n      if (ignoreIdentical && last !== undefined) {\n        if (eq(vv, last)) return vv;\n      }\n      output.set(vv);\n    }\n\n    return vv;\n  }\n\n  // When the combined stream emits a value, output it\n  const s = initUpstream<RxValueTypeObject<T>, TResult>(sources, {\n    ...options,\n    onValue(v) {\n      handle(v);\n    },\n  });\n  const output = cache(s, fn(sources.last()));\n  return output;\n}\n\n","import type { Passed, Reactive, ReactiveInitial } from \"../Types.js\";\nimport { field } from \"../ops/Field.js\";\nimport { object } from \"./Object.js\";\nimport type { FieldOptions } from \"../ops/Types.js\";\nimport type { EventOptions, EventTriggerOptions } from \"./Types.js\";\nimport { initLazyStream } from \"../InitStream.js\";\nimport { Elapsed } from \"../../flow/index.js\";\n/**\n * Fired when `eventName` fires on `target`. \n * \n * Rather than whole event args being emitted on the stream,\n * it plucks a field from the event args, or if that's missing, from the target.\n * \n * ```js\n * // Emits the the value of a field named 'x'\n * // on the change event args\n * eventField(el, `pointermove`, `x`);\n * ```\n * @param targetOrQuery Event target, HTML element or HTML query (eg '#someId') \n * @param eventName Name of event, eg. 'pointermove'\n * @param fieldName Name of field, eg 'x'\n * @param initialValue Initial data\n * @param options Options for source\n */\nexport function eventField<TFieldValue = string>(targetOrQuery: EventTarget | string | null, eventName: string, fieldName: string, initialValue: TFieldValue, options: Partial<EventOptions & FieldOptions<any, TFieldValue>> = {}) {\n\n  const initial: Record<string, any> = {};\n  initial[ fieldName ] = initialValue;\n\n  const rxField = field<any, TFieldValue>(\n    event(targetOrQuery, eventName, initial, options),\n    fieldName,\n    options\n  );\n  return rxField;\n}\n\n//export function event<V extends Record<string, any>>(target: EventTarget | null | string, name: string, options: EventOptions<V>): ReactiveNonInitial<V> & ReactiveDisposable<V>;\n//export function event<V extends Record<string, any>>(target: EventTarget | null | string, name: string, options?: Optional<EventOptions<V>, `transform`>): ReactiveNonInitial<V> & ReactiveDisposable<V>;\n\n/**\n * Subscribes to an event, emitting data\n * \n * @example Print x,y position of mouse as it moves\n * ```js\n * const r = Rx.From.event(document, `pointermove`);\n * r.onValue(event => {\n *  const { x, y } = event;\n * });\n * ```\n * \n * If `options.lazy` is _true_ (default: _false_), event will only be subscribed to when the stream\n * itself has a subscriber.\n * \n * `options.debugFiring` and `options.debugLifecycle` can be turned on to troubleshoot behaviour\n * of the stream if necessary.\n * @param targetOrQuery Event emitter, HTML element or string. If a string, it will be queryed as a selector.\n * @param name Event name\n * @param options Options\n * @returns \n */\n// eslint-disable-next-line unicorn/prevent-abbreviations\nexport function event<TEventArgs extends Record<string, any>>(targetOrQuery: EventTarget | null | string, name: string, initialValue: TEventArgs | undefined, options: Partial<EventOptions> = {}): ReactiveInitial<TEventArgs> & Reactive<TEventArgs> {\n  let target: EventTarget | null;\n  if (typeof targetOrQuery === `string`) {\n    target = document.querySelector(targetOrQuery);\n    if (target === null) throw new Error(`Target query did not resolve to an element. Query: '${ targetOrQuery }'`)\n  } else {\n    target = targetOrQuery;\n  }\n\n  if (target === null) throw new Error(`Param 'targetOrQuery' is null`);\n\n  const debugLifecycle = options.debugLifecycle ?? false;\n  const debugFiring = options.debugFiring ?? false;\n  const lazy = options.lazy ?? false;\n  if (initialValue === undefined) initialValue = {} as TEventArgs;\n  const rxObject = object<TEventArgs>(initialValue, { deepEntries: true });\n  let eventAdded = false;\n  let disposed = false;\n\n  const callback = (args: any) => {\n    if (debugFiring) console.log(`Reactive.event '${ name }' firing '${ JSON.stringify(args) }`)\n    rxObject.set(args as TEventArgs);\n  }\n\n  const remove = () => {\n    if (!eventAdded) return;\n    eventAdded = false;\n    target.removeEventListener(name, callback);\n    if (debugLifecycle) {\n      console.log(`Rx.From.event remove '${ name }'`);\n    }\n  }\n\n  const add = () => {\n    if (eventAdded) return;\n    eventAdded = true;\n    target.addEventListener(name, callback);\n    if (debugLifecycle) {\n      console.log(`Rx.From.event add '${ name }'`);\n    }\n  }\n\n  if (!lazy) add();\n\n  return {\n    last: () => {\n      if (lazy) add();\n      return rxObject.last();\n    },\n    dispose: (reason: string) => {\n      if (disposed) return;\n      disposed = true;\n      remove();\n      rxObject.dispose(reason);\n    },\n    isDisposed() {\n      return disposed;\n    },\n    on: (handler: (v: Passed<TEventArgs>) => void) => {\n      if (lazy) add();\n      return rxObject.on(handler);\n    },\n    onValue: (handler: (v: TEventArgs) => void) => {\n      if (lazy) add();\n      return rxObject.onValue(handler);\n    }\n  }\n}\n\nexport type TriggerData = {\n  sinceLast: number\n  total: number\n}\n\n/**\n * Emits a value whenever event happens.\n * Data emitted is `{ sinceLast, total }`, where 'sinceLast'\n * is milliseconds since last event and 'total' is total number of \n * times event has been fired.\n * @param targetOrQuery \n * @param name \n * @param options \n * @returns \n */\nexport function eventTrigger(targetOrQuery: EventTarget | null | string, name: string, options: Partial<EventTriggerOptions> = {}): Reactive<TriggerData> {\n  let target: EventTarget | null;\n  if (typeof targetOrQuery === `string`) {\n    target = document.querySelector(targetOrQuery);\n    if (target === null) throw new Error(`Target query did not resolve to an element. Query: '${ targetOrQuery }'`)\n  } else {\n    target = targetOrQuery;\n  }\n\n  if (target === null) throw new Error(`Param 'targetOrQuery' is null`);\n\n  const debugLifecycle = options.debugLifecycle ?? false;\n  const debugFiring = options.debugFiring ?? false;\n  const fireInitial = options.fireInitial ?? false;\n\n  let count = 0;\n  const elapsed = Elapsed.interval();\n\n  const stream = initLazyStream<TriggerData>({\n    lazy: options.lazy ?? `very`,\n    onStart() {\n      target.addEventListener(name, callback);\n      if (debugLifecycle) {\n        console.log(`Rx.From.eventTrigger add '${ name }'`);\n      }\n      if (fireInitial && count === 0) {\n        if (debugLifecycle || debugFiring) console.log(`Rx.From.eventTrigger: firing initial`);\n        callback();\n      }\n    },\n    onStop() {\n      target.removeEventListener(name, callback);\n      if (debugLifecycle) {\n        console.log(`Rx.From.eventTrigger remove '${ name }'`);\n      }\n    },\n  });\n\n  const callback = (_args?: any) => {\n    if (debugFiring) console.log(`Rx.From.eventTrigger '${ name }' triggered'`)\n    stream.set({\n      sinceLast: elapsed(),\n      total: ++count\n    });\n  }\n\n  return stream;\n}","import * as Colour from '../../visual/Colour.js';\nimport type { ReactiveInitial, ReactiveWritable, Reactive } from \"../Types.js\";\nimport { eventTrigger } from \"./Event.js\";\nimport type { DomNumberInputValueOptions, DomValueOptions } from \"./Types.js\";\nimport { resolveEl } from '../../dom/ResolveEl.js';\nimport { transform } from '../ops/Transform.js';\nimport { hasLast } from '../Util.js';\n\n/**\n * Reactive getting/setting of values to a HTML INPUT element.\n * \n * Options:\n * - relative: if _true_, values are 0..1 (default: false)\n * - inverted: if _true_, values are 1..0 (default: false)\n * \n * If element is missing a 'type' attribute, this will be set to 'range'.\n * @param targetOrQuery \n * @param options \n * @returns \n */\nexport function domNumberInputValue(targetOrQuery: HTMLInputElement | string, options: Partial<DomNumberInputValueOptions> = {}): ReactiveInitial<number> & ReactiveWritable<number> {\n  const input = domInputValue(targetOrQuery, options);\n  const el = input.el;\n  const relative = options.relative ?? false;\n  const inverted = options.inverted ?? false;\n\n  const rx = transform(input, v => {\n    return Number.parseFloat(v);\n  });\n\n  if (relative) {\n    //el.setAttribute(`max`, inverted ? \"0\" : \"1\");\n    el.max = inverted ? \"0\" : \"1\";\n    //el.setAttribute(`min`, inverted ? \"1\" : \"0\");\n    el.min = inverted ? \"1\" : \"0\";\n    if (!el.hasAttribute(`step`)) {\n      //el.setAttribute(`step`, \"0.1\");\n      el.step = \"0.1\";\n    }\n  }\n  if (el.getAttribute(`type`) === null) {\n    el.type = `range`;\n  }\n\n  const set = (value: number) => {\n    input.set(value.toString());\n  }\n\n  return {\n    ...rx,\n    last() {\n      return Number.parseFloat(input.last())\n    },\n    set\n  };\n}\n\nexport function domHslInputValue(targetOrQuery: HTMLInputElement | string, options: Partial<DomValueOptions> = {}): ReactiveInitial<Colour.Hsl> & Reactive<Colour.Hsl> & ReactiveWritable<Colour.Hsl> {\n\n  const input = domInputValue(targetOrQuery, {\n    ...options,\n    upstreamFilter(value) {\n      return (typeof value === `object`) ? Colour.toHex(value) : value;\n    },\n  });\n  const rx = transform(input, v => {\n    return Colour.toHsl(v, true);\n  });\n  return {\n    ...rx,\n    last() {\n      return Colour.toHsl(input.last(), true)\n    },\n    set(value) {\n      input.set(Colour.toHex(value));\n    },\n  };\n}\n\n/**\n * A stream of values when the a HTMLInputElement changes. Eg a <input type=\"range\">\n * ```js\n * const r = Rx.From.domInputValue(`#myEl`);\n * r.onValue(value => {\n *  // value will be string\n * });\n * ```\n * \n * Options:\n * * emitInitialValue: If _true_ emits the HTML value of element (default: false)\n * * attributeName: If set, this is the HTML attribute value is set to when writing to stream (default: 'value')\n * * fieldName: If set, this is the DOM object field set when writing to stream (default: 'value')\n * * when: 'changed'|'changing' when values are emitted. (default: 'changed')\n * * fallbackValue:  Fallback value to use if field/attribute cannot be read (default: '')\n * @param targetOrQuery \n * @param options \n * @returns \n */\nexport function domInputValue(targetOrQuery: HTMLInputElement | string, options: Partial<DomValueOptions> = {}): { el: HTMLInputElement } & ReactiveInitial<string> & ReactiveWritable<string> {\n  const target: HTMLInputElement | null = (typeof targetOrQuery === `string` ? document.querySelector(targetOrQuery) : targetOrQuery);\n  if (target === null && typeof targetOrQuery === `string`) throw new Error(`Element query could not be resolved '${ targetOrQuery }'`);\n  if (target === null) throw new Error(`targetOrQuery is null`)\n\n  const el = resolveEl(targetOrQuery);\n  const when = options.when ?? `changed`;\n  const eventName = when === `changed` ? `change` : `input`;\n  const emitInitialValue = options.emitInitialValue ?? false;\n  const fallbackValue = options.fallbackValue ?? ``;\n  const upstreamSource = options.upstreamSource;\n  let upstreamSourceUnsub = () => {}\n\n  let attribName = options.attributeName;\n  let fieldName = options.fieldName;\n\n  if (fieldName === undefined && attribName === undefined) {\n    attribName = fieldName = `value`;\n  }\n\n  const readValue = () => {\n    let value: string | null | undefined;\n    if (attribName) {\n      value = el.getAttribute(attribName);\n    }\n    if (fieldName) {\n      value = (el as any)[ fieldName ]\n    }\n    if (value === undefined || value === null) value = fallbackValue;\n    //console.log(`domInputValue readValue: ${ value }`);\n    return value;\n  }\n\n  const setValue = (value: string) => {\n    if (attribName) {\n      el.setAttribute(attribName, value);\n    }\n    if (fieldName) {\n      (el as any)[ fieldName ] = value;\n    }\n  }\n\n  const setUpstream = (v: any) => {\n    v = options.upstreamFilter ? options.upstreamFilter(v) : v;\n    setValue(v);\n  }\n  if (upstreamSource) {\n    upstreamSourceUnsub = upstreamSource.onValue(setUpstream);\n    if (hasLast(upstreamSource)) {\n      setUpstream(upstreamSource.last());\n    }\n  }\n\n  // Input element change event stream\n  const rxEvents = eventTrigger(el, eventName, {\n    fireInitial: emitInitialValue,\n    debugFiring: options.debugFiring ?? false,\n    debugLifecycle: options.debugLifecycle ?? false,\n  });\n\n  // Transform to get values\n  const rxValues = transform(rxEvents, _trigger => readValue());\n\n  return {\n    ...rxValues,\n    el,\n    last() {\n      return readValue()\n    },\n    set(value) {\n      setValue(value);\n    },\n    dispose(reason) {\n      upstreamSourceUnsub();\n      rxValues.dispose(reason);\n      rxEvents.dispose(reason);\n    },\n  }\n}","/* eslint-disable @typescript-eslint/unbound-method */\nimport { initStream } from \"../InitStream.js\";\nimport type { ReactiveWritable, ReactiveInitial, ReactiveNonInitial } from \"../Types.js\";\n\nexport function number(initialValue: number): ReactiveWritable<number> & ReactiveInitial<number>;\nexport function number(): ReactiveWritable<number> & ReactiveNonInitial<number>;\nexport function number(initialValue?: number): ReactiveWritable<number> & (ReactiveNonInitial<number> | ReactiveInitial<number>) {\n  let value = initialValue;\n  const events = initStream<number>();\n\n  const set = (v: number) => {\n    value = v;\n    events.set(v);\n  }\n\n  return {\n    dispose: events.dispose,\n    isDisposed: events.isDisposed,\n    last: () => value,\n    on: events.on,\n    onValue: events.onValue,\n    set\n  }\n}\n","import { object } from \"./Object.js\";\nimport { symbol, type ReactiveDiff, type ReactiveInitial } from \"../Types.js\";\n\nexport type ReactiveProxied<V> = V & {\n  [ symbol ]: ReactiveDiff<V> & ReactiveInitial<V>\n}\n/**\n * Creates a proxy of `target`, so that regular property setting will be intercepted and output\n * on a {@link Reactive} object as well.\n * \n * ```js\n * const { proxy, rx } = Rx.From.objectProxy({ colour: `red`, x: 10, y: 20 });\n * \n * rx.onValue(v => {\n *  // Get notified when proxy is changed\n * });\n * \n * // Get and set properties as usual\n * console.log(proxy.x);\n * proxy.x = 20; // Triggers Reactive\n * ```\n * \n * Keep in mind that changing `target` directly won't affect the proxied object or Reactive. Thus,\n * only update the proxied object after calling `fromProxy`.\n * \n * The benefit of `objectProxy` instead of {@link Rx.From.object} is because the proxied object can be passed to other code that doesn't need\n * to know anything about Reactive objects.\n * \n * You can assign the return values to more meaningful names using\n * JS syntax.\n * ```js\n * const { proxy:colour, rx:colourRx } = Rx.From.objectProxy({ colour: `red` });\n * ```\n * \n * See also:\n * * {@link objectProxySymbol}: Instead of {proxy,rx} return result, puts the `rx` under a symbol on the proxy.\n * @param target \n * @returns \n */\nexport const objectProxy = <V extends object>(target: V): { proxy: V, rx: ReactiveDiff<V> & ReactiveInitial<V> } => {\n  const rx = object(target);\n\n  const proxy = new Proxy(target, {\n    set(target, p, newValue, _receiver) {\n\n      const isArray = Array.isArray(target);\n      //console.log(`Rx.fromProxy set. Target: ${ JSON.stringify(target) } (${ typeof target } array: ${ Array.isArray(target) }) p: ${ JSON.stringify(p) } (${ typeof p }) newValue: ${ JSON.stringify(newValue) } recv: ${ _receiver }`);\n\n      // Ignore length if target is array\n      if (isArray && p === `length`) return true;\n\n      if (typeof p === `string`) {\n        rx.updateField(p, newValue);\n      }\n\n      // If target is array and field looks like an array index...\n      if (isArray && typeof p === `string`) {\n        const pAsNumber = Number.parseInt(p);\n        if (!Number.isNaN(pAsNumber)) {\n          target[ pAsNumber ] = newValue;\n          return true;\n        }\n      }\n      (target as any)[ p ] = newValue;\n      return true;\n    }\n  });\n  return { proxy, rx }\n}\n\n/**\n * Same as {@link proxy}, but the return value is the proxied object along with \n * the Reactive wrapped as symbol property.\n * \n * ```js\n * const person = Rx.fromProxySymbol({name: `marie` });\n * person.name = `blah`;\n * person[Rx.symbol].on(msg => {\n *  // Value changed...\n * });\n * ```\n * \n * This means of access can be useful as the return result\n * is a bit neater, being a single object instead of two. \n * @param target \n * @returns \n */\nexport const objectProxySymbol = <V extends object>(target: V): ReactiveProxied<V> => {\n  const { proxy, rx } = objectProxy(target);\n\n  const p = proxy as ReactiveProxied<V>;\n  p[ symbol ] = rx;\n  return p;\n}","/* eslint-disable @typescript-eslint/unbound-method */\nimport type { Reactive, ReactiveWritable } from \"../Types.js\";\nimport { messageHasValue } from \"../Util.js\";\nimport { manual } from \"../index.js\";\n\n/**\n * Creates a RxJs style observable\n * ```js\n * const o = observable(stream => {\n *  // Code to run for initialisation when we go from idle to at least one subscriber\n *  // Won't run again for additional subscribers, but WILL run again if we lose\n *  // all subscribers and then get one\n * \n *  // To send a value:\n *  stream.set(someValue);\n * \n *   // Optional: return function to call when all subscribers are removed\n *   return () => {\n *     // Code to run when all subscribers are removed\n *   }\n * });\n * ```\n * \n * For example:\n * ```js\n * const xy = observable<(stream => {\n *  // Send x,y coords from PointerEvent\n *  const send = (event) => {\n *    stream.set({ x: event.x, y: event.y });\n *  }\n *  window.addEventListener(`pointermove`, send);\n *  return () => {\n *    // Unsubscribe\n *    window.removeEventListener(`pointermove`, send);\n *  }\n * });\n * \n * xy.onValue(value => {\n *  console.log(value);\n * });\n * ```\n * @param init \n * @returns \n */\nexport function observable<V>(init: (stream: Reactive<V> & ReactiveWritable<V>) => (() => void) | undefined): Reactive<V> {\n  const ow = observableWritable(init);\n  return {\n    dispose: ow.dispose,\n    isDisposed: ow.isDisposed,\n    on: ow.on,\n    onValue: ow.onValue\n  }\n}\n\n/**\n * As {@link observable}, but returns a Reactive that allows writing\n * @param init \n * @returns \n */\nexport function observableWritable<V>(init: (stream: Reactive<V> & ReactiveWritable<V>) => (() => void) | undefined): ReactiveWritable<V> & Reactive<V> {\n  let onCleanup: (() => void) | undefined = () => {/** no-op */ };\n  const ow = manual<V>({\n    onFirstSubscribe() {\n      onCleanup = init(ow);\n    },\n    onNoSubscribers() {\n      if (onCleanup) onCleanup();\n    },\n  });\n\n  return {\n    ...ow,\n    onValue: (callback: (value: V) => void) => {\n      return ow.on(message => {\n        if (messageHasValue(message)) {\n          callback(message.value);\n        }\n      });\n    }\n  };\n}\n","/* eslint-disable @typescript-eslint/unbound-method */\nimport { initStream } from \"../InitStream.js\";\nimport type { ReactiveWritable, ReactiveInitial, ReactiveNonInitial } from \"../Types.js\";\n\nexport function string(initialValue: string): ReactiveWritable<string> & ReactiveInitial<string>;\nexport function string(): ReactiveWritable<string> & ReactiveNonInitial<string>;\nexport function string(initialValue?: string): ReactiveWritable<string> & (ReactiveNonInitial<string> | ReactiveInitial<string>) {\n  let value = initialValue;\n  const events = initStream<string>();\n\n  const set = (v: string) => {\n    value = v;\n    events.set(v);\n  }\n\n  return {\n    dispose: events.dispose,\n    isDisposed: events.isDisposed,\n    last: () => value,\n    on: events.on,\n    onValue: events.onValue,\n    set\n  }\n}","export type * from './IPriorityQueueMutable.js';\nexport type * from './IQueueImmutable.js';\nexport type * from './IQueueMutable.js';\nexport * from './PriorityMutable.js';\nexport { immutable } from './QueueImmutable.js';\nexport { mutable } from './QueueMutable.js';\nexport type * from './QueueTypes.js';\nexport * from './Responsive.js';","import type { IQueueImmutable } from './IQueueImmutable.js';\nimport { peek, isFull, isEmpty, enqueue, dequeue } from './QueueFns.js';\nimport { type QueueOpts } from './QueueTypes.js';\n\n// -------------------------------\n// Immutable\n// -------------------------------\nexport class QueueImmutable<V> implements IQueueImmutable<V> {\n  readonly opts: QueueOpts<V>;\n  #data: ReadonlyArray<V>;\n\n  /**\n   * Creates an instance of Queue.\n   * @param {QueueOpts} opts Options foor queue\n   * @param {V[]} data Initial data. Index 0 is front of queue\n   */\n  constructor(opts: QueueOpts<V> = {}, data: ReadonlyArray<V> = []) {\n    if (opts === undefined) throw new Error(`opts parameter undefined`);\n\n    this.opts = opts;\n    this.#data = data;\n  }\n\n  forEach(fn: (v: V) => void) {\n    //eslint-disable-next-line functional/no-let\n    for (let index = this.#data.length - 1; index >= 0; index--) {\n      fn(this.#data[ index ]);\n    }\n  }\n\n  forEachFromFront(fn: (v: V) => void) {\n    // From front of queue\n    // eslint-disable-next-line unicorn/no-array-for-each\n    this.#data.forEach(item => { fn(item) }); //(vv) => fn(vv));\n  }\n\n  enqueue(...toAdd: ReadonlyArray<V> | Array<V>): QueueImmutable<V> {\n    return new QueueImmutable<V>(\n      this.opts,\n      enqueue(this.opts, this.#data, ...toAdd)\n    );\n  }\n\n  dequeue(): QueueImmutable<V> {\n    return new QueueImmutable<V>(this.opts, dequeue(this.opts, this.#data));\n  }\n\n  get isEmpty(): boolean {\n    return isEmpty(this.opts, this.#data);\n  }\n\n  get isFull(): boolean {\n    return isFull(this.opts, this.#data);\n  }\n\n  get length(): number {\n    return this.#data.length;\n  }\n\n  get peek(): V | undefined {\n    return peek(this.opts, this.#data);\n  }\n\n  toArray() {\n    return [ ...this.#data ];\n  }\n}\n\n/**\n * Returns an immutable queue. Queues are useful if you want to treat 'older' or 'newer'\n * items differently. _Enqueing_ adds items at the back of the queue, while\n * _dequeing_ removes items from the front (ie. the oldest).\n *\n * ```js\n * import { Queues } from \"https://unpkg.com/ixfx/dist/collections.js\"\n * let q = Queues.immutable();           // Create\n * q = q.enqueue(`a`, `b`);   // Add two strings\n * const front = q.peek();    // `a` is at the front of queue (oldest)\n * q = q.dequeue();           // q now just consists of `b`\n * ```\n * @example Cap size to 5 items, throwing away newest items already in queue.\n * ```js\n * const q = Queues.immutable({capacity: 5, discardPolicy: `newer`});\n * ```\n *\n * @typeParam V - Type of values stored\n * @param options\n * @param startingItems Index 0 is the front of the queue\n * @returns A new queue\n */\nexport const immutable = <V>(\n  options: QueueOpts<V> = {},\n  ...startingItems: ReadonlyArray<V>\n): IQueueImmutable<V> => {\n  options = { ...options }; // Make a copy of options\n  return new QueueImmutable(options, [ ...startingItems ]); // Make a copy of array so it can't be modified\n};\n","import type { IQueueMutableWithEvents, QueueMutableEvents } from \"./IQueueMutable.js\";\nimport * as Rx from '../../rx/index.js';\n\n/**\n * Changes to `queue` are output as a responsive stream.\n * The stream emits the full data of the queue (first item being the head of the queue)\n * whenever there is an enqueue, remove or clear operation.\n * \n * ```js\n * const queue = new QueueMutable();\n * const r = asResponsive(queue);\n * r.onValue(v => {\n *  // v is an array of values\n * });\n * \n * \n * Calling `set()` on the stream enqueues data to the wrapped queue.\n * ```js\n * r.set([ `1, `2` ]); // Enqueues 1, 2\n * ```\n * @param queue \n * @returns \n */\nexport function asResponsive<T>(queue: IQueueMutableWithEvents<T>) {\n  const events = Rx.manual<ReadonlyArray<T>>({\n    onNoSubscribers() {\n      queue.removeEventListener(`removed`, onRemoved);\n      queue.removeEventListener(`enqueue`, onEnqueue);\n    },\n    onFirstSubscribe() {\n      queue.addEventListener(`removed`, onRemoved);\n      queue.addEventListener(`enqueue`, onEnqueue);\n      events.set(queue.toArray());\n    },\n  });\n\n  const onRemoved = (event: QueueMutableEvents<T>[ `removed` ]) => {\n    events.set(event.finalData);\n  }\n  const onEnqueue = (event: QueueMutableEvents<T>[ `enqueue` ]) => {\n    events.set(event.finalData);\n  }\n\n  const set = (data: Array<T>) => {\n    queue.enqueue(...data);\n  }\n\n  return {\n    ...events,\n    set\n  }\n}","import type { Interval } from '../flow/IntervalType.js';\nimport * as Rx from '../rx/index.js';\n\n/**\n * Returns an Reactive for window resize. Default 100ms debounce.\n * @param elapsed\n * @returns\n */\nexport const windowResize = (elapsed?: Interval) => Rx.Ops.debounce<{ innerWidth: number, innerHeight: number }>({ elapsed: elapsed ?? 100 })(Rx.From.event(window, `resize`, { innerWidth: 0, innerHeight: 0 }));\n\n/**\n * Observe when document's class changes\n *\n * ```js\n * const c = themeChangeObservable();\n * c.on(msg => {\n *  // do something...\n * });\n * ```\n * @returns\n */\nexport const themeChange = () => {\n  const m = Rx.From.observable<Array<MutationRecord>>(stream => {\n    const ro = new MutationObserver((entries) => {\n      stream.set(entries);\n    });\n    const opts: MutationObserverInit = {\n      attributeFilter: [ `class` ],\n      attributes: true,\n    };\n    ro.observe(document.documentElement, opts);\n\n    return () => {\n      ro.disconnect();\n    }\n  });\n  return m;\n}\n\n/**\n * Observe when element resizes. Specify `interval` to debounce, uses 100ms by default.\n *\n * ```\n * const o = resizeObservable(myEl, 500);\n * o.subscribe(() => {\n *  // called 500ms after last resize\n * });\n * ```\n * @param elem\n * @param interval Tiemout before event gets triggered\n * @returns\n */\nexport const resizeObservable = (\n  elem: Readonly<Element>,\n  interval?: Interval\n) => {\n  if (elem === null) {\n    throw new Error(`elem parameter is null. Expected element to observe`);\n  }\n  if (elem === undefined) {\n    throw new Error(`elem parameter is undefined. Expected element to observe`);\n  }\n\n  const m = Rx.From.observable<Array<ResizeObserverEntry>>(stream => {\n    const ro = new ResizeObserver((entries) => {\n      stream.set(entries);\n    });\n    ro.observe(elem);\n\n    return () => {\n      ro.unobserve(elem);\n    };\n  });\n  return Rx.Ops.debounce<Array<ResizeObserverEntry>>({ elapsed: interval ?? 100 })(m);\n}\n","import { resizeObservable, windowResize } from \"./DomRx.js\";\nimport type { ElementResizeArgs as ElementResizeArguments } from \"./ElementSizing.js\";\nimport { resolveEl } from \"./ResolveEl.js\";\n\n// eslint-disable-next-line unicorn/prevent-abbreviations\nexport type CanvasResizeArgs = ElementResizeArguments<HTMLCanvasElement> & {\n  readonly ctx: CanvasRenderingContext2D;\n};\n\n\n/**\n * Resizes given canvas to its parent element.\n * To resize canvas to match the viewport, use {@link fullSizeCanvas}.\n *\n * Provide a callback for when resize happens.\n * @param domQueryOrEl Query string or reference to canvas element\n * @param onResized Callback for when resize happens, eg for redrawing canvas\n * @returns Observable\n */\nexport const parentSizeCanvas = (\n  domQueryOrEl: Readonly<string | HTMLCanvasElement>,\n  onResized?: (args: CanvasResizeArgs) => void,\n  timeoutMs = 100\n) => {\n  const el = resolveEl<HTMLCanvasElement>(domQueryOrEl);\n  if (el.nodeName !== `CANVAS`) {\n    throw new Error(\n      `Expected HTML element with node name CANVAS, not ${ el.nodeName }`\n    );\n  }\n  const parent = el.parentElement;\n  if (parent === null) throw new Error(`Element has no parent`);\n\n  const ctx = (el).getContext(`2d`);\n  if (ctx === null) throw new Error(`Could not create drawing context`);\n\n  //const safetyMargin = 4;\n\n  el.style.width = `100%`;\n  el.style.height = `100%`;\n\n\n  const ro = resizeObservable(parent, timeoutMs).onValue(\n    entries => {\n      const entry = entries.find((v) => v.target === parent);\n      if (entry === undefined) return;\n\n      const width = entry.contentRect.width;\n      const height = entry.contentRect.height;\n      //console.log(`contentH: ${e.contentRect.height} current: ${el.getBoundingClientRect().height}`);\n\n      // el.setAttribute(`width`, width-safetyMargin + `px`);\n      // el.setAttribute(`height`, height-safetyMargin + `px`);\n      el.setAttribute(`width`, el.offsetWidth + `px`);\n      el.setAttribute(`height`, el.offsetHeight + `px`);\n\n      if (onResized !== undefined) {\n        const bounds = {\n          min: Math.min(width, height),\n          max: Math.max(width, height),\n          width,\n          height,\n          center: { x: width / 2, y: height / 2 },\n        };\n        onResized({ ctx, el, bounds });\n      }\n    }\n  );\n\n  return ro;\n};\n\n\n/**\n * Resizes given canvas element to match window size.\n * To resize canvas to match its parent, use {@link parentSizeCanvas}.\n *\n * To make the canvas appear propery, it sets the following CSS:\n * ```css\n * {\n *  top: 0;\n *  left: 0;\n *  zIndex: -1;\n *  position: fixed;\n * }\n * ```\n * Pass _true_ for `skipCss` to avoid this.\n *\n * Provide a callback for when resize happens.\n * @param domQueryOrEl Query string or reference to canvas element\n * @param onResized Callback for when resize happens, eg for redrawing canvas\n * @param skipCss if true, style are not added\n * @returns Observable\n */\nexport const fullSizeCanvas = (\n  domQueryOrEl: Readonly<string | HTMLCanvasElement | undefined | null>,\n  onResized?: (args: CanvasResizeArgs) => void,\n  skipCss = false\n) => {\n  if (domQueryOrEl === null || domQueryOrEl === undefined) {\n    throw new Error(`domQueryOrEl is null or undefined`);\n  }\n  const el = resolveEl<HTMLCanvasElement>(domQueryOrEl);\n  if (el.nodeName !== `CANVAS`) {\n    throw new Error(\n      `Expected HTML element with node name CANVAS, not ${ el.nodeName }`\n    );\n  }\n  const ctx = el.getContext(`2d`);\n  if (ctx === null) throw new Error(`Could not create drawing context`);\n\n  const update = () => {\n    const width = window.innerWidth;\n    const height = window.innerHeight;\n\n    el.width = width;\n    el.height = height;\n\n    if (onResized !== undefined) {\n      const bounds = {\n        min: Math.min(width, height),\n        max: Math.max(width, height),\n        width,\n        height,\n        center: { x: width / 2, y: height / 2 },\n      };\n      onResized({ ctx, el, bounds });\n    }\n  };\n\n  // Setup\n  if (!skipCss) {\n    el.style.top = `0`;\n    el.style.left = `0`;\n    el.style.zIndex = `-100`;\n    el.style.position = `fixed`;\n  }\n\n  const r = windowResize();\n  r.onValue(update);\n\n  update();\n  return r;\n};\n","import type { Point, Point3d } from \"./PointType.js\";\nimport { throwNumberTest } from '../../util/GuardNumbers.js';\n\n/**\n * Returns true if p.x and p.y === null\n * @param p\n * @returns\n */\nexport const isNull = (p: Point) => p.x === null && p.y === null;\n\n/***\n * Returns true if p.x or p.y isNaN\n */\nexport const isNaN = (p: Point) => Number.isNaN(p.x) || Number.isNaN(p.y);\n\n\n/**\n * Throws an error if point is invalid\n * @param p\n * @param name\n */\nexport function guard(p: Point, name = `Point`) {\n  if (p === undefined) {\n    throw new Error(\n      `'${ name }' is undefined. Expected {x,y} got ${ JSON.stringify(p) }`\n    );\n  }\n  if (p === null) {\n    throw new Error(\n      `'${ name }' is null. Expected {x,y} got ${ JSON.stringify(p) }`\n    );\n  }\n  if (p.x === undefined) {\n    throw new Error(\n      `'${ name }.x' is undefined. Expected {x,y} got ${ JSON.stringify(p) }`\n    );\n  }\n  if (p.y === undefined) {\n    throw new Error(\n      `'${ name }.y' is undefined. Expected {x,y} got ${ JSON.stringify(p) }`\n    );\n  }\n  if (typeof p.x !== `number`) {\n    // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n    throw new TypeError(`'${ name }.x' must be a number. Got ${ p.x }`);\n  }\n  if (typeof p.y !== `number`) {\n    // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n    throw new TypeError(`'${ name }.y' must be a number. Got ${ p.y }`);\n  }\n\n  if (p.x === null) throw new Error(`'${ name }.x' is null`);\n  if (p.y === null) throw new Error(`'${ name }.y' is null`);\n\n  if (Number.isNaN(p.x)) throw new Error(`'${ name }.x' is NaN`);\n  if (Number.isNaN(p.y)) throw new Error(`'${ name }.y' is NaN`);\n}\n\n/**\n * Throws if parameter is not a valid point, or either x or y is 0\n * @param pt\n * @returns\n */\nexport const guardNonZeroPoint = (pt: Point | Point3d, name = `pt`) => {\n  guard(pt, name);\n  throwNumberTest(pt.x, `nonZero`, `${ name }.x`);\n  throwNumberTest(pt.y, `nonZero`, `${ name }.y`);\n  if (typeof pt.z !== `undefined`) {\n    throwNumberTest(pt.z, `nonZero`, `${ name }.z`);\n  }\n\n  return true;\n};\n\n// eslint-disable-next-line @typescript-eslint/no-redundant-type-constituents\nexport function isPoint(p: number | unknown): p is Point {\n  if (p === undefined) return false;\n  if (p === null) return false;\n  if ((p as Point).x === undefined) return false;\n  if ((p as Point).y === undefined) return false;\n  return true;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-redundant-type-constituents\nexport const isPoint3d = (p: Point | unknown): p is Point3d => {\n  if (p === undefined) return false;\n  if (p === null) return false;\n  if ((p as Point3d).x === undefined) return false;\n  if ((p as Point3d).y === undefined) return false;\n  if ((p as Point3d).z === undefined) return false;\n  return true;\n};\n\n/**\n * Returns true if both x and y is 0.\n * Use `Points.Empty` to return an empty point.\n * @param p\n * @returns\n */\nexport const isEmpty = (p: Point) => p.x === 0 && p.y === 0;\n\n/**\n * Returns true if point is a placeholder, where both x and y\n * are `NaN`.\n *\n * Use Points.Placeholder to return a placeholder point.\n * @param p\n * @returns\n */\nexport const isPlaceholder = (p: Point) =>\n  Number.isNaN(p.x) && Number.isNaN(p.y);\n","import type { Point } from \"../point/PointType.js\";\nimport type { Line } from \"./LineType.js\";\nimport { guard as guardPoint } from '../point/Guard.js';\n\n/**\n * Returns a line from two points\n * \n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * // Line from 0,1 to 10,15\n * const line = Lines.fromPoints( { x:0, y:1 }, { x:10, y:15 });\n * // line is: { a: { x: 0, y: 1}, b: { x: 10, y: 15 } };\n * ```\n * @param a Start point\n * @param b End point\n * @returns \n */\nexport const fromPoints = (a: Point, b: Point): Line => {\n  guardPoint(a, `a`);\n  guardPoint(b, `b`);\n  a = Object.freeze({ ...a });\n  b = Object.freeze({ ...b });\n  return Object.freeze({\n    a: a,\n    b: b\n  });\n};\n\n","import { fromPoints } from \"./FromPoints.js\";\nimport type { Line } from \"./LineType.js\";\n\n/**\n * Returns a line from a basis of coordinates (x1, y1, x2, y2)\n * \n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * // Line from 0,1 -> 10,15\n * Lines.fromNumbers(0, 1, 10, 15);\n * ```\n * @param x1 \n * @param y1 \n * @param x2 \n * @param y2 \n * @returns \n */\nexport const fromNumbers = (x1: number, y1: number, x2: number, y2: number): Line => {\n  if (Number.isNaN(x1)) throw new Error(`x1 is NaN`);\n  if (Number.isNaN(x2)) throw new Error(`x2 is NaN`);\n  if (Number.isNaN(y1)) throw new Error(`y1 is NaN`);\n  if (Number.isNaN(y2)) throw new Error(`y2 is NaN`);\n\n  const a = { x: x1, y: y1 };\n  const b = { x: x2, y: y2 };\n  return fromPoints(a, b);\n};","/* eslint-disable unicorn/no-null */\n\nimport { markerPrebuilt } from './SvgMarkers.js';\nimport * as Elements from './SvgElements.js';\nimport type { Point } from '../geometry/point/PointType.js';\nimport type { Line } from '../geometry/line/LineType.js';\nimport type { CirclePositioned } from '../geometry/circle/CircleType.js';\nimport type { Rect } from '../geometry/rect/index.js';\n\nexport type MarkerOpts = StrokeOpts &\n  DrawingOpts & {\n    readonly id: string;\n    readonly markerWidth?: number;\n    readonly markerHeight?: number;\n    readonly orient?: string;\n    readonly viewBox?: string;\n    readonly refX?: number;\n    readonly refY?: number;\n  };\n\n/**\n * Drawing options\n */\nexport type DrawingOpts = {\n  /**\n   * Style for fill. Eg `black`.\n   * @see [fill](https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/fill)\n   */\n  readonly fillStyle?: string;\n\n  /**\n   * Opacity (0..1)\n   */\n  readonly opacity?: number;\n  /**\n   * If true, debug helpers are drawn\n   */\n  readonly debug?: boolean;\n};\n\nexport type StrokeOpts = {\n  /**\n   * Line cap\n   * @see [stroke-linecap](https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/stroke-linecap)\n   */\n  readonly strokeLineCap?: `butt` | `round` | `square`;\n  /**\n   * Width of stroke, eg `2`\n   * @see [stroke-width](https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/stroke-width)\n   */\n  readonly strokeWidth?: number;\n  /**\n   * Stroke dash pattern, eg `5`\n   * @see [stroke-dasharray](https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/stroke-dasharray)\n   */\n  readonly strokeDash?: string;\n  /**\n   * Style for lines. Eg `white`.\n   * @see [stroke](https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/stroke)\n   */\n  readonly strokeStyle?: string;\n};\n\n/**\n * Line drawing options\n */\nexport type LineDrawingOpts = DrawingOpts & MarkerDrawingOpts & StrokeOpts;\n\nexport type CircleDrawingOpts = DrawingOpts & StrokeOpts & MarkerDrawingOpts;\n\nexport type PathDrawingOpts = DrawingOpts & StrokeOpts & MarkerDrawingOpts;\n\nexport type MarkerDrawingOpts = {\n  readonly markerEnd?: MarkerOpts;\n  readonly markerStart?: MarkerOpts;\n  readonly markerMid?: MarkerOpts;\n};\n\n/**\n * Text drawing options\n */\nexport type TextDrawingOpts = StrokeOpts &\n  DrawingOpts & {\n    readonly anchor?: `start` | `middle` | `end`;\n    readonly align?:\n    | `text-bottom`\n    | `text-top`\n    | `baseline`\n    | `top`\n    | `hanging`\n    | `middle`;\n    readonly userSelect?: boolean;\n  };\n\n/**\n * Text path drawing options\n */\nexport type TextPathDrawingOpts = TextDrawingOpts & {\n  readonly method?: `align` | `stretch`;\n  readonly side?: `left` | `right`;\n  readonly spacing?: `auto` | `exact`;\n  readonly startOffset?: number;\n  readonly textLength?: number;\n};\n\n/**\n * Creates and appends a SVG element.\n *\n * ```js\n * // Create a circle\n * const circleEl = createOrResolve(parentEl, `SVGCircleElement`);\n * ```\n *\n * If `queryOrExisting` is specified, it is used as a query to find an existing element. If\n * query starts with `#`, this will be set as the element id, if created.\n *\n * ```js\n * // Creates an element with id 'myCircle' if it doesn't exist\n * const circleEl = createOrResolve(parentEl, `SVGCircleElement`, `#myCircle`);\n * ```\n * @param parent Parent element\n * @param type Type of SVG element\n * @param queryOrExisting Query, eg `#id`\n * @returns\n */\nexport const createOrResolve = <V extends SVGElement>(\n  parent: SVGElement,\n  type: string,\n  queryOrExisting?: string | V,\n  suffix?: string\n): V => {\n  let existing = null;\n  if (queryOrExisting !== undefined) {\n    existing = typeof queryOrExisting === `string` ? parent.querySelector(queryOrExisting) : queryOrExisting;\n  }\n  if (existing === null) {\n    const p = document.createElementNS(`http://www.w3.org/2000/svg`, type) as V;\n    parent.append(p);\n    if (queryOrExisting && typeof queryOrExisting === `string` &&\n      queryOrExisting.startsWith(`#`)) {\n      p.id = suffix !== undefined && !queryOrExisting.endsWith(suffix) ? queryOrExisting.slice(1) + suffix : queryOrExisting.slice(1);\n    }\n    return p;\n  }\n  return existing as V;\n};\n\nexport const remove = <V extends SVGElement>(\n  parent: SVGElement,\n  queryOrExisting: string | V\n) => {\n  if (typeof queryOrExisting === `string`) {\n    const elem = parent.querySelector(queryOrExisting);\n    if (elem === null) return;\n    elem.remove();\n  } else {\n    queryOrExisting.remove();\n  }\n};\n\nexport const clear = (parent: SVGElement) => {\n  let c = parent.lastElementChild;\n  while (c) {\n    c.remove();\n    c = parent.lastElementChild;\n  }\n};\n\n/**\n * Creates an element of `type` and with `id` (if specified)\n * @param type Element type, eg `circle`\n * @param id Optional id to assign to element\n * @returns Element\n */\nexport const createEl = <V extends SVGElement>(\n  type: string,\n  id?: string\n): V => {\n  const m = document.createElementNS(`http://www.w3.org/2000/svg`, type) as V;\n  if (id) {\n    m.id = id;\n  }\n  return m;\n};\n\n/**\n * Applies path drawing options to given element\n * Applies: markerEnd, markerStart, markerMid\n * @param elem Element (presumed path)\n * @param opts Options\n */\nexport const applyPathOpts = (elem: SVGElement, opts: PathDrawingOpts) => {\n  if (opts.markerEnd) {\n    elem.setAttribute(\n      `marker-end`,\n      markerPrebuilt(elem, opts.markerEnd, opts as DrawingOpts)\n    );\n  }\n  if (opts.markerStart) {\n    elem.setAttribute(\n      `marker-start`,\n      markerPrebuilt(elem, opts.markerStart, opts as DrawingOpts)\n    );\n  }\n  if (opts.markerMid) {\n    elem.setAttribute(\n      `marker-mid`,\n      markerPrebuilt(elem, opts.markerMid, opts as DrawingOpts)\n    );\n  }\n};\n\n/**\n * Applies drawing options to given SVG element.\n * Applies: fillStyle\n * @param elem Element\n * @param opts Drawing options\n */\nexport const applyOpts = (elem: SVGElement, opts: DrawingOpts) => {\n  if (opts.fillStyle) elem.setAttributeNS(null, `fill`, opts.fillStyle);\n  if (opts.opacity) {\n    elem.setAttributeNS(null, `opacity`, opts.opacity.toString());\n  }\n};\n\n/**\n * Applies drawing options to given SVG element.\n * Applies: strokeStyle, strokeWidth, strokeDash, strokeLineCap\n * @param elem Element\n * @param opts\n */\nexport const applyStrokeOpts = (elem: SVGElement, opts: StrokeOpts) => {\n  if (opts.strokeStyle) elem.setAttributeNS(null, `stroke`, opts.strokeStyle);\n  if (opts.strokeWidth) {\n    elem.setAttributeNS(null, `stroke-width`, opts.strokeWidth.toString());\n  }\n  if (opts.strokeDash) elem.setAttribute(`stroke-dasharray`, opts.strokeDash);\n  if (opts.strokeLineCap) {\n    elem.setAttribute(`stroke-linecap`, opts.strokeLineCap);\n  }\n};\n\n/**\n * Helper to make SVG elements with a common parent.\n *\n * Create with {@link makeHelper}.\n */\nexport type SvgHelper = {\n  remove(queryOrExisting: string | SVGElement): void;\n  /**\n   * Creates a text element\n   * @param text Text\n   * @param pos Position\n   * @param opts Drawing options\n   * @param queryOrExisting DOM query to look up existing element, or the element instance\n   */\n  text(\n    text: string,\n    pos: Point,\n    opts?: TextDrawingOpts,\n    queryOrExisting?: string | SVGTextElement\n  ): SVGTextElement;\n  /**\n   * Creates text on a path\n   * @param pathReference Reference to path element\n   * @param text Text\n   * @param opts Drawing options\n   * @param textQueryOrExisting DOM query to look up existing element, or the element instance\n   * @param pathQueryOrExisting DOM query to look up existing element, or the element instance\n   */\n  textPath(\n    pathReference: string,\n    text: string,\n    opts?: TextDrawingOpts,\n    textQueryOrExisting?: string | SVGTextElement,\n    pathQueryOrExisting?: string | SVGTextPathElement\n  ): SVGTextPathElement;\n  /**\n   * Creates a line\n   * @param line Line\n   * @param opts Drawing options\n   * @param queryOrExisting DOM query to look up existing element, or the element instance\n   */\n  line(\n    line: Line,\n    opts?: LineDrawingOpts,\n    queryOrExisting?: string | SVGLineElement\n  ): SVGLineElement;\n  /**\n   * Creates a circle\n   * @param circle Circle\n   * @param opts Drawing options\n   * @param queryOrExisting DOM query to look up existing element, or the element instance\n   */\n  circle(\n    circle: CirclePositioned,\n    opts?: CircleDrawingOpts,\n    queryOrExisting?: string | SVGCircleElement\n  ): SVGCircleElement;\n  /**\n   * Creates a path\n   * @param svgString Path description, or empty string\n   * @param opts Drawing options\n   * @param queryOrExisting DOM query to look up existing element, or the element instance\n   */\n  path(\n    svgString: string | ReadonlyArray<string>,\n    opts?: PathDrawingOpts,\n    queryOrExisting?: string | SVGPathElement\n  ): SVGPathElement;\n  /**\n   * Creates a grid of horizontal and vertical lines inside of a group\n   * @param center Grid origin\n   * @param spacing Cell size\n   * @param width Width of grid\n   * @param height Height of grid\n   * @param opts Drawing options\n   */\n  grid(\n    center: Point,\n    spacing: number,\n    width: number,\n    height: number,\n    opts?: LineDrawingOpts\n  ): SVGGElement;\n  /**\n   * Returns an element if it exists in parent\n   * @param selectors Eg `#path`\n   */\n  query<V extends SVGElement>(selectors: string): V | null;\n  /**\n   * Gets/sets the width of the parent\n   */\n  get width(): number;\n  set width(width: number);\n  /**\n   * Gets the parent\n   */\n  get parent(): SVGElement;\n  /**\n   * Gets/sets the height of the parent\n   */\n  get height(): number;\n  set height(height: number);\n  /**\n   * Deletes all child elements\n   */\n  clear(): void;\n};\n\n/**\n * Get the bounds of an SVG element (determined by its width/height attribs)\n * @param svg\n * @returns\n */\nexport const getBounds = (svg: SVGElement): Rect => {\n  const w = svg.getAttributeNS(null, `width`);\n  const width = w === null ? 0 : Number.parseFloat(w);\n  const h = svg.getAttributeNS(null, `height`);\n  const height = h === null ? 0 : Number.parseFloat(h);\n  return { width, height };\n};\n\n/**\n * Set the bounds of an element, using its width/height attribs.\n * @param svg\n * @param bounds\n */\nexport const setBounds = (svg: SVGElement, bounds: Rect): void => {\n  svg.setAttributeNS(null, `width`, bounds.width.toString());\n  svg.setAttributeNS(null, `height`, bounds.height.toString());\n};\n\n/**\n * Creates a {@link SvgHelper} for the creating and management of SVG elements.\n * @param parent\n * @param parentOpts\n * @returns\n */\nexport const makeHelper = (\n  parent: SVGElement,\n  parentOpts?: DrawingOpts & StrokeOpts\n): SvgHelper => {\n  if (parentOpts) {\n    applyOpts(parent, parentOpts);\n    applyStrokeOpts(parent, parentOpts);\n  }\n\n  const o: SvgHelper = {\n    remove: (queryOrExisting: string | SVGElement) => { remove(parent, queryOrExisting); },\n    text: (\n      text: string,\n      pos: Point,\n      opts?: TextDrawingOpts,\n      queryOrExisting?: string | SVGTextElement\n    ) => Elements.text(text, parent, pos, opts, queryOrExisting),\n    textPath: (\n      pathReference: string,\n      text: string,\n      opts?: TextDrawingOpts,\n      textQueryOrExisting?: string | SVGTextElement,\n      pathQueryOrExisting?: string | SVGTextPathElement\n    ) => Elements.textPath(pathReference, text, parent, opts, textQueryOrExisting, pathQueryOrExisting),\n    line: (\n      line: Line,\n      opts?: LineDrawingOpts,\n      queryOrExisting?: string | SVGLineElement\n    ) => Elements.line(line, parent, opts, queryOrExisting),\n    circle: (\n      circle: CirclePositioned,\n      opts?: CircleDrawingOpts,\n      queryOrExisting?: string | SVGCircleElement\n    ) => Elements.circle(circle, parent, opts, queryOrExisting),\n    path: (\n      svgString: string | ReadonlyArray<string>,\n      opts?: PathDrawingOpts,\n      queryOrExisting?: string | SVGPathElement\n    ) => Elements.path(svgString, parent, opts, queryOrExisting),\n    grid: (\n      center: Point,\n      spacing: number,\n      width: number,\n      height: number,\n      opts?: LineDrawingOpts\n    ) => Elements.grid(parent, center, spacing, width, height, opts),\n    query: <V extends SVGElement>(selectors: string): V | null =>\n      parent.querySelector(selectors),\n    get width(): number {\n      const w = parent.getAttributeNS(null, `width`);\n      if (w === null) return 0;\n      return Number.parseFloat(w);\n    },\n    set width(width: number) {\n      parent.setAttributeNS(null, `width`, width.toString());\n    },\n    get parent(): SVGElement {\n      return parent;\n    },\n    get height(): number {\n      const w = parent.getAttributeNS(null, `height`);\n      if (w === null) return 0;\n      return Number.parseFloat(w);\n    },\n    set height(height: number) {\n      parent.setAttributeNS(null, `height`, height.toString());\n    },\n    clear: () => {\n      while (parent.firstChild) {\n        (parent.lastChild as HTMLElement).remove();\n      }\n    },\n  };\n  return o;\n};\n\nexport * as Elements from './SvgElements.js';","import {\n  createOrResolve,\n  type MarkerOpts,\n  createEl,\n  type DrawingOpts,\n  applyOpts,\n} from './Svg.js';\n\nexport const createMarker = (\n  id: string,\n  opts: MarkerOpts,\n  childCreator?: () => SVGElement\n): SVGMarkerElement => {\n  const m = createEl<SVGMarkerElement>(`marker`, id);\n\n  if (opts.markerWidth) {\n    m.setAttribute(`markerWidth`, opts.markerWidth?.toString());\n  }\n  if (opts.markerHeight) {\n    m.setAttribute(`markerHeight`, opts.markerHeight?.toString());\n  }\n  if (opts.orient) m.setAttribute(`orient`, opts.orient.toString());\n  else m.setAttribute(`orient`, `auto-start-reverse`);\n\n  if (opts.viewBox) m.setAttribute(`viewBox`, opts.viewBox.toString());\n  if (opts.refX) m.setAttribute(`refX`, opts.refX.toString());\n  if (opts.refY) m.setAttribute(`refY`, opts.refY.toString());\n\n  if (childCreator) {\n    const c = childCreator();\n    m.appendChild(c);\n  }\n  return m;\n};\n\nexport const markerPrebuilt = (\n  elem: SVGElement | null,\n  opts: MarkerOpts,\n  _context: DrawingOpts\n): string => {\n  if (elem === null) return `(elem null)`;\n\n  const parent = elem.ownerSVGElement;\n  if (parent === null) throw new Error(`parent for elem is null`);\n  const defsEl = createOrResolve<SVGDefsElement>(parent, `defs`, `defs`);\n\n  //eslint-disable-next-line functional/no-let\n  let defEl = defsEl.querySelector(`#${opts.id}`) as SVGElement | null;\n\n  if (defEl !== null) {\n    return `url(#${opts.id})`;\n  }\n\n  if (opts.id === `triangle`) {\n    opts = { ...opts, strokeStyle: `transparent` };\n    if (!opts.markerHeight) opts = { ...opts, markerHeight: 6 };\n    if (!opts.markerWidth) opts = { ...opts, markerWidth: 6 };\n    if (!opts.refX) opts = { ...opts, refX: opts.markerWidth };\n    if (!opts.refY) opts = { ...opts, refY: opts.markerHeight };\n    if (!opts.fillStyle || opts.fillStyle === `none`) {\n      opts = { ...opts, fillStyle: `black` };\n    }\n    if (!opts.viewBox) opts = { ...opts, viewBox: `0 0 10 10` };\n\n    defEl = createMarker(opts.id, opts, () => {\n      const tri = createEl<SVGPathElement>(`path`);\n      tri.setAttribute(`d`, `M 0 0 L 10 5 L 0 10 z`);\n      if (opts) applyOpts(tri, opts);\n      return tri;\n    });\n  } else throw new Error(`Do not know how to make ${opts.id}`);\n\n  //eslint-disable-next-line functional/immutable-data\n  defEl.id = opts.id;\n  defsEl.appendChild(defEl);\n\n  return `url(#${opts.id})`;\n};\n","/* eslint-disable unicorn/no-null */\nimport type { CirclePositioned } from '../geometry/circle/CircleType.js';\nimport type { Point } from '../geometry/point/PointType.js';\nimport type { Line } from '../geometry/line/LineType.js';\n//import * as Lines from '../geometry/line/index.js';\nimport { fromNumbers as LinesFromNumbers } from '../geometry/line/FromNumbers.js';\nimport * as Svg from './Svg.js';\nimport { getCssVariable } from './Colour.js';\n//import {Palette} from \".\";\n\nconst numberOrPercentage = (v: number): string => {\n  if (v >= 0 && v <= 1) return `${ v * 100 }%`;\n  return v.toString();\n};\n\n/**\n * Creates and adds an SVG path element\n * @example\n * ```js\n * const paths = [\n *  `M300,200`,\n *  `a25,25 -30 0,1 50, -25 l 50,-25`\n * ]\n * const pathEl = path(paths, parentEl);\n * ```\n * @param svgOrArray Path syntax, or array of paths. Can be empty if path data will be added later\n * @param parent SVG parent element\n * @param opts Options Drawing options\n * @returns\n */\nexport const path = (\n  svgOrArray: string | ReadonlyArray<string>,\n  parent: SVGElement,\n  opts?: Svg.PathDrawingOpts,\n  queryOrExisting?: string | SVGPathElement\n): SVGPathElement => {\n  const elem = Svg.createOrResolve<SVGPathElement>(\n    parent,\n    `path`,\n    queryOrExisting\n  );\n  const svg =\n    typeof svgOrArray === `string` ? svgOrArray : svgOrArray.join(`\\n`);\n\n  elem.setAttributeNS(null, `d`, svg);\n  parent.append(elem);\n  return pathUpdate(elem, opts);\n};\n\nexport const pathUpdate = (\n  elem: SVGPathElement,\n  opts?: Svg.PathDrawingOpts\n) => {\n  if (opts) Svg.applyOpts(elem, opts);\n  if (opts) Svg.applyStrokeOpts(elem, opts);\n  return elem;\n};\n\n/**\n * Updates an existing `SVGCircleElement` with potentially updated circle data and drawing options\n * @param elem Element\n * @param circle Circle\n * @param opts Drawing options\n * @returns SVGCircleElement\n */\nexport const circleUpdate = (\n  elem: SVGCircleElement,\n  circle: CirclePositioned,\n  opts?: Svg.CircleDrawingOpts\n) => {\n  elem.setAttributeNS(null, `cx`, circle.x.toString());\n  elem.setAttributeNS(null, `cy`, circle.y.toString());\n  elem.setAttributeNS(null, `r`, circle.radius.toString());\n  if (opts) Svg.applyOpts(elem, opts);\n  if (opts) Svg.applyStrokeOpts(elem, opts);\n\n  return elem;\n};\n\n/**\n * Creates or reuses a `SVGCircleElement`.\n *\n * To update an existing element, use `circleUpdate`\n * @param circle\n * @param parent\n * @param opts\n * @param queryOrExisting\n * @returns\n */\nexport const circle = (\n  circle: CirclePositioned,\n  parent: SVGElement,\n  opts?: Svg.CircleDrawingOpts,\n  queryOrExisting?: string | SVGCircleElement\n): SVGCircleElement => {\n  const p = Svg.createOrResolve<SVGCircleElement>(\n    parent,\n    `circle`,\n    queryOrExisting\n  );\n  return circleUpdate(p, circle, opts);\n};\n\n/**\n * Creates or resuses a `SVGGElement` (group)\n *\n * To update an existing elemnet, use `groupUpdate`\n * @param children\n * @param parent\n * @param queryOrExisting\n * @returns\n */\nexport const group = (\n  children: ReadonlyArray<SVGElement>,\n  parent: SVGElement,\n  queryOrExisting?: string | SVGGElement\n): SVGGElement => {\n  const p = Svg.createOrResolve<SVGGElement>(parent, `g`, queryOrExisting);\n  return groupUpdate(p, children);\n};\n\nexport const groupUpdate = (\n  elem: SVGGElement,\n  children: ReadonlyArray<SVGElement>\n) => {\n  for (const c of children) {\n    if (c.parentNode !== elem) {\n      elem.append(c);\n    }\n  }\n\n  return elem;\n};\n\n/**\n * Creates or reuses a SVGLineElement.\n *\n * @param line\n * @param parent\n * @param opts\n * @param queryOrExisting\n * @returns\n */\nexport const line = (\n  line: Line,\n  parent: SVGElement,\n  opts?: Svg.LineDrawingOpts,\n  queryOrExisting?: string | SVGLineElement\n): SVGLineElement => {\n  const lineEl = Svg.createOrResolve<SVGLineElement>(\n    parent,\n    `line`,\n    queryOrExisting\n  );\n  return lineUpdate(lineEl, line, opts);\n};\n\n/**\n * Updates a SVGLineElement instance with potentially changed line and drawing data\n * @param lineEl\n * @param line\n * @param opts\n * @returns\n */\nexport const lineUpdate = (\n  lineEl: SVGLineElement,\n  line: Line,\n  opts?: Svg.LineDrawingOpts\n) => {\n  lineEl.setAttributeNS(null, `x1`, line.a.x.toString());\n  lineEl.setAttributeNS(null, `y1`, line.a.y.toString());\n  lineEl.setAttributeNS(null, `x2`, line.b.x.toString());\n  lineEl.setAttributeNS(null, `y2`, line.b.y.toString());\n  if (opts) Svg.applyOpts(lineEl, opts);\n  if (opts) Svg.applyPathOpts(lineEl, opts);\n  if (opts) Svg.applyStrokeOpts(lineEl, opts);\n  return lineEl;\n};\n\n/**\n * Updates an existing SVGTextPathElement instance with text and drawing options\n * @param el\n * @param text\n * @param opts\n * @returns\n */\nexport const textPathUpdate = (\n  el: SVGTextPathElement,\n  text?: string,\n  opts?: Svg.TextPathDrawingOpts\n) => {\n  if (opts?.method) el.setAttributeNS(null, `method`, opts.method);\n  if (opts?.side) el.setAttributeNS(null, `side`, opts.side);\n  if (opts?.spacing) el.setAttributeNS(null, `spacing`, opts.spacing);\n  if (opts?.startOffset) {\n    el.setAttributeNS(null, `startOffset`, numberOrPercentage(opts.startOffset));\n  }\n  if (opts?.textLength) {\n    el.setAttributeNS(null, `textLength`, numberOrPercentage(opts.textLength));\n  }\n\n  if (text) {\n    //eslint-disable-next-line functional/immutable-data\n    el.textContent = text;\n  }\n  if (opts) Svg.applyOpts(el, opts);\n  if (opts) Svg.applyStrokeOpts(el, opts);\n  return el;\n};\n\n/**\n * Creates or reuses a SVGTextPathElement.\n * @param pathReference\n * @param text\n * @param parent\n * @param opts\n * @param textQueryOrExisting\n * @param pathQueryOrExisting\n * @returns\n */\nexport const textPath = (\n  pathReference: string,\n  text: string,\n  parent: SVGElement,\n  opts?: Svg.TextPathDrawingOpts,\n  textQueryOrExisting?: string | SVGTextElement,\n  pathQueryOrExisting?: string | SVGTextPathElement\n): SVGTextPathElement => {\n  const textEl = Svg.createOrResolve<SVGTextElement>(\n    parent,\n    `text`,\n    textQueryOrExisting, `-text`\n  );\n  // Update text properties, but don't pass in position or text\n  textUpdate(textEl, undefined, undefined, opts);\n\n  const p = Svg.createOrResolve<SVGTextPathElement>(\n    textEl,\n    `textPath`,\n    pathQueryOrExisting\n  );\n  p.setAttributeNS(null, `href`, pathReference);\n  return textPathUpdate(p, text, opts);\n};\n\n/**\n * Updates an existing SVGTextElement instance with position, text and drawing options\n * @param el\n * @param pos\n * @param text\n * @param opts\n * @returns\n */\nexport const textUpdate = (\n  el: SVGTextElement,\n  pos?: Point,\n  text?: string,\n  opts?: Svg.TextDrawingOpts\n) => {\n  if (pos) {\n    el.setAttributeNS(null, `x`, pos.x.toString());\n    el.setAttributeNS(null, `y`, pos.y.toString());\n  }\n  if (text) {\n    //eslint-disable-next-line functional/immutable-data\n    el.textContent = text;\n  }\n\n  if (opts) {\n    Svg.applyOpts(el, opts);\n    if (opts) Svg.applyStrokeOpts(el, opts);\n\n    if (opts.anchor) el.setAttributeNS(null, `text-anchor`, opts.anchor);\n    if (opts.align) el.setAttributeNS(null, `alignment-baseline`, opts.align);\n\n    const userSelect = opts.userSelect ?? true;\n\n    if (!userSelect) {\n      //eslint-disable-next-line functional/immutable-data\n      el.style.userSelect = `none`;\n      //eslint-disable-next-line functional/immutable-data\n      el.style.webkitUserSelect = `none`;\n    }\n  }\n  return el;\n};\n\n/**\n * Creates or reuses a SVGTextElement\n * @param pos Position of text\n * @param text Text\n * @param parent\n * @param opts\n * @param queryOrExisting\n * @returns\n */\nexport const text = (\n  text: string,\n  parent: SVGElement,\n  pos?: Point,\n  opts?: Svg.TextDrawingOpts,\n  queryOrExisting?: string | SVGTextElement\n): SVGTextElement => {\n  const p = Svg.createOrResolve<SVGTextElement>(\n    parent,\n    `text`,\n    queryOrExisting\n  );\n  return textUpdate(p, pos, text, opts);\n};\n\n/**\n * Creates a square grid based at a center point, with cells having `spacing` height and width.\n *\n * It fits in as many cells as it can within `width` and `height`.\n *\n * Returns a SVG group, consisting of horizontal and vertical lines\n * @param parent Parent element\n * @param center Center point of grid\n * @param spacing Width/height of cells\n * @param width How wide grid should be\n * @param height How high grid should be\n * @param opts\n */\nexport const grid = (\n  parent: SVGElement,\n  center: Point,\n  spacing: number,\n  width: number,\n  height: number,\n  opts: Svg.LineDrawingOpts = {}\n) => {\n  if (!opts.strokeStyle) {\n    opts = { ...opts, strokeStyle: getCssVariable(`bg-dim`, `silver`) };\n  }\n  if (!opts.strokeWidth) opts = { ...opts, strokeWidth: 1 };\n\n  const g = Svg.createEl<SVGGElement>(`g`);\n  Svg.applyOpts(g, opts);\n  Svg.applyPathOpts(g, opts);\n  Svg.applyStrokeOpts(g, opts);\n\n  // Horizontals\n  //eslint-disable-next-line functional/no-let\n  let y = 0;\n  while (y < height) {\n    const horiz = LinesFromNumbers(0, y, width, y);\n    line(horiz, g);\n    y += spacing;\n  }\n\n  // Verticals\n  //eslint-disable-next-line functional/no-let\n  let x = 0;\n  while (x < width) {\n    const vert = LinesFromNumbers(x, 0, x, height);\n    line(vert, g);\n    x += spacing;\n  }\n  parent.append(g);\n  return g;\n};\n","import { throwIntegerTest, throwNumberTest } from \"../util/GuardNumbers.js\";\n\n/**\n * Rounds `v` by `every`. Middle values are rounded up by default.\n *\n * ```js\n * quantiseEvery(11, 10);  // 10\n * quantiseEvery(25, 10);  // 30\n * quantiseEvery(0, 10);   // 0\n * quantiseEvery(4, 10);   // 0\n * quantiseEvery(100, 10); // 100\n * ```\n * \n * Also works with decimals\n * ```js\n * quantiseEvery(1.123, 0.1); // 1.1\n * quantiseEvery(1.21, 0.1);  // 1.2\n * ```\n *\n * @param v Value to quantise\n * @param every Number to quantise to\n * @param middleRoundsUp If _true_ (default), the exact middle rounds up to next step.\n * @returns\n */\nexport const quantiseEvery = (\n  v: number,\n  every: number,\n  middleRoundsUp = true\n) => {\n\n  const everyStr = every.toString();\n  const decimal = everyStr.indexOf(`.`);\n  let multiplier = 1;\n  if (decimal >= 0) {\n    let d = everyStr.substring(decimal + 1).length;\n    multiplier = 10 * d;\n    every = Math.floor(multiplier * every);\n    v = v * multiplier;\n  }\n  throwNumberTest(v, ``, `v`);\n  throwIntegerTest(every, ``, `every`);\n\n  let div = v / every;\n  const divModule = div % 1;\n  div = Math.floor(div);\n  if ((divModule === 0.5 && middleRoundsUp) || divModule > 0.5) div++;\n  const vv = (every * div) / multiplier;\n  return vv;\n};","import { throwNumberTest } from \"../util/GuardNumbers.js\";\nimport { round } from \"./Round.js\";\n\n/**\n * Generates a `step`-length series of values between `start` and `end` (inclusive).\n * Each value will be equally spaced.\n *\n * ```js\n * for (const v of linearSpace(1, 5, 6)) {\n *  // Yields: [ 1, 1.8, 2.6, 3.4, 4.2, 5 ]\n * }\n * ```\n *\n * Numbers can be produced from large to small as well\n * ```js\n * const values = [...linearSpace(10, 5, 3)];\n * // Yields: [10, 7.5, 5]\n * ```\n * @param start Start number (inclusive)\n * @param end  End number (inclusive)\n * @param steps How many steps to make from start -> end\n * @param precision Number of decimal points to round to\n */\nexport function* linearSpace(\n  start: number,\n  end: number,\n  steps: number,\n  precision?: number\n): IterableIterator<number> {\n  throwNumberTest(start, ``, `start`);\n  throwNumberTest(end, ``, `end`);\n\n  throwNumberTest(steps, ``, `steps`);\n  const r = precision ? round(precision) : (v: number) => v;\n  const step = (end - start) / (steps - 1);\n\n  throwNumberTest(step, ``, `step`);\n  if (!Number.isFinite(step)) {\n    throw new TypeError(`Calculated step value is infinite`);\n  }\n\n  //eslint-disable-next-line functional/no-let\n  for (let index = 0; index < steps; index++) {\n    const v = start + step * index;\n    yield r(v);\n  }\n}\n","/**\n * Applies a function `fn` to the elements of an array, weighting them based on their relative position.\n *\n * ```js\n * import { weight } from 'https://unpkg.com/ixfx/dist/numbers.js';\n * import { gaussian } from 'https://unpkg.com/ixfx/dist/modulation.js';\n * // Six items\n * weight([1,1,1,1,1,1], gaussian());\n *\n * // Yields:\n * // [0.02, 0.244, 0.85, 0.85, 0.244, 0.02]\n * ```\n *\n * `fn` is expected to map (0..1) => (0..1), such as an easing function. The input to the\n * `fn` is the relative position of an element. Thus the first element will be 0, the middle 0.5 and so on.\n * The output of `fn` is then multiplied by the original value.\n *\n * In the below example (which is also the default if `fn` is not specified), the relative position is\n * how values are weighted:\n *\n * ```js\n * weight([1,1,1,1,1,1], (relativePos) => relativePos);\n * // Yields:\n * // [0, 0.2, 0.4, 0.6, 0.8, 1]\n * ```\n *\n * Non-numbers in `data` will be silently ignored (this filtering happens first, so relative index values are sane still).\n *\n * @param data Array of numbers\n * @param fn Returns a weighting based on the given relative position. If unspecified, `(x) => x` is used.\n */\nexport const weight = (\n  data: Array<number> | ReadonlyArray<number>,\n  fn?: (relativePos: number) => number\n): Array<number> => {\n  const f = fn ?? ((x: number) => x);\n  const valid = validNumbers(data);\n  return valid.map(\n    (v: number, index: number) => {\n      const x = v * f(index / (valid.length - 1));\n      return x;\n    }\n  );\n};\n\n/**\n * Returns an array of all valid numbers from `data`\n *\n * @param data\n * @returns\n */\nexport const validNumbers = (data: ReadonlyArray<number>) =>\n  data.filter((d) => typeof d === `number` && !Number.isNaN(d));\n\n/**\n * Returns the dot product of arbitrary-sized arrays. Assumed they are of the same length.\n * @param values\n * @returns\n */\nexport const dotProduct = (\n  values: ReadonlyArray<ReadonlyArray<number>>\n): number => {\n  let r = 0;\n  const length = values[ 0 ].length;\n\n  for (let index = 0; index < length; index++) {\n    let t = 0;\n    for (const [ p, value ] of values.entries()) {\n      if (p === 0) t = value[ index ];\n      else {\n        t *= value[ index ];\n      }\n    }\n    r += t;\n  }\n  return r;\n};\n\n/**\n * Calculates the average of all numbers in an array.\n * Array items which aren't a valid number are ignored and do not factor into averaging.\n *\n * Use {@link minMaxAvg} if you want min, max and total as well.\n *\n * @example\n * ```js\n * import * as Numbers from 'https://unpkg.com/ixfx/dist/numbers.js';\n *\n * // Average of a list\n * const avg = Numbers.average([1, 1.4, 0.9, 0.1]);\n *\n * // Average of a variable\n * const data = [100,200];\n * Numbers.average(data);\n * ```\n *\n * @see {@link averageWeighted} To weight items based on position in array\n * @param data Data to average.\n * @returns Average of array\n */\nexport const average = (data: ReadonlyArray<number>): number => {\n  // ✔ UNIT TESTED\n  if (data === undefined) throw new Error(`data parameter is undefined`);\n  const valid = validNumbers(data);\n  const total = valid.reduce((accumulator, v) => accumulator + v, 0);\n  return total / valid.length;\n};\n\n/**\n * Returns the minimum number out of `data`.\n * Undefined and non-numbers are silently ignored.\n *\n * ```js\n * import { Numbers } from 'https://unpkg.com/ixfx/dist/Numbers.js';\n * Numbers.min([10, 20, 0]); // Yields 0\n * ```\n * @param data\n * @returns Minimum number\n */\nexport const min = (data: ReadonlyArray<number>): number =>\n  Math.min(...validNumbers(data));\n\n/**\n * Returns the index of the largest value.\n * ```js\n * import { Numbers } from 'https://unpkg.com/ixfx/dist/Numbers.js';\n * const v = [ 10, 40, 5 ];\n * Numbers.maxIndex(v); // Yields 1\n * ```\n * @param data Array of numbers\n * @returns Index of largest value\n */\nexport const maxIndex = (data: ReadonlyArray<number>): number =>\n  // eslint-disable-next-line unicorn/no-array-reduce\n  data.reduce(\n    (bestIndex, value, index, array) =>\n      value > array[ bestIndex ] ? index : bestIndex,\n    0\n  );\n\n/**\n * Returns the index of the smallest value.\n *\n * ```js\n * import { Numbers } from 'https://unpkg.com/ixfx/dist/Numbers.js';\n * const v = [ 10, 40, 5 ];\n * Numbers.minIndex(v); // Yields 2\n * ```\n * @param data Array of numbers\n * @returns Index of smallest value\n */\nexport const minIndex = (...data: ReadonlyArray<number>): number =>\n  // eslint-disable-next-line unicorn/no-array-reduce\n  data.reduce(\n    (bestIndex, value, index, array) =>\n      value < array[ bestIndex ] ? index : bestIndex,\n    0\n  );\n\n/**\n * Returns the maximum number out of `data`.\n * Undefined and non-numbers are silently ignored.\n *\n * ```js\n * import { Numbers } from 'https://unpkg.com/ixfx/dist/numbers.js';\n * Numbers.max(100, 200, 50); // 200\n * ```\n * @param data List of numbers\n * @returns Maximum number\n */\nexport const max = (data: ReadonlyArray<number>): number =>\n  Math.max(...validNumbers(data));\n\n/**\n * Returns the total of `data`.\n * Undefined and non-numbers are silently ignored.\n *\n * ```js\n * import { Numbers } from 'https://unpkg.com/ixfx/dist/numbers.js';\n * Numbers.total([1, 2, 3]); // 6\n * ```\n * @param data Array of numbers\n * @returns Total\n */\nexport const total = (data: ReadonlyArray<number>): number =>\n  // eslint-disable-next-line unicorn/no-array-reduce\n  data.reduce((previous, current) => {\n    if (typeof current !== `number`) return previous;\n    if (Number.isNaN(current)) return previous;\n    if (Number.isFinite(current)) return previous;\n    return previous + current;\n  }, 0);\n\n/**\n * Returns the maximum out of `data` without pre-filtering for speed.\n *\n * For most uses, {@link max} should suffice.\n *\n * ```js\n * import { Numbers } from 'https://unpkg.com/ixfx/dist/numbers.js';\n * Numbers.maxFast([ 10, 0, 4 ]); // 10\n * ```\n * @param data\n * @returns Maximum\n */\n//eslint-disable-next-line functional/prefer-immutable-types\nexport const maxFast = (data: ReadonlyArray<number> | Float32Array): number => {\n  //eslint-disable-next-line functional/no-let\n  let m = Number.MIN_SAFE_INTEGER;\n  //eslint-disable-next-line functional/no-let\n  for (const datum of data) {\n    m = Math.max(m, datum);\n  }\n  return m;\n};\n\n/**\n * Returns the total of `data` without pre-filtering for speed.\n *\n * For most uses, {@link total} should suffice.\n *\n * ```js\n * import { Numbers } from 'https://unpkg.com/ixfx/dist/numbers.js';\n * Numbers.totalFast([ 10, 0, 4 ]); // 14\n * ```\n * @param data\n * @returns Maximum\n */\n//eslint-disable-next-line functional/prefer-immutable-types\nexport const totalFast = (data: ReadonlyArray<number> | Float32Array): number => {\n  //eslint-disable-next-line functional/no-let\n  let m = 0;\n  //eslint-disable-next-line functional/no-let\n  for (const datum of data) {\n    m += datum;\n  }\n  return m;\n};\n\n/**\n * Returns the maximum out of `data` without pre-filtering for speed.\n *\n * For most uses, {@link max} should suffice.\n *\n * ```js\n * import { Numbers } from 'https://unpkg.com/ixfx/dist/numbers.js';\n * Numbers.minFast([ 10, 0, 100 ]); // 0\n * ```\n * @param data\n * @returns Maximum\n */\n//eslint-disable-next-line functional/prefer-immutable-types\nexport const minFast = (data: ReadonlyArray<number> | Float32Array): number => {\n  //eslint-disable-next-line functional/no-let\n  let m = Number.MIN_SAFE_INTEGER;\n  //eslint-disable-next-line functional/no-let\n  for (const datum of data) {\n    m = Math.min(m, datum);\n  }\n  return m;\n};\n","\n\nexport { mutable } from './SetMutable.js';\nexport { immutable } from './SetImmutable.js';\nexport { type ISetMutable } from './ISetMutable.js';\nexport { type ISetImmutable } from './ISetImmutable.js';\nexport * from './MassiveSet.js';\nexport type * from './Types.js';","// ✔ UNIT TESTED\nimport type { ToString } from '../../util/index.js';\nimport { defaultKeyer } from '../../DefaultKeyer.js';\nimport { SimpleEventEmitter } from '../../Events.js';\nimport { type ISetMutable } from './ISetMutable.js';\nimport { type ValueSetEventMap } from './Types.js';\n\n/**\n * Creates a {@link ISetMutable}.\n * @param keyString Function that produces a key based on a value. If unspecified, uses `JSON.stringify`\n * @returns\n */\nexport const mutable = <V>(\n  keyString?: ToString<V> | undefined\n): ISetMutable<V> => new SetStringMutable(keyString);\n\n/**\n * Mutable string set\n */\nexport class SetStringMutable<V>\n  extends SimpleEventEmitter<ValueSetEventMap<V>>\n  implements ISetMutable<V> {\n  // ✔ UNIT TESTED\n  /* eslint-disable functional/prefer-readonly-type */\n  store = new Map<string, V>();\n  keyString: ToString<V>;\n\n  /**\n   * Constructor\n   * @param keyString Function which returns a string version of added items. If unspecified `JSON.stringify`\n   */\n  constructor(keyString: ToString<V> | undefined) {\n    super();\n    this.keyString = keyString ?? defaultKeyer<V>;\n  }\n\n  /**\n   * Number of items stored in set\n   */\n  get size() {\n    return this.store.size;\n  }\n\n  /**\n   * Adds one or more items to set. `add` event is fired for each item\n   * @param values items to add\n   */\n  add(...values: Array<V>): boolean {\n    //eslint-disable-next-line functional/no-let\n    let somethingAdded = false;\n    for (const value of values) {\n      const isUpdated = this.has(value);\n      this.store.set(this.keyString(value), value);\n      super.fireEvent(`add`, { value: value, updated: isUpdated });\n      if (!isUpdated) somethingAdded = true;\n    }\n    return somethingAdded;\n  }\n\n  /**\n   * Returns values from set as an iterable\n   * @returns\n   */\n  //eslint-disable-next-line functional/prefer-tacit\n  values() {\n    return this.store.values();\n  }\n\n  /**\n   * Clear items from set\n   */\n  clear() {\n    this.store.clear();\n    super.fireEvent(`clear`, true);\n  }\n\n  /**\n   * Delete value from set.\n   * @param v Value to delete\n   * @returns _True_ if item was found and removed\n   */\n  delete(v: V): boolean {\n    const isDeleted = this.store.delete(this.keyString(v));\n    if (isDeleted) super.fireEvent(`delete`, v);\n    return isDeleted;\n  }\n\n  /**\n   * Returns _true_ if item exists in set\n   * @param v\n   * @returns\n   */\n  has(v: V): boolean {\n    return this.store.has(this.keyString(v));\n  }\n\n  /**\n   * Returns array copy of set\n   * @returns Array copy of set\n   */\n  toArray(): Array<V> {\n    return [ ...this.store.values() ];\n  }\n}\n","import { defaultKeyer } from '../../DefaultKeyer.js';\nimport { type ToString, toStringDefault } from '../../util/index.js';\nimport { type ISetImmutable } from './ISetImmutable.js';\n\nexport class SetStringImmutable<V> implements ISetImmutable<V> {\n  private store: Map<string, V>;\n  private keyString;\n\n  //eslint-disable-next-line functional/prefer-immutable-types\n  constructor(keyString?: ToString<V>, map?: Map<string, V>) {\n    this.store = map ?? new Map<string, V>();\n    this.keyString = keyString ?? defaultKeyer<V>;\n  }\n\n  get size(): number {\n    return this.store.size;\n  }\n\n  add(...values: ReadonlyArray<V>): ISetImmutable<V> {\n    const s = new Map<string, V>(this.store);\n    for (const v of values) {\n      const key = this.keyString(v);\n      s.set(key, v);\n    }\n    return new SetStringImmutable<V>(this.keyString, s);\n  }\n\n  delete(v: V): ISetImmutable<V> {\n    const s = new Map<string, V>(this.store);\n    const key = this.keyString(v);\n    if (s.delete(key)) return new SetStringImmutable(this.keyString, s);\n    return this;\n  }\n\n  has(v: V): boolean {\n    const key = this.keyString(v);\n    return this.store.has(key);\n  }\n\n  toArray(): Array<V> {\n    return [ ...this.store.values() ];\n  }\n\n  *values() {\n    yield* this.store.values();\n  }\n}\n\n/**\n * Immutable set that uses a `keyString` function to determine uniqueness\n *\n * @param keyString Function that produces a key based on a value. If unspecified, uses `JSON.stringify`.\n * @returns\n */\nexport const immutable = <V>(\n  keyString: ToString<V> = toStringDefault\n): ISetImmutable<V> => new SetStringImmutable(keyString);\n","/**\n * MassiveSet supports semantics similar to Set, but without the\n * limitation on how much data is stored.\n * \n * It only supports strings, and stores data in a hierarchy.\n * \n * ```js\n * const set = new MassiveSet(); // maxDepth=1 default\n * set.add(`test`);\n * set.add(`bloorp`);\n * ```\n * \n * In the above example, it will create a subtree for the first letter\n * of each key, putting the value underneath it. So we'd get a sub\n * MassiveSet for every key starting with 't' and every one starting with 'b'.\n * \n * If `maxDepth` was 2, we'd get the same two top-level nodes, but then\n * another sub-node based on the _second_ character of the value.\n * \n * It's not a very smart data-structure since it does no self-balancing\n * or tuning.\n */\nexport class MassiveSet {\n  #depth\n  #maxDepth;\n  children = new Map<string, MassiveSet>();\n  values: Array<string> = [];\n\n  constructor(maxDepth = 1, depth = 0) {\n    this.#depth = depth;\n    this.#maxDepth = maxDepth;\n  }\n\n  /**\n   * Returns the number of values stored in just this level of the set\n   * @returns \n   */\n  sizeLocal() {\n    return this.values.length;\n  }\n\n  /**\n   * Returns the number of branches at this node\n   * Use {@link sizeChildrenDeep} to count all branches recursively\n   * @returns \n   */\n  sizeChildren() {\n    return [ ...this.children.values() ].length;\n  }\n\n  sizeChildrenDeep() {\n    let t = this.sizeChildren();\n    for (const c of this.children.values()) {\n      t += c.sizeChildrenDeep();\n    }\n    return t;\n  }\n\n  /**\n   * Returns the total number of values stored in the set\n   */\n  size() {\n    let x = this.values.length;\n    for (const set of this.children.values()) {\n      x += set.size();\n    }\n    return x;\n  }\n\n  add(value: string) {\n    if (typeof value !== `string`) throw new Error(`Param 'value' must be a string. Got: ${ typeof value }`);\n\n    if (value.length === 0) throw new Error(`Param 'value' is empty`);\n\n    const destination = this.#getChild(value, true);\n    if (destination === this) {\n      if (!this.hasLocal(value)) {\n        this.values.push(value);\n      }\n      return;\n    }\n\n    if (!destination) throw new Error(`Could not create child set for: ${ value }`);\n    destination.add(value);\n  }\n\n  remove(value: string): boolean {\n    if (typeof value !== `string`) throw new Error(`Param 'value' must be a string. Got: ${ typeof value }`);\n    if (value.length === 0) throw new Error(`Param 'value' is empty`);\n\n    const destination = this.#getChild(value, false);\n    if (destination === undefined) return false;\n    if (destination === this) {\n      if (this.hasLocal(value)) {\n        this.values = this.values.filter(v => v !== value);\n        return true;\n      }\n      return false; // Not found\n    }\n    return destination.remove(value);\n  }\n\n  debugDump() {\n    const r = this.#dumpToArray();\n    for (const rr of r) {\n      console.log(rr);\n    }\n  }\n\n  #dumpToArray(depth = 0) {\n    const r: Array<string> = [];\n    r.push(`Depth: ${ this.#depth } Max: ${ this.#maxDepth }`);\n    for (const [ key, value ] of this.children.entries()) {\n      const dumped = value.#dumpToArray(depth + 1);\n      r.push(` key: ${ key }`);\n      for (const d of dumped) {\n        r.push(` `.repeat(depth + 1) + d);\n      }\n    }\n\n    r.push(`Values: (${ this.values.length })`);\n    for (const v of this.values) {\n      r.push(` ${ v }`);\n    }\n    return r.map(line => ` `.repeat(depth) + line);\n  }\n\n  #getChild(value: string, create: boolean) {\n    if (value === undefined) throw new Error(`Param 'value' undefined`);\n    if (this.#depth === this.#maxDepth) return this;\n    if (value.length <= this.#depth) return this;\n    const k = value[ this.#depth ];\n    if (k === undefined) throw new Error(`Logic error. Depth: ${ this.#depth } Len: ${ value.length }`);\n    let child = this.children.get(k);\n    if (child === undefined && create) {\n      child = new MassiveSet(this.#maxDepth, this.#depth + 1);\n      this.children.set(k, child);\n    }\n    return child;\n  }\n\n  /**\n   * Returns _true_ if `value` stored on this node\n   * @param value \n   * @returns \n   */\n  hasLocal(value: string) {\n    for (const v of this.values) {\n      if (v === value) return true;\n    }\n    return false;\n  }\n\n  has(value: string): boolean {\n    if (typeof value !== `string`) return false;\n\n    const destination = this.#getChild(value, false);\n    if (destination === undefined) return false;\n    if (destination === this) return this.hasLocal(value);\n    return destination.has(value);\n  }\n}","import { guardArray } from './GuardArray.js';\n/**\n * Sorts an array of objects in ascending order\n * by the given property name, assuming it is a number.\n *\n * ```js\n * const data = [\n *  { size: 10, colour: `red` },\n *  { size: 20, colour: `blue` },\n *  { size: 5, colour: `pink` }\n * ];\n * const sorted = Arrays.sortByNumericProperty(data, `size`);\n *\n * Yields items ascending order:\n * [ { size: 5, colour: `pink` }, { size: 10, colour: `red` }, { size: 20, colour: `blue` } ]\n * ```\n * @param data\n * @param propertyName\n */\nexport const sortByNumericProperty = <V, K extends keyof V>(\n  data: ReadonlyArray<V> | Array<V>,\n  propertyName: K\n) => [ ...data ].sort((a, b) => {\n  guardArray(data, `data`);\n  const av = a[ propertyName ];\n  const bv = b[ propertyName ];\n  if (av < bv) return -1;\n  if (av > bv) return 1;\n  return 0;\n});\n\nexport const sortByProperty = <V, K extends keyof V>(\n  data: ReadonlyArray<V> | Array<V>,\n  propertyName: K\n) => [ ...data ].sort((a, b) => {\n  guardArray(data, `data`);\n  const av = a[ propertyName ];\n  const bv = b[ propertyName ];\n  if (av < bv) return -1;\n  if (av > bv) return 1;\n  return 0;\n});","export * as Waypoints from './Waypoint.js';\nexport * as Layouts from './Layout.js';\n\nexport * as Circles from './circle/index.js';\nexport * as Lines from './line/index.js';\nexport * as Rects from './rect/index.js';\nexport * as Points from './point/index.js';\nexport * as Paths from './path/index.js';\nexport * as Grids from './Grid.js';\nexport * as Beziers from './bezier/index.js';\nexport * as Compound from './path/CompoundPath.js';\nexport * as Ellipses from './Ellipse.js';\nexport type * from './Types.js';\n\nexport * from './Angles.js';\nexport * as CurveSimplification from './CurveSimplification.js';\n\n/**\n * Quad tree is a datastructure for efficiently determining whether\n * a point/shape is at a location\n * - {@link quadTree}: Create a quad tree\n */\nexport * as QuadTree from './QuadTree.js';\n\nexport * as Scaler from './Scaler.js';\nexport * as Convolve2d from './Convolve2d.js';\n\n/**\n * Work with arcs. Arcs are a angle-limited circle, describing a wedge.\n * \n * {@link ArcPositioned} has a origin x,y.\n * \n * Conversions:\n * - {@link fromDegrees}\n * - {@link toLine}: A line from start/end position of arc\n * - {@link toSvg}: Returns an SVG representation of arc\n * \n * Calculations:\n * - {@link bbox}: Bounding box\n * - {@link interpolate}: Interplate two arcs\n * - {@link point}: Find a point on the arc, given an angle\n * - {@link length}: Circumference of arc\n * \n * Comparisons:\n * - {@link isArc}: Returns true if object is Arc-ish\n * - {@link isEqual}: Returns true if two objects have identical arc properties\n */\nexport * as Arcs from './arc/index.js';\n\n/**\n * Generate a few basic geometric shapes\n * Overview:\n * * {@link arrow}\n * * {@link starburst}\n */\nexport * as Shapes from './shape/index.js';\n\n/**\n * Helper functions for working with vectors, which can either be a {@link Point} or Polar {@link Polar.Coord}.\n * While most of the functionality is provided in either of those modules, the Vector module lets you cleanly\n * interoperate between these two coordinates.\n */\nexport * as Vectors from './Vector.js';\n\n\n/**\n * Work with Polar coordinates.\n * A {@link Polar.Coord} is just `{ angleRadians:number, distance: number }`.\n * \n * Conversion: {@link toCartesian}, {@link fromCartesian}, {@link toString}\n * \n * Math: {@link divide}, {@link invert}, {@link multiply}, {@link dotProduct}\n * \n * Geometric manipulations: {@link rotate}, {@link rotateDegrees}\n * \n * Cleaning: {@link clampMagnitude}, {@link normalise}\n * \n * Debugging: {@link toString}\n * \n * Comparisons: {@link isAntiParallel}, {@link isOpposite}, {@link isParallel}, {@link isPolarCoord}\n */\nexport * as Polar from './Polar.js';\n\n/**\n * Functions for producing points within a shape.\n * Useful for creating patterns.\n * \n * Overview:\n * * {@link sphereFibonacci}: Generate points on a sphere\n * * {@link circleVogelSpiral}: Generate a sunflower-esque pattern of points in a circle \n */\nexport * as SurfacePoints from './SurfacePoints.js';\n\n/**\n * Triangle processing.\n * \n * Helpers for creating:\n * - {@link Triangles.fromFlatArray}: Create from `[ x1, y1, x2, y2, x3, y3 ]`\n * - {@link Triangles.fromPoints}: Create from three `{ x, y }` sets\n * - {@link Triangles.fromRadius}: Equilateral triangle of a given radius and center\n * \n * There are sub-modules for dealing with particular triangles:\n * - {@link Triangles.Equilateral}: Equilateral triangls\n * - {@link Triangles.Right}: Right-angled triangles\n * - {@link Triangles.Isosceles}: Iscosceles triangles\n * \n * Calculations\n * - {@link angles}: Internal angles in radians. {@link anglesDegrees} for degrees. \n * - {@link area}: Area of triangle\n * - {@link bbox}: Bounding box\n * - {@link centroid}: Centroid of triangle\n * - {@link perimeter}: Calculate perimeter\n * - {@link lengths}: Return array lengths of triangle's edges\n * - {@link rotate}, {@link rotateByVertex}\n * \n * Conversions\n * - {@link edges}: Edges of triangle as {@link Line}\n * - {@link corners}: Corner positions\n * - {@link innerCircle}: Largest circle to fit within triangle\n * - {@link outerCircle}: Largest circle to enclose triangle\n * - {@link toFlatArray}\n * \n * Comparisons\n * - {@link intersectsPoint}: Whether a point intersects triangle\n * - {@link isEqual}: Check whether two triangles have equal values\n * - {@link isAcute}, {@link isEquilateral}, {@link isIsosceles}, {@link isRightAngle}\n * - {@link isTriangle}: Returns true if object has expected properties of a triangle\n */\nexport * as Triangles from './triangle/index.js';\n\n// try {\n//   if (typeof window !== `undefined`) {\n//     //eslint-disable-next-line functional/immutable-data,@typescript-eslint/no-explicit-any\n//     (window as any).ixfx = { ...(window as any).ixfx, Geometry: { Circles, Arcs, Lines, Rects, Points, Paths, Grids, Beziers, Compound, Ellipses, Polar, Shapes, radiansFromAxisX, radianToDegree, degreeToRadian } };\n//   }\n// } catch { /* no-op */ }\n","import type { CirclePositioned } from \"./circle/CircleType.js\";\nimport type { Path } from \"./path/PathType.js\";\nimport type { Point } from \"./point/PointType.js\";\nimport { joinPointsToLines } from './line/JoinPointsToLines.js';\nimport { toPath } from './line/ToPath.js';\nimport { distance as PointsDistance } from \"./point/Distance.js\";\nimport { sortByNumericProperty } from \"../data/arrays/Sort.js\";\n\nexport type Waypoint = CirclePositioned;\n\nexport type WaypointOpts = {\n  readonly maxDistanceFromLine: number;\n  readonly enforceOrder: boolean;\n};\n\n/**\n * Create from set of points, connected in order starting at array position 0.\n * @param waypoints \n * @param opts \n * @returns \n */\nexport const fromPoints = (\n  waypoints: ReadonlyArray<Point>,\n  opts: Partial<WaypointOpts> = {}\n) => {\n  const lines = joinPointsToLines(...waypoints);\n  return init(\n    lines.map((l) => toPath(l)),\n    opts\n  );\n};\n\n/**\n * Result \n */\nexport type WaypointResult = {\n  /**\n   * Path being compared against\n   */\n  path: Path\n  /**\n   * Index of this path in original `paths` array\n   */\n  index: number\n  /**\n   * Nearest point on path. See also {@link distance}\n   */\n  nearest: Point\n  /**\n   * Closest distance to path. See also {@link nearest}\n   */\n  distance: number\n  /**\n   * Rank of this result, 0 being highest.\n   */\n  rank: number\n  /**\n   * Relative position on this path segment\n   * 0 being start, 0.5 middle and so on.\n   */\n  positionRelative: number\n}\n\n/**\n * Given point `pt`, returns a list of {@link WaypointResult}, comparing\n * this point to a set of paths.\n * ```js\n * // Init once with a set of paths\n * const w = init(paths);\n * // Now call with a point to get results\n * const results = w({ x: 10, y: 20 });\n * ```\n */\nexport type Waypoints = (pt: Point) => Array<WaypointResult>\n\n/**\n * Initialise\n * \n * Options:\n * * maxDistanceFromLine: Distances greater than this are not matched. Default 0.1\n * @param paths \n * @param opts \n * @returns \n */\nexport const init = (paths: ReadonlyArray<Path>, opts: Partial<WaypointOpts> = {}): Waypoints => {\n  //const enforceOrder = opts.enforceOrder ?? true;\n  const maxDistanceFromLine = opts.maxDistanceFromLine ?? 0.1;\n\n  const checkUnordered = (pt: Point): Array<WaypointResult> => {\n    const results = paths.map((p, index) => {\n      const nearest = p.nearest(pt);\n      const distance = PointsDistance(pt, nearest);\n\n      // Relative position of nearest point on this path segment\n      const positionRelative = p.relativePosition(nearest, maxDistanceFromLine);;\n      return { positionRelative, path: p, index, nearest, distance, rank: Number.MAX_SAFE_INTEGER };\n    });\n\n    const filtered = results.filter((v) => v.distance <= maxDistanceFromLine);\n    const sorted = sortByNumericProperty(filtered, `distance`);\n\n    // Assign ranks\n    // eslint-disable-next-line unicorn/no-for-loop\n    for (let rank = 0; rank < sorted.length; rank++) {\n      sorted[ rank ].rank = rank;\n    }\n    return sorted;\n  };\n\n  // const checkUnordered = (p:Point) => {\n  //   // Calculate progress of pointer between all the waypoint lines\n  //   const progresses = lines.map((line, index) => (\n  //     {\n  //       index,\n  //       score: Points.progressBetween(p, line.a, line.b)\n  //     }));\n  //   // Sort by closest\n  //   const sorted = Arrays.sortByNumericProperty(progresses, `score`);\n  // };\n  return checkUnordered;\n};\n","import type { Point } from \"../point/PointType.js\";\nimport { fromPoints } from \"./FromPoints.js\";\nimport type { PolyLine } from \"./LineType.js\";\n\n/**\n * Returns an array of lines that connects provided points. Note that line is not closed.\n * \n * Eg, if points a,b,c are provided, two lines are provided: a->b and b->c.\n * \n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * const lines = Lines.joinPointsToLines(ptA, ptB, ptC);\n * // lines is an array of, well, lines\n * ```\n * @param points \n * @returns \n */\nexport const joinPointsToLines = (...points: ReadonlyArray<Point>): PolyLine => {\n  const lines = [];\n\n  let start = points[ 0 ];\n\n  for (let index = 1; index < points.length; index++) {\n    //eslint-disable-next-line functional/immutable-data\n    lines.push(fromPoints(start, points[ index ]));\n    start = points[ index ];\n  }\n  return lines;\n};","import { isPoint } from \"../point/Guard.js\";\nimport type { Line, PolyLine } from \"./LineType.js\";\n\n/**\n * Returns true if `p` is a valid line, containing `a` and `b` Points.\n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * Lines.isLine(l);\n * ```\n * @param p Value to check\n * @returns True if a valid line.\n */\nexport const isLine = (p: any): p is Line => {\n  if (p === undefined) return false;\n  if ((p as Line).a === undefined) return false;\n  if ((p as Line).b === undefined) return false;\n  if (!isPoint((p as Line).a)) return false;\n  if (!isPoint((p as Line).b)) return false;\n  return true;\n};\n\n/**\n * Returns true if `p` is a {@link PolyLine}, ie. an array of {@link Line}s.\n * Validates all items in array.\n * @param p \n * @returns\n */\n//eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport const isPolyLine = (p: any): p is PolyLine => {\n  if (!Array.isArray(p)) return false;\n\n  const valid = !p.some(v => !isLine(v));\n  return valid;\n};\n\n/**\n * Throws an exception if:\n * * line is undefined\n * * a or b parameters are missing\n * \n * Does not validate points\n * @param line \n * @param name \n */\nexport const guard = (line: Line, name = `line`) => {\n  if (line === undefined) throw new Error(`${ name } undefined`);\n  if (line.a === undefined) throw new Error(`${ name }.a undefined. Expected {a:Point, b:Point}. Got: ${ JSON.stringify(line) }`);\n  if (line.b === undefined) throw new Error(`${ name }.b undefined. Expected {a:Point, b:Point} Got: ${ JSON.stringify(line) }`);\n};","import type { Point } from \"../point/PointType.js\";\nimport { isLine } from \"./Guard.js\";\nimport type { Line } from \"./LineType.js\";\nimport { guard as guardPoint } from '../point/Guard.js';\n\n/**\n * Returns [a,b] points from either a line parameter, or two points.\n * It additionally applies the guardPoint function to ensure validity.\n * This supports function overloading.\n * @ignore\n * @param aOrLine \n * @param b \n * @returns \n */\nexport const getPointParameter = (aOrLine: Point | Line, b?: Point): readonly [ Point, Point ] => {\n\n  let a;\n  if (isLine(aOrLine)) {\n    b = aOrLine.b;\n    a = aOrLine.a;\n  } else {\n    a = aOrLine;\n    if (b === undefined) throw new Error(`Since first parameter is not a line, two points are expected. Got a: ${ JSON.stringify(a) } b: ${ JSON.stringify(b) }`);\n  }\n  guardPoint(a, `a`);\n  guardPoint(a, `b`);\n\n  return [ a, b ];\n};","import type { Point } from \"../point/PointType.js\";\nimport { getPointParameter } from \"./GetPointsParameter.js\";\nimport { isPolyLine } from \"./Guard.js\";\nimport type { Line, PolyLine } from \"./LineType.js\";\n\n/**\n * Returns the length between two points\n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * Lines.length(ptA, ptB);\n * ```\n * @param a First point\n * @param b Second point\n * @returns \n */\nexport function length(a: Point, b: Point): number;\n\n/**\n * Returns length of line. If a polyline (array of lines) is provided,\n * it is the sum total that is returned.\n * \n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * Lines.length(a: {x:0, y:0}, b: {x: 100, y:100});\n * Lines.length(lines);\n * ```\n * @param line Line\n */\nexport function length(line: Line | PolyLine): number;\n\n/**\n * Returns length of line, polyline or between two points\n * \n * @param aOrLine Point A, line or polyline (array of lines)\n * @param pointB Point B, if first parameter is a point\n * @returns Length (total accumulated length for arrays)\n */\n//eslint-disable-next-line func-style\nexport function length(aOrLine: Point | Line | PolyLine, pointB?: Point): number {\n  if (isPolyLine(aOrLine)) {\n    const sum = aOrLine.reduce((accumulator, v) => length(v) + accumulator, 0);\n    return sum;\n  }\n  if (aOrLine === undefined) throw new TypeError(`Parameter 'aOrLine' is undefined`);\n  const [ a, b ] = getPointParameter(aOrLine, pointB);\n  const x = b.x - a.x;\n  const y = b.y - a.y;\n  if (a.z !== undefined && b.z !== undefined) {\n    const z = b.z - a.z;\n    return Math.hypot(x, y, z);\n  } else {\n    return Math.hypot(x, y);\n  }\n}\n","import { throwNumberTest, throwPercentTest } from \"../../util/GuardNumbers.js\";\nimport type { Point } from \"../point/PointType.js\";\nimport type { Line } from \"./LineType.js\";\nimport { getPointParameter } from \"./GetPointsParameter.js\";\nimport { length } from \"./Length.js\";\n/**\n * Calculates a point in-between `a` and `b`.\n * \n * If an interpolation amount below 0 or above 1 is given, _and_\n * `allowOverflow_ is true, a point will be returned that is extended\n * past `line`. This is useful for easing functions which might\n * briefly go past the limits.\n * \n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * \n * // Get {x,y} at 50% along line\n * Lines.interpolate(0.5, line);\n * \n * // Get {x,y} at 80% between point A and B\n * Lines.interpolate(0.8, ptA, ptB);\n * ```\n * @param amount Relative position, 0 being at a, 0.5 being halfway, 1 being at b\n * @param a Start\n * @param pointB End\n * @returns Point between a and b\n */\nexport function interpolate(amount: number, a: Point, pointB: Point, allowOverflow?: boolean): Point;\n\n/**\n * Calculates a point in-between `line`'s start and end points.\n * \n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * \n * // Get {x, y } at 50% along line\n * Lines.interpolate(0.5, line);\n * ```\n * \n * Any additional properties from `b`  are returned on the result as well.\n * @param amount 0..1 \n * @param line Line\n * @param allowOverflow If true, interpolation amount is permitted to exceed 0..1, extending the line\n */\nexport function interpolate(amount: number, line: Line, allowOverflow?: boolean): Point;\n\n/**\n * Calculates a point in-between a line's start and end points.\n * \n * @param amount Interpolation amount\n * @param aOrLine Line, or first point\n * @param pointBOrAllowOverflow Second point (if needed) or allowOverflow.\n * @param allowOverflow If true, interpolation amount is permitted to exceed 0..1, extending the line.\n * @returns \n */\n//eslint-disable-next-line func-style\nexport function interpolate(amount: number, aOrLine: Point | Line, pointBOrAllowOverflow?: Point | boolean, allowOverflow?: boolean): Point {\n\n  if (typeof pointBOrAllowOverflow === `boolean`) {\n    allowOverflow = pointBOrAllowOverflow;\n    pointBOrAllowOverflow = undefined;\n  }\n\n  // eslint-disable-next-line unicorn/no-negated-condition\n  if (!allowOverflow) throwPercentTest(amount, `amount`);\n  else throwNumberTest(amount, ``, `amount`);\n\n  const [ a, b ] = getPointParameter(aOrLine, pointBOrAllowOverflow);\n\n  const d = length(a, b);\n  const d2 = d * (1 - amount);\n\n  // Points are identical, return a copy of b\n  if (d === 0 && d2 === 0) return Object.freeze({ ...b });\n\n  const x = b.x - (d2 * (b.x - a.x) / d);\n  const y = b.y - (d2 * (b.y - a.y) / d);\n\n  return Object.freeze({\n    ...b,\n    x: x,\n    y: y\n  });\n}\n","import { interpolate } from \"./Interpolate.js\";\nimport type { Line } from \"./LineType.js\";\nimport { length } from \"./Length.js\";\nimport type { Point } from \"../point/PointType.js\";\n\nconst directionVector = (line: Line): Point => ({\n  x: line.b.x - line.a.x,\n  y: line.b.y - line.a.y\n});\n\n\n\nconst directionVectorNormalised = (line: Line): Point => {\n  const l = length(line);\n  const v = directionVector(line);\n  return {\n    x: v.x / l,\n    y: v.y / l\n  };\n};\n\n/**\n * Returns a parallel line to `line` at `distance`.\n * \n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * const l = Lines.parallel(line, 10);\n * ```\n * @param line\n * @param distance \n */\nexport const parallel = (line: Line, distance: number): Line => {\n  const dv = directionVector(line);\n  const dvn = directionVectorNormalised(line);\n  const a = {\n    x: line.a.x - dvn.y * distance,\n    y: line.a.y + dvn.x * distance\n  };\n  return {\n    a,\n    b: {\n      x: a.x + dv.x,\n      y: a.y + dv.y\n    }\n  };\n};\n\n/**\n * Returns a point perpendicular to `line` at a specified `distance`. Use negative\n * distances for the other side of line.\n * ```\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * // Project a point 100 units away from line, at its midpoint.\n * const pt = Lines.perpendicularPoint(line, 100, 0.5);\n * ```\n * @param line Line\n * @param distance Distance from line. Use negatives to flip side\n * @param amount Relative place on line to project point from. 0 projects from A, 0.5 from the middle, 1 from B.\n */\nexport const perpendicularPoint = (line: Line, distance: number, amount = 0) => {\n  const origin = interpolate(amount, line);\n  const dvn = directionVectorNormalised(line);\n  return {\n    x: origin.x - dvn.y * distance,\n    y: origin.y + dvn.x * distance\n  };\n};\n","import type { Point } from \"../point/PointType.js\";\nimport { interpolate } from \"./Interpolate.js\";\nimport type { Line } from \"./LineType.js\";\nimport { getPointParameter } from \"./GetPointsParameter.js\";\n\n/**\n * Returns the mid-point of a line (same as `interpolate` with an amount of 0.5)\n * \n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * Lines.midpoint(line); // Returns {x, y}\n * ```\n * @param aOrLine \n * @param pointB \n * @returns \n */\nexport const midpoint = (aOrLine: Point | Line, pointB?: Point): Point => {\n  const [ a, b ] = getPointParameter(aOrLine, pointB);\n  return interpolate(0.5, a, b);\n};","import type { Point } from '../point/PointType.js';\nimport type { Line } from './LineType.js';\n//import * as Points from '../point/index.js';\nimport { normaliseByRect as PointsNormaliseByRect } from '../point/NormaliseByRect.js';\nimport { minFast } from '../../numbers/NumericArrays.js';\nimport { distanceSingleLine } from './DistanceSingleLine.js';\nimport { isLine } from './Guard.js';\nimport { length } from './Length.js';\nimport { interpolate } from './Interpolate.js';\nimport { isPoint, isEmpty as PointIsEmpty, isPlaceholder as PointIsPlaceholder } from '../point/Guard.js';\nexport * from './Angles.js';\nexport * from './Bbox.js';\nexport * from './DistanceSingleLine.js';\nexport * from './Divide.js';\nexport * from './FromFlatArray.js';\nexport * from './FromNumbers.js';\nexport * from './FromPoints.js';\nexport * from './FromPivot.js';\nexport * from './FromPointsToPath.js';\nexport * from './GetPointsParameter.js';\nexport * from './Guard.js';\nexport * from './Interpolate.js';\nexport * from './IsEqual.js';\nexport * from './JoinPointsToLines.js';\nexport * from './Length.js';\nexport type * from './LinePathType.js';\nexport type * from './LineType.js';\nexport * from './Midpoint.js';\nexport * from './Multiply.js';\nexport * from './Nearest.js';\nexport * from './RelativePosition.js';\nexport * from './Rotate.js';\nexport * from './Subtract.js';\nexport * from './Sum.js';\nexport * from './ToPath.js';\nexport * from './ToString.js';\n\n//eslint-disable-next-line @typescript-eslint/naming-convention\nexport const Empty = Object.freeze({\n  a: Object.freeze({ x: 0, y: 0 }),\n  b: Object.freeze({ x: 0, y: 0 })\n});\n\n//eslint-disable-next-line @typescript-eslint/naming-convention\nexport const Placeholder = Object.freeze({\n  a: Object.freeze({ x: Number.NaN, y: Number.NaN }),\n  b: Object.freeze({ x: Number.NaN, y: Number.NaN })\n});\n\n/**\n * Returns true if `l` is the same as Line.Empty, that is\n * the `a` and `b` points are Points.Empty.\n * @param l \n * @returns \n */\nexport const isEmpty = (l: Line): boolean => PointIsEmpty(l.a) && PointIsEmpty(l.b);\n\nexport const isPlaceholder = (l: Line): boolean => PointIsPlaceholder(l.a) && PointIsPlaceholder(l.b);\n\n\n\n\n/**\n * Applies `fn` to both start and end points.\n * \n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * // Line 10,10 -> 20,20\n * const line = Lines.fromNumbers(10,10, 20,20);\n * \n * // Applies randomisation to both x and y.\n * const rand = (p) => ({\n *  x: p.x * Math.random(),\n *  y: p.y * Math.random()\n * });\n * \n * // Applies our randomisation function\n * const line2 = apply(line, rand);\n * ```\n * @param line Line\n * @param fn Function that takes a point and returns a point\n * @returns \n */\nexport const apply = (line: Line, fn: (p: Point) => Point) => Object.freeze<Line>(\n  {\n    ...line,\n    a: fn(line.a),\n    b: fn(line.b)\n  }\n);\n\n\n/**\n * Returns the angle in radians of a line, or two points\n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * Lines.angleRadian(line);\n * Lines.angleRadian(ptA, ptB);\n * ```\n * @param lineOrPoint \n * @param b \n * @returns \n */\nexport const angleRadian = (lineOrPoint: Line | Point, b?: Point): number => {\n  let a: Point;\n  if (isLine(lineOrPoint)) {\n    a = lineOrPoint.a;\n    b = lineOrPoint.b;\n  } else {\n    a = lineOrPoint;\n    if (b === undefined) throw new Error(`b point must be provided`);\n  }\n  return Math.atan2(b.y - a.y, b.x - a.x);\n};\n\n/**\n * Normalises start and end points by given width and height. Useful\n * for converting an absolutely-defined line to a relative one.\n * \n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * \n * // Line 1,1 -> 10,10\n * const l = Lines.fromNumbers(1,1,10,10);\n * const ll = Lines.normaliseByRect(l, 10, 10);\n * // Yields: 0.1,0.1 -> 1,1\n * ```\n * @param line \n * @param width\n * @param height \n * @returns \n */\nexport const normaliseByRect = (line: Line, width: number, height: number): Line => Object.freeze({\n  ...line,\n  a: PointsNormaliseByRect(line.a, width, height),\n  b: PointsNormaliseByRect(line.b, width, height)\n});\n\n\n/**\n * Returns true if `point` is within `maxRange` of `line`.\n * \n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * const line = Lines.fromNumbers(0,20,20,20);\n * Lines.withinRange(line, {x:0,y:21}, 1); // True\n * ```\n * @param line\n * @param point\n * @param maxRange \n * @returns True if point is within range\n */\nexport const withinRange = (line: Line, point: Point, maxRange: number): boolean => {\n  const calculatedDistance = distance(line, point);\n  return calculatedDistance <= maxRange;\n};\n\n\n/**\n * Calculates [slope](https://en.wikipedia.org/wiki/Slope) of line.\n * \n * @example\n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * Lines.slope(line);\n * Lines.slope(ptA, ptB)\n * ```\n * @param lineOrPoint Line or point. If point is provided, second point must be given too\n * @param b Second point if needed\n * @returns \n */\nexport const slope = (lineOrPoint: Line | Point, b?: Point): number => {\n\n  let a: Point;\n  if (isLine(lineOrPoint)) {\n\n    a = lineOrPoint.a;\n    b = lineOrPoint.b;\n  } else {\n    a = lineOrPoint;\n    if (b === undefined) throw new Error(`b parameter required`);\n  }\n  if (b === undefined) {\n    throw new TypeError(`Second point missing`)\n  } else {\n    return (b.y - a.y) / (b.x - a.x);\n  }\n};\n\n\n/**\n * Scales a line from its midpoint\n * \n * @example Shorten by 50%, anchored at the midpoint\n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * const l = {\n *  a: {x:50, y:50}, b: {x: 100, y: 90}\n * }\n * const l2 = Lines.scaleFromMidpoint(l, 0.5);\n * ```\n * @param line\n * @param factor \n */\nexport const scaleFromMidpoint = (line: Line, factor: number): Line => {\n  const a = interpolate(factor / 2, line);\n  const b = interpolate(0.5 + factor / 2, line);\n  return { a, b };\n};\n\n/**\n * Calculates `y` where `line` intersects `x`.\n * @param line Line to extend\n * @param x Intersection of x-axis.\n */\nexport const pointAtX = (line: Line, x: number): Point => {\n  const y = line.a.y + (x - line.a.x) * slope(line);\n  return Object.freeze({ x: x, y });\n};\n\n/**\n * Returns a line extended from its `a` point by a specified distance\n *\n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * const line = {a: {x: 0, y:0}, b: {x:10, y:10} }\n * const extended = Lines.extendFromA(line, 2);\n * ```\n * @param line\n * @param distance\n * @return Newly extended line\n */\nexport const extendFromA = (line: Line, distance: number): Line => {\n  const calculatedLength = length(line);\n  return Object.freeze({\n    ...line,\n    a: line.a,\n    b: Object.freeze({\n      x: line.b.x + (line.b.x - line.a.x) / calculatedLength * distance,\n      y: line.b.y + (line.b.y - line.a.y) / calculatedLength * distance,\n    })\n  });\n};\n\n/**\n * Yields every integer point along `line`. \n * \n * @example Basic usage\n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * const l = { a: {x: 0, y: 0}, b: {x: 100, y: 100} };\n * for (const p of Lines.pointsOf(l)) {\n *  // Do something with point `p`...\n * }\n * ```\n * \n * Some precision is lost as start and end\n * point is also returned as an integer.\n * \n * Uses [Bresenham's line algorithm](https://en.wikipedia.org/wiki/Bresenham%27s_line_algorithm)\n * @param line Line\n */\n//eslint-disable-next-line func-style\nexport function* pointsOf(line: Line): Generator<Point> {\n  // Via https://play.ertdfgcvb.xyz/#/src/demos/dyna\n  const { a, b } = line;\n  let x0 = Math.floor(a.x);\n  let y0 = Math.floor(a.y);\n  const x1 = Math.floor(b.x);\n  const y1 = Math.floor(b.y);\n  const dx = Math.abs(x1 - x0);\n  const dy = -Math.abs(y1 - y0);\n  const sx = x0 < x1 ? 1 : -1;\n  const sy = y0 < y1 ? 1 : -1;\n  // eslint-disable-next-line unicorn/prevent-abbreviations\n  let err = dx + dy;\n\n  while (true) {\n    yield { x: x0, y: y0 };\n    if (x0 === x1 && y0 === y1) break;\n    // eslint-disable-next-line unicorn/prevent-abbreviations\n    const e2 = 2 * err;\n    if (e2 >= dy) {\n      err += dy;\n      x0 += sx;\n    }\n    if (e2 <= dx) {\n      err += dx;\n      y0 += sy;\n    }\n  }\n}\n\n/**\n * Returns the distance of `point` to the \n * nearest point on `line`.\n * \n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * const d = Lines.distance(line, {x:10,y:10});\n * ```\n * \n * If an array of lines is provided, the shortest distance is returned.\n * @param line Line (or array of lines)\n * @param point Point to check against\n * @returns Distance\n */\nexport const distance = (line: Line | ReadonlyArray<Line>, point: Point): number => {\n  if (Array.isArray(line)) {\n    const distances = line.map(l => distanceSingleLine(l, point));\n    return minFast(distances);\n  } else {\n    return distanceSingleLine(line as Line, point);\n  }\n};\n\n/**\n * Returns an array representation of line: [a.x, a.y, b.x, b.y]\n * \n * See {@link fromFlatArray} to create a line _from_ this representation.\n *\n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * Lines.toFlatArray(line);\n * Lines.toFlatArray(pointA, pointB);\n * ```\n * @param {Point} a\n * @param {Point} b\n * @returns {number[]}\n */\nexport const toFlatArray = (a: Point | Line, b: Point): ReadonlyArray<number> => {\n  if (isLine(a)) {\n    return [ a.a.x, a.a.y, a.b.x, a.b.y ];\n  } else if (isPoint(a) && isPoint(b)) {\n    return [ a.x, a.y, b.x, b.y ];\n  } else {\n    throw new Error(`Expected single line parameter, or a and b points`);\n  }\n};\n\n/**\n * Yields all the points of all the lines.\n * \n * ```js\n * const lines = [ ..some array of lines.. ];\n * for (const pt of Lines.asPoints(lines)) {\n *  // Yields a and then b of each point sequentially\n * }\n * ```\n * @param lines \n */\n//eslint-disable-next-line func-style\nexport function* asPoints(lines: Iterable<Line>) {\n  for (const l of lines) {\n    yield l.a;\n    yield l.b;\n  }\n}\n\n/**\n * Returns an SVG description of line\n * ```\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js';\n * Lines.toSvgString(ptA, ptB);\n * ```\n * @param a \n * @param b \n * @returns \n */\nexport const toSvgString = (a: Point, b: Point): ReadonlyArray<string> => [ `M${ a.x } ${ a.y } L ${ b.x } ${ b.y }` ];\n","import type { RectPositioned, Rect } from \"./RectTypes.js\";\nimport { guard as PointsGuard } from '../point/Guard.js';\nimport type { Point } from '../point/PointType.js';\n\n/**\n * Throws an error if the dimensions of the rectangle are undefined, NaN or negative.\n * @param d \n * @param name \n */\nexport const guardDim = (d: number, name = `Dimension`) => {\n  if (d === undefined) throw new Error(`${ name } is undefined`);\n  if (Number.isNaN(d)) throw new Error(`${ name } is NaN`);\n  if (d < 0) throw new Error(`${ name } cannot be negative`);\n};\n\n/**\n * Throws an error if rectangle is missing fields or they\n * are not valid.\n * \n * Checks:\n * * `width` and `height` must be defined on `rect`\n * * dimensions (w & h) must not be NaN\n * * dimensions (w & h) must not be negative\n * \n * If `rect` has x,y, this value is checked as well.\n * @param rect\n * @param name\n */\nexport const guard = (rect: Rect, name = `rect`) => {\n  if (rect === undefined) throw new Error(`{$name} undefined`);\n  if (isPositioned(rect)) PointsGuard(rect, name);\n  guardDim(rect.width, name + `.width`);\n  guardDim(rect.height, name + `.height`);\n};\n\n/**\n * Returns a positioned rect or if it's not possible, throws an error.\n * \n * If `rect` does not have a position, `origin` is used.\n * If `rect` is positioned and `origin` is provided, returned result uses `origin` as x,y instead.\n * ```js\n * // Returns input because it's positioned\n * getRectPositioned({ x:1, y:2, width:10, height:20 });\n * \n * // Returns { x:1, y:2, width:10, height:20 }\n * getRectPositioned({ width:10, height:20 }, { x:1, y:2 });\n *  \n * // Throws, because we have no point\n * getRectPositioned({width:10,height:20})\n * ```\n * @param rect \n * @param origin \n * @returns \n */\nexport const getRectPositioned = (rect: Rect | RectPositioned, origin?: Point): RectPositioned => {\n  guard(rect);\n  if (isPositioned(rect) && origin === undefined) {\n    return rect;\n  }\n  if (origin === undefined) throw new Error(`Unpositioned rect needs origin parameter`);\n  return Object.freeze({ ...rect, ...origin });\n\n}\n\n/**\n * Throws an error if `rect` is does not have a position, or\n * is an invalid rectangle\n * @param rect \n * @param name \n */\nexport const guardPositioned = (rect: RectPositioned, name = `rect`) => {\n  if (!isPositioned(rect)) throw new Error(`Expected ${ name } to have x,y`);\n  guard(rect, name);\n};\n\n/**\n * Returns _true_ if `rect` has width and height values of 0.\n * Use Rects.Empty or Rects.EmptyPositioned to generate an empty rectangle.\n * @param rect \n * @returns \n */\nexport const isEmpty = (rect: Rect): boolean =>\n  rect.width === 0 && rect.height === 0;\n\n/**\n * Returns _true_ if `rect` is a placeholder, with both width and height values of NaN.\n * Use Rects.Placeholder or Rects.PlaceholderPositioned to generate a placeholder.\n * @param rect \n * @returns \n */\nexport const isPlaceholder = (rect: Rect): boolean =>\n  Number.isNaN(rect.width) && Number.isNaN(rect.height);\n\n/**\n * Returns _true_ if `rect` has position (x,y) fields.\n * @param rect Point, Rect or RectPositiond\n * @returns\n */\nexport const isPositioned = (\n  rect: Point | Rect | RectPositioned\n): rect is Point =>\n  (rect as Point).x !== undefined && (rect as Point).y !== undefined;\n\n/**\n * Returns _true_ if `rect` has width and height fields.\n * @param rect\n * @returns\n */\nexport const isRect = (rect: unknown): rect is Rect => {\n  if (rect === undefined) return false;\n  if ((rect as Rect).width === undefined) return false;\n  if ((rect as Rect).height === undefined) return false;\n  return true;\n};\n\n/**\n * Returns _true_ if `rect` is a positioned rectangle\n * Having width, height, x and y properties.\n * @param rect\n * @returns\n */\nexport const isRectPositioned = (\n  rect: any\n): rect is RectPositioned => isRect(rect) && isPositioned(rect);\n","import { throwNumberTest } from \"../../util/GuardNumbers.js\";\nimport type { Rect } from \"../rect/RectTypes.js\";\nimport { isRect } from \"../rect/Guard.js\";\nimport { isPoint } from \"./Guard.js\";\nimport type { Point } from \"./PointType.js\";\n\n/**\n * Normalises a point by a given width and height\n * @param point Point\n * @param width Width\n * @param height Height\n */\nexport function normaliseByRect(\n  point: Point,\n  width: number,\n  height: number\n): Point;\n\n/**\n * Normalises a point by a given rect's width and height\n * @param pt \n * @param rect \n */\nexport function normaliseByRect(pt: Point, rect: Rect): Point;\n\n/**\n * Normalises x,y by width and height so it is on a 0..1 scale\n * @param x\n * @param y\n * @param width\n * @param height\n */\nexport function normaliseByRect(\n  x: number,\n  y: number,\n  width: number,\n  height: number\n): Point;\n\n/**\n * Normalises a point so it is on a 0..1 scale\n * @param a Point, or x\n * @param b y coord or width\n * @param c height or width\n * @param d height\n * @returns Point\n */\nexport function normaliseByRect(\n  a: Point | number,\n  b: number | Rect,\n  c?: number,\n  d?: number\n): Point {\n  // ✔️ Unit tested\n  if (isPoint(a)) {\n    if (typeof b === `number` && c !== undefined) {\n      throwNumberTest(b, `positive`, `width`);\n      throwNumberTest(c, `positive`, `height`);\n    } else {\n      if (!isRect(b)) {\n        throw new Error(`Expected second parameter to be a rect`);\n      }\n      c = b.height;\n      b = b.width;\n    }\n    return Object.freeze({\n      x: a.x / b,\n      y: a.y / c,\n    });\n  } else {\n    throwNumberTest(a, `positive`, `x`);\n    if (typeof b !== `number`) {\n      throw new TypeError(`Expecting second parameter to be a number (width)`);\n    }\n    if (typeof c !== `number`) {\n      throw new TypeError(`Expecting third parameter to be a number (height)`);\n    }\n\n    throwNumberTest(b, `positive`, `y`);\n    throwNumberTest(c, `positive`, `width`);\n    if (d === undefined) throw new Error(`Expected height parameter`);\n    throwNumberTest(d, `positive`, `height`);\n    return Object.freeze({\n      x: a / c,\n      y: b / d,\n    });\n  }\n}","import { isPoint } from \"./Guard.js\";\nimport type { Point, Point3d } from \"./PointType.js\";\n\n/**\n * Returns a Point form of either a point, x,y params or x,y,z params.\n * If parameters are undefined, an empty point is returned (0, 0)\n * @ignore\n * @param a\n * @param b\n * @returns\n */\nexport function getPointParameter(\n  a?: Point | number | Array<number> | ReadonlyArray<number>,\n  b?: number | boolean,\n  c?: number\n): Point | Point3d {\n  if (a === undefined) return { x: 0, y: 0 };\n\n  if (Array.isArray(a)) {\n    if (a.length === 0) return Object.freeze({ x: 0, y: 0 });\n    if (a.length === 1) return Object.freeze({ x: a[ 0 ], y: 0 });\n    if (a.length === 2) return Object.freeze({ x: a[ 0 ], y: a[ 1 ] });\n    if (a.length === 3) return Object.freeze({ x: a[ 0 ], y: a[ 1 ], z: a[ 2 ] });\n    throw new Error(\n      `Expected array to be 1-3 elements in length. Got ${ a.length }.`\n    );\n  }\n\n  if (isPoint(a)) {\n    return a;\n  } else if (typeof a !== `number` || typeof b !== `number`) {\n    throw new TypeError(\n      `Expected point or x,y as parameters. Got: a: ${ JSON.stringify(\n        a\n      ) } b: ${ JSON.stringify(b) }`\n    );\n  }\n\n  // x,y,z\n  if (typeof c === `number`) {\n    return Object.freeze({ x: a, y: b, z: c });\n  }\n  // x,y\n  return Object.freeze({ x: a, y: b });\n}","import { guard, isPoint3d } from \"./Guard.js\";\nimport type { Point, Point3d } from './PointType.js';\nimport { getPointParameter } from \"./GetPointParameter.js\";\n\nexport function distance(a: Point, b?: Point): number;\nexport function distance(a: Point, x: number, y: number): number;\n\n/**\n * Calculate distance between two points.\n *\n * ```js\n * // Distance between two points\n * const ptA = { x: 0.5, y:0.8 };\n * const ptB = { x: 1, y: 0.4 };\n * distance(ptA, ptB);\n * // Or, provide x,y as parameters\n * distance(ptA, 0.4, 0.9);\n *\n * // Distance from ptA to x: 0.5, y:0.8, z: 0.1\n * const ptC = { x: 0.5, y:0.5, z: 0.3 };\n * // With x,y,z as parameters:\n * distance(ptC, 0.5, 0.8, 0.1);\n * ```\n * @param a First point\n * @param xOrB Second point, or x coord\n * @param y y coord, if x coord is given\n * @param z Optional z coord, if x and y are given.\n * @returns\n */\n//eslint-disable-next-line func-style\nexport function distance(\n  a: Point | Point3d,\n  xOrB?: Point | Point3d | number,\n  y?: number,\n  z?: number\n): number {\n  const pt = getPointParameter(xOrB, y, z);\n  guard(pt, `b`);\n  guard(a, `a`);\n  return isPoint3d(pt) && isPoint3d(a) ? Math.hypot(pt.x - a.x, pt.y - a.y, pt.z - a.z) : Math.hypot(pt.x - a.x, pt.y - a.y);\n}\n","import type { Point } from \"../point/PointType.js\";\nimport type { Line } from \"./LineType.js\";\nimport { distance as PointsDistance } from \"../point/Distance.js\";\nimport { minIndex } from \"../../numbers/NumericArrays.js\";\n/**\n * Returns the nearest point on `line` closest to `point`.\n * \n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * const pt = Lines.nearest(line, {x:10,y:10});\n * ```\n * \n * If an array of lines is provided, it will be the closest point amongst all the lines\n * @param line Line or array of lines\n * @param point\n * @returns Point `{ x, y }`\n */\nexport const nearest = (line: Line | ReadonlyArray<Line>, point: Point): Point => {\n\n  const n = (line: Line): Point => {\n    const { a, b } = line;\n    const atob = { x: b.x - a.x, y: b.y - a.y };\n    const atop = { x: point.x - a.x, y: point.y - a.y };\n    const length = atob.x * atob.x + atob.y * atob.y;\n\n\n    let dot = atop.x * atob.x + atop.y * atob.y;\n    const t = Math.min(1, Math.max(0, dot / length));\n    dot = (b.x - a.x) * (point.y - a.y) - (b.y - a.y) * (point.x - a.x);\n    return { x: a.x + atob.x * t, y: a.y + atob.y * t };\n  };\n\n  if (Array.isArray(line)) {\n    const pts = line.map(l => n(l));\n    const dists = pts.map(p => PointsDistance(p, point));\n    return Object.freeze<Point>(pts[ minIndex(...dists) ]);\n  } else {\n    return Object.freeze<Point>(n(line as Line));\n  }\n};","import type { Point } from \"../point/PointType.js\";\nimport type { Line } from \"./LineType.js\";\nimport { guard } from './Guard.js';\nimport { guard as guardPoint } from '../point/Guard.js';\nimport { length } from \"./Length.js\";\nimport { nearest } from \"./Nearest.js\";\n/**\n * Returns the distance of `point` to the nearest point on `line`\n * \n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * const distance = Lines.distanceSingleLine(line, pt);\n * ```\n * @param line Line\n * @param point Target point\n * @returns \n */\nexport const distanceSingleLine = (line: Line, point: Point): number => {\n  guard(line, `line`);\n  guardPoint(point, `point`);\n\n  if (length(line) === 0) {\n    // Line is really a point\n    return length(line.a, point);\n  }\n\n  const near = nearest(line, point);\n  return length(near, point);\n};","import type { Point } from \"./PointType.js\";\n\n/**\n * Returns the 'minimum' point from an array of points, using a comparison function.\n *\n * @example Find point closest to a coordinate\n * ```js\n * const points = [...];\n * const center = {x: 100, y: 100};\n *\n * const closestToCenter = findMinimum((a, b) => {\n *  const aDist = distance(a, center);\n *  const bDist = distance(b, center);\n *  if (aDistance < bDistance) return a;\n *  return b;\n * }, points);\n * ```\n * @param comparer Compare function returns the smallest of `a` or `b`\n * @param points\n * @returns\n */\nexport const findMinimum = (\n  comparer: (a: Point, b: Point) => Point,\n  ...points: ReadonlyArray<Point>\n): Point => {\n  if (points.length === 0) throw new Error(`No points provided`);\n  let min = points[ 0 ];\n  for (const p of points) {\n    min = comparer(min, p);\n  }\n  return min;\n};","import type { Point } from \"../point/PointType.js\";\nimport type { RectPositioned } from \"./RectTypes.js\";\n\n/**\n * Returns a rectangle based on provided four corners.\n *\n * To create a rectangle that contains an arbitary set of points, use {@link Geometry.Points.bbox | Geometry.Points.bbox}.\n *\n * Does some sanity checking such as:\n *  - x will be smallest of topLeft/bottomLeft\n *  - y will be smallest of topRight/topLeft\n *  - width will be largest between top/bottom left and right\n *  - height will be largest between left and right top/bottom\n *\n */\nexport const maxFromCorners = (\n  topLeft: Point,\n  topRight: Point,\n  bottomRight: Point,\n  bottomLeft: Point\n): RectPositioned => {\n  if (topLeft.y > bottomRight.y) {\n    throw new Error(`topLeft.y greater than bottomRight.y`);\n  }\n  if (topLeft.y > bottomLeft.y) {\n    throw new Error(`topLeft.y greater than bottomLeft.y`);\n  }\n\n  const w1 = topRight.x - topLeft.x;\n  const w2 = bottomRight.x - bottomLeft.x;\n  const h1 = Math.abs(bottomLeft.y - topLeft.y);\n  const h2 = Math.abs(bottomRight.y - topRight.y);\n  return {\n    x: Math.min(topLeft.x, bottomLeft.x),\n    y: Math.min(topRight.y, topLeft.y),\n    width: Math.max(w1, w2),\n    height: Math.max(h1, h2),\n  };\n};\n","import type { RectPositioned } from \"../rect/RectTypes.js\";\nimport { findMinimum } from \"./FindMinimum.js\";\nimport type { Point } from \"./PointType.js\";\nimport { maxFromCorners as RectsMaxFromCorners } from '../rect/Max.js';\n/**\n * Returns the minimum rectangle that can enclose all provided points\n * @param points\n * @returns\n */\nexport const bbox = (...points: ReadonlyArray<Point>): RectPositioned => {\n  const leftMost = findMinimum((a, b) => {\n    return a.x < b.x ? a : b;\n  }, ...points);\n  const rightMost = findMinimum((a, b) => {\n    return a.x > b.x ? a : b;\n  }, ...points);\n  const topMost = findMinimum((a, b) => {\n    return a.y < b.y ? a : b;\n  }, ...points);\n  const bottomMost = findMinimum((a, b) => {\n    return a.y > b.y ? a : b;\n  }, ...points);\n\n  const topLeft = { x: leftMost.x, y: topMost.y };\n  const topRight = { x: rightMost.x, y: topMost.y };\n  const bottomRight = { x: rightMost.x, y: bottomMost.y };\n  const bottomLeft = { x: leftMost.x, y: bottomMost.y };\n  return RectsMaxFromCorners(topLeft, topRight, bottomRight, bottomLeft);\n};\n","import type { RectPositioned } from \"../rect/RectTypes.js\";\nimport type { Line } from \"./LineType.js\";\nimport { bbox as PointsBbox } from \"../point/Bbox.js\";\n/**\n * Returns a rectangle that encompasses dimension of line\n * \n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js';\n * const rect = Lines.bbox(line);\n * ```\n */\nexport const bbox = (line: Line): RectPositioned => PointsBbox(line.a, line.b);\n","import { throwNumberTest } from \"../../util/GuardNumbers.js\";\nimport { getPointParameter } from \"./GetPointParameter.js\";\nimport { guard, guardNonZeroPoint, isPoint } from \"./Guard.js\";\nimport type { Point, Point3d } from \"./PointType.js\";\nimport { guard as RectsGuard, isRect } from '../rect/Guard.js'\nimport type { Rect } from \"../rect/RectTypes.js\";\n/**\n * Divides point a by rectangle:\n * ```js\n * return {\n *  x: a.x / rect.width,\n *  y: a.y / rect.hight\n * };\n * ```\n * \n * Or point:\n * ```js\n * return {\n *  x: a.x / b.x,\n *  y: a.y / b.y\n * }\n * ```\n * \n * \n * Dividing by zero will give Infinity for that dimension.\n * @param a\n * @param rectOrPoint\n */\nexport function divide(a: Point, rectOrPoint: Rect | Point): Point;\n\n/**\n * Divides a point by x,y.\n * ```js\n * return {\n *  x: a.x / x,\n *  y: b.y / y\n * };\n * ```\n * \n * Dividing by zero will give Infinity for that dimension.\n * @param a Point\n * @param x X divisor\n * @param y Y divisor. If unspecified, x divisor is used.\n */\nexport function divide(a: Point, x: number, y?: number): Point;\n\n/**\n * Divides two sets of points:\n * ```js\n * return {\n *  x: x1 / x2,\n *  y: y1 / y2\n * };\n * ```\n * \n * Dividing by zero will give Infinity for that dimension.\n * @param x1\n * @param y1\n * @param x2\n * @param y2\n */\nexport function divide(x1: number, y1: number, x2?: number, y2?: number): Point;\n\n/**\n * Divides a from b. If a contains a zero, that axis will be returned as zero\n * @param a\n * @param b\n * @param c\n * @param d\n * @returns\n */\nexport function divide(\n  a: Point | number,\n  b: Rect | Point | number,\n  c?: number,\n  d?: number\n): Point {\n  // ✔️ Unit tested\n\n  if (isPoint(a)) {\n    guard(a, `a`);\n    if (isPoint(b)) {\n      //guardNonZeroPoint(b);\n      return Object.freeze({\n        x: a.x / b.x,\n        y: a.y / b.y,\n      });\n    } else if (isRect(b)) {\n      RectsGuard(b, `rect`);\n      return Object.freeze({\n        x: a.x / b.width,\n        y: a.y / b.height,\n      });\n    } else {\n      if (c === undefined) c = b;\n      guard(a);\n      throwNumberTest(b, `nonZero`, `x`);\n      throwNumberTest(c, `nonZero`, `y`);\n      return Object.freeze({\n        x: a.x / b,\n        y: a.y / c,\n      });\n    }\n  } else {\n    if (typeof b !== `number`) {\n      throw new TypeError(`expected second parameter to be y1 coord`);\n    }\n    throwNumberTest(a, `positive`, `x1`);\n    throwNumberTest(b, `positive`, `y1`);\n    if (c === undefined) c = 1;\n    if (d === undefined) d = c;\n    throwNumberTest(c, `nonZero`, `x2`);\n    throwNumberTest(d, `nonZero`, `y2`);\n\n    return Object.freeze({\n      x: a / c,\n      y: b / d,\n    });\n  }\n}\n\n/**\n * Returns a function that divides a point:\n * ```js\n * const f = divider(100, 200);\n * f(50,100); // Yields: { x: 0.5, y: 0.5 }\n * ```\n *\n * Input values can be Point, separate x,y and optional z values or an array:\n * ```js\n * const f = divider({ x: 100, y: 100 });\n * const f = divider( 100, 100 );\n * const f = divider([ 100, 100 ]);\n * ```\n *\n * Likewise the returned function an take these as inputs:\n * ```js\n * f({ x: 100, y: 100});\n * f( 100, 100 );\n * f([ 100, 100 ]);\n * ```\n *\n * Function throws if divisor has 0 for any coordinate (since we can't divide by 0)\n * @param a Divisor point, array of points or x\n * @param b Divisor y value\n * @param c Divisor z value\n * @returns\n */\n//eslint-disable-next-line functional/prefer-readonly-type\nexport function divider(a: Point | number | Array<number>, b?: number, c?: number) {\n  const divisor = getPointParameter(a, b, c);\n  guardNonZeroPoint(divisor, `divisor`);\n\n  return (\n    aa: Point | number | Array<number>,\n    bb?: number,\n    cc?: number\n  ): Point | Point3d => {\n    const dividend = getPointParameter(aa, bb, cc);\n\n    return typeof dividend.z === `undefined` ? Object.freeze({\n      x: dividend.x / divisor.x,\n      y: dividend.y / divisor.y,\n    }) : Object.freeze({\n      x: dividend.x / divisor.x,\n      y: dividend.y / divisor.y,\n      z: dividend.z / (divisor.z ?? 1),\n    });\n  };\n}\n","import type { Point } from \"../point/PointType.js\";\nimport type { Line } from \"./LineType.js\";\nimport { divide as PointDivide } from '../point/Divider.js';\n/**\n * Divides both start and end points by given x,y\n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * \n * // Line 1,1 -> 10,10\n * const l = Lines.fromNumbers(1,1,10,10);\n * const ll = Lines.divide(l, {x:2, y:4});\n * // Yields: 0.5,0.25 -> 5,2.5\n * ```\n * \n * Dividing by zero will give Infinity for that dimension.\n * @param line \n * @param point \n * @returns \n */\nexport const divide = (line: Line, point: Point): Line => Object.freeze({\n  ...line,\n  a: PointDivide(line.a, point),\n  b: PointDivide(line.b, point)\n});","import { fromNumbers } from \"./FromNumbers.js\";\nimport type { Line } from \"./LineType.js\";\n\n/**\n * Returns a line from four numbers [x1,y1,x2,y2].\n * \n * See {@link toFlatArray} to create an array from a line.\n * \n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * const line = Lines.fromFlatArray(...[0, 0, 100, 100]);\n * // line is {a: { x:0, y:0 }, b: { x: 100, y: 100 } }\n * ```\n * @param array Array in the form [x1,y1,x2,y2]\n * @returns Line\n */\nexport const fromFlatArray = (array: ReadonlyArray<number>): Line => {\n  if (!Array.isArray(array)) throw new Error(`arr parameter is not an array`);\n  if (array.length !== 4) throw new Error(`array is expected to have length four`);\n  return fromNumbers(array[ 0 ], array[ 1 ], array[ 2 ], array[ 3 ]);\n};","import { degreeToRadian, radianToDegree } from './Angles.js';\nimport { throwNumberTest } from \"../util/GuardNumbers.js\";\nimport type { Point } from './point/PointType.js';\nimport { subtract } from './point/Subtract.js';\nimport { Empty } from './point/Empty.js';\nimport { isPoint, guard as PointGuard } from './point/Guard.js';\n\n//eslint-disable-next-line @typescript-eslint/naming-convention\nconst EmptyCartesian = Object.freeze({ x: 0, y: 0 });\n\n/**\n * Polar coordinate, made up of a distance and angle in radians.\n * Most computations involving PolarCoord require an `origin` as well.\n */\nexport type Coord = {\n  readonly distance: number;\n  readonly angleRadian: number;\n};\n\n/**\n * Converts to Cartesian coordiantes\n */\ntype ToCartesian = {\n  (point: Coord, origin?: Point): Point;\n  (distance: number, angleRadians: number, origin?: Point): Point;\n};\n\n/**\n * Returns true if `p` seems to be a {@link Polar.Coord} (ie has both distance & angleRadian fields)\n * @param p\n * @returns True if `p` seems to be a PolarCoord\n */\nexport const isPolarCoord = (p: unknown): p is Coord => {\n  if ((p as Coord).distance === undefined) return false;\n  if ((p as Coord).angleRadian === undefined) return false;\n  return true;\n};\n\n/**\n * Converts a Cartesian coordinate to polar\n *\n * ```js\n * import { Polar } from 'https://unpkg.com/ixfx/dist/geometry.js';\n *\n * // Yields: { angleRadian, distance }\n * const polar = Polar.fromCartesian({x: 50, y: 50}, origin);\n * ```\n *\n * Any additional properties of `point` are copied to object.\n * @param point Point\n * @param origin Origin\n * @returns\n */\nexport const fromCartesian = (\n  point: Point,\n  origin: Point\n): Coord => {\n  point = subtract(point, origin);\n  //eslint-disable-next-line functional/no-let\n  //let a =  Math.atan2(point.y, point.x);\n  //if (a < 0) a = Math.abs(a);\n  //else a = Math.PI + (Math.PI - a);\n\n  const angle = Math.atan2(point.y, point.x);\n  //if (point.x < 0 && point.y > 0) angle += 180;\n  //if (point.x > 0 && point.y < 0) angle += 360;\n  //if (point.x < 0 && point.y < 0) angle += 180;\n\n  return Object.freeze({\n    ...point,\n    angleRadian: angle,\n    distance: Math.hypot(point.x, point.y),\n  });\n};\n\n/**\n * Converts to Cartesian coordinate from polar.\n *\n * ```js\n * import { Polar } from 'https://unpkg.com/ixfx/dist/geometry.js';\n *\n * const origin = { x: 50, y: 50}; // Polar origin\n * // Yields: { x, y }\n * const polar = Polar.toCartesian({ distance: 10, angleRadian: 0 }, origin);\n * ```\n *\n * Distance and angle can be provided as numbers intead:\n *\n * ```\n * // Yields: { x, y }\n * const polar = Polar.toCartesian(10, 0, origin);\n * ```\n *\n * @param a\n * @param b\n * @param c\n * @returns\n */\nexport const toCartesian: ToCartesian = (\n  a: Coord | number,\n  b?: Point | number,\n  c?: Point\n): Point => {\n  if (isPolarCoord(a)) {\n    if (b === undefined) b = Empty;\n    if (isPoint(b)) {\n      return polarToCartesian(a.distance, a.angleRadian, b);\n    }\n    throw new Error(\n      `Expecting (Coord, Point). Second parameter is not a point`\n    );\n  } else if (typeof a === `object`) {\n    throw new TypeError(\n      `First param is an object, but not a Coord: ${ JSON.stringify(a) }`\n    );\n  } else {\n    if (typeof a === `number` && typeof b === `number`) {\n      if (c === undefined) c = Empty;\n      if (!isPoint(c)) {\n        throw new Error(\n          `Expecting (number, number, Point). Point param wrong type`\n        );\n      }\n      return polarToCartesian(a, b, c);\n    } else {\n      throw new TypeError(\n        `Expecting parameters of (number, number). Got: (${ typeof a }, ${ typeof b }, ${ typeof c }). a: ${ JSON.stringify(\n          a\n        ) }`\n      );\n    }\n  }\n};\n\n/**\n * Produces an Archimedean spiral. It's a generator.\n *\n * ```js\n * const s = spiral(0.1, 1);\n * for (const coord of s) {\n *  // Use Polar coord...\n *  if (coord.step === 1000) break; // Stop after 1000 iterations\n * }\n * ```\n *\n * @param smoothness 0.1 pretty rounded, at around 5 it starts breaking down\n * @param zoom At smoothness 0.1, zoom starting at 1 is OK\n */\n//eslint-disable-next-line func-style\nexport function* spiral(\n  smoothness: number,\n  zoom: number\n): IterableIterator<Coord & { readonly step: number }> {\n  //eslint-disable-next-line functional/no-let\n  let step = 0;\n\n  while (true) {\n    //eslint-disable-next-line functional/no-let\n    const a = smoothness * step++;\n    yield {\n      distance: zoom * a,\n      angleRadian: a,\n      step: step,\n    };\n  }\n}\n\n/**\n * Returns a rotated coordinate\n * @param c Coordinate\n * @param amountRadian Amount to rotate, in radians\n * @returns\n */\nexport const rotate = (c: Coord, amountRadian: number): Coord =>\n  Object.freeze({\n    ...c,\n    angleRadian: c.angleRadian + amountRadian,\n  });\n\nexport const normalise = (c: Coord): Coord => {\n  //guard(v, `v`);\n  if (c.distance === 0) throw new Error(`Cannot normalise vector of length 0`);\n  return Object.freeze({\n    ...c,\n    distance: 1,\n  });\n};\n\n/**\n * Throws an error if Coord is invalid\n * @param p\n * @param name\n */\nexport const guard = (p: Coord, name = `Point`) => {\n  if (p === undefined) {\n    throw new Error(\n      `'${ name }' is undefined. Expected {distance, angleRadian} got ${ JSON.stringify(\n        p\n      ) }`\n    );\n  }\n  if (p === null) {\n    throw new Error(\n      `'${ name }' is null. Expected {distance, angleRadian} got ${ JSON.stringify(\n        p\n      ) }`\n    );\n  }\n  if (p.angleRadian === undefined) {\n    throw new Error(\n      `'${ name }.angleRadian' is undefined. Expected {distance, angleRadian} got ${ JSON.stringify(\n        p\n      ) }`\n    );\n  }\n  if (p.distance === undefined) {\n    throw new Error(\n      `'${ name }.distance' is undefined. Expected {distance, angleRadian} got ${ JSON.stringify(\n        p\n      ) }`\n    );\n  }\n  if (typeof p.angleRadian !== `number`) {\n    throw new TypeError(\n      // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n      `'${ name }.angleRadian' must be a number. Got ${ p.angleRadian }`\n    );\n  }\n  if (typeof p.distance !== `number`) {\n    // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n    throw new TypeError(`'${ name }.distance' must be a number. Got ${ p.distance }`);\n  }\n\n  if (p.angleRadian === null) throw new Error(`'${ name }.angleRadian' is null`);\n  if (p.distance === null) throw new Error(`'${ name }.distance' is null`);\n\n  if (Number.isNaN(p.angleRadian)) {\n    throw new TypeError(`'${ name }.angleRadian' is NaN`);\n  }\n  if (Number.isNaN(p.distance)) throw new Error(`'${ name }.distance' is NaN`);\n};\n/**\n * Calculate dot product of two PolarCoords.\n *\n * Eg, power is the dot product of force and velocity\n *\n * Dot products are also useful for comparing similarity of\n *  angle between two unit PolarCoords.\n * @param a\n * @param b\n * @returns\n */\nexport const dotProduct = (a: Coord, b: Coord): number => {\n  guard(a, `a`);\n  guard(b, `b`);\n  return a.distance * b.distance * Math.cos(b.angleRadian - a.angleRadian);\n};\n\n/**\n * Inverts the direction of coordinate. Ie if pointing north, will point south.\n * @param p\n * @returns\n */\nexport const invert = (p: Coord): Coord => {\n  guard(p, `c`);\n  return Object.freeze({\n    ...p,\n    angleRadian: p.angleRadian - Math.PI,\n  });\n};\n\n/**\n * Returns true if PolarCoords have same magnitude but opposite direction\n * @param a\n * @param b\n * @returns\n */\nexport const isOpposite = (a: Coord, b: Coord): boolean => {\n  guard(a, `a`);\n  guard(b, `b`);\n  if (a.distance !== b.distance) return false;\n  return a.angleRadian === -b.angleRadian;\n};\n\n/**\n * Returns true if Coords have the same direction, regardless of magnitude\n * @param a\n * @param b\n * @returns\n */\nexport const isParallel = (a: Coord, b: Coord): boolean => {\n  guard(a, `a`);\n  guard(b, `b`);\n  return a.angleRadian === b.angleRadian;\n};\n\n/**\n * Returns true if coords are opposite direction, regardless of magnitude\n * @param a\n * @param b\n * @returns\n */\nexport const isAntiParallel = (a: Coord, b: Coord): boolean => {\n  guard(a, `a`);\n  guard(b, `b`);\n  return a.angleRadian === -b.angleRadian;\n};\n\n/**\n * Returns a rotated coordinate\n * @param c Coordinate\n * @param amountDeg Amount to rotate, in degrees\n * @returns\n */\nexport const rotateDegrees = (c: Coord, amountDeg: number): Coord =>\n  Object.freeze({\n    ...c,\n    angleRadian: c.angleRadian + degreeToRadian(amountDeg),\n  });\n\n/**\n * Produces an Archimedian spiral with manual stepping.\n * @param step Step number. Typically 0, 1, 2 ...\n * @param smoothness 0.1 pretty rounded, at around 5 it starts breaking down\n * @param zoom At smoothness 0.1, zoom starting at 1 is OK\n * @returns\n */\nexport const spiralRaw = (\n  step: number,\n  smoothness: number,\n  zoom: number\n): Coord => {\n  const a = smoothness * step;\n  return Object.freeze({\n    distance: zoom * a,\n    angleRadian: a,\n  });\n};\n\n/**\n * Multiplies the magnitude of a coord by `amt`.\n * Direction is unchanged.\n * @param v\n * @param amt\n * @returns\n */\nexport const multiply = (v: Coord, amt: number): Coord => {\n  guard(v);\n  throwNumberTest(amt, ``, `amt`);\n  return Object.freeze({\n    ...v,\n    distance: v.distance * amt,\n  });\n};\n\n/**\n * Divides the magnitude of a coord by `amt`.\n * Direction is unchanged.\n * @param v\n * @param amt\n * @returns\n */\nexport const divide = (v: Coord, amt: number): Coord => {\n  guard(v);\n  throwNumberTest(amt, ``, `amt`);\n  return Object.freeze({\n    ...v,\n    distance: v.distance / amt,\n  });\n};\n\n/**\n * Clamps the magnitude of a vector\n * @param v\n * @param max\n * @param min\n * @returns\n */\nexport const clampMagnitude = (v: Coord, max = 1, min = 0): Coord => {\n  let mag = v.distance;\n  if (mag > max) mag = max;\n  if (mag < min) mag = min;\n  return Object.freeze({\n    ...v,\n    distance: mag,\n  });\n};\n\n/**\n * Converts a polar coordinate to Cartesian\n * @param distance Distance\n * @param angleRadians Angle in radians\n * @param origin Origin, or 0,0 by default.\n * @returns\n */\nconst polarToCartesian = (\n  distance: number,\n  angleRadians: number,\n  origin: Point = Empty\n): Point => {\n  PointGuard(origin);\n  return Object.freeze({\n    x: origin.x + distance * Math.cos(angleRadians),\n    y: origin.y + distance * Math.sin(angleRadians),\n  });\n};\n\n/**\n * Returns a human-friendly string representation `(distance, angleDeg)`.\n * If `precision` is supplied, this will be the number of significant digits.\n * @param p\n * @returns\n */\nexport const toString = (p: Coord, digits?: number): string => {\n  if (p === undefined) return `(undefined)`;\n  if (p === null) return `(null)`;\n\n  const angleDeg = radianToDegree(p.angleRadian);\n  const d = digits ? p.distance.toFixed(digits) : p.distance;\n  const a = digits ? angleDeg.toFixed(digits) : angleDeg;\n  return `(${ d },${ a })`;\n};\n\nexport const toPoint = (v: Coord, origin = EmptyCartesian): Point => {\n  guard(v, `v`);\n  return Object.freeze({\n    x: origin.x + v.distance * Math.cos(v.angleRadian),\n    y: origin.y + v.distance * Math.sin(v.angleRadian),\n  });\n};\n","import type { Point } from './point/PointType.js';\n/**\n * Convert angle in degrees to angle in radians.\n * @param angleInDegrees \n * @returns \n */\nexport function degreeToRadian(angleInDegrees: number): number;\n\n/**\n * Convert angles in degrees to angles in radians\n * @param angleInDegrees \n */\nexport function degreeToRadian(angleInDegrees: ReadonlyArray<number>): ReadonlyArray<number>;\n\n//eslint-disable-next-line func-style\nexport function degreeToRadian(angleInDegrees: number | ReadonlyArray<number>): number | ReadonlyArray<number> {\n  return Array.isArray(angleInDegrees) ? angleInDegrees.map(v => v * (Math.PI / 180)) : (angleInDegrees as number) * (Math.PI / 180);\n}\n\nexport function radianInvert(angleInRadians: number) {\n  return (angleInRadians + Math.PI) % (2 * Math.PI);\n}\n\n/**\n * Convert angle in radians to angle in degrees\n * @param angleInRadians\n * @returns \n */\nexport function radianToDegree(angleInRadians: number): number;\n\n/**\n * Convert angles in radians to angles in degrees\n * @param angleInRadians \n */\nexport function radianToDegree(angleInRadians: ReadonlyArray<number>): ReadonlyArray<number>;\n\n//eslint-disable-next-line func-style\nexport function radianToDegree(angleInRadians: number | ReadonlyArray<number>): number | ReadonlyArray<number> {\n  return Array.isArray(angleInRadians) ? angleInRadians.map(v => v * 180 / Math.PI) : (angleInRadians as number) * 180 / Math.PI;\n}\n\n\n/**\n * Angle from x-axis to point (ie. `Math.atan2`)\n * @param point \n * @returns \n */\nexport const radiansFromAxisX = (point: Point): number => Math.atan2(point.x, point.y);\n","import { throwNumberTest } from \"../../util/GuardNumbers.js\";\nimport { guard, isPoint } from \"./Guard.js\";\nimport type { Point } from \"./PointType.js\";\n\n/**\n * Returns `a` minus `b`\n *\n * ie.\n * ```js\n * return {\n *   x: a.x - b.x,\n *   y: a.y - b.y\n * };\n * ```\n * @param a Point a\n * @param b Point b\n * @returns Point\n */\nexport function subtract(a: Point, b: Point): Point;\n\n/**\n * Returns `a` minus the given coordinates.\n *\n * ie:\n * ```js\n * return {\n *  x: a.x - x,\n *  y: a.y - y\n * }\n * ```\n * @param a Point\n * @param x X coordinate\n * @param y Y coordinate (if omitted, x is used as well)\n */\nexport function subtract(a: Point, x: number, y?: number): Point;\n\n/**\n * Subtracts two sets of x,y pairs.\n *\n * If first parameter is a Point, any additional properties of it\n * are included in returned Point.\n * @param x1\n * @param y1\n * @param x2\n * @param y2\n */\nexport function subtract(x1: number, y1: number, x2: number, y2: number): Point;\n\n//eslint-disable-next-line func-style\nexport function subtract(\n  a: Point | number,\n  b: Point | number,\n  c?: number,\n  d?: number\n): Point {\n  if (isPoint(a)) {\n    guard(a, `a`);\n    if (isPoint(b)) {\n      guard(b, `b`);\n      return Object.freeze({\n        ...a,\n        x: a.x - b.x,\n        y: a.y - b.y,\n      });\n    } else {\n      if (c === undefined) c = b;\n      return Object.freeze({\n        ...a,\n        x: a.x - b,\n        y: a.y - c,\n      });\n    }\n  } else {\n    throwNumberTest(a, ``, `a`);\n    if (typeof b !== `number`) {\n      throw new TypeError(`Second parameter is expected to by y value`);\n    }\n    throwNumberTest(b, ``, `b`);\n\n    if (Number.isNaN(c)) throw new Error(`Third parameter is NaN`);\n    if (Number.isNaN(d)) throw new Error(`Fourth parameter is NaN`);\n\n    if (c === undefined) c = 0;\n    if (d === undefined) d = 0;\n    return Object.freeze({\n      x: a - c,\n      y: b - d,\n    });\n  }\n}\n","/**\n * An empty point of `{ x:0, y:0 }`.\n *\n * Use `isEmpty` to check if a point is empty.\n */\nexport const Empty = { x: 0, y: 0 } as const;","import type { Point } from \"../point/PointType.js\"\nimport * as Polar from \"../Polar.js\";\nimport { radianInvert } from \"../Angles.js\";\n\n/**\n * Creates a line from an origin point.\n * ```js\n * // Line of length 0.2 with middle at 0.5,0.5\n * fromPivot({ x:0.5, y:0.5 }, 0.2);\n * // Same line, but on an angle\n * fromPivot({ x:0.5, y:0.5 }, 0.2, degreesToRadian(45));\n * \n * // ...now with pivot point at 20%, rather than center\n * fromPivot({ x:0.5, y:0.5 }, 0.2, degreesToRadian(45), 0.2);\n * ```\n * \n * Examples:\n * * Angle of 0 (deg/rad) results in a horizontal line,\n * * Angle of 90deg in a vertical line. \n * * Angle of 45deg will be angled downwards.\n * \n * @param origin Origin to pivot around\n * @param length Total length of line\n * @param angleRadian Angle of line, in radians\n * @param balance Percentage of where origin ought to be on line. Default: 0.5, meaning the middle of line\n */\nexport const fromPivot = (origin: Point = { x: 0.5, y: 0.5 }, length: number = 1, angleRadian: number = 0, balance: number = 0.5) => {\n  const left = length * balance;\n  const right = length * (1 - balance);\n  const a = Polar.toCartesian(left, radianInvert(angleRadian), origin);\n  const b = Polar.toCartesian(right, angleRadian, origin);\n  return Object.freeze({\n    a, b\n  });\n}","import type { Point } from \"../point/PointType.js\";\nimport { fromPoints } from \"./FromPoints.js\";\nimport type { LinePath } from \"./LinePathType.js\";\nimport { toPath } from \"./ToPath.js\";\n\n/**\n * Returns a {@link LinePath} from two points\n * \n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * const path = Lines.fromPointsToPath(ptA, ptB);\n * ```\n * @param a \n * @param b \n * @returns \n */\nexport const fromPointsToPath = (a: Point, b: Point): LinePath => toPath(fromPoints(a, b));\n","import type { Point } from \"./PointType.js\";\n\n/**\n * Returns _true_ if the points have identical values\n *\n * ```js\n * const a = {x: 10, y: 10};\n * const b = {x: 10, y: 10;};\n * a === b        // False, because a and be are different objects\n * isEqual(a, b)   // True, because a and b are same value\n * ```\n * @param p Points\n * @returns _True_ if points are equal\n */\nexport const isEqual = (...p: ReadonlyArray<Point>): boolean => {\n  if (p === undefined) throw new Error(`parameter 'p' is undefined`);\n  if (p.length < 2) return true;\n\n  for (let index = 1; index < p.length; index++) {\n    if (p[ index ].x !== p[ 0 ].x) return false;\n    if (p[ index ].y !== p[ 0 ].y) return false;\n  }\n  return true;\n};","import type { Line } from \"./LineType.js\";\nimport { isEqual as PointsIsEqual } from '../point/IsEqual.js';\n/**\n * Returns true if the lines have the same value. Note that only\n * the line start and end points are compared. So the lines might\n * be different in other properties, and `isEqual` will still return\n * true.\n * \n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * const a = { a: {x:0,  y: 10 }, b: { x: 20, y: 20 }};\n * const b = { a: {x:0,  y: 10 }, b: { x: 20, y: 20 }};\n * a === b; // false, because they are different objects\n * Lines.isEqual(a, b); // true, because they have the same value\n * ```\n * @param {Line} a\n * @param {Line} b\n * @returns {boolean}\n */\nexport const isEqual = (a: Line, b: Line): boolean => PointsIsEqual(a.a, b.a) && PointsIsEqual(a.b, b.b);","export * from './Abs.js';\nexport * from './Angle.js';\nexport * from './Apply.js';\nexport * from './Bbox.js';\nexport * from './Centroid.js';\nexport * from './Clamp.js';\nexport * from './Compare.js';\nexport * from './ConvexHull.js';\nexport * from './Distance.js';\nexport * from './DistanceToCenter.js';\nexport * from './DistanceToExterior.js';\nexport * from './Divider.js';\nexport * from './DotProduct.js';\nexport * from './Empty.js';\nexport * from './FindMinimum.js';\nexport * from './From.js';\nexport * from './GetPointParameter.js';\nexport * from './Guard.js';\nexport * from './Interpolate.js';\nexport * from './Invert.js';\nexport * from './IsEqual.js';\nexport * from './Magnitude.js';\nexport * from './Most.js';\nexport * from './Multiply.js';\nexport * from './Normalise.js';\nexport * from './NormaliseByRect.js';\nexport * from './Pipeline.js';\nexport * from './PointRelationTypes.js';\nexport * from './PointType.js';\nexport * from './ProgressBetween.js';\nexport * from './Project.js';\nexport * from './Quantise.js';\nexport * from './Random.js';\nexport * from './Reduce.js';\nexport * from './Relation.js';\nexport * from './Rotate.js';\nexport * from './RotatePointArray.js';\nexport * from './Round.js';\nexport * from './Subtract.js';\nexport * from './Sum.js';\nexport * from './To.js';\nexport * from './ToArray.js';\nexport * from './WithinRange.js';\nexport * from './Wrap.js';\nexport type { Point, Point3d } from './PointType.js';\n","import type { Point } from \"./PointType.js\";\n\n/**\n * Returns a point with Math.abs applied to x and y.\n * ```js\n * Points.abs({ x:1,  y:1  }); // { x: 1, y: 1 }\n * Points.abs({ x:-1, y:1  }); // { x: 1, y: 1 }\n * Points.abs({ x:-1, y:-1 }); // { x: 1, y: 1 }\n * ```\n * @param pt\n * @returns\n */\nexport const abs = (pt: Point) => ({\n  ...pt,\n  x: Math.abs(pt.x),\n  y: Math.abs(pt.y),\n});","import { guard } from \"./Guard.js\";\nimport type { Point } from \"./PointType.js\";\n\n/**\n * Returns the angle in radians between `a` and `b`.\n *\n * Eg if `a` is the origin, and `b` is another point,\n * in degrees one would get 0 to -180 when `b` was above `a`.\n *  -180 would be `b` in line with `a`.\n * Same for under `a`.\n *\n * Providing a third point `c` gives the interior angle, where `b` is the middle point.\n * @param a\n * @param b\n * @param c\n * @returns\n */\nexport const angleRadian = (a: Point, b?: Point, c?: Point) => {\n  guard(a, `a`);\n\n  if (b === undefined) {\n    return Math.atan2(a.y, a.x);\n  }\n  guard(b, `b`);\n  if (c === undefined) {\n    return Math.atan2(b.y - a.y, b.x - a.x);\n  }\n\n  guard(c, `c`);\n  return Math.atan2(b.y - a.y, b.x - a.x) - Math.atan2(c.y - a.y, c.x - a.x);\n};","import { guard } from \"./Guard.js\";\nimport type { Point } from \"./PointType.js\";\n\n/**\n * Applies `fn` on `x` and `y` fields, returning all other fields as well\n * ```js\n * const p = {x:1.234, y:4.9};\n * const p2 = Points.apply(p, Math.round);\n * // Yields: {x:1, y:5}\n * ```\n *\n * The name of the field is provided as well. Here we only round the `x` field:\n *\n * ```js\n * const p = {x:1.234, y:4.9};\n * const p2 = Points.apply(p, (v, field) => {\n *  if (field === `x`) return Math.round(v);\n *  return v;\n * });\n * ```\n * @param pt\n * @param fn\n * @returns\n */\nexport const apply = (\n  pt: Point,\n  fn: (v: number, field?: string) => number\n): Point => {\n  guard(pt, `pt`);\n\n  return Object.freeze<Point>({\n    ...pt,\n    x: fn(pt.x, `x`),\n    y: fn(pt.y, `y`),\n  });\n}","import { isPoint } from \"./Guard.js\";\nimport type { Point } from \"./PointType.js\";\n\n/**\n * Calculates the [centroid](https://en.wikipedia.org/wiki/Centroid#Of_a_finite_set_of_points) of a set of points\n * Undefined values are skipped over.\n *\n * ```js\n * // Find centroid of a list of points\n * const c1 = centroid(p1, p2, p3, ...);\n *\n * // Find centroid of an array of points\n * const c2 = centroid(...pointsArray);\n * ```\n * @param points\n * @returns A single point\n */\nexport const centroid = (...points: ReadonlyArray<Point | undefined>): Point => {\n  if (!Array.isArray(points)) throw new Error(`Expected list of points`);\n  // eslint-disable-next-line unicorn/no-array-reduce\n  const sum = points.reduce<Point>(\n    (previous, p) => {\n      if (p === undefined) return previous; // Ignore undefined\n      if (Array.isArray(p)) {\n        throw new TypeError(\n          `'points' list contains an array. Did you mean: centroid(...myPoints)?`\n        );\n      }\n      if (!isPoint(p)) {\n        throw new Error(\n          `'points' contains something which is not a point: ${ JSON.stringify(\n            p\n          ) }`\n        );\n      }\n      return {\n        x: previous.x + p.x,\n        y: previous.y + p.y,\n      };\n    },\n    { x: 0, y: 0 }\n  );\n\n  return Object.freeze({\n    x: sum.x / points.length,\n    y: sum.y / points.length,\n  });\n};\n\n","import { clamp as clampNumber } from '../../numbers/Clamp.js';\nimport { throwNumberTest } from \"../../util/GuardNumbers.js\";\nimport { isPoint } from \"./Guard.js\";\nimport type { Point } from \"./PointType.js\";\n\n\n/**\n * Clamps a point to be between `min` and `max` (0 & 1 by default)\n * @param pt Point\n * @param min Minimum value (0 by default)\n * @param max Maximum value (1 by default)\n */\nexport function clamp(pt: Point, min?: number, max?: number): Point;\n\n/**\n * Clamps an x,y pair to be between `min` and `max` (0 & 1 by default)\n * @param x X coordinate\n * @param y Y coordinate\n * @param min Minimum value (0 by default)\n * @param max Maximum value (1 by default)\n */\nexport function clamp(x: number, y: number, min?: number, max?: number): Point;\nexport function clamp(\n  a: Point | number,\n  b?: number,\n  c?: number,\n  d?: number\n): Point {\n  // ✔️ Unit tested\n\n  if (isPoint(a)) {\n    if (b === undefined) b = 0;\n    if (c === undefined) c = 1;\n    throwNumberTest(b, ``, `min`);\n    throwNumberTest(c, ``, `max`);\n    return Object.freeze({\n      x: clampNumber(a.x, b, c),\n      y: clampNumber(a.y, b, c),\n    });\n  } else {\n    if (b === undefined) throw new Error(`Expected y coordinate`);\n    if (c === undefined) c = 0;\n    if (d === undefined) d = 1;\n    throwNumberTest(a, ``, `x`);\n    throwNumberTest(b, ``, `y`);\n    throwNumberTest(c, ``, `min`);\n    throwNumberTest(d, ``, `max`);\n\n    return Object.freeze({\n      x: clampNumber(a, c, d),\n      y: clampNumber(b, c, d),\n    });\n  }\n}\n","import type { Point } from \"./PointType.js\";\n\n/**\n * Returns -2 if both x & y of a is less than b\n * Returns -1 if either x/y of a is less than b\n *\n * Returns 2 if both x & y of a is greater than b\n * Returns 1 if either x/y of a is greater than b's x/y\n *\n * Returns 0 if x/y of a and b are equal\n * @param a\n * @param b\n * @returns\n */\nexport const compare = (a: Point, b: Point): number => {\n  if (a.x < b.x && a.y < b.y) return -2;\n  if (a.x > b.x && a.y > b.y) return 2;\n  if (a.x < b.x || a.y < b.y) return -1;\n  if (a.x > b.x || a.y > b.y) return 1;\n  if (a.x === b.x && a.x === b.y) return 0;\n  return Number.NaN;\n};\n\n/**\n * Compares points based on x value. Y value is ignored.\n * \n * Return values:\n * * 0: If a.x === b.x\n * * 1: a is to the right of b (ie. a.x > b.x)\n * * -1: a is to the left of b (ie. a.x < b.x)\n *\n * @example Sorting by x\n * ```js\n * arrayOfPoints.sort(Points.compareByX);\n * ```\n * \n * @param a\n * @param b\n * @returns\n */\nexport const compareByX = (a: Point, b: Point): number => {\n  if (a.x === b.x) return 0;\n  if (a.x < b.x) return -1;\n  return 1;\n\n  // a.x - b.x || a.y - b.y;\n}\n\n/**\n * Compares points based on Y value. X value is ignored.\n * Returns values:\n * * 0: If a.y === b.y\n * * 1: A is below B (ie. a.y > b.y)\n * * -1: A is above B (ie. a.y < b.y)\n *\n * @example Sorting by Y\n * ```js\n * arrayOfPoints.sort(Points.compareByY);\n * ```\n * @param a\n * @param b\n * @returns\n */\nexport const compareByY = (a: Point, b: Point): number => {\n  if (a.y === b.y) return 0;\n  if (a.y < b.y) return -1;\n  return 1;\n}","import { compareByX } from \"./Compare.js\";\nimport { isEqual } from \"./IsEqual.js\";\nimport type { Point } from \"./PointType.js\";\n\n/**\n * Simple convex hull impementation. Returns a set of points which\n * enclose `pts`.\n *\n * For more power, see something like [Hull.js](https://github.com/AndriiHeonia/hull)\n * @param pts\n * @returns\n */\nexport const convexHull = (...pts: ReadonlyArray<Point>): ReadonlyArray<Point> => {\n  const sorted = [ ...pts ].sort(compareByX);\n  if (sorted.length === 1) return sorted;\n\n  const x = (points: Array<Point>) => {\n    const v: Array<Point> = [];\n    for (const p of points) {\n      while (v.length >= 2) {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        const q = v.at(-1)!;\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        const r = v.at(-2)!;\n        if ((q.x - r.x) * (p.y - r.y) >= (q.y - r.y) * (p.x - r.x)) {\n          //eslint-disable-next-line functional/immutable-data\n          v.pop();\n        } else break;\n      }\n      //eslint-disable-next-line functional/immutable-data\n      v.push(p);\n    }\n    //eslint-disable-next-line functional/immutable-data\n    v.pop();\n    return v;\n  };\n\n  const upper = x(sorted);\n  //eslint-disable-next-line functional/immutable-data\n  const lower = x(sorted.reverse());\n\n  if (upper.length === 1 && lower.length === 1 && isEqual(lower[ 0 ], upper[ 0 ])) {\n    return upper;\n  }\n  return [ ...upper, ...lower ];\n};","import { guard as guardPoint } from '../point/Guard.js';\nimport type { Point } from '../point/PointType.js';\nimport type { Circle, CirclePositioned } from './CircleType.js';\n\n/**\n * Throws if radius is out of range. If x,y is present, these will be validated too.\n * @param circle \n * @param parameterName \n */\nexport const guard = (circle: CirclePositioned | Circle, parameterName = `circle`) => {\n  if (isCirclePositioned(circle)) {\n    guardPoint(circle, `circle`);\n  }\n\n  if (Number.isNaN(circle.radius)) throw new Error(`${ parameterName }.radius is NaN`);\n  if (circle.radius <= 0) throw new Error(`${ parameterName }.radius must be greater than zero`);\n};\n\n/**\n * Throws if `circle` is not positioned or has dodgy fields\n * @param circle \n * @param parameterName \n * @returns \n */\nexport const guardPositioned = (circle: CirclePositioned, parameterName = `circle`) => {\n  if (!isCirclePositioned(circle)) throw new Error(`Expected a positioned circle with x,y`);\n  guard(circle, parameterName);\n};\n\n/***\n * Returns true if radius, x or y are NaN\n */\nexport const isNaN = (a: Circle | CirclePositioned): boolean => {\n  if (Number.isNaN(a.radius)) return true;\n  if (isCirclePositioned(a)) {\n    if (Number.isNaN(a.x)) return true;\n    if (Number.isNaN(a.y)) return true;\n  }\n  return false;\n};\n\n\n/**\n * Returns true if parameter has x,y. Does not verify if parameter is a circle or not\n * \n * ```js\n * import { Circles } from \"https://unpkg.com/ixfx/dist/geometry.js\" \n * \n * const circleA = { radius: 5 };\n * Circles.isPositioned(circle); // false\n * \n * const circleB = { radius: 5, x: 10, y: 10 }\n * Circles.isPositioned(circle); // true\n * ```\n * @param p Circle\n * @returns \n */\nexport const isPositioned = (p: Circle | Point): p is Point => (p as Point).x !== undefined && (p as Point).y !== undefined;\n//eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport const isCircle = (p: any): p is Circle => (p as Circle).radius !== undefined;\n//eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport const isCirclePositioned = (p: any): p is CirclePositioned => isCircle(p) && isPositioned(p);","import type { CirclePositioned } from \"./CircleType.js\";\nimport { distance as pointsDistance } from '../point/Distance.js';\nimport { guardPositioned, isCirclePositioned } from \"./Guard.js\";\nimport type { Point } from '../point/PointType.js';\n\n/**\n * Returns the distance between two circle centers.\n * \n * ```js\n * import { Circles } from \"https://unpkg.com/ixfx/dist/geometry.js\" \n * const circleA = { radius: 5, x: 5, y: 5 }\n * const circleB = { radius: 10, x: 20, y: 20 }\n * const distance = Circles.distanceCenter(circleA, circleB);\n * ```\n * Throws an error if either is lacking position.\n * @param a \n * @param b \n * @returns Distance\n */\nexport const distanceCenter = (a: CirclePositioned, b: CirclePositioned | Point): number => {\n  guardPositioned(a, `a`);\n  if (isCirclePositioned(b)) {\n    guardPositioned(b, `b`);\n  }\n  return pointsDistance(a, b);\n};\n","import type { CirclePositioned } from \"./CircleType.js\";\nimport { distanceCenter } from \"./DistanceCenter.js\";\nimport { isPoint as PointsIsPoint } from \"../point/Guard.js\";\nimport { distance as PointsDistance } from \"../point/Distance.js\";\nimport { guardPositioned, isCirclePositioned } from \"./Guard.js\";\nimport type { Point } from '../point/PointType.js';\n\n/**\n * Returns the distance between the exterior of two circles, or between the exterior of a circle and point.\n * If `b` overlaps or is enclosed by `a`, distance is 0.\n * \n * ```js\n * import { Circles } from \"https://unpkg.com/ixfx/dist/geometry.js\" \n * const circleA = { radius: 5, x: 5, y: 5 }\n * const circleB = { radius: 10, x: 20, y: 20 }\n * const distance = Circles.distanceCenter(circleA, circleB);\n * ```\n * @param a\n * @param b \n */\nexport const distanceFromExterior = (a: CirclePositioned, b: CirclePositioned | Point): number => {\n  guardPositioned(a, `a`);\n  if (isCirclePositioned(b)) {\n    return Math.max(0, distanceCenter(a, b) - a.radius - b.radius);\n  } else if (PointsIsPoint(b)) {\n    const distribution = PointsDistance(a, b);\n    if (distribution < a.radius) return 0;\n    return distribution;\n  } else throw new Error(`Second parameter invalid type`);\n};","import type { Circle, CirclePositioned } from \"./CircleType.js\";\nimport { isCirclePositioned } from \"./Guard.js\";\n\n/**\n * Returns true if the two objects have the same values\n *\n * ```js\n * const circleA = { radius: 10, x: 5, y: 5 };\n * const circleB = { radius: 10, x: 5, y: 5 };\n * \n * circleA === circleB; // false, because identity of objects is different\n * Circles.isEqual(circleA, circleB); // true, because values are the same\n * ```\n * \n * Circles must both be positioned or not.\n * @param a\n * @param b\n * @returns\n */\nexport const isEqual = (a: CirclePositioned | Circle, b: CirclePositioned | Circle): boolean => {\n  if (a.radius !== b.radius) return false;\n\n  if (isCirclePositioned(a) && isCirclePositioned(b)) {\n    if (a.x !== b.x) return false;\n    if (a.y !== b.y) return false;\n    if (a.z !== b.z) return false;\n    return true;\n  } else if (!isCirclePositioned(a) && !isCirclePositioned(b)) {\n    // no-op\n  } else return false; // one is positioned one not\n\n  return false;\n};","import { Empty } from \"./Empty.js\";\nimport { guard, isPoint } from \"./Guard.js\";\nimport type { Point } from \"./PointType.js\";\n\ntype Sum = {\n  /**\n   * Adds two sets of coordinates. If y is omitted, the parameter for x is added to both x and y\n   */\n  (aX: number, aY: number, bX: number, bY: number): Point;\n  /**\n   * Add x,y to a\n   */\n  (a: Point, x: number, y?: number): Point;\n  /**\n   * Add two points\n   */\n  (a: Point, b?: Point): Point;\n};\n\n/**\n * Returns a Point of `a` plus `b`. ie:\n *\n * ```js\n * return {\n *   x: a.x + b.x,\n *   y: a.y + b.y\n * };\n * ```\n *\n * Usage:\n *\n * ```js\n * sum(ptA, ptB);\n * sum(x1, y1, x2, y2);\n * sum(ptA, x2, y2);\n * sum(ptA, xAndY);\n * ```\n */\nexport const sum: Sum = function (\n  a: Point | number,\n  b: Point | number | undefined,\n  c?: number,\n  d?: number\n): Point {\n  // ✔️ Unit tested\n  if (a === undefined) throw new TypeError(`a missing`);\n\n  let ptA: Point | undefined;\n  let ptB: Point | undefined;\n  if (isPoint(a)) {\n    ptA = a;\n    if (b === undefined) b = Empty;\n    if (isPoint(b)) {\n      ptB = b;\n    } else {\n      if (b === undefined) throw new Error(`Expects x coordinate`);\n      ptB = { x: b, y: c ?? b };\n    }\n  } else if (!isPoint(b)) {\n    // Neither of first two params are points\n    if (b === undefined) throw new Error(`Expected number as second param`);\n    ptA = { x: a, y: b };\n    if (c === undefined) throw new Error(`Expects x coordiante`);\n    ptB = { x: c, y: d ?? 0 };\n  }\n\n  if (ptA === undefined) throw new Error(`ptA missing. a: ${ JSON.stringify(a) }`);\n  if (ptB === undefined) throw new Error(`ptB missing. b: ${ JSON.stringify(b) }`);\n  guard(ptA, `a`);\n  guard(ptB, `b`);\n  return Object.freeze({\n    x: ptA.x + ptB.x,\n    y: ptA.y + ptB.y,\n  });\n};\n","import { isEqual } from \"./IsEqual.js\";\nimport { sum as PointsSum } from \"../point/Sum.js\";\nimport { subtract as PointsSubtract } from \"../point/Subtract.js\";\nimport type { Point } from '../point/PointType.js';\nimport type { CirclePositioned } from \"./CircleType.js\";\nimport type { Line } from \"../line/LineType.js\";\n\n/**\n * Returns the point(s) of intersection between a circle and line.\n * \n * ```js\n * import { Circles } from \"https://unpkg.com/ixfx/dist/geometry.js\" \n * const circle = { radius: 5, x: 5, y: 5 };\n * const line = { a: { x: 0, y: 0 }, b: { x: 10, y: 10 } };\n * const pts = Circles.intersectionLine(circle, line);\n * ```\n * @param circle \n * @param line \n * @returns Point(s) of intersection, or empty array\n */\nexport const intersectionLine = (circle: CirclePositioned, line: Line): ReadonlyArray<Point> => {\n  const v1 = {\n    x: line.b.x - line.a.x,\n    y: line.b.y - line.a.y\n  };\n  const v2 = {\n    x: line.a.x - circle.x,\n    y: line.a.y - circle.y\n  };\n\n  const b = (v1.x * v2.x + v1.y * v2.y) * -2;\n  const c = 2 * (v1.x * v1.x + v1.y * v1.y);\n\n  const d = Math.sqrt(b * b - 2 * c * (v2.x * v2.x + v2.y * v2.y - circle.radius * circle.radius));\n  if (Number.isNaN(d)) return []; // no intercept\n\n  const u1 = (b - d) / c;  // these represent the unit distance of point one and two on the line\n  const u2 = (b + d) / c;\n\n  const returnValue = [];\n  if (u1 <= 1 && u1 >= 0) {  // add point if on the line segment\n    //eslint-disable-next-line functional/immutable-data\n    returnValue.push({\n      x: line.a.x + v1.x * u1,\n      y: line.a.y + v1.y * u1\n    });\n  }\n  if (u2 <= 1 && u2 >= 0) {  // second add point if on the line segment\n    //eslint-disable-next-line functional/immutable-data\n    returnValue.push({\n      x: line.a.x + v1.x * u2,\n      y: line.a.y + v1.y * u2\n    });\n  }\n  return returnValue;\n};\n\n\n/**\n * \n * Returns the points of intersection betweeen `a` and `b`.\n * \n * Returns an empty array if circles are equal, one contains the other or if they don't touch at all.\n *\n * @param a Circle\n * @param b Circle\n * @returns Points of intersection, or an empty list if there are none\n */\nexport const intersections = (a: CirclePositioned, b: CirclePositioned): ReadonlyArray<Point> => {\n  const vector = PointsSubtract(b, a);\n  const centerD = Math.hypot((vector.y), (vector.x));\n\n  // Do not intersect\n  if (centerD > a.radius + b.radius) return [];\n\n  // Circle contains another\n  if (centerD < Math.abs(a.radius - b.radius)) return [];\n\n  // Circles are the same\n  if (isEqual(a, b)) return [];\n\n  const centroidD = ((a.radius * a.radius) - (b.radius * b.radius) + (centerD * centerD)) / (2 * centerD);\n  const centroid = {\n    x: a.x + (vector.x * centroidD / centerD),\n    y: a.y + (vector.y * centroidD / centerD)\n  };\n\n  const centroidIntersectionD = Math.sqrt((a.radius * a.radius) - (centroidD * centroidD));\n\n  const intersection = {\n    x: -vector.y * (centroidIntersectionD / centerD),\n    y: vector.x * (centroidIntersectionD / centerD)\n  };\n  return [\n    PointsSum(centroid, intersection),\n    PointsSubtract(centroid, intersection)\n  ];\n};\n","import { intersections as circleIntersections } from \"./circle/Intersections.js\";\nimport type { CirclePositioned } from \"./circle/CircleType.js\";\nimport type { RectPositioned } from \"./rect/index.js\";\n\nexport const circleRect = (a: CirclePositioned, b: RectPositioned) => {\n  // https://yal.cc/rectangle-circle-intersection-test/\n  const deltaX = a.x - Math.max(b.x, Math.min(a.x, b.x + b.width));\n  const deltaY = a.y - Math.max(b.y, Math.min(a.y, b.y + b.height));\n  return (deltaX * deltaX + deltaY * deltaY) < (a.radius * a.radius);\n};\n\nexport const circleCircle = (a: CirclePositioned, b: CirclePositioned) => circleIntersections(a, b).length === 2;","import { guard } from \"./Guard.js\";\nimport { isPositioned, isRectPositioned } from \"./Guard.js\";\nimport { isCirclePositioned } from '../circle/Guard.js';\nimport * as Intersects from '../Intersects.js';\nimport { isPoint } from \"../point/Guard.js\";\nimport type { Rect, RectPositioned } from \"./RectTypes.js\";\nimport type { Point } from \"../point/PointType.js\";\nimport type { CirclePositioned } from \"../circle/CircleType.js\";\n/**\n * Returns _true_ if `point` is within, or on boundary of `rect`.\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * Rects.intersectsPoint(rect, { x: 100, y: 100});\n * ```\n * @param rect\n * @param point\n */\nexport function intersectsPoint(\n  rect: Rect | RectPositioned,\n  point: Point\n): boolean;\n\n/**\n * Returns true if x,y coordinate is within, or on boundary of `rect`.\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * Rects.intersectsPoint(rect, 100, 100);\n * ```\n * @param rect\n * @param x\n * @param y\n */\nexport function intersectsPoint(\n  rect: Rect | RectPositioned,\n  x: number,\n  y: number\n): boolean;\n\n/**\n * Returns true if point is within or on boundary of `rect`.\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * Rects.intersectsPoint(rect, { x: 100, y: 100});\n * Rects.intersectsPoint(rect, 100, 100);\n * ```\n * @param rect\n * @param a\n * @param b\n * @returns\n */\n//eslint-disable-next-line func-style\nexport function intersectsPoint(\n  rect: Rect | RectPositioned,\n  a: Point | number,\n  b?: number\n): boolean {\n  guard(rect, `rect`);\n  //eslint-disable-next-line functional/no-let\n  let x = 0;\n  //eslint-disable-next-line functional/no-let\n  let y = 0;\n  if (typeof a === `number`) {\n    if (b === undefined) throw new Error(`x and y coordinate needed`);\n    x = a;\n    y = b;\n  } else {\n    x = a.x;\n    y = a.y;\n  }\n  if (isPositioned(rect)) {\n    if (x - rect.x > rect.width || x < rect.x) return false;\n    if (y - rect.y > rect.height || y < rect.y) return false;\n  } else {\n    // Assume 0,0\n    if (x > rect.width || x < 0) return false;\n    if (y > rect.height || y < 0) return false;\n  }\n  return true;\n}\n\n/**\n * Returns true if `a` or `b` overlap, are equal, or `a` contains `b`.\n * A rectangle can be checked for intersections with another RectPositioned, CirclePositioned or Point.\n *\n */\nexport const isIntersecting = (\n  a: RectPositioned,\n  // eslint-disable-next-line @typescript-eslint/no-redundant-type-constituents\n  b: CirclePositioned | Point\n): boolean => {\n  if (!isRectPositioned(a)) {\n    throw new Error(`a parameter should be RectPositioned`);\n  }\n\n  if (isCirclePositioned(b)) {\n    return Intersects.circleRect(b, a);\n  } else if (isPoint(b)) {\n    return intersectsPoint(a, b);\n  }\n  throw new Error(`Unknown shape for b: ${ JSON.stringify(b) }`);\n};","import { isPoint } from \"../point/Guard.js\";\nimport type { Point } from \"../point/PointType.js\";\nimport { getRectPositioned, guard } from \"./Guard.js\";\nimport type { Rect, RectPositioned } from \"./RectTypes.js\";\n\n/**\n * Returns the center of a rectangle as a {@link Geometry.Point}.\n *  If the rectangle lacks a position and `origin` parameter is not provided, 0,0 is used instead.\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n *\n * const p = Rects.center({x:10, y:20, width:100, height:50});\n * const p2 = Rects.center({width: 100, height: 50}); // Assumes 0,0 for rect x,y\n * ```\n * @param rect Rectangle\n * @param origin Optional origin. Overrides `rect` position if available. If no position is available 0,0 is used by default.\n * @returns\n */\nexport const center = (\n  rect: RectPositioned | Rect,\n  origin?: Point\n): Point => {\n  guard(rect);\n  if (origin === undefined && isPoint(rect)) origin = rect;\n  else if (origin === undefined) origin = { x: 0, y: 0 }; // throw new Error(`Unpositioned rect needs origin param`);\n\n  const r = getRectPositioned(rect, origin);\n  return Object.freeze({\n    x: origin.x + rect.width / 2,\n    y: origin.y + rect.height / 2,\n  });\n};","/**\n * A point, consisting of x, y and maybe z fields.\n */\nexport type Point = {\n  readonly x: number;\n  readonly y: number;\n  readonly z?: number;\n};\n\nexport type Point3d = Point & {\n  readonly z: number;\n};\n\n/**\n * Placeholder point, where x and y is `NaN`.\n * Use `isPlaceholder` to check if a point is a placeholder.\n */\n//eslint-disable-next-line @typescript-eslint/naming-convention\nexport const Placeholder = Object.freeze({ x: Number.NaN, y: Number.NaN });\n","import { guardPositioned } from \"./Guard.js\";\nimport { intersectsPoint } from \"./Intersects.js\";\nimport { center } from \"./Center.js\";\nimport type { RectPositioned } from \"./RectTypes.js\";\nimport { type Point } from '../point/PointType.js';\nimport { guard as PointsGuard } from '../point/Guard.js';\nimport { distance as PointsDistance } from '../point/Distance.js';\n\n/**\n * Returns the distance from the perimeter of `rect` to `pt`.\n * If the point is within the rectangle, 0 is returned.\n *\n * If `rect` does not have an x,y it's assumed to be 0,0\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * const rect = { width: 100, height: 100, x: 0, y: 0 };\n * Rects.distanceFromExterior(rect, { x: 20, y: 20 });\n * ```\n * @param rect Rectangle\n * @param pt Point\n * @returns Distance\n */\nexport const distanceFromExterior = (\n  rect: RectPositioned,\n  pt: Point\n): number => {\n  guardPositioned(rect, `rect`);\n  PointsGuard(pt, `pt`);\n  if (intersectsPoint(rect, pt)) return 0;\n  const dx = Math.max(rect.x - pt.x, 0, pt.x - rect.x + rect.width);\n  const dy = Math.max(rect.y - pt.y, 0, pt.y - rect.y + rect.height);\n  return Math.hypot(dx, dy);\n};\n\n/**\n * Return the distance of `pt` to the center of `rect`.\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * const rect = { width: 100, height: 100, x: 0, y: 0 };\n * Rects.distanceFromCenter(rect, { x: 20, y: 20 });\n * ```\n * @param rect\n * @param pt\n * @returns\n */\nexport const distanceFromCenter = (\n  rect: RectPositioned,\n  pt: Point\n): number => PointsDistance(center(rect), pt);\n","import { distanceFromExterior as circleDistanceFromExterior } from \"../circle/DistanceFromExterior.js\";\nimport { distance } from \"./Distance.js\";\nimport { isPoint } from \"./Guard.js\";\nimport { distanceFromExterior as rectDistanceFromExterior } from \"../rect/Distance.js\";\nimport type { Point } from \"./PointType.js\";\nimport { isCirclePositioned } from \"../circle/Guard.js\";\nimport { isRectPositioned } from \"../rect/Guard.js\";\nimport type { PointCalculableShape } from \"../shape/index.js\";\n\n/**\n * Returns the distance from point `a` to the center of `shape`.\n * @param a Point\n * @param shape Point, or a positioned Rect or Circle.\n * @returns\n */\nexport const distanceToCenter = (\n  a: Point,\n  shape: PointCalculableShape\n): number => {\n  if (isRectPositioned(shape)) {\n    return rectDistanceFromExterior(shape, a);\n  }\n  if (isCirclePositioned(shape)) {\n    return circleDistanceFromExterior(shape, a);\n  }\n  if (isPoint(shape)) return distance(a, shape);\n  throw new Error(`Unknown shape`);\n};","import { distanceFromExterior as circleDistanceFromExterior } from \"../circle/DistanceFromExterior.js\";\nimport { distance, isPoint } from \"./index.js\";\nimport type { Point, PointCalculableShape } from \"../Types.js\";\nimport { distanceFromExterior as rectDistanceFromExterior } from \"../rect/Distance.js\";\nimport { isCirclePositioned } from \"../circle/Guard.js\";\nimport { isRectPositioned } from \"../rect/Guard.js\";\n\n/**\n * Returns the distance from point `a` to the exterior of `shape`.\n *\n * @example Distance from point to rectangle\n * ```\n * const distance = distanceToExterior(\n *  {x: 50, y: 50},\n *  {x: 100, y: 100, width: 20, height: 20}\n * );\n * ```\n *\n * @example Find closest shape to point\n * ```\n * import {minIndex} from '../data/arrays.js';\n * const shapes = [ some shapes... ]; // Shapes to compare against\n * const pt = { x: 10, y: 10 };       // Comparison point\n * const distances = shapes.map(v => distanceToExterior(pt, v));\n * const closest = shapes[minIndex(...distances)];\n * ```\n * @param a Point\n * @param shape Point, or a positioned Rect or Circle.\n * @returns\n */\nexport const distanceToExterior = (\n  a: Point,\n  shape: PointCalculableShape\n): number => {\n  if (isRectPositioned(shape)) {\n    return rectDistanceFromExterior(shape, a);\n  }\n  if (isCirclePositioned(shape)) {\n    return circleDistanceFromExterior(shape, a);\n  }\n  if (isPoint(shape)) return distance(a, shape);\n  throw new Error(`Unknown shape`);\n};","import type { Point } from \"./PointType.js\";\n\n/**\n * Returns point as an array in the form [x,y]. This can be useful for some libraries\n * that expect points in array form.\n *\n * ```\n * const p = {x: 10, y:5};\n * const p2 = toArray(p); // yields [10,5]\n * ```\n * @param p\n * @returns\n */\nexport const toArray = (p: Point): ReadonlyArray<number> => [ p.x, p.y ];\n","import { dotProduct as ArraysDotProduct } from '../../numbers/NumericArrays.js';\nimport type { Point } from './PointType.js';\nimport { toArray } from './ToArray.js';\n\nexport const dotProduct = (...pts: ReadonlyArray<Point>): number => {\n  const a = pts.map(p => toArray(p));\n  return ArraysDotProduct(a);\n};","import type { Point } from \"./PointType.js\";\n\n/**\n * Returns a point from two coordinates or an array of [x,y]\n * @example\n * ```js\n * let p = from([10, 5]); // yields {x:10, y:5}\n * let p = from(10, 5);   // yields {x:10, y:5}\n * let p = from(10);      // yields {x:10, y:0} 0 is used for default y\n * let p = from();        // yields {x:0, y:0}  0 used for default x & y\n * ```\n * @param xOrArray\n * @param [y]\n * @returns Point\n */\nexport const from = (\n  xOrArray?: number | ReadonlyArray<number>,\n  y?: number\n): Point => {\n  if (Array.isArray(xOrArray)) {\n    if (xOrArray.length !== 2) {\n      throw new Error(`Expected array of length two, got ${ xOrArray.length }`);\n    }\n    return Object.freeze({\n      x: xOrArray[ 0 ],\n      y: xOrArray[ 1 ],\n    });\n  } else {\n    if (xOrArray === undefined) xOrArray = 0;\n    else if (Number.isNaN(xOrArray)) throw new Error(`x is NaN`);\n    if (y === undefined) y = 0;\n    else if (Number.isNaN(y)) throw new Error(`y is NaN`);\n    return Object.freeze({ x: xOrArray as number, y: y });\n  }\n};\n\n\n/**\n * Returns an array of points from an array of numbers.\n *\n * Array can be a continuous series of x, y values:\n * ```\n * [1,2,3,4] would yield: [{x:1, y:2}, {x:3, y:4}]\n * ```\n *\n * Or it can be an array of arrays:\n * ```\n * [[1,2], [3,4]] would yield: [{x:1, y:2}, {x:3, y:4}]\n * ```\n * @param coords\n * @returns\n */\nexport const fromNumbers = (\n  ...coords: ReadonlyArray<ReadonlyArray<number>> | ReadonlyArray<number>\n): ReadonlyArray<Point> => {\n  const pts: Array<Point> = [];\n\n  if (Array.isArray(coords[ 0 ])) {\n    // [[x,y],[x,y]...]\n    for (const coord of (coords as Array<Array<number>>)) {\n      if (!(coord.length % 2 === 0)) {\n        throw new Error(`coords array should be even-numbered`);\n      }\n      //eslint-disable-next-line  functional/immutable-data\n      pts.push(Object.freeze({ x: coord[ 0 ], y: coord[ 1 ] }));\n    }\n  } else {\n    // [x,y,x,y,x,y]\n    if (coords.length % 2 !== 0) {\n      throw new Error(`Expected even number of elements: [x,y,x,y...]`);\n    }\n\n    for (let index = 0; index < coords.length; index += 2) {\n      //eslint-disable-next-line  functional/immutable-data\n      pts.push(\n        Object.freeze({ x: coords[ index ] as number, y: coords[ index + 1 ] as number })\n      );\n    }\n  }\n  return pts;\n};\n","import type { Point } from \"./PointType.js\";\nimport { interpolate as lineInterpolate } from '../line/Interpolate.js';\n\n/**\n * Returns a relative point between two points\n * ```js\n * interpolate(0.5, a, b); // Halfway point between a and b\n * ```\n *\n * Alias for Lines.interpolate(amount, a, b);\n *\n * @param amount Relative amount, 0-1\n * @param a\n * @param b\n * @param allowOverflow If true, length of line can be exceeded for `amount` of below 0 and above `1`.\n * @returns {@link Point}\n */\nexport const interpolate = (\n  amount: number,\n  a: Point,\n  b: Point,\n  allowOverflow = false\n): Point => lineInterpolate(amount, a, b, allowOverflow); //({x: (1-amt) * a.x + amt * b.x, y:(1-amt) * a.y + amt * b.y });\n","import { isPoint3d } from \"./Guard.js\";\nimport type { Point, Point3d } from \"./PointType.js\";\n\n/**\n * Inverts one or more axis of a point\n * ```js\n * invert({x:10, y:10}); // Yields: {x:-10, y:-10}\n * invert({x:10, y:10}, `x`); // Yields: {x:-10, y:10}\n * ```\n * @param pt Point to invert\n * @param what Which axis. If unspecified, both axies are inverted\n * @returns\n */\nexport const invert = (\n  pt: Point | Point3d,\n  what: `both` | `x` | `y` | `z` = `both`\n): Point => {\n  switch (what) {\n    case `both`: {\n      return isPoint3d(pt) ? Object.freeze({\n        ...pt,\n        x: pt.x * -1,\n        y: pt.y * -1,\n        z: pt.z * -1,\n      }) : Object.freeze({\n        ...pt,\n        x: pt.x * -1,\n        y: pt.y * -1,\n      });\n    }\n    case `x`: {\n      return Object.freeze({\n        ...pt,\n        x: pt.x * -1,\n      });\n    }\n    case `y`: {\n      return Object.freeze({\n        ...pt,\n        y: pt.y * -1,\n      });\n    }\n    case `z`: {\n      if (isPoint3d(pt)) {\n        return Object.freeze({\n          ...pt,\n          z: pt.z * -1,\n        });\n      } else throw new Error(`pt parameter is missing z`);\n    }\n    default: {\n      throw new Error(`Unknown what parameter. Expecting 'both', 'x' or 'y'`);\n    }\n  }\n};","import { throwNumberTest } from \"../../util/GuardNumbers.js\";\nimport { isRect } from \"../rect/Guard.js\";\nimport type { Rect } from \"../rect/RectTypes.js\";\nimport { guard as RectsGuard } from '../rect/Guard.js'\nimport type { Point, Point3d } from \"./PointType.js\";\nimport { guard, isPoint, isPoint3d } from \"./Guard.js\";\n\n/**\n * Multiply by a width,height or x,y\n * ```\n * return {\n *  x: a.x * rect.width,\n *  y: a.y * rect.height\n * };\n * ```\n * @param a\n * @param rectOrPoint\n */\nexport function multiply(a: Point, rectOrPoint: Rect | Point): Point;\n\n/**\n * Returns `a` multipled by some x and/or y scaling factor\n *\n * ie.\n * ```js\n * return {\n *  x: a.x * x\n *   y: a.y * y\n * }\n * ```\n *\n * Usage:\n * ```js\n * multiply(pt, 10, 100); // Scale pt by x:10, y:100\n * multiply(pt, Math.min(window.innerWidth, window.innerHeight)); // Scale both x,y by viewport with or height, whichever is smaller\n * ```\n * @param a Point to scale\n * @param x Scale factor for x axis\n * @param y Scale factor for y axis (if not specified, the x value is used)\n * @returns Scaled point\n */\nexport function multiply(a: Point, x: number, y?: number): Point;\n\n/**\n * Returns `a` multiplied by `b` point, or given x and y.\n * ie.\n * ```js\n * return {\n *   x: a.x * b.x,\n *   y: a.y * b.y\n * };\n * ```\n * @param a\n * @param bOrX\n * @param y\n * @returns\n */\n/* eslint-disable func-style */\nexport function multiply(\n  a: Point,\n  bOrX: Rect | Point | number,\n  y?: number\n): Point {\n  // ✔️ Unit tested\n\n  guard(a, `a`);\n  if (typeof bOrX === `number`) {\n    if (typeof y === `undefined`) y = bOrX;\n    throwNumberTest(y, ``, `y`);\n    throwNumberTest(bOrX, ``, `x`);\n    return Object.freeze({ x: a.x * bOrX, y: a.y * y });\n  } else if (isPoint(bOrX)) {\n    guard(bOrX, `b`);\n    return Object.freeze({\n      x: a.x * bOrX.x,\n      y: a.y * bOrX.y,\n    });\n  } else if (isRect(bOrX)) {\n    RectsGuard(bOrX, `rect`);\n    return Object.freeze({\n      x: a.x * bOrX.width,\n      y: a.y * bOrX.height,\n    });\n  } else {\n    throw new Error(\n      `Invalid arguments. a: ${ JSON.stringify(a) } b: ${ JSON.stringify(bOrX) }`\n    );\n  }\n}\n\n/**\n * Multiplies all components by `v`.\n * Existing properties of `pt` are maintained.\n *\n * ```js\n * multiplyScalar({ x:2, y:4 }, 2);\n * // Yields: { x:4, y:8 }\n * ```\n * @param pt Point\n * @param v Value to multiply by\n * @returns\n */\nexport const multiplyScalar = (\n  pt: Point | Point3d,\n  v: number\n): Point | Point3d => {\n  return isPoint3d(pt) ? Object.freeze({\n    ...pt,\n    x: pt.x * v,\n    y: pt.y * v,\n    z: pt.z * v,\n  }) : Object.freeze({\n    ...pt,\n    x: pt.x * v,\n    y: pt.y * v,\n  });\n};\n\n","import { distance } from \"./Distance.js\";\nimport { multiply } from \"./Multiply.js\";\nimport type { Point } from \"./PointType.js\";\n\n/**\n * Clamps the magnitude of a point.\n * This is useful when using a Point as a vector, to limit forces.\n * @param pt\n * @param max Maximum magnitude (1 by default)\n * @param min Minimum magnitude (0 by default)\n * @returns\n */\nexport const clampMagnitude = (pt: Point, max = 1, min = 0): Point => {\n  const length = distance(pt);\n  let ratio = 1;\n  if (length > max) {\n    ratio = max / length;\n  } else if (length < min) {\n    ratio = min / length;\n  }\n  return ratio === 1 ? pt : multiply(pt, ratio, ratio);\n};","import { findMinimum } from \"./FindMinimum.js\";\nimport type { Point } from \"./PointType.js\";\n\n/**\n * Returns the left-most of the provided points.\n *\n * Same as:\n * ```js\n * findMinimum((a, b) => {\n *  if (a.x <= b.x) return a;\n *  return b;\n *}, ...points)\n * ```\n *\n * @param points\n * @returns\n */\nexport const leftmost = (...points: ReadonlyArray<Point>): Point =>\n  findMinimum((a, b) => (a.x <= b.x ? a : b), ...points);\n\n/**\n * Returns the right-most of the provided points.\n *\n * Same as:\n * ```js\n * findMinimum((a, b) => {\n *  if (a.x >= b.x) return a;\n *  return b;\n *}, ...points)\n * ```\n *\n * @param points\n * @returns\n */\nexport const rightmost = (...points: ReadonlyArray<Point>): Point =>\n  findMinimum((a, b) => (a.x >= b.x ? a : b), ...points);\n","import { Empty } from \"./Empty.js\";\nimport { getPointParameter } from \"./GetPointParameter.js\";\nimport { isPoint } from \"./Guard.js\";\nimport type { Point } from \"./PointType.js\";\n\nconst length = (ptOrX: Point | number, y?: number): number => {\n  if (isPoint(ptOrX)) {\n    y = ptOrX.y;\n    ptOrX = ptOrX.x;\n  }\n  if (y === undefined) throw new Error(`Expected y`);\n  return Math.hypot(ptOrX, y);\n};\n\n\n\n/**\n * Normalise point as a unit vector.\n *\n * ```js\n * normalise({x:10, y:20});\n * normalise(10, 20);\n * ```\n * @param ptOrX Point, or x value\n * @param y y value if first param is x\n * @returns\n */\nexport const normalise = (ptOrX: Point | number, y?: number): Point => {\n  const pt = getPointParameter(ptOrX, y);\n  const l = length(pt);\n  if (l === 0) return Empty;\n  return Object.freeze({\n    ...pt,\n    x: pt.x / l,\n    y: pt.y / l,\n  });\n};","import type { Point } from \"./PointType.js\";\n\n/**\n * Runs a sequential series of functions on `pt`. The output from one feeding into the next.\n * ```js\n * const p = Points.pipelineApply(somePoint, Points.normalise, Points.invert);\n * ```\n *\n * If you want to make a reusable pipeline of functions, consider {@link pipeline} instead.\n * @param point\n * @param pipelineFns\n * @returns\n */\nexport const pipelineApply = (\n  point: Point,\n  ...pipelineFns: ReadonlyArray<(pt: Point) => Point>\n): Point => pipeline(...pipelineFns)(point); // pipeline.reduce((prev, curr) => curr(prev), pt);\n\n/**\n * Returns a pipeline function that takes a point to be transformed through a series of functions\n * ```js\n * // Create pipeline\n * const p = Points.pipeline(Points.normalise, Points.invert);\n *\n * // Now run it on `somePoint`.\n * // First we normalised, and then invert\n * const changedPoint = p(somePoint);\n * ```\n *\n * If you don't want to create a pipeline, use {@link pipelineApply}.\n * @param pipeline Pipeline of functions\n * @returns\n */\nexport const pipeline =\n  (...pipeline: ReadonlyArray<(pt: Point) => Point>) =>\n    (pt: Point) =>\n      // eslint-disable-next-line unicorn/no-array-reduce\n      pipeline.reduce((previous, current) => current(previous), pt);\n","\nimport { isPoint3d } from \"./Guard.js\";\nimport type { Point3d, Point } from \"./PointType.js\";\nimport { subtract } from \"./Subtract.js\";\n\n/**\n * Computes the progress between two waypoints, given `position`.\n * \n * [Source](https://www.habrador.com/tutorials/math/2-passed-waypoint/?s=09)\n * @param position Current position\n * @param waypointA Start\n * @param waypointB End\n * @returns \n */\nexport const progressBetween = (\n  position: Point | Point3d,\n  waypointA: Point | Point3d,\n  waypointB: Point | Point3d\n) => {\n  // Via: https://www.habrador.com/tutorials/math/2-passed-waypoint/?s=09\n  // from -> current\n  const a = subtract(position, waypointA);\n\n  // from -> to\n  const b = subtract(waypointB, waypointA);\n\n  return isPoint3d(a) && isPoint3d(b) ? (\n    (a.x * b.x + a.y * b.y + a.z * b.z) / (b.x * b.x + b.y * b.y + b.z * b.z)\n  ) : (a.x * b.x + a.y * b.y) / (b.x * b.x + b.y * b.y);\n};","import type { Point } from \"./PointType.js\";\n\n/**\n * Project `origin` by `distance` and `angle` (radians).\n *\n * To figure out rotation, imagine a horizontal line running through `origin`.\n * * Rotation = 0 deg puts the point on the right of origin, on same y-axis\n * * Rotation = 90 deg/3:00 puts the point below origin, on the same x-axis\n * * Rotation = 180 deg/6:00 puts the point on the left of origin on the same y-axis\n * * Rotation = 270 deg/12:00 puts the point above the origin, on the same x-axis\n *\n * ```js\n * // Yields a point 100 units away from 10,20 with 10 degrees rotation (ie slightly down)\n * const a = Points.project({x:10, y:20}, 100, degreeToRadian(10));\n * ```\n * @param origin\n * @param distance\n * @param angle\n * @returns\n */\nexport const project = (origin: Point, distance: number, angle: number) => {\n  const x = Math.cos(angle) * distance + origin.x;\n  const y = Math.sin(angle) * distance + origin.y;\n  return { x, y };\n};","import { quantiseEvery as quantiseEveryNumber } from '../../numbers/Quantise.js';\nimport { guard } from './Guard.js';\nimport type { Point } from './PointType.js';\n\n/**\n * Quantises a point\n * @param pt \n * @param snap \n * @param middleRoundsUp \n * @returns \n */\nexport const quantiseEvery = (pt: Point, snap: Point, middleRoundsUp = true) => {\n  guard(pt, `pt`);\n  guard(snap, `snap`);\n  return Object.freeze({\n    x: quantiseEveryNumber(pt.x, snap.x, middleRoundsUp),\n    y: quantiseEveryNumber(pt.y, snap.y, middleRoundsUp),\n  });\n}","import { type RandomSource, defaultRandom } from '../../random/Types.js';\nimport type { Point } from './PointType.js';\n\n/**\n * Returns a random point on a 0..1 scale.\n * ```js\n * import { Points } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * const pt = Points.random(); // eg {x: 0.2549012, y:0.859301}\n * ```\n *\n * A custom source of randomness can be provided:\n * ```js\n * import { Points } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * import { weightedSource } from \"https://unpkg.com/ixfx/dist/random.js\"\n * const pt = Points.random(weightedSource(`quadIn`));\n * ```\n * @param rando\n * @returns\n */\nexport const random = (rando?: RandomSource): Point => {\n  if (rando === undefined) rando = defaultRandom;\n\n  return Object.freeze({\n    x: rando(),\n    y: rando(),\n  });\n};","import type { Point } from \"./PointType.js\";\n\n/**\n * Reduces over points, treating _x_ and _y_ separately.\n *\n * ```\n * // Sum x and y values\n * const total = Points.reduce(points, (p, acc) => {\n *  return {x: p.x + acc.x, y: p.y + acc.y}\n * });\n * ```\n * @param pts Points to reduce\n * @param fn Reducer\n * @param initial Initial value, uses `{ x:0, y:0 }` by default\n * @returns\n */\nexport const reduce = (\n  pts: ReadonlyArray<Point>,\n  fn: (p: Point, accumulated: Point) => Point,\n  initial?: Point\n): Point => {\n  if (initial === undefined) initial = { x: 0, y: 0 }\n  let accumulator = initial;\n  for (const p of pts) {\n    accumulator = fn(p, accumulator);\n  };\n  return accumulator;\n};","import { angleRadian } from \"./Angle.js\";\nimport { centroid } from \"./Centroid.js\";\nimport { distance } from \"./Distance.js\";\nimport { getPointParameter } from \"./GetPointParameter.js\";\nimport type { PointRelation } from \"./PointRelationTypes.js\";\nimport type { Point } from \"./PointType.js\";\n\n/**\n * Tracks the relation between two points.\n * \n * 1. Call `Points.relation` with the initial reference point\n * 2. You get back a function\n * 3. Call the function with a new point to compute relational information.\n * \n * It computes angle, average, centroid, distance and speed.\n * \n * ```js\n * import { Points } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n *\n * // Reference point: 50,50\n * const t = Points.relation({x:50,y:50}); // t is a function\n *\n * // Invoke the returned function with a point\n * const relation = t({ x:0, y:0 }); // Juicy relational data\n * ```\n * \n * Or with destructuring:\n * \n * ```js\n * const { angle, distanceFromStart, distanceFromLast, average, centroid, speed } = t({ x:0,y:0 });\n * ```\n *\n * x & y coordinates can also be used as parameters:\n * ```js\n * const t = Points.relation(50, 50);\n * const result = t(0, 0);\n * // result.speed, result.angle ...\n * ```\n *\n * Note that intermediate values are not stored. It keeps the initial\n * and most-recent point. If you want to compute something over a set\n * of prior points, you may want to use {@link Trackers.points}\n * @param a Initial point, or x value\n * @param b y value, if first option is a number.\n * @returns\n */\nexport const relation = (a: Point | number, b?: number): PointRelation => {\n  const start = getPointParameter(a, b);\n  let totalX = 0;\n  let totalY = 0;\n  let count = 0;\n  let lastUpdate = performance.now();\n  let lastPoint = start;\n  const update = (aa: Point | number, bb?: number) => {\n    const p = getPointParameter(aa, bb);\n    totalX += p.x;\n    totalY += p.y;\n    count++;\n\n    const distanceFromStart = distance(p, start);\n    const distanceFromLast = distance(p, lastPoint);\n\n    // Track speed\n    const now = performance.now();\n    const speed = distanceFromLast / (now - lastUpdate);\n    lastUpdate = now;\n\n    lastPoint = p;\n\n    return Object.freeze({\n      angle: angleRadian(p, start),\n      distanceFromStart,\n      distanceFromLast,\n      speed,\n      centroid: centroid(p, start),\n      average: {\n        x: totalX / count,\n        y: totalY / count,\n      },\n    });\n  };\n\n  return update;\n};\n\n","import { throwNumberTest } from \"../../util/GuardNumbers.js\";\nimport type { Point } from \"./PointType.js\";\nimport { guard } from \"./Guard.js\";\nimport { fromCartesian as PolarFromCartesian } from \"../Polar.js\";\nimport { rotate as PolarRotate, toCartesian as PolarToCartesian } from \"../Polar.js\";\n/**\n * Rotate a single point by a given amount in radians\n * @param pt\n * @param amountRadian\n * @param origin\n */\nexport function rotate(pt: Point, amountRadian: number, origin?: Point): Point;\n\n/**\n * Rotate several points by a given amount in radians\n * @param pt Points\n * @param amountRadian Amount to rotate in radians. If 0 is given, a copy of the input array is returned\n * @param origin Origin to rotate around. Defaults to 0,0\n */\nexport function rotate(\n  pt: ReadonlyArray<Point>,\n  amountRadian: number,\n  origin?: Point\n): ReadonlyArray<Point>;\n\nexport function rotate(\n  pt: Point | ReadonlyArray<Point>,\n  amountRadian: number,\n  origin?: Point\n): Point | ReadonlyArray<Point> {\n  if (origin === undefined) origin = { x: 0, y: 0 };\n  guard(origin, `origin`);\n  throwNumberTest(amountRadian, ``, `amountRadian`);\n  const arrayInput = Array.isArray(pt);\n\n  // no-op\n  if (amountRadian === 0) return pt;\n\n  if (!arrayInput) {\n    pt = [ pt as Point ];\n  }\n\n  const ptAr = pt as ReadonlyArray<Point>;\n  for (const [ index, p ] of ptAr.entries()) guard(p, `pt[${ index }]`);\n\n  const asPolar = ptAr.map((p) => PolarFromCartesian(p, origin));\n  const rotated = asPolar.map((p) => PolarRotate(p, amountRadian));\n  const asCartesisan = rotated.map((p) => PolarToCartesian(p, origin));\n  return arrayInput ? asCartesisan : asCartesisan[ 0 ];\n}","\n//eslint-disable-next-line functional/prefer-readonly-type\nexport const rotatePointArray = (\n  v: ReadonlyArray<ReadonlyArray<number>>,\n  amountRadian: number\n): Array<Array<number>> => {\n  const mat = [\n    [ Math.cos(amountRadian), -Math.sin(amountRadian) ],\n    [ Math.sin(amountRadian), Math.cos(amountRadian) ],\n  ];\n  const result = [];\n  for (const [ index, element ] of v.entries()) {\n    //eslint-disable-next-line functional/immutable-data\n    result[ index ] = [\n      mat[ 0 ][ 0 ] * element[ 0 ] + mat[ 0 ][ 1 ] * element[ 1 ],\n      mat[ 1 ][ 0 ] * element[ 0 ] + mat[ 1 ][ 1 ] * element[ 1 ],\n    ];\n  }\n  return result;\n};","import { round as roundNumber } from '../../numbers/Round.js';\nimport { getPointParameter } from './GetPointParameter.js';\nimport type { Point } from './PointType.js';\n\n/**\n * Round the point's _x_ and _y_ to given number of digits\n * @param ptOrX \n * @param yOrDigits \n * @param digits \n * @returns \n */\nexport const round = (ptOrX: Point | number, yOrDigits?: number, digits?: number): Point => {\n  const pt = getPointParameter(ptOrX, yOrDigits);\n  digits = digits ?? yOrDigits;\n  digits = digits ?? 2;\n  return Object.freeze({\n    ...pt,\n    x: roundNumber(digits, pt.x),\n    y: roundNumber(digits, pt.y)\n  })\n}","import { guard } from \"./Guard.js\";\nimport type { Point } from \"./PointType.js\";\n\n/**\n * Returns a point with rounded x,y coordinates. By default uses `Math.round` to round.\n * ```js\n * toIntegerValues({x:1.234, y:5.567}); // Yields: {x:1, y:6}\n * ```\n *\n * ```js\n * toIntegerValues(pt, Math.ceil); // Use Math.ceil to round x,y of `pt`.\n * ```\n * @param pt Point to round\n * @param rounder Rounding function, or Math.round by default\n * @returns\n */\nexport const toIntegerValues = (\n  pt: Point,\n  rounder: (x: number) => number = Math.round\n): Point => {\n  guard(pt, `pt`);\n  return Object.freeze({\n    x: rounder(pt.x),\n    y: rounder(pt.y),\n  });\n};\n\n/**\n * Returns a human-friendly string representation `(x, y)`.\n * If `precision` is supplied, this will be the number of significant digits.\n * @param p\n * @returns\n */\nexport function toString(p: Point, digits?: number): string {\n  if (p === undefined) return `(undefined)`;\n  if (p === null) return `(null)`;\n  guard(p, `pt`);\n\n  const x = digits ? p.x.toFixed(digits) : p.x;\n  const y = digits ? p.y.toFixed(digits) : p.y;\n\n  if (p.z === undefined) {\n    return `(${ x },${ y })`;\n  } else {\n    const z = digits ? p.z.toFixed(digits) : p.z;\n    return `(${ x },${ y },${ z })`;\n  }\n}","import { throwNumberTest } from \"../../util/GuardNumbers.js\";\nimport type { Point } from \"./PointType.js\";\nimport { guard } from \"./Guard.js\";\n\n/**\n * Returns true if two points are within a specified range on both axes.\n * \n * Provide a point for the range to set different x/y range, or pass a number\n * to use the same range for both axis.\n *\n * Note this simply compares x,y values it does not calcuate distance.\n *\n * @example\n * ```js\n * withinRange({x:100,y:100}, {x:101, y:101}, 1); // True\n * withinRange({x:100,y:100}, {x:105, y:101}, {x:5, y:1}); // True\n * withinRange({x:100,y:100}, {x:105, y:105}, {x:5, y:1}); // False - y axis too far\n * ```\n * @param a\n * @param b\n * @param maxRange\n * @returns\n */\nexport const withinRange = (\n  a: Point,\n  b: Point,\n  maxRange: Point | number\n): boolean => {\n  guard(a, `a`);\n  guard(b, `b`);\n\n  if (typeof maxRange === `number`) {\n    throwNumberTest(maxRange, `positive`, `maxRange`);\n    maxRange = { x: maxRange, y: maxRange };\n  } else {\n    guard(maxRange, `maxRange`);\n  }\n  const x = Math.abs(b.x - a.x);\n  const y = Math.abs(b.y - a.y);\n  return x <= maxRange.x && y <= maxRange.y;\n};","import { wrap as wrapNumber } from '../../numbers/Wrap.js';\nimport { guard } from './Guard.js';\nimport type { Point } from \"./PointType.js\";\n\n/**\n * Wraps a point to be within `ptMin` and `ptMax`.\n * Note that max values are _exclusive_, meaning the return value will always be one less.\n *\n * Eg, if a view port is 100x100 pixels, wrapping the point 150,100 yields 50,99.\n *\n * ```js\n * // Wraps 150,100 to on 0,0 -100,100 range\n * wrap({x:150,y:100}, {x:100,y:100});\n * ```\n *\n * Wrap normalised point:\n * ```js\n * wrap({x:1.2, y:1.5}); // Yields: {x:0.2, y:0.5}\n * ```\n * @param pt Point to wrap\n * @param ptMax Maximum value, or `{ x:1, y:1 }` by default\n * @param ptMin Minimum value, or `{ x:0, y:0 }` by default\n * @returns Wrapped point\n */\nexport const wrap = (\n  pt: Point,\n  ptMax?: Point,\n  ptMin?: Point\n): Point => {\n\n  if (ptMax === undefined) ptMax = { x: 1, y: 1 };\n  if (ptMin === undefined) ptMin = { x: 0, y: 0 };\n\n  // ✔️ Unit tested\n  guard(pt, `pt`);\n  guard(ptMax, `ptMax`);\n  guard(ptMin, `ptMin`);\n\n  return Object.freeze({\n    x: wrapNumber(pt.x, ptMin.x, ptMax.x),\n    y: wrapNumber(pt.y, ptMin.y, ptMax.y),\n  });\n};\n","import type { Point } from \"../Types.js\";\nimport type { Line } from \"./LineType.js\";\nimport { multiply as PointsMultiply } from \"../point/index.js\";\n/**\n * Multiplies start and end of line by point.x, point.y.\n * \n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * \n * // Line 1,1 -> 10,10\n * const l = Lines.fromNumbers(1, 1, 10, 10);\n * const ll = Lines.multiply(l, {x:2, y:3});\n * // Yields: 2,20 -> 3,30\n * ```\n * @param line \n * @param point \n * @returns \n */\nexport const multiply = (line: Line, point: Point): Line => (Object.freeze({\n  ...line,\n  a: PointsMultiply(line.a, point),\n  b: PointsMultiply(line.b, point)\n}));","import type { Point } from \"../point/PointType.js\";\nimport type { Line } from \"./LineType.js\";\nimport { length } from \"./Length.js\";\nimport { distance as PointsDistance } from \"../point/Distance.js\";\n/**\n * Returns the relative position of `pt` along `line`.\n * Warning: assumes `pt` is actually on `line`. Results may be bogus if not.\n * @param line \n * @param pt \n */\nexport const relativePosition = (line: Line, pt: Point): number => {\n  const fromStart = PointsDistance(line.a, pt);\n  const total = length(line);\n  return fromStart / total;\n}","import type { Point } from \"../point/PointType.js\";\nimport type { Line } from \"./LineType.js\";\nimport { rotate as PointRotate } from '../point/index.js';\nimport { interpolate } from \"./Interpolate.js\";\n\n/**\n * Returns a line that is rotated by `angleRad`. By default it rotates\n * around its center, but an arbitrary `origin` point can be provided.\n * If `origin` is a number, it's presumed to be a 0..1 percentage of the line.\n * \n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * \n * // Rotates line by 0.1 radians around point 10,10\n * const r = Lines.rotate(line, 0.1, {x:10,y:10});\n * \n * // Rotate line by 5 degrees around its center\n * const r = Lines.rotate(line, degreeToRadian(5));\n * \n * // Rotate line by 5 degres around its end point\n * const r = Lines.rotate(line, degreeToRadian(5), line.b);\n * \n * // Rotate by 90 degrees at the 80% position\n * const r = Lines.rotated = rotate(line, Math.PI / 2, 0.8);\n * ```\n * @param line Line to rotate\n * @param amountRadian Angle in radians to rotate by\n * @param origin Point to rotate around. If undefined, middle of line will be used\n * @returns \n */\nexport const rotate = (line: Line, amountRadian?: number, origin?: Point | number): Line => {\n  if (amountRadian === undefined || amountRadian === 0) return line;\n  if (origin === undefined) origin = 0.5;\n  if (typeof origin === `number`) {\n    origin = interpolate(origin, line.a, line.b);\n  }\n  return Object.freeze({\n    ...line,\n    a: PointRotate(line.a, amountRadian, origin),\n    b: PointRotate(line.b, amountRadian, origin)\n  });\n};","import type { Point } from \"../point/PointType.js\";\nimport type { Line } from \"./LineType.js\";\nimport { subtract as PointsSubtract } from \"../point/Subtract.js\";\n\n/**\n * Subtracts both start and end points by given x,y\n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * \n * // Line 1,1 -> 10,10\n * const l = Lines.fromNumbers(1,1,10,10);\n * const ll = Lines.subtract(l, {x:2, y:4});\n * // Yields: -1,-3 -> 8,6\n * ```\n * @param line \n * @param point \n * @returns \n */\nexport const subtract = (line: Line, point: Point): Line => Object.freeze({\n  ...line,\n  a: PointsSubtract(line.a, point),\n  b: PointsSubtract(line.b, point)\n});","import type { Point } from \"../point/PointType.js\";\nimport type { Line } from \"./LineType.js\";\nimport { sum as PointsSum } from '../point/Sum.js';\n\n/**\n * Adds both start and end points by given x,y\n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * // Line 1,1 -> 10,10\n * const l = Lines.fromNumbers(1,1,10,10);\n * const ll = Lines.sum(l, {x:2, y:4});\n * // Yields: 3,5 -> 12,14\n * ```\n * @param line \n * @param point \n * @returns \n */\nexport const sum = (line: Line, point: Point): Line => Object.freeze({\n  ...line,\n  a: PointsSum(line.a, point),\n  b: PointsSum(line.b, point)\n});","import type { Point } from \"../point/PointType.js\";\nimport { guard, isLine } from \"./Guard.js\";\nimport type { Line } from \"./LineType.js\";\nimport { toString as PointsToString } from '../point/index.js';\n/**\n * Returns a string representation of two points\n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * console.log(Lines.toString(a, b)));\n * ```\n * @param a \n * @param b \n * @returns \n */\nexport function toString(a: Point, b: Point): string;\n\n/**\n * Returns a string representation of a line \n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * Lines.toString(line);\n * ```\n * @param line \n */\nexport function toString(line: Line): string;\n\n/**\n * Returns a string representation of a line or two points.\n * @param a\n * @param b \n * @returns \n */\n//eslint-disable-next-line func-style\nexport function toString(a: Point | Line, b?: Point): string {\n  if (isLine(a)) {\n    guard(a, `a`);\n    b = a.b;\n    a = a.a;\n  } else if (b === undefined) throw new Error(`Expect second point if first is a point`);\n  return PointsToString(a) + `-` + PointsToString(b);\n}\n\n","import type { LinePath } from \"./LinePathType.js\";\nimport type { Line } from \"./LineType.js\";\nimport { length } from \"./Length.js\";\nimport { interpolate } from \"./Interpolate.js\";\nimport type { Point } from \"../point/PointType.js\";\nimport { parallel, perpendicularPoint } from \"./Angles.js\";\nimport { midpoint } from \"./Midpoint.js\";\nimport { toFlatArray, toSvgString, slope, withinRange, apply } from \"./index.js\";\nimport { bbox } from \"./Bbox.js\";\nimport { relativePosition } from \"./RelativePosition.js\";\nimport { sum } from \"./Sum.js\";\nimport { divide } from \"./Divide.js\";\nimport { rotate } from \"./Rotate.js\";\nimport { nearest } from \"./Nearest.js\";\nimport { distanceSingleLine } from './DistanceSingleLine.js';\nimport { isEqual } from \"./IsEqual.js\";\nimport { multiply } from \"./Multiply.js\";\nimport { subtract } from \"./Subtract.js\";\nimport { toString } from \"./ToString.js\";\n/**\n * Returns a path wrapper around a line instance. This is useful if there are a series\n * of operations you want to do with the same line because you don't have to pass it\n * in as an argument to each function.\n * \n * Note that the line is immutable, so a function like `sum` returns a new LinePath,\n * wrapping the result of `sum`.\n * \n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * // Create a path\n * const l = Lines.toPath(fromNumbers(0,0,10,10));\n * \n * // Now we can use it...\n * l.length();\n * \n * // Mutate functions return a new path\n * const ll = l.sum({x:10,y:10});\n * ll.length();\n * ```\n * @param line \n * @returns \n */\nexport const toPath = (line: Line): LinePath => {\n  const { a, b } = line;\n  return Object.freeze({\n    ...line,\n    length: () => length(a, b),\n    interpolate: (amount: number) => interpolate(amount, a, b),\n    relativePosition: (point: Point) => relativePosition(line, point),\n    bbox: () => bbox(line),\n    toString: () => toString(a, b),\n    toFlatArray: () => toFlatArray(a, b),\n    toSvgString: () => toSvgString(a, b),\n    toPoints: () => [ a, b ],\n    rotate: (amountRadian: number, origin: Point) => toPath(rotate(line, amountRadian, origin)),\n    nearest: (point: Point) => nearest(line, point),\n    sum: (point: Point) => toPath(sum(line, point)),\n    divide: (point: Point) => toPath(divide(line, point)),\n    multiply: (point: Point) => toPath(multiply(line, point)),\n    subtract: (point: Point) => toPath(subtract(line, point)),\n    midpoint: () => midpoint(a, b),\n    distanceToPoint: (point: Point) => distanceSingleLine(line, point),\n    parallel: (distance: number) => parallel(line, distance),\n    perpendicularPoint: (distance: number, amount?: number) => perpendicularPoint(line, distance, amount),\n    slope: () => slope(line),\n    withinRange: (point: Point, maxRange: number) => withinRange(line, point, maxRange),\n    isEqual: (otherLine: Line) => isEqual(line, otherLine),\n    apply: (fn: (point: Point) => Point) => toPath(apply(line, fn)),\n    kind: `line`\n  });\n};","export * as CirclePacking from './CirclePacking.js';","import { sortByNumericProperty } from \"../data/arrays/Sort.js\";\nimport type { RandomSource } from \"../random/Types.js\";\nimport { randomPoint as ShapesRandomPoint, type ShapePositioned } from \"./shape/index.js\";\nimport { isIntersecting as CirclesIsIntersecting } from \"./circle/Intersecting.js\";\nimport type { Circle, CirclePositioned } from \"./circle/CircleType.js\";\nimport type { Point } from \"./point/PointType.js\";\n\nexport type RandomOpts = {\n  readonly attempts?: number\n  readonly randomSource?: RandomSource\n}\n/**\n * Naive randomised circle packing.\n * [Algorithm by Taylor Hobbs](https://tylerxhobbs.com/essays/2016/a-randomized-approach-to-cicle-packing)\n */\nexport const random = (circles: ReadonlyArray<Circle>, container: ShapePositioned, opts: RandomOpts = {}) => {\n  if (!Array.isArray(circles)) throw new Error(`Parameter 'circles' is not an array`);\n  const attempts = opts.attempts ?? 2000;\n\n  const sorted = sortByNumericProperty(circles, `radius`);\n  const positionedCircles: Array<CirclePositioned> = [];\n\n  const willHit = (b: Point, radius: number) => positionedCircles.some(v => CirclesIsIntersecting(v, b, radius));\n\n  while (sorted.length > 0) {\n    //eslint-disable-next-line functional/immutable-data\n    const circle = sorted.pop();\n    if (!circle) break;\n\n    const randomPointOpts = { ...opts, margin: { x: circle.radius, y: circle.radius } };\n\n    //eslint-disable-next-line functional/no-let\n    for (let index = 0; index < attempts; index++) {\n      const position = ShapesRandomPoint(container, randomPointOpts);\n      if (!willHit(position, circle.radius)) {\n        //eslint-disable-next-line functional/immutable-data\n        positionedCircles.push(Object.freeze({ ...circle, ...position }));\n        break;\n      }\n    }\n  }\n\n  return positionedCircles;\n};","import { toCartesian } from '../Polar.js';\nimport { throwIntegerTest } from \"../../util/GuardNumbers.js\";\nimport { Triangles, Points } from '../index.js';\nimport type { Triangle } from '../triangle/TriangleType.js';\nimport { isCirclePositioned, isCircle } from '../circle/Guard.js';\nimport type { RandomSource } from '../../random/Types.js';\nimport { corners as RectsCorners } from '../rect/Corners.js';\nimport { center as RectsCenter } from '../rect/Center.js';\nimport { fromTopLeft as RectsFromTopLeft } from '../rect/FromTopLeft.js';\nimport { isIntersecting as CirclesIsIntersecting } from '../circle/Intersecting.js';\nimport { randomPoint as circleRandomPoint } from '../circle/Random.js';\nimport { center as circleCenter } from '../circle/Center.js';\nimport { randomPoint as rectRandomPoint } from '../rect/Random.js';\nimport { isRect, isRectPositioned } from '../rect/Guard.js';\nimport { isIntersecting as RectsIsIntersecting } from '../rect/Intersects.js';\nimport type { Rect, RectPositioned, } from '../rect/RectTypes.js';\nimport type { CirclePositioned, Circle } from '../circle/CircleType.js';\nimport type { Line, PolyLine } from '../line/LineType.js';\nimport type { Point, Point3d } from './../point/PointType.js';\n\nexport type ShapePositioned = CirclePositioned | RectPositioned;\nexport type ContainsResult = `none` | `contained`;\n\nexport type Sphere = Point3d & {\n  readonly radius: number;\n};\n\nexport type PointCalculableShape =\n  | PolyLine\n  | Line\n  // eslint-disable-next-line @typescript-eslint/no-redundant-type-constituents\n  | RectPositioned\n  | Point\n  | CirclePositioned\n  ;\n\n/**\n * Returns the intersection result between a and b.\n * `a` can be a {@link CirclePositioned} or {@link RectPositioned}\n * `b` can be as above or a {@link Point}.\n * @param a\n * @param b\n */\nexport const isIntersecting = (\n  a: ShapePositioned,\n  b: ShapePositioned | Point\n): boolean => {\n  if (isCirclePositioned(a)) {\n    return CirclesIsIntersecting(a, b);\n  } else if (isRectPositioned(a)) {\n    return RectsIsIntersecting(a, b);\n  }\n  throw new Error(\n    `a or b are unknown shapes. a: ${ JSON.stringify(a) } b: ${ JSON.stringify(b) }`\n  );\n};\n\n// export enum Quadrant {\n//   Nw, Ne, Sw, Se\n// }\n\nexport type ShapeRandomPointOpts = {\n  readonly randomSource: RandomSource;\n};\n\n/**\n * Returns a random point within a shape.\n * `shape` can be {@link CirclePositioned} or {@link RectPositioned}\n * @param shape \n * @param opts \n * @returns \n */\nexport const randomPoint = (\n  shape: ShapePositioned,\n  opts: Partial<ShapeRandomPointOpts> = {}\n): Point => {\n  if (isCirclePositioned(shape)) {\n    return circleRandomPoint(shape, opts);\n  } else if (isRectPositioned(shape)) {\n    return rectRandomPoint(shape, opts);\n  }\n  throw new Error(`Unknown shape. Only CirclePositioned and RectPositioned are supported.`);\n};\n\n// export type Shape = {\n//   intersects(x:Point|Shape):ContainsResult\n//   readonly kind:`circular`\n\n// }\n\n/**\n * Returns the center of a shape\n * Shape can be: rectangle, triangle, circle\n * @param shape\n * @returns\n */\nexport const center = (\n  shape?: Rect | Triangle | Circle\n): Point => {\n  if (shape === undefined) {\n    return Object.freeze({ x: 0.5, y: 0.5 });\n  } else if (isRect(shape)) {\n    return RectsCenter(shape);\n  } else if (Triangles.isTriangle(shape)) {\n    return Triangles.centroid(shape);\n  } else if (isCircle(shape)) {\n    return circleCenter(shape);\n  } else {\n    throw new Error(`Unknown shape: ${ JSON.stringify(shape) }`);\n  }\n};\n\n/**\n * Generates a starburst shape, returning an array of points. By default, initial point is top and horizontally-centred.\n *\n * ```\n * // Generate a starburst with four spikes\n * const pts = starburst(4, 100, 200);\n * ```\n *\n * `points` of two produces a lozenge shape.\n * `points` of three produces a triangle shape.\n * `points` of five is the familiar 'star' shape.\n *\n * Note that the path will need to be closed back to the first point to enclose the shape.\n *\n * @example Create starburst and draw it. Note use of 'loop' flag to close the path\n * ```\n * const points = starburst(4, 100, 200);\n * Drawing.connectedPoints(ctx, pts, {loop: true, fillStyle: `orange`, strokeStyle: `red`});\n * ```\n *\n * Options:\n * * initialAngleRadian: angle offset to begin from. This overrides the `-Math.PI/2` default.\n *\n * @param points Number of points in the starburst. Defaults to five, which produces a typical star\n * @param innerRadius Inner radius. A proportionally smaller inner radius makes for sharper spikes. If unspecified, 50% of the outer radius is used.\n * @param outerRadius Outer radius. Maximum radius of a spike to origin\n * @param opts Options\n * @param origin Origin, or `{ x:0, y:0 }` by default.\n */\nexport const starburst = (\n  outerRadius: number,\n  points = 5,\n  innerRadius?: number,\n  origin: Point = Points.Empty,\n  opts?: { readonly initialAngleRadian?: number }\n): ReadonlyArray<Point> => {\n  throwIntegerTest(points, `positive`, `points`);\n  const angle = (Math.PI * 2) / points;\n  const angleHalf = angle / 2;\n\n  const initialAngle = opts?.initialAngleRadian ?? -Math.PI / 2;\n  if (innerRadius === undefined) innerRadius = outerRadius / 2;\n\n  //eslint-disable-next-line functional/no-let\n  let a = initialAngle;\n  const pts = [];\n\n  //eslint-disable-next-line functional/no-let\n  for (let index = 0; index < points; index++) {\n    const peak = toCartesian(outerRadius, a, origin);\n    const left = toCartesian(innerRadius, a - angleHalf, origin);\n    const right = toCartesian(innerRadius, a + angleHalf, origin);\n\n    //eslint-disable-next-line functional/immutable-data\n    pts.push(left, peak);\n    //eslint-disable-next-line functional/immutable-data\n    if (index + 1 < points) pts.push(right);\n    a += angle;\n  }\n  return pts;\n};\n\nexport type ArrowOpts = {\n  readonly arrowSize?: number;\n  readonly tailLength?: number;\n  readonly tailThickness?: number;\n  readonly angleRadian?: number;\n};\n\n/**\n * Returns the points forming an arrow.\n *\n * @example Create an arrow anchored by its tip at 100,100\n * ```js\n * const opts = {\n *  tailLength: 10,\n *  arrowSize: 20,\n *  tailThickness: 5,\n *  angleRadian: degreeToRadian(45)\n * }\n * const arrow = Shapes.arrow({x:100, y:100}, `tip`, opts); // Yields an array of points\n *\n * // Eg: draw points\n * Drawing.connectedPoints(ctx, arrow, {strokeStyle: `red`, loop: true});\n * ```\n *\n * @param origin Origin of arrow\n * @param from Does origin describe the tip, tail or middle?\n * @param opts Options for arrow\n * @returns\n */\nexport const arrow = (\n  origin: Point,\n  from: `tip` | `tail` | `middle`,\n  opts: ArrowOpts = {}\n): ReadonlyArray<Point> => {\n  const tailLength = opts.tailLength ?? 10;\n  const tailThickness = opts.tailThickness ?? Math.max(tailLength / 5, 5);\n  const angleRadian = opts.angleRadian ?? 0;\n  const arrowSize = opts.arrowSize ?? Math.max(tailLength / 5, 15);\n\n  const triAngle = Math.PI / 2;\n\n  let tri: Triangle;\n  let tailPoints: ReadonlyArray<Point>;\n\n  if (from === `tip`) {\n    tri = Triangles.equilateralFromVertex(origin, arrowSize, triAngle);\n    tailPoints = RectsCorners(\n      RectsFromTopLeft(\n        { x: tri.a.x - tailLength, y: origin.y - tailThickness / 2 },\n        tailLength,\n        tailThickness\n      )\n    );\n  } else if (from === `middle`) {\n    const midX = tailLength + arrowSize / 2;\n    const midY = tailThickness / 2;\n    tri = Triangles.equilateralFromVertex(\n      {\n        x: origin.x + arrowSize * 1.2,\n        y: origin.y,\n      },\n      arrowSize,\n      triAngle\n    );\n\n    tailPoints = RectsCorners(\n      RectsFromTopLeft(\n        { x: origin.x - midX, y: origin.y - midY },\n        tailLength + arrowSize,\n        tailThickness\n      )\n    );\n  } else {\n    //const midY = origin.y - tailThickness/2;\n    tailPoints = RectsCorners(\n      RectsFromTopLeft(\n        { x: origin.x, y: origin.y - tailThickness / 2 },\n        tailLength,\n        tailThickness\n      )\n    );\n    tri = Triangles.equilateralFromVertex(\n      { x: origin.x + tailLength + arrowSize * 0.7, y: origin.y },\n      arrowSize,\n      triAngle\n    );\n  }\n\n  const arrow = Points.rotate(\n    [\n      tailPoints[ 0 ],\n      tailPoints[ 1 ],\n      tri.a,\n      tri.b,\n      tri.c,\n      tailPoints[ 2 ],\n      tailPoints[ 3 ],\n    ],\n    angleRadian,\n    origin\n  );\n\n  return arrow;\n};\n","import { type Point } from \"../point/PointType.js\";\nimport { getRectPositioned } from \"./Guard.js\";\nimport type { Rect, RectPositioned } from \"./RectTypes.js\";\n\n/**\n * Returns the four corners of a rectangle as an array of Points.\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * const rect = { width: 100, height: 100, x: 0, y: 0};\n * const pts = Rects.corners(rect);\n * ```\n *\n * If the rectangle is not positioned, is origin can be provided.\n * Order of corners: ne, nw, sw, se\n * @param rect\n * @param origin\n * @returns\n */\nexport const corners = (\n  rect: RectPositioned | Rect,\n  origin?: Point\n): ReadonlyArray<Point> => {\n  const r = getRectPositioned(rect, origin);\n  return [\n    { x: r.x, y: r.y },\n    { x: r.x + r.width, y: r.y },\n    { x: r.x + r.width, y: r.y + r.height },\n    { x: r.x, y: r.y + r.height },\n  ];\n};","import type { Point } from \"../point/PointType.js\";\nimport { guardDim } from \"./Guard.js\";\nimport type { RectPositioned } from \"./RectTypes.js\";\nimport { guard as PointsGuard } from '../point/Guard.js';\n\n/**\n * Creates a rectangle from its top-left coordinate, a width and height.\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n *\n * // Rectangle at 50,50 with width of 100, height of 200.\n * const rect = Rects.fromTopLeft({ x: 50, y:50 }, 100, 200);\n * ```\n * @param origin\n * @param width\n * @param height\n * @returns\n */\nexport const fromTopLeft = (\n  origin: Point,\n  width: number,\n  height: number\n): RectPositioned => {\n  guardDim(width, `width`);\n  guardDim(height, `height`);\n  PointsGuard(origin, `origin`);\n\n  return { x: origin.x, y: origin.y, width: width, height: height };\n};\n","import { isPoint } from \"../point/Guard.js\";\nimport { distanceCenter } from \"./DistanceCenter.js\";\nimport { isCircle } from \"./Guard.js\";\nimport type { CirclePositioned } from \"./CircleType.js\";\nimport type { Point } from '../point/PointType.js';\n\n/**\n * Returns true if `b` is completely contained by `a`\n *\n * ```js\n * // Compare two points\n * isContainedBy(circleA, circleB);\n * \n * // Compare a circle with a point\n * isContainedBy(circleA, {x: 10, y: 20});\n * \n * // Define radius as third parameter\n * isContainedBy(circleA, {x: 10, y: 20}, 20);\n * ```\n * @param a Circle\n * @param b Circle or point to compare to\n * @param c Radius to accompany parameter b if it's a point\n * @returns\n */\nexport const isContainedBy = (a: CirclePositioned, b: CirclePositioned | Point, c?: number): boolean => {\n  const d = distanceCenter(a, b);\n  if (isCircle(b)) {\n    return (d < Math.abs(a.radius - b.radius));\n  } else if (isPoint(b)) {\n    // eslint-disable-next-line unicorn/prefer-ternary\n    if (c === undefined) {\n      return d <= a.radius;\n    } else {\n      // Defining a circle\n      return (d < Math.abs(a.radius - c));\n    }\n  } else throw new Error(`b parameter is expected to be CirclePositioned or Point`);\n};\n","import type { CirclePositioned } from \"./CircleType.js\";\nimport * as Intersects from '../Intersects.js';\nimport { isContainedBy } from \"./IsContainedBy.js\";\nimport { isCircle } from \"./Guard.js\";\nimport { isRectPositioned } from \"../rect/Guard.js\";\nimport { isEqual as PointsIsEqual } from \"../point/IsEqual.js\";\nimport type { Point } from '../point/PointType.js';\nimport { isPoint } from '../point/Guard.js';\nimport type { RectPositioned } from \"../rect/index.js\";\n\n/**\n * Returns true if `a` or `b` overlap, are equal, or `a` contains `b`.\n * A circle can be checked for intersections with another CirclePositioned, Point or RectPositioned.\n * \n * Use `intersections` to find the points of intersection.\n *\n * @param a Circle\n * @param b Circle or point to test\n * @returns True if circle overlap\n */\nexport const isIntersecting = (a: CirclePositioned, b: CirclePositioned | Point | RectPositioned, c?: number): boolean => {\n  if (PointsIsEqual(a, b)) return true;\n  if (isContainedBy(a, b, c)) return true;\n  if (isCircle(b)) {\n    return Intersects.circleCircle(a, b);\n  } else if (isRectPositioned(b)) {\n    return Intersects.circleRect(a, b);\n  } else if (isPoint(b) && c !== undefined) {\n    return Intersects.circleCircle(a, { ...b, radius: c });\n  }\n  return false;\n};","import type { Point } from \"../point/PointType.js\";\nimport type { Circle, CirclePositioned, CircleRandomPointOpts } from \"./CircleType.js\";\nimport { isCirclePositioned } from \"./Guard.js\";\nimport { sum as PointsSum } from \"../point/Sum.js\";\nimport { toCartesian as PolarToCartesian } from \"../Polar.js\";\nconst piPi = Math.PI * 2;\n/**\n * Returns a random point within a circle.\n * \n * By default creates a uniform distribution.\n * \n * ```js\n * const pt = randomPoint({radius: 5});\n * const pt = randomPoint({radius: 5, x: 10, y: 20});\n * ```'\n * \n * Generate points with a gaussian distribution\n * ```js\n * const pt = randomPoint(circle, {\n *  randomSource: Random.gaussian\n * })\n * ```\n * @param within Circle to generate a point within\n * @param opts Options\n * @returns \n */\nexport const randomPoint = (within: Circle | CirclePositioned, opts: Partial<CircleRandomPointOpts> = {}): Point => {\n  const offset: Point = isCirclePositioned(within) ? within : { x: 0, y: 0 };\n  const strategy = opts.strategy ?? `uniform`;\n  const margin = opts.margin ?? 0;\n  const radius = within.radius - margin;\n  const rand = opts.randomSource ?? Math.random;\n  switch (strategy) {\n    case `naive`: {\n      return PointsSum(offset, PolarToCartesian(rand() * radius, rand() * piPi));\n    }\n    case `uniform`: {\n      return PointsSum(offset, PolarToCartesian(Math.sqrt(rand()) * radius, rand() * piPi));\n    }\n    default: {\n      // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n      throw new Error(`Unknown strategy '${ strategy }'. Expects 'uniform' or 'naive'`);\n    }\n  }\n};","import type { CirclePositioned, Circle } from \"./CircleType.js\";\nimport { isCirclePositioned } from \"./Guard.js\";\n\n/**\n * Returns the center of a circle\n * \n * If the circle has an x,y, that is the center.\n * If not, `radius` is used as the x and y.\n * \n * ```js\n * import { Circles } from \"https://unpkg.com/ixfx/dist/geometry.js\" \n * const circle = { radius: 5, x: 10, y: 10};\n * \n * // Yields: { x: 5, y: 10 }\n * Circles.center(circle);\n * ```\n * \n * It's a trivial function, but can make for more understandable code\n * @param circle \n * @returns Center of circle\n */\nexport const center = (circle: CirclePositioned | Circle) => {\n  return isCirclePositioned(circle) ? Object.freeze({ x: circle.x, y: circle.y }) : Object.freeze({ x: circle.radius, y: circle.radius });\n};","import { type RandomSource, defaultRandom } from '../../random/Types.js';\nimport { sum as PointsSum } from '../point/Sum.js';\nimport type { Point } from '../point/PointType.js';\nimport { isPositioned } from './Guard.js';\nimport type { Rect, RectPositioned } from './RectTypes.js';\n/**\n * Returns a random positioned Rect on a 0..1 scale.\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * const r = Rects.random(); // eg {x: 0.2549012, y:0.859301, width: 0.5212, height: 0.1423 }\n * ```\n *\n * A custom source of randomness can be provided:\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * import { weightedSource } from \"https://unpkg.com/ixfx/dist/random.js\"\n * const r = Rects.random(weightedSource(`quadIn`));\n * ```\n * @param rando\n * @returns\n */\nexport const random = (rando?: RandomSource): RectPositioned => {\n  if (rando === undefined) rando = defaultRandom;\n\n  return Object.freeze({\n    x: rando(),\n    y: rando(),\n    width: rando(),\n    height: rando(),\n  });\n};\n\nexport type RectRandomPointOpts = {\n  readonly strategy?: `naive`;\n  readonly randomSource?: RandomSource;\n  readonly margin?: { readonly x: number; readonly y: number };\n};\n\n/**\n * Returns a random point within a rectangle.\n *\n * By default creates a uniform distribution.\n *\n * ```js\n * const pt = randomPoint({width: 5, height: 10});\n * ```'\n * @param within Rectangle to generate a point within\n * @param options Options\n * @returns\n */\nexport const randomPoint = (\n  within: Rect | RectPositioned,\n  options: RectRandomPointOpts = {}\n): Point => {\n  // TODO: Does not implement uniform distribution\n  // See: https://math.stackexchange.com/questions/366474/find-coordinates-of-n-points-uniformly-distributed-in-a-rectangle\n  const rand = options.randomSource ?? defaultRandom;\n  const margin = options.margin ?? { x: 0, y: 0 };\n\n  const x = rand() * (within.width - margin.x - margin.x);\n  const y = rand() * (within.height - margin.y - margin.y);\n\n  const pos = { x: x + margin.x, y: y + margin.y };\n  return isPositioned(within) ? PointsSum(pos, within) : Object.freeze(pos);\n};","export * from './Area.js';\nexport * from './Bbox.js';\nexport * from './Center.js';\nexport type * from './CircleType.js';\nexport * from './CircularPath.js';\nexport * from './DistanceCenter.js';\nexport * from './DistanceFromExterior.js';\nexport * from './ExteriorPoints.js';\nexport * from './Guard.js';\nexport * from './InteriorPoints.js';\nexport * from './Interpolate.js';\nexport * from './Intersecting.js';\nexport * from './Intersections.js';\nexport * from './IsContainedBy.js';\nexport * from './IsEqual.js';\nexport * from './Multiply.js';\nexport * from './Perimeter.js';\nexport * from './Random.js';\nexport * from './Svg.js';\nexport * from './ToPath.js';\nexport * from './ToPositioned.js';\n\n","import type { Circle } from \"./CircleType.js\";\nimport { guard } from \"./Guard.js\";\n\n/**\n * Returns the area of `circle`.\n * @param circle \n * @returns \n */\nexport const area = (circle: Circle) => {\n  guard(circle);\n  return Math.PI * circle.radius * circle.radius;\n};","import { type RectPositioned } from \"./RectTypes.js\";\n\nimport type { Point } from \"../point/PointType.js\";\nimport { guard as PointsGuard } from '../point/Guard.js';\nimport { guardDim } from \"./Guard.js\";\n/**\n * Initialises a rectangle based on its center, a width and height\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n *\n * // Rectangle with center at 50,50, width 100 height 200\n * Rects.fromCenter({x: 50, y:50}, 100, 200);\n * ```\n * @param origin\n * @param width\n * @param height\n * @returns\n */\nexport const fromCenter = (\n  origin: Point,\n  width: number,\n  height: number\n): RectPositioned => {\n  PointsGuard(origin, `origin`);\n\n  guardDim(width, `width`);\n  guardDim(height, `height`);\n\n  const halfW = width / 2;\n  const halfH = height / 2;\n  return {\n    x: origin.x - halfW,\n    y: origin.y - halfH,\n    width: width,\n    height: height,\n  };\n};","import type { RectPositioned } from \"../Types.js\";\nimport type { CirclePositioned, Circle } from \"./CircleType.js\";\nimport { isCirclePositioned } from \"./Guard.js\";\nimport { fromCenter as RectsFromCenter } from '../rect/FromCenter.js';\n/**\n * Computes a bounding box that encloses circle\n * @param circle\n * @returns \n */\nexport const bbox = (circle: CirclePositioned | Circle): RectPositioned => {\n  return isCirclePositioned(circle) ?\n    RectsFromCenter(circle, circle.radius * 2, circle.radius * 2) :\n    { width: circle.radius * 2, height: circle.radius * 2, x: 0, y: 0 };\n};\n","import type { Point } from '../point/PointType.js';\nimport type { CirclePositioned } from \"./CircleType.js\";\n\n/**\n * Yields the points making up the exterior (ie. circumference) of the circle.\n * Uses [Midpoint Circle Algorithm](http://en.wikipedia.org/wiki/Midpoint_circle_algorithm)\n * \n * @example Draw outline of circle\n * ```js\n * const circle = { x: 100, y: 100, radius: 50 }\n * for (const pt of Circles.exteriorIntegerPoints(circle)) {\n *  // Fill 1x1 pixel\n *  ctx.fillRect(pt.x, pt.y, 1, 1);\n * }\n * ```\n * @param circle \n */\nexport function* exteriorIntegerPoints(circle: CirclePositioned): IterableIterator<Point> {\n  const { x, y, radius } = circle;\n\n  let xx = radius;\n  let yy = 0;\n  let radiusError = 1 - x;\n  while (xx >= yy) {\n    yield { x: xx + x, y: yy + y };\n    yield { x: yy + x, y: xx + y };\n    yield { x: -xx + x, y: yy + y };\n    yield { x: -yy + x, y: xx + y };\n    yield { x: -xx + x, y: -yy + y };\n    yield { x: -yy + x, y: -xx + y };\n    yield { x: xx + x, y: -yy + y };\n    yield { x: yy + x, y: -xx + y }\n    yy++;\n    if (radiusError < 0) {\n      radiusError += 2 * yy + 1;\n    } else {\n      xx--;\n      radiusError += 2 * (yy - xx + 1);\n    }\n  }\n}\n\n","import type { CirclePositioned } from \"./CircleType.js\";\nimport { distance } from \"../point/Distance.js\";\nimport type { Point } from '../point/PointType.js';\n\n/**\n * Returns all integer points contained within `circle`.\n * \n * ```js\n * const c = { x:100, y:100, radius:100 };\n * for (const pt of Circles.interiorIntegerPoints(c)) {\n *   ctx.fillRect(pt.x, pt.y, 1, 1);\n * }\n * ```\n * @param circle \n */\nexport function* interiorIntegerPoints(circle: CirclePositioned): IterableIterator<Point> {\n  const xMin = circle.x - circle.radius;\n  const xMax = circle.x + circle.radius;\n  const yMin = circle.y - circle.radius;\n  const yMax = circle.y + circle.radius;\n  for (let x = xMin; x < xMax; x++) {\n    for (let y = yMin; y < yMax; y++) {\n      const r = Math.abs(distance(circle, x, y));\n      if (r <= circle.radius) yield { x, y };\n    }\n  }\n}","import type { Point } from \"../point/PointType.js\";\nimport type { Circle, CirclePositioned } from \"./CircleType.js\";\nimport { guard, isCirclePositioned } from \"./Guard.js\";\nimport { distance as PointsDistance } from \"../point/Distance.js\";\nimport { minIndex } from \"../../numbers/NumericArrays.js\";\nconst piPi = Math.PI * 2;\n\n/**\n * Returns the nearest point on `circle`'s perimeter closest to `point`.\n * \n * ```js\n * import { Circles } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * const pt = Circles.nearest(circle, {x:10,y:10});\n * ```\n * \n * If an array of circles is provided, it will be the closest point amongst all the circles\n * @param circle Circle or array of circles\n * @param point\n * @returns Point `{ x, y }`\n */\nexport const nearest = (circle: CirclePositioned | ReadonlyArray<CirclePositioned>, point: Point): Point => {\n  const n = (a: CirclePositioned): Point => {\n    const l = Math.sqrt(Math.pow(point.x - a.x, 2) + Math.pow(point.y - a.y, 2));\n    const x = a.x + (a.radius * ((point.x - a.x) / l));\n    const y = a.y + (a.radius * ((point.y - a.y) / l));\n    return { x, y };\n  };\n\n  if (Array.isArray(circle)) {\n    const pts = circle.map(l => n(l));\n    const dists = pts.map(p => PointsDistance(p, point));\n    return Object.freeze<Point>(pts[ minIndex(...dists) ]);\n  } else {\n    return Object.freeze<Point>(n(circle as CirclePositioned));\n  }\n};\n\n/**\n * Returns a point on a circle's perimeter at a specified angle in radians\n * \n * ```js\n * import { Circles } from \"https://unpkg.com/ixfx/dist/geometry.js\" \n * \n * // Circle without position\n * const circleA = { radius: 5 };\n * \n * // Get point at angle Math.PI, passing in a origin coordinate\n * const ptA = Circles.pointOnPerimeter(circleA, Math.PI, {x: 10, y: 10 });\n * \n * // Point on circle with position\n * const circleB = { radius: 5, x: 10, y: 10};\n * const ptB = Circles.pointOnPerimeter(circleB, Math.PI);\n * ```\n * @param circle\n * @param angleRadian Angle in radians\n * @param origin or offset of calculated point. By default uses center of circle or 0,0 if undefined\n * @returns Point oo circle\n */\nexport const pointOnPerimeter = (circle: Circle | CirclePositioned, angleRadian: number, origin?: Point): Point => {\n  if (origin === undefined) {\n    origin = isCirclePositioned(circle) ? circle : { x: 0, y: 0 };\n  }\n  return {\n    x: (Math.cos(-angleRadian) * circle.radius) + origin.x,\n    y: (Math.sin(-angleRadian) * circle.radius) + origin.y\n  };\n};\n\n/**\n * Returns circumference of `circle` (alias of {@link length})\n * @param circle \n * @returns \n */\nexport const circumference = (circle: Circle): number => {\n  guard(circle);\n  return piPi * circle.radius;\n};\n\n/**\n * Returns circumference of `circle` (alias of {@link circumference})\n * @param circle \n * @returns \n */\nexport const length = (circle: Circle): number => circumference(circle);\n","import type { Point } from \"../point/PointType.js\";\nimport type { CirclePositioned } from \"./CircleType.js\";\nimport { pointOnPerimeter } from \"./Perimeter.js\";\nconst piPi = Math.PI * 2;\n/**\n * Computes relative position along circle perimeter\n * \n * ```js\n * import { Circles } from \"https://unpkg.com/ixfx/dist/geometry.js\" \n * const circle = { radius: 100, x: 100, y: 100 };\n * \n * // Get a point halfway around circle\n * // Yields { x, y }\n * const pt = Circles.interpolate(circle, 0.5);\n * ```\n * @param circle \n * @param t Position, 0-1\n * @returns \n */\nexport const interpolate = (circle: CirclePositioned, t: number): Point => pointOnPerimeter(circle, t * piPi);\n","import type { CirclePositioned, Circle } from \"./CircleType.js\";\nimport { isCirclePositioned } from \"./Guard.js\";\nimport { multiplyScalar as PointsMultiplyScalar } from '../point/Multiply.js';\n\nexport function multiplyScalar(a: CirclePositioned, value: number): CirclePositioned;\nexport function multiplyScalar(a: Circle, value: number): Circle;\n\n/**\n * Multiplies a circle's radius and position (if provided) by `value`.\n * \n * ```js\n * multiplyScalar({ radius: 5 }, 5);\n * // Yields: { radius: 25 }\n * \n * multiplyScalar({ radius: 5, x: 10, y: 20 }, 5);\n * // Yields: { radius: 25, x: 50, y: 100 }\n * ```\n */\nexport function multiplyScalar(a: Circle | CirclePositioned, value: number): Circle | CirclePositioned {\n  if (isCirclePositioned(a)) {\n    const pt = PointsMultiplyScalar(a, value);\n    return Object.freeze({\n      ...a,\n      ...pt,\n      radius: a.radius * value\n    });\n  } else {\n    return Object.freeze({\n      ...a,\n      radius: a.radius * value\n    });\n  }\n}\n\n","import type { Point } from \"../point/PointType.js\";\nimport type { Circle, CirclePositioned } from \"./CircleType.js\";\nimport { isCircle, isCirclePositioned } from \"./Guard.js\";\n\ntype ToSvg = {\n  (circleOrRadius: Circle | number, sweep: boolean, origin: Point): ReadonlyArray<string>;\n  (circle: CirclePositioned, sweep: boolean): ReadonlyArray<string>;\n};\n\n\n/**\n * Creates a SVG path segment.\n * @param a Circle or radius\n * @param sweep If true, path is 'outward'\n * @param origin Origin of path. Required if first parameter is just a radius or circle is non-positioned\n * @returns \n */\nexport const toSvg: ToSvg = (a: CirclePositioned | number | Circle, sweep: boolean, origin?: Point): ReadonlyArray<string> => {\n  if (isCircle(a)) {\n    if (origin !== undefined) {\n      return toSvgFull(a.radius, origin, sweep);\n    }\n    if (isCirclePositioned(a)) {\n      return toSvgFull(a.radius, a, sweep);\n    } else throw new Error(`origin parameter needed for non-positioned circle`);\n  } else {\n    if (origin === undefined) { throw new Error(`origin parameter needed`); } else {\n      return toSvgFull(a, origin, sweep);\n    }\n  }\n};\n\nconst toSvgFull = (radius: number, origin: Point, sweep: boolean): ReadonlyArray<string> => {\n  // https://stackoverflow.com/questions/5737975/circle-drawing-with-svgs-arc-path\n  const { x, y } = origin;\n  const s = sweep ? `1` : `0`;\n  return `\n    M ${ x }, ${ y }\n    m -${ radius }, 0\n    a ${ radius },${ radius } 0 1,${ s } ${ radius * 2 },0\n    a ${ radius },${ radius } 0 1,${ s } -${ radius * 2 },0\n  `.split(`\\n`);\n};\n","import type { Point } from \"../point/PointType.js\";\nimport { bbox } from \"./Bbox.js\";\nimport type { CirclePositioned } from \"./CircleType.js\";\nimport type { CircularPath } from \"./CircularPath.js\";\nimport { guard } from \"./Guard.js\";\nimport { interpolate } from \"./Interpolate.js\";\nimport { nearest } from \"./Perimeter.js\";\nimport { toSvg } from \"./Svg.js\";\nimport { circumference } from \"./Perimeter.js\";\n/**\n * Returns a `CircularPath` representation of a circle\n *\n * @param {CirclePositioned} circle\n * @returns {CircularPath}\n */\nexport const toPath = (circle: CirclePositioned): CircularPath => {\n  guard(circle);\n\n  return {\n    ...circle,\n    nearest: (point: Point) => nearest(circle, point),\n    /**\n     * Returns a relative (0.0-1.0) point on a circle. 0=3 o'clock, 0.25=6 o'clock, 0.5=9 o'clock, 0.75=12 o'clock etc.\n     * @param {t} Relative (0.0-1.0) point\n     * @returns {Point} X,y\n     */\n    interpolate: (t: number) => interpolate(circle, t),\n    bbox: () => bbox(circle),\n    length: () => circumference(circle),\n    toSvgString: (sweep = true) => toSvg(circle, sweep),\n    relativePosition: (_point: Point, _intersectionThreshold: number) => {\n      throw new Error(`Not implemented`)\n    },\n    distanceToPoint: (_point: Point): number => {\n      throw new Error(`Not implemented`)\n    },\n    kind: `circular`\n  };\n};","import type { Circle, CirclePositioned } from \"./CircleType.js\";\nimport { isCirclePositioned } from \"./Guard.js\";\nimport type { Point } from '../point/PointType.js';\nimport { getPointParameter } from \"../point/GetPointParameter.js\";\n\n\n/**\n * Returns a positioned version of a circle.\n * If circle is already positioned, it is returned.\n * If no default position is supplied, 0,0 is used.\n * @param circle \n * @param defaultPositionOrX \n * @param y \n * @returns \n */\nexport const toPositioned = (circle: Circle | CirclePositioned, defaultPositionOrX?: Point | number, y?: number): CirclePositioned => {\n  if (isCirclePositioned(circle)) return circle;\n\n  // Returns 0,0 if params are undefined\n  const pt = getPointParameter(defaultPositionOrX, y);\n  return Object.freeze({\n    ...circle,\n    ...pt\n  });\n};","export * from './Area.js';\nexport * from './Apply.js';\nexport * from './Cardinal.js';\nexport * from './Center.js';\nexport * from './Corners.js';\nexport * from './Distance.js';\nexport * from './Edges.js';\nexport * from './Empty.js';\nexport * from './FromCenter.js';\nexport * from './FromElement.js';\nexport * from './FromNumbers.js';\nexport * from './FromTopLeft.js';\nexport * from './GetRectPositionedParameter.js';\nexport * from './Guard.js';\nexport * from './Intersects.js';\nexport * from './IsEqual.js';\nexport * from './Lengths.js';\nexport * from './Max.js';\nexport * from './Multiply.js';\nexport * from './Divide.js';\n//export * from './NormaliseByRect.js';\nexport * from './Random.js';\nexport type * from './RectTypes.js';\nexport * from './Subtract.js';\nexport * from './Sum.js';\nexport * from './ToArray.js';","import { guard } from \"./Guard.js\";\nimport type { Rect } from \"./RectTypes.js\";\n\n/**\n * Returns the area of `rect`\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * const rect = { width: 100, height: 100, x: 100, y: 100 };\n * Rects.area(rect);\n * ```\n * @param rect\n * @returns\n */\nexport const area = (rect: Rect): number => {\n  guard(rect);\n  return rect.height * rect.width;\n};","import { guard } from \"./Guard.js\";\nimport type { RectPositioned, Rect } from \"./RectTypes.js\";\nimport { isRect, isRectPositioned, isPositioned } from \"./Guard.js\";\n\nexport type ApplyOp = (a: number, b: number) => number\n\nexport function apply(\n  op: ApplyOp,\n  rect: RectPositioned,\n  width: number,\n  height?: number\n): RectPositioned;\nexport function apply(op: ApplyOp, rect: Rect, width: number, height: number): Rect;\nexport function apply(op: ApplyOp, a: RectPositioned, b: Rect): RectPositioned;\nexport function apply(op: ApplyOp, a: Rect, b: Rect): Rect;\nexport function apply(\n  op: ApplyOp,\n  a: RectPositioned | Rect,\n  b: Rect | number,\n  c?: number\n): RectPositioned | Rect {\n  guard(a, `a`);\n\n  if (isRect(b)) {\n    // Math op by another rectangle\n    return isRectPositioned(a) ? Object.freeze({\n      ...a,\n      x: op(a.x, b.width),\n      y: op(a.y, b.height),\n      width: op(a.width, b.width),\n      height: op(a.height, b.height),\n    }) : Object.freeze({\n      ...a,\n      width: op(a.width, b.width),\n      height: op(a.height, b.height),\n    });\n  } else {\n    // Math op with a series of values\n    if (typeof b !== `number`) {\n      throw new TypeError(\n        `Expected second parameter of type Rect or number. Got ${ JSON.stringify(\n          b\n        ) }`\n      );\n    }\n    if (typeof c !== `number`) throw new Error(`Expected third param as height. Got ${ JSON.stringify(c) }`);\n    return isRectPositioned(a) ? Object.freeze({\n      ...a,\n      x: op(a.x, b),\n      y: op(a.y, c),\n      width: op(a.width, b),\n      height: op(a.height, c),\n    }) : Object.freeze({\n      ...a,\n      width: op(a.width, b),\n      height: op(a.height, c),\n    });\n  }\n}\n\n/**\n * Uses `op` with `param` to width and height.\n * @param op \n * @param rect \n * @param param \n */\nexport function applyScalar(op: ApplyOp, rect: Rect, param: number): Rect;\n\n/**\n * Uses `op` to apply with `param` to width, height, x & y.\n * Use `applyDim` to apply just to dimensions.\n * @param op \n * @param rect \n * @param param \n */\nexport function applyScalar(\n  op: ApplyOp,\n  rect: RectPositioned,\n  param: number\n): RectPositioned;\n\nexport function applyScalar(\n  op: ApplyOp,\n  rect: Rect | RectPositioned,\n  param: number\n): Rect | RectPositioned {\n  return isPositioned(rect) ? Object.freeze({\n    ...rect,\n    x: op(rect.x, param),\n    y: op(rect.y, param),\n    width: op(rect.width, param),\n    height: op(rect.height, param),\n  }) : Object.freeze({\n    ...rect,\n    width: op(rect.width, param),\n    height: op(rect.height, param),\n  });\n}\n\n/**\n * Applies `op` with `param` to `rect`'s width and height.\n * @param op \n * @param rect \n * @param param \n * @returns \n */\nexport function applyDim(\n  op: ApplyOp,\n  rect: Rect | RectPositioned,\n  param: number\n): Rect | RectPositioned {\n  return Object.freeze({\n    ...rect,\n    width: op(rect.width, param),\n    height: op(rect.height, param),\n  });\n}","import type { RectPositioned } from \"./RectTypes.js\";\nimport type { CardinalDirection } from '../Grid.js';\nimport type { Point } from \"../point/PointType.js\";\n\n/**\n * Returns a point on cardinal direction, or 'center' for the middle.\n *\n * ```js\n * cardinal({x: 10, y:10, width:100, height: 20}, 'center');\n * ```\n * @param rect Rectangle\n * @param card Cardinal direction or 'center'\n * @returns Point\n */\nexport const cardinal = (\n  rect: RectPositioned,\n  card: CardinalDirection | `center`\n): Point => {\n  const { x, y, width, height } = rect;\n  switch (card) {\n    case `nw`: {\n      return Object.freeze({ x, y });\n    }\n    case `n`: {\n      return Object.freeze({\n        x: x + width / 2,\n        y,\n      });\n    }\n    case `ne`: {\n      return Object.freeze({\n        x: x + width,\n        y,\n      });\n    }\n    case `sw`: {\n      return Object.freeze({ x, y: y + height });\n    }\n    case `s`: {\n      return Object.freeze({\n        x: x + width / 2,\n        y: y + height,\n      });\n    }\n    case `se`: {\n      return Object.freeze({\n        x: x + width,\n        y: y + height,\n      });\n    }\n    case `w`: {\n      return Object.freeze({ x, y: y + height / 2 });\n    }\n    case `e`: {\n      return Object.freeze({ x: x + width, y: y + height / 2 });\n    }\n    case `center`: {\n      return Object.freeze({\n        x: x + width / 2,\n        y: y + height / 2,\n      });\n    }\n    default: {\n      // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n      throw new Error(`Unknown direction: ${ card }`);\n    }\n  }\n};","import { isPoint } from \"../point/Guard.js\";\nimport { guard } from \"./Guard.js\";\nimport type { Rect, RectPositioned } from \"./RectTypes.js\";\nimport { joinPointsToLines as LinesJoinPointsToLines } from '../line/JoinPointsToLines.js';\n\nimport type { Point } from '../point/PointType.js';\nimport { corners } from \"./Corners.js\";\nimport type { Line } from \"../line/LineType.js\";\n\n/**\n * Returns four lines based on each corner.\n * Lines are given in order: top, right, bottom, left\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * const rect = { width: 100, height: 100, x: 100, y: 100 };\n * // Yields: array of length four\n * const lines = Rects.lines(rect);\n * ```\n *\n * @param {(RectPositioned|Rect)} rect\n * @param {Points.Point} [origin]\n * @returns {Lines.Line[]}\n */\nexport const edges = (\n  rect: RectPositioned | Rect,\n  origin?: Point\n): ReadonlyArray<Line> => {\n  const c = corners(rect, origin);\n\n  // Connect all the corners, back to first corner again\n  return LinesJoinPointsToLines(...c, c[ 0 ]);\n};\n\n/**\n * Returns a point on the edge of rectangle\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n *\n * const r1 = {x: 10, y: 10, width: 100, height: 50};\n * Rects.getEdgeX(r1, `right`);  // Yields: 110\n * Rects.getEdgeX(r1, `bottom`); // Yields: 10\n *\n * const r2 = {width: 100, height: 50};\n * Rects.getEdgeX(r2, `right`);  // Yields: 100\n * Rects.getEdgeX(r2, `bottom`); // Yields: 0\n * ```\n * @param rect\n * @param edge Which edge: right, left, bottom, top\n * @returns\n */\nexport const getEdgeX = (\n  rect: RectPositioned | Rect,\n  edge: `right` | `bottom` | `left` | `top`\n): number => {\n  guard(rect);\n  switch (edge) {\n    case `top`: {\n      return isPoint(rect) ? rect.x : 0;\n    }\n    case `bottom`: {\n      return isPoint(rect) ? rect.x : 0;\n    }\n    case `left`: {\n      return isPoint(rect) ? rect.y : 0;\n    }\n    case `right`: {\n      return isPoint(rect) ? rect.x + rect.width : rect.width;\n    }\n  }\n};\n\n/**\n * Returns a point on the edge of rectangle\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n *\n * const r1 = {x: 10, y: 10, width: 100, height: 50};\n * Rects.getEdgeY(r1, `right`);  // Yields: 10\n * Rects.getEdgeY(r1, `bottom`); // Yields: 60\n *\n * const r2 = {width: 100, height: 50};\n * Rects.getEdgeY(r2, `right`);  // Yields: 0\n * Rects.getEdgeY(r2, `bottom`); // Yields: 50\n * ```\n * @param rect\n * @param edge Which edge: right, left, bottom, top\n * @returns\n */\nexport const getEdgeY = (\n  rect: RectPositioned | Rect,\n  edge: `right` | `bottom` | `left` | `top`\n): number => {\n  guard(rect);\n  switch (edge) {\n    case `top`: {\n      return (isPoint(rect) ? rect.y : 0);\n    }\n    case `bottom`: {\n      return isPoint(rect) ? rect.y + rect.height : rect.height;\n    }\n    case `left`: {\n      return isPoint(rect) ? rect.y : 0;\n    }\n    case `right`: {\n      return isPoint(rect) ? rect.y : 0;\n    }\n  }\n};","export const Empty = Object.freeze({ width: 0, height: 0 });\nexport const EmptyPositioned = Object.freeze({\n  x: 0,\n  y: 0,\n  width: 0,\n  height: 0,\n});","import type { Rect } from \"./RectTypes.js\";\n\n/**\n * Initialise a rectangle based on the width and height of a HTML element.\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\"\n * Rects.fromElement(document.querySelector(`body`));\n * ```\n * @param el\n * @returns\n */\nexport const fromElement = (el: HTMLElement): Rect => ({\n  width: el.clientWidth,\n  height: el.clientHeight,\n});","import type { RectPositioned, Rect } from \"./RectTypes.js\";\n/**\n * Returns a rectangle from width, height\n * ```js\n * const r = Rects.fromNumbers(100, 200);\n * // {width: 100, height: 200}\n * ```\n *\n * Use {@link toArray} for the opposite conversion.\n *\n * @param width\n * @param height\n */\nexport function fromNumbers(width: number, height: number): Rect;\n\n/**\n * Returns a rectangle from x,y,width,height\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * const r = Rects.fromNumbers(10, 20, 100, 200);\n * // {x: 10, y: 20, width: 100, height: 200}\n * ```\n *\n * Use the spread operator (...) if the source is an array:\n * ```js\n * const r3 = Rects.fromNumbers(...[10, 20, 100, 200]);\n * ```\n *\n * Use {@link toArray} for the opposite conversion.\n *\n * @param x\n * @param y\n * @param width\n * @param height\n */\nexport function fromNumbers(\n  x: number,\n  y: number,\n  width: number,\n  height: number\n): RectPositioned;\n\n/**\n * Returns a rectangle from a series of numbers: x, y, width, height OR width, height\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * const r1 = Rects.fromNumbers(100, 200);\n * // {width: 100, height: 200}\n *\n * const r2 = Rects.fromNumbers(10, 20, 100, 200);\n * // {x: 10, y: 20, width: 100, height: 200}\n * ```\n * Use the spread operator (...) if the source is an array:\n *\n * ```js\n * const r3 = Rects.fromNumbers(...[10, 20, 100, 200]);\n * ```\n *\n * Use {@link toArray} for the opposite conversion.\n *\n * @see toArray\n * @param xOrWidth\n * @param yOrHeight\n * @param width\n * @param height\n * @returns\n */\n//eslint-disable-next-line func-style\nexport function fromNumbers(\n  xOrWidth: number,\n  yOrHeight: number,\n  width?: number,\n  height?: number\n): Rect | RectPositioned {\n  if (width === undefined || height === undefined) {\n    if (typeof xOrWidth !== `number`) throw new Error(`width is not an number`);\n    if (typeof yOrHeight !== `number`) {\n      throw new TypeError(`height is not an number`);\n    }\n    return Object.freeze({ width: xOrWidth, height: yOrHeight });\n  }\n  if (typeof xOrWidth !== `number`) throw new Error(`x is not an number`);\n  if (typeof yOrHeight !== `number`) throw new Error(`y is not an number`);\n  if (typeof width !== `number`) throw new Error(`width is not an number`);\n  if (typeof height !== `number`) throw new Error(`height is not an number`);\n\n  return Object.freeze({ x: xOrWidth, y: yOrHeight, width, height });\n}\n","import { isPoint } from \"../point/Guard.js\";\nimport type { Point } from \"../point/PointType.js\";\nimport { isRect, isRectPositioned } from \"./Guard.js\";\nimport type { Rect, RectPositioned } from \"./RectTypes.js\";\n\n/**\n * Accepts:\n * * x,y,w,h\n * * x,y,rect\n * * point,rect\n * * RectPositioned\n * * Rect, x,y\n * * Rect, Point\n * @param a \n * @param b \n * @param c \n * @param d \n * @returns \n */\nexport function getRectPositionedParameter(a: number | Point | Rect | RectPositioned, b?: Rect | number | Point, c?: number | Rect, d?: number): RectPositioned {\n  if (typeof a === `number`) {\n    if (typeof b === `number`) {\n      if (typeof c === `number` && typeof d === `number`) {\n        return { x: a, y: b, width: c, height: d }\n      } else if (isRect(c)) {\n        return { x: a, y: b, width: c.width, height: c.height }\n      } else {\n        throw new TypeError(`If params 'a' & 'b' are numbers, expect following parameters to be x,y or Rect`);\n      }\n    } else {\n      throw new TypeError(`If parameter 'a' is a number, expect following parameters to be: y,w,h`);\n    }\n  } else if (isRectPositioned(a)) {\n    return a;\n  } else if (isRect(a)) {\n    if (typeof b === `number` && typeof c === `number`) {\n      return { width: a.width, height: a.height, x: b, y: c };\n    } else if (isPoint(b)) {\n      return { width: a.width, height: a.height, x: b.x, y: b.y };\n    } else {\n      throw new TypeError(`If param 'a' is a Rect, expects following parameters to be x,y`);\n    }\n  } else if (isPoint(a)) {\n    if (typeof b === `number` && typeof c === `number`) {\n      return { x: a.x, y: a.y, width: b, height: c };\n    } else if (isRect(b)) {\n      return { x: a.x, y: a.y, width: b.width, height: b.height };\n    } else {\n      throw new TypeError(`If parameter 'a' is a Point, expect following params to be: Rect or width,height`);\n    }\n  }\n  throw new TypeError(`Expect a first parameter to be x,RectPositioned,Rect or Point`);\n}\n\n","import { isPositioned } from \"./Guard.js\";\nimport type { Rect, RectPositioned } from \"./RectTypes.js\";\nimport { isEqual as PointsIsEqual } from '../point/IsEqual.js';\n/**\n * Returns _true_ if the width & height of the two rectangles is the same.\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * const rectA = { width: 10, height: 10, x: 10, y: 10 };\n * const rectB = { width: 10, height: 10, x: 20, y: 20 };\n *\n * // True, even though x,y are different\n * Rects.isEqualSize(rectA, rectB);\n *\n * // False, because coordinates are different\n * Rects.isEqual(rectA, rectB)\n * ```\n * @param a\n * @param b\n * @returns\n */\nexport const isEqualSize = (a: Rect, b: Rect): boolean => {\n  if (a === undefined) throw new Error(`a undefined`);\n  if (b === undefined) throw new Error(`b undefined`);\n  return a.width === b.width && a.height === b.height;\n};\n\n/**\n * Returns _true_ if two rectangles have identical values.\n * Both rectangles must be positioned or not.\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * const rectA = { width: 10, height: 10, x: 10, y: 10 };\n * const rectB = { width: 10, height: 10, x: 20, y: 20 };\n *\n * // False, because coordinates are different\n * Rects.isEqual(rectA, rectB)\n *\n * // True, even though x,y are different\n * Rects.isEqualSize(rectA, rectB);\n * ```\n * @param a\n * @param b\n * @returns\n */\nexport const isEqual = (\n  a: Rect | RectPositioned,\n  b: Rect | RectPositioned\n): boolean => {\n  if (isPositioned(a) && isPositioned(b)) {\n    if (!PointsIsEqual(a, b)) return false;\n    return a.width === b.width && a.height === b.height;\n  } else if (!isPositioned(a) && !isPositioned(b)) {\n    return a.width === b.width && a.height === b.height;\n  } else {\n    // One param is positioned, the other is not\n    return false;\n  }\n};","import { length as LinesLength } from '../line/Length.js';\n\nimport { edges } from './Edges.js';\nimport { guardPositioned } from './Guard.js';\nimport type { RectPositioned } from './RectTypes.js';\n/**\n * Returns the length of each side of the rectangle (top, right, bottom, left)\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * const rect = { width: 100, height: 100, x: 100, y: 100 };\n * // Yields: array of length four\n * const lengths = Rects.lengths(rect);\n * ```\n * @param rect\n * @returns\n */\nexport const lengths = (rect: RectPositioned): ReadonlyArray<number> => {\n  guardPositioned(rect, `rect`);\n  return edges(rect).map((l) => LinesLength(l));\n};\n","import type { RectPositioned, Rect } from \"./RectTypes.js\";\nimport { apply, applyDim, applyScalar } from \"./Apply.js\";\n\nconst multiplyOp = (a: number, b: number) => a * b;\n\n\n/**\n * Multiplies positioned `rect` by width/height. Useful for denormalising a value.\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n *\n * // Normalised rectangle\n * const r = { x:0.5, y:0.5, width: 0.5, height: 0.5};\n *\n * // Map to window:\n * const rr = Rects.multiply(r, window.innerWidth, window.innerHeight);\n * ```\n *\n * Multiplication applies to the first parameter's x/y fields.\n */\nexport function multiply(\n  rect: RectPositioned,\n  width: number,\n  height?: number\n): RectPositioned;\n\n/**\n * Multiplies `rect` by width/height. Useful for denormalising a value.\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n *\n * // Normalised rectangle of width 50%, height 50%\n * const r = { width: 0.5, height: 0.5 };\n *\n * // Map to window:\n * const rr = Rects.multiply(r, window.innerWidth, window.innerHeight);\n * ```\n *\n * Multiplication applies to the first parameter's x/y fields, if present.\n */\nexport function multiply(rect: Rect, width: number, height: number): Rect;\n\n/**\n * Multiplies positioned rect `a` by width and height of rect `b`.\n * ```js\n * // Returns {width: someRect.width * someOtherRect.width ...}\n * Rects.multiply(someRect, someOtherRect);\n * ```\n *\n * @param a \n * @param b \n */\nexport function multiply(a: RectPositioned, b: Rect): RectPositioned;\n\n/**\n * Multiplies rect `a` by width and height of rect `b`.\n * \n * ```js\n * // Returns {width: someRect.width * someOtherRect.width ...}\n * Rects.multiply(someRect, someOtherRect);\n * ```\n *\n * @param a \n * @param b \n */\nexport function multiply(a: Rect, b: Rect): Rect;\n\n/**\n * @internal\n * @param a \n * @param b \n * @param c \n * @returns \n */\nexport function multiply(\n  a: RectPositioned | Rect,\n  b: Rect | number,\n  c?: number\n): RectPositioned | Rect {\n  // @ts-ignore\n  return apply(multiplyOp, a, b, c) as RectPositioned | Rect;\n}\n\n\n/**\n * Multiplies all components of `rect` by `amount`.\n * ```js\n * multiplyScalar({ width:10, height:20 }, 2); // { width:20, height: 40 }\n * ```\n * @param rect\n * @param amount\n */\nexport function multiplyScalar(rect: Rect, amount: number): Rect;\n\n/**\n * Multiplies all components of `rect` by `amount`.\n * This includes x,y if present.\n * \n * ```js\n * multiplyScalar({ width:10, height:20 }, 2); // { width:20, height: 40 }\n * multiplyScalar({ x: 1, y: 2, width:10, height:20 }, 2); // { x: 2, y: 4, width:20, height: 40 }\n * ```\n * @param rect\n * @param amount\n */\nexport function multiplyScalar(\n  rect: RectPositioned,\n  amount: number\n): RectPositioned;\n\n/**\n * Multiplies all components of `rect` by `amount`.\n * This includes x,y if present.\n * \n * ```js\n * multiplyScalar({ width:10, height:20 }, 2); // { width:20, height: 40 }\n * multiplyScalar({ x: 1, y: 2, width:10, height:20 }, 2); // { x: 2, y: 4, width:20, height: 40 }\n * ```\n * \n * Use {@link multiplyDim} to only multiply width & height.\n * @param rect\n * @param amount\n */\nexport function multiplyScalar(\n  rect: Rect | RectPositioned,\n  amount: number\n): Rect | RectPositioned {\n  return applyScalar(multiplyOp, rect, amount);\n  // return isPositioned(rect) ? Object.freeze({\n  //   ...rect,\n  //   x: rect.x * amount,\n  //   y: rect.y * amount,\n  //   width: rect.width * amount,\n  //   height: rect.height * amount,\n  // }) : Object.freeze({\n  //   ...rect,\n  //   width: rect.width * amount,\n  //   height: rect.height * amount,\n  // });\n}\n\n\n/**\n * Multiplies only the width/height of `rect`, leaving `x` and `y` as they are.\n * ```js\n * multiplyDim({ x:1,y:2,width:3,height:4 }, 2);\n * // Yields: { x:1, y:2, width:6, height: 8 }\n * ```\n * \n * In comparison, {@link multiply} will also include x & y.\n * @param rect Rectangle\n * @param amount Amount to multiply by\n * @returns \n */\nexport function multiplyDim(\n  rect: Rect | RectPositioned,\n  amount: number\n): Rect | RectPositioned {\n  return applyDim(multiplyOp, rect, amount);\n  // return isPositioned(rect) ? Object.freeze({\n  //   ...rect,\n  //   x: rect.x * amount,\n  //   y: rect.y * amount,\n  //   width: rect.width * amount,\n  //   height: rect.height * amount,\n  // }) : Object.freeze({\n  //   ...rect,\n  //   width: rect.width * amount,\n  //   height: rect.height * amount,\n  // });\n}\n","import type { RectPositioned, Rect } from \"./RectTypes.js\";\nimport { apply, applyDim, applyScalar } from \"./Apply.js\";\n\nconst divideOp = (a: number, b: number) => a / b;\n\n/**\n * Divides positioned `rect` by width/height. Useful for normalising a value.\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n *\n * // Normalise based on window size\n * const r = { x: 10, y: 200, width: 100, height: 30 };\n * const rr = Rects.divide(r, window.innerWidth, window.innerHeight);\n * ```\n *\n * Division applies to the first parameter's x/y fields. X is affected by `width`, Y is affected by `height`.\n */\nexport function divide(\n  rect: RectPositioned,\n  width: number,\n  height?: number\n): RectPositioned;\n\n/**\n * Divides `rect` by width/height. Useful for denormalising a value.\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * // Normalise based on window size\n * const r = { width: 100, height: 30 };\n * const rr = Rects.divide(r, window.innerWidth, window.innerHeight);\n * ```\n *\n */\nexport function divide(rect: Rect, width: number, height: number): Rect;\n\n/**\n * Divides positioned rect `a` by width and height of rect `b`.\n * ```js\n * // Returns { ...a, width: a.width / b.width, height: a.height/b.height, x: a.x / b.width, y: a.y / b.height }\n * Rects.divide(a, b);\n * ```\n *\n * @param a \n * @param b \n */\nexport function divide(a: RectPositioned, b: Rect): RectPositioned;\n\n/**\n * Divides rect `a` by width and height of rect `b`.\n * \n * ```js\n * // Returns {...a, width: a.width / b.width, height: a.height/b.height }\n * Rects.divide(a, b);\n * ```\n *\n * @param a \n * @param b \n */\nexport function divide(a: Rect, b: Rect): Rect;\n\n/**\n * @internal\n * @param a \n * @param b \n * @param c \n * @returns \n */\nexport function divide(\n  a: RectPositioned | Rect,\n  b: Rect | number,\n  c?: number\n): RectPositioned | Rect {\n  // @ts-ignore\n  return apply(divideOp, a, b, c) as RectPositioned | Rect;\n}\n\n\n/**\n * Divides all components of `rect` by `amount`.\n * ```js\n * divideScalar({ width:10, height:20 }, 2); // { width:5, height: 10 }\n * ```\n * @param rect\n * @param amount\n */\nexport function divideScalar(rect: Rect, amount: number): Rect;\n\n/**\n * Divides all components of `rect` by `amount`.\n * This includes x,y if present.\n * \n * ```js\n * divideScalar({ width:10, height:20 }, 2); // { width:5, height: 10 }\n * divideScalar({ x: 1, y: 2, width:10, height:20 }, 2); // { x: 0.5, y: 1, width:5, height: 10 }\n * ```\n * @param rect\n * @param amount\n */\nexport function divideScalar(\n  rect: RectPositioned,\n  amount: number\n): RectPositioned;\n\n/**\n * Divides all components of `rect` by `amount`.\n * This includes x,y if present.\n * \n * ```js\n * divideScalar({ width:10, height:20 }, 2); // { width:5, height: 10 }\n * divideScalar({ x: 1, y: 2, width:10, height:20 }, 2); // { x: 0.5, y: 1, width:5, height: 10 }\n * ```\n * @param rect\n * @param amount\n */\nexport function divideScalar(\n  rect: Rect | RectPositioned,\n  amount: number\n): Rect | RectPositioned {\n  return applyScalar(divideOp, rect, amount);\n}\n\nexport function divideDim(\n  rect: Rect | RectPositioned,\n  amount: number\n): Rect | RectPositioned {\n  return applyDim(divideOp, rect, amount);\n}\n","import { apply } from \"./Apply.js\";\nimport { isPositioned } from \"./Guard.js\";\nimport type { Rect, RectPositioned } from \"./RectTypes.js\";\n\nconst subtractOp = (a: number, b: number) => a - b;\n\n/**\n * Subtracts width/height of `b` from `a` (ie: a - b), returning result.\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * const rectA = { width: 100, height: 100 };\n * const rectB = { width: 200, height: 200 };\n *\n * // Yields: { width: -100, height: -100 }\n * Rects.subtract(rectA, rectB);\n * ```\n * @param a\n * @param b\n */\nexport function subtract(a: Rect, b: Rect): Rect;\nexport function subtract(a: RectPositioned, b: Rect): RectPositioned;\n\n/**\n * Subtracts a width/height from `a`, returning result.\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * const rect = { width: 100, height: 100 };\n *\n * // Yields: { width: -100, height: -100 }\n * Rects.subtract(rect, 200, 200);\n * ```\n * @param a\n * @param width\n * @param height\n */\nexport function subtract(a: Rect, width: number, height: number): Rect;\n\nexport function subtract(a: RectPositioned, width: number, height: number): RectPositioned;\n/**\n * Subtracts width/height from `a`.\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * const rectA = { width: 100, height: 100 };\n * const rectB = { width: 200, height: 200 };\n *\n * // Yields: { width: -100, height: -100 }\n * Rects.subtract(rectA, rectB);\n * Rects.subtract(rectA, 200, 200);\n * ```\n * @param a\n * @param b\n * @param c\n * @returns\n */\nexport function subtract(a: Rect | undefined, b: Rect | number, c?: number): Rect {\n  // @ts-ignore\n  return apply(subtractOp, a, b, c);\n}\n\n/**\n * Subtracts x,y,width,height of a-b.\n * ```js\n * subtractOffset({x:100,y:100,width:100,height:100}, {x:10, y:20, width: 30, height: 40});\n * // Yields: {x: 90, y: 80, width: 70, height: 60 }\n * ```\n * If either `a` or `b` are missing x & y, 0 is used\n * @param a \n * @param b \n * @returns \n */\nexport function subtractOffset(a: RectPositioned | Rect, b: RectPositioned | Rect): RectPositioned {\n  let x = 0;\n  let y = 0;\n  if (isPositioned(a)) {\n    x = a.x;\n    y = a.y;\n  }\n  let xB = 0;\n  let yB = 0;\n  if (isPositioned(b)) {\n    xB = b.x;\n    yB = b.y;\n  }\n  return Object.freeze({\n    ...a,\n    x: x - xB,\n    y: y - yB,\n    width: a.width - b.width,\n    height: a.height - b.height\n  })\n}","import { apply } from \"./Apply.js\";\nimport { getRectPositioned, isPositioned } from \"./Guard.js\";\nimport type { Rect, RectPositioned } from \"./RectTypes.js\";\n\nconst sumOp = (a: number, b: number) => a + b;\n/**\n * Sums width/height of `b` with `a` (ie: a + b), returning result.\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * const rectA = { width: 100, height: 100 };\n * const rectB = { width: 200, height: 200 };\n *\n * // Yields: { width: 300, height: 300 }\n * Rects.sum(rectA, rectB);\n * ```\n * @param a\n * @param b\n */\nexport function sum(a: Rect, b: Rect): Rect;\n\n/**\n * Sums width/height of `b` with `a`, returning result.\n * \n * Note that width/height of `b` is also added to `a`'s x & y properties\n * ```js\n * // Yields: { x:101, y:202, width: 110, height: 220 }\n * sum({x:1, y:2, width:10, height:20}, {width:100, height: 200});\n * ```\n * \n * x & y values of `b` are ignored. If you want to sum with those, use `sumOffset`\n * @param a \n * @param b \n */\nexport function sum(a: RectPositioned, b: Rect): RectPositioned;\n\n/**\n * Sums width/height of `rect` with given `width` and `height`\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * const rect = { width: 100, height: 100 };\n *\n * // Yields: { width: 300, height: 300 }\n * Rects.subtract(rect, 200, 200);\n * ```\n * @param rect\n * @param width\n * @param height\n */\nexport function sum(rect: Rect, width: number, height: number): Rect;\n\n/**\n * Sums width/height of `rect` with `width` and `height`\n * \n * `width` and `height` is added to `rect`'s `x` and `y` values.\n * ```js\n * // Yields: { x:101, y:202, width: 110, height: 220 }\n * sum({x:1, y:2, width:10, height:20}, 100, 200);\n * ```\n * @param rect\n * @param width\n * @param height\n */\nexport function sum(rect: RectPositioned, width: number, height: number): RectPositioned;\n\n/**\n * Sums width/height of `b` with `a` (ie: a + b), returning result.\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * const rectA = { width: 100, height: 100 };\n * const rectB = { width: 200, height: 200 };\n *\n * // Yields: { width: 300, height: 300 }\n * Rects.sum(rectA, rectB);\n * Rects.sum(rectA, 200, 200);\n * ```\n * @param a\n * @param b\n * @param c\n * @returns\n */\n//eslint-disable-next-line func-style\nexport function sum(a: Rect, b: Rect | number, c?: number): Rect {\n  // @ts-ignore\n  return apply(sumOp, a, b, c);\n}\n\n/**\n * Sums x,y,width,height of a+b.\n * ```js\n * sumOffset({x:100,y:100,width:100,height:100}, {x:10, y:20, width: 30, height: 40});\n * // Yields: {x: 110, y: 120, width: 130, height: 140 }\n * ```\n * If either `a` or `b` are missing x & y, 0 is used\n * @param a \n * @param b \n * @returns \n */\nexport function sumOffset(a: RectPositioned | Rect, b: RectPositioned | Rect): RectPositioned {\n  let x = 0;\n  let y = 0;\n  if (isPositioned(a)) {\n    x = a.x;\n    y = a.y;\n  }\n  let xB = 0;\n  let yB = 0;\n  if (isPositioned(b)) {\n    xB = b.x;\n    yB = b.y;\n  }\n  return Object.freeze({\n    ...a,\n    x: x + xB,\n    y: y + yB,\n    width: a.width + b.width,\n    height: a.height + b.height\n  })\n}","import { isPositioned, isRect } from \"./Guard.js\";\nimport type { Rect, RectArray, RectPositioned, RectPositionedArray } from \"./RectTypes.js\";\n\n/**\n * Converts a rectangle to an array of numbers. See {@link fromNumbers} for the opposite conversion.\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n *\n * const r1 = Rects.toArray({ x: 10, y:20, width: 100, height: 200 });\n * // [10, 20, 100, 200]\n * const r2 = Rects.toArray({ width: 100, height: 200 });\n * // [100, 200]\n * ```\n * @param rect\n * @see fromNumbers\n */\nexport function toArray(rect: Rect): RectArray;\n\n/**\n * Converts a rectangle to an array of numbers. See {@link fromNumbers} for the opposite conversion.\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n *\n * const r1 = Rects.toArray({ x: 10, y:20, width: 100, height: 200 });\n * // [10, 20, 100, 200]\n * const r2 = Rects.toArray({ width: 100, height: 200 });\n * // [100, 200]\n * ```\n * @param rect\n * @see fromNumbers\n */\nexport function toArray(rect: RectPositioned): RectPositionedArray;\n\n/**\n * Converts a rectangle to an array of numbers. See {@link fromNumbers} for the opposite conversion.\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * const r1 = Rects.toArray({ x: 10, y:20, width: 100, height: 200 });\n * // [10, 20, 100, 200]\n * const r2 = Rects.toArray({ width: 100, height: 200 });\n * // [100, 200]\n * ```\n * @param rect\n * @see fromNumbers\n */\n// eslint-disable-next-line func-style\nexport function toArray(\n  rect: Rect | RectPositioned\n): RectArray | RectPositionedArray {\n  if (isPositioned(rect)) {\n    return [ rect.x, rect.y, rect.width, rect.height ];\n  } else if (isRect(rect)) {\n    return [ rect.width, rect.height ];\n  } else {\n    throw new Error(\n      `Param 'rect' is not a rectangle. Got: ${ JSON.stringify(rect) }`\n    );\n  }\n}\n","import type { Point } from '../point/PointType.js';\nimport { isLine } from '../line/Guard.js';\nimport type { Path } from './PathType.js';\nimport { isQuadraticBezier } from '../bezier/Guard.js';\nexport * from './PathType.js';\n/**\n * Return the start point of a path\n *\n * @param path\n * @return Point\n */\nexport const getStart = function (path: Path): Point {\n  if (isQuadraticBezier(path)) return path.a;\n  else if (isLine(path)) return path.a;\n  else throw new Error(`Unknown path type ${ JSON.stringify(path) }`);\n};\n\n/**\n * Return the end point of a path\n *\n * @param path\n * @return Point\n */\nexport const getEnd = function (path: Path): Point {\n  if (isQuadraticBezier(path)) return path.b;\n  else if (isLine(path)) return path.b;\n  else throw new Error(`Unknown path type ${ JSON.stringify(path) }`);\n};\n\n","import type { Path } from \"../path/PathType.js\";\nimport type { QuadraticBezier, CubicBezier } from \"./BezierType.js\";\n\nexport const isQuadraticBezier = (path: Path | QuadraticBezier | CubicBezier): path is QuadraticBezier => (path as QuadraticBezier).quadratic !== undefined;\n\nexport const isCubicBezier = (path: Path | CubicBezier | QuadraticBezier): path is CubicBezier => (path as CubicBezier).cubic1 !== undefined && (path as CubicBezier).cubic2 !== undefined;\n","import type { Point } from './point/PointType.js';\nimport { fromTopLeft as RectsFromTopLeft } from './rect/FromTopLeft.js';\nimport { throwIntegerTest, throwNumberTest } from '../util/GuardNumbers.js';\nimport { clampIndex } from '../numbers/Clamp.js';\nimport { randomElement } from '../data/arrays/Random.js';\nimport { type ISetMutable, mutable } from '../collections/set/index.js';\nimport { zipKeyValue } from '../data/maps/MapFns.js';\nimport type { RectPositioned } from './rect/RectTypes.js';\n\nexport type GridVisual = Grid & {\n  readonly size: number;\n};\n\nexport type Grid = {\n  readonly rows: number;\n  readonly cols: number;\n};\n\nexport type Cell = {\n  readonly x: number;\n  readonly y: number;\n};\n\nexport type Neighbours = {\n  readonly n: Cell | undefined;\n  readonly e: Cell | undefined;\n  readonly s: Cell | undefined;\n  readonly w: Cell | undefined;\n  readonly ne: Cell | undefined;\n  readonly nw: Cell | undefined;\n  readonly se: Cell | undefined;\n  readonly sw: Cell | undefined;\n};\n\nexport type CardinalDirection =\n  | `n`\n  | `ne`\n  | `e`\n  | `se`\n  | `s`\n  | `sw`\n  | `w`\n  | `nw`;\nexport type CardinalDirectionOptional = CardinalDirection | ``;\n\n/**\n * Bounds logic\n * * Unbounded: attempts to read beyond limits\n * * Undefined: returns _undefined_ when reading beyond limits\n * * Stop: returns cell value at edge of limits\n * * Wrap: Wrap-around cell positions\n * \n */\nexport type BoundsLogic =\n  /**\n   * Unbounded: attempts to read beyond limits\n   */\n  `unbounded` |\n  /**\n   * Undefined: returns _undefined_ when reading beyond limits\n   */\n  `undefined` |\n  /**\n   * Stop: returns cell value at edge of limits\n   */\n  `stop` |\n  /**\n   * Wrap-around cell positions\n   */\n  `wrap`;\n\nexport type VisitorLogic = {\n  readonly options?: IdentifyNeighbours;\n  readonly select: NeighbourSelector;\n};\nexport type VisitGenerator = Generator<Readonly<Cell>, void>;\nexport type VisitorOpts = {\n  readonly visited?: ISetMutable<Cell>;\n  readonly reversed?: boolean;\n  readonly debug?: boolean;\n  readonly boundsWrap?: BoundsLogic;\n};\n\n/**\n * Visitor function.\n *\n * Implementations:\n * * {@link cells}: left-to-right, top-to-bottom. Same as {@link visitorRow}\n * * {@link visitorBreadth}, {@link visitorDepth}\n * * {@link visitorColumn}: top-to-bottom, left-to-right.\n * * {@link visitorRandom}: Any unvisited location\n * * {@link visitorRandomContiguous}: A random direct neighbour of current cell\n */\nexport type Visitor = (\n  grid: Grid,\n  start: Cell,\n  opts?: VisitorOpts\n) => VisitGenerator;\n\nexport type NeighbourMaybe = readonly [ keyof Neighbours, Cell | undefined ];\nexport type Neighbour = readonly [ keyof Neighbours, Cell ];\n\n/**\n * A function that returns a value (or _undefined_) based on a _cell_\n *\n * Implementations:\n * * {@link access1dArray}: For accessing a single-dimension array as a grid\n */\nexport type CellAccessor<V> = (cell: Cell, wrap: BoundsLogic) => V | undefined;\n\n/**\n * Neighbour selector logic. For a given set of `neighbours` pick one to visit next.\n */\nexport type NeighbourSelector = (\n  neighbours: ReadonlyArray<Neighbour>\n) => Neighbour | undefined;\n\n/**\n * Identify neighbours logic. For a given `grid` and `origin`, return a list of neighbours\n */\nexport type IdentifyNeighbours = (\n  grid: Grid,\n  origin: Cell\n) => ReadonlyArray<Neighbour>;\n\n/**\n * Returns true if `cell` parameter is a cell with x,y fields.\n * Does not check validity of fields.\n *\n * @param cell\n * @return True if parameter is a cell\n */\nconst isCell = (cell: Cell | undefined): cell is Cell => {\n  if (cell === undefined) return false;\n  return `x` in cell && `y` in cell;\n};\n\n/**\n * Returns true if `n` is a Neighbour type, eliminating NeighbourMaybe possibility\n *\n * @param n\n * @return\n */\nconst isNeighbour = (\n  n: Neighbour | NeighbourMaybe | undefined\n): n is Neighbour => {\n  if (n === undefined) return false;\n  if (n[ 1 ] === undefined) return false;\n  return true;\n};\n\n/**\n * Returns _true_ if grids `a` and `b` are equal in value.\n * Returns _false_ if either parameter is undefined.\n *\n * @param a\n * @param b\n * @return\n */\nexport const isEqual = (\n  a: Grid | GridVisual,\n  b: Grid | GridVisual\n): boolean => {\n  if (b === undefined) return false;\n  if (a === undefined) return false;\n  if (`rows` in a && `cols` in a) {\n    if (`rows` in b && `cols` in b) {\n      if (a.rows !== b.rows || a.cols !== b.cols) return false;\n    } else return false;\n  }\n  if (`size` in a) {\n    if (`size` in b) {\n      if (a.size !== b.size) return false;\n    } else return false;\n  }\n  return true;\n};\n\n/**\n * Returns a key string for a cell instance\n * A key string allows comparison of instances by value rather than reference\n *\n * ```js\n * cellKeyString({x:10,y:20});\n * // Yields: \"Cell{10,20}\";\n * ```\n * @param v\n * @returns\n */\nexport const cellKeyString = (v: Cell): string => `Cell{${ v.x },${ v.y }}`;\n\n/**\n * Returns _true_ if two cells equal.\n * Returns _false_ if either cell are undefined\n *\n * @param a\n * @param b\n * @returns\n */\nexport const cellEquals = (\n  a: Cell | undefined,\n  b: Cell | undefined\n): boolean => {\n  if (b === undefined) return false;\n  if (a === undefined) return false;\n  return a.x === b.x && a.y === b.y;\n};\n\n/**\n * Throws an exception if any of the cell's parameters are invalid\n * @private\n * @param cell\n * @param parameterName\n * @param grid\n */\nexport const guardCell = (\n  cell: Cell,\n  parameterName = `Param`,\n  grid?: Grid\n) => {\n  if (cell === undefined) {\n    throw new Error(parameterName + ` is undefined. Expecting {x,y}`);\n  }\n  if (cell.x === undefined) throw new Error(parameterName + `.x is undefined`);\n  if (cell.y === undefined) throw new Error(parameterName + `.y is undefined`);\n  if (Number.isNaN(cell.x)) throw new Error(parameterName + `.x is NaN`);\n  if (Number.isNaN(cell.y)) throw new Error(parameterName + `.y is NaN`);\n  if (!Number.isInteger(cell.x)) {\n    throw new TypeError(parameterName + `.x is non-integer`);\n  }\n  if (!Number.isInteger(cell.y)) {\n    throw new TypeError(parameterName + `.y is non-integer`);\n  }\n  if (grid !== undefined && !inside(grid, cell)) {\n    throw new Error(\n      `${ parameterName } is outside of grid. Cell: ${ cell.x },${ cell.y } Grid: ${ grid.cols }, ${ grid.rows }`\n    );\n  }\n};\n\n/**\n * Throws an exception if any of the grid's parameters are invalid\n * @param grid\n * @param parameterName\n */\nconst guardGrid = (grid: Grid, parameterName = `Param`) => {\n  if (grid === undefined) {\n    throw new Error(`${ parameterName } is undefined. Expecting grid.`);\n  }\n  if (!(`rows` in grid)) throw new Error(`${ parameterName }.rows is undefined`);\n  if (!(`cols` in grid)) throw new Error(`${ parameterName }.cols is undefined`);\n\n  if (!Number.isInteger(grid.rows)) {\n    throw new TypeError(`${ parameterName }.rows is not an integer`);\n  }\n  if (!Number.isInteger(grid.cols)) {\n    throw new TypeError(`${ parameterName }.cols is not an integer`);\n  }\n};\n\n/**\n * Returns _true_ if cell coordinates are above zero and within bounds of grid\n *\n * @param grid\n * @param cell\n * @return\n */\nexport const inside = (grid: Grid, cell: Cell): boolean => {\n  if (cell.x < 0 || cell.y < 0) return false;\n  if (cell.x >= grid.cols || cell.y >= grid.rows) return false;\n  return true;\n};\n\n/**\n * Returns a visual rectangle of the cell, positioned from the top-left corner\n *\n * ```js\n * const cell = { x: 1, y: 0 };\n *\n * // 5x5 grid, each cell 5px in size\n * const grid = { rows: 5, cols: 5, size: 5 }\n *\n * const r = rectangleForCell(grid, cell,);\n *\n * // Yields: { x: 5, y: 0, width: 5, height: 5 }\n * ```\n * @param cell\n * @param grid\n * @return\n */\nexport const rectangleForCell = (\n  grid: GridVisual,\n  cell: Cell\n): RectPositioned => {\n  guardCell(cell);\n  const size = grid.size;\n  const x = cell.x * size;\n  const y = cell.y * size;\n  const r = RectsFromTopLeft({ x: x, y: y }, size, size);\n  return r;\n};\n\n/**\n * Generator that returns rectangles for each cell in a grid\n *\n * @example Draw rectangles\n * ```js\n * import { Drawing } from 'visuals.js'\n * const rects = [...Grids.asRectangles(grid)];\n * Drawing.rect(ctx, rects, { strokeStyle: `silver`});\n * ```\n * @param grid\n */\nexport function* asRectangles(\n  grid: GridVisual\n): IterableIterator<RectPositioned> {\n  for (const c of cells(grid)) {\n    yield rectangleForCell(grid, c);\n  }\n}\n\n/**\n * Returns a two-dimensional array according to `grid`\n * size.\n *\n * ```js\n * const a = Grids.toArray({ rows: 3, cols: 2 });\n * Yields:\n * [ [_,_] ]\n * [ [_,_] ]\n * [ [_,_] ]\n * ```\n *\n * `initialValue` can be provided to set the value\n * for all cells.\n * @param grid Grid\n * @param initialValue Initial value\n * @returns\n */\n//eslint-disable-next-line functional/prefer-readonly-type\nexport const toArray = <V>(grid: Grid, initialValue?: V): Array<Array<V>> => {\n  const returnValue = [];\n  //eslint-disable-next-line functional/no-let\n  for (let row = 0; row < grid.rows; row++) {\n    //eslint-disable-next-line functional/immutable-data\n    returnValue[ row ] = Array.from<V>({ length: grid.cols });\n    if (initialValue) {\n      //eslint-disable-next-line functional/no-let\n      for (let col = 0; col < grid.cols; col++) {\n        //eslint-disable-next-line functional/immutable-data\n        returnValue[ row ][ col ] = initialValue;\n      }\n    }\n  }\n  return returnValue;\n};\n\n/**\n * Returns the cell at a specified visual coordinate\n * or _undefined_ if the position is outside of the grid.\n *\n * `position` must be in same coordinate/scale as the grid.\n *\n * @param position Position, eg in pixels\n * @param grid Grid\n * @return Cell at position or undefined if outside of the grid\n */\nexport const cellAtPoint = (\n  grid: GridVisual,\n  position: Point\n): Cell | undefined => {\n  const size = grid.size;\n  throwNumberTest(size, `positive`, `grid.size`);\n  if (position.x < 0 || position.y < 0) return;\n  const x = Math.floor(position.x / size);\n  const y = Math.floor(position.y / size);\n  if (x >= grid.cols) return;\n  if (y >= grid.rows) return;\n  return { x, y };\n};\n\n/**\n * Returns a list of all cardinal directions: n, ne, nw, e, s, se, sw, w\n */\nexport const allDirections = Object.freeze([\n  `n`,\n  `ne`,\n  `nw`,\n  `e`,\n  `s`,\n  `se`,\n  `sw`,\n  `w`,\n]) as ReadonlyArray<CardinalDirection>;\n\n/**\n * Returns a list of + shaped directions: n, e, s, w\n */\nexport const crossDirections = Object.freeze([\n  `n`,\n  `e`,\n  `s`,\n  `w`,\n]) as ReadonlyArray<CardinalDirection>;\n\n/**\n * Returns neighbours for a cell. If no `directions` are provided, it defaults to {@link allDirections}.\n *\n * ```js\n * const grid = { rows: 5, cols: 5 };\n * const cell = { x:2, y:2 };\n *\n * // Get n,ne,nw,e,s,se,sw and w neighbours\n * const n = Grids.neighbours(grid, cell, `wrap`);\n *\n * Yields:\n * {\n *  n: {x: 2, y: 1}\n *  s: {x: 2, y: 3}\n *  ....\n * }\n * ```\n *\n * Returns neighbours without diagonals (ie n, e, s, w):\n * ```js\n * const n = Grids.neighbours(grid, cell, `stop`, Grids.crossDirections);\n * ```\n * @returns Returns a map of cells, keyed by cardinal direction\n * @param grid Grid\n * @param cell Cell\n * @param bounds How to handle edges of grid\n * @param directions Directions to return\n */\nexport const neighbours = (\n  grid: Grid,\n  cell: Cell,\n  bounds: BoundsLogic = `undefined`,\n  directions?: ReadonlyArray<CardinalDirection>\n): Neighbours => {\n  const directories = directions ?? allDirections;\n  const points = directories.map((c) =>\n    offset(grid, cell, getVectorFromCardinal(c), bounds)\n  );\n  return zipKeyValue<Cell>(directories, points) as Neighbours;\n};\n\nexport function* visitNeigbours(\n  grid: Grid,\n  cell: Cell,\n  bounds: BoundsLogic = `undefined`,\n  directions?: ReadonlyArray<CardinalDirection>\n) {\n  const directories = directions ?? allDirections;\n  const points = directories.map((c) =>\n    offset(grid, cell, getVectorFromCardinal(c), bounds)\n  );\n  for (const pt of points) {\n    if (pt !== undefined) yield pt;\n  }\n}\n\n/**\n * Returns the visual midpoint of a cell (eg. pixel coordinate)\n *\n * @param cell\n * @param grid\n * @return\n */\nexport const cellMiddle = (grid: GridVisual, cell: Cell): Point => {\n  guardCell(cell);\n\n  const size = grid.size;\n  const x = cell.x * size; // + (grid.spacing ? cell.x * grid.spacing : 0);\n  const y = cell.y * size; // + (grid.spacing ? cell.y * grid.spacing : 0);\n  return Object.freeze({ x: x + size / 2, y: y + size / 2 });\n};\n\n/**\n * Returns the cells on the line of `start` and `end`, inclusive\n *\n * ```js\n * // Get cells that connect 0,0 and 10,10\n * const cells = Grids.getLine({x:0,y:0}, {x:10,y:10});\n * ```\n *\n * This function does not handle wrapped coordinates.\n * @param start Starting cell\n * @param end End cell\n * @returns\n */\nexport const getLine = (start: Cell, end: Cell): ReadonlyArray<Cell> => {\n  // https://stackoverflow.com/a/4672319\n  guardCell(start);\n  guardCell(end);\n\n  // eslint-disable-next-line functional/no-let\n  let startX = start.x;\n  // eslint-disable-next-line functional/no-let\n  let startY = start.y;\n  const dx = Math.abs(end.x - startX);\n  const dy = Math.abs(end.y - startY);\n  const sx = startX < end.x ? 1 : -1;\n  const sy = startY < end.y ? 1 : -1;\n  // eslint-disable-next-line functional/no-let\n  let error = dx - dy;\n\n  const cells = [];\n  // eslint-disable-next-line no-constant-condition\n  while (true) {\n    // eslint-disable-next-line functional/immutable-data\n    cells.push(Object.freeze({ x: startX, y: startY }));\n    if (startX === end.x && startY === end.y) break;\n    const error2 = 2 * error;\n    if (error2 > -dy) {\n      error -= dy;\n      startX += sx;\n    }\n    if (error2 < dx) {\n      error += dx;\n      startY += sy;\n    }\n  }\n  return cells;\n};\n\n/**\n * Returns cells that correspond to the cardinal directions at a specified distance\n * i.e. it projects a line from `start` cell in all cardinal directions and returns the cells at `steps` distance.\n * @param grid Grid\n * @param steps Distance\n * @param start Start poiint\n * @param bounds Logic for if bounds of grid are exceeded\n * @returns Cells corresponding to cardinals\n */\nexport const offsetCardinals = (\n  grid: Grid,\n  start: Cell,\n  steps: number,\n  bounds: BoundsLogic = `stop`\n): Neighbours => {\n  guardGrid(grid, `grid`);\n  guardCell(start, `start`);\n  throwIntegerTest(steps, `aboveZero`, `steps`);\n\n  const directions = allDirections;\n  const vectors = directions.map((d) => getVectorFromCardinal(d, steps));\n  const cells = directions.map((d, index) =>\n    offset(grid, start, vectors[ index ], bounds)\n  );\n\n  return zipKeyValue(directions, cells) as Neighbours;\n};\n\n/**\n * Returns an `{ x, y }` signed vector corresponding to the provided cardinal direction.\n * ```js\n * const n = getVectorFromCardinal(`n`); // {x: 0, y: -1}\n * ```\n *\n * Optional `multiplier` can be applied to vector\n * ```js\n * const n = getVectorFromCardinal(`n`, 10); // {x: 0, y: -10}\n * ```\n *\n * Blank direction returns `{ x: 0, y: 0 }`\n * @param cardinal Direction\n * @param multiplier Multipler\n * @returns Signed vector in the form of `{ x, y }`\n */\nexport const getVectorFromCardinal = (\n  cardinal: CardinalDirectionOptional,\n  multiplier = 1\n): Cell => {\n  // eslint-disable-next-line functional/no-let\n  let v;\n  switch (cardinal) {\n    case `n`: {\n      v = { x: 0, y: -1 * multiplier };\n      break;\n    }\n    case `ne`: {\n      v = { x: 1 * multiplier, y: -1 * multiplier };\n      break;\n    }\n    case `e`: {\n      v = { x: 1 * multiplier, y: 0 };\n      break;\n    }\n    case `se`: {\n      v = { x: 1 * multiplier, y: 1 * multiplier };\n      break;\n    }\n    case `s`: {\n      v = { x: 0, y: 1 * multiplier };\n      break;\n    }\n    case `sw`: {\n      v = { x: -1 * multiplier, y: 1 * multiplier };\n      break;\n    }\n    case `w`: {\n      v = { x: -1 * multiplier, y: 0 };\n      break;\n    }\n    case `nw`: {\n      v = { x: -1 * multiplier, y: -1 * multiplier };\n      break;\n    }\n    default: {\n      v = { x: 0, y: 0 };\n    }\n  }\n  return Object.freeze(v);\n};\n\n/**\n * Returns a list of cells from `start` to `end`.\n *\n * Throws an error if start and end are not on same row or column.\n *\n * @param start Start cell\n * @param end end clel\n * @param endInclusive\n * @return Array of cells\n */\nexport const simpleLine = function (\n  start: Cell,\n  end: Cell,\n  endInclusive = false\n): ReadonlyArray<Cell> {\n  // eslint-disable-next-line functional/prefer-readonly-type\n  const cells: Array<Cell> = [];\n  if (start.x === end.x) {\n    // Vertical\n    const lastY = endInclusive ? end.y + 1 : end.y;\n    // eslint-disable-next-line functional/no-let\n    for (let y = start.y; y < lastY; y++) {\n      // eslint-disable-next-line functional/immutable-data\n      cells.push({ x: start.x, y: y });\n    }\n  } else if (start.y === end.y) {\n    // Horizontal\n    const lastX = endInclusive ? end.x + 1 : end.x;\n    // eslint-disable-next-line functional/no-let\n    for (let x = start.x; x < lastX; x++) {\n      // eslint-disable-next-line functional/immutable-data\n      cells.push({ x: x, y: start.y });\n    }\n  } else {\n    throw new Error(\n      `Only does vertical and horizontal: ${ start.x },${ start.y } - ${ end.x },${ end.y }`\n    );\n  }\n  return cells;\n};\n\n/**\n *\n * Returns a coordinate offset from `start` by `vector` amount.\n *\n * Different behaviour can be specified for how to handle when coordinates exceed the bounds of the grid\n *\n *\n * Note: x and y wrapping are calculated independently. A large wrapping of x, for example won't shift up/down a line\n * @param grid Grid to traverse\n * @param vector Offset in x/y\n * @param start Start point\n * @param bounds\n * @returns Cell\n */\nexport const offset = function (\n  grid: Grid,\n  start: Cell,\n  vector: Cell,\n  bounds: BoundsLogic = `undefined`\n): Cell | undefined {\n  guardCell(start, `start`, grid);\n  guardCell(vector);\n  guardGrid(grid, `grid`);\n\n  // eslint-disable-next-line functional/no-let\n  let x = start.x;\n  // eslint-disable-next-line functional/no-let\n  let y = start.y;\n  switch (bounds) {\n    case `wrap`: {\n      x += vector.x % grid.cols;\n      y += vector.y % grid.rows;\n      if (x < 0) x = grid.cols + x;\n      else if (x >= grid.cols) {\n        x -= grid.cols;\n      }\n      if (y < 0) y = grid.rows + y;\n      else if (y >= grid.rows) {\n        y -= grid.rows;\n      }\n      break;\n    }\n    case `stop`: {\n      x += vector.x;\n      y += vector.y;\n      x = clampIndex(x, grid.cols);\n      y = clampIndex(y, grid.rows);\n      break;\n    }\n    case `undefined`: {\n      x += vector.x;\n      y += vector.y;\n      if (x < 0 || y < 0) return;\n      if (x >= grid.cols || y >= grid.rows) return;\n      break;\n    }\n    case `unbounded`: {\n      x += vector.x;\n      y += vector.y;\n      break;\n    }\n    default: {\n      // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n      throw new Error(`Unknown BoundsLogic case ${ bounds }`);\n    }\n  }\n  return Object.freeze({ x, y });\n};\n\nconst neighbourList = (\n  grid: Grid,\n  cell: Cell,\n  directions: ReadonlyArray<CardinalDirection>,\n  bounds: BoundsLogic\n): ReadonlyArray<NeighbourMaybe> => {\n  // Get neighbours for cell\n  const cellNeighbours = neighbours(grid, cell, bounds, directions);\n\n  // Filter out undefined cells\n  const entries = Object.entries(cellNeighbours);\n  return (entries as Array<NeighbourMaybe>).filter(n => isNeighbour(n));\n};\n\n/**\n * Visits every cell in grid using supplied selection function\n * In-built functions to use: visitorDepth, visitorBreadth, visitorRandom,\n * visitorColumn, visitorRow.\n *\n * Usage example:\n * ```js\n *  let visitor = Grids.visitor(Grids.visitorRandom, grid, startCell);\n *  for (let cell of visitor) {\n *   // do something with cell\n *  }\n * ```\n *\n * If you want to keep tabs on the visitor, pass in a MutableValueSet. This is\n * updated with visited cells (and is used internally anyway)\n * ```js\n *  let visited = new mutableValueSet<Grids.Cell>(c => Grids.cellKeyString(c));\n *  let visitor = Grids.visitor(Grids.visitorRandom, grid, startCell, visited);\n * ```\n *\n * To visit with some delay, try this pattern\n * ```js\n *  const delayMs = 100;\n *  const run = () => {\n *   let cell = visitor.next().value;\n *   if (cell === undefined) return;\n *   // Do something with cell\n *   setTimeout(run, delayMs);\n *  }\n *  setTimeout(run, delayMs);\n * ```\n * @param logic Logic for selecting next cell\n * @param grid Grid to visit\n * @param start Starting cell\n * @param opts Options\n * @returns Cells\n */\nexport const visitor = function* (\n  logic: VisitorLogic,\n  grid: Grid,\n  start: Cell,\n  opts: VisitorOpts = {}\n): VisitGenerator {\n  guardGrid(grid, `grid`);\n  guardCell(start, `start`, grid);\n\n  const v = opts.visited ?? mutable<Cell>(cellKeyString);\n  const possibleNeighbours = logic.options ?? ((g: Grid, c: Cell) => neighbourList(g, c, crossDirections, `undefined`));\n\n  if (!isCell(start)) {\n    throw new Error(`'start' parameter is undefined or not a cell`);\n  }\n\n  let cellQueue: Array<Cell> = [ start ];\n  let moveQueue: Array<Neighbour> = [];\n  let current: Cell | undefined = undefined;\n\n  while (cellQueue.length > 0) {\n    if (current === undefined) {\n      const nv = cellQueue.pop();\n      if (nv === undefined) {\n        break;\n      }\n      current = nv;\n    }\n\n    if (!v.has(current)) {\n      v.add(current);\n      yield current;\n\n      const nextSteps = possibleNeighbours(grid, current).filter(\n        (step) => {\n          if (step[ 1 ] === undefined) return false;\n          return !v.has(step[ 1 ])\n        }\n      );\n\n      if (nextSteps.length === 0) {\n        // No more moves for this cell\n        if (current !== undefined) {\n          cellQueue = cellQueue.filter((cq) => cellEquals(cq, current));\n        }\n      } else {\n        for (const n of nextSteps) {\n          if (n === undefined) continue;\n          if (n[ 1 ] === undefined) continue;\n          // @ts-expect-error\n          moveQueue.push(n);\n        }\n        //moveQueue.push(...nextSteps);\n      }\n    }\n\n    // Remove steps already made\n    moveQueue = moveQueue.filter((step) => !v.has(step[ 1 ]));\n\n    if (moveQueue.length === 0) {\n      current = undefined;\n    } else {\n      // Pick move\n      const potential = logic.select(moveQueue);\n      if (potential !== undefined) {\n        // eslint-disable-next-line functional/immutable-data\n        cellQueue.push(potential[ 1 ]);\n        current = potential[ 1 ];\n      }\n    }\n  }\n};\n\nexport const visitorDepth = (grid: Grid, start: Cell, opts: VisitorOpts = {}) =>\n  visitor(\n    {\n      select: (nbos) => nbos.at(-1),\n    },\n    grid,\n    start,\n    opts\n  );\n\nexport const visitorBreadth = (\n  grid: Grid,\n  start: Cell,\n  opts: VisitorOpts = {}\n) =>\n  visitor(\n    {\n      select: (nbos) => nbos[ 0 ],\n    },\n    grid,\n    start,\n    opts\n  );\n\nconst randomNeighbour = (nbos: ReadonlyArray<Neighbour>) => randomElement(nbos); // .filter(isNeighbour));\n\nexport const visitorRandomContiguous = (\n  grid: Grid,\n  start: Cell,\n  opts: VisitorOpts = {}\n) =>\n  visitor(\n    {\n      select: randomNeighbour,\n    },\n    grid,\n    start,\n    opts\n  );\n\n/**\n * Visit by following rows. Normal order is left-to-right, top-to-bottom.\n * @param grid\n * @param start\n * @param opts\n * @returns\n */\nexport const visitorRandom = (\n  grid: Grid,\n  start: Cell,\n  opts: VisitorOpts = {}\n) =>\n  visitor(\n    {\n      options: (grid, cell) => {\n        const t: Array<Neighbour> = [];\n        for (const c of cells(grid, cell)) {\n          // eslint-disable-next-line functional/immutable-data\n          t.push([ `n`, c ]);\n        }\n        return t;\n      },\n      select: randomNeighbour,\n    },\n    grid,\n    start,\n    opts\n  );\n\nexport const visitorRow = (\n  grid: Grid,\n  start?: Cell,\n  opts: VisitorOpts = {}\n) => {\n  if (!start) start = { x: 0, y: 0 }\n\n  const { reversed = false } = opts;\n\n  const neighbourSelect = (nbos: ReadonlyArray<Neighbour>) =>\n    nbos.find((n) => n[ 0 ] === (reversed ? `w` : `e`));\n\n  const possibleNeighbours = (\n    grid: Grid,\n    cell: Cell\n  ): ReadonlyArray<Neighbour> => {\n    if (reversed) {\n      // WALKING BACKWARD ALONG ROW\n      if (cell.x > 0) {\n        // All fine, step to the left\n        cell = { x: cell.x - 1, y: cell.y };\n      } else {\n        // At the beginning of a row\n        // eslint-disable-next-line unicorn/prefer-ternary\n        if (cell.y > 0) {\n          // Wrap to next row up\n          cell = { x: grid.cols - 1, y: cell.y - 1 };\n        } else {\n          // Wrap to end of grid\n          cell = { x: grid.cols - 1, y: grid.rows - 1 };\n        }\n      }\n    } else {\n      /*\n       * WALKING FORWARD ALONG ROWS\n       */\n      if (cell.x < grid.rows - 1) {\n        // All fine, step to the right\n        cell = { x: cell.x + 1, y: cell.y };\n      } else {\n        // At the end of a row\n        // eslint-disable-next-line unicorn/prefer-ternary\n        if (cell.y < grid.rows - 1) {\n          // More rows available, wrap to next row down\n          cell = { x: 0, y: cell.y + 1 };\n        } else {\n          // No more rows available, wrap to start of the grid\n          cell = { x: 0, y: 0 };\n        }\n      }\n    }\n    return [ [ reversed ? `w` : `e`, cell ] ];\n  };\n\n  const logic: VisitorLogic = {\n    select: neighbourSelect,\n    options: possibleNeighbours,\n  };\n\n  return visitor(logic, grid, start, opts);\n};\n\n/**\n * Runs the provided `visitor` for `steps`, returning the cell we end at\n *\n * ```js\n * // Get a cell 10 steps away (row-wise) from start\n * const cell = visitFor(grid, start, 10, visitorRow);\n * ```\n * @param grid Grid to traverse\n * @param start Start point\n * @param steps Number of steps\n * @param visitor Visitor function\n * @returns\n */\nexport const visitFor = (\n  grid: Grid,\n  start: Cell,\n  steps: number,\n  visitor: Visitor\n): Cell => {\n  throwIntegerTest(steps, ``, `steps`);\n\n  const opts: VisitorOpts = {\n    reversed: steps < 0,\n  };\n  steps = Math.abs(steps);\n\n  // eslint-disable-next-line functional/no-let\n  let c = start;\n  // eslint-disable-next-line functional/no-let\n  let v = visitor(grid, start, opts);\n  v.next(); // Burn up starting cell\n\n  // eslint-disable-next-line functional/no-let\n  let stepsMade = 0;\n\n  while (stepsMade < steps) {\n    stepsMade++;\n    const { value } = v.next();\n    if (value) {\n      c = value;\n      if (opts.debug) {\n        console.log(\n          `stepsMade: ${ stepsMade } cell: ${ c.x }, ${ c.y } reverse: ${ opts.reversed }`\n        );\n      }\n    } else {\n      if (steps >= grid.cols * grid.rows) {\n        steps -= grid.cols * grid.rows;\n        stepsMade = 0;\n        v = visitor(grid, start, opts);\n        v.next();\n        c = start;\n        if (opts.debug) console.log(`resetting visitor to ${ steps }`);\n      } else throw new Error(`Value not received by visitor`);\n    }\n  }\n  return c;\n};\n\n/**\n * Visits cells running down columns, left-to-right.\n * @param grid Grid to traverse\n * @param start Start cell\n * @param opts Options\n * @returns Visitor generator\n */\nexport const visitorColumn = (\n  grid: Grid,\n  start: Cell,\n  opts: VisitorOpts = {}\n): VisitGenerator => {\n  const { reversed = false } = opts;\n  const logic: VisitorLogic = {\n    select: (nbos) => nbos.find((n) => n[ 0 ] === (reversed ? `n` : `s`)),\n    options: (grid, cell): ReadonlyArray<Neighbour> => {\n      if (reversed) {\n        // WALK UP COLUMN, RIGHT-TO-LEFT\n        if (cell.y > 0) {\n          // Easy case\n          cell = { x: cell.x, y: cell.y - 1 };\n        } else {\n          // Top of column\n          // eslint-disable-next-line unicorn/prefer-ternary\n          if (cell.x === 0) {\n            // Top-left corner, need to wrap\n            cell = { x: grid.cols - 1, y: grid.rows - 1 };\n          } else {\n            cell = { x: cell.x - 1, y: grid.rows - 1 };\n          }\n        }\n      } else {\n        // WALK DOWN COLUMNS, LEFT-TO-RIGHT\n        if (cell.y < grid.rows - 1) {\n          // Easy case, move down by one\n          cell = { x: cell.x, y: cell.y + 1 };\n        } else {\n          // End of column\n          // eslint-disable-next-line unicorn/prefer-ternary\n          if (cell.x < grid.cols - 1) {\n            // Move to next column and start at top\n            cell = { x: cell.x + 1, y: 0 };\n          } else {\n            // Move to start of grid\n            cell = { x: 0, y: 0 };\n          }\n        }\n      }\n      return [ [ reversed ? `n` : `s`, cell ] ];\n    },\n  };\n  return visitor(logic, grid, start, opts);\n};\n\n/**\n * Enumerate rows of grid, returning all the cells in the row\n * as an array\n *\n * ```js\n * for (const row of Grid.rows(shape)) {\n *  // row is an array of Cells.\n *  // [ {x:0, y:0}, {x:1, y:0} ... ]\n * }\n * ```\n * @param grid\n * @param start\n */\nexport const rows = function* (grid: Grid, start?: Cell) {\n  if (!start) start = { x: 0, y: 0 }\n  //eslint-disable-next-line functional/no-let\n  let row = start.y;\n  //eslint-disable-next-line functional/no-let\n  let rowCells: Array<Cell> = [];\n\n  for (const c of cells(grid, start)) {\n    if (c.y === row) {\n      //eslint-disable-next-line functional/immutable-data\n      rowCells.push(c);\n    } else {\n      yield rowCells;\n      rowCells = [ c ];\n      row = c.y;\n    }\n  }\n  if (rowCells.length > 0) yield rowCells;\n};\n\n/**\n * Enumerate all cells in an efficient manner. Runs left-to-right, top-to-bottom.\n * If end of grid is reached, iterator will wrap to ensure all are visited.\n *\n * @param grid\n * @param start\n */\nexport const cells = function* (grid: Grid, start?: Cell) {\n  if (!start) start = { x: 0, y: 0 }\n\n  guardGrid(grid, `grid`);\n  guardCell(start, `start`, grid);\n\n  // eslint-disable-next-line functional/no-let\n  let { x, y } = start;\n  // eslint-disable-next-line functional/no-let\n  let canMove = true;\n  do {\n    yield { x, y };\n    x++;\n    if (x === grid.cols) {\n      y++;\n      x = 0;\n    }\n    if (y === grid.rows) {\n      y = 0;\n      x = 0;\n    }\n    if (x === start.x && y === start.y) canMove = false; // Complete\n  } while (canMove);\n};\n\nexport const access1dArray = <V>(\n  array: ReadonlyArray<V>,\n  cols: number\n): CellAccessor<V> => {\n  const grid = { cols, rows: Math.ceil(array.length / cols) };\n  const fn: CellAccessor<V> = (\n    cell: Cell,\n    wrap: BoundsLogic\n  ): V | undefined => {\n    const index = indexFromCell(grid, cell, wrap);\n    if (index === undefined) return undefined;\n    return array[ index ];\n  };\n  return fn;\n};\n\n/**\n * Returns a function that updates a 2D array representation\n * of a grid. Array is mutated.\n *\n * ```js\n * const m = Grids.array2dUpdater(grid, array);\n * m(someValue, { x:2, y:3 });\n * ```\n * @param grid\n * @param array\n * @returns\n */\n//eslint-disable-next-line functional/prefer-readonly-type\nexport const array2dUpdater = <V>(grid: GridVisual, array: Array<Array<V>>) => {\n  const fn = (v: V, position: Point) => {\n    const pos = cellAtPoint(grid, position);\n    if (pos === undefined) {\n      throw new Error(\n        `Position does not exist. Pos: ${ JSON.stringify(\n          position\n        ) } Grid: ${ JSON.stringify(grid) }`\n      );\n    }\n    //eslint-disable-next-line functional/immutable-data\n    array[ pos.y ][ pos.x ] = v;\n  };\n  return fn;\n};\n\n/**\n * Visits a grid packed into an array.\n *\n * @example By default visits left-to-right, top-to-bottom:\n * ```js\n * const data = [1, 2, 3, 4, 5, 6];\n * const cols = 2;\n * for (const [value,index] of visitArray(data, cols)) {\n *  // Yields: 1, 2, 3, 4, 5, 6\n * }\n * ```\n *\n * @example\n * ```js\n * ```\n * @param array Array\n * @param cols Columns\n * @param iteratorFunction Visitor function\n * @param opts Options\n */\nexport function* visitArray<V>(\n  array: ReadonlyArray<V>,\n  cols: number,\n  iteratorFunction?: Visitor,\n  opts?: VisitorOpts\n): IterableIterator<readonly [ data: V, index: number ]> {\n  if (typeof array === `undefined`) {\n    throw new TypeError(`First parameter is undefined, expected an array`);\n  }\n  if (array === null) throw new Error(`First parameter is null, expected an array`);\n  if (!Array.isArray(array)) throw new Error(`First parameter should be an array`);\n\n  throwIntegerTest(cols, `aboveZero`, `cols`);\n  if (array.length === 0) return;\n\n  const wrap = opts?.boundsWrap ?? `stop`;\n  const rows = Math.ceil(array.length / cols);\n  const grid: Grid = {\n    cols,\n    rows,\n  };\n\n  if (iteratorFunction === undefined) iteratorFunction = cells;\n  const iter = iteratorFunction(grid, { x: 0, y: 0 }, opts);\n  for (const cell of iter) {\n    const index = indexFromCell(grid, cell, wrap);\n    if (index === undefined) return undefined;\n    yield [ array[ index ], index ];\n  }\n}\n\n/**\n * Returns the index for a given cell.\n * This is useful if a grid is stored in an array.\n *\n * ```js\n * const data = [\n *  1, 2,\n *  3, 4,\n *  5, 6 ];\n * const cols = 2; // Grid of 2 columns wide\n * const index = indexFromCell(cols, {x: 1, y: 1});\n * // Yields an index of 3\n * console.log(data[index]); // Yields 4\n * ```\n *\n * Bounds logic is applied to cell.x/y separately. Wrapping\n * only ever happens in same col/row.\n * @see cellFromIndex\n * @param grid Grid\n * @param cell Cell to get index for\n * @param wrap Logic for if we hit bounds of grid\n * @returns\n */\nexport const indexFromCell = (\n  grid: Grid,\n  cell: Cell,\n  wrap: BoundsLogic\n): number | undefined => {\n  guardGrid(grid, `grid`);\n\n  //eslint-disable-next-line functional/no-let\n\n  if (cell.x < 0) {\n    switch (wrap) {\n      case `stop`: {\n        cell = { ...cell, x: 0 };\n        break;\n      }\n      case `unbounded`: {\n        throw new Error(`unbounded not supported`);\n      }\n      case `undefined`: {\n        return undefined;\n      }\n      case `wrap`: {\n        //cell = { ...cell, x: grid.cols + cell.x };\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        cell = offset(grid, { x: 0, y: cell.y }, { x: cell.x, y: 0 }, `wrap`)!;\n        break;\n      }\n    }\n  }\n  if (cell.y < 0) {\n    switch (wrap) {\n      case `stop`: {\n        cell = { ...cell, y: 0 };\n        break;\n      }\n      case `unbounded`: {\n        throw new Error(`unbounded not supported`);\n      }\n      case `undefined`: {\n        return undefined;\n      }\n      case `wrap`: {\n        cell = { ...cell, y: grid.rows + cell.y };\n        break;\n      }\n    }\n  }\n  if (cell.x >= grid.cols) {\n    switch (wrap) {\n      case `stop`: {\n        cell = { ...cell, x: grid.cols - 1 };\n        break;\n      }\n      case `unbounded`: {\n        throw new Error(`unbounded not supported`);\n      }\n      case `undefined`: {\n        return undefined;\n      }\n      case `wrap`: {\n        cell = { ...cell, x: cell.x % grid.cols };\n        break;\n      }\n    }\n  }\n  if (cell.y >= grid.rows) {\n    switch (wrap) {\n      case `stop`: {\n        cell = { ...cell, y: grid.rows - 1 };\n        break;\n      }\n      case `unbounded`: {\n        throw new Error(`unbounded not supported`);\n      }\n      case `undefined`: {\n        return undefined;\n      }\n      case `wrap`: {\n        cell = { ...cell, y: cell.y % grid.rows };\n        break;\n      }\n    }\n  }\n\n  const index = cell.y * grid.cols + cell.x;\n\n  return index;\n};\n\n/**\n * Returns x,y from an array index.\n *\n * ```js\n *  const data = [\n *   1, 2,\n *   3, 4,\n *   5, 6 ];\n *\n * // Cols of 2, index 2 (ie. data[2] == 3)\n * const cell = cellFromIndex(2, 2);\n * // Yields: {x: 0, y: 1}\n * ```\n * @see indexFromCell\n * @param colsOrGrid\n * @param index\n * @returns\n */\nexport const cellFromIndex = (\n  colsOrGrid: number | Grid,\n  index: number\n): Cell => {\n  //eslint-disable-next-line functional/no-let\n  let cols = 0;\n  cols = typeof colsOrGrid === `number` ? colsOrGrid : colsOrGrid.cols;\n  throwIntegerTest(cols, `aboveZero`, `colsOrGrid`);\n\n  return {\n    x: index % cols,\n    y: Math.floor(index / cols),\n  };\n};\n","import { Bezier as BezierLibrary } from 'bezier-js';\nimport { interpolate as LinesInterpolate } from '../line/Interpolate.js';\nimport { fromTopLeft as RectsFromTopLeft } from '../rect/FromTopLeft.js';\nimport type { Point } from '../point/PointType.js';\nimport type { CubicBezier, CubicBezierPath, QuadraticBezier, QuadraticBezierPath } from './BezierType.js';\nimport { isCubicBezier, isQuadraticBezier } from './Guard.js';\nexport * from './BezierType.js';\nexport * from './Guard.js';\n/**\n * Returns a new quadratic bezier with specified bend amount\n *\n * @param {QuadraticBezier} b Curve\n * @param {number} [bend=0] Bend amount, from -1 to 1\n * @returns {QuadraticBezier}\n */\nexport const quadraticBend = (a: Point, b: Point, bend = 0): QuadraticBezier => quadraticSimple(a, b, bend);\n\n/**\n * Creates a simple quadratic bezier with a specified amount of 'bend'.\n * Bend of -1 will pull curve down, 1 will pull curve up. 0 is no curve\n * @param {Point} start Start of curve\n * @param {Point} end End of curve\n * @param {number} [bend=0] Bend amount, -1 to 1\n * @returns {QuadraticBezier}\n */\nexport const quadraticSimple = (start: Point, end: Point, bend = 0): QuadraticBezier => {\n  if (Number.isNaN(bend)) throw new Error(`bend is NaN`);\n  if (bend < -1 || bend > 1) throw new Error(`Expects bend range of -1 to 1`);\n\n  const middle = LinesInterpolate(0.5, start, end);\n  // eslint-disable-next-line functional/no-let\n  let target = middle;\n  if (end.y < start.y) {\n    // Upward slope\n    target = bend > 0 ? { x: Math.min(start.x, end.x), y: Math.min(start.y, end.y) } :\n      { x: Math.max(start.x, end.x), y: Math.max(start.y, end.y) };\n  } else {\n    // Downward slope\n    target = bend > 0 ? { x: Math.max(start.x, end.x), y: Math.min(start.y, end.y) } :\n      { x: Math.min(start.x, end.x), y: Math.max(start.y, end.y) };\n  }\n\n  const handle = LinesInterpolate(Math.abs(bend), middle, target,);\n  return quadratic(start, end, handle);\n};\n\n/**\n * Returns a relative point on a simple quadratic \n * @param start Start\n * @param end  End\n * @param bend Bend (-1 to 1)\n * @param amt Amount\n * @returns Point\n */\nexport const computeQuadraticSimple = (start: Point, end: Point, bend: number, amt: number): Point => {\n  const q = quadraticSimple(start, end, bend);\n  const bzr = new BezierLibrary(q.a, q.quadratic, q.b);\n  return bzr.compute(amt);\n};\n\n//https://developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Paths\nexport const quadraticToSvgString = (start: Point, end: Point, handle: Point): ReadonlyArray<string> => [ `M ${ start.x } ${ start.y } Q ${ handle.x } ${ handle.y } ${ end.x } ${ end.y }` ];\n\nexport const toPath = (cubicOrQuadratic: CubicBezier | QuadraticBezier): CubicBezierPath | QuadraticBezierPath => {\n  if (isCubicBezier(cubicOrQuadratic)) {\n    return cubicToPath(cubicOrQuadratic);\n  } else if (isQuadraticBezier(cubicOrQuadratic)) {\n    return quadratictoPath(cubicOrQuadratic);\n  } else {\n    throw new Error(`Unknown bezier type`);\n  }\n};\n\nexport const cubic = (start: Point, end: Point, cubic1: Point, cubic2: Point): CubicBezier => (\n  {\n    a: Object.freeze(start),\n    b: Object.freeze(end),\n    cubic1: Object.freeze(cubic1),\n    cubic2: Object.freeze(cubic2)\n  });\n\nconst cubicToPath = (cubic: CubicBezier): CubicBezierPath => {\n  const { a, cubic1, cubic2, b } = cubic;\n\n  const bzr = new BezierLibrary(a, cubic1, cubic2, b);\n  return Object.freeze({\n    ...cubic,\n    length: () => bzr.length(),\n    interpolate: (t: number) => bzr.compute(t),\n    nearest: (_: Point) => { throw new Error(`not implemented`); },\n    bbox: () => {\n      const { x, y } = bzr.bbox();\n      const xSize = x.size;\n      const ySize = y.size;\n      if (xSize === undefined) throw new Error(`x.size not present on calculated bbox`);\n      if (ySize === undefined) throw new Error(`x.size not present on calculated bbox`);\n\n      return RectsFromTopLeft({ x: x.min, y: y.min }, xSize, ySize);\n    },\n    relativePosition: (_point: Point, _intersectionThreshold: number) => {\n      throw new Error(`Not implemented`);\n    },\n    distanceToPoint: (_point: Point): number => {\n      throw new Error(`Not implemented`);\n    },\n    toSvgString: () => [ `brrup` ],\n    kind: `bezier/cubic`\n  });\n};\n\nexport const quadratic = (start: Point, end: Point, handle: Point): QuadraticBezier => ({\n  a: Object.freeze(start),\n  b: Object.freeze(end),\n  quadratic: Object.freeze(handle)\n});\n\n\nconst quadratictoPath = (quadraticBezier: QuadraticBezier): QuadraticBezierPath => {\n  const { a, b, quadratic } = quadraticBezier;\n  const bzr = new BezierLibrary(a, quadratic, b);\n  return Object.freeze({\n    ...quadraticBezier,\n    length: () => bzr.length(),\n    interpolate: (t: number) => bzr.compute(t),\n    nearest: (_: Point) => { throw new Error(`not implemented`); },\n    bbox: () => {\n      const { x, y } = bzr.bbox();\n      const xSize = x.size;\n      const ySize = y.size;\n      if (xSize === undefined) throw new Error(`x.size not present on calculated bbox`);\n      if (ySize === undefined) throw new Error(`x.size not present on calculated bbox`);\n      return RectsFromTopLeft({ x: x.min, y: y.min }, xSize, ySize);\n    },\n    distanceToPoint: (_point: Point): number => {\n      throw new Error(`Not implemented`);\n\n    },\n    relativePosition: (_point: Point, _intersectionThreshold: number): number => {\n      throw new Error(`Not implemented`);\n\n    },\n    toString: () => bzr.toString(),\n    toSvgString: () => quadraticToSvgString(a, b, quadratic),\n    kind: `bezier/quadratic`\n  });\n};\n\n","import { Bezier } from \"./bezier.js\";\n\n// math-inlining.\nconst { abs, cos, sin, acos, atan2, sqrt, pow } = Math;\n\n// cube root function yielding real roots\nfunction crt(v) {\n  return v < 0 ? -pow(-v, 1 / 3) : pow(v, 1 / 3);\n}\n\n// trig constants\nconst pi = Math.PI,\n  tau = 2 * pi,\n  quart = pi / 2,\n  // float precision significant decimal\n  epsilon = 0.000001,\n  // extremas used in bbox calculation and similar algorithms\n  nMax = Number.MAX_SAFE_INTEGER || 9007199254740991,\n  nMin = Number.MIN_SAFE_INTEGER || -9007199254740991,\n  // a zero coordinate, which is surprisingly useful\n  ZERO = { x: 0, y: 0, z: 0 };\n\n// Bezier utility functions\nconst utils = {\n  // Legendre-Gauss abscissae with n=24 (x_i values, defined at i=n as the roots of the nth order Legendre polynomial Pn(x))\n  Tvalues: [\n    -0.0640568928626056260850430826247450385909,\n    0.0640568928626056260850430826247450385909,\n    -0.1911188674736163091586398207570696318404,\n    0.1911188674736163091586398207570696318404,\n    -0.3150426796961633743867932913198102407864,\n    0.3150426796961633743867932913198102407864,\n    -0.4337935076260451384870842319133497124524,\n    0.4337935076260451384870842319133497124524,\n    -0.5454214713888395356583756172183723700107,\n    0.5454214713888395356583756172183723700107,\n    -0.6480936519369755692524957869107476266696,\n    0.6480936519369755692524957869107476266696,\n    -0.7401241915785543642438281030999784255232,\n    0.7401241915785543642438281030999784255232,\n    -0.8200019859739029219539498726697452080761,\n    0.8200019859739029219539498726697452080761,\n    -0.8864155270044010342131543419821967550873,\n    0.8864155270044010342131543419821967550873,\n    -0.9382745520027327585236490017087214496548,\n    0.9382745520027327585236490017087214496548,\n    -0.9747285559713094981983919930081690617411,\n    0.9747285559713094981983919930081690617411,\n    -0.9951872199970213601799974097007368118745,\n    0.9951872199970213601799974097007368118745,\n  ],\n\n  // Legendre-Gauss weights with n=24 (w_i values, defined by a function linked to in the Bezier primer article)\n  Cvalues: [\n    0.1279381953467521569740561652246953718517,\n    0.1279381953467521569740561652246953718517,\n    0.1258374563468282961213753825111836887264,\n    0.1258374563468282961213753825111836887264,\n    0.121670472927803391204463153476262425607,\n    0.121670472927803391204463153476262425607,\n    0.1155056680537256013533444839067835598622,\n    0.1155056680537256013533444839067835598622,\n    0.1074442701159656347825773424466062227946,\n    0.1074442701159656347825773424466062227946,\n    0.0976186521041138882698806644642471544279,\n    0.0976186521041138882698806644642471544279,\n    0.086190161531953275917185202983742667185,\n    0.086190161531953275917185202983742667185,\n    0.0733464814110803057340336152531165181193,\n    0.0733464814110803057340336152531165181193,\n    0.0592985849154367807463677585001085845412,\n    0.0592985849154367807463677585001085845412,\n    0.0442774388174198061686027482113382288593,\n    0.0442774388174198061686027482113382288593,\n    0.0285313886289336631813078159518782864491,\n    0.0285313886289336631813078159518782864491,\n    0.0123412297999871995468056670700372915759,\n    0.0123412297999871995468056670700372915759,\n  ],\n\n  arcfn: function (t, derivativeFn) {\n    const d = derivativeFn(t);\n    let l = d.x * d.x + d.y * d.y;\n    if (typeof d.z !== \"undefined\") {\n      l += d.z * d.z;\n    }\n    return sqrt(l);\n  },\n\n  compute: function (t, points, _3d) {\n    // shortcuts\n    if (t === 0) {\n      points[0].t = 0;\n      return points[0];\n    }\n\n    const order = points.length - 1;\n\n    if (t === 1) {\n      points[order].t = 1;\n      return points[order];\n    }\n\n    const mt = 1 - t;\n    let p = points;\n\n    // constant?\n    if (order === 0) {\n      points[0].t = t;\n      return points[0];\n    }\n\n    // linear?\n    if (order === 1) {\n      const ret = {\n        x: mt * p[0].x + t * p[1].x,\n        y: mt * p[0].y + t * p[1].y,\n        t: t,\n      };\n      if (_3d) {\n        ret.z = mt * p[0].z + t * p[1].z;\n      }\n      return ret;\n    }\n\n    // quadratic/cubic curve?\n    if (order < 4) {\n      let mt2 = mt * mt,\n        t2 = t * t,\n        a,\n        b,\n        c,\n        d = 0;\n      if (order === 2) {\n        p = [p[0], p[1], p[2], ZERO];\n        a = mt2;\n        b = mt * t * 2;\n        c = t2;\n      } else if (order === 3) {\n        a = mt2 * mt;\n        b = mt2 * t * 3;\n        c = mt * t2 * 3;\n        d = t * t2;\n      }\n      const ret = {\n        x: a * p[0].x + b * p[1].x + c * p[2].x + d * p[3].x,\n        y: a * p[0].y + b * p[1].y + c * p[2].y + d * p[3].y,\n        t: t,\n      };\n      if (_3d) {\n        ret.z = a * p[0].z + b * p[1].z + c * p[2].z + d * p[3].z;\n      }\n      return ret;\n    }\n\n    // higher order curves: use de Casteljau's computation\n    const dCpts = JSON.parse(JSON.stringify(points));\n    while (dCpts.length > 1) {\n      for (let i = 0; i < dCpts.length - 1; i++) {\n        dCpts[i] = {\n          x: dCpts[i].x + (dCpts[i + 1].x - dCpts[i].x) * t,\n          y: dCpts[i].y + (dCpts[i + 1].y - dCpts[i].y) * t,\n        };\n        if (typeof dCpts[i].z !== \"undefined\") {\n          dCpts[i].z = dCpts[i].z + (dCpts[i + 1].z - dCpts[i].z) * t;\n        }\n      }\n      dCpts.splice(dCpts.length - 1, 1);\n    }\n    dCpts[0].t = t;\n    return dCpts[0];\n  },\n\n  computeWithRatios: function (t, points, ratios, _3d) {\n    const mt = 1 - t,\n      r = ratios,\n      p = points;\n\n    let f1 = r[0],\n      f2 = r[1],\n      f3 = r[2],\n      f4 = r[3],\n      d;\n\n    // spec for linear\n    f1 *= mt;\n    f2 *= t;\n\n    if (p.length === 2) {\n      d = f1 + f2;\n      return {\n        x: (f1 * p[0].x + f2 * p[1].x) / d,\n        y: (f1 * p[0].y + f2 * p[1].y) / d,\n        z: !_3d ? false : (f1 * p[0].z + f2 * p[1].z) / d,\n        t: t,\n      };\n    }\n\n    // upgrade to quadratic\n    f1 *= mt;\n    f2 *= 2 * mt;\n    f3 *= t * t;\n\n    if (p.length === 3) {\n      d = f1 + f2 + f3;\n      return {\n        x: (f1 * p[0].x + f2 * p[1].x + f3 * p[2].x) / d,\n        y: (f1 * p[0].y + f2 * p[1].y + f3 * p[2].y) / d,\n        z: !_3d ? false : (f1 * p[0].z + f2 * p[1].z + f3 * p[2].z) / d,\n        t: t,\n      };\n    }\n\n    // upgrade to cubic\n    f1 *= mt;\n    f2 *= 1.5 * mt;\n    f3 *= 3 * mt;\n    f4 *= t * t * t;\n\n    if (p.length === 4) {\n      d = f1 + f2 + f3 + f4;\n      return {\n        x: (f1 * p[0].x + f2 * p[1].x + f3 * p[2].x + f4 * p[3].x) / d,\n        y: (f1 * p[0].y + f2 * p[1].y + f3 * p[2].y + f4 * p[3].y) / d,\n        z: !_3d\n          ? false\n          : (f1 * p[0].z + f2 * p[1].z + f3 * p[2].z + f4 * p[3].z) / d,\n        t: t,\n      };\n    }\n  },\n\n  derive: function (points, _3d) {\n    const dpoints = [];\n    for (let p = points, d = p.length, c = d - 1; d > 1; d--, c--) {\n      const list = [];\n      for (let j = 0, dpt; j < c; j++) {\n        dpt = {\n          x: c * (p[j + 1].x - p[j].x),\n          y: c * (p[j + 1].y - p[j].y),\n        };\n        if (_3d) {\n          dpt.z = c * (p[j + 1].z - p[j].z);\n        }\n        list.push(dpt);\n      }\n      dpoints.push(list);\n      p = list;\n    }\n    return dpoints;\n  },\n\n  between: function (v, m, M) {\n    return (\n      (m <= v && v <= M) ||\n      utils.approximately(v, m) ||\n      utils.approximately(v, M)\n    );\n  },\n\n  approximately: function (a, b, precision) {\n    return abs(a - b) <= (precision || epsilon);\n  },\n\n  length: function (derivativeFn) {\n    const z = 0.5,\n      len = utils.Tvalues.length;\n\n    let sum = 0;\n\n    for (let i = 0, t; i < len; i++) {\n      t = z * utils.Tvalues[i] + z;\n      sum += utils.Cvalues[i] * utils.arcfn(t, derivativeFn);\n    }\n    return z * sum;\n  },\n\n  map: function (v, ds, de, ts, te) {\n    const d1 = de - ds,\n      d2 = te - ts,\n      v2 = v - ds,\n      r = v2 / d1;\n    return ts + d2 * r;\n  },\n\n  lerp: function (r, v1, v2) {\n    const ret = {\n      x: v1.x + r * (v2.x - v1.x),\n      y: v1.y + r * (v2.y - v1.y),\n    };\n    if (v1.z !== undefined && v2.z !== undefined) {\n      ret.z = v1.z + r * (v2.z - v1.z);\n    }\n    return ret;\n  },\n\n  pointToString: function (p) {\n    let s = p.x + \"/\" + p.y;\n    if (typeof p.z !== \"undefined\") {\n      s += \"/\" + p.z;\n    }\n    return s;\n  },\n\n  pointsToString: function (points) {\n    return \"[\" + points.map(utils.pointToString).join(\", \") + \"]\";\n  },\n\n  copy: function (obj) {\n    return JSON.parse(JSON.stringify(obj));\n  },\n\n  angle: function (o, v1, v2) {\n    const dx1 = v1.x - o.x,\n      dy1 = v1.y - o.y,\n      dx2 = v2.x - o.x,\n      dy2 = v2.y - o.y,\n      cross = dx1 * dy2 - dy1 * dx2,\n      dot = dx1 * dx2 + dy1 * dy2;\n    return atan2(cross, dot);\n  },\n\n  // round as string, to avoid rounding errors\n  round: function (v, d) {\n    const s = \"\" + v;\n    const pos = s.indexOf(\".\");\n    return parseFloat(s.substring(0, pos + 1 + d));\n  },\n\n  dist: function (p1, p2) {\n    const dx = p1.x - p2.x,\n      dy = p1.y - p2.y;\n    return sqrt(dx * dx + dy * dy);\n  },\n\n  closest: function (LUT, point) {\n    let mdist = pow(2, 63),\n      mpos,\n      d;\n    LUT.forEach(function (p, idx) {\n      d = utils.dist(point, p);\n      if (d < mdist) {\n        mdist = d;\n        mpos = idx;\n      }\n    });\n    return { mdist: mdist, mpos: mpos };\n  },\n\n  abcratio: function (t, n) {\n    // see ratio(t) note on http://pomax.github.io/bezierinfo/#abc\n    if (n !== 2 && n !== 3) {\n      return false;\n    }\n    if (typeof t === \"undefined\") {\n      t = 0.5;\n    } else if (t === 0 || t === 1) {\n      return t;\n    }\n    const bottom = pow(t, n) + pow(1 - t, n),\n      top = bottom - 1;\n    return abs(top / bottom);\n  },\n\n  projectionratio: function (t, n) {\n    // see u(t) note on http://pomax.github.io/bezierinfo/#abc\n    if (n !== 2 && n !== 3) {\n      return false;\n    }\n    if (typeof t === \"undefined\") {\n      t = 0.5;\n    } else if (t === 0 || t === 1) {\n      return t;\n    }\n    const top = pow(1 - t, n),\n      bottom = pow(t, n) + top;\n    return top / bottom;\n  },\n\n  lli8: function (x1, y1, x2, y2, x3, y3, x4, y4) {\n    const nx =\n        (x1 * y2 - y1 * x2) * (x3 - x4) - (x1 - x2) * (x3 * y4 - y3 * x4),\n      ny = (x1 * y2 - y1 * x2) * (y3 - y4) - (y1 - y2) * (x3 * y4 - y3 * x4),\n      d = (x1 - x2) * (y3 - y4) - (y1 - y2) * (x3 - x4);\n    if (d == 0) {\n      return false;\n    }\n    return { x: nx / d, y: ny / d };\n  },\n\n  lli4: function (p1, p2, p3, p4) {\n    const x1 = p1.x,\n      y1 = p1.y,\n      x2 = p2.x,\n      y2 = p2.y,\n      x3 = p3.x,\n      y3 = p3.y,\n      x4 = p4.x,\n      y4 = p4.y;\n    return utils.lli8(x1, y1, x2, y2, x3, y3, x4, y4);\n  },\n\n  lli: function (v1, v2) {\n    return utils.lli4(v1, v1.c, v2, v2.c);\n  },\n\n  makeline: function (p1, p2) {\n    return new Bezier(\n      p1.x,\n      p1.y,\n      (p1.x + p2.x) / 2,\n      (p1.y + p2.y) / 2,\n      p2.x,\n      p2.y\n    );\n  },\n\n  findbbox: function (sections) {\n    let mx = nMax,\n      my = nMax,\n      MX = nMin,\n      MY = nMin;\n    sections.forEach(function (s) {\n      const bbox = s.bbox();\n      if (mx > bbox.x.min) mx = bbox.x.min;\n      if (my > bbox.y.min) my = bbox.y.min;\n      if (MX < bbox.x.max) MX = bbox.x.max;\n      if (MY < bbox.y.max) MY = bbox.y.max;\n    });\n    return {\n      x: { min: mx, mid: (mx + MX) / 2, max: MX, size: MX - mx },\n      y: { min: my, mid: (my + MY) / 2, max: MY, size: MY - my },\n    };\n  },\n\n  shapeintersections: function (\n    s1,\n    bbox1,\n    s2,\n    bbox2,\n    curveIntersectionThreshold\n  ) {\n    if (!utils.bboxoverlap(bbox1, bbox2)) return [];\n    const intersections = [];\n    const a1 = [s1.startcap, s1.forward, s1.back, s1.endcap];\n    const a2 = [s2.startcap, s2.forward, s2.back, s2.endcap];\n    a1.forEach(function (l1) {\n      if (l1.virtual) return;\n      a2.forEach(function (l2) {\n        if (l2.virtual) return;\n        const iss = l1.intersects(l2, curveIntersectionThreshold);\n        if (iss.length > 0) {\n          iss.c1 = l1;\n          iss.c2 = l2;\n          iss.s1 = s1;\n          iss.s2 = s2;\n          intersections.push(iss);\n        }\n      });\n    });\n    return intersections;\n  },\n\n  makeshape: function (forward, back, curveIntersectionThreshold) {\n    const bpl = back.points.length;\n    const fpl = forward.points.length;\n    const start = utils.makeline(back.points[bpl - 1], forward.points[0]);\n    const end = utils.makeline(forward.points[fpl - 1], back.points[0]);\n    const shape = {\n      startcap: start,\n      forward: forward,\n      back: back,\n      endcap: end,\n      bbox: utils.findbbox([start, forward, back, end]),\n    };\n    shape.intersections = function (s2) {\n      return utils.shapeintersections(\n        shape,\n        shape.bbox,\n        s2,\n        s2.bbox,\n        curveIntersectionThreshold\n      );\n    };\n    return shape;\n  },\n\n  getminmax: function (curve, d, list) {\n    if (!list) return { min: 0, max: 0 };\n    let min = nMax,\n      max = nMin,\n      t,\n      c;\n    if (list.indexOf(0) === -1) {\n      list = [0].concat(list);\n    }\n    if (list.indexOf(1) === -1) {\n      list.push(1);\n    }\n    for (let i = 0, len = list.length; i < len; i++) {\n      t = list[i];\n      c = curve.get(t);\n      if (c[d] < min) {\n        min = c[d];\n      }\n      if (c[d] > max) {\n        max = c[d];\n      }\n    }\n    return { min: min, mid: (min + max) / 2, max: max, size: max - min };\n  },\n\n  align: function (points, line) {\n    const tx = line.p1.x,\n      ty = line.p1.y,\n      a = -atan2(line.p2.y - ty, line.p2.x - tx),\n      d = function (v) {\n        return {\n          x: (v.x - tx) * cos(a) - (v.y - ty) * sin(a),\n          y: (v.x - tx) * sin(a) + (v.y - ty) * cos(a),\n        };\n      };\n    return points.map(d);\n  },\n\n  roots: function (points, line) {\n    line = line || { p1: { x: 0, y: 0 }, p2: { x: 1, y: 0 } };\n\n    const order = points.length - 1;\n    const aligned = utils.align(points, line);\n    const reduce = function (t) {\n      return 0 <= t && t <= 1;\n    };\n\n    if (order === 2) {\n      const a = aligned[0].y,\n        b = aligned[1].y,\n        c = aligned[2].y,\n        d = a - 2 * b + c;\n      if (d !== 0) {\n        const m1 = -sqrt(b * b - a * c),\n          m2 = -a + b,\n          v1 = -(m1 + m2) / d,\n          v2 = -(-m1 + m2) / d;\n        return [v1, v2].filter(reduce);\n      } else if (b !== c && d === 0) {\n        return [(2 * b - c) / (2 * b - 2 * c)].filter(reduce);\n      }\n      return [];\n    }\n\n    // see http://www.trans4mind.com/personal_development/mathematics/polynomials/cubicAlgebra.htm\n    const pa = aligned[0].y,\n      pb = aligned[1].y,\n      pc = aligned[2].y,\n      pd = aligned[3].y;\n\n    let d = -pa + 3 * pb - 3 * pc + pd,\n      a = 3 * pa - 6 * pb + 3 * pc,\n      b = -3 * pa + 3 * pb,\n      c = pa;\n\n    if (utils.approximately(d, 0)) {\n      // this is not a cubic curve.\n      if (utils.approximately(a, 0)) {\n        // in fact, this is not a quadratic curve either.\n        if (utils.approximately(b, 0)) {\n          // in fact in fact, there are no solutions.\n          return [];\n        }\n        // linear solution:\n        return [-c / b].filter(reduce);\n      }\n      // quadratic solution:\n      const q = sqrt(b * b - 4 * a * c),\n        a2 = 2 * a;\n      return [(q - b) / a2, (-b - q) / a2].filter(reduce);\n    }\n\n    // at this point, we know we need a cubic solution:\n\n    a /= d;\n    b /= d;\n    c /= d;\n\n    const p = (3 * b - a * a) / 3,\n      p3 = p / 3,\n      q = (2 * a * a * a - 9 * a * b + 27 * c) / 27,\n      q2 = q / 2,\n      discriminant = q2 * q2 + p3 * p3 * p3;\n\n    let u1, v1, x1, x2, x3;\n    if (discriminant < 0) {\n      const mp3 = -p / 3,\n        mp33 = mp3 * mp3 * mp3,\n        r = sqrt(mp33),\n        t = -q / (2 * r),\n        cosphi = t < -1 ? -1 : t > 1 ? 1 : t,\n        phi = acos(cosphi),\n        crtr = crt(r),\n        t1 = 2 * crtr;\n      x1 = t1 * cos(phi / 3) - a / 3;\n      x2 = t1 * cos((phi + tau) / 3) - a / 3;\n      x3 = t1 * cos((phi + 2 * tau) / 3) - a / 3;\n      return [x1, x2, x3].filter(reduce);\n    } else if (discriminant === 0) {\n      u1 = q2 < 0 ? crt(-q2) : -crt(q2);\n      x1 = 2 * u1 - a / 3;\n      x2 = -u1 - a / 3;\n      return [x1, x2].filter(reduce);\n    } else {\n      const sd = sqrt(discriminant);\n      u1 = crt(-q2 + sd);\n      v1 = crt(q2 + sd);\n      return [u1 - v1 - a / 3].filter(reduce);\n    }\n  },\n\n  droots: function (p) {\n    // quadratic roots are easy\n    if (p.length === 3) {\n      const a = p[0],\n        b = p[1],\n        c = p[2],\n        d = a - 2 * b + c;\n      if (d !== 0) {\n        const m1 = -sqrt(b * b - a * c),\n          m2 = -a + b,\n          v1 = -(m1 + m2) / d,\n          v2 = -(-m1 + m2) / d;\n        return [v1, v2];\n      } else if (b !== c && d === 0) {\n        return [(2 * b - c) / (2 * (b - c))];\n      }\n      return [];\n    }\n\n    // linear roots are even easier\n    if (p.length === 2) {\n      const a = p[0],\n        b = p[1];\n      if (a !== b) {\n        return [a / (a - b)];\n      }\n      return [];\n    }\n\n    return [];\n  },\n\n  curvature: function (t, d1, d2, _3d, kOnly) {\n    let num,\n      dnm,\n      adk,\n      dk,\n      k = 0,\n      r = 0;\n\n    //\n    // We're using the following formula for curvature:\n    //\n    //              x'y\" - y'x\"\n    //   k(t) = ------------------\n    //           (x'² + y'²)^(3/2)\n    //\n    // from https://en.wikipedia.org/wiki/Radius_of_curvature#Definition\n    //\n    // With it corresponding 3D counterpart:\n    //\n    //          sqrt( (y'z\" - y\"z')² + (z'x\" - z\"x')² + (x'y\" - x\"y')²)\n    //   k(t) = -------------------------------------------------------\n    //                     (x'² + y'² + z'²)^(3/2)\n    //\n\n    const d = utils.compute(t, d1);\n    const dd = utils.compute(t, d2);\n    const qdsum = d.x * d.x + d.y * d.y;\n\n    if (_3d) {\n      num = sqrt(\n        pow(d.y * dd.z - dd.y * d.z, 2) +\n          pow(d.z * dd.x - dd.z * d.x, 2) +\n          pow(d.x * dd.y - dd.x * d.y, 2)\n      );\n      dnm = pow(qdsum + d.z * d.z, 3 / 2);\n    } else {\n      num = d.x * dd.y - d.y * dd.x;\n      dnm = pow(qdsum, 3 / 2);\n    }\n\n    if (num === 0 || dnm === 0) {\n      return { k: 0, r: 0 };\n    }\n\n    k = num / dnm;\n    r = dnm / num;\n\n    // We're also computing the derivative of kappa, because\n    // there is value in knowing the rate of change for the\n    // curvature along the curve. And we're just going to\n    // ballpark it based on an epsilon.\n    if (!kOnly) {\n      // compute k'(t) based on the interval before, and after it,\n      // to at least try to not introduce forward/backward pass bias.\n      const pk = utils.curvature(t - 0.001, d1, d2, _3d, true).k;\n      const nk = utils.curvature(t + 0.001, d1, d2, _3d, true).k;\n      dk = (nk - k + (k - pk)) / 2;\n      adk = (abs(nk - k) + abs(k - pk)) / 2;\n    }\n\n    return { k: k, r: r, dk: dk, adk: adk };\n  },\n\n  inflections: function (points) {\n    if (points.length < 4) return [];\n\n    // FIXME: TODO: add in inflection abstraction for quartic+ curves?\n\n    const p = utils.align(points, { p1: points[0], p2: points.slice(-1)[0] }),\n      a = p[2].x * p[1].y,\n      b = p[3].x * p[1].y,\n      c = p[1].x * p[2].y,\n      d = p[3].x * p[2].y,\n      v1 = 18 * (-3 * a + 2 * b + 3 * c - d),\n      v2 = 18 * (3 * a - b - 3 * c),\n      v3 = 18 * (c - a);\n\n    if (utils.approximately(v1, 0)) {\n      if (!utils.approximately(v2, 0)) {\n        let t = -v3 / v2;\n        if (0 <= t && t <= 1) return [t];\n      }\n      return [];\n    }\n\n    const d2 = 2 * v1;\n\n    if (utils.approximately(d2, 0)) return [];\n\n    const trm = v2 * v2 - 4 * v1 * v3;\n\n    if (trm < 0) return [];\n\n    const sq = Math.sqrt(trm);\n\n    return [(sq - v2) / d2, -(v2 + sq) / d2].filter(function (r) {\n      return 0 <= r && r <= 1;\n    });\n  },\n\n  bboxoverlap: function (b1, b2) {\n    const dims = [\"x\", \"y\"],\n      len = dims.length;\n\n    for (let i = 0, dim, l, t, d; i < len; i++) {\n      dim = dims[i];\n      l = b1[dim].mid;\n      t = b2[dim].mid;\n      d = (b1[dim].size + b2[dim].size) / 2;\n      if (abs(l - t) >= d) return false;\n    }\n    return true;\n  },\n\n  expandbox: function (bbox, _bbox) {\n    if (_bbox.x.min < bbox.x.min) {\n      bbox.x.min = _bbox.x.min;\n    }\n    if (_bbox.y.min < bbox.y.min) {\n      bbox.y.min = _bbox.y.min;\n    }\n    if (_bbox.z && _bbox.z.min < bbox.z.min) {\n      bbox.z.min = _bbox.z.min;\n    }\n    if (_bbox.x.max > bbox.x.max) {\n      bbox.x.max = _bbox.x.max;\n    }\n    if (_bbox.y.max > bbox.y.max) {\n      bbox.y.max = _bbox.y.max;\n    }\n    if (_bbox.z && _bbox.z.max > bbox.z.max) {\n      bbox.z.max = _bbox.z.max;\n    }\n    bbox.x.mid = (bbox.x.min + bbox.x.max) / 2;\n    bbox.y.mid = (bbox.y.min + bbox.y.max) / 2;\n    if (bbox.z) {\n      bbox.z.mid = (bbox.z.min + bbox.z.max) / 2;\n    }\n    bbox.x.size = bbox.x.max - bbox.x.min;\n    bbox.y.size = bbox.y.max - bbox.y.min;\n    if (bbox.z) {\n      bbox.z.size = bbox.z.max - bbox.z.min;\n    }\n  },\n\n  pairiteration: function (c1, c2, curveIntersectionThreshold) {\n    const c1b = c1.bbox(),\n      c2b = c2.bbox(),\n      r = 100000,\n      threshold = curveIntersectionThreshold || 0.5;\n\n    if (\n      c1b.x.size + c1b.y.size < threshold &&\n      c2b.x.size + c2b.y.size < threshold\n    ) {\n      return [\n        (((r * (c1._t1 + c1._t2)) / 2) | 0) / r +\n          \"/\" +\n          (((r * (c2._t1 + c2._t2)) / 2) | 0) / r,\n      ];\n    }\n\n    let cc1 = c1.split(0.5),\n      cc2 = c2.split(0.5),\n      pairs = [\n        { left: cc1.left, right: cc2.left },\n        { left: cc1.left, right: cc2.right },\n        { left: cc1.right, right: cc2.right },\n        { left: cc1.right, right: cc2.left },\n      ];\n\n    pairs = pairs.filter(function (pair) {\n      return utils.bboxoverlap(pair.left.bbox(), pair.right.bbox());\n    });\n\n    let results = [];\n\n    if (pairs.length === 0) return results;\n\n    pairs.forEach(function (pair) {\n      results = results.concat(\n        utils.pairiteration(pair.left, pair.right, threshold)\n      );\n    });\n\n    results = results.filter(function (v, i) {\n      return results.indexOf(v) === i;\n    });\n\n    return results;\n  },\n\n  getccenter: function (p1, p2, p3) {\n    const dx1 = p2.x - p1.x,\n      dy1 = p2.y - p1.y,\n      dx2 = p3.x - p2.x,\n      dy2 = p3.y - p2.y,\n      dx1p = dx1 * cos(quart) - dy1 * sin(quart),\n      dy1p = dx1 * sin(quart) + dy1 * cos(quart),\n      dx2p = dx2 * cos(quart) - dy2 * sin(quart),\n      dy2p = dx2 * sin(quart) + dy2 * cos(quart),\n      // chord midpoints\n      mx1 = (p1.x + p2.x) / 2,\n      my1 = (p1.y + p2.y) / 2,\n      mx2 = (p2.x + p3.x) / 2,\n      my2 = (p2.y + p3.y) / 2,\n      // midpoint offsets\n      mx1n = mx1 + dx1p,\n      my1n = my1 + dy1p,\n      mx2n = mx2 + dx2p,\n      my2n = my2 + dy2p,\n      // intersection of these lines:\n      arc = utils.lli8(mx1, my1, mx1n, my1n, mx2, my2, mx2n, my2n),\n      r = utils.dist(arc, p1);\n\n    // arc start/end values, over mid point:\n    let s = atan2(p1.y - arc.y, p1.x - arc.x),\n      m = atan2(p2.y - arc.y, p2.x - arc.x),\n      e = atan2(p3.y - arc.y, p3.x - arc.x),\n      _;\n\n    // determine arc direction (cw/ccw correction)\n    if (s < e) {\n      // if s<m<e, arc(s, e)\n      // if m<s<e, arc(e, s + tau)\n      // if s<e<m, arc(e, s + tau)\n      if (s > m || m > e) {\n        s += tau;\n      }\n      if (s > e) {\n        _ = e;\n        e = s;\n        s = _;\n      }\n    } else {\n      // if e<m<s, arc(e, s)\n      // if m<e<s, arc(s, e + tau)\n      // if e<s<m, arc(s, e + tau)\n      if (e < m && m < s) {\n        _ = e;\n        e = s;\n        s = _;\n      } else {\n        e += tau;\n      }\n    }\n    // assign and done.\n    arc.s = s;\n    arc.e = e;\n    arc.r = r;\n    return arc;\n  },\n\n  numberSort: function (a, b) {\n    return a - b;\n  },\n};\n\nexport { utils };\n","import { utils } from \"./utils.js\";\n\n/**\n * Poly Bezier\n * @param {[type]} curves [description]\n */\nclass PolyBezier {\n  constructor(curves) {\n    this.curves = [];\n    this._3d = false;\n    if (!!curves) {\n      this.curves = curves;\n      this._3d = this.curves[0]._3d;\n    }\n  }\n\n  valueOf() {\n    return this.toString();\n  }\n\n  toString() {\n    return (\n      \"[\" +\n      this.curves\n        .map(function (curve) {\n          return utils.pointsToString(curve.points);\n        })\n        .join(\", \") +\n      \"]\"\n    );\n  }\n\n  addCurve(curve) {\n    this.curves.push(curve);\n    this._3d = this._3d || curve._3d;\n  }\n\n  length() {\n    return this.curves\n      .map(function (v) {\n        return v.length();\n      })\n      .reduce(function (a, b) {\n        return a + b;\n      });\n  }\n\n  curve(idx) {\n    return this.curves[idx];\n  }\n\n  bbox() {\n    const c = this.curves;\n    var bbox = c[0].bbox();\n    for (var i = 1; i < c.length; i++) {\n      utils.expandbox(bbox, c[i].bbox());\n    }\n    return bbox;\n  }\n\n  offset(d) {\n    const offset = [];\n    this.curves.forEach(function (v) {\n      offset.push(...v.offset(d));\n    });\n    return new PolyBezier(offset);\n  }\n}\n\nexport { PolyBezier };\n","/**\n  A javascript Bezier curve library by Pomax.\n\n  Based on http://pomax.github.io/bezierinfo\n\n  This code is MIT licensed.\n**/\n\nimport { utils } from \"./utils.js\";\nimport { PolyBezier } from \"./poly-bezier.js\";\n\n// math-inlining.\nconst { abs, min, max, cos, sin, acos, sqrt } = Math;\nconst pi = Math.PI;\n// a zero coordinate, which is surprisingly useful\nconst ZERO = { x: 0, y: 0, z: 0 };\n\n/**\n * Bezier curve constructor.\n *\n * ...docs pending...\n */\nclass Bezier {\n  constructor(coords) {\n    let args =\n      coords && coords.forEach ? coords : Array.from(arguments).slice();\n    let coordlen = false;\n\n    if (typeof args[0] === \"object\") {\n      coordlen = args.length;\n      const newargs = [];\n      args.forEach(function (point) {\n        [\"x\", \"y\", \"z\"].forEach(function (d) {\n          if (typeof point[d] !== \"undefined\") {\n            newargs.push(point[d]);\n          }\n        });\n      });\n      args = newargs;\n    }\n\n    let higher = false;\n    const len = args.length;\n\n    if (coordlen) {\n      if (coordlen > 4) {\n        if (arguments.length !== 1) {\n          throw new Error(\n            \"Only new Bezier(point[]) is accepted for 4th and higher order curves\"\n          );\n        }\n        higher = true;\n      }\n    } else {\n      if (len !== 6 && len !== 8 && len !== 9 && len !== 12) {\n        if (arguments.length !== 1) {\n          throw new Error(\n            \"Only new Bezier(point[]) is accepted for 4th and higher order curves\"\n          );\n        }\n      }\n    }\n\n    const _3d = (this._3d =\n      (!higher && (len === 9 || len === 12)) ||\n      (coords && coords[0] && typeof coords[0].z !== \"undefined\"));\n\n    const points = (this.points = []);\n    for (let idx = 0, step = _3d ? 3 : 2; idx < len; idx += step) {\n      var point = {\n        x: args[idx],\n        y: args[idx + 1],\n      };\n      if (_3d) {\n        point.z = args[idx + 2];\n      }\n      points.push(point);\n    }\n    const order = (this.order = points.length - 1);\n\n    const dims = (this.dims = [\"x\", \"y\"]);\n    if (_3d) dims.push(\"z\");\n    this.dimlen = dims.length;\n\n    // is this curve, practically speaking, a straight line?\n    const aligned = utils.align(points, { p1: points[0], p2: points[order] });\n    const baselength = utils.dist(points[0], points[order]);\n    this._linear = aligned.reduce((t, p) => t + abs(p.y), 0) < baselength / 50;\n\n    this._lut = [];\n    this._t1 = 0;\n    this._t2 = 1;\n    this.update();\n  }\n\n  static quadraticFromPoints(p1, p2, p3, t) {\n    if (typeof t === \"undefined\") {\n      t = 0.5;\n    }\n    // shortcuts, although they're really dumb\n    if (t === 0) {\n      return new Bezier(p2, p2, p3);\n    }\n    if (t === 1) {\n      return new Bezier(p1, p2, p2);\n    }\n    // real fitting.\n    const abc = Bezier.getABC(2, p1, p2, p3, t);\n    return new Bezier(p1, abc.A, p3);\n  }\n\n  static cubicFromPoints(S, B, E, t, d1) {\n    if (typeof t === \"undefined\") {\n      t = 0.5;\n    }\n    const abc = Bezier.getABC(3, S, B, E, t);\n    if (typeof d1 === \"undefined\") {\n      d1 = utils.dist(B, abc.C);\n    }\n    const d2 = (d1 * (1 - t)) / t;\n\n    const selen = utils.dist(S, E),\n      lx = (E.x - S.x) / selen,\n      ly = (E.y - S.y) / selen,\n      bx1 = d1 * lx,\n      by1 = d1 * ly,\n      bx2 = d2 * lx,\n      by2 = d2 * ly;\n    // derivation of new hull coordinates\n    const e1 = { x: B.x - bx1, y: B.y - by1 },\n      e2 = { x: B.x + bx2, y: B.y + by2 },\n      A = abc.A,\n      v1 = { x: A.x + (e1.x - A.x) / (1 - t), y: A.y + (e1.y - A.y) / (1 - t) },\n      v2 = { x: A.x + (e2.x - A.x) / t, y: A.y + (e2.y - A.y) / t },\n      nc1 = { x: S.x + (v1.x - S.x) / t, y: S.y + (v1.y - S.y) / t },\n      nc2 = {\n        x: E.x + (v2.x - E.x) / (1 - t),\n        y: E.y + (v2.y - E.y) / (1 - t),\n      };\n    // ...done\n    return new Bezier(S, nc1, nc2, E);\n  }\n\n  static getUtils() {\n    return utils;\n  }\n\n  getUtils() {\n    return Bezier.getUtils();\n  }\n\n  static get PolyBezier() {\n    return PolyBezier;\n  }\n\n  valueOf() {\n    return this.toString();\n  }\n\n  toString() {\n    return utils.pointsToString(this.points);\n  }\n\n  toSVG() {\n    if (this._3d) return false;\n    const p = this.points,\n      x = p[0].x,\n      y = p[0].y,\n      s = [\"M\", x, y, this.order === 2 ? \"Q\" : \"C\"];\n    for (let i = 1, last = p.length; i < last; i++) {\n      s.push(p[i].x);\n      s.push(p[i].y);\n    }\n    return s.join(\" \");\n  }\n\n  setRatios(ratios) {\n    if (ratios.length !== this.points.length) {\n      throw new Error(\"incorrect number of ratio values\");\n    }\n    this.ratios = ratios;\n    this._lut = []; //  invalidate any precomputed LUT\n  }\n\n  verify() {\n    const print = this.coordDigest();\n    if (print !== this._print) {\n      this._print = print;\n      this.update();\n    }\n  }\n\n  coordDigest() {\n    return this.points\n      .map(function (c, pos) {\n        return \"\" + pos + c.x + c.y + (c.z ? c.z : 0);\n      })\n      .join(\"\");\n  }\n\n  update() {\n    // invalidate any precomputed LUT\n    this._lut = [];\n    this.dpoints = utils.derive(this.points, this._3d);\n    this.computedirection();\n  }\n\n  computedirection() {\n    const points = this.points;\n    const angle = utils.angle(points[0], points[this.order], points[1]);\n    this.clockwise = angle > 0;\n  }\n\n  length() {\n    return utils.length(this.derivative.bind(this));\n  }\n\n  static getABC(order = 2, S, B, E, t = 0.5) {\n    const u = utils.projectionratio(t, order),\n      um = 1 - u,\n      C = {\n        x: u * S.x + um * E.x,\n        y: u * S.y + um * E.y,\n      },\n      s = utils.abcratio(t, order),\n      A = {\n        x: B.x + (B.x - C.x) / s,\n        y: B.y + (B.y - C.y) / s,\n      };\n    return { A, B, C, S, E };\n  }\n\n  getABC(t, B) {\n    B = B || this.get(t);\n    let S = this.points[0];\n    let E = this.points[this.order];\n    return Bezier.getABC(this.order, S, B, E, t);\n  }\n\n  getLUT(steps) {\n    this.verify();\n    steps = steps || 100;\n    if (this._lut.length === steps + 1) {\n      return this._lut;\n    }\n    this._lut = [];\n    // n steps means n+1 points\n    steps++;\n    this._lut = [];\n    for (let i = 0, p, t; i < steps; i++) {\n      t = i / (steps - 1);\n      p = this.compute(t);\n      p.t = t;\n      this._lut.push(p);\n    }\n    return this._lut;\n  }\n\n  on(point, error) {\n    error = error || 5;\n    const lut = this.getLUT(),\n      hits = [];\n    for (let i = 0, c, t = 0; i < lut.length; i++) {\n      c = lut[i];\n      if (utils.dist(c, point) < error) {\n        hits.push(c);\n        t += i / lut.length;\n      }\n    }\n    if (!hits.length) return false;\n    return (t /= hits.length);\n  }\n\n  project(point) {\n    // step 1: coarse check\n    const LUT = this.getLUT(),\n      l = LUT.length - 1,\n      closest = utils.closest(LUT, point),\n      mpos = closest.mpos,\n      t1 = (mpos - 1) / l,\n      t2 = (mpos + 1) / l,\n      step = 0.1 / l;\n\n    // step 2: fine check\n    let mdist = closest.mdist,\n      t = t1,\n      ft = t,\n      p;\n    mdist += 1;\n    for (let d; t < t2 + step; t += step) {\n      p = this.compute(t);\n      d = utils.dist(point, p);\n      if (d < mdist) {\n        mdist = d;\n        ft = t;\n      }\n    }\n    ft = ft < 0 ? 0 : ft > 1 ? 1 : ft;\n    p = this.compute(ft);\n    p.t = ft;\n    p.d = mdist;\n    return p;\n  }\n\n  get(t) {\n    return this.compute(t);\n  }\n\n  point(idx) {\n    return this.points[idx];\n  }\n\n  compute(t) {\n    if (this.ratios) {\n      return utils.computeWithRatios(t, this.points, this.ratios, this._3d);\n    }\n    return utils.compute(t, this.points, this._3d, this.ratios);\n  }\n\n  raise() {\n    const p = this.points,\n      np = [p[0]],\n      k = p.length;\n    for (let i = 1, pi, pim; i < k; i++) {\n      pi = p[i];\n      pim = p[i - 1];\n      np[i] = {\n        x: ((k - i) / k) * pi.x + (i / k) * pim.x,\n        y: ((k - i) / k) * pi.y + (i / k) * pim.y,\n      };\n    }\n    np[k] = p[k - 1];\n    return new Bezier(np);\n  }\n\n  derivative(t) {\n    return utils.compute(t, this.dpoints[0], this._3d);\n  }\n\n  dderivative(t) {\n    return utils.compute(t, this.dpoints[1], this._3d);\n  }\n\n  align() {\n    let p = this.points;\n    return new Bezier(utils.align(p, { p1: p[0], p2: p[p.length - 1] }));\n  }\n\n  curvature(t) {\n    return utils.curvature(t, this.dpoints[0], this.dpoints[1], this._3d);\n  }\n\n  inflections() {\n    return utils.inflections(this.points);\n  }\n\n  normal(t) {\n    return this._3d ? this.__normal3(t) : this.__normal2(t);\n  }\n\n  __normal2(t) {\n    const d = this.derivative(t);\n    const q = sqrt(d.x * d.x + d.y * d.y);\n    return { t, x: -d.y / q, y: d.x / q };\n  }\n\n  __normal3(t) {\n    // see http://stackoverflow.com/questions/25453159\n    const r1 = this.derivative(t),\n      r2 = this.derivative(t + 0.01),\n      q1 = sqrt(r1.x * r1.x + r1.y * r1.y + r1.z * r1.z),\n      q2 = sqrt(r2.x * r2.x + r2.y * r2.y + r2.z * r2.z);\n    r1.x /= q1;\n    r1.y /= q1;\n    r1.z /= q1;\n    r2.x /= q2;\n    r2.y /= q2;\n    r2.z /= q2;\n    // cross product\n    const c = {\n      x: r2.y * r1.z - r2.z * r1.y,\n      y: r2.z * r1.x - r2.x * r1.z,\n      z: r2.x * r1.y - r2.y * r1.x,\n    };\n    const m = sqrt(c.x * c.x + c.y * c.y + c.z * c.z);\n    c.x /= m;\n    c.y /= m;\n    c.z /= m;\n    // rotation matrix\n    const R = [\n      c.x * c.x,\n      c.x * c.y - c.z,\n      c.x * c.z + c.y,\n      c.x * c.y + c.z,\n      c.y * c.y,\n      c.y * c.z - c.x,\n      c.x * c.z - c.y,\n      c.y * c.z + c.x,\n      c.z * c.z,\n    ];\n    // normal vector:\n    const n = {\n      t,\n      x: R[0] * r1.x + R[1] * r1.y + R[2] * r1.z,\n      y: R[3] * r1.x + R[4] * r1.y + R[5] * r1.z,\n      z: R[6] * r1.x + R[7] * r1.y + R[8] * r1.z,\n    };\n    return n;\n  }\n\n  hull(t) {\n    let p = this.points,\n      _p = [],\n      q = [],\n      idx = 0;\n    q[idx++] = p[0];\n    q[idx++] = p[1];\n    q[idx++] = p[2];\n    if (this.order === 3) {\n      q[idx++] = p[3];\n    }\n    // we lerp between all points at each iteration, until we have 1 point left.\n    while (p.length > 1) {\n      _p = [];\n      for (let i = 0, pt, l = p.length - 1; i < l; i++) {\n        pt = utils.lerp(t, p[i], p[i + 1]);\n        q[idx++] = pt;\n        _p.push(pt);\n      }\n      p = _p;\n    }\n    return q;\n  }\n\n  split(t1, t2) {\n    // shortcuts\n    if (t1 === 0 && !!t2) {\n      return this.split(t2).left;\n    }\n    if (t2 === 1) {\n      return this.split(t1).right;\n    }\n\n    // no shortcut: use \"de Casteljau\" iteration.\n    const q = this.hull(t1);\n    const result = {\n      left:\n        this.order === 2\n          ? new Bezier([q[0], q[3], q[5]])\n          : new Bezier([q[0], q[4], q[7], q[9]]),\n      right:\n        this.order === 2\n          ? new Bezier([q[5], q[4], q[2]])\n          : new Bezier([q[9], q[8], q[6], q[3]]),\n      span: q,\n    };\n\n    // make sure we bind _t1/_t2 information!\n    result.left._t1 = utils.map(0, 0, 1, this._t1, this._t2);\n    result.left._t2 = utils.map(t1, 0, 1, this._t1, this._t2);\n    result.right._t1 = utils.map(t1, 0, 1, this._t1, this._t2);\n    result.right._t2 = utils.map(1, 0, 1, this._t1, this._t2);\n\n    // if we have no t2, we're done\n    if (!t2) {\n      return result;\n    }\n\n    // if we have a t2, split again:\n    t2 = utils.map(t2, t1, 1, 0, 1);\n    return result.right.split(t2).left;\n  }\n\n  extrema() {\n    const result = {};\n    let roots = [];\n\n    this.dims.forEach(\n      function (dim) {\n        let mfn = function (v) {\n          return v[dim];\n        };\n        let p = this.dpoints[0].map(mfn);\n        result[dim] = utils.droots(p);\n        if (this.order === 3) {\n          p = this.dpoints[1].map(mfn);\n          result[dim] = result[dim].concat(utils.droots(p));\n        }\n        result[dim] = result[dim].filter(function (t) {\n          return t >= 0 && t <= 1;\n        });\n        roots = roots.concat(result[dim].sort(utils.numberSort));\n      }.bind(this)\n    );\n\n    result.values = roots.sort(utils.numberSort).filter(function (v, idx) {\n      return roots.indexOf(v) === idx;\n    });\n\n    return result;\n  }\n\n  bbox() {\n    const extrema = this.extrema(),\n      result = {};\n    this.dims.forEach(\n      function (d) {\n        result[d] = utils.getminmax(this, d, extrema[d]);\n      }.bind(this)\n    );\n    return result;\n  }\n\n  overlaps(curve) {\n    const lbbox = this.bbox(),\n      tbbox = curve.bbox();\n    return utils.bboxoverlap(lbbox, tbbox);\n  }\n\n  offset(t, d) {\n    if (typeof d !== \"undefined\") {\n      const c = this.get(t),\n        n = this.normal(t);\n      const ret = {\n        c: c,\n        n: n,\n        x: c.x + n.x * d,\n        y: c.y + n.y * d,\n      };\n      if (this._3d) {\n        ret.z = c.z + n.z * d;\n      }\n      return ret;\n    }\n    if (this._linear) {\n      const nv = this.normal(0),\n        coords = this.points.map(function (p) {\n          const ret = {\n            x: p.x + t * nv.x,\n            y: p.y + t * nv.y,\n          };\n          if (p.z && nv.z) {\n            ret.z = p.z + t * nv.z;\n          }\n          return ret;\n        });\n      return [new Bezier(coords)];\n    }\n    return this.reduce().map(function (s) {\n      if (s._linear) {\n        return s.offset(t)[0];\n      }\n      return s.scale(t);\n    });\n  }\n\n  simple() {\n    if (this.order === 3) {\n      const a1 = utils.angle(this.points[0], this.points[3], this.points[1]);\n      const a2 = utils.angle(this.points[0], this.points[3], this.points[2]);\n      if ((a1 > 0 && a2 < 0) || (a1 < 0 && a2 > 0)) return false;\n    }\n    const n1 = this.normal(0);\n    const n2 = this.normal(1);\n    let s = n1.x * n2.x + n1.y * n2.y;\n    if (this._3d) {\n      s += n1.z * n2.z;\n    }\n    return abs(acos(s)) < pi / 3;\n  }\n\n  reduce() {\n    // TODO: examine these var types in more detail...\n    let i,\n      t1 = 0,\n      t2 = 0,\n      step = 0.01,\n      segment,\n      pass1 = [],\n      pass2 = [];\n    // first pass: split on extrema\n    let extrema = this.extrema().values;\n    if (extrema.indexOf(0) === -1) {\n      extrema = [0].concat(extrema);\n    }\n    if (extrema.indexOf(1) === -1) {\n      extrema.push(1);\n    }\n\n    for (t1 = extrema[0], i = 1; i < extrema.length; i++) {\n      t2 = extrema[i];\n      segment = this.split(t1, t2);\n      segment._t1 = t1;\n      segment._t2 = t2;\n      pass1.push(segment);\n      t1 = t2;\n    }\n\n    // second pass: further reduce these segments to simple segments\n    pass1.forEach(function (p1) {\n      t1 = 0;\n      t2 = 0;\n      while (t2 <= 1) {\n        for (t2 = t1 + step; t2 <= 1 + step; t2 += step) {\n          segment = p1.split(t1, t2);\n          if (!segment.simple()) {\n            t2 -= step;\n            if (abs(t1 - t2) < step) {\n              // we can never form a reduction\n              return [];\n            }\n            segment = p1.split(t1, t2);\n            segment._t1 = utils.map(t1, 0, 1, p1._t1, p1._t2);\n            segment._t2 = utils.map(t2, 0, 1, p1._t1, p1._t2);\n            pass2.push(segment);\n            t1 = t2;\n            break;\n          }\n        }\n      }\n      if (t1 < 1) {\n        segment = p1.split(t1, 1);\n        segment._t1 = utils.map(t1, 0, 1, p1._t1, p1._t2);\n        segment._t2 = p1._t2;\n        pass2.push(segment);\n      }\n    });\n    return pass2;\n  }\n\n  translate(v, d1, d2) {\n    d2 = typeof d2 === \"number\" ? d2 : d1;\n\n    // TODO: make this take curves with control points outside\n    //       of the start-end interval into account\n\n    const o = this.order;\n    let d = this.points.map((_, i) => (1 - i / o) * d1 + (i / o) * d2);\n    return new Bezier(\n      this.points.map((p, i) => ({\n        x: p.x + v.x * d[i],\n        y: p.y + v.y * d[i],\n      }))\n    );\n  }\n\n  scale(d) {\n    const order = this.order;\n    let distanceFn = false;\n    if (typeof d === \"function\") {\n      distanceFn = d;\n    }\n    if (distanceFn && order === 2) {\n      return this.raise().scale(distanceFn);\n    }\n\n    // TODO: add special handling for non-linear degenerate curves.\n\n    const clockwise = this.clockwise;\n    const points = this.points;\n\n    if (this._linear) {\n      return this.translate(\n        this.normal(0),\n        distanceFn ? distanceFn(0) : d,\n        distanceFn ? distanceFn(1) : d\n      );\n    }\n\n    const r1 = distanceFn ? distanceFn(0) : d;\n    const r2 = distanceFn ? distanceFn(1) : d;\n    const v = [this.offset(0, 10), this.offset(1, 10)];\n    const np = [];\n    const o = utils.lli4(v[0], v[0].c, v[1], v[1].c);\n\n    if (!o) {\n      throw new Error(\"cannot scale this curve. Try reducing it first.\");\n    }\n\n    // move all points by distance 'd' wrt the origin 'o',\n    // and move end points by fixed distance along normal.\n    [0, 1].forEach(function (t) {\n      const p = (np[t * order] = utils.copy(points[t * order]));\n      p.x += (t ? r2 : r1) * v[t].n.x;\n      p.y += (t ? r2 : r1) * v[t].n.y;\n    });\n\n    if (!distanceFn) {\n      // move control points to lie on the intersection of the offset\n      // derivative vector, and the origin-through-control vector\n      [0, 1].forEach((t) => {\n        if (order === 2 && !!t) return;\n        const p = np[t * order];\n        const d = this.derivative(t);\n        const p2 = { x: p.x + d.x, y: p.y + d.y };\n        np[t + 1] = utils.lli4(p, p2, o, points[t + 1]);\n      });\n      return new Bezier(np);\n    }\n\n    // move control points by \"however much necessary to\n    // ensure the correct tangent to endpoint\".\n    [0, 1].forEach(function (t) {\n      if (order === 2 && !!t) return;\n      var p = points[t + 1];\n      var ov = {\n        x: p.x - o.x,\n        y: p.y - o.y,\n      };\n      var rc = distanceFn ? distanceFn((t + 1) / order) : d;\n      if (distanceFn && !clockwise) rc = -rc;\n      var m = sqrt(ov.x * ov.x + ov.y * ov.y);\n      ov.x /= m;\n      ov.y /= m;\n      np[t + 1] = {\n        x: p.x + rc * ov.x,\n        y: p.y + rc * ov.y,\n      };\n    });\n    return new Bezier(np);\n  }\n\n  outline(d1, d2, d3, d4) {\n    d2 = d2 === undefined ? d1 : d2;\n\n    if (this._linear) {\n      // TODO: find the actual extrema, because they might\n      //       be before the start, or past the end.\n\n      const n = this.normal(0);\n      const start = this.points[0];\n      const end = this.points[this.points.length - 1];\n      let s, mid, e;\n\n      if (d3 === undefined) {\n        d3 = d1;\n        d4 = d2;\n      }\n\n      s = { x: start.x + n.x * d1, y: start.y + n.y * d1 };\n      e = { x: end.x + n.x * d3, y: end.y + n.y * d3 };\n      mid = { x: (s.x + e.x) / 2, y: (s.y + e.y) / 2 };\n      const fline = [s, mid, e];\n\n      s = { x: start.x - n.x * d2, y: start.y - n.y * d2 };\n      e = { x: end.x - n.x * d4, y: end.y - n.y * d4 };\n      mid = { x: (s.x + e.x) / 2, y: (s.y + e.y) / 2 };\n      const bline = [e, mid, s];\n\n      const ls = utils.makeline(bline[2], fline[0]);\n      const le = utils.makeline(fline[2], bline[0]);\n      const segments = [ls, new Bezier(fline), le, new Bezier(bline)];\n      return new PolyBezier(segments);\n    }\n\n    const reduced = this.reduce(),\n      len = reduced.length,\n      fcurves = [];\n\n    let bcurves = [],\n      p,\n      alen = 0,\n      tlen = this.length();\n\n    const graduated = typeof d3 !== \"undefined\" && typeof d4 !== \"undefined\";\n\n    function linearDistanceFunction(s, e, tlen, alen, slen) {\n      return function (v) {\n        const f1 = alen / tlen,\n          f2 = (alen + slen) / tlen,\n          d = e - s;\n        return utils.map(v, 0, 1, s + f1 * d, s + f2 * d);\n      };\n    }\n\n    // form curve oulines\n    reduced.forEach(function (segment) {\n      const slen = segment.length();\n      if (graduated) {\n        fcurves.push(\n          segment.scale(linearDistanceFunction(d1, d3, tlen, alen, slen))\n        );\n        bcurves.push(\n          segment.scale(linearDistanceFunction(-d2, -d4, tlen, alen, slen))\n        );\n      } else {\n        fcurves.push(segment.scale(d1));\n        bcurves.push(segment.scale(-d2));\n      }\n      alen += slen;\n    });\n\n    // reverse the \"return\" outline\n    bcurves = bcurves\n      .map(function (s) {\n        p = s.points;\n        if (p[3]) {\n          s.points = [p[3], p[2], p[1], p[0]];\n        } else {\n          s.points = [p[2], p[1], p[0]];\n        }\n        return s;\n      })\n      .reverse();\n\n    // form the endcaps as lines\n    const fs = fcurves[0].points[0],\n      fe = fcurves[len - 1].points[fcurves[len - 1].points.length - 1],\n      bs = bcurves[len - 1].points[bcurves[len - 1].points.length - 1],\n      be = bcurves[0].points[0],\n      ls = utils.makeline(bs, fs),\n      le = utils.makeline(fe, be),\n      segments = [ls].concat(fcurves).concat([le]).concat(bcurves);\n\n    return new PolyBezier(segments);\n  }\n\n  outlineshapes(d1, d2, curveIntersectionThreshold) {\n    d2 = d2 || d1;\n    const outline = this.outline(d1, d2).curves;\n    const shapes = [];\n    for (let i = 1, len = outline.length; i < len / 2; i++) {\n      const shape = utils.makeshape(\n        outline[i],\n        outline[len - i],\n        curveIntersectionThreshold\n      );\n      shape.startcap.virtual = i > 1;\n      shape.endcap.virtual = i < len / 2 - 1;\n      shapes.push(shape);\n    }\n    return shapes;\n  }\n\n  intersects(curve, curveIntersectionThreshold) {\n    if (!curve) return this.selfintersects(curveIntersectionThreshold);\n    if (curve.p1 && curve.p2) {\n      return this.lineIntersects(curve);\n    }\n    if (curve instanceof Bezier) {\n      curve = curve.reduce();\n    }\n    return this.curveintersects(\n      this.reduce(),\n      curve,\n      curveIntersectionThreshold\n    );\n  }\n\n  lineIntersects(line) {\n    const mx = min(line.p1.x, line.p2.x),\n      my = min(line.p1.y, line.p2.y),\n      MX = max(line.p1.x, line.p2.x),\n      MY = max(line.p1.y, line.p2.y);\n    return utils.roots(this.points, line).filter((t) => {\n      var p = this.get(t);\n      return utils.between(p.x, mx, MX) && utils.between(p.y, my, MY);\n    });\n  }\n\n  selfintersects(curveIntersectionThreshold) {\n    // \"simple\" curves cannot intersect with their direct\n    // neighbour, so for each segment X we check whether\n    // it intersects [0:x-2][x+2:last].\n\n    const reduced = this.reduce(),\n      len = reduced.length - 2,\n      results = [];\n\n    for (let i = 0, result, left, right; i < len; i++) {\n      left = reduced.slice(i, i + 1);\n      right = reduced.slice(i + 2);\n      result = this.curveintersects(left, right, curveIntersectionThreshold);\n      results.push(...result);\n    }\n    return results;\n  }\n\n  curveintersects(c1, c2, curveIntersectionThreshold) {\n    const pairs = [];\n    // step 1: pair off any overlapping segments\n    c1.forEach(function (l) {\n      c2.forEach(function (r) {\n        if (l.overlaps(r)) {\n          pairs.push({ left: l, right: r });\n        }\n      });\n    });\n    // step 2: for each pairing, run through the convergence algorithm.\n    let intersections = [];\n    pairs.forEach(function (pair) {\n      const result = utils.pairiteration(\n        pair.left,\n        pair.right,\n        curveIntersectionThreshold\n      );\n      if (result.length > 0) {\n        intersections = intersections.concat(result);\n      }\n    });\n    return intersections;\n  }\n\n  arcs(errorThreshold) {\n    errorThreshold = errorThreshold || 0.5;\n    return this._iterate(errorThreshold, []);\n  }\n\n  _error(pc, np1, s, e) {\n    const q = (e - s) / 4,\n      c1 = this.get(s + q),\n      c2 = this.get(e - q),\n      ref = utils.dist(pc, np1),\n      d1 = utils.dist(pc, c1),\n      d2 = utils.dist(pc, c2);\n    return abs(d1 - ref) + abs(d2 - ref);\n  }\n\n  _iterate(errorThreshold, circles) {\n    let t_s = 0,\n      t_e = 1,\n      safety;\n    // we do a binary search to find the \"good `t` closest to no-longer-good\"\n    do {\n      safety = 0;\n\n      // step 1: start with the maximum possible arc\n      t_e = 1;\n\n      // points:\n      let np1 = this.get(t_s),\n        np2,\n        np3,\n        arc,\n        prev_arc;\n\n      // booleans:\n      let curr_good = false,\n        prev_good = false,\n        done;\n\n      // numbers:\n      let t_m = t_e,\n        prev_e = 1,\n        step = 0;\n\n      // step 2: find the best possible arc\n      do {\n        prev_good = curr_good;\n        prev_arc = arc;\n        t_m = (t_s + t_e) / 2;\n        step++;\n\n        np2 = this.get(t_m);\n        np3 = this.get(t_e);\n\n        arc = utils.getccenter(np1, np2, np3);\n\n        //also save the t values\n        arc.interval = {\n          start: t_s,\n          end: t_e,\n        };\n\n        let error = this._error(arc, np1, t_s, t_e);\n        curr_good = error <= errorThreshold;\n\n        done = prev_good && !curr_good;\n        if (!done) prev_e = t_e;\n\n        // this arc is fine: we can move 'e' up to see if we can find a wider arc\n        if (curr_good) {\n          // if e is already at max, then we're done for this arc.\n          if (t_e >= 1) {\n            // make sure we cap at t=1\n            arc.interval.end = prev_e = 1;\n            prev_arc = arc;\n            // if we capped the arc segment to t=1 we also need to make sure that\n            // the arc's end angle is correct with respect to the bezier end point.\n            if (t_e > 1) {\n              let d = {\n                x: arc.x + arc.r * cos(arc.e),\n                y: arc.y + arc.r * sin(arc.e),\n              };\n              arc.e += utils.angle({ x: arc.x, y: arc.y }, d, this.get(1));\n            }\n            break;\n          }\n          // if not, move it up by half the iteration distance\n          t_e = t_e + (t_e - t_s) / 2;\n        } else {\n          // this is a bad arc: we need to move 'e' down to find a good arc\n          t_e = t_m;\n        }\n      } while (!done && safety++ < 100);\n\n      if (safety >= 100) {\n        break;\n      }\n\n      // console.log(\"L835: [F] arc found\", t_s, prev_e, prev_arc.x, prev_arc.y, prev_arc.s, prev_arc.e);\n\n      prev_arc = prev_arc ? prev_arc : arc;\n      circles.push(prev_arc);\n      t_s = prev_e;\n    } while (t_e < 1);\n    return circles;\n  }\n}\n\nexport { Bezier };\n","\n//import { Points, Paths } from '../index.js';\nimport * as Paths from '../path/index.js';\nimport { bbox as PointsBbox } from '../point/Bbox.js';\nimport { isEqual as PointsIsEqual } from '../point/IsEqual.js';\nimport type { CompoundPath, Dimensions, Path, RectPositioned } from '../Types.js';\nimport type { Point } from '../point/PointType.js';\nimport { corners as RectsCorners } from '../rect/Corners.js';\nimport { sortByNumericProperty } from '../../data/arrays/Sort.js';\n\n/**\n * Returns a new compoundpath, replacing a path at a given index\n *\n * @param compoundPath Existing compoundpath\n * @param index Index to replace at\n * @param path Path to substitute in\n * @returns New compoundpath\n */\nexport const setSegment = (compoundPath: CompoundPath, index: number, path: Path): CompoundPath => {\n  const existing = [ ...compoundPath.segments ];\n  //eslint-disable-next-line functional/prefer-readonly-type,functional/immutable-data\n  existing[ index ] = path;\n  return fromPaths(...existing);\n};\n\n/**\n * Computes x,y point at a relative position along compoundpath\n *\n * @param paths Combined paths (assumes contiguous)\n * @param t Position (given as a percentage from 0 to 1)\n * @param useWidth If true, widths are used for calulcating. If false, lengths are used\n * @param dimensions Precalculated dimensions of paths, will be computed if omitted\n * @returns\n */\nexport const interpolate = (paths: ReadonlyArray<Path>, t: number, useWidth?: boolean, dimensions?: Dimensions) => {\n  if (dimensions === undefined) {\n    dimensions = computeDimensions(paths);\n  }\n\n  // Expected value to land on\n  const expected = t * (useWidth ? dimensions.totalWidth : dimensions.totalLength);\n  let soFar = 0;\n\n  // Use widths or lengths?\n  const l = useWidth ? dimensions.widths : dimensions.lengths;\n  for (const [ index, element ] of l.entries()) {\n    if (soFar + element >= expected) {\n      const relative = expected - soFar;\n      let amt = relative / element;\n      if (amt > 1) amt = 1;\n      return paths[ index ].interpolate(amt);\n    } else soFar += element;\n  }\n  return { x: 0, y: 0 };\n};\n\n/**\n * Returns the shortest distance of `point` to any point on `paths`.\n * @param paths \n * @param point \n * @returns \n */\nexport const distanceToPoint = (paths: ReadonlyArray<Path>, point: Point): number => {\n  if (paths.length === 0) return 0;\n  let distances = paths.map((p, index) => ({ path: p, index, distance: p.distanceToPoint(point) }));\n  distances = sortByNumericProperty(distances, `distance`);\n  if (distances.length === 0) throw new Error(`Could not look up distances`);\n  return distances[ 0 ].distance;\n}\n\n/**\n * Relative position\n * @param paths Paths\n * @param point Point\n * @param intersectionThreshold Threshold \n * @param dimensions Pre-computed dimensions\n * @returns \n */\nexport const relativePosition = (paths: ReadonlyArray<Path>, point: Point, intersectionThreshold: number, dimensions?: Dimensions): number => {\n  if (dimensions === undefined) {\n    dimensions = computeDimensions(paths);\n  }\n  let distances = paths.map((p, index) => ({ path: p, index, distance: p.distanceToPoint(point) }));\n  distances = sortByNumericProperty(distances, `distance`);\n  if (distances.length < 0) throw new Error(`Point does not intersect with path`);\n  const d = distances[ 0 ];\n  if (d.distance > intersectionThreshold) throw new Error(`Point does not intersect with path. Minimum distance: ${ d.distance }, threshold: ${ intersectionThreshold }`);\n\n  const relativePositionOnPath = d.path.relativePosition(point, intersectionThreshold);\n\n  // Add up distances\n  let accumulated = 0;\n  for (let index = 0; index < d.index; index++) {\n    // Add up length of paths before closest path segment\n    accumulated += dimensions.lengths[ index ];\n  }\n\n  // Add up partial amount of closest path\n  accumulated += dimensions.lengths[ d.index ] * relativePositionOnPath;\n  const accumulatedRel = accumulated / dimensions.totalLength;\n  console.log(`acc: ${ accumulated } rel: ${ accumulatedRel } on path: ${ relativePositionOnPath } path: ${ d.index }`);\n  return accumulatedRel;\n}\n\n/**\n * Computes the widths and lengths of all paths, adding them up as well\n *\n * @param paths\n * @returns\n */\nexport const computeDimensions = (paths: ReadonlyArray<Path>): Dimensions => {\n  const widths = paths.map(l => l.bbox().width);\n  const lengths = paths.map(l => l.length());\n  let totalLength = 0;\n  let totalWidth = 0;\n  for (const length of lengths) {\n    totalLength += length;\n  }\n  for (const width of widths) {\n    totalWidth += width;\n  }\n\n  return { totalLength, totalWidth, widths, lengths };\n};\n\n/**\n * Computes the bounding box that encloses entire compoundpath\n *\n * @param paths\n * @returns\n */\nexport const bbox = (paths: ReadonlyArray<Path>): RectPositioned => {\n  const boxes = paths.map(p => p.bbox());\n  const corners = boxes.flatMap(b => RectsCorners(b));\n\n  return PointsBbox(...corners);\n};\n\n/**\n * Produce a human-friendly representation of paths\n *\n * @param paths\n * @returns\n */\nexport const toString = (paths: ReadonlyArray<Path>): string => paths.map(p => p.toString()).join(`, `);\n\n/**\n * Throws an error if paths are not connected together, in order\n *\n * @param paths\n */\nexport const guardContinuous = (paths: ReadonlyArray<Path>) => {\n  let lastPos = Paths.getEnd(paths[ 0 ]);\n  for (let index = 1; index < paths.length; index++) {\n    const start = Paths.getStart(paths[ index ]);\n    if (!PointsIsEqual(start, lastPos)) throw new Error(`Path index ${ index } does not start at prior path end. Start: ${ start.x },${ start.y } expected: ${ lastPos.x },${ lastPos.y }`);\n    lastPos = Paths.getEnd(paths[ index ]);\n  }\n};\n\nexport const toSvgString = (paths: ReadonlyArray<Path>): ReadonlyArray<string> => paths.flatMap(p => p.toSvgString());\n\n/**\n * Create a compoundpath from an array of paths.\n * All this does is verify they are connected, and precomputes dimensions\n *\n * @param paths\n * @returns\n */\nexport const fromPaths = (...paths: ReadonlyArray<Path>): CompoundPath => {\n  guardContinuous(paths); // Throws an error if paths are not connected\n  const dims = computeDimensions(paths);\n\n  return Object.freeze({\n    segments: paths,\n    length: () => dims.totalLength,\n    nearest: (_: Point) => { throw new Error(`not implemented`); },\n    interpolate: (t: number, useWidth = false) => interpolate(paths, t, useWidth, dims),\n    relativePosition: (point: Point, intersectionThreshold: number) => relativePosition(paths, point, intersectionThreshold, dims),\n    distanceToPoint: (point: Point) => distanceToPoint(paths, point),\n    bbox: () => bbox(paths),\n    toString: () => toString(paths),\n    toSvgString: () => toSvgString(paths),\n    kind: `compound`\n  });\n};\n","\nimport type { Point } from './point/PointType.js';\nimport { degreeToRadian } from './Angles.js';\nimport type { Path } from './path/index.js';\n\n/**\n * An ellipse\n */\nexport type Ellipse = {\n  readonly radiusX: number\n  readonly radiusY: number\n  /**\n   * Rotation, in radians\n   */\n  readonly rotation?: number\n  readonly startAngle?: number\n  readonly endAngle?: number\n}\n\n/**\n * A {@link Ellipse} with position\n */\nexport type EllipsePositioned = Point & Ellipse\n\n\nexport const fromDegrees = (radiusX: number, radiusY: number, rotationDeg = 0, startAngleDeg = 0, endAngleDeg = 360): Ellipse => ({\n  radiusX, radiusY,\n  rotation: degreeToRadian(rotationDeg),\n  startAngle: degreeToRadian(startAngleDeg),\n  endAngle: degreeToRadian(endAngleDeg)\n});\n\nexport type EllipticalPath = Ellipse & Path & {\n  readonly kind: `elliptical`\n};","import type { Point } from \"./point/PointType.js\";\nimport { distance } from \"./point/Distance.js\";\n/**\n * Simplifies a curve by dropping points based on shortest distance.\n * \n * Values of `epsilon` approaching zero keep more of the original points.\n * Making `epsilon` larger will filter out more points, making the curve more lossy and jagged.\n * \n * ```js\n * // Source set of points that define the curve\n * const pts = [ {x:100,y:200}, {x:10, y:20}, ... ];\n * \n * const simplified = rdpShortestDistance(pts, 3); // Yields an array of points\n * ```\n * It is an implementation of the [Ramer Douglas Peucker algorithm](https://en.wikipedia.org/wiki/Ramer%E2%80%93Douglas%E2%80%93Peucker_algorithm)\n * by Marius Karthaus. Try the online playground: https://karthaus.nl/rdp/\n * \n * @param points \n * @param epsilon \n * @returns \n */\nexport const rdpShortestDistance = (points: Array<Point>, epsilon = 0.1): Array<Point> => {\n  const firstPoint = points[ 0 ];\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  const lastPoint = points.at(-1)!;\n  if (points.length < 3) {\n    return points;\n  }\n  let index = -1;\n  let distribution = 0;\n  for (let index_ = 1; index_ < points.length - 1; index_++) {\n    const cDistribution = distanceFromPointToLine(points[ index_ ], firstPoint, lastPoint);\n\n    if (cDistribution > distribution) {\n      distribution = cDistribution;\n      index = index_;\n    }\n  }\n  if (distribution > epsilon) {\n    // iterate\n    const l1 = points.slice(0, index + 1);\n    const l2 = points.slice(index);\n    const r1 = rdpShortestDistance(l1, epsilon);\n    const r2 = rdpShortestDistance(l2, epsilon);\n    // concat r2 to r1 minus the end/startpoint that will be the same\n    const rs = [ ...r1.slice(0, - 1), ...r2 ];//concat(r2);\n    return rs;\n  } else {\n    return [ firstPoint, lastPoint ];\n  }\n}\n\n/**\n * Simplifies a curve by dropping points based on perpendicular distance\n * \n * Values of `epsilon` approaching zero keep more of the original points.\n * Making `epsilon` larger will filter out more points, making the curve more lossy and jagged.\n * \n * ```js\n * // Source set of points that define the curve\n * const pts = [ {x:100,y:200}, {x:10, y:20}, ... ];\n * \n * const simplified = rdpShortestDistance(pts, 3); // Yields an array of points\n * ```\n * It is an implementation of the [Ramer Douglas Peucker algorithm](https://en.wikipedia.org/wiki/Ramer%E2%80%93Douglas%E2%80%93Peucker_algorithm)\n * by Marius Karthaus. Try the online playground: https://karthaus.nl/rdp/\n * \n * @param points \n * @param epsilon \n * @returns \n */\nexport const rdpPerpendicularDistance = (points: Array<Point>, epsilon = 0.1): Array<Point> => {\n  const firstPoint = points[ 0 ];\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  const lastPoint = points.at(-1)!;\n  if (points.length < 3) {\n    return points;\n  }\n  let index = -1;\n  let distribution = 0;\n  for (let index_ = 1; index_ < points.length - 1; index_++) {\n    const cDistribution = findPerpendicularDistance(points[ index_ ], firstPoint, lastPoint);\n    if (cDistribution > distribution) {\n      distribution = cDistribution;\n      index = index_;\n    }\n  }\n  if (distribution > epsilon) {\n    // iterate\n    const l1 = points.slice(0, index + 1);\n    const l2 = points.slice(index);\n    const r1 = rdpPerpendicularDistance(l1, epsilon);\n    const r2 = rdpPerpendicularDistance(l2, epsilon);\n    // concat r2 to r1 minus the end/startpoint that will be the same\n    const rs = [ ...r1.slice(0, - 1), ...r2 ];\n    return rs;\n  } else {\n    return [ firstPoint, lastPoint ];\n  }\n}\n\n\nfunction findPerpendicularDistance(p: Point, p1: Point, p2: Point) {\n  // if start and end point are on the same x the distance is the difference in X.\n  let result;\n  let slope;\n  let intercept;\n  if (p1.x == p2.x) {\n    result = Math.abs(p.x - p1.x);\n  } else {\n    slope = (p2.y - p1.y) / (p2.x - p1.x);\n    intercept = p1.y - (slope * p1.x);\n    result = Math.abs(slope * p.x - p.y + intercept) / Math.sqrt(Math.pow(slope, 2) + 1);\n  }\n\n  return result;\n}\n\n\nconst distanceFromPointToLine = (p: Point, index: Point, index_: Point) => {\n  const lineLength = distance(index, index_);//First, we need the length of the line segment.\n  if (lineLength == 0) {\t//if it's 0, the line is actually just a point.\n    return distance(p, index);\n  }\n  const t = ((p.x - index.x) * (index_.x - index.x) + (p.y - index.y) * (index_.y - index.y)) / lineLength;\n\n  //t is very important. t is a number that essentially compares the individual coordinates\n  //distances between the point and each point on the line.\n\n  if (t < 0) {\t//if t is less than 0, the point is behind i, and closest to i.\n    return distance(p, index);\n  }\t//if greater than 1, it's closest to j.\n  if (t > 1) {\n    return distance(p, index_);\n  }\n  return distance(p, { x: index.x + t * (index_.x - index.x), y: index.y + t * (index_.y - index.y) });\n}\n\n\n","import { type TraversableTree } from '../collections/tree/Types.js';\nimport * as Shapes from './shape/index.js';\nimport type { Point } from './point/PointType.js';\nimport { fromTopLeft as RectsFromTopLeft } from './rect/FromTopLeft.js';\nimport { intersectsPoint as RectsIntersectsPoint } from './rect/Intersects.js';\nimport { fromNumbers as PointsFromNumbers } from './point/From.js';\nimport type { ShapePositioned } from './shape/index.js';\nimport type { RectPositioned } from './rect/RectTypes.js';\n/**\n * Options for quad tree\n */\nexport type QuadTreeOpts = {\n  /**\n   * Maximum items per node\n   */\n  readonly maxItems: number;\n  /**\n   * Maximum level of sub-division\n   */\n  readonly maxLevels: number;\n};\n\n/**\n * Direction\n */\nexport enum Direction {\n  Nw,\n  Ne,\n  Sw,\n  Se,\n}\n\n/**\n * A Point or ShapePositioned\n */\nexport type QuadTreeItem = Point | ShapePositioned;\n\n/**\n * Creates a QuadTreeNode\n * @param bounds Bounds of region\n * @param initialData Initial items to place in quad tree\n * @param opts Options\n * @returns New quad tree\n */\nexport const quadTree = (bounds: RectPositioned, initialData: ReadonlyArray<QuadTreeItem> = [], opts: Partial<QuadTreeOpts> = {}): QuadTreeNode => {\n  const o: QuadTreeOpts = {\n    maxItems: opts.maxItems ?? 4,\n    maxLevels: opts.maxLevels ?? 4\n  };\n\n  const n = new QuadTreeNode(undefined, bounds, 0, o);\n  for (const d of initialData) {\n    n.add(d);\n  }\n  return n;\n};\n\n/**\n * QuadTreeNode. The values of the node is an array of {@link QuadTreeItem}.\n *\n * To create, you probably want the {@link quadTree} function.\n * \n */\nexport class QuadTreeNode implements TraversableTree<Array<QuadTreeItem>> {\n  #items: Array<QuadTreeItem> = [];\n  #children: Array<QuadTreeNode> = [];\n  #parent: QuadTreeNode | undefined;\n  /**\n   * Constructor\n   * @param boundary\n   * @param level\n   * @param opts\n   */\n  constructor(\n    parent: QuadTreeNode | undefined,\n    readonly boundary: RectPositioned,\n    readonly level: number,\n    readonly opts: QuadTreeOpts\n  ) {\n    this.#parent = parent;\n  }\n\n  getLengthChildren(): number {\n    return this.#children.length;\n  }\n\n  *parents(): IterableIterator<QuadTreeNode> {\n    //eslint-disable-next-line functional/no-let,@typescript-eslint/no-this-alias\n    let n: QuadTreeNode | undefined = this;\n    while (n.#parent !== undefined) {\n      yield n.#parent;\n      n = n.#parent;\n    }\n  }\n\n  getParent() {\n    return this.#parent;\n  }\n\n  /**\n   * Iterates over immediate children\n   */\n  *children(): IterableIterator<QuadTreeNode> {\n    for (const c of this.#children) {\n      yield c;\n    }\n  }\n\n  /**\n   * Array of QuadTreeItem\n   * @returns\n   */\n  getValue() {\n    return this.#items;\n  }\n\n  getIdentity() {\n    return this;\n  }\n  /**\n   * Get a descendant node in a given direction\n   * @param d\n   * @returns\n   */\n  direction(d: Direction): QuadTreeNode | undefined {\n    return this.#children[ d ] as QuadTreeNode | undefined;\n  }\n\n  /**\n   * Add an item to the quadtree\n   * @param p\n   * @returns False if item is outside of boundary, True if item was added\n   */\n  add(p: QuadTreeItem): boolean {\n    if (!Shapes.isIntersecting(this.boundary, p)) return false;\n\n    if (this.#children.length > 0) {\n      for (const d of this.#children) (d).add(p);\n      return true;\n    }\n\n    this.#items.push(p);\n\n    if (\n      this.#items.length > this.opts.maxItems &&\n      this.level < this.opts.maxLevels\n    ) {\n      if (this.#children.length === 0) {\n        this.#subdivide();\n      }\n\n      // Add to child\n      for (const item of this.#items) {\n        for (const d of this.#children) (d).add(item);\n      }\n      //this.descendants.forEach(d => (d as QuadTreeNode).add(p));\n      this.#items = [];\n    }\n    return true;\n  }\n\n  /**\n   * Returns true if point is inside node's boundary\n   * @param p\n   * @returns\n   */\n  couldHold(p: Point) {\n    return RectsIntersectsPoint(this.boundary, p);\n  }\n\n  #subdivide() {\n    const w = this.boundary.width / 2;\n    const h = this.boundary.height / 2;\n    const x = this.boundary.x;\n    const y = this.boundary.y;\n\n    // top-left corners of each of the four new sections\n    const coords = PointsFromNumbers(x + w, y, x, y, x, y + h, x + w, y + h);\n    const rects = coords.map((p) => RectsFromTopLeft(p, w, h));\n    // rects.forEach((r, index) => {\n    //   this.descendants[index] = new QuadTreeNode(r, this.level + 1, this.opts);\n    // });\n    this.#children = rects.map(\n      (r) => new QuadTreeNode(this, r, this.level + 1, this.opts)\n    );\n  }\n}\n","\nimport type { Point } from './point/PointType.js';\nimport type { Rect } from './rect/index.js';\nimport { isPoint } from './point/index.js';\nimport { isRect } from './rect/Guard.js';\nimport { Placeholder as PlaceholderRect } from './rect/Placeholder.js';\n\n/**\n * A scale function that takes an input value to scale.\n * Input can be in the form of `{ x, y }` or two number parameters.\n *\n * ```js\n * scale(10, 20);\n * scale({ x:10, y:20 });\n * ```\n *\n * Output range can be specified as a `{ width, height }` or two number parameters.\n * If omitted, the default range\n * is used.\n *\n * ```js\n * // Scale 10,20 with range w:800 h:600\n * scale(10, 20, 800, 600);\n * scale({x:10, y:20}, 800, 600);\n * scale({x:10, y:20}, {width: 800, height: 600});\n * ```\n */\nexport type Scaler = (\n  a: number | Point,\n  b?: number | Rect,\n  c?: number | Rect,\n  d?: number\n) => Point;\n\n/**\n * A scaler than can convert to a from an output range\n */\nexport type ScalerCombined = {\n  /**\n   * Relative to absolute coordinates\n   */\n  readonly abs: Scaler;\n  /**\n   * Absolute to relative coordintes\n   */\n  readonly rel: Scaler;\n\n  readonly width: number;\n\n  readonly height: number;\n\n  computeScale(): Point\n};\n\nexport type ScaleBy = `both` | `min` | `max` | `width` | `height`;\n\n/**\n * Returns a set of scaler functions, to convert to and from ranges.\n *\n * ```js\n * const scaler = Scaler.scaler(`both`, {width:window.innerWidth, height:window.innerHeight});\n * // Assuming screen of 800x400...\n * scaler.abs(400,200);          // Yields { x:0.5, y:0.5 }\n * scaler.abs({ x:400, y:200 }); // Yields { x:0.5, y:0.5 }\n *\n * scaler.rel(0.5, 0.5);         // Yields: { x:400, y:200 }\n * scaler.rel({ x:0.5, y:0.5 }); // Yields: { x:400, y:200 }\n * ```\n *\n * If no default range is provided, it must be given each time the scale function is used.\n *\n * ```js\n * const scaler = Scaler.scaler(`both`);\n *\n * scaler.abs(400, 200, 800, 400);\n * scaler.abs(400, 200, { width: 800, height: 400 });\n * scaler.abs({ x:400, y: 200}, { width: 800, height: 400 });\n * scaler.abs({ x:400, y: 200}, 800, 400);\n * // All are the same, yielding { x:0.5, y:0.5 }\n *\n * scaler.abs(400, 200); // Throws an exception because there is no scale\n * ```\n * @param scaleBy Dimension to scale by\n * @param defaultRect Default range\n * @returns\n */\nexport const scaler = (\n  scaleBy: ScaleBy = `both`,\n  defaultRect?: Rect\n): ScalerCombined => {\n  const defaultBounds = defaultRect ?? PlaceholderRect;\n\n  let sw = 1;\n  let sh = 1;\n  let s = { x: 1, y: 1 };\n\n  const computeScale = () => {\n    switch (scaleBy) {\n      case `height`: {\n        return { x: sh, y: sh };\n      }\n      case `width`: {\n        return { x: sw, y: sw };\n      }\n      case `min`: {\n        return { x: Math.min(sw, sh), y: Math.min(sw, sh) };\n      }\n      case `max`: {\n        return { x: Math.max(sw, sh), y: Math.max(sw, sh) };\n      }\n      default: {\n        return { x: sw, y: sh };\n      }\n    }\n  };\n\n  const normalise = (\n    a: number | Point,\n    b?: number | Rect,\n    c?: number | Rect,\n    d?: number\n  ): [ x: number, y: number, w: number, h: number ] => {\n    let inX = Number.NaN;\n    let inY = Number.NaN;\n    let outW = defaultBounds.width;\n    let outH = defaultBounds.height;\n\n    if (typeof a === `number`) {\n      inX = a;\n      if (typeof b === `number`) {\n        inY = b;\n        if (c === undefined) return [ inX, inY, outW, outH ];\n        if (isRect(c)) {\n          outW = c.width;\n          outH = c.height;\n        } else if (typeof c === `number`) {\n          outW = c;\n          if (typeof d === `number`) {\n            outH = d;\n          } else {\n            throw new TypeError(`Missing final height value`);\n          }\n        } else throw new Error(`Missing valid output range`);\n      } else if (isRect(b)) {\n        outW = b.width;\n        outH = b.height;\n      } else {\n        throw new Error(\n          `Expected input y or output Rect to follow first number parameter`\n        );\n      }\n    } else if (isPoint(a)) {\n      inX = a.x;\n      inY = a.y;\n      if (b === undefined) return [ inX, inY, outW, outH ];\n      if (isRect(b)) {\n        outW = b.width;\n        outH = b.height;\n      } else if (typeof b === `number`) {\n        outW = b;\n        if (typeof c === `number`) {\n          outH = c;\n        } else {\n          throw new TypeError(\n            `Expected height as third parameter after Point and output width`\n          );\n        }\n      } else {\n        throw new TypeError(\n          `Expected Rect or width as second parameter when first parameter is a Point`\n        );\n      }\n    } else {\n      throw new Error(`Expected input Point or x value as first parameter`);\n    }\n    return [ inX, inY, outW, outH ];\n  };\n\n  const scaleAbs = (\n    a: number | Point,\n    b?: number | Rect,\n    c?: number | Rect,\n    d?: number\n  ): Point => {\n    const n = normalise(a, b, c, d);\n    return scaleNormalised(true, ...n);\n  };\n\n  const scaleRel = (\n    a: number | Point,\n    b?: number | Rect,\n    c?: number | Rect,\n    d?: number\n  ): Point => {\n    const n = normalise(a, b, c, d);\n    return scaleNormalised(false, ...n);\n  };\n\n  const scaleNormalised = (\n    abs: boolean,\n    x: number,\n    y: number,\n    w: number,\n    h: number\n  ): Point => {\n    if (Number.isNaN(w)) throw new Error(`Output width range missing`);\n    if (Number.isNaN(h)) throw new Error(`Output height range missing`);\n\n    // If output dimensions has changed since last, create a new scale\n    if (w !== sw || h !== sh) {\n      sw = w;\n      sh = h;\n      s = computeScale();\n    }\n\n    return abs ? {\n      x: x * s.x,\n      y: y * s.y,\n    } : {\n      x: x / s.x,\n      y: y / s.y,\n    };\n  };\n\n  return {\n    computeScale,\n    rel: scaleRel,\n    abs: scaleAbs,\n    width: defaultBounds.width,\n    height: defaultBounds.height\n  };\n};\n\n// export const scalerReactive = (scaleBy: ScaleBy = `both`,\n//   defaultRect?: ReactiveInitial<Rect>) => {\n\n//   const resolve = (a: Point | Rect | RectPositioned | number, b: Rect | number, c: number, d: number) => {\n//     if (typeof a === `number`) {\n//       if (typeof b === `number`) {\n//         return { x: a, y: b, width: undefined, height: undefined }\n//       } else {\n//         throw new TypeError(`Expected 'b' parameter to be the y value?`);\n//       }\n//     } else if (isPoint(a)) {\n//       if (isRect(b)) {\n//         // Positioned rect\n//         return {\n//           x: \n//       }\n//       }\n//     }\n//   }","export const Placeholder = Object.freeze({\n  width: Number.NaN,\n  height: Number.NaN,\n});\nexport const PlaceholderPositioned = Object.freeze({\n  x: Number.NaN,\n  y: Number.NaN,\n  width: Number.NaN,\n  height: Number.NaN,\n});\n","import { type Rgb } from '../visual/Colour.js';\nimport * as ImageDataGrid from '../visual/ImageDataGrid.js';\nimport * as Grids from './Grid.js';\n\nexport type Kernel = ReadonlyArray<ReadonlyArray<number>>;\nexport type CellWithValue<V> = readonly [ cell: Grids.Cell, value: V | undefined ];\nexport type ScalarAndValue<V> = readonly [ scalar: number, v: V | undefined ];\nexport type KernelCompute = <V>(offset: Grids.Cell, value: V) => V;\nexport type KernelReduce<V> = (values: ReadonlyArray<ScalarAndValue<V>>) => V | undefined;\n\n/**\n * Multiply every element of kernel by the same `scalar` value.\n * Returns new result, input is unmodified\n * @param kernel \n * @param scalar \n * @returns \n */\nexport const multiply = (kernel: Kernel, scalar: number): Kernel => {\n  const rows = kernel.length;\n  const cols = kernel[ 0 ].length;\n  const copy: Array<Array<number>> = [];\n  //eslint-disable-next-line functional/no-let\n  for (let row = 0; row < rows; row++) {\n    //eslint-disable-next-line functional/immutable-data\n    copy[ row ] = [];\n    //eslint-disable-next-line functional/no-let\n    for (let col = 0; col < cols; col++) {\n      //eslint-disable-next-line functional/immutable-data\n      copy[ row ][ col ] = kernel[ row ][ col ] * scalar;\n    }\n  }\n  return copy;\n};\n\n\nexport function convolveCell<V>(c: Grids.Cell, kernel: Kernel2dArray, source: Grids.Grid, access: Grids.CellAccessor<V>, reduce: KernelReduce<V>): V | undefined {\n  const valuesAtKernelPos: Array<ScalarAndValue<V>> = kernel.map(o => {\n    const pos = Grids.offset(source, c, o[ 0 ], `stop`); // `stop` avoids fringing at extents of image\n    if (!pos) return [ o[ 1 ], undefined ];\n    return [ o[ 1 ], access(pos, `undefined`) ];\n  });\n  return reduce(valuesAtKernelPos);\n}\n\n/**\n * Performs kernel-based convolution over `image`.\n * @param kernel \n * @param image \n */\nexport function* convolveImage(kernel: Kernel, image: ImageData) {\n  const grid = { rows: image.width, cols: image.height };\n  const imageDataAsGrid = ImageDataGrid.accessor(image);\n\n  yield* convolve(kernel, grid, imageDataAsGrid, Grids.cells(grid), rgbReducer);\n}\n\nexport function* convolve<V>(kernel: Kernel, source: Grids.Grid, access: Grids.CellAccessor<V>, visitor: Grids.VisitGenerator, reduce: KernelReduce<V>, origin?: Grids.Cell): IterableIterator<CellWithValue<V>> {\n\n  //const wrap:Grids.BoundsLogic = `undefined`;\n  // Use middle, eg 3x3 = 1,1\n  if (!origin) {\n    const kernelRows = kernel.length;\n    const kernelCols = kernel[ 0 ].length;\n    origin = { x: Math.floor(kernelRows / 2), y: Math.floor(kernelCols / 2) };\n  }\n\n  const asArray = kernel2dToArray(kernel, origin);\n  for (const c of visitor) {\n    const v = convolveCell<V>(c, asArray, source, access, reduce);\n    yield [ c, v ];\n  }\n}\n\nexport type Kernel2dArray = ReadonlyArray<readonly [ cell: Grids.Cell, value: number ]>;\n\n/**\n * For a given kernel, returns an array of offsets. These\n * consist of a cell offset (eg `{x:-1,y:-1}`) and the value at that kernel position.\n * @param kernel \n * @param origin \n * @returns \n */\nexport const kernel2dToArray = (kernel: Kernel, origin?: Grids.Cell): Kernel2dArray => {\n  const offsets: Kernel2dArray = [];\n  const rows = kernel.length;\n  const cols = kernel[ 0 ].length;\n  if (!origin) origin = { x: Math.floor(rows / 2), y: Math.floor(cols / 2) };\n\n  //eslint-disable-next-line functional/no-let\n  for (let xx = 0; xx < rows; xx++) {\n    //eslint-disable-next-line functional/no-let\n    for (let yy = 0; yy < cols; yy++) {\n      //eslint-disable-next-line functional/immutable-data\n      // @ts-expect-error\n      offsets.push([ { x: xx - origin.x, y: yy - origin.y }, kernel[ xx ][ yy ] ]);\n    }\n  }\n  return offsets;\n};\n\nexport const rgbReducer: KernelReduce<Rgb> = (values: ReadonlyArray<ScalarAndValue<Rgb>>) => {\n  //eslint-disable-next-line functional/no-let\n  let r = 0;\n  //eslint-disable-next-line functional/no-let\n  let g = 0;\n  //eslint-disable-next-line functional/no-let\n  let b = 0;\n  //eslint-disable-next-line functional/no-let\n  const opacity = 0;\n  //eslint-disable-next-line functional/no-let\n  for (const value of values) {\n    const rgb = value[ 1 ];\n    const scale = value[ 0 ];\n    if (rgb === undefined) continue;\n    if (rgb.opacity === 0) continue;\n    if (scale === 0) continue;\n    r += (rgb.r * scale);\n    g += (rgb.g * scale);\n    b += (rgb.b * scale);\n    //opacity += ((rgb.opacity ?? 1) * scale);\n  }\n\n  const result = {\n    r: r,\n    g: g,\n    b: b,\n    opacity: 255,\n    space: `srgb`\n  } as const;\n  return result;\n};\nexport const identityKernel = [\n  [ 0, 0, 0 ],\n  [ 0, 1, 0 ],\n  [ 0, 0, 0 ]\n];\n\n\nexport const edgeDetectionKernel = [\n  [ 0, -1, 0 ],\n  [ -1, 4, -1 ],\n  [ 0, -1, 0 ]\n];\n\nexport const sharpenKernel = [\n  [ 0, -1, 0 ],\n  [ -1, 5, -1 ],\n  [ 0, -1, 0 ]\n];\n\nexport const boxBlurKernel = multiply([\n  [ 1, 1, 1 ],\n  [ 1, 1, 1 ],\n  [ 1, 1, 1 ]\n], 1 / 9);\n\nexport const gaussianBlur3Kernel = multiply([\n  [ 1, 2, 1 ],\n  [ 2, 4, 2 ],\n  [ 1, 2, 1 ]\n], 1 / 16);\n\nexport const gaussianBlur5Kernel = multiply([\n  [ 1, 4, 6, 4, 1 ],\n  [ 4, 16, 24, 16, 4 ],\n  [ 6, 24, 36, 24, 6 ],\n  [ 4, 16, 24, 16, 4 ],\n  [ 1, 4, 6, 4, 1 ],\n], 1 / 256);\n\nexport const unsharpMasking5Kernel = multiply([\n  [ 1, 4, 6, 4, 1 ],\n  [ 4, 16, 24, 16, 4 ],\n  [ 6, 24, -476, 24, 6 ],\n  [ 4, 16, 24, 16, 4 ],\n  [ 1, 4, 6, 4, 1 ],\n], -1 / 256);","import * as Grids from '../geometry/Grid.js';\nimport type { Rgb } from './Colour.js';\n\n/**\n * Returns a function that accesses pixel values by x,y\n * @param image \n * @returns \n */\nexport const accessor = (image: ImageData): Grids.CellAccessor<Rgb> => {\n  const grid = { rows: image.width, cols: image.height };\n  const data = image.data;\n\n  const fn: Grids.CellAccessor<Rgb> = (cell: Grids.Cell, bounds) => {\n    const index = Grids.indexFromCell(grid, cell, bounds);\n    if (index === undefined) {\n      return undefined;\n    }\n    const pxIndex = index * 4;\n    return {\n      r: data[ pxIndex ],\n      g: data[ pxIndex + 1 ],\n      b: data[ pxIndex + 2 ],\n      opacity: data[ pxIndex + 3 ],\n      space: `srgb`\n    };\n  };\n  return fn;\n};\n\n\n/**\n * Yields pixels of an image row by row\n * @param image \n */\nexport function* byRow(image: ImageData) {\n  const a = accessor(image);\n  const grid = { rows: image.width, cols: image.height };\n\n  for (let y = 0; y < grid.rows; y++) {\n    let row: Rgb[] = [];\n    for (let x = 0; x < grid.cols; x++) {\n      const p = a({ x, y }, `undefined`);\n      if (p) row.push(p);\n    }\n    yield row;\n  }\n}\n\n/**\n * Yields pixels of an image column by column\n * @param image \n */\nexport function* byColumn(image: ImageData) {\n  const a = accessor(image);\n  const grid = { rows: image.width, cols: image.height };\n\n  for (let x = 0; x < grid.cols; x++) {\n    let col: Rgb[] = [];\n    for (let y = 0; y < grid.rows; y++) {\n      const p = a({ x, y }, `undefined`);\n      if (p) col.push(p);\n    }\n    yield col;\n  }\n}","import { degreeToRadian } from '../Angles.js';\nimport { guard as guardPoint, isPoint } from '../point/Guard.js';\nimport { distance as pointsDistance } from '../point/Distance.js';\nimport { bbox as pointsBbox } from '../point/Bbox.js';\nimport { toCartesian } from '../Polar.js';\nimport type { Point } from '../point/PointType.js';\nimport type { Line } from '../line/LineType.js';\nimport type { Path } from '../path/index.js';\nimport type { Rect, RectPositioned } from '../rect/index.js';\nimport { fromPoints as LinesFromPoints } from '../line/FromPoints.js';\nimport type { Arc, ArcPositioned } from './ArcType.js';\n\nexport type * from './ArcType.js';\n\n/**\n * Returns true if parameter is an arc\n * @param p Arc or number\n * @returns \n */\nexport const isArc = (p: unknown): p is Arc => (p as Arc).startRadian !== undefined && (p as Arc).endRadian !== undefined;\n\n/**\n * Returns true if parameter has a positioned (x,y) \n * @param p Point, Arc or ArcPositiond\n * @returns \n */\nexport const isPositioned = (p: Point | Arc | ArcPositioned): p is Point => (p as Point).x !== undefined && (p as Point).y !== undefined;\n\nconst piPi = Math.PI * 2;\n\n/**\n * Returns an arc from degrees, rather than radians\n * @param radius Radius of arc\n * @param startDegrees Start angle in degrees\n * @param endDegrees End angle in degrees\n * @returns Arc\n */\nexport function fromDegrees(radius: number, startDegrees: number, endDegrees: number): Arc;\n\n/**\n * Returns an arc from degrees, rather than radians\n * @param radius Radius of arc\n * @param startDegrees Start angle in degrees\n * @param endDegrees End angle in degrees\n * @param origin Optional center of arc\n * @returns Arc\n */export function fromDegrees(radius: number, startDegrees: number, endDegrees: number, origin: Point): ArcPositioned\n\n/**\n * Returns an arc from degrees, rather than radians\n * @param radius Radius of arc\n * @param startDegrees Start angle in degrees\n * @param endDegrees End angle in degrees\n * @param origin Optional center of arc\n * @returns Arc\n */\n//eslint-disable-next-line func-style\nexport function fromDegrees(radius: number, startDegrees: number, endDegrees: number, origin?: Point): Arc | ArcPositioned {\n  const a: Arc = {\n    radius,\n    startRadian: degreeToRadian(startDegrees),\n    endRadian: degreeToRadian(endDegrees)\n  };\n  if (isPoint(origin)) {\n    guardPoint(origin);\n    const ap: ArcPositioned = {\n      ...a,\n      x: origin.x,\n      y: origin.y\n    };\n    return Object.freeze(ap);\n  } else {\n    return Object.freeze(a);\n  }\n}\n\n/**\n * Returns a {@link Geometry.Line} linking the start and end points of an {@link ArcPositioned}.\n *\n * @param arc\n * @returns Line from start to end of arc\n */\nexport const toLine = (arc: ArcPositioned): Line => LinesFromPoints(\n  point(arc, arc.startRadian),\n  point(arc, arc.endRadian)\n);\n\n/**\n * Calculates a coordinate on an arc, based on an angle\n * @param arc Arc\n * @param angleRadian Angle of desired coordinate \n * @param origin Origin of arc (0,0 used by default)\n * @returns Coordinate\n */\nexport const point = (arc: Arc | ArcPositioned, angleRadian: number, origin?: Point): Point => {\n  if (angleRadian > arc.endRadian) throw new Error(`angleRadian beyond end angle of arc`);\n  if (angleRadian < arc.startRadian) throw new Error(`angleRadian beyond start angle of arc`);\n\n  if (origin === undefined) {\n    origin = isPositioned(arc) ? arc : { x: 0, y: 0 };\n  }\n  return {\n    x: (Math.cos(angleRadian) * arc.radius) + origin.x,\n    y: (Math.sin(angleRadian) * arc.radius) + origin.y\n  };\n};\n\n/**\n * Throws an error if arc instance is invalid\n * @param arc \n */\nexport const guard = (arc: Arc | ArcPositioned) => {\n  if (arc === undefined) throw new Error(`Arc is undefined`);\n  if (isPositioned(arc)) {\n    guardPoint(arc, `arc`);\n  }\n  if (arc.radius === undefined) throw new Error(`Arc radius is undefined (${ JSON.stringify(arc) })`);\n  if (typeof arc.radius !== `number`) throw new Error(`Radius must be a number`);\n  if (Number.isNaN(arc.radius)) throw new Error(`Radius is NaN`);\n  if (arc.radius <= 0) throw new Error(`Radius must be greater than zero`);\n\n  if (arc.startRadian === undefined) throw new Error(`Arc is missing 'startRadian' field`);\n  if (arc.endRadian === undefined) throw new Error(`Arc is missing 'startRadian' field`);\n  if (Number.isNaN(arc.endRadian)) throw new Error(`Arc endRadian is NaN`);\n  if (Number.isNaN(arc.startRadian)) throw new Error(`Arc endRadian is NaN`);\n\n  if (arc.startRadian >= arc.endRadian) throw new Error(`startRadian is expected to be les than endRadian`);\n};\n\n\ntype Interpolate = {\n  (amount: number, arc: Arc, origin: Point): Point;\n  (amount: number, arc: ArcPositioned): Point;\n};\n\n/**\n * Compute relative position on arc\n * @param arc Arc\n * @param amount Relative position 0-1\n * @param origin If arc is not positioned, pass in an origin\n * @returns \n */\nexport const interpolate: Interpolate = (amount: number, arc: ArcPositioned | Arc, origin?: Point): Point => {\n  guard(arc);\n  return point(arc, arc.startRadian + ((arc.endRadian - arc.startRadian) * amount), origin);\n};\n\n/**\n * Creates a {@link Geometry.Path} instance from the arc. This wraps up some functions for convienence.\n * @param arc \n * @returns Path\n */\nexport const toPath = (arc: ArcPositioned): Path => {\n  guard(arc);\n\n  return Object.freeze({\n    ...arc,\n    nearest: (point: Point) => { throw new Error(`not implemented`); },\n    interpolate: (amount: number) => interpolate(amount, arc),\n    bbox: () => bbox(arc) as RectPositioned,\n    length: () => length(arc),\n    toSvgString: () => toSvg(arc),\n    relativePosition: (_point: Point, _intersectionThreshold: number) => {\n      throw new Error(`Not implemented`)\n    },\n    distanceToPoint: (_point: Point): number => {\n      throw new Error(`Not implemented`)\n    },\n    kind: `arc`\n  });\n};\n\n/**\n * Calculates the length of the arc\n * @param arc \n * @returns Length\n */\nexport const length = (arc: Arc): number => piPi * arc.radius * ((arc.startRadian - arc.endRadian) / piPi);\n\n/**\n * Calculates a {@link Geometry.Rect | Rect} bounding box for arc.\n * @param arc \n * @returns Rectangle encompassing arc.\n */\nexport const bbox = (arc: ArcPositioned | Arc): RectPositioned | Rect => {\n  if (isPositioned(arc)) {\n    const middle = interpolate(0.5, arc);\n    const asLine = toLine(arc);\n    return pointsBbox(middle, asLine.a, asLine.b);\n  } else {\n    return {\n      width: arc.radius * 2,\n      height: arc.radius * 2\n    };\n  }\n};\n\n\ntype ToSvg = {\n  /**\n   * SVG path for arc description\n   * @param origin Origin of arc\n   * @param radius Radius\n   * @param startRadian Start\n   * @param endRadian End\n   */\n  (origin: Point, radius: number, startRadian: number, endRadian: number, opts?: SvgOpts): ReadonlyArray<string>;\n  /**\n   * SVG path for non-positioned arc\n   */\n  (arc: Arc, origin: Point, opts?: SvgOpts): ReadonlyArray<string>;\n  /**\n   * SVG path for positioned arc\n   */\n  (arc: ArcPositioned, opts?: SvgOpts): ReadonlyArray<string>;\n};\n\n\n/**\n * Creates an SV path snippet for arc\n * @returns \n */\n// eslint-disable-next-line unicorn/prevent-abbreviations\nexport const toSvg: ToSvg = (a: Point | Arc | ArcPositioned, b?: number | Point | SvgOpts, c?: number | SvgOpts, d?: number, e?: SvgOpts) => {\n  if (isArc(a)) {\n    if (isPositioned(a)) {\n      return toSvgFull(a, a.radius, a.startRadian, a.endRadian, b as SvgOpts);\n    } else {\n      return isPoint(b) ? toSvgFull(b, a.radius, a.startRadian, a.endRadian, c as SvgOpts) : toSvgFull({ x: 0, y: 0 }, a.radius, a.startRadian, a.endRadian);\n    }\n  } else {\n    if (c === undefined) throw new Error(`startAngle undefined`);\n    if (d === undefined) throw new Error(`endAngle undefined`);\n\n    if (isPoint(a)) {\n      if (typeof b === `number` && typeof c === `number` && typeof d === `number`) {\n        return toSvgFull(a, b, c, d, e);\n      } else {\n        throw new TypeError(`Expected (point, number, number, number). Missing a number param.`);\n      }\n    } else {\n      throw new Error(`Expected (point, number, number, number). Missing first point.`);\n    }\n  }\n};\n\nexport type SvgOpts = {\n\n  /**\n   * \"If the arc should be greater or less than 180 degrees\"\n   * ie. tries to maximise arc length\n   */\n  readonly largeArc?: boolean\n\n  /**\n   * \"If the arc should begin moving at positive angles\"\n   * ie. the kind of bend it makes to reach end point\n   */\n  readonly sweep?: boolean\n}\n\nconst toSvgFull = (origin: Point, radius: number, startRadian: number, endRadian: number, opts?: SvgOpts): ReadonlyArray<string> => {\n  // https://developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Paths\n  // A rx ry x-axis-rotation large-arc-flag sweep-flag x y\n  // a rx ry x-axis-rotation large-arc-flag sweep-flag dx dy\n\n  if (opts === undefined || typeof opts !== `object`) opts = {};\n\n  const isFullCircle = endRadian - startRadian === 360;\n  const start = toCartesian(radius, endRadian - 0.01, origin);\n  const end = toCartesian(radius, startRadian, origin);\n\n  const { largeArc = false, sweep = false } = opts;\n\n  const d = [ `\n    M ${ start.x } ${ start.y }\n    A ${ radius } ${ radius } 0 ${ largeArc ? `1` : `0` } ${ sweep ? `1` : `0` } ${ end.x } ${ end.y },\n  `];\n\n  //eslint-disable-next-line functional/immutable-data\n  if (isFullCircle) d.push(`z`);\n\n  return d;\n};\n\n/**\n * Calculates the distance between the centers of two arcs\n * @param a\n * @param b \n * @returns Distance \n */\nexport const distanceCenter = (a: ArcPositioned, b: ArcPositioned): number => pointsDistance(a, b);\n\n/**\n * Returns true if the two arcs have the same values\n *\n * ```js\n * const arcA = { radius: 5, endRadian: 0, startRadian: 1 };\n * const arcA = { radius: 5, endRadian: 0, startRadian: 1 };\n * arcA === arcB; // false, because object identities are different\n * Arcs.isEqual(arcA, arcB); // true, because values are identical\n * ```\n * @param a\n * @param b\n * @returns {boolean}\n */\nexport const isEqual = (a: Arc | ArcPositioned, b: Arc | ArcPositioned): boolean => {\n  if (a.radius !== b.radius) return false;\n\n  if (isPositioned(a) && isPositioned(b)) {\n    if (a.x !== b.x) return false;\n    if (a.y !== b.y) return false;\n    if (a.z !== b.z) return false;\n    return true;\n  } else if (!isPositioned(a) && !isPositioned(b)) {\n    // no-op\n  } else return false; // one is positioned one not\n\n  if (a.endRadian !== b.endRadian) return false;\n  if (a.startRadian !== b.startRadian) return false;\n  return true;\n};","import type { Line } from './line/LineType.js';\nimport type { Point } from './point/PointType.js';\nimport { normalise as PointsNormalise } from './point/Normalise.js';\nimport { isPoint } from './point/Guard.js';\n//import * as Points from './point/index.js'\nimport * as Polar from './Polar.js';\nimport type { Vector } from './Types.js';\nimport { divide as PointDivide } from './point/Divider.js';\nimport { guard as LinesGuard } from './line/Guard.js';\nimport { sum as PointsSum } from './point/Sum.js';\nimport { subtract as PointsSubtract } from './point/index.js';\nimport { multiply as PointsMultiply } from './point/Multiply.js';\nimport { dotProduct as PointsDotProduct } from './point/DotProduct.js';\nimport { toString as PointsToString } from './point/To.js';\nimport { clampMagnitude as PointsClampMagnitude } from './point/Magnitude.js';\nimport { distance as PointsDistance } from './point/Distance.js';\nimport { Empty as PointEmpty } from './point/Empty.js';\n//eslint-disable-next-line @typescript-eslint/naming-convention\nconst EmptyCartesian = Object.freeze({ x: 0, y: 0 });\n\nconst piPi = Math.PI * 2;\nconst pi = Math.PI;\n\n// const Q1 = Math.PI / 2;\n// const Q2 = Math.PI;\n// const Q3 = Q1 + Q2;\n// const Q4 = Math.PI * 2;\n\nexport const fromRadians = (radians: number) => {\n  return Object.freeze({\n    x: Math.cos(radians),\n    y: Math.sin(radians)\n  });\n}\n\nexport const toRadians = (point: Point) => {\n  return Math.atan2(point.y, point.x);\n}\n/**\n * Create a vector from a point\n *\n * If `unipolar` normalisation is used, direction will be fixed to 0..2π\n * if `bipolar` normalisation is used, direction will be fixed to -π...π\n * @param pt Point\n * @param angleNormalisation Technique to normalise angle\n * @param origin Origin to calculate vector from or 0,0 if left empty\n * @returns\n */\nexport const fromPointPolar = (\n  pt: Point,\n  angleNormalisation: `` | `unipolar` | `bipolar` = ``,\n  origin: Point = EmptyCartesian\n): Polar.Coord => {\n  pt = PointsSubtract(pt, origin);\n\n  //eslint-disable-next-line functional/no-let\n  let direction = Math.atan2(pt.y, pt.x);\n  if (angleNormalisation === `unipolar` && direction < 0) direction += piPi;\n  else if (angleNormalisation === `bipolar`) {\n    if (direction > pi) direction -= piPi;\n    else if (direction <= -pi) direction += piPi;\n  }\n\n  return Object.freeze({\n    distance: PointsDistance(pt),\n    angleRadian: direction,\n  });\n};\n\n/**\n * Returns a Cartesian-coordinate vector from a line a -> b\n * @param line\n * @returns\n */\nexport const fromLineCartesian = (line: Line): Point =>\n  PointsSubtract(line.b, line.a);\n\n/**\n * Returns a polar-coordinate vector from a line a -> b\n * @param line\n * @returns\n */\nexport const fromLinePolar = (line: Line): Polar.Coord => {\n  LinesGuard(line, `line`);\n  const pt = PointsSubtract(line.b, line.a);\n  return fromPointPolar(pt);\n};\n\nconst isPolar = (v: Vector): v is Polar.Coord => {\n  if (Polar.isPolarCoord(v)) return true;\n  return false;\n};\n\nconst isCartesian = (v: Vector): v is Point => {\n  if (isPoint(v)) return true;\n  return false;\n};\n\n/**\n * Returns the normalised vector (aka unit vector). This is where\n * direction is kept, but magnitude set to 1. This then just\n * suggests direction.\n * @param v\n * @returns\n */\nexport const normalise = (v: Vector): Vector => {\n  if (isPolar(v)) {\n    return Polar.normalise(v);\n  } else if (isCartesian(v)) {\n    return PointsNormalise(v);\n  }\n  // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n  throw new Error(`Expected polar/cartesian vector. Got: ${ v }`);\n};\n\nexport const quadrantOffsetAngle = (p: Point): number => {\n  if (p.x >= 0 && p.y >= 0) return 0; // Q1\n  if (p.x < 0 && p.y >= 0) return pi; // Q2\n  if (p.x < 0 && p.y < 0) return pi; // Q3\n  return piPi; // Q4\n};\n\n/**\n * Converts a vector to a polar coordinate. If the provided\n * value is already Polar, it is returned.\n * @param v\n * @param origin\n * @returns Polar vector\n */\nexport const toPolar = (v: Vector, origin = PointEmpty): Polar.Coord => {\n  if (isPolar(v)) {\n    return v;\n  } else if (isCartesian(v)) {\n    return Polar.fromCartesian(v, origin);\n  }\n  // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n  throw new Error(`Expected polar/cartesian vector. Got: ${ v }`);\n};\n\n/**\n * Converts a Vector to a Cartesian coordinate. If the provided\n * value is already Cartesian, it is returned.\n * @param v\n * @returns Cartestian vector\n */\nexport const toCartesian = (v: Vector): Point => {\n  if (isPolar(v)) {\n    return Polar.toPoint(v);\n  } else if (isCartesian(v)) {\n    return v;\n  }\n  // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n  throw new Error(`Expected polar/cartesian vector. Got: ${ v }`);\n};\n\n/**\n * Return a human-friendly representation of vector\n * @param v\n * @param digits\n * @returns\n */\nexport const toString = (v: Vector, digits?: number) => {\n  if (isPolar(v)) {\n    return Polar.toString(v, digits);\n  } else if (isCartesian(v)) {\n    return PointsToString(v, digits);\n  }\n  // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n  throw new Error(`Expected polar/cartesian vector. Got: ${ v }`);\n};\n\n/**\n * Calculate dot product of a vector\n * @param a\n * @param b\n * @returns\n */\nexport const dotProduct = (a: Vector, b: Vector) => {\n  if (isPolar(a) && isPolar(b)) {\n    return Polar.dotProduct(a, b);\n  } else if (isCartesian(a) && isCartesian(b)) {\n    return PointsDotProduct(a, b);\n  }\n  throw new Error(`Expected two polar/Cartesian vectors.`);\n};\n\n/**\n * Clamps the magnitude of a vector\n * @param v Vector to clamp\n * @param max Maximum magnitude\n * @param min Minium magnitude\n * @returns\n */\nexport const clampMagnitude = (v: Vector, max = 1, min = 0) => {\n  if (isPolar(v)) {\n    return Polar.clampMagnitude(v, max, min);\n  } else if (isCartesian(v)) {\n    return PointsClampMagnitude(v, max, min);\n  }\n  throw new Error(`Expected either polar or Cartesian vector`);\n};\n\n/**\n * Returns `a + b`.\n *\n * Vector is returned in the same type as `a`.\n * @param a\n * @param b\n * @returns\n */\nexport const sum = (a: Vector, b: Vector) => {\n  const polar = isPolar(a);\n  a = toCartesian(a);\n  b = toCartesian(b);\n  const c = PointsSum(a, b);\n  return polar ? toPolar(c) : c;\n};\n\n/**\n * Returns `a - b`.\n *\n * Vector is returned in the same type as `a`\n * @param a\n * @param b\n */\nexport const subtract = (a: Vector, b: Vector) => {\n  const polar = isPolar(a);\n  a = toCartesian(a);\n  b = toCartesian(b);\n  const c = PointsSubtract(a, b);\n  return polar ? toPolar(c) : c;\n};\n\n/**\n * Returns `a * b`.\n *\n * Vector is returned in the same type `a`.\n * @param a\n * @param b\n */\nexport const multiply = (a: Vector, b: Vector) => {\n  const polar = isPolar(a);\n  a = toCartesian(a);\n  b = toCartesian(b);\n  const c = PointsMultiply(a, b);\n  return polar ? toPolar(c) : c;\n};\n\n/**\n * Returns `a / b`.\n *\n * Vector is returned in the same type `a`.\n * @param a\n * @param b\n */\nexport const divide = (a: Vector, b: Vector) => {\n  const polar = isPolar(a);\n  a = toCartesian(a);\n  b = toCartesian(b);\n  const c = PointDivide(a, b);\n  return polar ? toPolar(c) : c;\n};\n","import type { Point, Point3d } from './point/PointType.js';\nimport type { Circle, CirclePositioned } from './circle/CircleType.js';\nimport type { Sphere } from './shape/index.js';\n\nimport { toPositioned as circleToPositioned } from './circle/ToPositioned.js';\nimport { scale } from '../numbers/Scale.js';\nimport { linearSpace } from '../numbers/LinearSpace.js';\nconst cos = Math.cos;\nconst sin = Math.sin;\nconst asin = Math.asin;\nconst sqrt = Math.sqrt;\nconst pow = Math.pow;\nconst pi = Math.PI;\nconst piPi = Math.PI * 2;\nconst goldenAngle = pi * (3 - sqrt(5));\nconst goldenSection = (1 + sqrt(5)) / 2;\n\n/**\n * Options for a Vogel spiral\n */\nexport type VogelSpiralOpts = {\n  /**\n   * Upper limit of points to produce.\n   * By default, 5000.\n   */\n  readonly maxPoints?: number;\n  /**\n   * Density value (0..1) which determines spacing of points.\n   * This is useful because it scales with whatever circle radius is given\n   * Use this parameter OR the `spacing` parameter.\n   */\n  readonly density?: number;\n  /**\n   * Spacing between points.\n   * Use this option OR the density value.\n   */\n  readonly spacing?: number;\n  /**\n   * Rotation offset to apply, in radians. 0 by default\n   */\n  readonly rotation?: number;\n};\n\n/**\n * Generates points on a Vogel spiral - a sunflower-like arrangement of points.\n *\n * @example With no arguments, assumes a unit circle\n * ```js\n * for (const pt of circleVogelSpiral()) {\n *  // Generate points on a unit circle, with 95% density\n * }\n * ```\n *\n *\n * @example Specifying a circle and options\n * ```js\n * const circle = { radius: 100, x: 100, y: 100 };\n * const opts = {\n *  maxPoints: 50,\n *  density: 0.99\n * };\n * for (const pt of circleVogelSpiral(circle, opts)) {\n *  // Do something with point...\n * }\n * ```\n *\n * @example Array format\n * ```js\n * const ptsArray = [...circleVogelSpiral(circle, opts)];\n * ```\n * @param circle\n * @param opts\n */\nexport function* circleVogelSpiral(\n  circle?: Circle,\n  opts: VogelSpiralOpts = {}\n): IterableIterator<Point> {\n  const maxPoints = opts.maxPoints ?? 5000;\n  const density = opts.density ?? 0.95;\n  const rotationOffset = opts.rotation ?? 0;\n\n  const c = circleToPositioned(circle ?? { radius: 1, x: 0, y: 0 });\n  const max = c.radius;\n  //eslint-disable-next-line functional/no-let\n  let spacing = c.radius * scale(density, 0, 1, 0.3, 0.01);\n  if (opts.spacing) spacing = opts.spacing;\n\n  //eslint-disable-next-line functional/no-let\n  let radius = 0;\n  //eslint-disable-next-line functional/no-let\n  let count = 0;\n  //eslint-disable-next-line functional/no-let\n  let angle = 0;\n  while (count < maxPoints && radius < max) {\n    radius = spacing * count ** 0.5;\n    angle = rotationOffset + (count * 2 * pi) / goldenSection;\n    yield Object.freeze({\n      x: c.x + radius * cos(angle),\n      y: c.y + radius * sin(angle),\n    });\n    count++;\n  }\n}\n\nexport type CircleRingsOpts = {\n  readonly rings?: number;\n  /**\n   * Rotation offset, in radians\n   */\n  readonly rotation?: number;\n};\n/**\n * Generates points spaced out on the given number of rings.\n *\n * Get points as array\n * ```js\n * const circle = { radius: 5, x: 100, y: 100 };\n * const opts = { rings: 5 };\n * const points = [...circleRings(circle, rings)];\n * ```\n *\n * Or iterate over them\n * ```js\n * for (const point of circleRings(circle, opts)) {\n * }\n * ```\n * Source: http://www.holoborodko.com/pavel/2015/07/23/generating-equidistant-points-on-unit-disk/#more-3453\n * @param circle\n */\nexport function* circleRings(\n  circle?: Circle | CirclePositioned,\n  opts: CircleRingsOpts = {}\n): IterableIterator<Point> {\n  const rings = opts.rings ?? 5;\n  const c = circleToPositioned(circle ?? { radius: 1, x: 0, y: 0 });\n  const ringR = 1 / rings;\n  const rotationOffset = opts.rotation ?? 0;\n\n  //eslint-disable-next-line functional/no-let\n  let ringCount = 1;\n\n  // Origin\n  yield Object.freeze({ x: c.x, y: c.y });\n\n  //eslint-disable-next-line functional/no-let\n  for (let r = ringR; r <= 1; r += ringR) {\n    const n = Math.round(pi / asin(1 / (2 * ringCount)));\n    for (const theta of linearSpace(0, piPi, n + 1)) {\n      yield Object.freeze({\n        x: c.x + r * cos(theta + rotationOffset) * c.radius,\n        y: c.y + r * sin(theta + rotationOffset) * c.radius,\n      });\n    }\n    ringCount++;\n  }\n}\n/**\n * Fibonacci sphere algorithm. Generates points\n * distributed on a sphere.\n *\n * @example Generate points of a unit sphere\n * ```js\n * for (const pt of sphereFibonacci(100)) {\n *  // pt.x, pt.y, pt.z\n * }\n * ```\n *\n * @example Generate points into an array\n * ```js\n * const sphere = { radius: 10, x: 10, y: 200 }\n * const pts = [...sphereFibonacci(100, 0, sphere)];\n * ```\n *\n * Source: https://codepen.io/elchininet/pen/vXeRyL\n *\n * @param samples\n * @returns\n */\nexport function* sphereFibonacci(\n  samples = 100,\n  rotationRadians = 0,\n  sphere?: Sphere\n): IterableIterator<Point3d> {\n  const offset = 2 / samples;\n  const s = sphere ?? { x: 0, y: 0, z: 0, radius: 1 };\n\n  for (let index = 0; index < samples; index++) {\n    const y = index * offset - 1 + offset / 2;\n    const r = sqrt(1 - pow(y, 2));\n    const a = ((index + 1) % samples) * goldenAngle + rotationRadians;\n    const x = cos(a) * r;\n    const z = sin(a) * r;\n    //eslint-disable-next-line functional/immutable-data\n    yield Object.freeze({\n      x: s.x + x * s.radius,\n      y: s.y + y * s.radius,\n      z: s.z + z * s.radius,\n    });\n  }\n}\n","import * as Polar from '../Polar.js';\nimport * as Points from '../point/index.js';\nimport { throwNumberTest } from \"../../util/GuardNumbers.js\";\nimport { radianToDegree } from '../Angles.js';\nimport { guard } from './Guard.js';\nimport { intersectsPoint as RectsIntersectsPoint } from '../rect/Intersects.js';\nimport type { RectPositioned } from '../Types.js';\nimport type { Point } from '../point/PointType.js';\nimport { getPointParameter } from '../point/GetPointParameter.js';\nimport type { Triangle } from './TriangleType.js';\n\nexport * from './Area.js';\nexport * from './Centroid.js';\nexport * from './Edges.js';\nexport * from './InnerCircle.js';\nexport * from './Guard.js';\nexport * from './OuterCircle.js';\nexport * from './Perimeter.js';\nexport * from './Rotate.js';\n/**\n * Functions for working with equilateral triangles, defined by length\n */\nexport * as Equilateral from './Equilateral.js';\n\n/**\n * Functions for working with right-angled triangles, defined by two of three edges\n */\nexport * as Right from './Right.js';\n\nexport * as Isosceles from './Isosceles.js';\n\n/**\n* Triangle.\n*\n* Helpers for creating:\n*  - {@link Triangles.fromFlatArray}: Create from [x1, y1, x2, y2, x3, y3]\n*  - {@link Triangles.fromPoints}: Create from three `{x,y}` sets\n*  - {@link Triangles.fromRadius}: Equilateral triangle of a given radius and center\n*/\n\n\nconst piPi = Math.PI * 2;\n\n/**\n * A triangle consisting of three empty points (Points.Empty)\n */\n//eslint-disable-next-line @typescript-eslint/naming-convention\nexport const Empty = Object.freeze({\n  a: { x: 0, y: 0 },\n  b: { x: 0, y: 0 },\n  c: { x: 0, y: 0 },\n});\n\n/**\n * A triangle consisting of three placeholder points (Points.Placeholder)\n */\n//eslint-disable-next-line @typescript-eslint/naming-convention\nexport const Placeholder = Object.freeze({\n  a: { x: Number.NaN, y: Number.NaN },\n  b: { x: Number.NaN, y: Number.NaN },\n  c: { x: Number.NaN, y: Number.NaN },\n});\n\n/**\n * Returns true if triangle is empty\n * @param t\n * @returns\n */\nexport const isEmpty = (t: Triangle): boolean =>\n  Points.isEmpty(t.a) && Points.isEmpty(t.b) && Points.isEmpty(t.c);\n\n/**\n * Returns true if triangle is a placeholder\n * @param t\n * @returns\n */\nexport const isPlaceholder = (t: Triangle): boolean =>\n  Points.isPlaceholder(t.a) &&\n  Points.isPlaceholder(t.b) &&\n  Points.isPlaceholder(t.c);\n\n/**\n * Applies `fn` to each of a triangle's corner points, returning the result.\n *\n * @example Add some random to the x of each corner\n * ```\n * const t = apply(tri, p => {\n *  const r = 10;\n *  return {\n *    x: p.x + (Math.random()*r*2) - r,\n *    y: p.y\n *  }\n * });\n * ```\n * @param t\n * @param fn\n * @returns\n */\nexport const apply = (\n  t: Triangle,\n  fn: (p: Point, label?: string) => Point\n) =>\n  Object.freeze<Triangle>({\n    ...t,\n    a: fn(t.a, `a`),\n    b: fn(t.b, `b`),\n    c: fn(t.c, `c`),\n  });\n\n\n\n/**\n * Returns true if the parameter appears to be a valid triangle\n * @param p\n * @returns\n */\nexport const isTriangle = (p: unknown): p is Triangle => {\n  if (p === undefined) return false;\n  const tri = p as Triangle;\n  if (!Points.isPoint(tri.a)) return false;\n  if (!Points.isPoint(tri.b)) return false;\n  if (!Points.isPoint(tri.c)) return false;\n  return true;\n};\n\n/**\n * Returns true if the two parameters have equal values\n * @param a\n * @param b\n * @returns\n */\nexport const isEqual = (a: Triangle, b: Triangle): boolean =>\n  Points.isEqual(a.a, b.a) &&\n  Points.isEqual(a.b, b.b) &&\n  Points.isEqual(a.c, b.c);\n\n/**\n * Returns the corners (vertices) of the triangle as an array of points\n * @param t\n * @returns Array of length three\n */\nexport const corners = (t: Triangle): ReadonlyArray<Point> => {\n  guard(t);\n  return [ t.a, t.b, t.c ];\n};\n\n\n\n/**\n * Returns the lengths of the triangle sides\n * @param t\n * @returns Array of length three\n */\nexport const lengths = (t: Triangle): ReadonlyArray<number> => {\n  guard(t);\n  return [\n    Points.distance(t.a, t.b),\n    Points.distance(t.b, t.c),\n    Points.distance(t.c, t.a),\n  ];\n};\n\n/**\n * Return the three interior angles of the triangle, in radians.\n * @param t\n * @returns\n */\nexport const angles = (t: Triangle): ReadonlyArray<number> => {\n  guard(t);\n  return [\n    Points.angleRadian(t.a, t.b),\n    Points.angleRadian(t.b, t.c),\n    Points.angleRadian(t.c, t.a),\n  ];\n};\n\n/**\n * Returns the three interior angles of the triangle, in degrees\n * @param t\n * @returns\n */\nexport const anglesDegrees = (t: Triangle): ReadonlyArray<number> => {\n  guard(t);\n  return radianToDegree(angles(t));\n};\n\n/**\n * Returns true if it is an equilateral triangle\n * @param t\n * @returns\n */\nexport const isEquilateral = (t: Triangle): boolean => {\n  guard(t);\n  const [ a, b, c ] = lengths(t);\n  return a === b && b === c;\n};\n\n/**\n * Returns true if it is an isosceles triangle\n * @param t\n * @returns\n */\nexport const isIsosceles = (t: Triangle): boolean => {\n  const [ a, b, c ] = lengths(t);\n  if (a === b) return true;\n  if (b === c) return true;\n  if (c === a) return true;\n  return false;\n};\n\n/**\n * Returns true if at least one interior angle is 90 degrees\n * @param t\n * @returns\n */\nexport const isRightAngle = (t: Triangle): boolean =>\n  angles(t).includes(Math.PI / 2);\n\n/**\n * Returns true if triangle is oblique: No interior angle is 90 degrees\n * @param t\n * @returns\n */\nexport const isOblique = (t: Triangle): boolean => !isRightAngle(t);\n\n/**\n * Returns true if triangle is actue: all interior angles less than 90 degrees\n * @param t\n * @returns\n */\nexport const isAcute = (t: Triangle): boolean =>\n  !angles(t).some((v) => v >= Math.PI / 2);\n\n/**\n * Returns true if triangle is obtuse: at least one interior angle is greater than 90 degrees\n * @param t\n * @returns\n */\nexport const isObtuse = (t: Triangle): boolean =>\n  angles(t).some((v) => v > Math.PI / 2);\n\n\n/**\n * Returns an equilateral triangle centered at the origin.\n *\n * ```js\n * // Create a triangle at 100,100 with radius of 60\n * const tri = fromRadius({x:100,y:100}, 60);\n *\n * // Triangle with point A upwards, B to the right, C to the left\n * constr tri2 = fromRadius({x:100,y:100}, 60, {initialAngleRadian: -Math.PI / 2});\n * ```\n *\n *\n * @param origin Origin\n * @param radius Radius of triangle\n * @param opts Options\n */\nexport const fromRadius = (\n  origin: Point,\n  radius: number,\n  opts: { readonly initialAngleRadian?: number } = {}\n): Triangle => {\n  throwNumberTest(radius, `positive`, `radius`);\n  Points.guard(origin, `origin`);\n\n  const initialAngleRadian = opts.initialAngleRadian ?? 0;\n\n  const angles = [\n    initialAngleRadian,\n    initialAngleRadian + (piPi * 1) / 3,\n    initialAngleRadian + (piPi * 2) / 3,\n  ];\n  const points = angles.map((a) => Polar.toCartesian(radius, a, origin));\n  return fromPoints(points);\n};\n\n/**\n * Rotates the vertices of the triangle around one point (by default, `b`).\n * @param triangle Triangle\n * @param vertex Name of vertex: a, b or c.\n */\nexport const rotateByVertex = (\n  triangle: Triangle,\n  amountRadian: number,\n  vertex: `a` | `b` | `c` = `b`\n): Triangle => {\n  const origin =\n    vertex === `a` ? triangle.a : (vertex === `b` ? triangle.b : triangle.c);\n  return Object.freeze({\n    a: Points.rotate(triangle.a, amountRadian, origin),\n    b: Points.rotate(triangle.b, amountRadian, origin),\n    c: Points.rotate(triangle.c, amountRadian, origin),\n  });\n};\n\n/**\n * Returns a triangle anchored at `origin` with a given `length` and `angleRadian`.\n * The origin will be point `b` of the triangle, and the angle will be the angle for b.\n * @param origin Origin\n * @param length Length\n * @param angleRadian Angle\n * @returns\n */\nexport const equilateralFromVertex = (\n  origin?: Point,\n  length = 10,\n  angleRadian: number = Math.PI / 2\n): Triangle => {\n  if (!origin) origin = Object.freeze({ x: 0, y: 0 })\n\n  const a = Points.project(origin, length, Math.PI - -angleRadian / 2);\n  const c = Points.project(origin, length, Math.PI - angleRadian / 2);\n  return { a, b: origin, c };\n};\n\n/**\n * Returns the coordinates of triangle in a flat array form:\n * [xA, yA, xB, yB, xC, yC]\n * @param t\n * @returns\n */\nexport const toFlatArray = (t: Triangle): ReadonlyArray<number> => {\n  guard(t);\n  return [ t.a.x, t.a.y, t.b.x, t.b.y, t.c.x, t.c.y ];\n};\n\n/**\n * Returns a triangle from a set of coordinates in a flat array form:\n * [xA, yA, xB, yB, xC, yC]\n * @param coords\n * @returns\n */\nexport const fromFlatArray = (coords: ReadonlyArray<number>): Triangle => {\n  if (!Array.isArray(coords)) throw new Error(`coords expected as array`);\n  if (coords.length !== 6) {\n    throw new Error(\n      `coords array expected with 6 elements. Got ${ coords.length }`\n    );\n  }\n  return fromPoints(Points.fromNumbers(...coords));\n};\n\n/**\n * Returns a triangle from an array of three points\n * @param points\n * @returns\n */\nexport const fromPoints = (points: ReadonlyArray<Point>): Triangle => {\n  if (!Array.isArray(points)) throw new Error(`points expected as array`);\n  if (points.length !== 3) {\n    throw new Error(\n      `points array expected with 3 elements. Got ${ points.length }`\n    );\n  }\n  const t: Triangle = {\n    a: points[ 0 ],\n    b: points[ 1 ],\n    c: points[ 2 ],\n  };\n  return t;\n};\n\n/**\n * Returns the bounding box that encloses the triangle.\n * @param t\n * @param inflation If specified, box will be inflated by this much. Default: 0.\n * @returns\n */\nexport const bbox = (t: Triangle, inflation = 0): RectPositioned => {\n  const { a, b, c } = t;\n  const xMin = Math.min(a.x, b.x, c.x) - inflation;\n  const xMax = Math.max(a.x, b.x, c.x) + inflation;\n  const yMin = Math.min(a.y, b.y, c.y) - inflation;\n  const yMax = Math.max(a.y, b.y, c.y) + inflation;\n\n  const r: RectPositioned = {\n    x: xMin,\n    y: yMin,\n    width: xMax - xMin,\n    height: yMax - yMin,\n  };\n  return r;\n};\n\nexport type BarycentricCoord = {\n  readonly a: number;\n  readonly b: number;\n  readonly c: number;\n};\n\n/**\n * Returns the [Barycentric coordinate](https://en.wikipedia.org/wiki/Barycentric_coordinate_system) of a point within a triangle\n *\n * @param t\n * @param a\n * @param b\n * @returns\n */\nexport const barycentricCoord = (\n  t: Triangle,\n  a: Point | number,\n  b?: number\n): BarycentricCoord => {\n  const pt = getPointParameter(a, b);\n\n  const ab = (x: number, y: number, pa: Point, pb: Point) =>\n    (pa.y - pb.y) * x + (pb.x - pa.x) * y + pa.x * pb.y - pb.x * pa.y;\n\n  const alpha = ab(pt.x, pt.y, t.b, t.c) / ab(t.a.x, t.a.y, t.b, t.c);\n  const theta = ab(pt.x, pt.y, t.c, t.a) / ab(t.b.x, t.b.y, t.c, t.a);\n  const gamma = ab(pt.x, pt.y, t.a, t.b) / ab(t.c.x, t.c.y, t.a, t.b);\n\n  return {\n    a: alpha,\n    b: theta,\n    c: gamma,\n  };\n};\n\n/**\n * Convert Barycentric coordinate to Cartesian\n * @param t\n * @param bc\n * @returns\n */\nexport const barycentricToCartestian = (\n  t: Triangle,\n  bc: BarycentricCoord\n): Point => {\n  guard(t);\n  const { a, b, c } = t;\n\n  const x = a.x * bc.a + b.x * bc.b + c.x * bc.c;\n  const y = a.y * bc.a + b.y * bc.b + c.y * bc.c;\n\n  if (a.z && b.z && c.z) {\n    const z = a.z * bc.a + b.z * bc.b + c.z * bc.c;\n    return Object.freeze({ x, y, z });\n  } else {\n    return Object.freeze({ x, y });\n  }\n};\n\n/**\n * Returns true if point is within or on the boundary of triangle\n * @param t\n * @param a\n * @param b\n */\nexport const intersectsPoint = (\n  t: Triangle,\n  a: Point | number,\n  b?: number\n): boolean => {\n  const box = bbox(t);\n\n  const pt = getPointParameter(a, b);\n\n  // If it's not in the bounding box, can return false straight away\n  if (!RectsIntersectsPoint(box, pt)) return false;\n\n  const bc = barycentricCoord(t, pt);\n\n  return (\n    0 <= bc.a && bc.a <= 1 && 0 <= bc.b && bc.b <= 1 && 0 <= bc.c && bc.c <= 1\n  );\n};\n","import type { Triangle } from \"./TriangleType.js\";\nimport { guard as PointsGuard } from '../point/Guard.js'\n\n/**\n * Throws an exception if the triangle is invalid\n * @param t\n * @param name\n */\nexport const guard = (t: Triangle, name = `t`) => {\n  if (t === undefined) throw new Error(`{$name} undefined`);\n  PointsGuard(t.a, name + `.a`);\n  PointsGuard(t.b, name + `.b`);\n  PointsGuard(t.c, name + `.c`);\n};","\nimport type { Triangle } from \"../Types.js\";\nimport type { PolyLine } from \"../line/LineType.js\";\nimport { joinPointsToLines } from \"../line/JoinPointsToLines.js\";\nimport { guard } from \"./Guard.js\";\n/**\n * Returns the edges (ie sides) of the triangle as an array of lines\n * @param t\n * @returns Array of length three\n */\nexport const edges = (t: Triangle): PolyLine => {\n  guard(t);\n  return joinPointsToLines(t.a, t.b, t.c, t.a);\n};","import { guard } from \"./Guard.js\";\nimport { length as LinesLength } from '../line/Length.js';\nimport { edges } from \"./Edges.js\";\nimport type { Triangle } from \"./TriangleType.js\";\n\n/**\n * Calculates the area of a triangle\n * @param t\n * @returns\n */\nexport const area = (t: Triangle): number => {\n  guard(t, `t`);\n\n  // Get length of edges\n  const lengths = edges(t).map((l) => LinesLength(l));\n\n  // Add up length of edges, halve\n  const p = (lengths[ 0 ] + lengths[ 1 ] + lengths[ 2 ]) / 2;\n  return Math.sqrt(p * (p - lengths[ 0 ]) * (p - lengths[ 1 ]) * (p - lengths[ 2 ]));\n};","import type { Point } from \"../point/PointType.js\";\nimport { guard } from \"./Guard.js\";\nimport type { Triangle } from \"./TriangleType.js\";\nimport { reduce as PointsReduce } from '../point/index.js';\n\n/**\n * Returns simple centroid of triangle\n * @param t\n * @returns\n */\nexport const centroid = (t: Triangle): Point => {\n  guard(t);\n  const total = PointsReduce(\n    [ t.a, t.b, t.c ],\n    (p: Point, accumulator: Point) => ({\n      x: p.x + accumulator.x,\n      y: p.y + accumulator.y,\n    })\n  );\n  const div = {\n    x: total.x / 3,\n    y: total.y / 3,\n  };\n  return div;\n};","import { guard } from \"./Guard.js\";\nimport type { Triangle } from \"./TriangleType.js\";\nimport { length as LinesLength } from '../line/Length.js';\nimport { edges } from \"./Edges.js\";\n\n/**\n * Calculates perimeter of a triangle\n * @param t\n * @returns\n */\nexport const perimeter = (t: Triangle): number => {\n  guard(t);\n  return edges(t).reduce((accumulator, v) => accumulator + LinesLength(v), 0);\n};","import type { CirclePositioned } from \"../circle/CircleType.js\";\nimport { area } from \"./Area.js\";\nimport { centroid } from \"./Centroid.js\";\nimport { perimeter } from \"./Perimeter.js\";\nimport type { Triangle } from \"./TriangleType.js\";\n\n/**\n * Returns the largest circle enclosed by triangle `t`.\n * @param t\n */\nexport const innerCircle = (t: Triangle): CirclePositioned => {\n  const c = centroid(t);\n  const p = perimeter(t) / 2;\n  const a = area(t);\n  const radius = a / p;\n  return { radius, ...c };\n};","import { length as LinesLength } from '../line/Length.js';\nimport { edges } from \"./Edges.js\";\nimport { centroid } from './Centroid.js';\nimport type { Triangle } from \"./TriangleType.js\";\nimport type { CirclePositioned } from '../circle/CircleType.js';\n\n/**\n * Returns the largest circle touching the corners of triangle `t`.\n * @param t\n * @returns\n */\nexport const outerCircle = (t: Triangle): CirclePositioned => {\n  const [ a, b, c ] = edges(t).map((l) => LinesLength(l));\n  const cent = centroid(t);\n  const radius =\n    (a * b * c) /\n    Math.sqrt((a + b + c) * (-a + b + c) * (a - b + c) * (a + b - c));\n  return {\n    radius,\n    ...cent,\n  };\n};","import type { Point } from \"../point/PointType.js\";\nimport { centroid } from \"./Centroid.js\";\nimport type { Triangle } from \"./TriangleType.js\";\nimport { rotate as PointsRotate } from \"../point/index.js\";\n/**\n * Returns a triangle that is rotated by `angleRad`. By default it rotates\n * around its center but an arbitrary `origin` point can be provided.\n *\n * ```js\n * // Rotate triangle by 5 degrees\n * rotate(triangle, degreeToRadian(5));\n *\n * // Rotate by 90 degrees\n * rotate(triangle, Math.PI / 2);\n * ```\n * @param triangle Triangle to rotate\n * @param amountRadian Angle in radians to rotate by\n * @param origin Point to rotate around. If undefined, middle of triangle will be used\n * @returns\n */\nexport const rotate = (\n  triangle: Triangle,\n  amountRadian?: number,\n  origin?: Point\n): Triangle => {\n  if (amountRadian === undefined || amountRadian === 0) return triangle;\n  if (origin === undefined) origin = centroid(triangle);\n  return Object.freeze({\n    ...triangle,\n    a: PointsRotate(triangle.a, amountRadian, origin),\n    b: PointsRotate(triangle.b, amountRadian, origin),\n    c: PointsRotate(triangle.c, amountRadian, origin),\n  });\n};\n","import type { Circle } from \"../circle/CircleType.js\";\nimport type { Point } from \"../point/PointType.js\";\nimport type { Triangle } from \"./TriangleType.js\";\n\nconst pi4over3 = (Math.PI * 4) / 3;\nconst pi2over3 = (Math.PI * 2) / 3;\n\nexport type TriangleEquilateral =\n  | {\n    readonly length: number;\n  }\n  | number;\n\nconst resolveLength = (t: TriangleEquilateral): number => {\n  if (typeof t === `number`) return t;\n  return t.length;\n};\n\n/**\n * Returns a positioned `Triangle` from an equilateral triangle definition.\n * By default the rotation is such that point `a` and `c` are lying on the horizontal,\n * and `b` is the upward-facing tip.\n *\n * Default is a triangle pointing upwards with b at the top, c to the left and b to right on the baseline.\n *\n * Example rotation values in radians:\n * * ▶️ 0: a and c on vertical, b at the tip\n * * ◀️ Math.PI: `c`and `a` are on vertical, with `b` at the tip.\n * * 🔽 Math.PI/2: `c` and `a` are on horizontal, `c` to the left. `b` at the bottom.\n * * 🔼 Math.PI*1.5: `c` and `a` are on horizontal, `c` to the right. `b` at the top. (default)\n * @param t\n * @param origin\n * @param rotationRad\n * @returns\n */\nexport const fromCenter = (\n  t: TriangleEquilateral,\n  origin?: Point,\n  rotationRad?: number\n): Triangle => {\n  if (!origin) origin = Object.freeze({ x: 0, y: 0 })\n\n  const r = resolveLength(t) / Math.sqrt(3);\n  const rot = rotationRad ?? Math.PI * 1.5;\n  const b = {\n    x: r * Math.cos(rot) + origin.x,\n    y: r * Math.sin(rot) + origin.y,\n  };\n  const a = {\n    x: r * Math.cos(rot + pi4over3) + origin.x,\n    y: r * Math.sin(rot + pi4over3) + origin.y,\n  };\n  const c = {\n    x: r * Math.cos(rot + pi2over3) + origin.x,\n    y: r * Math.sin(rot + pi2over3) + origin.y,\n  };\n\n  return Object.freeze({ a, b, c });\n};\n\n/**\n * Calculate center from the given point A\n * @param t\n * @param ptA\n * @returns\n */\nexport const centerFromA = (\n  t: TriangleEquilateral,\n  ptA?: Point\n): Point => {\n  if (!ptA) ptA = Object.freeze({ x: 0, y: 0 })\n\n  const r = resolveLength(t);\n  const { radius } = incircle(t);\n  return {\n    x: ptA.x + r / 2,\n    y: ptA.y - radius,\n  };\n};\n\n/**\n * Calculate center from the given point B\n * @param t\n * @param ptB\n * @returns\n */\nexport const centerFromB = (\n  t: TriangleEquilateral,\n  ptB?: Point\n): Point => {\n  if (!ptB) ptB = Object.freeze({ x: 0, y: 0 })\n\n  const { radius } = incircle(t);\n  return {\n    x: ptB.x,\n    y: ptB.y + radius * 2,\n  };\n};\n\n/**\n * Calculate center from the given point C\n * @param t\n * @param ptC\n * @returns\n */\nexport const centerFromC = (\n  t: TriangleEquilateral,\n  ptC?: Point\n): Point => {\n  if (!ptC) ptC = Object.freeze({ x: 0, y: 0 })\n\n  const r = resolveLength(t);\n  const { radius } = incircle(t);\n\n  return {\n    x: ptC.x - r / 2,\n    y: ptC.y - radius,\n  };\n};\n\n/**\n * Returns the height (or rise) of an equilateral triangle.\n * Ie. from one vertex to the perpendicular edge.\n * (line marked x in the diagram below)\n *\n * ```\n *      .\n *     .x .\n *    . x  .\n *   .  x   .\n *  ..........\n * ```\n * @param t\n */\nexport const height = (t: TriangleEquilateral): number =>\n  (Math.sqrt(3) / 2) * resolveLength(t);\n\nexport const perimeter = (t: TriangleEquilateral): number =>\n  resolveLength(t) * 3;\n\nexport const area = (t: TriangleEquilateral): number =>\n  (Math.pow(resolveLength(t), 2) * Math.sqrt(3)) / 4;\n\n/**\n * Circle that encompasses all points of triangle\n * @param t\n */\nexport const circumcircle = (t: TriangleEquilateral): Circle => ({\n  radius: (Math.sqrt(3) / 3) * resolveLength(t),\n});\n\n/**\n * Circle that is inside the edges of the triangle\n * @param t\n * @returns\n */\nexport const incircle = (t: TriangleEquilateral): Circle => ({\n  radius: (Math.sqrt(3) / 6) * resolveLength(t),\n});\n","import type { Circle } from \"../circle/CircleType.js\";\nimport type { Point } from \"../point/PointType.js\";\nimport type { Triangle } from \"./TriangleType.js\";\nexport type Right = {\n  readonly adjacent?: number;\n  readonly hypotenuse?: number;\n  readonly opposite?: number;\n};\n\nexport type DefinedRight = {\n  readonly adjacent: number;\n  readonly hypotenuse: number;\n  readonly opposite: number;\n};\n\n/**\n * Returns a positioned triangle from a point for A.\n *\n * ```\n *             c (90 deg)\n *             .\n *          .   .\n *       .       .\n *    .           .\n * a .............. b\n * ```\n * @param t\n * @param origin\n * @returns\n */\nexport const fromA = (\n  t: Right,\n  origin?: Point\n): Triangle => {\n  if (!origin) origin = Object.freeze({ x: 0, y: 0 })\n  const tt = resolveLengths(t);\n  const seg = hypotenuseSegments(t);\n  const h = height(t);\n  const a = { x: origin.x, y: origin.y };\n  const b = { x: origin.x + tt.hypotenuse, y: origin.y };\n  const c = { x: origin.x + seg[ 1 ], y: origin.y - h };\n  return { a, b, c };\n};\n\n/**\n * Returns a positioned triangle from a point for B.\n *\n * ```\n *             c (90 deg)\n *             .\n *          .   .\n *       .       .\n *    .           .\n * a .............. b\n * ```\n * @param t\n * @param origin\n * @returns\n */\nexport const fromB = (\n  t: Right,\n  origin?: Point\n): Triangle => {\n  if (!origin) origin = Object.freeze({ x: 0, y: 0 })\n\n  const tt = resolveLengths(t);\n  const seg = hypotenuseSegments(t);\n  const h = height(t);\n  const b = { x: origin.x, y: origin.y };\n  const a = { x: origin.x - tt.hypotenuse, y: origin.y };\n  const c = { x: origin.x - seg[ 0 ], y: origin.y - h };\n  return { a, b, c };\n};\n\n/**\n * Returns a positioned triangle from a point for C.\n *\n * ```\n *             c (90 deg)\n *             .\n *          .   .\n *       .       .\n *    .           .\n * a .............. b\n * ```\n *\n *\n * ```js\n * // Triangle pointing up to 0,0 with sides of 15\n * Triangles.Right.fromC({ adjacent: 15, opposite:15 }, { x: 0, y: 0 });\n * ```\n * @param t\n * @param origin\n * @returns\n */\nexport const fromC = (\n  t: Right,\n  origin?: Point\n): Triangle => {\n  if (!origin) origin = Object.freeze({ x: 0, y: 0 })\n\n  const seg = hypotenuseSegments(t);\n  const h = height(t);\n  const c = { x: origin.x, y: origin.y };\n  const a = { x: origin.x - seg[ 1 ], y: origin.y + h };\n  const b = { x: origin.x + seg[ 0 ], y: origin.y + h };\n  return { a, b, c };\n};\n\n/**\n * Returns a right triangle with all lengths defined.\n * At least two lengths must already exist\n * @param t\n * @returns\n */\nexport const resolveLengths = (t: Right): DefinedRight => {\n  const a = t.adjacent;\n  const o = t.opposite;\n  const h = t.hypotenuse;\n\n  if (a !== undefined && o !== undefined) {\n    return {\n      ...t,\n      adjacent: a,\n      opposite: o,\n      hypotenuse: Math.hypot(a, o),\n    };\n  } else if (a && h) {\n    return {\n      ...t,\n      adjacent: a,\n      hypotenuse: h,\n      opposite: h * h - a * a,\n    };\n  } else if (o && h) {\n    return {\n      ...t,\n      hypotenuse: h,\n      opposite: o,\n      adjacent: h * h - o * o,\n    };\n  } else if (t.opposite && t.hypotenuse && t.adjacent) {\n    return t as DefinedRight;\n  }\n  throw new Error(`Missing at least two edges`);\n};\n\n/**\n * Height of right-triangle\n * @param t\n * @returns\n */\nexport const height = (t: Right): number => {\n  const tt = resolveLengths(t);\n  const p = (tt.opposite * tt.opposite) / tt.hypotenuse;\n  const q = (tt.adjacent * tt.adjacent) / tt.hypotenuse;\n  return Math.sqrt(p * q);\n};\n\n/**\n * Returns the lengths of the hypotenuse split into p and q segments.\n * In other words, if one makes a line from the right-angle vertex down to hypotenuse.\n *\n * [See here](https://rechneronline.de/pi/right-triangle.php)\n * @param t\n * @returns\n */\nexport const hypotenuseSegments = (\n  t: Right\n): readonly [ p: number, q: number ] => {\n  const tt = resolveLengths(t);\n  const p = (tt.opposite * tt.opposite) / tt.hypotenuse;\n  const q = (tt.adjacent * tt.adjacent) / tt.hypotenuse;\n  return [ p, q ];\n};\n\nexport const perimeter = (t: Right): number => {\n  const tt = resolveLengths(t);\n  return tt.adjacent + tt.hypotenuse + tt.opposite;\n};\n\nexport const area = (t: Right): number => {\n  const tt = resolveLengths(t);\n  return (tt.opposite * tt.adjacent) / 2;\n};\n\n/**\n * Angle (in radians) between hypotenuse and adjacent edge\n * @param t\n * @returns\n */\nexport const angleAtPointA = (t: Right): number => {\n  const tt = resolveLengths(t);\n  return Math.acos(\n    (tt.adjacent * tt.adjacent +\n      tt.hypotenuse * tt.hypotenuse -\n      tt.opposite * tt.opposite) /\n    (2 * tt.adjacent * tt.hypotenuse)\n  );\n};\n\n/**\n * Angle (in radians) between opposite edge and hypotenuse\n * @param t\n * @returns\n */\nexport const angleAtPointB = (t: Right): number => {\n  const tt = resolveLengths(t);\n  return Math.acos(\n    (tt.opposite * tt.opposite +\n      tt.hypotenuse * tt.hypotenuse -\n      tt.adjacent * tt.adjacent) /\n    (2 * tt.opposite * tt.hypotenuse)\n  );\n};\n\n/**\n * Returns the median line lengths a, b and c in an array.\n *\n * The median lines are the lines from each vertex to the center.\n *\n * @param t\n * @returns\n */\nexport const medians = (\n  t: Right\n): readonly [ a: number, b: number, c: number ] => {\n  const tt = resolveLengths(t);\n  const b = tt.adjacent * tt.adjacent;\n  const c = tt.hypotenuse * tt.hypotenuse;\n  const a = tt.opposite * tt.opposite;\n\n  return [\n    Math.sqrt(2 * (b + c) - a) / 2,\n    Math.sqrt(2 * (c + a) - b) / 2,\n    Math.sqrt(2 * (a + b) - c) / 2,\n  ];\n};\n\n/**\n * The circle which passes through the points of the triangle\n * @param t\n * @returns\n */\nexport const circumcircle = (t: Right): Circle => {\n  const tt = resolveLengths(t);\n  return { radius: tt.hypotenuse / 2 };\n};\n\n/**\n * Circle enclosed by triangle\n * @param t\n * @returns\n */\nexport const incircle = (t: Right): Circle => {\n  const tt = resolveLengths(t);\n  return {\n    radius: (tt.adjacent + tt.opposite - tt.hypotenuse) / 2,\n  };\n};\n\n/**\n * Returns the opposite length of a right-angle triangle,\n * marked here\n *\n * ```\n *    .  <\n *   ..  <\n * ....  <\n * ```\n *\n * This is just:\n * ```js\n * opposite = Math.tan(angle) * adjacent\n * ```\n * @param angleRad\n * @param adjacent\n * @returns\n */\nexport const oppositeFromAdjacent = (\n  angleRad: number,\n  adjacent: number\n): number => Math.tan(angleRad) * adjacent;\n\n/**\n * Returns the opposite length of a right-angle triangle,\n * marked here\n *\n * ```\n *    .  <\n *   ..  <\n * ....  <\n * ```\n *\n * This is just:\n * ```js\n * opposite = Math.tan(angle) * adjacent\n * ```\n * @param angleRad\n * @param hypotenuse\n * @returns\n */\nexport const oppositeFromHypotenuse = (\n  angleRad: number,\n  hypotenuse: number\n): number => Math.sin(angleRad) * hypotenuse;\n\n/**\n * Returns the adjecent length of a right-angle triangle,\n * marked here\n * ```\n *    .\n *   ..  o\n * ....\n * ^^^^\n * ```\n * This is just:\n * ```js\n * opposite = Math.tan(angle) * adjacent\n * ```\n * @param angleRadian\n * @param hypotenuse\n * @returns\n */\nexport const adjacentFromHypotenuse = (\n  angleRadian: number,\n  hypotenuse: number\n): number => Math.cos(angleRadian) * hypotenuse;\n\n/**\n * Returns the adjecent length of a right-angle triangle,\n * marked here\n * ```\n *    .\n *   ..  o\n * ....\n * ^^^^\n * ```\n * This is just:\n * ```js\n * opposite = Math.tan(angle) * adjacent\n * ```\n * @param angleRadian\n * @param opposite\n * @returns\n */\nexport const adjacentFromOpposite = (\n  angleRadian: number,\n  opposite: number\n): number => opposite / Math.tan(angleRadian);\n\n/**\n * Returns the hypotenuse length of a right-angle triangle,\n * marked here\n * ```\n *      .\n * >   ..\n * >  ...\n * > ....  opp\n *  .....\n *   adj\n * ```\n * This is just:\n * ```js\n * opposite = Math.tan(angle) * adjacent\n * ```\n * @param angleRadian\n * @param opposite\n * @returns\n */\nexport const hypotenuseFromOpposite = (\n  angleRadian: number,\n  opposite: number\n): number => opposite / Math.sin(angleRadian);\n\n/**\n * Returns the hypotenuse length of a right-angle triangle,\n * marked here\n * ```\n *      .\n * >   ..\n * >  ...\n * > ....  opp\n *  .....\n *   adj\n * ```\n * This is just:\n * ```js\n * opposite = Math.tan(angle) * adjacent\n * ```\n * @param angleRadian\n * @param adjacent\n * @returns\n */\nexport const hypotenuseFromAdjacent = (\n  angleRadian: number,\n  adjacent: number\n): number => adjacent / Math.cos(angleRadian);\n","\nimport type { Circle } from \"../circle/CircleType.js\";\nimport type { Point } from \"../point/PointType.js\";\nimport type { Triangle } from \"./TriangleType.js\";\nexport type Isosceles = {\n  readonly legs: number;\n  readonly base: number;\n};\n\nexport const baseAngle = (t: Isosceles): number =>\n  Math.acos(t.base / (2 * t.legs));\n\nexport const apexAngle = (t: Isosceles): number => {\n  const aa = t.legs * t.legs;\n  const cc = t.base * t.base;\n  return Math.acos((2 * aa - cc) / (2 * aa));\n};\n\nexport const height = (t: Isosceles): number => {\n  const aa = t.legs * t.legs;\n  const cc = t.base * t.base;\n  return Math.sqrt((4 * aa - cc) / 4);\n};\n\nexport const legHeights = (t: Isosceles): number => {\n  const b = baseAngle(t);\n  return t.base * Math.sin(b);\n};\n\nexport const perimeter = (t: Isosceles): number => 2 * t.legs + t.base;\n\nexport const area = (t: Isosceles): number => {\n  const h = height(t);\n  return (h * t.base) / 2;\n};\n\nexport const circumcircle = (t: Isosceles): Circle => {\n  const h = height(t);\n  const hh = h * h;\n  const cc = t.base * t.base;\n  return { radius: (4 * hh + cc) / (8 * h) };\n};\n\nexport const incircle = (t: Isosceles): Circle => {\n  const h = height(t);\n  return { radius: (t.base * h) / (2 * t.legs + t.base) };\n};\n\nexport const medians = (\n  t: Isosceles\n): readonly [ a: number, b: number, c: number ] => {\n  const aa = t.legs * t.legs;\n  const cc = t.base * t.base;\n  const medianAB = Math.sqrt(aa + 2 * cc) / 2;\n  const medianC = Math.sqrt(4 * aa - cc) / 2;\n  return [ medianAB, medianAB, medianC ];\n};\n\n/**\n * Returns a positioned `Triangle` based on a center origin.\n * Center is determined by the intesecting of the medians.\n *\n * See: https://rechneronline.de/pi/isosceles-triangle.php\n * @param t\n * @param origin\n * @returns\n */\nexport const fromCenter = (\n  t: Isosceles,\n  origin?: Point\n): Triangle => {\n  if (!origin) origin = Object.freeze({ x: 0, y: 0 })\n  const h = height(t);\n  const incircleR = incircle(t).radius;\n  const verticalToApex = h - incircleR;\n\n  const a = { x: origin.x - t.base / 2, y: origin.y + incircleR };\n  const b = { x: origin.x + t.base / 2, y: origin.y + incircleR };\n  const c = { x: origin.x, y: origin.y - verticalToApex };\n  return { a, b, c };\n};\n\nexport const fromA = (\n  t: Isosceles,\n  origin?: Point\n): Triangle => {\n  if (!origin) origin = Object.freeze({ x: 0, y: 0 })\n\n  const h = height(t);\n  const a = { x: origin.x, y: origin.y };\n  const b = { x: origin.x + t.base, y: origin.y };\n  const c = { x: origin.x + t.base / 2, y: origin.y - h };\n  return { a, b, c };\n};\n\nexport const fromB = (\n  t: Isosceles,\n  origin?: Point\n): Triangle => {\n  if (!origin) origin = Object.freeze({ x: 0, y: 0 })\n\n  const h = height(t);\n  const b = { x: origin.x, y: origin.y };\n  const a = { x: origin.x - t.base, y: origin.y };\n  const c = { x: origin.x - t.base / 2, y: origin.y - h };\n  return { a, b, c };\n};\n\nexport const fromC = (\n  t: Isosceles,\n  origin?: Point\n): Triangle => {\n  if (!origin) origin = Object.freeze({ x: 0, y: 0 })\n  const h = height(t);\n  const c = { x: origin.x, y: origin.y };\n  const a = { x: origin.x - t.base / 2, y: origin.y + h };\n  const b = { x: origin.x + t.base / 2, y: origin.y + h };\n  return { a, b, c };\n};\n","import * as Drawing from './Drawing.js';\nimport * as Svg from './Svg.js';\n//import * as Plot from './Plot.js';\n\nimport * as Plot2 from './Plot2.js';\n\nimport * as Palette from './Palette.js';\nimport * as Colour from './Colour.js';\nimport * as SceneGraph from './SceneGraph.js';\nimport * as Video from './Video.js';\n\nexport * as ImageDataGrid from './ImageDataGrid.js';\nexport * as BipolarView from './BipolarView.js';\nexport * as Palette from './Palette.js';\nexport * as Drawing from './Drawing.js';\nexport * as Svg from './Svg.js';\n//export * as Plot from './Plot.js';\n\n\nexport * as Plot2 from './Plot2.js';\nexport * as PlotOld from './PlotOld.js';\nexport * as SceneGraph from './SceneGraph.js';\nexport * from './ScaleCanvas.js';\n\n/**\n * Colour interpolation, scale generation and parsing\n *\n * Overview\n * * {@link interpolator}: Blend colours\n * * {@link scale}: Produce colour scale\n * * {@link opacity}: Give a colour opacity\n * * {@link randomHue}: Generate a random hue\n * * {@link goldenAngleColour}: Pick perceptually different shades\n *\n * CSS\n * * {@link getCssVariable}: Parse a CSS-defined colour\n *\n * Conversions: convert from 'blue', 'rgb(255,0,0)',  'hsl(0, 100%, 50%)' etc:\n * * {@link toHex}: to a hex format string\n * * {@link toHsl}: to a `{h, s, l}` object\n * * {@link toRgb}: to a `{r, g, b}` object\n */\nexport * as Colour from './Colour.js';\n\n/**\n * Working with video, either playback from a file or stream from a video camera.\n *\n * Overview\n * * {@link frames}: Yields frames from a video camera\n * * {@link capture}: Capture frames from a VIDEO element\n *\n * @example Importing\n * ```js\n * // If library is stored two directories up under `ixfx/`\n * import {Video} from '../../ixfx/dist/visual.js';\n * // Import from web\n * import {Video} from 'https://unpkg.com/ixfx/dist/visual.js'\n * ```\n */\nexport * as Video from './Video.js';\n\ntry {\n  if (typeof window !== `undefined`) {\n    //eslint-disable-next-line functional/immutable-data,@typescript-eslint/no-explicit-any\n    (window as any).ixfx = {\n      ...(window as any).ixfx,\n      Visuals: {\n        SceneGraph,\n        Plot2,\n        Drawing,\n        Svg,\n        Palette,\n        Colour,\n        Video,\n      },\n    };\n  }\n} catch {\n  /* no-op */\n}\n\n\n","import * as Points from '../geometry/point/index.js';\nimport * as Triangles from '../geometry/triangle/index.js';\nimport { throwArrayTest } from '../util/GuardArrays.js';\nimport * as Arcs from '../geometry/arc/index.js';\nimport * as Beziers from '../geometry/bezier/index.js';\nimport * as Ellipses from '../geometry/Ellipse.js';\nimport * as Colours from '../visual/Colour.js';\nimport { resolveEl } from '../dom/ResolveEl.js';\nimport type { IStackImmutable } from '../collections/stack/IStackImmutable.js';\nimport { StackImmutable } from '../collections/stack/StackImmutable.js';\nimport type { Point } from '../geometry/point/PointType.js';\nimport type { Line } from '../geometry/line/LineType.js';\nimport type { CirclePositioned } from '../geometry/circle/CircleType.js';\nimport type { Rect, RectPositioned } from '../geometry/rect/index.js';\nimport type { Path } from '../geometry/path/PathType.js';\nimport type { Triangle } from '../geometry/triangle/TriangleType.js';\n\nimport { Empty as RectsEmpty } from '../geometry/rect/Empty.js';\nimport { corners as RectsCorners } from '../geometry/rect/Corners.js';\nimport { isLine } from '../geometry/line/Guard.js';\nimport { quantiseEvery } from '../numbers/Quantise.js';\n// eslint-disable-next-line @typescript-eslint/naming-convention\nconst PIPI = Math.PI * 2;\n\nexport type CanvasContextQuery =\n  | null\n  | string\n  | CanvasRenderingContext2D\n  | HTMLCanvasElement;\n\n/**\n * Gets a 2d drawing context from canvas element or query, or throws an error\n * @param canvasElementContextOrQuery Canvas element reference or DOM query\n * @returns Drawing context.\n */\nexport const getContext = (\n  canvasElementContextOrQuery: CanvasContextQuery\n): CanvasRenderingContext2D => {\n  if (canvasElementContextOrQuery === null) {\n    throw new Error(\n      `canvasElCtxOrQuery null. Must be a 2d drawing context or Canvas element`\n    );\n  }\n  if (canvasElementContextOrQuery === undefined) {\n    throw new Error(\n      `canvasElCtxOrQuery undefined. Must be a 2d drawing context or Canvas element`\n    );\n  }\n\n  const ctx =\n    canvasElementContextOrQuery instanceof CanvasRenderingContext2D\n      ? canvasElementContextOrQuery\n      : canvasElementContextOrQuery instanceof HTMLCanvasElement\n        ? canvasElementContextOrQuery.getContext(`2d`)\n        // eslint-disable-next-line unicorn/no-nested-ternary\n        : typeof canvasElementContextOrQuery === `string`\n          ? resolveEl<HTMLCanvasElement>(canvasElementContextOrQuery).getContext(`2d`)\n          : canvasElementContextOrQuery;\n  if (ctx === null) throw new Error(`Could not create 2d context for canvas`);\n  return ctx;\n};\n\nexport type DrawingHelper = ReturnType<typeof makeHelper>\n/**\n * Makes a helper object that wraps together a bunch of drawing functions that all use the same drawing context\n * @param ctxOrCanvasEl Drawing context or canvs element reference\n * @param canvasBounds Bounds of drawing (optional). Used for limiting `textBlock`\n * @returns\n */\nexport const makeHelper = (\n  ctxOrCanvasEl: CanvasContextQuery,\n  canvasBounds?: Rect\n) => {\n  const ctx = getContext(ctxOrCanvasEl);\n  return {\n    ctx,\n    paths(pathsToDraw: Array<Path>, opts?: DrawingOpts): void {\n      paths(ctx, pathsToDraw, opts);\n    },\n    line(lineToDraw: Line | Array<Line>, opts?: DrawingOpts): void {\n      line(ctx, lineToDraw, opts);\n    },\n    rect(\n      rectsToDraw: RectPositioned | Array<RectPositioned>,\n      opts?: RectOpts\n    ): void {\n      rect(ctx, rectsToDraw, opts);\n    },\n    bezier(\n      bezierToDraw: Beziers.QuadraticBezier | Beziers.CubicBezier,\n      opts?: DrawingOpts\n    ): void {\n      bezier(ctx, bezierToDraw, opts);\n    },\n    connectedPoints(\n      pointsToDraw: Array<Point>,\n      opts?: DrawingOpts & Partial<ConnectedPointsOptions>\n    ): void {\n      connectedPoints(ctx, pointsToDraw, opts);\n    },\n    pointLabels(pointsToDraw: Array<Point>, opts?: DrawingOpts): void {\n      pointLabels(ctx, pointsToDraw, opts);\n    },\n    dot(\n      dotPosition: Point | Array<Point>,\n      opts?: DotOpts\n    ): void {\n      dot(ctx, dotPosition, opts);\n    },\n    circle(\n      circlesToDraw: CirclePositioned | Array<\n        CirclePositioned>,\n      opts: DrawingOpts\n    ): void {\n      circle(ctx, circlesToDraw, opts);\n    },\n    arc(\n      arcsToDraw: Arcs.ArcPositioned | Array<Arcs.ArcPositioned>,\n      opts: DrawingOpts\n    ): void {\n      arc(ctx, arcsToDraw, opts);\n    },\n    textBlock(\n      lines: Array<string>,\n      opts: DrawingOpts & {\n        anchor: Point;\n        anchorPadding?: number;\n        bounds?: RectPositioned;\n      }\n    ): void {\n      if (opts.bounds === undefined && canvasBounds !== undefined) {\n        opts = { ...opts, bounds: { ...canvasBounds, x: 0, y: 0 } };\n      }\n      textBlock(ctx, lines, opts);\n    },\n  };\n};\n\n/**\n * Drawing options\n */\nexport type DrawingOpts = {\n  /**\n   * Stroke style\n   */\n  readonly strokeStyle?: string;\n  /**\n   * Fill style\n   */\n  readonly fillStyle?: string;\n  /**\n   * If true, diagnostic helpers will be drawn\n   */\n  readonly debug?: boolean;\n};\n\nexport type LineOpts = {\n  readonly lineWidth?: number;\n  readonly lineCap?: CanvasLineCap;\n  readonly lineJoin?: CanvasLineJoin;\n};\n\n/**\n * Creates a drawing op to apply provided options\n * @param opts Drawing options that apply\n * @returns Stack\n */\nconst optsOp = (opts: DrawingOpts): StackOp =>\n  coloringOp(opts.strokeStyle, opts.fillStyle);\n\n/**\n * Applies drawing options to `ctx`, returning a {@link DrawingStack}\n * @param ctx Context\n * @param opts Options\n * @returns\n */\nconst applyOpts = (\n  ctx: CanvasRenderingContext2D,\n  opts: DrawingOpts = {},\n  ...additionalOps: ReadonlyArray<StackOp>\n): DrawingStack => {\n  if (ctx === undefined) throw new Error(`ctx undefined`);\n\n  // Create a drawing stack, pushing an op generated from drawing options\n  //eslint-disable-next-line functional/immutable-data\n  const stack = drawingStack(ctx).push(optsOp(opts), ...additionalOps);\n\n  // Apply stack to context\n  stack.apply();\n  return stack;\n};\n\n/**\n * Draws one or more arcs.\n * @param ctx\n * @param arcs\n * @param opts\n */\nexport const arc = (\n  ctx: CanvasRenderingContext2D,\n  arcs: Arcs.ArcPositioned | ReadonlyArray<Arcs.ArcPositioned>,\n  opts: DrawingOpts = {}\n) => {\n  applyOpts(ctx, opts);\n\n  const draw = (arc: Arcs.ArcPositioned) => {\n    ctx.beginPath();\n    ctx.arc(arc.x, arc.y, arc.radius, arc.startRadian, arc.endRadian);\n    ctx.stroke();\n  };\n\n  const arcsArray = Array.isArray(arcs) ? arcs : [ arcs ];\n  for (const arc of arcsArray) {\n    draw(arc);\n  }\n\n};\n\n/**\n * A drawing stack operation\n */\nexport type StackOp = (ctx: CanvasRenderingContext2D) => void;\n\n/**\n * A drawing stack (immutable)\n */\nexport type DrawingStack = {\n  /**\n   * Push a new drawing op\n   * @param ops Operation to add\n   * @returns stack with added op\n   */\n  push(...ops: ReadonlyArray<StackOp>): DrawingStack;\n  /**\n   * Pops an operatiomn\n   * @returns Drawing stack with item popped\n   */\n  pop(): DrawingStack;\n  /**\n   * Applies drawing stack\n   */\n  apply(): DrawingStack;\n};\n\n/**\n * Colouring drawing op. Applies `fillStyle` and `strokeStyle`\n * @param strokeStyle\n * @param fillStyle\n * @returns\n */\nconst coloringOp = (\n  strokeStyle: string | CanvasGradient | CanvasPattern | undefined,\n  fillStyle: string | CanvasGradient | CanvasPattern | undefined\n): StackOp => {\n  const apply = (ctx: CanvasRenderingContext2D) => {\n    // eslint-disable-next-line functional/immutable-data\n    if (fillStyle) ctx.fillStyle = fillStyle;\n    // eslint-disable-next-line functional/immutable-data\n    if (strokeStyle) ctx.strokeStyle = strokeStyle;\n  };\n  return apply;\n};\n\nconst lineOp = (\n  lineWidth: number | undefined,\n  lineJoin: CanvasLineJoin | undefined,\n  lineCap: CanvasLineCap | undefined\n): StackOp => {\n  const apply = (ctx: CanvasRenderingContext2D) => {\n    // eslint-disable-next-line functional/immutable-data\n    if (lineWidth) ctx.lineWidth = lineWidth;\n    // eslint-disable-next-line functional/immutable-data\n    if (lineJoin) ctx.lineJoin = lineJoin;\n    // eslint-disable-next-line functional/immutable-data\n    if (lineCap) ctx.lineCap = lineCap;\n  };\n  return apply;\n};\n\n/**\n * Creates and returns an immutable drawing stack for a context\n * @param ctx Context\n * @param stk Initial stack operations\n * @returns\n */\nexport const drawingStack = (\n  ctx: CanvasRenderingContext2D,\n  stk?: IStackImmutable<StackOp>\n): DrawingStack => {\n  if (stk === undefined) stk = new StackImmutable<StackOp>();\n\n  const push = (...ops: Array<StackOp>): DrawingStack => {\n    if (stk === undefined) stk = new StackImmutable<StackOp>();\n    //eslint-disable-next-line functional/immutable-data\n    const s = stk.push(...ops);\n    for (const o of ops) o(ctx);\n    return drawingStack(ctx, s);\n  };\n\n  const pop = (): DrawingStack => {\n    //eslint-disable-next-line functional/immutable-data\n    const s = stk?.pop();\n    return drawingStack(ctx, s);\n  };\n\n  const apply = (): DrawingStack => {\n    if (stk === undefined) return drawingStack(ctx);\n    for (const op of stk.data) op(ctx);\n    return drawingStack(ctx, stk);\n  };\n\n  return { push, pop, apply };\n};\n\n/**\n * Draws a curved line through a set of points\n * @param ctx \n * @param points \n * @param opts \n */\nexport const lineThroughPoints = (\n  ctx: CanvasRenderingContext2D,\n  points: ReadonlyArray<Point>,\n  opts?: DrawingOpts\n): void => {\n  applyOpts(ctx, opts);\n\n  // https://stackoverflow.com/questions/7054272/how-to-draw-smooth-curve-through-n-points-using-javascript-html5-canvas\n  ctx.moveTo(points[ 0 ].x, points[ 0 ].y);\n\n  for (const [ index, p ] of points.entries()) {\n    if (index + 2 >= points.length) continue;\n    const pNext = points[ index + 1 ];\n    const mid = {\n      x: (p.x + pNext.x) / 2,\n      y: (p.y + pNext.y) / 2,\n    };\n    const cpX1 = (mid.x + p.x) / 2;\n    const cpX2 = (mid.x + pNext.x) / 2;\n    ctx.quadraticCurveTo(cpX1, pNext.y, mid.x, mid.y);\n    ctx.quadraticCurveTo(cpX2, pNext.y, pNext.x, pNext.y);\n  }\n};\n\n/**\n * Draws one or more circles. Will draw outline/fill depending on\n * whether `strokeStyle` or `fillStyle` params are present in the drawing options.\n *\n * ```js\n * // Draw a circle with radius of 10 at 0,0\n * circle(ctx, {radius:10});\n *\n * // Draw a circle of radius 10 at 100,100\n * circle(ctx, {radius: 10, x: 100, y: 100});\n *\n * // Draw two blue outlined circles\n * circle(ctx, [ {radius: 5}, {radius: 10} ], {strokeStyle:`blue`});\n * ```\n * @param ctx Drawing context\n * @param circlesToDraw Circle(s) to draw\n * @param opts Drawing options\n */\nexport const circle = (\n  ctx: CanvasRenderingContext2D,\n  circlesToDraw: CirclePositioned | ReadonlyArray<CirclePositioned>,\n  opts: DrawingOpts = {}\n) => {\n  applyOpts(ctx, opts);\n\n  const draw = (c: CirclePositioned) => {\n    ctx.beginPath();\n    ctx.arc(c.x, c.y, c.radius, 0, PIPI);\n    if (opts.strokeStyle) ctx.stroke();\n    //eslint-disable-next-line functional/immutable-data\n    if (opts.fillStyle) ctx.fill();\n  };\n\n  if (Array.isArray(circlesToDraw)) {\n    for (const c of circlesToDraw) draw(c);\n  } else {\n    draw(circlesToDraw as CirclePositioned);\n  }\n};\n\n/**\n * Draws one or more ellipses. Will draw outline/fill depending on\n * whether `strokeStyle` or `fillStyle` params are present in the drawing options.\n * @param ctx\n * @param ellipsesToDraw\n * @param opts\n */\nexport const ellipse = (\n  ctx: CanvasRenderingContext2D,\n  ellipsesToDraw:\n    | Ellipses.EllipsePositioned\n    | ReadonlyArray<Ellipses.EllipsePositioned>,\n  opts: DrawingOpts = {}\n) => {\n  applyOpts(ctx, opts);\n\n  const draw = (ellipse: Ellipses.EllipsePositioned) => {\n    ctx.beginPath();\n    const rotation = ellipse.rotation ?? 0;\n    const startAngle = ellipse.startAngle ?? 0;\n    const endAngle = ellipse.endAngle ?? PIPI;\n    ctx.ellipse(ellipse.x, ellipse.y, ellipse.radiusX, ellipse.radiusY, rotation, startAngle, endAngle);\n    if (opts.strokeStyle) ctx.stroke();\n    //eslint-disable-next-line functional/immutable-data\n    if (opts.fillStyle) ctx.fill();\n  };\n\n  const ellipsesArray = Array.isArray(ellipsesToDraw) ? ellipsesToDraw : [ ellipsesToDraw ];\n  for (const ellipse of ellipsesArray) {\n    draw(ellipse);\n  }\n};\n\n/**\n * Draws one or more paths.\n * supported paths are quadratic beziers and lines.\n * @param ctx\n * @param pathsToDraw\n * @param opts\n */\nexport const paths = (\n  ctx: CanvasRenderingContext2D,\n  pathsToDraw: ReadonlyArray<Path> | Path,\n  opts: { readonly strokeStyle?: string; readonly debug?: boolean } = {}\n) => {\n  applyOpts(ctx, opts);\n\n  const draw = (path: Path) => {\n    // Call appropriate drawing function depending on the type of path\n    if (Beziers.isQuadraticBezier(path)) quadraticBezier(ctx, path, opts);\n    else if (isLine(path)) line(ctx, path, opts);\n    else throw new Error(`Unknown path type ${ JSON.stringify(path) }`);\n  };\n\n  if (Array.isArray(pathsToDraw)) {\n    for (const p of pathsToDraw) draw(p);\n  } else {\n    draw(pathsToDraw as Path);\n  }\n};\n\nexport type ConnectedPointsOptions = {\n  readonly lineWidth: number\n  readonly loop: boolean\n  readonly fillStyle: string\n  readonly strokeStyle: string\n}\n/**\n * Draws a line between all the given points.\n * If a fillStyle is specified, it will be filled.\n *\n * See also:\n * * {@link line}: Draw one or more lines\n *\n * @param ctx\n * @param pts\n */\nexport const connectedPoints = (\n  ctx: CanvasRenderingContext2D,\n  pts: ReadonlyArray<Point>,\n  opts: Partial<ConnectedPointsOptions> = {}\n) => {\n  const shouldLoop = opts.loop ?? false;\n\n\n  throwArrayTest(pts);\n  if (pts.length === 0) return;\n\n  // Throw an error if any point is invalid\n  for (const [ index, pt ] of pts.entries()) Points.guard(pt, `Index ${ index }`);\n\n  applyOpts(ctx, opts);\n\n  // Draw points\n  if (opts.lineWidth) ctx.lineWidth = opts.lineWidth;\n  ctx.beginPath();\n  ctx.moveTo(pts[ 0 ].x, pts[ 0 ].y);\n  for (const pt of pts) ctx.lineTo(pt.x, pt.y);\n\n  if (shouldLoop) ctx.lineTo(pts[ 0 ].x, pts[ 0 ].y);\n\n  // if (opts.strokeStyle) ctx.strokeStyle = opts.strokeStyle;\n  if (\n    opts.strokeStyle ||\n    (opts.strokeStyle === undefined && opts.fillStyle === undefined)\n  ) {\n    ctx.stroke();\n  }\n  if (opts.fillStyle) {\n    //eslint-disable-next-line functional/immutable-data\n    ctx.fill();\n  }\n};\n\n/**\n * Draws labels for a set of points\n * @param ctx\n * @param pts Points to draw\n * @param opts\n * @param labels Labels for points\n */\nexport const pointLabels = (\n  ctx: CanvasRenderingContext2D,\n  pts: ReadonlyArray<Point>,\n  opts: { readonly fillStyle?: string } = {},\n  labels?: ReadonlyArray<string>\n) => {\n  if (pts.length === 0) return;\n\n  // Throw an error if any point is invalid\n  for (const [ index, pt ] of pts.entries()) Points.guard(pt, `Index ${ index }`);\n\n  applyOpts(ctx, opts);\n\n  for (const [ index, pt ] of pts.entries()) {\n    const label =\n      labels !== undefined && index < labels.length ? labels[ index ] : index.toString();\n    ctx.fillText(label.toString(), pt.x, pt.y);\n  }\n};\n\n/**\n * Returns `point` with the canvas's translation matrix applied\n * @param ctx\n * @param point\n * @returns\n */\nexport const translatePoint = (\n  ctx: CanvasRenderingContext2D,\n  point: Point\n): Point => {\n  const m = ctx.getTransform();\n  return {\n    x: point.x * m.a + point.y * m.c + m.e,\n    y: point.x * m.b + point.y * m.d + m.f,\n  };\n};\n\n/**\n * Creates a new HTML IMG element with a snapshot of the\n * canvas. Element will need to be inserted into the document.\n *\n * ```\n * const myCanvas = document.getElementById('someCanvas');\n * const el = copyToImg(myCanvas);\n * document.getElementById('images').appendChild(el);\n * ```\n * @param canvasEl\n * @returns\n */\nexport const copyToImg = (canvasEl: HTMLCanvasElement): HTMLImageElement => {\n  const img = document.createElement(`img`);\n  //eslint-disable-next-line functional/immutable-data\n  img.src = canvasEl.toDataURL(`image/jpeg`);\n  return img;\n};\n\nexport type DotOpts = DrawingOpts & {\n  readonly radius?: number;\n  readonly stroke?: boolean;\n  readonly filled?: boolean;\n  readonly strokeWidth?: number;\n}\n\n/**\n * Draws filled circle(s) at provided point(s)\n * @param ctx\n * @param pos\n * @param opts\n */\nexport const dot = (\n  ctx: CanvasRenderingContext2D,\n  pos: Point | Array<Point | CirclePositioned> | CirclePositioned,\n  opts?: DotOpts\n) => {\n  if (opts === undefined) opts = {};\n  const radius = opts.radius ?? 10;\n  const positions = Array.isArray(pos) ? pos : [ pos ];\n  let stroke = opts.stroke ? opts.stroke : opts.strokeStyle !== undefined;\n  let filled = opts.filled ? opts.filled : opts.fillStyle !== undefined;\n  if (!stroke && !filled) filled = true;\n\n  applyOpts(ctx, opts);\n\n  for (const pos of positions) {\n    ctx.beginPath();\n    if (`radius` in pos) {\n      ctx.arc(pos.x, pos.y, pos.radius, 0, 2 * Math.PI);\n    } else {\n      ctx.arc(pos.x, pos.y, radius, 0, 2 * Math.PI);\n    }\n    if (filled) {\n      ctx.fill();\n    }\n    if (stroke) {\n      ctx.stroke();\n    }\n  }\n\n  // const makePath = () => {\n  //   ctx.beginPath();\n\n  //   // x&y for arc is the center of circle\n  //   if (Array.isArray(pos)) {\n  //     for (const p of pos) {\n  //       ctx.arc(p.x, p.y, radius, 0, 2 * Math.PI);\n  //     }\n  //   } else {\n  //     const p = pos as Point;\n  //     ctx.arc(p.x, p.y, radius, 0, 2 * Math.PI);\n  //   }\n  // }\n  // makePath();\n  // if (opts.filled || !opts.stroke) {\n  //   ctx.fill();\n  // }\n  // if (opts.stroke) {\n  //   if (opts.strokeWidth) ctx.lineWidth = opts.strokeWidth;\n  //   //makePath();\n  //   ctx.stroke();\n  // }\n};\n\n/**\n * Draws a cubic or quadratic bezier\n * @param ctx\n * @param bezierToDraw\n * @param opts\n */\nexport const bezier = (\n  ctx: CanvasRenderingContext2D,\n  bezierToDraw: Beziers.QuadraticBezier | Beziers.CubicBezier,\n  opts?: DrawingOpts\n) => {\n  if (Beziers.isQuadraticBezier(bezierToDraw)) {\n    quadraticBezier(ctx, bezierToDraw, opts);\n  } else if (Beziers.isCubicBezier(bezierToDraw)) {\n    cubicBezier(ctx, bezierToDraw, opts);\n  }\n};\n\nconst cubicBezier = (\n  ctx: CanvasRenderingContext2D,\n  bezierToDraw: Beziers.CubicBezier,\n  opts: DrawingOpts = {}\n) => {\n  // eslint-disable-next-line functional/no-let\n  let stack = applyOpts(ctx, opts);\n\n  const { a, b, cubic1, cubic2 } = bezierToDraw;\n  const isDebug = opts.debug ?? false;\n\n  if (isDebug) {\n    /*\n     * const ss = ctx.strokeStyle;\n     * ctx.strokeStyle = ss;\n     */\n  }\n  ctx.beginPath();\n  ctx.moveTo(a.x, a.y);\n  ctx.bezierCurveTo(cubic1.x, cubic1.y, cubic2.x, cubic2.y, b.x, b.y);\n  ctx.stroke();\n\n  if (isDebug) {\n    //eslint-disable-next-line functional/immutable-data\n    stack = stack.push(\n      optsOp({\n        ...opts,\n        strokeStyle: Colours.opacity(opts.strokeStyle ?? `silver`, 0.6),\n        fillStyle: Colours.opacity(opts.fillStyle ?? `yellow`, 0.4),\n      })\n    );\n\n    stack.apply();\n    ctx.moveTo(a.x, a.y);\n    ctx.lineTo(cubic1.x, cubic1.y);\n    ctx.stroke();\n    ctx.moveTo(b.x, b.y);\n    ctx.lineTo(cubic2.x, cubic2.y);\n    ctx.stroke();\n\n    ctx.fillText(`a`, a.x + 5, a.y);\n    ctx.fillText(`b`, b.x + 5, b.y);\n    ctx.fillText(`c1`, cubic1.x + 5, cubic1.y);\n    ctx.fillText(`c2`, cubic2.x + 5, cubic2.y);\n\n    dot(ctx, cubic1, { radius: 3 });\n    dot(ctx, cubic2, { radius: 3 });\n    dot(ctx, a, { radius: 3 });\n    dot(ctx, b, { radius: 3 });\n    //eslint-disable-next-line functional/immutable-data\n    stack = stack.pop();\n    stack.apply();\n  }\n};\n\nconst quadraticBezier = (\n  ctx: CanvasRenderingContext2D,\n  bezierToDraw: Beziers.QuadraticBezier,\n  opts: DrawingOpts = {}\n) => {\n  const { a, b, quadratic } = bezierToDraw;\n  const isDebug = opts.debug ?? false;\n  // eslint-disable-next-line functional/no-let\n  let stack = applyOpts(ctx, opts);\n\n  ctx.beginPath();\n  ctx.moveTo(a.x, a.y);\n  ctx.quadraticCurveTo(quadratic.x, quadratic.y, b.x, b.y);\n  ctx.stroke();\n\n  if (isDebug) {\n    /*\n     * const fs = ctx.fillStyle;\n     * const ss = ctx.strokeStyle;\n     * ctx.fillStyle = opts.strokeStyle ?? `gray`;\n     * ctx.strokeStyle = opts.strokeStyle ?? `gray`;\n     */\n    //eslint-disable-next-line functional/immutable-data\n    stack = stack.push(\n      optsOp({\n        ...opts,\n        strokeStyle: Colours.opacity(opts.strokeStyle ?? `silver`, 0.6),\n        fillStyle: Colours.opacity(opts.fillStyle ?? `yellow`, 0.4),\n      })\n    );\n    connectedPoints(ctx, [ a, quadratic, b ]);\n\n    ctx.fillText(`a`, a.x + 5, a.y);\n    ctx.fillText(`b`, b.x + 5, b.y);\n    ctx.fillText(`h`, quadratic.x + 5, quadratic.y);\n    dot(ctx, quadratic, { radius: 3 });\n    dot(ctx, a, { radius: 3 });\n    dot(ctx, b, { radius: 3 });\n    /*\n     * ctx.fillStyle = fs;\n     * ctx.strokeStyle = ss;\n     */\n    //eslint-disable-next-line functional/immutable-data\n    stack = stack.pop();\n    stack.apply();\n  }\n};\n\n/**\n * Draws one or more lines.\n *\n * Each line is drawn independently, ie it's not assumed lines are connected.\n *\n * See also:\n * * {@link connectedPoints}: Draw a series of connected points\n * @param ctx\n * @param toDraw\n * @param opts\n */\nexport const line = (\n  ctx: CanvasRenderingContext2D,\n  toDraw: Line | ReadonlyArray<Line>,\n  opts: LineOpts & DrawingOpts = {}\n) => {\n  const isDebug = opts.debug ?? false;\n  const o = lineOp(opts.lineWidth, opts.lineJoin, opts.lineCap);\n  applyOpts(ctx, opts, o);\n\n  const draw = (d: Line) => {\n    const { a, b } = d;\n    ctx.beginPath();\n    ctx.moveTo(a.x, a.y);\n    ctx.lineTo(b.x, b.y);\n    if (isDebug) {\n      ctx.fillText(`a`, a.x, a.y);\n      ctx.fillText(`b`, b.x, b.y);\n      dot(ctx, a, { radius: 5, strokeStyle: `black` });\n      dot(ctx, b, { radius: 5, strokeStyle: `black` });\n    }\n    ctx.stroke();\n  };\n\n  if (Array.isArray(toDraw)) {\n    for (const t of toDraw) draw(t);\n  } else {\n    draw(toDraw as Line);\n  }\n};\n\n/**\n * Draws one or more triangles\n * @param ctx\n * @param toDraw\n * @param opts\n */\nexport const triangle = (\n  ctx: CanvasRenderingContext2D,\n  toDraw: Triangle | ReadonlyArray<Triangle>,\n  opts: DrawingOpts & { readonly filled?: boolean } = {}\n) => {\n  applyOpts(ctx, opts);\n\n  const draw = (t: Triangle) => {\n    connectedPoints(ctx, Triangles.corners(t), { ...opts, loop: true });\n\n    if (opts.debug) {\n      pointLabels(ctx, Triangles.corners(t), undefined, [ `a`, `b`, `c` ]);\n    }\n  };\n\n  if (Array.isArray(toDraw)) {\n    for (const t of toDraw) {\n      draw(t);\n    }\n  } else {\n    draw(toDraw as Triangle);\n  }\n};\n\n// export const arrowFromTip = (ctx:CanvasRenderingContext2D, tipPos: Point, tailLength:number, opts:DrawingOpts) => {\n//   if (opts.fillStyle) ctx.fillStyle = opts.fillStyle;\n//   if (opts.strokeStyle) ctx.strokeStyle = opts.strokeStyle;\n\n//   ctx.save();\n//   ctx.translate\n//   ctx.restore();\n// }\n\nexport type RectOpts = DrawingOpts & {\n  readonly stroke?: boolean;\n  readonly filled?: boolean;\n  readonly strokeWidth?: number;\n}\n\n/**\n * Draws one or more rectangles.\n * \n * @param ctx\n * @param toDraw\n * @param opts\n */\nexport const rect = (\n  ctx: CanvasRenderingContext2D,\n  toDraw: Rect | RectPositioned | ReadonlyArray<RectPositioned>,\n  opts: RectOpts = {}\n) => {\n  applyOpts(ctx, opts);\n\n  const filled = opts.filled ?? (opts.fillStyle === undefined ? false : true);\n  const stroke = opts.stroke ?? (opts.strokeStyle === undefined ? false : true);\n  const draw = (d: RectPositioned | Rect) => {\n    const x = `x` in d ? d.x : 0;\n    const y = `y` in d ? d.y : 0;\n    if (filled) ctx.fillRect(x, y, d.width, d.height);\n    if (stroke) {\n      if (opts.strokeWidth) ctx.lineWidth = opts.strokeWidth;\n      ctx.strokeRect(x, y, d.width, d.height);\n    }\n    if (opts.debug) {\n      pointLabels(ctx, RectsCorners(d), undefined, [ `NW`, `NE`, `SE`, `SW` ]);\n    }\n  };\n\n  if (Array.isArray(toDraw)) {\n    for (const t of toDraw) {\n      draw(t);\n    }\n  } else {\n    draw(toDraw as RectPositioned);\n  }\n};\n\n/**\n * Returns the width of `text`. Rounds number up to nearest multiple if provided. If\n * text is empty or undefined, 0 is returned.\n * @param ctx\n * @param text\n * @param widthMultiple\n * @returns\n */\nexport const textWidth = (\n  ctx: CanvasRenderingContext2D,\n  text?: string | null,\n  padding = 0,\n  widthMultiple?: number\n): number => {\n  const rect = textRect(ctx, text, padding, widthMultiple);\n  return rect.width;\n};\n\nexport const textRect = (ctx: CanvasRenderingContext2D,\n  text?: string | null,\n  padding = 0, widthMultiple?: number): Rect => {\n  if (text === undefined || text === null || text.length === 0) return RectsEmpty;\n  const m = ctx.measureText(text);\n\n  const width = (widthMultiple) ? quantiseEvery(m.width, widthMultiple) + padding : m.width + padding;\n\n  return {\n    width: width,\n    height: m.actualBoundingBoxAscent + m.actualBoundingBoxDescent + padding + padding\n  }\n}\n\nexport const textHeight = (\n  ctx: CanvasRenderingContext2D,\n  text?: string | null,\n  padding = 0): number => {\n  const rect = textRect(ctx, text, padding);\n  return rect.height;\n  // if (text === undefined || text === null || text.length === 0) return 0;\n  // const m = ctx.measureText(text);\n  // return m.actualBoundingBoxAscent + m.actualBoundingBoxDescent + padding + padding;\n}\n\n\n/**\n * Draws a block of text. Each array item is considered a line.\n * @param ctx\n * @param lines\n * @param opts\n */\nexport const textBlock = (\n  ctx: CanvasRenderingContext2D,\n  lines: ReadonlyArray<string>,\n  opts: DrawingOpts & {\n    readonly anchor: Point;\n    readonly anchorPadding?: number;\n    readonly bounds?: RectPositioned;\n  }\n) => {\n  applyOpts(ctx, opts);\n  const anchorPadding = opts.anchorPadding ?? 0;\n\n  const anchor = opts.anchor;\n  const bounds = opts.bounds ?? { x: 0, y: 0, width: 1_000_000, height: 1_000_000 };\n\n  // Measure each line\n  //eslint-disable-next-line functional/prefer-tacit\n  const blocks = lines.map((l) => ctx.measureText(l));\n\n  // Get width and height\n  const widths = blocks.map((tm) => tm.width);\n  const heights = blocks.map(\n    (tm) => tm.actualBoundingBoxAscent + tm.actualBoundingBoxDescent\n  );\n\n  // Find extremes\n  const maxWidth = Math.max(...widths);\n  const totalHeight = heights.reduce((accumulator, value) => accumulator + value, 0);\n\n  // eslint-disable-next-line functional/no-let\n  let { x, y } = anchor;\n\n  if (anchor.x + maxWidth > bounds.width) {\n    x = bounds.width - (maxWidth + anchorPadding);\n  } else x -= anchorPadding;\n\n  if (x < bounds.x) x = bounds.x + anchorPadding;\n\n  if (anchor.y + totalHeight > bounds.height) {\n    y = bounds.height - (totalHeight + anchorPadding);\n  } else y -= anchorPadding;\n\n  if (y < bounds.y) y = bounds.y + anchorPadding;\n\n  for (const [ index, line ] of lines.entries()) {\n    ctx.fillText(line, x, y);\n    y += heights[ index ];\n  }\n};\n\nexport type HorizAlign = `left` | `right` | `center`;\nexport type VertAlign = `top` | `center` | `bottom`;\n\n/**\n * Draws an aligned text block\n */\nexport const textBlockAligned = (\n  ctx: CanvasRenderingContext2D,\n  text: ReadonlyArray<string> | string,\n  opts: DrawingOpts & {\n    readonly bounds: RectPositioned;\n    readonly horiz?: HorizAlign;\n    readonly vert?: VertAlign;\n  }\n) => {\n  const { bounds } = opts;\n  const { horiz = `left`, vert = `top` } = opts;\n\n  const lines = typeof text === `string` ? [ text ] : text;\n\n  applyOpts(ctx, opts);\n\n  ctx.save();\n  ctx.translate(bounds.x, bounds.y);\n  ctx.textAlign = `left`;\n  ctx.textBaseline = `top`;\n  const middleX = bounds.width / 2;\n  const middleY = bounds.height / 2;\n\n  // Measure each line\n  const blocks = lines.map((l) => ctx.measureText(l));\n  const heights = blocks.map(\n    (tm) => tm.actualBoundingBoxAscent + tm.actualBoundingBoxDescent\n  );\n  const totalHeight = heights.reduce((accumulator, value) => accumulator + value, 0);\n\n  let y = 0;\n  if (vert === `center`) y = middleY - totalHeight / 2;\n  else if (vert === `bottom`) {\n    y = bounds.height - totalHeight;\n  }\n\n  for (const [ index, line ] of lines.entries()) {\n    let x = 0;\n    if (horiz === `center`) x = middleX - blocks[ index ].width / 2;\n    else if (horiz === `right`) x = bounds.width - blocks[ index ].width;\n    ctx.fillText(line, x, y);\n    y += heights[ index ];\n  }\n\n  ctx.restore();\n};\n","import { minIndex } from '../numbers/NumericArrays.js';\nimport * as Points from '../geometry/point/index.js';\nimport { clamp } from '../numbers/Clamp.js';\nimport { flip } from '../numbers/Flip.js';\nimport { scale } from '../numbers/Scale.js';\nimport * as Sg from './SceneGraph.js';\nimport { textRect, textWidth } from './Drawing.js';\nimport { getPaths, getField } from '../data/Pathed.js';\nimport { ifNaN, throwNumberTest } from '../util/GuardNumbers.js';\nimport type { Rect, RectPositioned, PointCalculableShape } from '../geometry/Types.js';\nimport type { Point } from '../geometry/point/PointType.js';\nimport { subtract as RectsSubtract } from '../geometry/rect/Subtract.js';\nimport { scaleCanvas } from './ScaleCanvas.js';\nimport { parentSizeCanvas } from '../dom/CanvasSizing.js';\nimport { minMaxAvg } from '../numbers/MinMaxAvg.js';\nimport type { MinMaxAvgTotal } from '../numbers/Types.js';\nimport { throwResult } from 'src/util/Results.js';\n\n/**\n * \n *  const dataStream = new DataStream();\n *  dataStream.in({ key: `x`, value: 0.5 }); \n *  const label = (obj:any) => {\n *    if (`key` in obj) return obj;\n *    return { key: randomKey(), ...obj }\n *  }\n *  const stream = pipeline(dataStream, label);\n *  // Actively compute size of window based on window width\n *  const windowSize = ops.divide(rxWindow.innerWidth, pointSize);\n *  const dataWindow = window(stream, windowSize);\n *  const dataToPoints = (value);\n * \n *  const drawPlot = (dataWindow) => {\n *    for (const dataPoint in dataWindow) {\n *    }\n *  }\n */\n\n/**\n * A data source\n */\nexport type DataSource = {\n  dirty: boolean;\n  type: string;\n  get range(): DataRange;\n  add(value: number): void;\n  clear(): void;\n}\n\nexport type ScalingOption = `normalise` | `independent`\n/**\n * Plot options\n */\nexport type Opts = {\n  /**\n   * If true, Canvas will be resized to fit parent\n   */\n  autoSize?: boolean;\n  /**\n   * Colour for axis lines & labels\n   */\n  axisStrokeColour?: string;\n\n  axisTextColour?: string\n\n  legendTextColour?: string\n  /**\n   * Width for axis lines\n   */\n  axisStrokeWidth?: number;\n  scaling: ScalingOption\n};\n\n/**\n * Series options\n */\nexport type SeriesOpts = {\n  /**\n   * Colour for series\n   */\n  colour: string;\n  /**\n   * Visual width/height (depends on drawingStyle)\n   */\n  width?: number;\n  /**\n   * How series should be rendered\n   */\n  drawingStyle?: `line` | `dotted` | `bar`;\n  /**\n   * Preferred data range\n   */\n  axisRange?: DataRange;\n  /**\n   * If true, range will stay at min/max, rather than continuously adapting\n   * to the current data range.\n   */\n  visualRangeStretch?: boolean;\n\n  formattedPrecision?: number\n};\n\nexport type DataPoint = {\n  value: number;\n  index: number;\n  title?: string;\n};\n\nexport type DataHitPoint = (\n  pt: Point\n) => [ point: DataPoint | undefined, distance: number ];\n\nclass ArrayDataSource implements DataSource {\n  data: Array<number>;\n  series: Series;\n  dirty = false;\n  type = `array`;\n\n  private _range: MinMaxAvgTotal | undefined;\n\n  constructor(series: Series) {\n    this.series = series;\n    this.data = [];\n    this.dirty = true;\n  }\n\n  clear() {\n    this.set([]);\n    this._range = undefined;\n  }\n\n  set(data: Array<number>) {\n    this.data = data;\n    this.dirty = true;\n  }\n\n  get length(): number {\n    return this.data.length;\n  }\n\n  get range(): DataRange {\n    if (!this.dirty && this._range !== undefined) return this._range;\n    this.dirty = false;\n    const updatedRange = minMaxAvg(this.data);\n    if (this._range === undefined || updatedRange.max !== this._range.max || updatedRange.min !== this._range.min) {\n      this._range = updatedRange;\n      return { ...this._range, changed: true };\n    } else {\n      return { ...this._range, changed: false };\n\n    }\n  }\n\n  add(value: number) {\n    this.data = [ ...this.data, value ];\n    this.dirty = true;\n  }\n}\n\nclass StreamingDataSource extends ArrayDataSource {\n  desiredDataPointMinWidth = 5;\n\n  add(value: number) {\n    const lastWidth = this.series.lastPxPerPt;\n    if (lastWidth > -1 && lastWidth < this.desiredDataPointMinWidth) {\n      // Remove older data\n      const pts = Math.floor(this.desiredDataPointMinWidth / lastWidth);\n      const d = [ ...this.data.slice(pts), value ];\n      super.set(d);\n    } else super.add(value);\n  }\n}\n\nexport type DataRange = {\n  min: number;\n  max: number;\n  changed?: boolean;\n};\n\nexport class Series {\n  name: string;\n  colour: string;\n  source: DataSource;\n  drawingStyle: `line` | `dotted` | `bar`;\n  width = 3;\n  dataHitPoint: DataHitPoint | undefined;\n  tooltip?: string;\n  formattedPrecision: number;\n\n  readonly axisRange: DataRange;\n\n  // How many pixels wide per data point on last draw\n  lastPxPerPt = -1;\n\n  protected _visualRange: DataRange;\n  protected _visualRangeStretch: boolean;\n\n  constructor(\n    name: string,\n    sourceType: `array` | `stream`,\n    private plot: Plot,\n    opts: SeriesOpts\n  ) {\n    this.name = name;\n\n    this.drawingStyle = opts.drawingStyle ?? `line`;\n    this.colour = opts.colour;\n    this.width = opts.width ?? 3;\n    this.axisRange = opts.axisRange ?? { min: Number.NaN, max: Number.NaN };\n    this._visualRange = { ...this.axisRange };\n    this._visualRangeStretch = opts.visualRangeStretch ?? true;\n    this.formattedPrecision = opts.formattedPrecision ?? -1;\n    if (sourceType === `array`) {\n      this.source = new ArrayDataSource(this);\n    } else if (sourceType === `stream`) {\n      this.source = new StreamingDataSource(this);\n    } else throw new Error(`Unknown sourceType. Expected array|stream`);\n  }\n\n  formatValue(v: number) {\n    if (this.formattedPrecision < 0) {\n      // Auto\n      if (Math.abs(v) < 100) return v.toFixed(2);\n      return Math.floor(v).toString();\n    } else {\n      return v.toFixed(this.formattedPrecision);\n    }\n  }\n\n  get visualFormatted() {\n    const d = this.visualDataRange;\n    const min = this.formatValue(d.min);\n    const max = this.formatValue(d.max);\n    const longest = min.length > max.length ? min : max;\n    return { min, max, longest };\n  }\n\n  get visualDataRange(): DataRange {\n    let vr = this._visualRange;\n    const sourceRange = this.source.range;\n    let changed = false;\n\n    if (sourceRange.changed) {\n      if (this._visualRangeStretch) {\n        // Stretch range to lowest/highest-seen min/max\n        const rmin = Math.min(ifNaN(vr.min, sourceRange.min), sourceRange.min);\n        const rmax = Math.max(ifNaN(vr.max, sourceRange.max), sourceRange.max);\n        if (rmin !== vr.min || rmax !== vr.max) {\n          // Changed\n          vr = { min: rmin, max: rmax };\n          changed = true;\n        }\n      } else {\n        // Use actual range of data\n        if (!isRangeEqual(sourceRange, vr)) {\n          vr = sourceRange;\n          changed = true;\n        }\n      }\n    }\n    this._visualRange = vr;\n    return { ...vr, changed };\n  }\n\n  scaleValue(value: number): number {\n    if (this.source === undefined) return value;\n    const r = this.visualDataRange;\n    if (r.changed) {\n      this.plot.notify(`range-change`, this.plot.plotArea);\n    }\n    if (r.min == r.max) {\n      // No real scale - only received the same value for this series\n      return 0.5;\n    }\n    return scale(value, r.min, r.max);\n  }\n\n  add(value: number) {\n    throwNumberTest(value, ``, `value`);\n    this.source.add(value);\n    //this.plot.plotArea.layoutInvalidated(`Series.add`);\n    this.plot.plotArea.drawingInvalidated(`Series.add`);\n  }\n\n  /**\n   * Clears the underlying source\n   * and sets a flag that the plot area needs redrawing\n   */\n  clear() {\n    this.source.clear();\n    this._visualRange = { ...this.axisRange };\n    this.plot.plotArea.layoutInvalidated(`Series.clear`);\n  }\n}\n\nexport class PlotArea extends Sg.CanvasBox {\n  paddingPx = 0;\n  piPi = Math.PI * 2;\n  // If pointer is more than this distance away from a data point, it's ignored\n  pointerDistanceThreshold = 20;\n  lastRangeChange = 0;\n  pointer: Point | undefined;\n\n  constructor(private plot: Plot, region: RectPositioned) {\n    super(plot, `PlotArea`, region);\n  }\n\n  clear() {\n    this.lastRangeChange = 0;\n    this.pointer = undefined;\n  }\n\n  protected measureSelf(\n    opts: Sg.MeasureState,\n    _parent?: Sg.Measurement\n  ): Rect | string {\n\n    const axisY = opts.getActualSize(`AxisY`);\n    const padding = this.paddingPx;\n    const legend = opts.getActualSize(`Legend`);\n    const legendHeight = legend?.height ?? 0;\n\n    const axisX = opts.getActualSize(`AxisX`);\n    const axisXHeight = axisX?.height ?? 0;\n\n    if (!axisY) return `No AxisY. Measured: ${ opts.whatIsMeasured().join(`, `) }`;\n    if (!legend) return `No Legend`;\n    if (!axisX) return `No AxisX`;\n\n    return {\n      width: opts.bounds.width - axisY.width - this.paddingPx,\n      height: opts.bounds.height - legendHeight - axisXHeight - padding,\n    };\n  }\n\n  protected layoutSelf(measureState: Sg.MeasureState, _layoutState: Sg.LayoutState, _parent: Sg.Layout) {\n    const axisY = measureState.getActualSize(`AxisY`);\n    //const axisX = measureState.getActualSize(`AxisX`);\n    const padding = this.paddingPx;\n\n    //const legend = measureState.getActualSize(`Legend`);\n    //const legendHeight = legend?.height ?? 0;\n\n    //const axisXHeight = axisX?.height ?? 0;\n    const axisYWidth = axisY?.width ?? 0;\n\n    //const height = this._measuredSize?.height ?? 0;\n\n    return {\n      x: axisYWidth,\n      y: padding // layoutState.bounds.height - height - axisXHeight - legendHeight\n    }\n  }\n\n  protected onNotify(message: string, source: Sg.Box): void {\n    //this.debugLog(`onNotify message: ${ message } source: ${ source.id }`);\n    if (message === `measureApplied` && source === this.plot.axisY)\n      this.layoutInvalidated(`PlotArea.onNotify measureApplied to axisY`);\n    if (message === `laidout` && source === this.plot.legend)\n      this.layoutInvalidated(`PlotArea.onNotify laidout to legend`);\n  }\n\n  // protected onClick(p: Point): void {\n  //   this.plot.frozen = !this.plot.frozen;\n  // }\n\n  protected onPointerLeave(): void {\n    for (const series of this.plot.series.values()) {\n      series.tooltip = undefined;\n    }\n    this.pointer = undefined;\n    (this.plot.legend as Sg.CanvasBox).drawingInvalidated(`PlotArea.onPointerLeave`);\n  }\n\n  protected onPointerMove(p: Point): void {\n    this.pointer = p;\n    this.plot.legend.drawingInvalidated(`PlotArea.onPointerMove`);\n  }\n\n  protected measurePreflight(): void {\n    this.updateTooltip();\n  }\n\n  updateTooltip() {\n    const p = this.pointer;\n    if (p === undefined) return;\n\n    for (const series of this.plot.series.values()) {\n      if (p === undefined) {\n        series.tooltip = undefined;\n        return;\n      }\n      if (series.dataHitPoint === undefined) return;\n      const v = series.dataHitPoint(p);\n      if (v[ 0 ] === undefined) return;\n      if (v[ 1 ] > this.pointerDistanceThreshold) return; // too far away\n      series.tooltip = series.formatValue(v[ 0 ].value);\n      //this.plot.legend.onLayoutNeeded();\n    }\n    this.plot.legend.drawingInvalidated(`PlotArea.updateTooltip`);\n  }\n\n  protected drawSelf(ctx: CanvasRenderingContext2D): void {\n    if (this.plot.frozen) return;\n    const seriesCopy = this.plot.seriesArray(); // [...this.plot.series.values()];\n    //ctx.fillStyle = `hsla(10,50%,50%,0.5)`;\n    //ctx.fillRect(0, 0, this.canvasRegion.width, this.canvasRegion.height);\n\n    // Using -1 for y to catch a few random peaks from sharp lines\n\n    ctx.clearRect(0, -1, this.canvasRegion.width, this.canvasRegion.height + 5);\n    //ctx.strokeStyle = `red`;\n    //ctx.strokeRect(0, 0, this.canvasRegion.width, this.canvasRegion.height);\n    for (const series of seriesCopy) {\n      if (series.source.type === `array` || series.source.type === `stream`) {\n        const arraySeries = series.source as ArrayDataSource;\n        if (arraySeries.data === undefined) return;\n        const d = [ ...arraySeries.data ];\n        this.drawDataSet(series, d, ctx);\n      } else console.warn(`Unknown data source type ${ series.source.type }`);\n    }\n  }\n\n  computeY(series: Series, rawValue: number) {\n    const s = series.scaleValue(rawValue);\n    return flip(s) * this.canvasRegion.height + this.paddingPx;\n  }\n\n  drawDataSet(\n    series: Series,\n    d: Array<number>,\n    ctx: CanvasRenderingContext2D\n  ): void {\n    const padding = this.paddingPx + series.width;\n    const v = RectsSubtract(this.canvasRegion, padding * 2, padding * 3.5);\n    const pxPerPt = v.width / d.length;\n\n    series.lastPxPerPt = pxPerPt;\n    let x = padding;\n\n    ctx.strokeStyle = series.colour;\n    ctx.lineWidth = series.width;\n    const shapes: Array<DataPoint & PointCalculableShape> = [];\n\n    series.dataHitPoint = (pt: Point): [ DataPoint, number ] => {\n      const distances = shapes.map((v) => Points.distanceToExterior(pt, v));\n      const index = minIndex(...distances);\n      const closest = shapes[ index ];\n      if (closest === undefined) [ undefined, 0 ];\n      return [ closest, distances[ index ] ];\n    };\n\n    // eslint-disable-next-line unicorn/prefer-switch\n    if (series.drawingStyle === `line`) {\n      let y = 0;\n      ctx.beginPath();\n\n      // eslint-disable-next-line unicorn/no-for-loop\n      for (let index = 0; index < d.length; index++) {\n        const scaled = clamp(series.scaleValue(d[ index ]));\n        y = padding + this.paddingPx + v.height * flip(scaled);\n        shapes.push({ x, y, index: index, value: d[ index ] });\n\n        if (index == 0) ctx.moveTo(x + pxPerPt / 2, y);\n        else ctx.lineTo(x + pxPerPt / 2, y);\n\n        if (y > this.canvasRegion.height)\n          console.warn(`${ y } h: ${ this.canvasRegion.height }`);\n        x += pxPerPt;\n      }\n      ctx.strokeStyle = series.colour;\n      ctx.stroke();\n    } else if (series.drawingStyle === `dotted`) {\n      let y = 0;\n      ctx.fillStyle = series.colour;\n      // eslint-disable-next-line unicorn/no-for-loop\n      for (let index = 0; index < d.length; index++) {\n        const scaled = series.scaleValue(d[ index ]);\n        y = padding + v.height * flip(scaled);\n        ctx.beginPath();\n        ctx.arc(x + pxPerPt / 2, y, series.width, 0, this.piPi);\n        ctx.fill();\n        shapes.push({ radius: series.width, x, y, index: index, value: d[ index ] });\n        x += pxPerPt;\n      }\n    } else if (series.drawingStyle === `bar`) {\n      ctx.fillStyle = series.colour;\n      const interBarPadding = Math.ceil(pxPerPt * 0.1);\n      // eslint-disable-next-line unicorn/no-for-loop\n      for (let index = 0; index < d.length; index++) {\n        const scaled = series.scaleValue(d[ index ]);\n        const h = v.height * scaled;\n        const r = {\n          x: x + interBarPadding,\n          y: v.height - h + padding,\n          width: pxPerPt - interBarPadding,\n          height: h,\n          index: index,\n          value: d[ index ],\n        };\n        ctx.fillRect(r.x, r.y, r.width, r.height);\n        shapes.push(r);\n        x += pxPerPt;\n      }\n    }\n  }\n}\n\nexport class Legend extends Sg.CanvasBox {\n  sampleSize = { width: 10, height: 10 };\n  padding = 3;\n  widthSnapping = 20;\n\n  labelMeasurements = new Map<string, RectPositioned>();\n\n  constructor(private plot: Plot, region: RectPositioned) {\n    super(plot, `Legend`, region);\n  }\n\n  clear() {\n    /** no-op */\n  }\n\n  protected layoutSelf(measureState: Sg.MeasureState, layoutState: Sg.LayoutState, _parent: Sg.Layout) {\n    const axisY = measureState.getActualSize(`AxisY`);\n    const axisYWidth = axisY?.width ?? 0;\n\n    const height = this._measuredSize?.height ?? 0;\n    return {\n      x: axisYWidth,\n      y: layoutState.bounds.height - height\n    }\n  }\n\n  protected measureSelf(\n    opts: Sg.CanvasMeasureState,\n    _parent?: Sg.Measurement\n  ): Rect | RectPositioned | string {\n    const series = this.plot.seriesArray();\n    const sample = this.sampleSize;\n    const padding = this.padding;\n    const widthSnapping = this.widthSnapping;\n    const ctx = opts.ctx;\n\n    const yAxis = opts.measurements.get(`AxisY`);\n    const yAxisWidth = yAxis?.actual.width ?? 0;\n\n    let rowX = padding;\n    let y = padding;\n    const availableWidth = opts.bounds.width - yAxisWidth - padding;\n    let rowHeight = 0;\n    ctx.textBaseline = `middle`;\n    for (const s of series) {\n      let labelWidth = sample.width + padding;\n      const text = textRect(ctx, s.name, padding, widthSnapping);\n      labelWidth += textWidth(ctx, s.name, padding, widthSnapping);\n\n      if (s.tooltip) {\n        labelWidth += textWidth(ctx, s.tooltip, padding, widthSnapping);\n      }\n\n      rowHeight = Math.min(sample.height + padding + padding, text.height + padding + padding);\n      labelWidth += padding;\n\n      if (rowX + labelWidth > availableWidth) {\n        rowX = padding;\n        y += rowHeight;\n      }\n      const r = { width: 10, height: 10, x: rowX, y };\n      rowX = rowX + labelWidth;\n      this.labelMeasurements.set(s.name, r)\n    }\n\n    return {\n      width: availableWidth,\n      height: y + rowHeight\n    }\n    // const ctx = (opts as Sg.CanvasMeasureState).ctx;\n\n    // const usableWidth = opts.bounds.width - yAxisWidth;\n\n    // let width = padding;\n    // for (const s of series) {\n    //   width += sample.width + padding;\n    //   width += textWidth(ctx, s.name, padding, widthSnapping);\n    //   width += textWidth(ctx, s.tooltip, padding, widthSnapping);\n    // }\n\n    // const rows = Math.max(1, Math.ceil(width / usableWidth));\n    // console.log(`rows: ${ rows }`);\n    // const h = rows * (this.sampleSize.height + this.padding + this.padding);\n    // return {\n    //   x: yAxisWidth,\n    //   y: opts.bounds.height - h,\n    //   width: usableWidth,\n    //   height: h,\n    // };\n  }\n\n  protected drawSelf(ctx: CanvasRenderingContext2D): void {\n    const series = this.plot.seriesArray();\n    const sample = this.sampleSize;\n    const padding = this.padding;\n    this.debugLog(`drawSelf`);\n\n    ctx.clearRect(0, 0, this.canvasRegion.width, this.canvasRegion.height);\n    for (const s of series) {\n      const r = this.labelMeasurements.get(s.name);\n      if (r === undefined) continue;\n      let x = r.x;\n\n      // Draw colour chip\n      ctx.fillStyle = s.colour;\n      ctx.fillRect(x, r.y, sample.width, sample.height);\n      x += sample.width + padding;\n\n      // Label\n      ctx.textBaseline = `middle`;\n      ctx.fillStyle = this.plot.legendTextColour;\n      ctx.fillText(s.name, x, r.y + sample.height / 2);\n\n      if (s.tooltip) {\n        ctx.fillStyle = this.plot.legendTextColour;\n        ctx.fillText(s.tooltip, r.x, r.y + sample.height / 2);\n      }\n    }\n    // const series = this.plot.seriesArray();\n    // const sample = this.sampleSize;\n    // const padding = this.padding;\n    // const widthSnapping = this.widthSnapping;\n\n    // let x = padding;\n    // let y = padding;\n\n    // ctx.clearRect(0, 0, this.canvasRegion.width, this.canvasRegion.height);\n    // let rows = 1;\n    // for (const s of series) {\n    //   ctx.fillStyle = s.colour;\n    //   ctx.fillRect(x, y, sample.width, sample.height);\n    //   x += sample.width + padding;\n    //   ctx.textBaseline = `middle`;\n    //   ctx.fillStyle = this.plot.legendTextColour;\n    //   ctx.fillText(s.name, x, y + sample.height / 2);\n    //   x += textWidth(ctx, s.name, padding, widthSnapping);\n\n    //   if (s.tooltip) {\n    //     ctx.fillStyle = this.plot.legendTextColour;\n    //     ctx.fillText(s.tooltip, x, y + sample.height / 2);\n    //     x += textWidth(ctx, s.tooltip, padding, widthSnapping);\n    //   }\n    //   x += padding;\n    //   if (x > this.canvasRegion.width - 100) {\n    //     x = padding;\n    //     y += sample.height + padding + padding;\n    //     rows++;\n    //     this.debugLog(`drawSelf rows: ${ rows }`);\n    //   }\n    // }\n  }\n\n  protected onNotify(message: string, source: Sg.Box): void {\n    this.debugLog(`onNotify ${ message } source: ${ source.id }`);\n    if (message === `measureApplied` && source === (this._parent as Plot).axisY) {\n      this.layoutInvalidated(`Legend.onNotify measureApplied to axisY`);\n\n    } else if (message == `range-change`) {\n      //this.layoutInvalidated(`Legend.onNotify range-change`);\n    }\n  }\n}\n\nexport class AxisX extends Sg.CanvasBox {\n  paddingPx = 2;\n  colour?: string;\n\n  constructor(private plot: Plot, region: RectPositioned) {\n    super(plot, `AxisX`, region);\n  }\n\n  clear() {\n    /** no-op */\n  }\n\n  protected onNotify(message: string, source: Sg.Box): void {\n    //this.debugLog(message);\n    if (message === `measureApplied` && source === this.plot.axisY) {\n      this.layoutInvalidated(`AxisX.onNotify measureApplied to axisY`);\n    }\n    // if (message === `measureApplied` && source === this.plot.legend) {\n    //   this.layoutInvalidated(`AxisX.onNotify measureApplied to legend`);\n    // }\n  }\n\n  protected drawSelf(ctx: CanvasRenderingContext2D): void {\n    const plot = this.plot;\n    const v = this.canvasRegion;\n    const strokeWidth = plot.axisStrokeWidth;\n\n    const colour = this.colour ?? plot.axisStrokeColour;\n    ctx.strokeStyle = colour;\n\n    ctx.clearRect(0, 0, v.width, v.height);\n\n    //ctx.fillStyle = `hsla(200,50%,50%,0.5)`;\n    //ctx.fillRect(0, 0, v.width, v.height);\n    //this.debugLog(`drawSelf: ${ v.width } x ${ v.height } padding: ${ this.paddingPx }`);\n    ctx.beginPath();\n    ctx.lineWidth = strokeWidth;\n    ctx.moveTo(0, strokeWidth / 2);\n    ctx.lineTo(v.width, strokeWidth / 2);\n    ctx.stroke();\n  }\n\n  protected measureSelf(\n    opts: Sg.CanvasMeasureState,\n    _parent?: Sg.Measurement\n  ): Rect | RectPositioned | string {\n    const plot = this.plot;\n    const padding = this.paddingPx;\n    const yAxis = opts.measurements.get(`AxisY`);\n    const yAxisWidth = yAxis?.actual.width ?? 0;\n\n    // TODO: If we start using x-axis labels\n    const heightOfText = 0;//textHeight(opts.ctx, `100`, padding);\n    const h = plot.axisStrokeWidth + heightOfText + padding + padding;\n\n    return {\n      width: opts.bounds.width - yAxisWidth - padding,\n      height: h,\n    };\n  }\n\n  protected layoutSelf(measureState: Sg.MeasureState, _layoutState: Sg.LayoutState, _parent?: Sg.Layout | undefined): Point | undefined {\n    const yAxis = measureState.measurements.get(`AxisY`);\n    const legend = measureState.getActualSize(`Legend`);\n    const legendHeight = legend?.height ?? 0;\n\n    const yAxisWidth = yAxis?.actual.width ?? 0;\n\n    const height = this._measuredSize?.height ?? 0;\n    return {\n      x: yAxisWidth,\n      y: measureState.bounds.height - height - legendHeight\n    }\n  }\n}\n\nconst isRangeEqual = (a: DataRange, b: DataRange) =>\n  a.max === b.max && a.min === b.min;\nconst isRangeSinglePoint = (a: DataRange) => a.max === a.min;\n\n//export type AxisYStyle = `common`;\n\nexport class AxisY extends Sg.CanvasBox {\n  // Total character width of label\n  private _minCharLength = 3;\n\n  //seriesToShow: string | undefined;\n  paddingPx = 3;\n  colour?: string;\n  //style: AxisYStyle;\n\n  showDataLabels: boolean;\n  lastRange: DataRange;\n  lastPlotAreaHeight = 0;\n\n  constructor(private plot: Plot, region: RectPositioned) {\n    super(plot, `AxisY`, region);\n    this.lastRange = { min: 0, max: 0 };\n    this.showDataLabels = true;\n  }\n\n  clear() {\n    this.lastRange = { min: 0, max: 0 };\n    this.lastPlotAreaHeight = 0;\n  }\n\n  protected measurePreflight(): void {\n    this.debugLog(`measurePreflight`);\n    // const series = this.getSeries();\n    // if (\n    //   series !== undefined &&\n    //   !isRangeEqual(series.visualRange, this.lastRange)\n    // ) {\n    //   this.layoutInvalidated(`AxisY.measurePreflight`);\n    // }\n  }\n\n  protected onNotify(message: string, source: Sg.Box): void {\n    //this.debugLog(message);\n    const pa = this.plot.plotArea;\n    if (message === `range-change`) {\n      // Notification that series range has changed\n      this.drawingInvalidated(`range-change`);\n      return;\n    }\n\n    if (message === `measureApplied` && source === pa && (pa.canvasRegion.height !== this.lastPlotAreaHeight)) {\n      this.lastPlotAreaHeight = pa.canvasRegion.height;\n      this.drawingInvalidated(`AxisY.onNotify height change`);\n    }\n  }\n\n  protected measureSelf(copts: Sg.CanvasMeasureState): Rect {\n    this.debugLog(`measureSelf. needsLayout: ${ this._needsLayoutX } needsDrawing: ${ this._needsDrawing }`);\n\n    if (copts.ctx === undefined) throw new Error(`opts.ctx is undefined`);\n\n    //const paddingPx = this.paddingPx;\n    //let width = this.plot.axisStrokeWidth + paddingPx;\n\n    switch (this.plot.scaling) {\n      case `normalise`:\n        return this.#measureNormalise(copts);\n      default:\n        return this.#measureIndependent(copts);\n    }\n  }\n\n  #measureIndependent(copts: Sg.CanvasMeasureState): Rect {\n    const paddingPx = this.paddingPx;\n    let width = this.plot.axisStrokeWidth + paddingPx;\n    if (this.showDataLabels) {\n      for (const s of this.plot.seriesArray()) {\n        const r = s.visualFormatted;\n        let chars = Math.max(r.longest.length, this._minCharLength);\n        width += textWidth(copts.ctx, `9`.repeat(chars + 1), paddingPx);\n      }\n    }\n    //const w = copts.resolveToPx(this.desiredRegion?.width, width, width);\n\n    return {\n      width,\n      height: copts.bounds.height\n    }\n  }\n\n  /**\n   * Single data display\n   * @param copts \n   * @returns \n   */\n  #measureNormalise(copts: Sg.CanvasMeasureState): Rect {\n    const paddingPx = this.paddingPx;\n    let width = this.plot.axisStrokeWidth + paddingPx;\n\n    if (this.showDataLabels) {\n      width += textWidth(copts.ctx, `100%`, paddingPx * 2);\n    }\n    const w = copts.resolveToPx(this.desiredRegion?.width, width, width);\n\n    return {\n      width: w!,\n      height: copts.bounds.height\n    }\n  }\n\n  protected layoutSelf(_measureState: Sg.MeasureState, _layoutState: Sg.LayoutState, _parent?: Sg.Layout | undefined): Point {\n    return { x: 0, y: 0 }\n  }\n\n  protected drawSelf(ctx: CanvasRenderingContext2D): void {\n    switch (this.plot.scaling) {\n      case `normalise`:\n        this.#drawNormalised(ctx);\n        break;\n      default:\n        this.#drawIndependent(ctx);\n    }\n\n    // const s = this.getSeries();\n    // console.log(s?.visualRange);\n    // if (s === undefined) {\n    //   if (this.seriesToShow === undefined) return;\n    //   console.warn(`Plot AxisY series '${ this.seriesToShow }' is missing.`);\n    // } else {\n    //   this.seriesAxis(s, ctx);\n    // }\n  }\n\n  // getSeries(): Series | undefined {\n  //   return this.seriesToShow === undefined ?\n  //     // Pick first series\n  //     this.plot.seriesArray()[ 0 ] :\n  //     // Try designated series name\n  //     this.plot.series.get(this.seriesToShow);\n  // }\n\n  /**\n  * Draw all the axis on a common scale\n  * @param ctx \n  */\n  #drawNormalised(ctx: CanvasRenderingContext2D) {\n    const plot = this.plot;\n    const plotArea = plot.plotArea;\n    const v = this.canvasRegion;\n    const paddingPx = this.paddingPx;\n    const strokeWidth = plot.axisStrokeWidth;\n    const colour = this.colour ?? plot.axisStrokeColour;\n    ctx.strokeStyle = colour;\n    ctx.fillStyle = colour;\n    ctx.clearRect(0, 0, v.width, v.height);\n\n    //console.log(`height: ${ this.canvasRegion.height }`);\n    //ctx.fillStyle = `yellow`;\n    //ctx.fillRect(0, 0, this.canvasRegion.width, this.canvasRegion.height);\n\n    // Vertical line\n    ctx.beginPath();\n    ctx.lineWidth = strokeWidth;\n    const lineX = v.width - strokeWidth / 2;\n    ctx.moveTo(lineX, plotArea.paddingPx + strokeWidth);\n    ctx.lineTo(lineX, plotArea.canvasRegion.height + paddingPx);// + strokeWidth + strokeWidth);\n    ctx.stroke();\n\n    // Labels\n    ctx.fillStyle = plot.axisTextColour;\n    ctx.textBaseline = `top`;\n\n    const labelWidth = this.canvasRegion.width - strokeWidth - paddingPx;\n    let m = ctx.measureText(`0%`);\n    ctx.fillText(`0%`, labelWidth - m.width, plotArea.canvasRegion.height - paddingPx);\n    m = ctx.measureText(`100%`);\n    ctx.fillText(`100%`, labelWidth - m.width, plotArea.canvasRegion.y);\n  }\n\n  #drawIndependent(ctx: CanvasRenderingContext2D) {\n    const plot = this.plot;\n    const plotArea = plot.plotArea;\n    const v = this.canvasRegion;\n    const paddingPx = this.paddingPx;\n    const strokeWidth = plot.axisStrokeWidth;\n    const colour = this.colour ?? plot.axisStrokeColour;\n    ctx.strokeStyle = colour;\n    ctx.fillStyle = colour;\n    ctx.clearRect(0, 0, v.width, v.height);\n\n    //ctx.fillStyle = `yellow`;\n    //ctx.fillRect(0, 0, this.canvasRegion.width, this.canvasRegion.height);\n\n    // Vertical line\n    ctx.beginPath();\n    ctx.lineWidth = strokeWidth;\n    const lineX = v.width - strokeWidth / 2;\n    ctx.moveTo(lineX, plotArea.paddingPx + strokeWidth);\n    ctx.lineTo(lineX, plotArea.canvasRegion.height + paddingPx);// + strokeWidth + strokeWidth);\n    ctx.stroke();\n\n    const swatchSize = 10;\n    let xOffset = paddingPx;\n    const middleY = (plotArea.canvasRegion.height - paddingPx) / 2;\n    for (const s of this.plot.seriesArray()) {\n      ctx.textBaseline = `top`;\n      const r = s.visualFormatted;\n      let actualWidth = 0;\n      let xPre = xOffset;\n      if (isRangeSinglePoint(s.visualDataRange)) {\n        ctx.fillStyle = plot.axisTextColour;\n\n        let m = ctx.measureText(r.max);\n        //let txtHeight = m.actualBoundingBoxAscent + m.actualBoundingBoxDescent;\n        //ctx.textBaseline = `top`;\n        ctx.fillText(r.max, xOffset, middleY + swatchSize);\n        actualWidth = m.width;\n        xOffset += m.width + paddingPx;\n      } else {\n        ctx.fillStyle = plot.axisTextColour;\n        let m1 = ctx.measureText(r.min);\n        ctx.fillText(r.min, xOffset, plotArea.canvasRegion.height - paddingPx);\n        let m2 = ctx.measureText(r.max);\n        ctx.fillText(r.max, xOffset, plotArea.canvasRegion.y);\n        actualWidth = Math.max(m1.width, m2.width);\n        xOffset += actualWidth + paddingPx;\n      }\n      ctx.fillStyle = s.colour;\n      ctx.fillRect(xPre + (actualWidth / 2 - swatchSize / 2), middleY - (swatchSize / 2), swatchSize, swatchSize);\n    }\n  }\n\n  // seriesAxis(series: Series, ctx: CanvasRenderingContext2D) {\n  //   const plot = this.plot;\n  //   const plotArea = plot.plotArea;\n  //   const v = this.canvasRegion;\n  //   const paddingPx = this.paddingPx;\n  //   const r = series.visualRange;\n  //   const strokeWidth = plot.axisStrokeWidth;\n\n  //   const colour = this.colour ?? plot.axisStrokeColour;\n  //   ctx.strokeStyle = colour;\n  //   ctx.fillStyle = colour;\n\n  //   if (Number.isNaN(r.min) && Number.isNaN(r.max)) return; // Empty\n  //   this.lastRange = r;\n  //   ctx.clearRect(0, 0, v.width, v.height);\n\n  //   // ctx.fillStyle = `yellow`;\n  //   // ctx.fillRect(0, 0, this.canvasRegion.width, this.canvasRegion.height);\n\n  //   ctx.beginPath();\n  //   ctx.lineWidth = strokeWidth;\n  //   const lineX = v.width - strokeWidth / 2;\n  //   ctx.moveTo(lineX, plotArea.paddingPx + strokeWidth);\n  //   ctx.lineTo(lineX, plotArea.canvasRegion.height + paddingPx);// + strokeWidth + strokeWidth);\n  //   ctx.stroke();\n\n  //   ctx.textBaseline = `top`;\n  //   const fromRight = v.width - paddingPx * 4;\n\n  //   ctx.fillStyle = plot.axisTextColour;\n  //   if (isRangeSinglePoint(r)) {\n  //     this.debugLog(`rangeSinglePoint`);\n  //     drawText(ctx, series.formatValue(r.max), (size) => [\n  //       fromRight - size.width,\n  //       plotArea.computeY(series, r.max) - paddingPx * 4,\n  //     ]);\n  //   } else {\n  //     // Draw min/max data labels\n  //     drawText(ctx, series.formatValue(r.max), (size) => [\n  //       fromRight - size.width,\n  //       plotArea.computeY(series, r.max) + strokeWidth / 2,\n  //     ]);\n  //     drawText(ctx, series.formatValue(r.min), (size) => [\n  //       fromRight - size.width,\n  //       plotArea.computeY(series, r.min) - 5,\n  //     ]);\n  //   }\n  // }\n}\n\nconst drawText = (\n  ctx: CanvasRenderingContext2D,\n  text: string,\n  position: (size: TextMetrics) => [ x: number, y: number ]\n) => {\n  if (ctx === undefined) throw new Error(`ctx is undefined`);\n  const size = ctx.measureText(text);\n  const xy = position(size);\n  ctx.fillText(text, xy[ 0 ], xy[ 1 ]);\n};\n\n/**\n * Canvas-based data plotter.\n *\n * ```\n * const p = new Plot(document.getElementById(`myCanvas`), opts);\n *\n * // Plot 1-5 as series  test'\n * p.createSeries(`test`, `array`, [1,2,3,4,5]);\n *\n * // Create a streaming series, add a random number\n * const s = p.createSeries(`test2`, `stream`);\n * s.add(Math.random());\n * ```\n * `createSeries` returns the {@link Series} instance with properties for fine-tuning\n *\n * For simple usage, use `plot(someData)` which automatically creates\n * series for the properties of an object.\n */\nexport class Plot extends Sg.CanvasBox {\n  plotArea: PlotArea;\n  legend: Legend;\n  axisX: AxisX;\n  axisY: AxisY;\n  axisStrokeColour: string;\n  axisTextColour: string;\n  legendTextColour: string;\n\n  axisStrokeWidth: number;\n  series: Map<string, Series>;\n  scaling: ScalingOption;\n  private _frozen = false;\n  private _canvasEl: HTMLCanvasElement;\n  private _ctx: CanvasRenderingContext2D;\n\n  defaultSeriesOpts?: SeriesOpts;\n  constructor(canvasElementOrQuery: HTMLCanvasElement | string, opts: Partial<Opts> = {}) {\n    const { ctx, element, bounds } = scaleCanvas(canvasElementOrQuery);\n    super(undefined, `Plot`);//bounds);\n    this._canvasEl = element;\n    this.bounds = bounds;\n    this.scaling = opts.scaling ?? `normalise`;\n    this._ctx = ctx;\n    if (opts.autoSize) {\n      parentSizeCanvas(element, (event) => {\n        this.bounds = element.getBoundingClientRect();\n        this.plotArea.bounds = this.bounds;\n        this.legend.bounds = this.bounds;\n        this.axisX.bounds = this.bounds;\n        this.axisY.bounds = this.bounds;\n        ctx.clearRect(0, 0, this.bounds.width, this.bounds.height);\n        this.drawingInvalidated(`resize`);\n        this.layoutInvalidated(`resize`);\n\n        this.update(event.ctx, true);\n\n      });\n    }\n\n    this.axisStrokeColour = opts.axisStrokeColour ?? `black`;\n    this.axisTextColour = opts.axisTextColour ?? `black`;\n    this.legendTextColour = opts.legendTextColour ?? `black`;\n\n    this.axisStrokeWidth = opts.axisStrokeWidth ?? 3;\n    this.series = new Map();\n    this.plotArea = new PlotArea(this, bounds);\n    this.legend = new Legend(this, bounds);\n    this.axisX = new AxisX(this, bounds);\n    this.axisY = new AxisY(this, bounds);\n\n    // this.plotArea.debugLayout = true;\n    // this.axisX.debugLayout = true;\n    // this.axisY.debugLayout = true;\n    // this.legend.debugLayout = true;\n    // this.debugLayout = true;\n  }\n\n  update(ctx?: CanvasRenderingContext2D, force = false) {\n    if (ctx === undefined) ctx = this._ctx;\n    super.update(ctx, force);\n    // this.plotArea.update(ctx, force);\n    // this.axisX.update(ctx, force);\n    // this.axisY.update(ctx, force);\n    // this.legend.update(ctx, force);\n  }\n\n  /**\n   * Calls 'clear()' on each of the series\n   */\n  clearSeries() {\n    for (const series of this.series.values()) {\n      series.clear();\n    }\n    this.update();\n  }\n\n  /**\n   * Removes all series, plot, legend\n   * and axis data.\n   */\n  clear() {\n    this.series = new Map();\n    this.plotArea.clear();\n    this.legend.clear();\n    this.axisX.clear();\n    this.axisY.clear();\n    this.layoutInvalidated(`Plot.clear`);\n    this.drawingInvalidated(`Plot.clear`);\n    this.update();\n  }\n\n  get frozen(): boolean {\n    return this._frozen;\n  }\n\n  set frozen(v: boolean) {\n    this._frozen = v;\n    if (v) {\n      this._canvasEl.classList.add(`frozen`);\n      this._canvasEl.title = `Plot frozen. Tap to unfreeze`;\n    } else {\n      this._canvasEl.title = ``;\n      this._canvasEl.classList.remove(`frozen`);\n    }\n  }\n\n  seriesArray(): Array<Series> {\n    return [ ...this.series.values() ];\n  }\n\n  get seriesLength(): number {\n    return this.series.size;\n  }\n\n  /**\n   * Plots a simple object, eg `{ x: 10, y: 20, z: 300 }`\n   * Series are automatically created for each property of `o`\n   *\n   * Be sure to call `update()` to visually refresh.\n   * @param o\n   */\n  plot(o: any) {\n    const paths = getPaths(o, true);\n    let seriesCreated = false;\n    for (const p of paths) {\n      let s = this.series.get(p);\n      if (s === undefined) {\n        s = this.createSeries(p, `stream`);\n        s.drawingStyle = `line`;\n        seriesCreated = true;\n      }\n      const f = getField(o, p);\n      throwResult(f);\n      s.add(f.value as number);\n    }\n    if (seriesCreated) this.legend.layoutInvalidated(`new series`);\n    this.update();\n  }\n\n  createSeriesFromObject(o: any, prefix = ``): Array<Series> {\n    const keys = Object.keys(o);\n    const create = (key: string): Array<Series> => {\n      const v = o[ key ];\n      if (typeof v === `object`) {\n        return this.createSeriesFromObject(v, `${ prefix }${ key }.`);\n      } else if (typeof v === `number`) {\n        return [ this.createSeries(key, `stream`) ];\n      } else {\n        return [];\n      }\n    };\n    return keys.flatMap(k => create(k));\n  }\n\n  createSeries(\n    name?: string,\n    type: `stream` | `array` = `array`,\n    seriesOpts?: SeriesOpts\n  ): Series {\n    const seriesLength = this.seriesLength;\n\n    if (name === undefined) name = `series-${ seriesLength }`;\n    if (this.series.has(name))\n      throw new Error(`Series name '${ name }' already in use`);\n\n    let opts: SeriesOpts = {\n      colour: `hsl(${ (seriesLength * 25) % 360 }, 70%,50%)`,\n      ...seriesOpts,\n    };\n    if (this.defaultSeriesOpts) opts = { ...this.defaultSeriesOpts, ...opts };\n\n    const s = new Series(name, type, this, opts);\n    // if (type === `array` && initialData !== undefined) {\n    //   (s.source as ArrayDataSource).set(initialData);\n    // }\n\n    this.series.set(name, s);\n    this.setReady(true, true);\n    this.plotArea.drawingInvalidated(`Plot.createSeries`);\n    return s;\n  }\n}\n","// #region imports\nimport { intersectsPoint as RectsIntersectsPoint } from '../geometry/rect/Intersects.js';\nimport { isPlaceholder as RectsIsPlaceholder } from '../geometry/rect/Guard.js';\nimport { EmptyPositioned as RectsEmptyPositioned } from '../geometry/rect/Empty.js';\nimport { PlaceholderPositioned as RectsPlaceholderPositioned, Placeholder as RectsPlaceholder } from '../geometry/rect/Placeholder.js';\nimport { hue as randomHue } from '../random/index.js';\nimport type { Point } from '../geometry/point/PointType.js';\nimport type { Rect, RectPositioned } from '../geometry/rect/index.js';\nimport { isEqualSize as RectIsEqualSize } from '../geometry/rect/IsEqual.js';\nimport { isEqual as PointsIsEqual } from '../geometry/point/IsEqual.js';\nimport { Empty as PointsEmpty } from '../geometry/point/Empty.js';\nimport { withoutUndefined } from '../data/arrays/Filter.js';\nimport { clamp as RectsClamp } from '../geometry/rect/Clamp.js';\nimport { subtract as PointsSubtract } from '../geometry/point/Subtract.js';\n// #endregion\nexport type Measurement = {\n  actual: Rect;\n  ref: Box;\n  children: Array<Measurement | undefined>;\n};\n\nexport type Layout = {\n  actual: Point;\n  ref: Box;\n  children: Array<Layout | undefined>;\n};\n\nexport type PxUnit = {\n  value: number;\n  type: `px`;\n};\n\nexport type PcUnit = {\n  value: number;\n  type: `pc`;\n};\n\nexport type BoxUnit = PxUnit | PcUnit;\n\nexport type BoxRect = {\n  x?: BoxUnit;\n  y?: BoxUnit;\n  width?: BoxUnit;\n  height?: BoxUnit;\n};\n\nexport const boxUnitFromPx = (v: number): PxUnit => {\n  return { type: `px`, value: v };\n}\nexport const boxRectFromPx = (x: number, y: number, width: number, height: number): BoxRect => {\n  return {\n    x: boxUnitFromPx(x),\n    y: boxUnitFromPx(y),\n    width: boxUnitFromPx(width),\n    height: boxUnitFromPx(height)\n  }\n}\nexport const boxRectFromRectPx = (r: RectPositioned): BoxRect => {\n  return {\n    x: boxUnitFromPx(r.x),\n    y: boxUnitFromPx(r.y),\n    width: boxUnitFromPx(r.width),\n    height: boxUnitFromPx(r.height)\n  }\n}\n\nconst unitIsEqual = (a: BoxUnit, b: BoxUnit): boolean => {\n  if (a.type === `px` && b.type === `px`) {\n    return a.value === b.value;\n  }\n  return false;\n};\n\nconst boxRectIsEqual = (\n  a: BoxRect | undefined,\n  b: BoxRect | undefined\n): boolean => {\n  if (a === undefined && b === undefined) return true;\n  if (a === undefined) return false;\n  if (b === undefined) return false;\n  if (a.x && b.x && !unitIsEqual(a.x, b.x)) return false;\n  if (a.y && b.y && !unitIsEqual(a.y, b.y)) return false;\n  if (a.width && b.width && !unitIsEqual(a.width, b.width)) return false;\n  if (a.height && b.height && !unitIsEqual(a.height, b.height)) return false;\n  return true;\n};\n\nclass BaseState {\n  bounds: RectPositioned;\n  pass: number;\n  constructor(bounds: RectPositioned) {\n    this.bounds = bounds;\n    this.pass = 0;\n  }\n\n  resolveToPx(u: BoxUnit | undefined, maxValue: number, defaultValue?: number): number | undefined {\n    if (u === undefined && defaultValue !== undefined) return defaultValue;\n    if (u === undefined) return; //throw new Error(`unit undefined`);\n    if (u.type === undefined) throw new TypeError(`Expected 'type' and 'value' fields. Type is missing`);\n    if (u.value === undefined) throw new TypeError(`Expected 'type' and 'value' fields. Value is missing`);\n\n\n    if (u.type === `px`) return u.value;\n    if (u.type === `pc`) return u.value * maxValue;\n    // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n    // @ts-expect-error\n    throw new Error(`Unknown unit type: ${ u.type }`);\n  }\n\n  resolveBox(box: BoxRect | undefined): Rect | RectPositioned | undefined {\n    if (box === undefined) return undefined;\n    const x = this.resolveToPx(box.x, this.bounds.width);\n    const y = this.resolveToPx(box.y, this.bounds.height);\n    const width = this.resolveToPx(box.width, this.bounds.width);\n    const height = this.resolveToPx(box.height, this.bounds.height);\n    if (!width || !height) throw new TypeError(`Expected width and height`);\n    if (x === undefined && y === undefined) {\n      return Object.freeze({ width, height });\n    } else {\n      if (!x || !y) throw new TypeError(`Expected x and y`);\n      return Object.freeze({\n        x, y, width, height\n      });\n    }\n  }\n}\n\nexport class MeasureState extends BaseState {\n  measurements: Map<string, Measurement>;\n\n  constructor(bounds: RectPositioned) {\n    super(bounds);\n    this.measurements = new Map<string, Measurement>();\n  }\n\n  getActualSize(id: string): Rect | undefined {\n    const s = this.measurements.get(id);\n    if (s === undefined) return;\n    if (RectsIsPlaceholder(s.actual)) return;\n    return s.actual;\n  }\n\n  whatIsMeasured(): Array<string> {\n    return [ ...this.measurements.keys() ]\n  }\n}\n\nexport class LayoutState extends BaseState {\n  layouts: Map<string, Layout>;\n\n  constructor(bounds: RectPositioned) {\n    super(bounds);\n    this.layouts = new Map<string, Layout>();\n  }\n}\n/**\n * Box\n */\nexport abstract class Box {\n\n  /** Rectangle Box occupies in canvas/etc */\n  canvasRegion: RectPositioned = RectsPlaceholderPositioned;\n\n  private _desiredRect: BoxRect | undefined;\n\n  protected _measuredSize: Rect | undefined;\n  protected _layoutPosition: Point | undefined;\n\n  protected children: Array<Box> = [];\n  protected readonly _parent: Box | undefined;\n  private _idMap = new Map<string, Box>();\n\n  debugLayout = false;\n\n  private _visible = true;\n  protected _ready = true;\n\n  takesSpaceWhenInvisible = false;\n\n  protected _needsMeasuring = true;\n  protected _needsLayoutX = true;\n  protected _needsDrawing = true;\n\n  debugHue = randomHue();\n  readonly id: string;\n\n  /**\n   * Constructor.\n   * \n   * If `parent` is provided, `parent.onChildAdded(this)` is called.\n   * @param parent parent box \n   * @param id id of this box\n   */\n  constructor(parent: Box | undefined, id: string) {\n    this.id = id;\n    this._parent = parent;\n\n    parent?.onChildAdded(this);\n  }\n\n  /**\n   * Returns _true_ if `box` is a child\n   * @param box \n   * @returns \n   */\n  hasChild(box: Box): boolean {\n    const byReference = this.children.find((c) => c === box);\n    const byId = this.children.find((c) => c.id === box.id);\n    return byReference !== undefined || byId !== undefined;\n  }\n\n  /**\n   * Sends a message to all child boxes.\n   * \n   * This first calls `onNotify` on this instance,\n   * before calling `notify()` on each child.\n   * @param message \n   * @param source \n   */\n  notify(message: string, source: Box) {\n    this.onNotify(message, source);\n    for (const c of this.children) c.notify(message, source);\n  }\n\n  *getChildren() {\n    return this.children.entries();\n  }\n\n  /**\n   * Handles a received message\n   * @param _message \n   * @param _source \n   */\n  protected onNotify(_message: string, _source: Box) {\n    /** no-op */\n  }\n\n  /**\n   * Notification a child box has been added\n   * \n   * Throws if\n   * - child has parent as its own child\n   * - child is same as this\n   * - child is already child of this\n   * @param child \n   */\n  protected onChildAdded(child: Box) {\n    if (child.hasChild(this)) throw new Error(`Recursive`);\n    if (child === this) throw new Error(`Cannot add self as child`);\n    if (this.hasChild(child)) throw new Error(`Child already present`);\n\n    this.children.push(child);\n    this._idMap.set(child.id, child);\n\n    this.layoutInvalidated(`Box.onChildAdded`);\n  }\n\n  /**\n   * Sets `_ready` to `ready`. If `includeChildren` is _true_,\n   * `setReady` is called on each child\n   * @param ready \n   * @param includeChildren \n   */\n  setReady(ready: boolean, includeChildren = false) {\n    this._ready = ready;\n    if (includeChildren) {\n      for (const c of this.children) c.setReady(ready, includeChildren);\n    }\n  }\n\n  /**\n   * Gets visible state\n   */\n  get visible(): boolean {\n    return this._visible;\n  }\n\n  /**\n   * Sets visible state\n   */\n  set visible(v: boolean) {\n    if (this._visible === v) return;\n    this._visible = v;\n\n    // Invalidated because we skip measuring when it is invisible\n    this.layoutInvalidated(`Box.set visible`);\n  }\n\n  /**\n   * Gets the box's desired region, or _undefined_\n   */\n  get desiredRegion(): BoxRect | undefined {\n    return this._desiredRect;\n  }\n\n  /**\n   * Sets the box's desired region.\n   * Calls `onLayoutNeeded()`\n   */\n  set desiredRegion(v: BoxRect | undefined) {\n    if (boxRectIsEqual(v, this._desiredRect)) return;\n    this._desiredRect = v;\n    this.layoutInvalidated(`set desiredRegion`);\n  }\n\n  /**\n   * Calls `notifyChildLayoutNeeded`\n   */\n  layoutInvalidated(reason: string) {\n    if (reason === undefined) debugger;\n    this.debugLog(`layoutInvalidated ${ reason }`);\n    this._needsMeasuring = true;\n    this._needsLayoutX = true;\n    // TODO: Only set to true during measuring if it actually changes\n    this._needsDrawing = true;\n    this.notifyChildLayoutNeeded();\n  }\n\n  drawingInvalidated(_reason: string): void {\n    this._needsDrawing = true;\n    //this.debugLog(`drawingInvalidated ${ reason }`);\n  }\n\n  /**\n   * Called from a child, notifying us that\n   * its layout has changed\n   * @returns \n   */\n  private notifyChildLayoutNeeded() {\n    // TODO: Not all layout changes require re-layout higher up\n    this._needsDrawing = true;\n    this._needsLayoutX = true;\n    this._needsMeasuring = true;\n    if (this._parent === undefined) return;\n    this._parent.notifyChildLayoutNeeded();\n  }\n\n  /**\n   * Returns the root box\n   */\n  get root(): Box {\n    if (this._parent === undefined) return this;\n    return this._parent.root;\n  }\n\n  /**\n   * Prepare for measuring\n   */\n  protected measurePreflight() {\n    /** no-up */\n  }\n\n  /**\n   * Applies actual size, returning _true_ if size is different than before\n   * \n   * 1. Sets `_needsLayout` to _false_.\n   * 2. Sets `visual` to `m`\n   * 3. Calls `measureApply` on each child\n   * 4. If there's a change or `force`, sets `needsDrawing` to _true_, and notifies root of `measureApplied`\n   * @param m Measurement for box\n   * @returns \n   */\n  protected measureApply(m: Measurement) {\n    this._needsMeasuring = false;\n\n    const different = this._measuredSize === undefined ? true : !RectIsEqualSize(m.actual, this._measuredSize);\n    if (different) {\n      //this.debugLog(`measureApply: Size is different than previous. Actual: ${ JSON.stringify(m.actual) } current: ${ JSON.stringify(this._measuredSize) }`);\n      this._needsLayoutX = true;\n    }\n\n    this._measuredSize = { width: m.actual.width, height: m.actual.height };\n\n    for (const c of m.children) {\n      if (c !== undefined) c.ref.measureApply(c);\n    }\n\n    if (different) {\n      this.root.notify(`measureApplied`, this);\n    }\n    return different;\n  }\n\n  protected layoutApply(l: Layout) {\n    this._needsLayoutX = false;\n\n    const different = this._layoutPosition === undefined ? true : !PointsIsEqual(l.actual, this._layoutPosition);\n    // if (different) {\n    //   this.debugLog(`layoutApply. Position different than previous. ${ JSON.stringify(l.actual) }`);\n    // }\n    this._layoutPosition = { x: l.actual.x, y: l.actual.y };\n\n    for (const c of l.children) {\n      if (c !== undefined) c.ref.layoutApply(c);\n    }\n\n    if (different) {\n      this.root.notify(`layoutApplied`, this);\n    }\n    return different;\n  }\n\n  /**\n   * Debug log from this box context\n   * @param m \n   */\n  debugLog(m: any) {\n    if (!this.debugLayout) return;\n    console.log(`SceneGraph[${ this.id }]`, m);\n  }\n\n  layoutStart(measureState: MeasureState, layoutState: LayoutState, force: boolean, parent?: Layout): Layout | undefined {\n    const m: Layout = {\n      ref: this,\n      actual: PointsEmpty,\n      children: [],\n    };\n    // Stash away measurement by id\n    layoutState.layouts.set(this.id, m);\n\n    const currentPosition = this.layoutSelf(measureState, layoutState, parent);\n    this.root.notify(`laidout`, this);\n\n    // For some reason we can't measure\n    if (currentPosition === undefined) return;\n\n    // Assign\n    m.actual = currentPosition;\n\n    m.children = this.children.map((c) => c.layoutStart(measureState, layoutState, force, m));\n    if (withoutUndefined(m.children).length < this.children.length) {\n      return undefined; // One of the children did not resolve\n    }\n    return m;\n  }\n\n  protected layoutSelf(\n    measureState: MeasureState,\n    layoutState: LayoutState,\n    _parent?: Layout\n  ): Point | undefined {\n    // TODO: Proper layout\n    const box = layoutState.resolveBox(this._desiredRect);\n    const x = box === undefined ? 0 : (`x` in box ? box.x : 0);\n    const y = box === undefined ? 0 : (`y` in box ? box.y : 0);\n    if (x === undefined) debugger;\n    if (y === undefined) debugger;\n    return { x, y }\n  }\n\n  /**\n   * Start of measuring\n   * 1. Keeps track of measurements in `opts.measurements`\n   * 2. If this box takes space\n   * 2.1. Measure itself if needed\n   * 2.2. Use size\n   * 2. Calls `measureStart` on each child\n   * @param opts Options\n   * @param force Force measurement\n   * @param parent Parent's measurement \n   * @returns Measurement\n   */\n  measureStart(\n    opts: MeasureState,\n    force: boolean,\n    parent?: Measurement\n  ): Measurement | undefined {\n    this.measurePreflight();\n\n    const m: Measurement = {\n      ref: this,\n      // So far no known measurement\n      actual: RectsPlaceholder,\n      children: [],\n    };\n    // Stash away measurement by id\n    opts.measurements.set(this.id, m);\n\n    if (!this._visible && !this.takesSpaceWhenInvisible) {\n      // If we're not visible, there's no actual size\n      m.actual = RectsEmptyPositioned;\n    } else {\n      let currentMeasurement: Rect | string | undefined = this._measuredSize;\n\n      // If we need to, measure how big it actually is\n      if (this._needsMeasuring || this._measuredSize === undefined) {\n        currentMeasurement = this.measureSelf(opts, parent);\n        this.root.notify(`measured`, this);\n      }\n\n      // For some reason we can't measure\n      if (typeof currentMeasurement === `string`) {\n        //this.debugLog(`measureStart: measureSelf failed: ${ currentMeasurement }`);\n        return;\n      } else if (currentMeasurement === undefined) {\n        //this.debugLog(`measureStart: measureSelf failed for some other reason`);\n        return;\n      }\n\n      // Assign\n      m.actual = currentMeasurement;\n    }\n\n    m.children = this.children.map((c) => c.measureStart(opts, force, m));\n    if (withoutUndefined(m.children).length < this.children.length) {\n      //this.debugLog(`measureStart: Child failed measureStart`);\n      return undefined; // One of the children did not resolve\n    }\n\n    return m;\n  }\n\n  /**\n   * Measure the box\n   * 1. Uses desired rectangle, if possible\n   * 2. Otherwise uses parent's size\n   * @param opts Measure state\n   * @param parent Parent size\n   * @returns \n   */\n  protected measureSelf(\n    opts: MeasureState,\n    parent?: Measurement\n  ): Rect | string {\n    let size = RectsPlaceholder;\n\n    const context = parent ? parent.actual : opts.bounds;\n    const desired = opts.resolveBox(this._desiredRect);\n\n    size = desired ? RectsClamp(desired, context) : context;\n\n    if (RectsIsPlaceholder(size)) {\n      return `Box.measureSelf - No size for box?`;\n    }\n    return size;\n  }\n\n\n  /**\n   * Gets initial state for a run of measurements & layout.\n   * \n   * Called when update() is called\n   * @param context\n   */\n  protected abstract updateBegin(context: any): [ MeasureState, LayoutState ];\n\n  protected abstract updateComplete(measureChanged: boolean, layoutChanged: boolean): void;\n\n  // protected updateDone(state: MeasureState, force: boolean): void {\n  //   this.onUpdateDone(state, force);\n  //   for (const c of this.children) c.updateDone(state, force);\n  // }\n\n  /**\n   * Update has completed\n   * @param state \n   * @param force \n   */\n  //abstract onUpdateDone(state: MeasureState, force: boolean): void;\n\n  /**\n   * Update\n   * 1. Calls `this.updateBegin()` to initialise measurement state\n   * 2. In a loop, run `measureStart()` and then `measureApply` if possible\n   * 3. Call `updateDone` when finished\n   * @param force Force update\n   * @returns \n   */\n  update(context: object, force = false) {\n    if (context === undefined) throw new Error(`context is undefined`);\n\n    if (!this._needsMeasuring && !this._needsLayoutX && !force) return;\n    const [ measureState, layoutState ] = this.updateBegin(context);\n    let attempts = 5;\n    let measureApplied = false;\n    let layoutApplied = false;\n\n    // Measure everything\n    if (this._needsMeasuring || force) {\n      //this.debugLog(`update: needs measuring (force: ${ force }) bounds: ${ JSON.stringify(measureState.bounds) }`);\n      while (attempts--) {\n        const m = this.measureStart(measureState, force);\n        if (m !== undefined) {\n          // Apply measurements\n          this.measureApply(m);\n          if (!this._ready) return;\n          measureApplied = true;\n        }\n      }\n      //this.updateDone(state, force);\n      if (!measureApplied) this.debugLog(`Ran out of measurement attempts`);\n    }\n\n    // Lay it out\n    if (this._needsLayoutX || force) {\n      const p = this.layoutStart(measureState, layoutState, force);\n      if (p === undefined) {\n        this.debugLog(`Warning: could not layout`);\n      } else {\n        this.layoutApply(p);\n        layoutApplied = true;\n      }\n    }\n    this.updateComplete(measureApplied, layoutApplied);\n  }\n}\n\n/**\n * Canvas measure state\n */\nexport class CanvasMeasureState extends MeasureState {\n  readonly ctx: CanvasRenderingContext2D;\n  constructor(bounds: RectPositioned, ctx: CanvasRenderingContext2D) {\n    super(bounds);\n    this.ctx = ctx;\n    if (ctx === undefined) throw new Error(`ctx is undefined`);\n  }\n}\n\nexport class CanvasLayoutState extends LayoutState {\n  readonly ctx: CanvasRenderingContext2D;\n  constructor(bounds: RectPositioned, ctx: CanvasRenderingContext2D) {\n    super(bounds);\n    this.ctx = ctx;\n    if (ctx === undefined) throw new Error(`ctx is undefined`);\n\n  }\n}\n\n/**\n * A Box that exists on a HTMLCanvasElement\n */\nexport class CanvasBox extends Box {\n  bounds: RectPositioned | undefined;\n  constructor(\n    parent: CanvasBox | undefined,\n    //canvasElement: HTMLCanvasElement,\n    id: string,\n    bounds?: RectPositioned\n  ) {\n    super(parent, id);\n    this.bounds = bounds;\n    this.debugLog(`CanvasBox ctor bounds: ${ JSON.stringify(bounds) }`);\n  }\n\n  static fromCanvas(canvasElement: HTMLCanvasElement): CanvasBox {\n    const box = new CanvasBox(undefined, `canvas-box`, canvasElement.getBoundingClientRect());\n    return box;\n  }\n\n  /**\n   * Called if this is the parent Box\n   */\n  public addEventHandlers(element: HTMLElement) {\n    element.addEventListener(`pointermove`, (event) => {\n      const p = { x: event.offsetX, y: event.offsetY };\n      this.notifyPointerMove(p);\n    });\n\n    element.addEventListener(`pointerleave`, (_event) => {\n      this.notifyPointerLeave();\n    });\n\n    element.addEventListener(`click`, (event) => {\n      const p = { x: event.offsetX, y: event.offsetY };\n      this.notifyClick(p);\n    });\n  }\n\n  protected onClick(_p: Point) {\n    /** no-up */\n  }\n\n  /**\n   * Click event has happened on canvas\n   * 1. If it's within our range, call `onClick` and pass to all children via `notifyClick`\n   * @param p \n   * @returns \n   */\n  private notifyClick(p: Point) {\n    if (RectsIsPlaceholder(this.canvasRegion)) return;\n    if (RectsIntersectsPoint(this.canvasRegion, p)) {\n      const pp = PointsSubtract(p, this.canvasRegion.x, this.canvasRegion.y);\n      this.onClick(pp);\n      // TODO: Only call `notifyClick` if child is within range?\n      for (const c of this.children) (c as CanvasBox).notifyClick(pp);\n    }\n  }\n\n  /**\n   * Pointer has left\n   * 1. Pass notification to all children via `notifyPointerLeave`\n   */\n  private notifyPointerLeave() {\n    this.onPointerLeave();\n    for (const c of this.children) (c as CanvasBox).notifyPointerLeave();\n  }\n\n  /**\n   * Pointer has moved\n   * 1. If it's within range `onPointerMove` is called, and pass on to all children via `notifyPointerMove`\n   * @param p \n   * @returns \n   */\n  private notifyPointerMove(p: Point) {\n    if (RectsIsPlaceholder(this.canvasRegion)) return;\n    if (RectsIntersectsPoint(this.canvasRegion, p)) {\n      const pp = PointsSubtract(p, this.canvasRegion.x, this.canvasRegion.y);\n      this.onPointerMove(pp);\n      for (const c of this.children) (c as CanvasBox).notifyPointerMove(pp);\n    }\n  }\n\n  /**\n   * Handler when pointer has left\n   */\n  protected onPointerLeave() {\n    /** no-up */\n  }\n\n  /**\n   * Handler when pointer moves within our region\n   * @param _p \n   */\n  protected onPointerMove(_p: Point) {\n    /** no-up */\n\n  }\n\n  /**\n   * Performs recalculations and drawing as necessary\n   * If nothing needs to happen, function returns.\n   * @param context \n   * @param force Force update\n   */\n  update(context: CanvasRenderingContext2D, force = false) {\n    super.update(context, force);\n    this.draw(context, force);\n  }\n\n  getBounds(): RectPositioned | undefined {\n    return this.bounds === undefined && this._parent ? (this._parent as CanvasBox).bounds : this.bounds;\n  }\n\n  unsetBounds() {\n    this.bounds = undefined;\n  }\n\n  /**\n   * Update begins.\n   * @returns MeasureState\n   */\n  protected updateBegin(context: CanvasRenderingContext2D): [ MeasureState, LayoutState ] {\n    if (context === undefined) throw new Error(`Context is undefined`);\n    let bounds = this.getBounds();\n    //this.debugLog(`updateBegin bounds: ${ JSON.stringify(bounds) } measured: ${ JSON.stringify(this._measuredSize) }`);\n\n    if (bounds === undefined) {\n      this.debugLog(`No bounds for element or parent, using canvas bounds`);\n      bounds = { x: 0, y: 0, width: context.canvas.width, height: context.canvas.height }\n    }\n    return [\n      new CanvasMeasureState(bounds, context),\n      new CanvasLayoutState(bounds, context)\n    ]\n    // if (this.region) {\n    //   return new CanvasMeasureState(this.region);\n    // } else {\n    //   const s = this.canvasEl.getBoundingClientRect();\n\n    //   return new CanvasMeasureState(\n    //     {\n    //       x: 0,\n    //       y: 0,\n    //       width: s.width,\n    //       height: s.height,\n    //     },\n    //     ctx\n    //   );\n    // }\n  }\n\n  protected updateComplete(_measureChanged: boolean, _layoutChanged: boolean): void {\n    //this.debugLog(`updateComplete. measureChanged: ${ _measureChanged } layoutChanged: ${ _layoutChanged } pos: ${ JSON.stringify(this._layoutPosition) }`);\n    this.canvasRegion = RectsPlaceholderPositioned;\n  }\n\n  protected measureApply(m: Measurement): boolean {\n    const different = super.measureApply(m);\n    if (different) this.canvasRegion = RectsPlaceholderPositioned;\n    return different;\n  }\n\n  protected layoutApply(l: Layout): boolean {\n    const different = super.layoutApply(l);\n    if (different) this.canvasRegion = RectsPlaceholderPositioned;\n    return different;\n  }\n\n  public draw(ctx: CanvasRenderingContext2D, force = false) {\n    //this.debugLog(`draw. needs drawing: ${ this._needsDrawing } force: ${ force } pos: ${ JSON.stringify(this._layoutPosition) } size: ${ JSON.stringify(this._measuredSize) }`);\n\n    // if (!this._needsDrawing && !force) return;\n\n    if (this._needsDrawing || force) {\n      if (RectsIsPlaceholder(this.canvasRegion)) {\n        if (this._layoutPosition === undefined) return;\n        if (this._measuredSize === undefined) return;\n        this.canvasRegion = {\n          x: this._layoutPosition.x,\n          y: this._layoutPosition.y,\n          width: this._measuredSize.width,\n          height: this._measuredSize.height\n        }\n      }\n\n      //this.debugLog(`draw: canvasRegion: ${ JSON.stringify(this.canvasRegion) }`);\n      if (this._needsLayoutX || this._needsMeasuring) {\n        //this.debugLog(`draw: warning: drawing with outdated layout / measurements`);\n      }\n      ctx.save();\n      const v = this.canvasRegion;\n      ctx.translate(v.x, v.y);\n      ctx.beginPath();\n      ctx.rect(0, 0, v.width, v.height);\n      ctx.clip();\n\n      if (this.debugLayout) {\n        //ctx.clearRect(0,0,v.width,v.height);\n\n        ctx.lineWidth = 1;\n        ctx.strokeStyle = `hsl(${ this.debugHue }, 100%, 50%)`;\n\n        //ctx.fillStyle = ctx.strokeStyle;\n        //ctx.fillRect(0,0,v.width,v.height);\n\n        ctx.strokeRect(0, 0, v.width, v.height);\n\n        ctx.fillStyle = ctx.strokeStyle;\n        ctx.fillText(this.id, 10, 10, v.width);\n\n        ctx.beginPath();\n        ctx.moveTo(0, 0);\n        ctx.lineTo(v.width, v.height);\n        ctx.stroke();\n      }\n\n      this.drawSelf(ctx);\n\n      this._needsDrawing = false;\n      ctx.restore();\n    }\n    for (const c of this.children) {\n      (c as CanvasBox).draw(ctx, force)\n    }\n  }\n\n  /**\n   * Draw this object\n   * @param _ctx \n   */\n  protected drawSelf(_ctx: CanvasRenderingContext2D): void {\n    /** no-up */\n  }\n}\n","import type { Rect } from \"./RectTypes.js\";\n\n/**\n * Clamps `value` so it does not exceed `maximum`\n * on either dimension. x,y are ignored.\n * \n * ```js\n * clamp({ width:100, height:5 }, { width:10, height:10 }); // { width:10, height:5 }\n * \n * clamp({ width:10, height:10 }, { width:10, height:10 }); // { width:10, height:10 }\n * ```\n * \n * Any existing data on `value` is copied to output.\n * @param value Input rectangle\n * @param maximum Maximum allowed size\n */\nexport const clamp = (value: Rect, maximum: Rect): Rect => {\n  return Object.freeze({\n    ...value,\n    width: Math.min(value.width, maximum.width),\n    height: Math.min(value.height, maximum.height)\n  });\n}","import { resolveEl } from \"../dom/ResolveEl.js\";\n\n/**\n * Scales a canvas to account for retina displays.\n * \n * ```js\n * const r = scaleCanvas(`#my-canvas`);\n * r.ctx;      // CanvasRendering2D\n * r.element;  // HTMLCanvasElement\n * r.bounds;   // {x:number,y:number,width:number,height:number}\n * ```\n * \n * Eg:\n * ```js\n * const { ctx } = scaleCanvas(`#my-canvas`);\n * ctx.fillStyle = `red`;\n * ctx.fillRect(0,0,100,100);\n * ```\n * \n * Throws an error if `domQueryOrElement` does not resolve.w\n * @param domQueryOrElement \n * @returns \n */\nexport const scaleCanvas = (domQueryOrElement: HTMLCanvasElement | string) => {\n  const canvasElement = resolveEl<HTMLCanvasElement>(domQueryOrElement);\n  const ratio = window.devicePixelRatio;\n  canvasElement.style.width = canvasElement.width + `px`;\n  canvasElement.style.height = canvasElement.height + `px`;\n  canvasElement.width *= devicePixelRatio;\n  canvasElement.height *= devicePixelRatio;\n\n  const getContext = () => {\n    const ctx = canvasElement.getContext(`2d`);\n\n    if (ctx === null) throw new Error(`Could not get drawing context`);\n    ctx.save();\n    ctx.scale(ratio, ratio);\n    return ctx;\n  }\n  return { ctx: getContext(), element: canvasElement, bounds: canvasElement.getBoundingClientRect() };\n}","/**\n * Manage a set of colours. Uses CSS variables as a fallback if colour is not added\n *\n */\nexport type Palette = {\n  setElementBase(el: Element): void;\n  has(key: string): boolean;\n\n  /**\n   * Returns a colour by name.\n   *\n   * If the colour is not found:\n   *  1. Try to use a CSS variable `--key`, or\n   *  2. The next fallback colour is used (array cycles)\n   *\n   * @param key\n   * @param fallback\n   * @returns\n   */\n  get(key: string, fallback?: string): string;\n\n  /**\n   * Gets a colour by key, adding and returning fallback if not present\n   * @param key Key of colour\n   * @param fallback Fallback colour if key is not found\n   */\n  getOrAdd(key: string, fallback?: string): string;\n\n  /**\n   * Adds a colour with a given key\n   *\n   * @param key\n   * @param value\n   */\n  add(key: string, value: string): void;\n\n  alias(from: string, to: string): void;\n};\n\nexport const create = (fallbacks?: readonly string[]): Palette =>\n  new PaletteImpl(fallbacks);\n\nclass PaletteImpl {\n  /* eslint-disable-next-line functional/prefer-readonly-type */\n  readonly #store: Map<string, string> = new Map();\n  /* eslint-disable-next-line functional/prefer-readonly-type */\n  readonly #aliases: Map<string, string> = new Map();\n\n  readonly fallbacks: readonly string[];\n  #lastFallback = 0;\n\n  #elementBase: Element;\n\n  constructor(fallbacks?: readonly string[]) {\n    if (fallbacks !== undefined) this.fallbacks = fallbacks;\n    else this.fallbacks = [ `red`, `blue`, `green`, `orange` ];\n    this.#elementBase = document.body;\n  }\n\n  setElementBase(el: Element) {\n    this.#elementBase = el;\n  }\n\n  add(key: string, colour: string) {\n    this.#store.set(key, colour);\n  }\n\n  alias(from: string, to: string) {\n    this.#aliases.set(from, to);\n  }\n\n  get(key: string, fallback?: string): string {\n    const alias = this.#aliases.get(key);\n    if (alias !== undefined) key = alias;\n\n    const c = this.#store.get(key);\n    if (c !== undefined) return c;\n\n    const varName = `--` + key;\n    // eslint-disable-next-line functional/no-let\n    let fromCss = getComputedStyle(this.#elementBase)\n      .getPropertyValue(varName)\n      .trim();\n\n    // Not found\n    if (fromCss === undefined || fromCss.length === 0) {\n      if (fallback !== undefined) return fallback;\n      fromCss = this.fallbacks[ this.#lastFallback ];\n      this.#lastFallback++;\n      if (this.#lastFallback === this.fallbacks.length) this.#lastFallback = 0;\n    }\n    return fromCss;\n  }\n\n  getOrAdd(key: string, fallback?: string): string {\n    if (this.has(key)) return this.get(key);\n    const c = this.get(key, fallback);\n    this.add(key, c);\n    return c;\n  }\n\n  has(key: string): boolean {\n    return this.#store.has(key);\n  }\n}\n","import * as Drawing from \"./Drawing.js\";\nimport * as Bipolar from \"../numbers/Bipolar.js\";\nimport * as Queues from \"../collections/queue/index.js\";\nimport * as Colour from \"./Colour.js\";\nimport { type CirclePositioned } from \"../geometry/index.js\";\nimport type { IQueueImmutable } from \"../collections/queue/IQueueImmutable.js\";\n\n/**\n * Options\n */\nexport type BipolarViewOptions = Readonly<{\n  width?: number,\n  height?: number,\n  labelPrecision?: number\n  labels?: [ string, string ],\n  axisColour?: string,\n  bgColour?: string,\n  whiskerColour?: string,\n  whiskerSize?: number,\n  dotColour?: string,\n  dotRadius?: number,\n  showWhiskers?: boolean,\n  showDot?: boolean,\n  showLabels?: boolean,\n  padding?: number,\n  labelColour?: string,\n  axisWidth?: number,\n  asPercentages?: boolean,\n  /**\n   * If non-zero, will render the last X number of values with increasing opacity.\n   * Default: 0\n   */\n  displayLastValues?: number\n  /**\n   * If _true_, (default) negative y values are at the bottom.\n   * If _false_  negative y values are at the top.\n   */\n  yAxisBottomNegative?: boolean,\n  /**\n   * Custom rendering for background\n   */\n  renderBackground?: Render\n}>\n\nfunction getNumericAttribute(el: HTMLElement, name: string, defaultValue: number) {\n  const a = el.getAttribute(name);\n  if (a === null) return defaultValue;\n  return Number.parseInt(a);\n}\n\nexport type Render = (ctx: CanvasRenderingContext2D, width: number, height: number) => void;\n/**\n * A function that plots a point on the graph\n */\nexport type BipolarView = (x: number, y: number) => void;\n\n/**\n * Initialises a plotter for bipolar values (-1...1)\n * \n * ```js\n * const p = BipolarView.init(`#my-canvas`);\n * // Shows the dot at 1, 0.5\n * p(1, 0.5);\n * ```\n * @param elementQuery \n * @param options \n * @returns \n */\nexport const init = (elementQuery: string, options: BipolarViewOptions = {}): BipolarView => {\n  const element = document.querySelector<HTMLCanvasElement>(elementQuery);\n  if (!element) throw new Error(`Element query could not be found (${ elementQuery })`);\n  const labels = options.labels ?? [ `x`, `y` ];\n  const labelPrecision = options.labelPrecision ?? 2;\n  const asPercentages = options.asPercentages ?? false;\n  const displayLastValues = options.displayLastValues ?? 0;\n  // Flags\n  const showWhiskers = options.showWhiskers ?? true;\n  const showDot = options.showDot ?? true;\n  const showLabels = options.showLabels ?? true;\n  const yAxisBottomNegative = options.yAxisBottomNegative ?? true;\n  // Colours\n  const axisColour = Colour.resolveToString(options.axisColour, `silver`);\n  const bgColour = Colour.resolveToString(options.bgColour, `white`);\n  const whiskerColour = Colour.resolveToString(options.whiskerColour, `black`);\n  const dotColour = Colour.resolveToString(options.dotColour, options.whiskerColour, `black`);\n  const labelColour = Colour.resolveToString(options.labelColour, options.axisColour, `silver`);\n\n  // Sizes\n  const axisWidth = (options.axisWidth ?? 1 * window.devicePixelRatio);\n  const dotRadius = (options.dotRadius ?? 5 * window.devicePixelRatio);\n  const pad = (options.padding ?? 10 * window.devicePixelRatio);\n  const whiskerSize = (options.whiskerSize ?? 5 * window.devicePixelRatio);\n  const width = (options.width ?? getNumericAttribute(element, `width`, 200) * window.devicePixelRatio);\n  const height = (options.height ?? getNumericAttribute(element, `height`, 200) * window.devicePixelRatio);\n\n  let lastValues: IQueueImmutable<CirclePositioned> | undefined;\n  if (displayLastValues > 0) {\n    lastValues = Queues.immutable<CirclePositioned>({\n      capacity: displayLastValues,\n      discardPolicy: `older`\n    });\n  }\n\n  element.width = width;// * window.devicePixelRatio;\n  element.height = height;// * window.devicePixelRatio;\n  element.style.width = `${ (width / window.devicePixelRatio) }px`;\n  element.style.height = `${ (height / window.devicePixelRatio) }px`;\n\n  const midY = height / 2;\n  const midX = width / 2;\n  const ctx = element.getContext(`2d`);\n  if (!ctx) throw new Error(`Could not create drawing context`);\n\n  if (window.devicePixelRatio >= 2) {\n    ctx.font = `20px sans-serif`;\n  }\n  const percentageFormat = (v: number) => `${ Math.round(v * 100) }%`;\n  const fixedFormat = (v: number) => v.toFixed(labelPrecision);\n\n  const valueFormat = asPercentages ? percentageFormat : fixedFormat;\n  if (showLabels) {\n    labels[ 0 ] = labels[ 0 ] + `:`;\n    labels[ 1 ] = labels[ 1 ] + `:`;\n  } else {\n    labels[ 0 ] = ``;\n    labels[ 1 ] = ``;\n  }\n\n  const renderBackground: Render = options.renderBackground ?? ((ctx, width, height): void => {\n    if (options.bgColour === `transparent`) {\n      ctx.clearRect(0, 0, width, height);\n    } else {\n      ctx.fillStyle = bgColour;\n      ctx.fillRect(0, 0, width, height);\n    }\n  });\n\n  return (x: number, y: number) => {\n    x = Bipolar.clamp(x);\n    y = Bipolar.clamp(y);\n\n    renderBackground(ctx, width, height);\n\n    // Labels\n    ctx.fillStyle = labelColour;\n    ctx.textBaseline = `top`;\n    ctx.save();\n    ctx.translate(midX, midY);\n    ctx.rotate(-Math.PI / 2);\n    ctx.fillText((labels[ 1 ] + ` ` + valueFormat(y)).trim(), -midX + pad, 1);\n    ctx.restore();\n    ctx.fillText((labels[ 0 ] + ` ` + valueFormat(x)).trim(), pad, midX + 2);\n\n    if (!yAxisBottomNegative) y *= -1;\n\n    // Axes\n    ctx.strokeStyle = axisColour;\n    ctx.lineWidth = axisWidth;\n    ctx.beginPath();\n    ctx.moveTo(pad, midY);\n    ctx.lineTo(width - pad, midY);\n    ctx.moveTo(midX, pad);\n    ctx.lineTo(midX, height - pad);\n    ctx.stroke();\n    ctx.closePath();\n\n    const yy = (height - pad - pad) / 2 * -y;\n    const xx = (width - pad - pad) / 2 * x;\n    const dotPos = { x: xx, y: yy, radius: dotRadius };\n\n    if (lastValues) {\n      lastValues = lastValues.enqueue(dotPos);\n    }\n    ctx.save();\n    ctx.translate(midX, midY);\n\n    // Dot\n    if (showDot) {\n      if (lastValues) {\n        const opacityStep = 1 / lastValues.length;\n        let opacity = 1;\n        // eslint-disable-next-line unicorn/no-array-for-each\n        lastValues.forEach(d => {\n          const colour = Colour.opacity(dotColour, opacity);\n          Drawing.circle(ctx, d, { fillStyle: colour });\n          opacity -= opacityStep;\n        });\n      } else {\n        Drawing.circle(ctx, dotPos, { fillStyle: dotColour });\n      }\n    }\n\n    // Whiskers\n    if (showWhiskers) {\n      ctx.strokeStyle = whiskerColour;\n\n      // y line\n      ctx.beginPath();\n      ctx.moveTo(0, yy - whiskerSize);\n      ctx.lineTo(0, yy + whiskerSize);\n\n      // x line\n      ctx.moveTo(xx - whiskerSize, 0);\n      ctx.lineTo(xx + whiskerSize, 0);\n      ctx.stroke();\n      ctx.closePath();\n    }\n\n    // Restore transform\n    ctx.restore();\n  }\n}\n","import { type ICircularArray } from '../collections/CircularArray.js';\nimport { resolveEl } from '../dom/ResolveEl.js';\nimport * as Colour from './Colour.js';\nimport * as Drawing from './Drawing.js';\nimport {\n  ofArrayMutable,\n  ofCircularMutable,\n  type IMapOfMutableExtended,\n} from '../collections/map/index.js';\nimport type { Rect, Point } from '../geometry/Types.js';\nimport { parentSizeCanvas } from '../dom/CanvasSizing.js';\nimport { minMaxAvg } from '../numbers/MinMaxAvg.js';\n\nexport type Plotter = {\n  add(value: number, series?: string, skipDrawing?: boolean): void;\n  drawValue(index: number): void;\n  /**\n   * Draws current data. Useful if skipDrawing was true for earlier add() calls.\n   */\n  draw(): void;\n  clear(): void;\n  dispose(): void;\n};\n\n/**\n * Series\n */\nexport type Series = {\n  min: number;\n  max: number;\n  range: number;\n  name: string;\n  colour: string;\n  lastValue?: number;\n  hoverValue?: number;\n};\n\n/**\n * Drawing options\n */\nexport type DrawingOpts = PlotOpts & {\n  x: Axis;\n  y: Axis;\n  ctx: CanvasRenderingContext2D;\n  textHeight: number;\n  capacity: number;\n  coalesce: boolean;\n  margin: number;\n  canvasSize: Rect;\n  clearCanvas: boolean;\n  translucentPlot?: boolean;\n  highlightIndex?: number;\n  leadingEdgeDot: boolean;\n  debug: boolean;\n  digitsPrecision: number;\n  lineWidth: number;\n  defaultSeriesColour: string;\n  defaultSeriesVariable?: string;\n  showLegend: boolean;\n  pointer: { x: number; y: number };\n};\n\n/**\n * Properties for an axis\n */\nexport type Axis = {\n  allowedSeries?: Array<string>;\n  /**\n   * Name of axis, eg `x`\n   */\n  name: string;\n  /**\n   * Colour to use for axis labels\n   */\n  colour?: string;\n  /**\n   * Forced scale for values\n   */\n  scaleRange?: [ number, number ];\n  /**\n   * Forced range for labelling, by default\n   * uses scaleRange\n   */\n  labelRange?: [ number, number ];\n  /**\n   * Width of axis line\n   */\n  lineWidth: number;\n  /**\n   * How line ends\n   */\n  endWith: `none` | `arrow`;\n  /**\n   * Where to place the name of the axis\n   */\n  namePosition: `none` | `end` | `side`;\n  /**\n   * Width for y axis, height for x axis\n   */\n  textSize: number;\n  /**\n   * If true, axis labels (ie numeric scale) are shown. Default: true\n   */\n  showLabels: boolean;\n  /**\n   * If true, a line is drawn to represent axis. Default: true\n   */\n  showLine: boolean;\n};\n\nexport type SeriesColours = Record<string, string | undefined>;\n\n/**\n * Plotter options\n */\nexport type PlotOpts = {\n  debug?: boolean;\n  seriesColours?: SeriesColours;\n  /**\n   * Default: 2\n   */\n  digitsPrecision?: number;\n  x?: Axis;\n  y?: Axis;\n  plotSize?: Rect;\n  autoSizeCanvas?: boolean;\n  style?: `connected` | `dots` | `none`;\n  //palette?: Palette.Palette\n  /**\n   * Number of items to keep in the circular array\n   * Default: 10\n   */\n  capacity?: number;\n  //showYAxis?:boolean\n  //showXAxis?:boolean\n  //yAxes?: string[]|string\n  textHeight?: number;\n  /**\n   * Width of plotted line\n   */\n  lineWidth?: number;\n  /**\n   * If true, sub-pixel data points are ignored\n   */\n  coalesce?: boolean;\n  /**\n   * Fixed range to scale Y values. By default normalises values\n   * as they come in. This will also determine the y-axis labels and drawing\n   */\n  //fixedRange?:[number,number]\n  /**\n   * How many horizontal pixels per data point. If unspecified,\n   * it will scale based on width of canvas and capacity.\n   */\n  //dataXScale?:number\n  defaultSeriesColour?: string;\n  defaultSeriesVariable?: string;\n  showLegend?: boolean;\n};\n\nconst piPi = Math.PI * 2;\n\nexport const defaultAxis = (name: string): Axis => ({\n  endWith: `none`,\n  lineWidth: 1,\n  namePosition: `none`,\n  name: name,\n  showLabels: name === `y`,\n  showLine: true,\n  // For y axis, it's the width, for x axis it's the text height\n  textSize: name === `y` ? 20 : 10,\n});\n\nexport const calcScale = (\n  buffer: BufferType,\n  drawingOpts: DrawingOpts,\n  seriesColours?: SeriesColours\n) => {\n  //const seriesNames = buffer.keys();\n  const scales: Array<Series> = [];\n\n  for (const s of buffer.keys()) {\n    //seriesNames.forEach(s => {\n\n    const series = [ ...buffer.get(s) ];\n    if (series.length === 0) break;\n\n    let { min, max } = minMaxAvg(series);\n    let range = max - min;\n\n    let colour;\n    if (seriesColours !== undefined) {\n      colour = seriesColours[ s ];\n    }\n    if (colour == undefined) {\n      colour = drawingOpts.defaultSeriesVariable ? Colour.getCssVariable(\n        `accent`,\n        drawingOpts.defaultSeriesColour\n      ) : drawingOpts.defaultSeriesColour;\n    }\n\n    if (range === 0) {\n      range = min;\n      min = min - range / 2;\n      max = max + range / 2;\n    }\n    scales.push({\n      min,\n      max,\n      range,\n      name: s,\n      colour: colour,\n    });\n  }\n  return scales;\n};\n\nexport const add = (buffer: BufferType, value: number, series = ``) => {\n  buffer.addKeyedValues(series, value);\n};\n\nexport type BufferType =\n  | IMapOfMutableExtended<number, ICircularArray<number>>\n  | IMapOfMutableExtended<number, ReadonlyArray<number>>;\n\nexport const drawValue = (\n  index: number,\n  buffer: BufferType,\n  drawing: DrawingOpts\n) => {\n  const c = {\n    ...drawing,\n    translucentPlot: true,\n    leadingEdgeDot: false,\n  };\n  draw(buffer, c);\n\n  drawing = {\n    ...drawing,\n    highlightIndex: index,\n    leadingEdgeDot: true,\n    translucentPlot: false,\n    style: `none`,\n    clearCanvas: false,\n  };\n  draw(buffer, drawing);\n};\n\nconst scaleWithFixedRange = (\n  buffer: BufferType,\n  range: [ number, number ],\n  drawing: DrawingOpts\n) =>\n  calcScale(buffer, drawing, drawing.seriesColours).map((s) => ({\n    ...s,\n    range: range[ 1 ] - range[ 0 ],\n    min: range[ 0 ],\n    max: range[ 1 ],\n  }));\n\n/**\n * Draws a `buffer` of data with `drawing` options.\n *\n * @param buffer\n * @param drawing\n */\nexport const draw = (buffer: BufferType, drawing: DrawingOpts) => {\n  const { x: xAxis, y: yAxis, ctx, canvasSize } = drawing;\n  const margin = drawing.margin;\n  // const cap = drawing.capacity === 0 ? buffer.lengthMax : drawing.capacity;\n  const series = drawing.y.scaleRange\n    ? scaleWithFixedRange(buffer, drawing.y.scaleRange, drawing)\n    : calcScale(buffer, drawing, drawing.seriesColours);\n\n  if (drawing.clearCanvas)\n    ctx.clearRect(0, 0, canvasSize.width, canvasSize.height);\n\n  if (drawing.debug) {\n    ctx.strokeStyle = `orange`;\n    ctx.strokeRect(0, 0, canvasSize.width, canvasSize.height);\n  }\n\n  // Move in for margin\n  ctx.translate(margin, margin);\n\n  // Calculate/use plot area\n  const plotSize = drawing.plotSize ?? plotSizeFromBounds(canvasSize, drawing);\n\n  // Draw vertical axes\n  const axisSize = {\n    height: plotSize.height + margin + margin,\n    width: plotSize.width,\n  };\n\n  if (yAxis.showLabels || yAxis.showLine) {\n    // Draw the labels for each series\n    for (const s of series) {\n      if (yAxis.allowedSeries !== undefined && !yAxis.allowedSeries.includes(s.name)) continue;\n      drawYSeriesScale(s, axisSize, drawing);\n    }\n\n    // Draw vertical line\n    if (series.length > 0 && yAxis.showLine)\n      drawYLine(axisSize, series[ 0 ], drawing);\n  }\n\n  // Draw x/horizontal axis if needed\n  if ((xAxis.showLabels || xAxis.showLine) && series.length > 0) {\n    const yPos = yAxis.labelRange ? yAxis.labelRange[ 0 ] : series[ 0 ].min;\n    drawXAxis(\n      plotSize.width,\n      calcYForValue(yPos, series[ 0 ], plotSize.height) +\n      margin +\n      xAxis.lineWidth,\n      drawing\n    );\n  }\n\n  const plotDrawing = {\n    ...drawing,\n    plotSize,\n  };\n\n  const ptr = Drawing.translatePoint(ctx, drawing.pointer);\n  // Draw data for each series\n  for (const s of series) {\n    const data = buffer.getSource(s.name);\n    if (data === undefined) continue;\n\n    let leadingEdgeIndex =\n      buffer.typeName === `circular`\n        ? (data as ICircularArray<number>).pointer - 1\n        : data.length - 1;\n    if (drawing.highlightIndex !== undefined)\n      leadingEdgeIndex = drawing.highlightIndex;\n    ctx.save();\n    ctx.translate(0, margin + margin);\n\n    drawSeriesData(s, data, plotSize, plotDrawing, leadingEdgeIndex);\n    ctx.restore();\n  }\n\n  if (drawing.showLegend) {\n    ctx.save();\n    ctx.translate(0, plotSize.height + margin + margin + margin);\n    const legendSize = {\n      width: plotSize.width,\n      height: drawing.x.textSize + margin + margin,\n    };\n    drawLegend(series, drawing, legendSize);\n    ctx.restore();\n  }\n  ctx.resetTransform();\n};\n\n/**\n * Draw vertical axis\n * @param series\n * @param height\n * @param drawing\n */\nconst drawYSeriesScale = (\n  series: Series,\n  plotSize: Rect,\n  drawing: DrawingOpts\n) => {\n  const { ctx, y, digitsPrecision, margin } = drawing;\n  const { height } = plotSize;\n\n  if (drawing.debug) {\n    ctx.strokeStyle = `purple`;\n    ctx.strokeRect(0, 0, y.textSize, height + margin);\n  }\n\n  ctx.fillStyle = series.colour.length > 0 ? series.colour : `white`;\n\n  // Override colour with axis-defined colour\n  if (y.colour) ctx.fillStyle = y.colour;\n\n  // Draw labels\n  const min = y.labelRange ? y.labelRange[ 0 ] : series.min;\n  const max = y.labelRange ? y.labelRange[ 1 ] : series.max;\n  const range = y.labelRange ? max - min : series.range;\n  const mid = min + range / 2;\n  const halfHeight = drawing.textHeight / 2;\n\n  ctx.textBaseline = `top`;\n  ctx.fillText(\n    min.toFixed(digitsPrecision),\n    0,\n    calcYForValue(min, series, height) - halfHeight\n  );\n  ctx.fillText(\n    mid.toFixed(digitsPrecision),\n    0,\n    calcYForValue(mid, series, height) - halfHeight\n  );\n  ctx.fillText(\n    max.toFixed(digitsPrecision),\n    0,\n    calcYForValue(max, series, height) - margin\n  );\n\n  ctx.translate(y.textSize + margin, 0);\n};\n\nconst drawYLine = (plotSize: Rect, series: Series, drawing: DrawingOpts) => {\n  if (series === undefined) throw new Error(`series undefined`);\n  const { ctx, y } = drawing;\n  const { height } = plotSize;\n\n  const min = y.labelRange ? y.labelRange[ 0 ] : series.min;\n  const max = y.labelRange ? y.labelRange[ 1 ] : series.max;\n\n  const minPos = calcYForValue(min, series, height);\n  const maxPos = calcYForValue(max, series, height);\n\n  // Draw line\n  ctx.translate(y.lineWidth, 0);\n  ctx.lineWidth = y.lineWidth;\n  ctx.beginPath();\n  ctx.moveTo(0, minPos);\n  ctx.lineTo(0, maxPos);\n  ctx.strokeStyle = series.colour;\n  if (y.colour) ctx.strokeStyle = y.colour;\n  ctx.stroke();\n  ctx.translate(y.lineWidth, 0);\n};\n\nconst drawLegend = (\n  series: Array<Series>,\n  drawing: DrawingOpts,\n  size: { width: number; height: number }\n) => {\n  const { ctx } = drawing;\n  const lineSampleWidth = 10;\n\n  let x = 0;\n  const lineY = drawing.margin * 3;\n  const textY = drawing.margin;\n\n  ctx.lineWidth = drawing.lineWidth;\n\n  for (const s of series) {\n    ctx.moveTo(x, lineY);\n    ctx.strokeStyle = s.colour;\n    ctx.lineTo(x + lineSampleWidth, lineY);\n    ctx.stroke();\n    x += lineSampleWidth + drawing.margin;\n\n    let label = s.name;\n    if (s.lastValue)\n      label += ` ` + s.lastValue.toFixed(drawing.digitsPrecision);\n    const labelSize = ctx.measureText(label);\n\n    ctx.fillStyle = s.colour;\n    ctx.fillText(label, x, textY);\n    x += labelSize.width;\n  }\n};\n\nconst drawXAxis = (width: number, yPos: number, drawing: DrawingOpts) => {\n  const { ctx, x, y } = drawing;\n\n  if (!x.showLine) return;\n\n  if (x.colour) ctx.strokeStyle = x.colour;\n  ctx.lineWidth = x.lineWidth;\n  ctx.beginPath();\n\n  // Assumes ctx is translated after drawing Y axis\n  ctx.moveTo(0, yPos);\n  ctx.lineTo(width, yPos);\n  ctx.stroke();\n};\n\n/**\n * Draw series data\n * @param series\n * @param values\n * @param plotSize\n * @param drawing\n */\nconst drawSeriesData = (\n  series: Series,\n  values: ArrayLike<number>,\n  plotSize: Rect,\n  drawing: DrawingOpts,\n  leadingEdgeIndex: number\n) => {\n  const { ctx, lineWidth, translucentPlot = false, margin, x: xAxis } = drawing;\n  const style = drawing.style ?? `connected`;\n  const height = plotSize.height - margin;\n\n  let dataXScale = 1;\n  if (xAxis.scaleRange) {\n    const xAxisRange = xAxis.scaleRange[ 1 ] - xAxis.scaleRange[ 0 ];\n    dataXScale = plotSize.width / xAxisRange;\n  } else {\n    dataXScale = drawing.capacity === 0 ? plotSize.width / values.length : plotSize.width / drawing.capacity;\n  }\n\n  // Step through data faster if per-pixel density is above one\n  const incrementBy = drawing.coalesce\n    ? (dataXScale < 0\n      ? Math.floor(1 / dataXScale)\n      : 1)\n    : 1;\n\n  let x = 0;\n  let leadingEdge: Point | undefined;\n\n  if (drawing.debug) {\n    ctx.strokeStyle = `green`;\n    ctx.strokeRect(0, 0, plotSize.width, plotSize.height);\n  }\n\n  const colourTransform = (c: string) => {\n    if (translucentPlot) return Colour.opacity(c, 0.2);\n    return c;\n  };\n\n  if (style === `dots`) {\n    ctx.fillStyle = colourTransform(series.colour);\n  } else if (style === `none`) {} else {\n    ctx.beginPath();\n    ctx.lineWidth = lineWidth;\n    ctx.strokeStyle = colourTransform(series.colour);\n  }\n\n  for (let index = 0; index < values.length; index += incrementBy) {\n    const y = calcYForValue(values[ index ], series, height) - 1;\n\n    if (style === `dots`) {\n      ctx.beginPath();\n      ctx.arc(x, y, lineWidth, 0, piPi);\n      ctx.fill();\n    } else if (style === `none`) {} else {\n      if (index == 0) ctx.moveTo(x, y);\n      ctx.lineTo(x, y);\n    }\n\n    if (index === leadingEdgeIndex) {\n      leadingEdge = { x, y };\n      series.lastValue = values[ index ];\n    }\n    x += dataXScale;\n  }\n\n  if (style === `connected`) {\n    ctx.stroke();\n  }\n\n  // Draw a circle at latest data point\n  if (leadingEdge !== undefined && drawing.leadingEdgeDot) {\n    ctx.beginPath();\n    ctx.fillStyle = colourTransform(series.colour); // drawing.palette.getOrAdd(`series${series.name}`));\n    ctx.arc(leadingEdge.x, leadingEdge.y, 3, 0, 2 * Math.PI);\n    ctx.fill();\n  }\n};\n\nconst calcYForValue = (v: number, series: Series, height: number) =>\n  (1 - (v - series.min) / series.range) * height;\n\n/**\n * Calculates lost area, given a margin value, axis settings.\n * @param margin\n * @param x\n * @param y\n * @param showLegend\n * @returns\n */\nconst calcSizing = (margin: number, x: Axis, y: Axis, showLegend: boolean) => {\n  let fromLeft = margin;\n  if (y.showLabels) fromLeft += y.textSize;\n  if (y.showLine) fromLeft += y.lineWidth;\n  if (y.showLabels || y.showLine) fromLeft += margin + margin;\n  const fromRight = margin;\n\n  const fromTop = margin + margin;\n  let fromBottom = margin + margin;\n  fromBottom += x.showLabels ? x.textSize : margin;\n  if (x.showLine) fromBottom += x.lineWidth;\n  if (x.showLabels || x.showLine) fromBottom += margin;\n\n  if (showLegend) fromBottom += x.textSize;\n\n  return {\n    left: fromLeft,\n    right: fromRight,\n    top: fromTop,\n    bottom: fromBottom,\n  };\n};\n\nconst plotSizeFromBounds = (\n  bounds: Rect,\n  opts: { margin: number; y: Axis; x: Axis; showLegend: boolean }\n): Rect => {\n  const { width, height } = bounds;\n  const sizing = calcSizing(opts.margin, opts.x, opts.y, opts.showLegend);\n  return {\n    width: width - sizing.left - sizing.right,\n    height: height - sizing.top - sizing.bottom,\n  };\n};\n\nconst canvasSizeFromPlot = (\n  plot: Rect,\n  opts: { margin: number; y: Axis; x: Axis; showLegend: boolean }\n): Rect => {\n  const { width, height } = plot;\n  const sizing = calcSizing(opts.margin, opts.x, opts.y, opts.showLegend);\n  return {\n    width: width + sizing.left + sizing.right,\n    height: height + sizing.top + sizing.bottom,\n  };\n};\n\n/**\n * Creates a simple horizontal data plot within a DIV.\n *\n * ```\n * const p = plot(`#parentDiv`);\n * p.add(10);\n * p.clear();\n *\n * // Plot data using series\n * p.add(-1, `temp`);\n * p.add(0.4, `humidty`);\n * ```\n *\n * Options can be specified to customise plot\n * ```\n * const p = plot(`#parentDiv`, {\n *  capacity: 100,     // How many data points to store (default: 10)\n *  showYAxis: false,  // Toggle whether y axis is shown (default: true)\n *  lineWidth: 2,      // Width of plot line (default: 2)\n *  yAxes:  [`temp`],  // Only show these y axes (by default all are shown)\n *  coalesce: true,    // If true, sub-pixel data points are skipped, improving performance for dense plots at the expense of plot precision\n * });\n * ```\n *\n * For all `capacity` values other than `0`, a circular array is used to track data. Otherwise an array is used that will\n * grow infinitely.\n *\n * By default, will attempt to use CSS variable `--series[seriesName]` for axis colours.\n *  `--series[name]-axis` for titles. Eg `--seriesX`. For data added without a named series,\n * it will use `--series` and `--series-axis`.\n * @param parentElementOrQuery\n * @param opts\n * @return Plotter instance\n */\nexport const plot = (\n  parentElementOrQuery: string | HTMLElement,\n  opts: PlotOpts\n): Plotter => {\n  if (parentElementOrQuery === null)\n    throw new Error(`parentElOrQuery is null. Expected string or element`);\n\n  const parentEl = resolveEl(parentElementOrQuery);\n  let canvasEl: HTMLCanvasElement;\n  let destroyCanvasEl = true;\n  let plotSize: Rect | undefined = opts.plotSize;\n  let canvasSize: Rect;\n  if (parentEl.nodeName === `CANVAS`) {\n    // Use provided canvas\n    canvasEl = parentEl as HTMLCanvasElement;\n    destroyCanvasEl = false;\n    canvasSize = { width: canvasEl.width, height: canvasEl.height };\n  } else {\n    // Create a CANVAS that fills parent\n    canvasEl = document.createElement(`CANVAS`) as HTMLCanvasElement;\n    parentEl.append(canvasEl);\n    plotSize = opts.plotSize;\n    canvasSize = { width: canvasEl.width, height: canvasEl.height };\n  }\n\n  const pointer = { x: 0, y: 0 };\n\n  const onPointerMove = (event: PointerEvent) => {\n    pointer.x = event.offsetX;\n    pointer.y = event.offsetY;\n  };\n\n  canvasEl.addEventListener(`pointermove`, onPointerMove);\n\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  const ctx = canvasEl.getContext(`2d`)!;\n\n  const capacity = opts.capacity ?? 10;\n  const buffer =\n    capacity > 0\n      ? ofCircularMutable<number>({ capacity })\n      : ofArrayMutable<number>();\n  const metrics = ctx.measureText(`Xy`);\n  const coalesce = opts.coalesce ?? true;\n\n  // Sanity-check\n  if (ctx === null) throw new Error(`Drawing context not available`);\n\n  let xAxis = defaultAxis(`x`);\n  if (opts.x) xAxis = { ...xAxis, ...opts.x };\n  let yAxis = defaultAxis(`y`);\n  if (opts.y) yAxis = { ...yAxis, ...opts.y };\n\n  let drawingOpts: DrawingOpts = {\n    ...opts,\n    y: yAxis,\n    x: xAxis,\n    pointer: pointer,\n    capacity,\n    coalesce,\n    plotSize,\n    canvasSize,\n    ctx,\n    textHeight:\n      opts.textHeight ??\n      metrics.actualBoundingBoxAscent + metrics.actualBoundingBoxDescent,\n    style: opts.style ?? `connected`,\n    defaultSeriesColour: opts.defaultSeriesColour ?? `yellow`,\n    margin: 3,\n    clearCanvas: true,\n    leadingEdgeDot: true,\n    debug: opts.debug ?? false,\n    digitsPrecision: opts.digitsPrecision ?? 2,\n    lineWidth: opts.lineWidth ?? 2,\n    showLegend: opts.showLegend ?? false,\n  };\n\n  if (plotSize) {\n    // Size canvas based on given plot size\n    const canvasSize = canvasSizeFromPlot(plotSize, drawingOpts);\n    canvasEl.width = canvasSize.width;\n    canvasEl.height = canvasSize.height;\n\n    drawingOpts.canvasSize = canvasSize;\n  }\n\n  if (opts.autoSizeCanvas) {\n    parentSizeCanvas(canvasEl, (args) => {\n      const bounds = args.bounds;\n      drawingOpts = {\n        ...drawingOpts,\n        plotSize: plotSizeFromBounds(bounds, drawingOpts),\n        canvasSize: bounds,\n      };\n      draw(buffer, drawingOpts);\n    });\n  }\n\n  return {\n    drawValue: (index: number) => {\n      drawValue(index, buffer, drawingOpts);\n    },\n    dispose: () => {\n      canvasEl.removeEventListener(`pointermove`, onPointerMove);\n      if (destroyCanvasEl) canvasEl.remove();\n    },\n    add: (value: number, series = ``, skipDrawing = false) => {\n      add(buffer, value, series);\n      if (skipDrawing) return;\n      draw(buffer, drawingOpts);\n    },\n    draw: () => {\n      draw(buffer, drawingOpts);\n    },\n    clear: () => {\n      buffer.clear();\n    },\n  };\n};\n","export * from './Chance.js';\nexport * from './FloatSource.js';\nexport * from './Gaussian.js';\nexport * from './Guid.js';\nexport * from './Integer.js';\nexport * from './NonZero.js';\nexport * from './String.js';\nexport * from './Time.js';\nexport type * from './Types.js';\nexport * from './Weighted.js';\nexport * from './WeightedIndex.js';\nexport * from './WeightedInteger.js';\n\nexport { randomElement as arrayElement } from '../data/arrays/Random.js';\nexport { randomHue as hue } from '../visual/Colour.js';\nexport { randomIndex as arrayIndex } from '../data/arrays/Random.js';","import { throwNumberTest } from \"../util/GuardNumbers.js\";\nimport type { RandomSource } from \"./Types.js\";\n\n/**\n * Chance of returning `a` or `b`, based on threshold `p`.\n * \n * `p` sets the threshold for picking `b`. The higher the value (up to 1),\n * the more likely `b` will be picked.\n * \n * ```js\n * // 50% of the time it will return 100, 50% 110\n * chance(0.5, 100, 110);\n * // 90% of the time it will yield 110, 10% it will yield 100\n * chance(0.9, 100, 110);\n * ```\n * \n * @param p Threshold to choose option B (value or function)\n * @param a Value or function for option A\n * @param b Value or function for option B\n * @param randomSource Source of random numbers\n * @returns \n */\nexport const chance = <T>(p: number | (() => number), a: T | (() => T), b: T | (() => T), randomSource?: RandomSource): T => {\n  const source = randomSource ?? Math.random;\n  const resolve = <V>(x: V | (() => V)): V => {\n    if (typeof x === `function`) return (x as () => V)();\n    return x;\n  }\n\n  const pp = resolve(p);\n  throwNumberTest(pp, `percentage`, `p`);\n\n  if (source() <= pp) {\n    return resolve(b);\n  } else {\n    return resolve(a);\n  }\n}","import type { RandomSource } from \"./Types.js\";\n\nexport const calculateNonZero = (source: RandomSource = Math.random) => {\n  let v = 0;\n  while (v === 0) {\n    //eslint-disable-next-line functional/no-expression-statements\n    v = source();\n  }\n  return v;\n}","import { calculateNonZero } from \"./NonZero.js\";\nimport type { RandomSource } from \"./Types.js\";\n\n/**\n * Returns a random number with gaussian (ie. bell-curved) distribution\n * \n * @example Random number between 0..1 with gaussian distribution\n * ```js\n * import * as Random from 'https://unpkg.com/ixfx/dist/random.js';\n * Random.gaussian();\n * ```\n * \n * @example Distribution can be skewed\n * ```js\n * Random.gaussian(10);\n * ```\n * \n\n * @param skew Skew factor. Defaults to 1, no skewing. Above 1 will skew to left, below 1 will skew to right\n * @returns \n */\nexport const gaussian = (skew = 1) => gaussianSource(skew)();\n\n/**\n * Returns a function that generates a gaussian-distributed random number\n *  * @example Random number between 0..1 with gaussian distribution\n * ```js\n * import * as Random from 'https://unpkg.com/ixfx/dist/random.js';\n *\n * // Create function\n * const r = Random.gaussianFn();\n *\n * // Generate random value\n * r();\n * ```\n *\n * @example Pass the random number generator elsewhere\n * ```js\n * import * as Random from 'https://unpkg.com/ixfx/dist/random.js';\n * import Arrays from 'https://unpkg.com/ixfx/dist/data.js';\n * const r = Random.gaussianFn(10);\n *\n * // Randomise array with gaussian distribution\n * Arrays.shuffle(r);\n * ```\n * @param skew\n * @returns\n */\nexport const gaussianSource = (skew = 1): RandomSource => {\n  const min = 0;\n  const max = 1;\n  // Source: https://stackoverflow.com/questions/25582882/javascript-math-random-normal-distribution-gaussian-bell-curve\n\n  const compute = (): number => {\n    const u = calculateNonZero();\n    const v = calculateNonZero();\n    //eslint-disable-next-line functional/no-let\n    let result = Math.sqrt(-2 * Math.log(u)) * Math.cos(2 * Math.PI * v);\n\n    result = result / 10 + 0.5; // Translate to 0 -> 1\n    if (result > 1 || result < 0) {\n      result = compute(); //;gaussian(skew); // resample between 0 and 1 if out of range\n    } else {\n      result = Math.pow(result, skew); // Skew\n      result *= max - min; // Stretch to fill range\n      result += min; // offset to min\n    }\n    return result;\n  };\n  return compute;\n};","import type { RandomSource } from \"./Types.js\";\n\n/**\n * Generates a short roughly unique id\n * ```js\n * const id = shortGuid();\n * ```\n * @param options Options.\n * @returns\n */\nexport const shortGuid = (options: Readonly<{ source?: RandomSource }> = {}) => {\n  const source = options.source ?? Math.random;\n  // Via Stackoverflow...\n  const firstPart = Math.trunc(source() * 46_656);\n  const secondPart = Math.trunc(source() * 46_656);\n  const firstPartString = `000${ firstPart.toString(36) }`.slice(-3);\n  const secondPartString = `000${ secondPart.toString(36) }`.slice(-3);\n  return firstPartString + secondPartString;\n};","import type { GenerateRandomOptions, RandomOptions, RandomSource } from \"./Types.js\";\nimport { numberTest as guardNumberTest, integerTest as guardIntegerTest } from '../util/GuardNumbers.js';\nimport { throwFromResult } from '../util/GuardThrowFromResult.js';\nimport { count } from \"../numbers/Count.js\";\nimport { shuffle } from \"../data/arrays/Random.js\";\n\n/**\n * Returns a function that produces a random integer between `max` (exclusive) and 0 (inclusive)\n * Use {@link integer} if you want a random number directly.\n *\n * Invoke directly:\n * ```js\n * integerSource(10)();  // Random number 0-9\n * ```\n *\n * Or keep a reference to re-compute:\n * ```js\n * const r = integerSource(10);\n * r(); // Produce a random integer\n * ```\n *\n * If a negative value is given, this is assumed to be the\n * minimum (inclusive), with 0 as the max (inclusive)\n * ```js\n * integerSource(-5)();  // Random number from -5 to 0\n * ```\n *\n * Specify options for a custom minimum or source of random:\n * ```js\n * integerSource({ max: 5,  min: 10 })();  // Random number 4-10\n * integerSource({ max: -5, min: -10 })(); // Random number from -10 to -6\n * integerSource({ max: 10, source: Math.random })(); // Random number between 0-9, with custom source of random\n * ```\n *\n * Throws an error if max & min are equal\n * @param maxOrOptions Max value (exclusive), or set of options\n * @returns Random integer\n */\nexport const integerSource = (maxOrOptions: number | RandomOptions): RandomSource => {\n  if (typeof maxOrOptions === `undefined`) {\n    throw new TypeError(`maxOrOptions is undefined`);\n  }\n  const options = typeof maxOrOptions === `number` ? { max: maxOrOptions } : maxOrOptions;\n  //eslint-disable-next-line functional/no-let\n  let max = Math.floor(options.max);\n  //eslint-disable-next-line functional/no-let\n  let min = Math.floor(options.min ?? 0);\n\n  // If we just get -5 as the max, invert so\n  // max:1 and min: -5 instead for -5...0 range\n  if (!options.min && max < 0) {\n    max = 1;\n    min = options.max;\n  }\n  const randomSource = options.source ?? Math.random;\n  if (min > max) {\n    throw new Error(`Min value is greater than max (min: ${ min } max: ${ max })`);\n  }\n\n  throwFromResult(guardNumberTest(min, ``, `min`));\n  throwFromResult(guardNumberTest(max, ``, `max`));\n\n  if (max === min) {\n    throw new Error(`Max and min values cannot be the same (${ max })`);\n  }\n\n  // Distance\n  const amt = Math.abs(max - min);\n  return () => Math.floor(randomSource() * amt) + min;\n};\n\n/**\n * Returns a random integer between `max` (exclusive) and 0 (inclusive)\n * Use {@link integerSource} to return a function instead.\n *\n * ```js\n * integer(10);  // Random number 0-9\n * ```\n *\n * If a negative value is given, this is assumed to be the\n * minimum (inclusive), with 0 as the max (inclusive)\n * ```js\n * integer(-5);  // Random number from -5 to 0\n * ```\n *\n * Specify options for a custom minimum or source of random:\n * ```js\n * integer({ max: 5,  min: 10 });  // Random number 4-10\n * integer({ max: -5, min: -10 }); // Random number from -10 to -6\n * integer({ max: 10, source: Math.random }); // Random number between 0-9, with custom source of random\n * ```\n *\n * Throws an error if max & min are equal\n * @param maxOrOptions Max value (exclusive), or set of options\n * @returns Random integer\n */\nexport const integer = (maxOrOptions: number | RandomOptions): number =>\n  integerSource(maxOrOptions)();\n\n/**\n * Returns a generator over random unique integers, up to\n * but not including the given max value.\n *\n * @example 0..9 range\n * ```js\n * const rand = [ ...integerUniqueGen(10) ];\n * // eg: [2, 9, 6, 0, 8, 7, 3, 4, 5, 1]\n * ```\n *\n * @example Options can be provided:\n * ```js\n * // 5..9 range\n * const rand = [ ...integerUniqueGen({ min: 5, max: 10 })];\n * ```\n *\n * Range can be looped. Once the initial random walk through the number\n * range completes, it starts again in a new random way.\n *\n * ```js\n * for (const r of integerUniqueGen({ max: 10, loop: true })) {\n *  // Warning: loops forever\n * }\n * ```\n *\n * Behind the scenes, an array of numbers is created that captures the range, this is then\n * shuffled on the first run, and again whenever the iterator loops, if that's allowed.\n *\n * As a consequence, large ranges will consume larger amounts of memory.\n * @param maxOrOptions\n * @returns\n */\nexport function* integerUniqueGen(\n  maxOrOptions: number | GenerateRandomOptions\n): IterableIterator<number> {\n  const options = typeof maxOrOptions === `number` ? { max: maxOrOptions } : maxOrOptions;\n  const min = options.min ?? 0;\n  const max = options.max;\n  const source = options.source ?? Math.random;\n  const loop = options.loop ?? false;\n\n  throwFromResult(guardIntegerTest(min, ``, `min`));\n  throwFromResult(guardIntegerTest(max, ``, `max`));\n  if (min > max) {\n    throw new Error(`Min value is greater than max. Min: ${ min } Max: ${ max }`);\n  }\n\n  const origRange = [ ...count(max - min, min) ];\n  let numberRange = shuffle(origRange);\n  let index = 0;\n  while (true) {\n    if (index === numberRange.length) {\n      if (loop) numberRange = shuffle(origRange, source);\n      else return;\n    }\n    yield numberRange[ index++ ];\n  }\n}\n","import { integer, integerSource } from \"./Integer.js\";\nimport type { RandomOptions, RandomSource } from \"./Types.js\";\n\n/**\n * Returns a random number of minutes, with a unit of milliseconds.\n * Max value is exclusive.\n * Use {@link minutesMs} to get a value directly, or {@link minutesMsSource} to return a function.\n *\n * @example Random value from 0 to one milli less than 5 * 60 * 1000\n * ```js\n * // Create function that returns value\n * const f = minutesMsSource(5);\n *\n * f(); // Generate value\n * ```\n *\n * @example Specified options:\n * ```js\n * // Random time between one minute and 5 minutes\n * const f = minutesMsSource({ max: 5, min: 1 });\n * f();\n * ```\n *\n * @remarks\n * It's a very minor function, but can make\n * code a little more literate:\n * ```js\n * // Random timeout of up to 5 mins\n * setTimeout(() => { ... }, minutesMsSource(5));\n * ```\n * @param maxMinutesOrOptions\n * @see {@link minutesMs}\n * @returns Function that produces a random value\n */\nexport const minutesMsSource = (\n  maxMinutesOrOptions: number | RandomOptions\n): RandomSource => {\n  const options =\n    typeof maxMinutesOrOptions === `number`\n      ? { max: maxMinutesOrOptions }\n      : maxMinutesOrOptions;\n  const min = (options.min ?? 0) * 60 * 1000;\n  const max = options.max * 60 * 1000;\n  return integerSource({ ...options, max, min });\n};\n\n\n/**\n * @example Random value from 0 to one milli less than 5 * 60 * 1000\n * ```js\n * // Random value from 0 to one milli less than 5*60*1000\n * minuteMs(5);\n * ```\n *\n * @example Specified options:\n * ```js\n * // Random time between one minute and 5 minutes\n * minuteMs({ max: 5, min: 1 });\n * ```\n * @inheritDoc minutesMsSource\n *\n * @param maxMinutesOrOptions\n * @see {@link minutesMsSource}\n * @returns Milliseconds\n */\nexport const minutesMs = (maxMinutesOrOptions: number | RandomOptions): number =>\n  minutesMsSource(maxMinutesOrOptions)();\n\n\n/**\n * Returns function which produces a random number of seconds, with a unit of milliseconds.\n * Maximum value is exclusive.\n * Use {@link secondsMs} to return a random value directly, or {@link secondsMsSource} to return a function.\n *\n * @example Random milliseconds between 0..4999\n * ```js\n * // Create function\n * const f = secondsMsSource(5000);\n * // Produce a value\n * const value = f();\n * ```\n *\n * @example Options can be provided\n * ```js\n * // Random milliseconds between 1000-4999\n * const value = secondsMsSource({ max:5, min:1 })();\n * // Note the extra () at the end to execute the function\n * ```\n *\n * @remarks\n * It's a very minor function, but can make\n * code a little more literate:\n * ```js\n * // Random timeout of up to 5 seconds\n * setTimeout(() => { ...}, secondsMsSource(5));\n * ```\n * @param maxSecondsOrOptions Maximum seconds, or options.\n * @returns Milliseconds\n */\nexport const secondsMsSource = (\n  maxSecondsOrOptions: number | RandomOptions\n): RandomSource => {\n  const options =\n    typeof maxSecondsOrOptions === `number`\n      ? { max: maxSecondsOrOptions }\n      : maxSecondsOrOptions;\n  const min = (options.min ?? 0) * 1000;\n  const max = options.max * 1000;\n  return () => integer({ ...options, max, min });\n};\n\n/**\n * @example Random milliseconds between 0..4999\n * ```js\n * secondsMs(5000);\n * ```\n *\n * @example Options can be provided\n * ```js\n * // Random milliseconds between 1000-4999\n * secondsMs({ max:5, min:1 });\n * ```\n * @inheritDoc secondsMsSource\n * @param maxSecondsOrOptions\n * @returns\n */\nexport const secondsMs = (maxSecondsOrOptions: number | RandomOptions): number =>\n  secondsMsSource(maxSecondsOrOptions)();","import { defaultRandom, type RandomSource } from './Types.js';\nimport { type EasingName, get as EasingGet } from '../modulation/easing/index.js';\n/**\n * Options for producing weighted distribution\n */\nexport type WeightedOptions = Readonly<{\n  /**\n   * Easing function to use (optional)\n   */\n  easing?: EasingName;\n  /**\n   * Random source (optional)\n   */\n  source?: RandomSource;\n}>\n/***\n * Returns a random number, 0..1, weighted by a given easing function.\n * Default easing is `quadIn`, which skews towards zero.\n *\n * Use {@link weightedSource} to return a function instead.\n *\n * ```js\n * import * as Random from 'https://unpkg.com/ixfx/dist/random.js';\n * Random.weighted();          // quadIn easing by default, which skews toward low values\n * Random.weighted(`quadOut`); // quadOut favours high values\n * ```\n * @param easingNameOrOptions Options. Uses 'quadIn' by default.\n * @see {@link weightedSource} Returns a function rather than value\n * @returns Random number (0-1)\n */\nexport const weighted = (\n  easingNameOrOptions: EasingName | WeightedOptions = `quadIn`\n): number => weightedSource(easingNameOrOptions)();\n\n/***\n * Returns a random number, 0..1, weighted by a given easing function.\n * Default easing is `quadIn`, which skews towards zero.\n * Use {@link weighted} to get a value directly.\n *\n * ```js\n * import * as Random from 'https://unpkg.com/ixfx/dist/random.js';\n * const r1 = Random.weightedSource();          // quadIn easing by default, which skews toward low values\n * r1(); // Produce a value\n *\n * const r2 = Random.weightedSource(`quadOut`); // quadOut favours high values\n * r2(); // Produce a value\n * ```\n * @param easingNameOrOptions Easing name or options `quadIn` by default.\n * @see {@link weighted} Returns value instead of function\n * @returns Function which returns a weighted random value\n */\nexport const weightedSource = (\n  easingNameOrOptions: EasingName | WeightedOptions = `quadIn`\n): RandomSource => {\n  const options =\n    typeof easingNameOrOptions === `string`\n      ? { easing: easingNameOrOptions }\n      : easingNameOrOptions;\n  const source = options.source ?? defaultRandom;\n  const easingName = options.easing ?? `quadIn`;\n  const easingFunction = EasingGet(easingName);\n  if (easingFunction === undefined) {\n    throw new Error(`Easing function '${ easingName }' not found.`);\n  }\n\n  const compute = (): number => {\n    const r = source();\n    return easingFunction(r);\n  };\n  return compute;\n};","import { clamp } from \"../numbers/Clamp.js\";\nimport { type RandomSource, defaultRandom } from \"./Types.js\";\nimport type { WeightedOptions } from \"./Weighted.js\";\nimport { throwNumberTest } from '../util/GuardNumbers.js';\nimport { get as EasingGet } from '../modulation/easing/index.js';\nexport type WeightedIntegerOptions = WeightedOptions & Readonly<{\n  min?: number;\n  max: number;\n}>;\n/**\n * Random integer, weighted according to an easing function.\n * Number will be inclusive of `min` and below `max`.\n *\n * @example 0..99\n * ```js\n * import * as Random from 'https://unpkg.com/ixfx/dist/random.js';\n * const r = Random.weightedIntegerFn(100);\n * r(); // Produce value\n * ```\n *\n * @example 20..29\n * ```js\n * const r = Random.weightedIntegerFn({ min: 20, max: 30 });\n * r(); // Produce value\n * ```\n *\n * @example  0..99 with 'quadIn' easing\n * ```js\n * const r = Random.weightedInteger({ max: 100, easing: `quadIn` });\n * ```\n *\n * Note: result from easing function will be clamped to\n * the min/max (by default 0-1);\n *\n * @param maxOrOptions Maximum (exclusive)\n * @returns Function that produces a random weighted integer\n */\nexport const weightedIntegerSource = (\n  maxOrOptions: number | WeightedIntegerOptions\n): RandomSource => {\n  const options = typeof maxOrOptions === `number` ? { max: maxOrOptions } : maxOrOptions;\n  const source = options.source ?? defaultRandom;\n  const max = options.max;\n  const min = options.min ?? 0;\n  const easingName = options.easing ?? `quadIn`;\n  if (typeof max === `undefined`) throw new Error(`max field is undefined`);\n  if (typeof easingName !== `string`) {\n    throw new TypeError(`easing field expected to be string`);\n  }\n  throwNumberTest(max);\n\n  const easingFunction = EasingGet(easingName);\n  if (easingFunction === undefined) {\n    throw new Error(`Easing '${ easingName }' not found`);\n  }\n\n  throwNumberTest(min);\n  if (max <= min) throw new Error(`Max should be greater than min`);\n\n  const compute = (): number => {\n    const r = clamp(easingFunction(source()));\n    return Math.floor(r * (max - min)) + min;\n  };\n  return compute;\n};\n\n/**\n * @example 0..99\n * ```js\n * import * as Random from 'https://unpkg.com/ixfx/dist/random.js';\n * Random.weightedInteger(100);\n * ```\n *\n * @example 20..29\n * ```js\n * Random.weightedInteger({ min: 20, max: 30 });\n * ```\n *\n * @example  0..99 with 'quadIn' easing\n * ```js\n * Random.weightedInteger({ max: 100, easing: `quadIn` })\n * ```\n * @inheritDoc {@link weightedIntegerSource}\n * @param maxOrOptions\n * @returns Random weighted integer\n */\nexport const weightedInteger = (maxOrOptions: number | WeightedIntegerOptions): number =>\n  weightedIntegerSource(maxOrOptions)();","import { LitElement, html, css } from 'lit';\nimport { customElement } from 'lit/decorators.js';\nimport { createRef, type Ref, ref } from 'lit/directives/ref.js';\nimport * as D from '../util/drawing.js';\nimport { type NormalizedLandmark, type Detection, type HandLandmarkerResult, type BoundingBox } from '@mediapipe/tasks-vision';\nimport type { PoseData } from '../types.js';\nimport { expiringMap } from 'ixfx/maps.js';\nimport { Colour } from 'ixfx/visual.js';\nimport type { ProcessorModes } from '../processor-modes.js';\n\n@customElement('overlay-element')\n\nexport class OverlayElement extends LitElement {\n  static override styles = css`\n    :host {\n      display: block;\n      height: 100%;\n      width: 100%;\n    }\n  `;\n\n  canvasEl: Ref<HTMLCanvasElement> = createRef();\n  #colours = expiringMap<string, string>({\n    autoDeleteElapsedMs: 1000,\n    autoDeletePolicy: `get`,\n  });\n  lastHue = 100;\n\n  labelPoints = true;\n\n  override render() {\n    return html`\n      <canvas ${ ref(this.canvasEl) }></canvas>\n    `;\n  }\n\n  setSize(width: number, height: number) {\n    const el = this.canvasEl.value;\n    if (!el) return;\n    el.width = width;\n    el.height = height;\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  draw(mode: ProcessorModes, data?: any) {\n    const el = this.canvasEl.value;\n    if (!el) return;\n\n    const wrap = D.wrap(el);\n    wrap.clear();\n\n    if (!data) return;\n\n    switch (mode) {\n      case `hand`: {\n        this.drawHands(wrap, data as HandLandmarkerResult);\n        break;\n      }\n      case `objects`: {\n        this.drawObjects(wrap, data.detections);\n        break;\n      }\n      case `pose`: {\n        for (const d of data) {\n          if (`poseid` in d) {\n            const pose = d as PoseData;\n            this.drawPose(wrap, pose);\n\n          }\n        }\n        this.drawLandmarks(wrap, data.landmarks);\n        break;\n      }\n      case `face`: {\n        this.drawFaces(wrap, data.detections);\n        break;\n      }\n    }\n  }\n\n\n  drawFaces(wrap: D.Wrapper, d: Detection[]) {\n    for (let i = 0; i < d.length; i++) {\n      const bbox = d[ i ].boundingBox;\n      const colour = Colour.goldenAngleColour(i);\n      for (let k = 0; k < d[ i ].keypoints.length; k++) {\n        const label = this.labelPoints ? k.toString() : ``;\n        wrap.dot(d[ i ].keypoints[ k ], 0.01, colour, label);\n      }\n\n    }\n  }\n\n  drawHands(wrap: D.Wrapper, results: HandLandmarkerResult) {\n    let index = 0;\n    for (const hand of results.landmarks) {\n      const colour = Colour.goldenAngleColour(index);\n      this.drawHand(wrap, hand, colour);\n      this.drawOneSetOfLandmarks(wrap, hand, 0.02, colour);\n\n      index++;\n    }\n  }\n\n  drawHand(wrap: D.Wrapper, p: NormalizedLandmark[], colour: string) {\n    const width = 0.01;\n    wrap.ctx.strokeStyle = colour;\n    wrap.joinPoints(width, p[ 0 ], p[ 1 ], p[ 2 ], p[ 3 ], p[ 4 ]);\n    wrap.joinPoints(width, p[ 5 ], p[ 6 ], p[ 7 ], p[ 8 ]);\n    wrap.joinPoints(width, p[ 9 ], p[ 10 ], p[ 11 ], p[ 12 ]);\n    wrap.joinPoints(width, p[ 13 ], p[ 14 ], p[ 15 ], p[ 16 ]);\n    wrap.joinPoints(width, p[ 17 ], p[ 18 ], p[ 19 ], p[ 20 ]);\n    wrap.joinPoints(width, p[ 5 ], p[ 9 ], p[ 13 ], p[ 17 ], p[ 0 ], p[ 5 ]);\n  }\n\n  drawObjects(wrap: D.Wrapper, data: Detection[]) {\n    const typewriter = D.typewriter(wrap.ctx, 10, 100);\n\n    let index = 0;\n    for (const d of data) {\n      // Object detection\n      const colour = Colour.goldenAngleColour(index);\n      this.drawDetectionBoundingBox(wrap, d as Detection, colour, typewriter);\n      index++;\n    }\n  }\n\n  drawDetectionBoundingBox(wrap: D.Wrapper, det: Detection, colour: string, typewriter: D.Typewriter) {\n    const ctx = wrap.ctx;\n    const bbox = det.boundingBox;\n    if (bbox) {\n      this.drawBoundingBox(ctx, bbox, colour)\n    }\n    if (det.categories) {\n      for (const c of det.categories) {\n        typewriter.line(`${ c.score.toPrecision(2) } - ${ c.categoryName }`, colour);\n      }\n    }\n  }\n\n  drawBoundingBox(ctx: CanvasRenderingContext2D, bbox: BoundingBox, colour: string) {\n    ctx.save();\n    ctx.translate(bbox.originX, bbox.originY);\n    ctx.rotate(bbox.angle);\n    ctx.lineWidth = 5;\n    ctx.strokeStyle = colour;\n    ctx.strokeRect(0, 0, bbox.width, bbox.height);\n    ctx.restore();\n  }\n\n  getColour(id: string) {\n    let colour = this.#colours.get(id);\n    this.#colours.touch(id);\n    if (!colour) {\n      this.lastHue += (45 * Math.random());\n      if (this.lastHue > 360) this.lastHue = this.lastHue % 360;\n      colour = `hsl(${ this.lastHue }deg, 50%, 50%)`;\n      this.#colours.set(id, colour);\n    }\n    return colour;\n  }\n\n  drawLandmarks(wrap: D.Wrapper, poses: NormalizedLandmark[][]) {\n    if (!poses) return;\n    let index = 0;\n    for (const p of poses) {\n      this.drawOneSetOfLandmarks(wrap, p, 0.01, this.getColour(index.toString()));\n      index++;\n    }\n  }\n\n  drawOneSetOfLandmarks(wrap: D.Wrapper, p: NormalizedLandmark[], maxRadius: number, colour: string) {\n    let index = 0;\n    for (const l of p) {\n      let z = -1 * l.z; // Invert so closer is toward 1\n      const r = Math.min(maxRadius * 3, Math.max(0.0001, maxRadius + (maxRadius * z * 3)));\n      const label = this.labelPoints ? index.toString() : ``;\n      wrap.dot(l, r, colour, label);\n      index++;\n    }\n  }\n\n  drawPose(wrap: D.Wrapper, pose: PoseData) {\n    const colour = this.getColour(pose.poseid);\n    this.drawPoseLines(wrap, pose.landmarks, colour);\n    if (this.labelPoints) {\n      this.drawOneSetOfLandmarks(wrap, pose.landmarks, 0.002, colour)\n    }\n  }\n\n  drawPoseLines(wrap: D.Wrapper, p: NormalizedLandmark[], colour: string) {\n    let index = 0;\n    const width = 0.01;\n    wrap.ctx.strokeStyle = colour;\n\n    // Left side\n    wrap.joinPoints(width, p[ 32 ], p[ 30 ], p[ 28 ], p[ 26 ], p[ 24 ], p[ 12 ], p[ 14 ], p[ 16 ], p[ 18 ], p[ 20 ], p[ 16 ], p[ 22 ])\n    // Right side\n    wrap.joinPoints(width, p[ 31 ], p[ 29 ], p[ 27 ], p[ 25 ], p[ 23 ], p[ 11 ], p[ 13 ], p[ 15 ], p[ 17 ], p[ 19 ], p[ 15 ], p[ 21 ])\n\n    // Shoulders\n    wrap.joinPoints(width, p[ 12 ], p[ 11 ]);\n\n    // Hips\n    wrap.joinPoints(width, p[ 24 ], p[ 23 ]);\n\n    // Mouth\n    wrap.joinPoints(width, p[ 10 ], p[ 9 ]);\n\n    // Eyes\n    wrap.joinPoints(width, p[ 8 ], p[ 6 ], p[ 5 ], p[ 4 ], p[ 0 ], p[ 1 ], p[ 2 ], p[ 3 ], p[ 7 ])\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    // @ts-ignore\n    'overlay-element': OverlayElement;\n  }\n}\n","import type { Verbosity } from \"../types.js\"\n\nexport class Log {\n  verbosity: Verbosity\n  prefix: string;\n\n  constructor(prefix: string, verbosity: Verbosity | Log) {\n    if (typeof verbosity === `string`) {\n      this.verbosity = verbosity;\n    } else {\n      this.verbosity = verbosity.verbosity;\n    }\n    this.prefix = prefix;\n  }\n\n  info(msg: any) {\n    if (this.verbosity === `errors`) return;\n    console.log(this.prefix, msg);\n  }\n\n  debug(msg: any) {\n    if (this.verbosity !== `debug`) return;\n    console.log(this.prefix, msg);\n\n  }\n}","import type { RecordingData } from \"./types.js\";\nimport type { Dispatcher, DispatcherDataArgs } from \"./dispatcher.js\";\nimport type { Recordings } from \"./sources/recording-sources.js\";\nimport { Log } from \"./util/log.js\";\nimport type { ProcessorModes } from \"./processor-modes.js\";\n\nexport type RecorderStates = `idle` | `recording` | `complete`;\n\nexport class Recorder extends EventTarget {\n  #state: RecorderStates = `idle`;\n  #mode: ProcessorModes | undefined;\n\n  buffer: any[] = [];\n  computeFreqMs: number = 0;\n  onDataBound;\n  log = new Log(`Recorder`, `info`);\n\n  constructor(readonly recordings: Recordings, readonly dispatcher: Dispatcher) {\n    super();\n    this.onDataBound = this.onData.bind(this);\n  }\n\n  start(computeFreqMs: number) {\n    this.computeFreqMs = computeFreqMs;\n    this.#setState(`recording`);\n    this.dispatcher.addEventListener(`data`, this.onDataBound);\n  }\n\n  get length() {\n    return this.buffer.length;\n  }\n\n  onData(event: Event) {\n    const detail = (event as CustomEvent).detail as DispatcherDataArgs;\n    const data = detail.data;\n    const mode = detail.mode;\n    this.#mode = mode;\n    this.buffer.push(data);\n    if (this.buffer.length % 5 === 0) {\n      this.log.info(`Recorder: ${ this.buffer.length } samples`);\n    }\n  }\n\n  stop() {\n    this.#setState(`complete`);\n    this.dispatcher.removeEventListener(`data`, this.onDataBound);\n\n    const name = this.recordings.promptName();\n    if (name) {\n      const rec: RecordingData = {\n        rateMs: this.computeFreqMs,\n        samples: this.buffer,\n        mode: this.#mode!,\n        name\n      }\n      this.recordings.add(rec);\n    }\n    this.buffer = [];\n  }\n\n  #setState(state: RecorderStates) {\n    const prior = this.#state;\n    if (state === prior) return;\n    this.#state = state;\n    if (state === `recording` && prior !== `idle`) throw new Error(`Cannot transition ${ prior } - > ${ state }`);\n    if (state === `complete` && prior !== `recording`) throw new Error(`Cannot transition ${ prior } - > ${ state }`);\n    this.log.debug(`${ prior } -> ${ state }`);\n    this.dispatchEvent(new CustomEvent(`state-change`, {\n      detail: {\n        priorState: prior,\n        newState: state\n      }\n    }));\n  }\n\n  get state() {\n    return this.#state;\n  }\n}","import { LitElement, html, css, type PropertyValues } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { createRef, type Ref, ref } from 'lit/directives/ref.js';\nimport { VideoSelector } from './video-selector.js';\nimport type { Options, SourceData } from '../types.js';\nimport { OverlayElement } from './pose-overlay.js';\nimport type { VideoSourceElement } from './video-source.js';\nimport type { RecPanel } from './rec-panel.js';\nimport { Recorder } from '../recorder.js';\nimport type { SourcesState } from '../sources/index.js';\nimport type { ProcessorModes } from '../processor-modes.js';\n\n@customElement('vision-element')\nexport class VisionElement extends LitElement {\n  videoSelectorEl: Ref<VideoSelector> = createRef();\n  videoSourceEl: Ref<VideoSourceElement> = createRef();\n  overlayEl: Ref<OverlayElement> = createRef();\n  recPanelEl: Ref<RecPanel> = createRef();\n  debug = true;\n\n  #lastCameras: SourceData[] = [];\n  #lastRecordings: SourceData[] = [];\n  #lastSource: SourceData | undefined;\n  #lastOptions: Options | undefined\n\n  @property()\n  uiSource: `video` | `recording` = `video`\n\n  @property()\n  recorder: Recorder | undefined;\n\n  @property()\n  hideModelSelector = false;\n\n  override render() {\n    return html`\n      <div id=\"sources\">\n        <video-source id=\"video\" ${ ref(this.videoSourceEl) } @sized=${ this.onVideoSized }></video-source>\n        <overlay-element @click=${ this.onOverlayClick } id=\"overlay\" ${ ref(this.overlayEl) } ></overlay-element>\n      </div>\n      <div id=\"controls\">\n        ${ this.hideModelSelector ?\n        html`` :\n        html`<details><summary>Model</summary>\n                  <model-element @request-mode=${ this.onRequestMode }></model-element>\n                </details>`\n      }\n        <details><summary>Source</summary>\n          <fieldset @change=${ this.onSelectSource }>\n            <input type=\"radio\" checked name=\"source\" id=\"source-video\" value=\"video\"><label for=\"source-video\">Video</label>\n            <input type=\"radio\" name=\"source\" id=\"source-recording\" value=\"recording\"><label for=\"source-recording\">Recording</label>\n          </fieldset>\n          <video-selector class=${ this.uiSource === `video` ? `show` : `hidden` } \n            .source=${ this.#lastSource } \n            .cameras=${ this.#lastCameras } ${ ref(this.videoSelectorEl) } \n            @startstop=${ this.onVideoStartStop }\n            @change=${ this.onVideoSelectorChange }>\n          </video-selector>\n          <rec-panel class=${ this.uiSource === `recording` ? `show` : `hidden` } \n            .recordings=${ this.#lastRecordings } \n            @startstop=${ this.onRecStartStop }\n            @change=${ this.onRecSelectorChange }\n            @request-delete=${ this.onRecRequestDelete }\n            id=\"rec-panel\" ${ ref(this.recPanelEl) }>\n            </rec-panel>\n        </details>\n        <details><summary>Recording</summary>\n        ${ this.getRecordingUi() }\n        </details>\n      </div>\n    `;\n  }\n\n  onRequestMode(event: Event) {\n    this.dispatchEvent(new CustomEvent(`request-mode`, {\n      detail: (event as CustomEvent).detail\n    }));\n  }\n\n  onRecRequestDelete(event: Event) {\n    const detail = (event as CustomEvent).detail as SourceData;\n    this.dispatchEvent(new CustomEvent(`request-source-delete`, { detail }))\n  }\n\n  onRecSelectorChange(event: Event) {\n    const detail = (event as CustomEvent).detail as SourceData;\n    this.dispatchEvent(new CustomEvent(`request-source`, { detail }))\n  }\n\n  /**\n   * User has choosing a new camera\n   * @param event \n   */\n  onVideoSelectorChange(event: Event) {\n    const detail = (event as CustomEvent).detail as SourceData;\n    this.dispatchEvent(new CustomEvent(`request-source`, { detail: detail }))\n  }\n\n  onRecStartStop(event: Event) {\n    const detail = (event as CustomEvent).detail as SourceData;\n    this.dispatchEvent(new CustomEvent(`source-startstop`, {\n      detail\n    }))\n  }\n\n  onVideoStartStop(event: Event) {\n    const detail = (event as CustomEvent).detail as SourceData;\n    this.dispatchEvent(new CustomEvent(`source-startstop`, {\n      detail\n    }))\n  }\n\n  getRecordingUi() {\n    if (!this.recorder) return html`<button @click=${ this.onStartRecording }>Start recording</button>`;\n    const r = this.recorder;\n    switch (r.state) {\n      case 'recording': {\n        return html`<button @click=${ this.onStopRecording }>Stop recording</button>`\n      }\n      case 'complete': {\n        return html`<em>Complete</em>`\n      }\n    }\n  }\n\n  onStopRecording() {\n    const r = this.recorder;\n    if (!r) return;\n    r.stop();\n    this.recorder = undefined;\n  }\n\n  onStartRecording() {\n    this.dispatchEvent(new CustomEvent(`request-recorder`));\n  }\n\n  onOverlayClick() {\n    this.videoSourceEl.value?.togglePreview();\n  }\n\n  setOptions(options: Options) {\n    this.#lastOptions = options\n  }\n\n  /**\n   * User swapped between camera/recording in UI\n   * @param event \n   * @returns \n   */\n  onSelectSource(event: Event) {\n    const t = event.target as HTMLInputElement;\n    if (!t) return;\n    if (t.value === `video`) {\n      this.uiSource = `video`;\n    } else if (t.value === `recording`) {\n      this.uiSource = `recording`;\n    }\n  }\n\n  /**\n   * Notification that sources have been updated\n   * @param sources \n   */\n  onSourcesUpdated(cameras: SourceData[], recordings: SourceData[]) {\n    this.#lastCameras = cameras;\n    this.#lastRecordings = recordings;\n    const el = this.videoSelectorEl.value;\n    if (el) {\n      el.cameras = cameras\n    }\n\n    const recPanel = this.recPanelEl.value;\n    if (recPanel) {\n      recPanel.recordings = this.#lastRecordings;\n    } else {\n      console.warn(`Not able to set recordings, element missing.`)\n    }\n\n  }\n\n\n\n  override connectedCallback(): void {\n    super.connectedCallback();\n    window.addEventListener(`resize`, () => {\n      this.resizeElements();\n    });\n  }\n\n  protected override firstUpdated(_changedProperties: PropertyValues): void {\n    const overlay = this.overlayEl.value;\n    const opts = this.#lastOptions?.overlay;\n    if (overlay && opts) {\n      overlay.labelPoints = opts.label;\n    } else {\n      console.warn(`Not able to set options for overlay, element missing.`);\n    }\n  }\n\n  updateRecPanel() {\n    const el = this.shadowRoot?.getElementById(`rec-panel`) as RecPanel | null;\n    const recPanel = this.recPanelEl.value || el;\n    if (recPanel) {\n      recPanel.recordings = this.#lastRecordings;\n    } else {\n      console.warn(`Not able to set recordings, element missing.`)\n    }\n  }\n\n  /**\n   * Notification that source has changed\n   * @param source \n   */\n  notifySourceChange(source: SourceData) {\n    this.#lastSource = source;\n    let el = this.videoSelectorEl.value;\n    if (el) {\n      el.source = source;\n    }\n  }\n\n  notifySourceState(state: SourcesState, source?: SourceData) {\n    if (!source) {\n      this.videoSelectorEl.value?.notifySourceState(state);\n      this.recPanelEl.value?.notifySourceState(state)\n    } else if (source.kind === `camera` || source.kind === `file`) {\n      this.videoSelectorEl.value?.notifySourceState(state);\n    } else if (source.kind === `recording`) {\n      this.recPanelEl.value?.notifySourceState(state)\n    }\n  }\n\n  onVideoSized() {\n    this.resizeElements();\n  }\n\n  resizeElements() {\n    const overlay = this.overlayEl.value;\n    const v = this.videoSourceEl.value;\n\n    if (!v || !overlay) return;\n\n    const container = this.getBoundingClientRect();\n    const videoSize = v.getVideoSize();\n    if (!videoSize) return;\n\n    let w = videoSize?.width;\n    let h = videoSize?.height;\n\n    const isVideoLandscape = w >= h;\n    const videoRatioWoverH = w / h;\n    const videoRatioHoverW = h / w;\n    const isLandscape = w >= h;\n\n    let constrainedDimension = isVideoLandscape ? `width` : `height`;\n    if (isLandscape) constrainedDimension = `height`;\n\n    if (constrainedDimension === `width`) {\n      w = container.width;\n      h = w * videoRatioHoverW;\n    } else {\n      h = container.height;\n      w = h * videoRatioWoverH\n    }\n\n    const left = container.width / 2 - w / 2;\n    const top = container.height / 2 - h / 2;\n    v.style.height = overlay.style.height = `${ h }px`;\n    v.style.width = overlay.style.width = `${ w }px`;\n\n    v.style.left = overlay.style.left = `${ left }px`;\n    v.style.top = overlay.style.top = `${ top }px`;\n    overlay.setSize(w, h);\n  }\n\n  onSourceChange(event: CustomEvent) {\n    const d = event.detail;\n\n    this.dispatchEvent(new CustomEvent(`change-source`, {\n      detail: d\n    }));\n  }\n\n  onReceivedData(mode: ProcessorModes, data: any) {\n    const el = this.overlayEl.value;\n    if (!el) return;\n    el.draw(mode, data);\n  }\n\n  getVideoSource() {\n    return this.videoSourceEl.value;\n  }\n\n  getVideoElement() {\n    const src = this.getVideoSource();\n    if (!src) return;\n    return src.getVideoElement();\n  }\n\n  static override styles = css`\n  :host {\n    display: block;\n    background-color: transparent;\n    font-family: system-ui, sans-serif;\n  }\n  #controls {\n    background: black;\n    color: white;\n    position: absolute;\n    top: 0px;\n    left: 0px;\n    padding: 0.5rem;\n  }\n  #overlay,#video {\n    position:absolute;\n  }\n  #sources {\n    background:green;\n  }\n  fieldset {\n    border: 0;\n  }\n  summary {\n    user-select: none;\n    pointer:default;\n  }\n  details {\n    padding:0.3rem;\n  }\n\n  .hidden {\n    display:none;\n  }\n  `;\n\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    // @ts-ignore\n    'vision-element': VisionElement;\n  }\n}\n","\n\nimport { LitElement, html, css } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport type { RecordingData, SourceData, Verbosity } from '../types.js';\nimport { createRef, type Ref, ref } from 'lit/directives/ref.js';\nimport type { SourcesState } from '../sources/index.js';\n\n\n@customElement('rec-panel')\nexport class RecPanel extends LitElement {\n  static override styles = css`\n    :host {\n      display:block;\n      background-color: hsla(0,0%,30%,0.5);\n    }\n    #contents {\n      padding: 0.5rem;\n    }\n    #toolbar {\n      margin-bottom: 0.5rem;\n    }\n  `;\n\n  @property()\n  recordings: SourceData[] = []\n\n  @property()\n  playing = false;\n\n  selectEl: Ref<HTMLSelectElement> = createRef();\n\n  override render() {\n    if (this.recordings.length === 0) {\n      return html`<em>No recordings</em>`;\n    }\n\n    let recs = [\n\n      ...this.recordings\n    ]\n    return html`\n    <div id=\"contents\">\n      <div id=\"toolbar\">\n        <button @click=${ this.onStartStopClick }>${ this.playing ? `Stop` : `Play` }</button>\n      </div>\n      <select ${ ref(this.selectEl) } @change=${ this.onSelectChange }>\n        ${ this.recordings.map(r => html`<option .source=${ r }>${ r.label }</option>`) }\n      </select>\n      <button @click=${ this.onDeleteClick }>Delete</button>\n    </div>\n    `;\n  }\n\n  onStartStopClick() {\n    const rec = this.getSelected();\n    if (!rec) {\n      console.warn(`No recording selected?`);\n      return;\n    }\n    this.dispatchEvent(new CustomEvent(`startstop`, { detail: rec }));\n  }\n\n  onSelectChange(event: Event) {\n    const target = event.target as HTMLSelectElement;\n    if (!target) return;\n    const item = target.item(target.selectedIndex);\n    if (!item) return;\n    const recording = (item as any).recording as RecordingData;\n\n  }\n\n  getSelected(): SourceData | undefined {\n    const el = this.selectEl.value;\n    if (!el) return;\n    const item = el.item(el.selectedIndex);\n    if (!item) return;\n    return (item as any).source as SourceData;\n  }\n\n  onDeleteClick() {\n    const rec = this.getSelected();\n    if (!rec) return;\n    this.dispatchEvent(new CustomEvent(`request-delete`, { detail: rec }));\n  }\n\n\n\n  // #setState(state: RecPanelStates) {\n  //   const prior = this.#state;\n  //   if (state === prior) return;\n  //   this.#state = state;\n  //   this.#log(`state ${ prior } -> ${ state }`);\n  //   this.dispatchEvent(new CustomEvent(`state`, {\n  //     detail: {\n  //       priorState: prior,\n  //       newState: state\n  //     }\n  //   }));\n  // }\n\n\n\n  notifySourceState(state: SourcesState) {\n    this.playing = state === `started`;\n  }\n\n  // onToggle() {\n  //   this.expanded = !this.expanded;\n  // }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'rec-panel': RecPanel;\n  }\n}\n","import { LitElement, html, css } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { createRef, type Ref, ref } from 'lit/directives/ref.js';\nimport type { SourceData } from '../types.js';\nimport { Log } from '../util/log.js';\n\nexport type VideoSourceStates = `started` | `stopped`;\n\n/**\n * Events:\n * * state\n * * sized: {width/height}\n */\n@customElement('video-source')\nexport class VideoSourceElement extends LitElement {\n  videoEl: Ref<HTMLVideoElement> = createRef();\n\n  @property()\n  source: SourceData | undefined\n\n  log = new Log(`VideoSourceElement`, `errors`);\n  #state = `stopped`;\n\n  @property()\n  showPreview: boolean = true\n\n  override render() {\n    return html`\n      <video class=${ this.showPreview ? `show` : `hide` } @pause=${ this.onPause } @loadedmetadata=${ this.onLoadedMetadata } @playing=${ this.onPlaying } @ended=${ this.onEnded } loop autoplay muted playsInline webkitPlaysInline ${ ref(this.videoEl) }></video>\n    `;\n  }\n\n  togglePreview() {\n    this.showPreview = !this.showPreview;\n  }\n\n  getVideoElement() {\n    return this.videoEl.value;\n  }\n\n  getVideoSize() {\n    const el = this.videoEl.value;\n    if (!el) return;\n    return {\n      width: el.videoWidth,\n      height: el.videoHeight\n    }\n  }\n\n  get isStarted() {\n    return this.#state === `started`;\n  }\n\n  start() {\n    const el = this.videoEl.value;\n    if (!el) {\n      console.warn(`No video element`)\n    } else {\n      el.play();\n    }\n  }\n\n  stop() {\n    const el = this.videoEl.value;\n    if (!el) {\n      console.warn(`No video element`)\n    } else {\n      el.pause();\n    }\n  }\n\n  onLoadedMetadata() {\n    const el = this.videoEl.value;\n    if (!el) return;\n    this.dispatchEvent(new CustomEvent(`sized`, {\n      detail: {\n        width: el.videoWidth,\n        height: el.videoHeight\n      }\n    }\n    ));\n  }\n\n  #setState(state: VideoSourceStates) {\n    const prior = this.#state;\n    if (state === prior) return;\n    this.#state = state;\n    this.log.debug(`state ${ prior } -> ${ state }`);\n    this.dispatchEvent(new CustomEvent(`state`, {\n      detail: {\n        priorState: prior,\n        newState: state\n      }\n    }));\n  }\n\n  /**\n   * From video element - now playing\n   */\n  onPlaying() {\n    this.#setState(`started`);\n  }\n\n  /**\n   * From video element - now stopped\n   */\n  onPause() {\n    this.#setState(`stopped`);\n  }\n\n  /**\n   * From video element - now stopped\n   */\n  onEnded() {\n    this.#setState(`stopped`);\n  }\n\n  setVideoSource(source: MediaProvider | string | null | undefined) {\n    const el = this.videoEl.value;\n\n    if (el) {\n      el.classList.remove(`hide`);\n\n      if (typeof source === `string`) {\n        el.srcObject = null;\n        el.src = source;\n      } else {\n        if (!source) {\n          el.pause();\n          el.classList.add(`hide`);\n        }\n        el.srcObject = source ?? null;\n      }\n    } else {\n      console.warn(`Video element unavailable`);\n    }\n    if (source && el?.paused) {\n      el.play();\n    }\n  }\n\n\n  static override styles = css`\n    :host {\n      display: block;\n    }\n    video {\n      width: 100%;\n      height: 100%;\n      opacity: 0.5;\n    }\n    video.hide {\n      display:none;\n    }\n  `;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    // @ts-ignore\n    'video-source': VideoSourceElement;\n  }\n}\n","export type ProcessorModes = `pose` | `objects` | `hand` | `face`;\n\nexport const getProcessorModes = () => [ `pose`, `objects`, `hand`, `face` ];\n\nexport const validateProcessorMode = (a: any, fallback?: ProcessorModes): ProcessorModes => {\n  if (typeof a === `string`) {\n    if (a === `pose`) return `pose`;\n    if (a === `hand`) return `hand`;\n    if (a === `face`) return `face`;\n    if (a === `objects`) return `objects`;\n  }\n  if (fallback) return fallback;\n  throw new Error(`Invalid mode: ${ a }. Expected: ${ getProcessorModes().join(`,`) }`);\n}\n\n","import { LitElement, html, css } from 'lit';\nimport { customElement } from 'lit/decorators.js';\nimport { getProcessorModes, validateProcessorMode } from '../processor-modes.js';\n\n@customElement('model-element')\nexport class ModelElement extends LitElement {\n  static override styles = css`\n    :host {\n      display: block;\n    \n    }\n  `;\n\n\n  override render() {\n    const modes = getProcessorModes();\n\n    return html`\n      <select @change=${ this.onSelectChange }>\n      ${ modes.map(m => html`<option>${ m }</option>`) }\n      </select>\n    `;\n  }\n\n  onSelectChange(event: Event) {\n    const value = (event.target as HTMLSelectElement).value;\n\n    this.dispatchEvent(new CustomEvent(`request-mode`, {\n      detail: {\n        mode: validateProcessorMode(value)\n      }\n    }));\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    // @ts-ignore\n    'model-element': ModelElement;\n  }\n}\n","import * as Mp from '@mediapipe/tasks-vision';\nimport { Points, type Point } from 'ixfx/geometry.js';\nimport { shortGuid } from 'ixfx/random.js';\nimport type { PoseData, PoseMatcherOptions, Verbosity } from '../types.js';\nimport { Log } from '../util/log.js';\n\nclass TrackedPose {\n  centroid: Point = Points.Empty;\n  firstSeen: number = performance.now();\n  lastSeen: number = performance.now();\n  id: string = shortGuid();\n  constructor() {\n\n  }\n}\n\n\n\nexport const getLowest = <T>(data: Array<T>, fn: (d: T) => number) => {\n  const ranked = data.map(d => fn(d));\n  let index = -1;\n  let score = Number.MAX_SAFE_INTEGER;\n  for (let i = 0; i < ranked.length; i++) {\n    if (ranked[ i ]! < score) {\n      score = ranked[ i ]!;\n      index = i;\n    }\n  }\n  if (index === -1) return undefined;\n  return { data: data[ index ], score };\n}\n\nexport class PoseMatcher {\n  tracked: TrackedPose[] = [];\n  distanceThreshold: number;\n  ageThreshold: number;\n  lastPrune = 0;\n  log;\n\n  constructor(opts: PoseMatcherOptions) {\n    this.distanceThreshold = opts.distanceThreshold;\n    this.ageThreshold = opts.maxAgeMs;\n    this.log = new Log(`PoseMatcher`, opts.verbosity);\n  }\n\n  *toPoses(poses: Mp.PoseLandmarkerResult) {\n    for (let i = 0; i < poses.landmarks.length; i++) {\n      yield this.toPose(poses.landmarks[ i ]!, poses.worldLandmarks[ i ]!);\n    }\n  }\n\n\n  toPose(n: Mp.NormalizedLandmark[], l: Mp.Landmark[]): PoseData {\n    const c = Points.centroid(n[ 12 ], n[ 11 ], n[ 24 ], n[ 23 ]);\n\n    const now = performance.now();\n    if (now - this.lastPrune > this.ageThreshold) {\n      // Remove dead poses\n      let pre = this.tracked.length;\n      this.tracked = this.tracked.filter(d => {\n        const age = (now - d.lastSeen);\n        if (age > this.ageThreshold) return false;\n        return true;\n      })\n      this.lastPrune = now;\n      let post = this.tracked.length;\n      if (post < pre) {\n        this.log.debug(`Pruned: ${ pre - post } expired pose(s)`);\n      }\n    }\n    // Get existing pose with closest distance\n    const closest = getLowest(this.tracked, d => Points.distance(d.centroid, c));\n\n    let target: TrackedPose | undefined;\n    if (!closest || closest.score > this.distanceThreshold) {\n      if (closest) {\n        this.log.info(`Closest match exceeds threshold. Score: ${ closest?.score } Threshold: ${ this.distanceThreshold }`);\n      } else {\n        this.log.info(`No poses`);\n      }\n      // No existing poses, or it exceeds threshold\n      target = new TrackedPose();\n      this.tracked.push(target);\n    } else {\n      target = closest.data!;\n    }\n    target.lastSeen = now;\n    target.centroid = c;\n    return {\n      poseid: target.id,\n      landmarks: n,\n      world: l\n    }\n  }\n\n}\n\n","export const makeModelPath = (basePath: string, provided: string) => {\n  if (provided.startsWith(`http`)) return provided;\n  return basePath + provided;\n}","import * as Mp from '@mediapipe/tasks-vision';\nimport type { CommonModelOptions, ComputeCallback, IModel, Options, PoseDetectorOptions } from '../types.js';\nimport { PoseMatcher } from './pose-matcher.js';\nimport { Log } from '../util/log.js';\nimport { makeModelPath } from './makeModelPath.js';\n// https://ai.google.dev/edge/mediapipe/solutions/vision/pose_landmarker/web_js#configuration_options\n\nexport class PoseDetector implements IModel {\n  lp: Mp.PoseLandmarker | undefined;\n  opts: PoseDetectorOptions;\n  matcher: PoseMatcher;\n  log;\n\n  constructor(readonly p: CommonModelOptions, opts: Partial<PoseDetectorOptions> = {}) {\n    this.opts = {\n      ...PoseDetector.defaults(),\n      ...opts\n    };\n    this.log = new Log(`PoseDetector`, this.opts.verbosity);\n    this.matcher = new PoseMatcher(this.opts.matcher);\n  }\n\n  static defaults(): PoseDetectorOptions {\n    return {\n      numPoses: 5,\n      minPoseDetectionConfidence: 0.3,\n      minPosePresenceConfidence: 0.3,\n      minTrackingConfidence: 0.3,\n      outputSegmentationMasks: false,\n      modelPath: 'pose_landmarker_full.task',\n      verbosity: `errors`,\n      matcher: {\n        distanceThreshold: 0.1,\n        maxAgeMs: 2000,\n        verbosity: `errors`\n      }\n    }\n  }\n  compute(v: Mp.ImageSource, callback: ComputeCallback, timestamp: number) {\n    this.lp?.detectForVideo(v, timestamp, poses => {\n      const matched = [ ...this.matcher.toPoses(poses) ];\n      callback(matched);\n    });\n  }\n\n  async init() {\n    const p = this.p;\n    const v = await Mp.FilesetResolver.forVisionTasks(p.wasmBase);\n    const opts = this.opts;\n    const mpOpts: Mp.PoseLandmarkerOptions = {\n      baseOptions: {\n        modelAssetPath: makeModelPath(p.modelsBase, opts.modelPath),\n        delegate: `GPU`\n      },\n      runningMode: `VIDEO`,\n      numPoses: opts.numPoses,\n      minPoseDetectionConfidence: opts.minPoseDetectionConfidence,\n      minPosePresenceConfidence: opts.minPosePresenceConfidence,\n      minTrackingConfidence: opts.minTrackingConfidence,\n      outputSegmentationMasks: opts.outputSegmentationMasks\n    };\n    this.log.info(mpOpts);\n\n\n    this.lp = await Mp.PoseLandmarker.createFromOptions(v, mpOpts);\n    return true;\n  }\n\n  dispose() {\n    this.lp?.close();\n    this.lp = undefined;\n  }\n}\n","import type { ImageSource } from \"@mediapipe/tasks-vision\";\nimport { type IModel, type ComputeCallback, type ObjectDetectorOptions, type Options, type CommonModelOptions } from \"../types.js\";\nimport * as Mp from '@mediapipe/tasks-vision';\nimport { Log } from \"../util/log.js\";\nimport { makeModelPath } from \"./makeModelPath.js\";\n\nexport class ObjectDetector implements IModel {\n  od: Mp.ObjectDetector | undefined;\n  opts: ObjectDetectorOptions;\n  log;\n\n  constructor(readonly p: CommonModelOptions, options: Partial<ObjectDetectorOptions> = {}) {\n    this.opts = {\n      ...ObjectDetector.defaults(),\n      ...options\n    };\n    this.log = new Log(`ObjectDetector`, this.opts.verbosity);\n  }\n\n  static defaults(): ObjectDetectorOptions {\n    return {\n      verbosity: `errors`,\n      modelPath: 'efficientdet_lite0.tflite',\n      scoreThreshold: 0.5\n    }\n  }\n\n  compute(v: ImageSource, callback: ComputeCallback, timestamp: number): void {\n    const results = this.od?.detectForVideo(v, timestamp);\n    callback(results);\n  }\n\n  dispose(): void {\n    this.od?.close();\n    this.od = undefined;\n  }\n\n  async init(): Promise<boolean> {\n    const p = this.p;\n    const vision = await Mp.FilesetResolver.forVisionTasks(p.wasmBase);\n    const mpOpts: Mp.ObjectDetectorOptions = {\n      baseOptions: {\n        modelAssetPath: makeModelPath(p.modelsBase, this.opts.modelPath)\n      },\n      scoreThreshold: 0.5,\n      runningMode: `VIDEO`\n    }\n    this.od = await Mp.ObjectDetector.createFromOptions(vision, mpOpts);\n\n    this.log.info(mpOpts);\n    return true;\n  }\n\n}","import type { ImageSource } from \"@mediapipe/tasks-vision\";\nimport { type IModel, type ComputeCallback, type FaceDetectorOptions, type CommonModelOptions } from \"../types.js\";\nimport * as Mp from '@mediapipe/tasks-vision';\nimport { Log } from \"../util/log.js\";\nimport { makeModelPath } from \"./makeModelPath.js\";\n\nexport class FaceDetector implements IModel {\n  fd: Mp.FaceDetector | undefined;\n  opts: FaceDetectorOptions;\n  log;\n\n  constructor(readonly p: CommonModelOptions, options: Partial<FaceDetectorOptions> = {}) {\n    this.opts = {\n      ...FaceDetector.defaults(),\n      ...options\n    }\n    this.log = new Log(`FaceDetector`, this.opts.verbosity);\n  }\n\n  static defaults(): FaceDetectorOptions {\n    return {\n      verbosity: `errors`,\n      modelPath: 'blaze_face_short_range.tflite',\n      minDetectionConfidence: 0.5,\n      minSupressionThreshold: 0.3\n    }\n  }\n\n  compute(v: ImageSource, callback: ComputeCallback, timestamp: number): void {\n    const results = this.fd?.detectForVideo(v, timestamp);\n    callback(results);\n  }\n\n  dispose(): void {\n    this.fd?.close();\n    this.fd = undefined;\n  }\n\n  async init(): Promise<boolean> {\n    const opts = this.opts;\n    const p = this.p;\n    const vision = await Mp.FilesetResolver.forVisionTasks(p.wasmBase);\n    const mpOpts: Mp.FaceDetectorOptions = {\n      baseOptions: {\n        modelAssetPath: makeModelPath(p.modelsBase, this.opts.modelPath)\n      },\n      minDetectionConfidence: opts.minDetectionConfidence,\n      minSuppressionThreshold: opts.minSupressionThreshold,\n      runningMode: `VIDEO`\n    }\n    this.log.info(mpOpts);\n    this.fd = await Mp.FaceDetector.createFromOptions(vision, mpOpts);\n    return true;\n  }\n\n}","import type { ImageSource } from \"@mediapipe/tasks-vision\";\nimport { type IModel, type ComputeCallback, type HandDetectorOptions, type CommonModelOptions } from \"../types.js\";\nimport * as Mp from '@mediapipe/tasks-vision';\nimport { Log } from \"../util/log.js\";\nimport { makeModelPath } from \"./makeModelPath.js\";\n\nexport class HandDetector implements IModel {\n  hd: Mp.HandLandmarker | undefined;\n  opts: HandDetectorOptions;\n  log;\n\n  constructor(readonly p: CommonModelOptions, options: Partial<HandDetectorOptions> = {}) {\n    this.opts = {\n      ...HandDetector.defaults(),\n      ...options\n    }\n    this.log = new Log(`HandDetector`, this.opts.verbosity);\n  }\n\n  static defaults(): HandDetectorOptions {\n    return {\n      verbosity: `errors`,\n      numHands: 2,\n      modelPath: 'hand_landmarker.task',\n      minHandDetectionConfidence: 0.5,\n      minHandPresenceConfidence: 0.5,\n      minTrackingConfidence: 0.5,\n    }\n  }\n\n  compute(v: ImageSource, callback: ComputeCallback, timestamp: number): void {\n    const results = this.hd?.detectForVideo(v, timestamp);\n    callback(results);\n  }\n\n  dispose(): void {\n    this.hd?.close();\n    this.hd = undefined;\n  }\n\n  async init(): Promise<boolean> {\n    const opts = this.opts;\n    const p = this.p;\n    const vision = await Mp.FilesetResolver.forVisionTasks(p.wasmBase);\n    const mpOpts: Mp.HandLandmarkerOptions = {\n      baseOptions: {\n        modelAssetPath: makeModelPath(p.modelsBase, this.opts.modelPath)\n      },\n      minHandDetectionConfidence: opts.minHandDetectionConfidence,\n      minHandPresenceConfidence: opts.minHandPresenceConfidence,\n      minTrackingConfidence: opts.minTrackingConfidence,\n      numHands: opts.numHands,\n      runningMode: `VIDEO`\n    }\n    this.hd = await Mp.HandLandmarker.createFromOptions(vision, mpOpts);\n\n    this.log.info(mpOpts);\n    return true;\n  }\n\n}","import { PoseDetector } from './mediapipe/pose-detector.js';\nimport { ObjectDetector } from './mediapipe/object-detector.js';\nimport type { CommonModelOptions, FaceDetectorOptions, HandDetectorOptions, IModel, ObjectDetectorOptions, Options, PoseDetectorOptions } from './types.js';\nimport { MlVision } from './ml-vision.js';\nimport { FaceDetector } from './mediapipe/face-detector.js';\nimport { HandDetector } from './mediapipe/hand-detector.js';\nimport { Log } from './util/log.js';\nimport { validateProcessorMode, type ProcessorModes } from './processor-modes.js';\n\nexport type ProcessingStates = `queued-start` | `starting` | `started` | `stopping` | `stopped`;\n\nexport class Processing extends EventTarget {\n  #state: ProcessingStates = `stopped`;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  #updateTimer: any;\n  #model: IModel | undefined;\n  #currentMode: ProcessorModes = `face`;\n  #videoEl: HTMLVideoElement | undefined;\n  log;\n  dispatcher;\n\n  poseOptions: PoseDetectorOptions;\n  objectDetectorOptions: ObjectDetectorOptions;\n  faceDetectorOptions: FaceDetectorOptions;\n  handDetectorOptions: HandDetectorOptions;\n  computeFreqMs: number;\n  dispatcherBound;\n  wasmBase: string;\n  modelsBase: string;\n\n  constructor(readonly mlv: MlVision, opts: Options) {\n    super();\n    this.#currentMode = opts.mode;\n    this.wasmBase = opts.wasmBase;\n    this.modelsBase = opts.modelsBase;\n    this.log = new Log(`Processing`, opts.verbosity);\n    this.dispatcher = mlv.dispatcher;\n    this.dispatcherBound = this.dispatcher.receivedData.bind(this.dispatcher);\n    this.computeFreqMs = opts.computeFreqMs;\n    this.poseOptions = opts.pose ?? PoseDetector.defaults();\n    this.objectDetectorOptions = opts.objects ?? ObjectDetector.defaults();\n    this.faceDetectorOptions = opts.face ?? FaceDetector.defaults();\n    this.handDetectorOptions = opts.hand ?? HandDetector.defaults();\n  }\n\n  stop() {\n    if (this.#state === `stopping` || this.#state === `stopped`) return;\n    this.setState(`stopping`);\n    this.#model?.dispose();\n    this.#model = undefined;\n    this.setState(`stopped`);\n  }\n\n  setMode(mode: ProcessorModes) {\n    if (mode === this.currentMode) return;\n    if (typeof mode !== `string`) throw new Error(`Expected string. Got: ${ typeof mode }`);\n    validateProcessorMode(mode);\n\n    localStorage.setItem(`last-mode`, mode);\n    const video = this.#videoEl;\n    if (!video) return;\n    this.stop();\n    this.#currentMode = mode;\n    this.start(video);\n  }\n\n  getModelOptions() {\n    const modelOpts: CommonModelOptions = {\n      wasmBase: this.wasmBase,\n      modelsBase: this.modelsBase\n    }\n    return modelOpts;\n  }\n  async start(video: HTMLVideoElement) {\n    this.setState(`starting`);\n    this.#videoEl = video;\n\n\n    switch (this.#currentMode) {\n      case `pose`: {\n        this.log.info(this.poseOptions);\n        this.#model = new PoseDetector(this.getModelOptions(), this.poseOptions);\n        break;\n      }\n      case `objects`: {\n        this.log.info(this.objectDetectorOptions);\n        this.#model = new ObjectDetector(this.getModelOptions(), this.objectDetectorOptions);\n        break;\n      }\n      case `face`: {\n        this.log.info(this.faceDetectorOptions);\n        this.#model = new FaceDetector(this.getModelOptions(), this.faceDetectorOptions);\n        break;\n      }\n      case `hand`: {\n        this.log.info(this.handDetectorOptions);\n        this.#model = new HandDetector(this.getModelOptions(), this.handDetectorOptions);\n        break;\n      }\n      default: {\n        throw new Error(`Unsupported mode '${ this.#currentMode }'. Expected: 'hand', 'pose', 'objects' or 'face'`)\n      }\n    }\n    if (this.#model) {\n      this.#model.init();\n      this.setState(`started`);\n    }\n  }\n\n  #run() {\n    const v = this.#videoEl;\n    if (!v) {\n      console.warn(`No video element`);\n      return;\n    }\n\n    this.#model?.compute(v, (data) => this.dispatcher.receivedData(this.#currentMode, data), performance.now());\n\n    if (this.#state === `started`) {\n      this.#updateTimer = setTimeout(() => this.#run(), this.computeFreqMs);\n    }\n  }\n\n  setState(state: ProcessingStates) {\n    if (this.#state === state) return;\n    const prior = this.#state;\n\n    if (state === `starting`) {\n      if (prior !== `stopped` && prior !== `queued-start`) throw new Error(`Cannot start when in state: ${ prior }`);\n    }\n    if (state === `started`) {\n      if (prior !== `starting`) throw new Error(`Cannot go to 'started' when state is: ${ prior }`)\n    }\n\n    this.#state = state;\n\n    if (state === `started`) {\n      this.#updateTimer = setTimeout(() => this.#run(), this.computeFreqMs);\n    } else {\n      if (this.#updateTimer) {\n        clearTimeout(this.#updateTimer);\n      }\n      this.#updateTimer = 0;\n    }\n\n    this.log.debug(`State ${ prior } -> ${ state }`);\n    this.dispatchEvent(new CustomEvent(`state`, {\n      detail: {\n        priorState: prior,\n        newState: state\n      }\n    }));\n  }\n\n  get isStarted() {\n    return this.#state === `started`;\n  }\n\n  get currentMode() {\n    return this.#currentMode;\n  }\n\n\n\n}","export const snipBefore = (input: string, match: string) => {\n  const pos = input.indexOf(match);\n  if (pos >= 0) {\n    return input.substring(0, pos);\n  }\n  return input\n}\n\nexport const afterMatch = (input: string, match: string) => {\n  const pos = input.indexOf(match);\n  if (pos >= 0) {\n    return input.substring(pos + match.length);\n  }\n  return input;\n}","import type { CameraOptions, SourceData } from \"../types.js\";\nimport { snipBefore } from \"../util/text.js\";\nimport type { Sources } from \"./index.js\";\n\nexport class CameraSources {\n  #disabled = false;\n  #cameras: SourceData[] = [];\n\n  constructor(private readonly sources: Sources) {\n\n  }\n\n  init() {\n    this.updateDevices();\n  }\n\n  async updateDevices() {\n    if (this.#disabled) return;\n    if (!(`mediaDevices` in navigator)) {\n      console.warn(`navigator.mediaDevices is missing -- are you running over https:// or via localhost?`);\n      this.#disabled = true;\n      return;\n    }\n    if (!('getUserMedia' in navigator.mediaDevices)) {\n      this.#disabled = true;\n      console.warn(`navigator.getUserMedia is missing -- are you running over https:// or via localhost?`)\n      return;\n    }\n\n    await navigator.mediaDevices.getUserMedia({ video: true });\n    const devices = await navigator.mediaDevices.enumerateDevices();\n\n    this.#cameras = devices.filter(d => d.kind === `videoinput`).map(d => ({\n      id: d.deviceId,\n      kind: `camera`,\n      label: snipBefore(d.label, \"(\").trim()\n    }));\n\n    this.sources.notifySourceUpdated(this);\n  }\n\n\n\n  get cameras() {\n    return this.#cameras;\n  }\n}\n\n\n\n\n","import type { Dispatcher } from \"../dispatcher.js\";\nimport type { ProcessorModes } from \"../processor-modes.js\";\nimport type { ISource, RecordingData } from \"../types.js\";\n\nexport class RecordPlayer implements ISource {\n  #timer: number = 0;\n\n  constructor(readonly data: RecordingData, readonly dispatcher: Dispatcher) {\n\n  }\n\n  async start() {\n    let pos = 0;\n    const mode = this.data.mode as ProcessorModes;\n    const samples = this.data.samples;\n\n    this.#timer = setInterval(() => {\n      //callback(this.data.samples[ pos ]);\n      this.dispatcher.receivedData(mode, samples[ pos ])\n      pos++;\n      if (pos >= this.data.samples.length) pos = 0;\n    }, this.data.rateMs * 2);\n    return true;\n  }\n\n  stop() {\n    clearInterval(this.#timer);\n  }\n}\n","import type { RecordingData, SourceData } from \"../types.js\";\nimport type { Sources } from \"./index.js\";\n\nexport class Recordings {\n  #store: RecordingData[] = []\n\n  constructor(private readonly sources: Sources) {\n\n  }\n\n  delete(source: SourceData) {\n    const filtered = this.#store.filter(rd => rd.name !== source.id);\n    if (filtered.length !== this.#store.length) {\n      this.#store = filtered;\n      this.save();\n    }\n  }\n\n  getSources(): SourceData[] {\n    return this.#store.map<SourceData>(r => ({\n      id: r.name,\n      kind: `recording`,\n      label: r.name\n    }));\n  }\n\n  getRecording(name: string) {\n    return this.#store.find(r => r.name === name);\n  }\n\n  add(data: RecordingData) {\n    this.#store.push(data);\n    this.save();\n  }\n\n  save() {\n    localStorage.setItem(`recordings`, JSON.stringify(this.#store));\n    this.sources.notifySourceUpdated(this);\n  }\n\n  init() {\n    const s = localStorage.getItem(`recordings`);\n    if (!s) return;\n    try {\n      const o = JSON.parse(s) as any[];\n      for (const d of o) {\n        this.#store.push(d);\n      }\n      this.sources.notifySourceUpdated(this);\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  promptName() {\n    const formatOpts: Intl.DateTimeFormatOptions = {\n      dateStyle: `short`,\n      timeStyle: `short`\n    }\n    const defaultName = new Intl.DateTimeFormat(\"se-SE\", formatOpts).format(Date.now()) + ' recording ' + this.#store.length + 1;\n\n    const name = window.prompt(`Name for recording`, defaultName);\n    return name;\n  }\n}","import type { VideoSourceElement } from \"../components/video-source.js\";\nimport type { CameraOptions, ISource, SourceData } from \"../types.js\";\n\nexport class VideoElementSource implements ISource {\n  mediaStream: MediaStream | undefined;\n\n  constructor(readonly src: VideoSourceElement, readonly data: SourceData, readonly camera: CameraOptions) {\n\n  }\n\n  async start(): Promise<boolean> {\n    let stream: undefined | MediaStream | string = undefined;\n    switch (this.data.kind) {\n      case \"camera\": {\n        stream = await this.getMediaStream();\n        this.mediaStream = stream;\n        break;\n      }\n      case \"file\": {\n        stream = this.data.id;\n        break;\n      }\n    }\n    this.src.setVideoSource(stream);\n    if (stream) {\n      this.src.start();\n      return true;\n    } else {\n      this.src.stop();\n      return false;\n    }\n  }\n\n  stop(): void {\n    if (this.mediaStream) {\n      for (const vt of this.mediaStream.getVideoTracks()) {\n        vt.stop();\n      }\n    }\n    this.src.stop();\n  }\n\n  async getMediaStream() {\n    if (this.data.id === `-`) return undefined;\n    const c = getConstraints(this.data, this.camera);\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia(c);\n\n      return stream;\n    } catch (error: unknown) {\n      if (typeof error === `object`) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        const name = (error as any).name ?? ``;\n        if (name === `OverconstrainedError`) {\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          console.error(`Overconstrained error: ${ (error as any).constraint }`);\n          console.error(`Constraints: ${ JSON.stringify(c) }`);\n        }\n      }\n      throw error;\n    }\n  }\n}\n\nexport const getConstraints = (source: SourceData, options: CameraOptions) => {\n  const video: Partial<MediaTrackConstraints> = {}\n  if (source.id.length > 0) {\n    video.deviceId = { exact: source.id };\n  }\n  if (options.facingMode) {\n    video.facingMode = options.facingMode;\n  }\n  if (options.height) {\n    video.height = { ideal: options.height }\n  }\n  if (options.width) {\n    video.width = { ideal: options.width }\n  }\n  const constraints: MediaStreamConstraints = {\n    video\n  };\n  return constraints;\n}","import type { VideoSourceElement } from \"../components/video-source.js\";\nimport type { MlVision } from \"../ml-vision.js\";\nimport { Recorder } from \"../recorder.js\";\nimport type { CameraOptions, ISource, SourceData, SourceKinds, Verbosity } from \"../types.js\";\nimport { Log } from \"../util/log.js\";\nimport { CameraSources } from \"./camera-sources.js\";\nimport { RecordPlayer } from \"./record-player.js\";\nimport { Recordings } from \"./recording-sources.js\";\nimport { VideoElementSource } from \"./video-element-source.js\";\n\nexport type SourcesState = `starting` | `started` | `stopped`\nexport type SourceStateChangeArgs = {\n  priorState: SourcesState\n  newState: SourcesState\n}\n\n/**\n * Event: 'updated','state-change'\n */\nexport class Sources extends EventTarget {\n  #camera;\n  #recordings;\n\n  #state: SourcesState = `stopped`;\n  #current: ISource | undefined;\n  #currentData: SourceData | undefined;\n  #videoEl: VideoSourceElement | undefined;\n  #cameraOpts: CameraOptions;\n  log;\n  constructor(cameraOptions: CameraOptions, readonly mlv: MlVision) {\n    super();\n    this.log = new Log(`Sources`, mlv.log);\n    this.#cameraOpts = cameraOptions;\n    this.#camera = new CameraSources(this);\n    this.#recordings = new Recordings(this);\n  }\n\n  delete(source: SourceData) {\n    if (source.kind !== `recording`) throw new Error(`Cannot delete type: ${ source.kind }`);\n    this.#recordings.delete(source);\n  }\n\n  get isStarted() {\n    return this.#state === `started`;\n  }\n\n  createRecorder() {\n    return new Recorder(this.#recordings, this.mlv.dispatcher);\n  }\n\n  startStop(): boolean {\n    if (this.#state === `stopped`) {\n      this.start();\n      return true;\n    } else if (this.#state === `started`) {\n      this.stop();\n      return false;\n    } else {\n      console.warn(`Cannot start/stop in state: ${ this.#state }`);\n      return false;\n    }\n  }\n\n  kindMatch(kind: SourceKinds) {\n    if (this.#currentData) {\n      if (this.#currentData.kind === kind) return true;\n    }\n    return false;\n  }\n  async start() {\n    this.#setState(`starting`);\n\n    const sourceData = this.#currentData;\n    if (!sourceData) throw new Error(`Cannot start, no source data available`);\n\n    // Resolve source\n    let source: ISource | undefined;\n    let videoEl = this.#videoEl;\n    if (!videoEl) {\n      videoEl = this.#videoEl = this.mlv.el.getVideoSource();\n    }\n    switch (sourceData.kind) {\n      case `camera`: {\n        if (!videoEl) throw new Error(`No video element`);\n        source = new VideoElementSource(videoEl, sourceData, this.#cameraOpts);\n        break;\n      }\n      case `file`: {\n        if (!videoEl) throw new Error(`No video element`);\n        source = new VideoElementSource(videoEl, sourceData, this.#cameraOpts);\n        break;\n      }\n      case `recording`: {\n        const rec = this.#recordings.getRecording(sourceData.id);\n        if (rec) {\n          source = new RecordPlayer(rec, this.mlv.dispatcher);\n        } else {\n          console.warn(`Could not get recording: ${ sourceData.id }`);\n        }\n      }\n    }\n\n    this.#current = source;\n    if (await source?.start()) {\n      this.#setState(`started`);\n    } else {\n      this.#setState(`stopped`);\n    }\n  }\n\n  stop() {\n    const current = this.#current;\n    if (current) {\n      try {\n        current.stop();\n        this.#current = undefined;\n      } catch (error) {\n        console.error(error);\n      }\n    }\n    this.#setState(`stopped`);\n  }\n\n  get cameras() {\n    return this.#camera.cameras;\n  }\n\n  get recordings() {\n    return this.#recordings.getSources();\n  }\n\n  init() {\n    this.#camera.init();\n    this.#recordings.init();\n  }\n\n  setSource(sourceData: SourceData) {\n    this.log.debug(`setSource: ${ JSON.stringify(sourceData) }`);\n    this.#currentData = sourceData;\n    this.dispatchEvent(new CustomEvent(`source-change`, { detail: sourceData }));\n  }\n\n  getCurrentId() {\n    if (this.#currentData) return this.#currentData.id;\n    return ``;\n  }\n\n  notifySourceUpdated(source: any) {\n    this.dispatchEvent(new CustomEvent(`updated`, {\n      detail: source\n    }));\n    if (source === this.#camera && !this.#current) {\n      const c = this.#camera.cameras[ 0 ];\n      if (c) {\n        this.setSource(c);\n        this.start();\n      }\n    }\n  }\n\n  #setState(state: SourcesState) {\n    const prior = this.#state;\n    if (prior === state) return;\n    this.#state = state;\n    if (state === `starting` && prior !== `stopped`) throw new Error(`Cannot transition ${ prior } -> ${ state }`);\n    this.log.debug(`state ${ prior } -> ${ state } (current: ${ JSON.stringify(this.#currentData) })`);\n    const dict: SourceStateChangeArgs = {\n      priorState: prior,\n      newState: state\n    }\n    this.dispatchEvent(new CustomEvent(`state-change`, { detail: dict }));\n  }\n\n  get currentSourceData() {\n    return this.#currentData;\n  }\n\n}",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"import { Remote } from '@clinth/remote';\nimport type { OnDispatcherData, Options } from './types.js';\nimport type { ProcessorModes } from './processor-modes.js';\n\nexport type DispatcherDataArgs = {\n  data: any\n  mode: ProcessorModes\n}\nexport class Dispatcher extends EventTarget {\n  #remote;\n  onData: OnDispatcherData | undefined;\n\n  constructor(options: Options) {\n    super();\n    this.#remote = new Remote(options.remote);\n  }\n\n  receivedData(mode: ProcessorModes, data: any) {\n    if (!data) return;\n    if (this.#remote) {\n      this.#remote.send(JSON.stringify(data));\n    }\n\n    if (this.onData) this.onData(mode, data);\n\n    const args: DispatcherDataArgs = { data, mode }\n    this.dispatchEvent(new CustomEvent(`data`, {\n      detail: args\n    }));\n\n  }\n}","import { VisionElement } from \"./components/vision-element.js\";\nimport type { ISource, Options, SourceData, SourceKinds, Verbosity } from \"./types.js\";\nimport { OverlayElement } from \"./components/pose-overlay.js\";\nimport { Processing } from \"./processing.js\";\nimport { PoseDetector } from \"./mediapipe/pose-detector.js\";\nimport { ObjectDetector } from \"./mediapipe/object-detector.js\";\nimport { FaceDetector } from \"./mediapipe/face-detector.js\";\nimport { Sources, type SourceStateChangeArgs } from \"./sources/index.js\";\nimport { Dispatcher } from \"./dispatcher.js\";\nimport { Recorder } from \"./recorder.js\";\nimport { Log } from \"./util/log.js\";\nimport { validateProcessorMode, type ProcessorModes } from \"./processor-modes.js\";\n\nexport const defaults = (mode: ProcessorModes): Options => {\n  const opts: Options = {\n    overlay: {\n      label: true,\n      show: true\n    },\n    camera: {\n      facingMode: `user`,\n    },\n    computeFreqMs: 10,\n    mode: mode,\n    remote: {\n      allowNetwork: false,\n    },\n    verbosity: `errors`,\n    wasmBase: './wasm',\n    modelsBase: '/models'\n  }\n  if (mode === `pose`) opts.pose = PoseDetector.defaults();\n  else if (mode === `objects`) opts.objects = ObjectDetector.defaults();\n  else if (mode === `face`) opts.face = FaceDetector.defaults();\n  return opts;\n};\n\n\nexport class MlVision extends EventTarget {\n  el: VisionElement;\n  sources;\n  #overlayEl: OverlayElement | undefined;\n  #proc\n  dispatcher;\n  #opts: Options;\n  log\n  constructor(elQuery: string, options: Partial<Options> = {}) {\n    super();\n\n    const lastMode = validateProcessorMode(localStorage.getItem(`last-mode`), `pose`);\n    const opts = !options ? defaults(lastMode as ProcessorModes) : {\n      ...defaults(options.mode ?? lastMode),\n      ...options\n    }\n    this.#opts = opts;\n    this.log = new Log(`MlVision`, opts.verbosity);\n    const el = document.querySelector(elQuery) as VisionElement | null;\n    if (!el) throw new Error(`VisionElement not found with query: ${ elQuery }`);\n    this.el = el;\n\n    this.sources = new Sources(opts.camera, this);\n    this.dispatcher = new Dispatcher(opts);\n    this.#proc = new Processing(this, opts);\n  }\n\n  init() {\n    const el = this.el;\n    const opts = this.#opts;\n    el.setOptions(opts);\n    el.addEventListener(`source-startstop`, (event) => {\n      const source = (event as CustomEvent).detail as SourceData;\n      if (source.id !== this.sources.getCurrentId()) {\n        // Different source\n        this.log.info(`Different source. Id: ${ source.id } Existing: ${ this.sources.getCurrentId() }`);\n        this.sources.stop();\n        this.sources.setSource(source);\n      }\n      const started = this.sources.startStop();\n    });\n\n    // User has switched camera/file\n    el.addEventListener(`request-source`, event => {\n      const detail = (event as CustomEvent).detail as SourceData;\n      this.sources.stop();\n      this.sources.setSource(detail);\n      this.sources.start();\n    });\n\n    el.addEventListener(`request-recorder`, () => {\n      const r = this.sources.createRecorder();\n      r.start(this.#proc.computeFreqMs);\n      el.recorder = r;\n    });\n\n    el.addEventListener(`request-source-delete`, event => {\n      const source = (event as CustomEvent).detail as SourceData;\n      this.sources.delete(source);\n    })\n\n    el.addEventListener(`request-mode`, event => {\n      const req = (event as CustomEvent).detail;\n      console.log(req);\n      this.#proc.setMode(validateProcessorMode(req.mode));\n    });\n\n    this.dispatcher.addEventListener(`data`, event => {\n      const data = (event as CustomEvent).detail;\n      el.onReceivedData(data.mode, data.data);\n    });\n\n    this.sources.addEventListener(`updated`, () => {\n      el.onSourcesUpdated(this.sources.cameras, this.sources.recordings);\n    })\n\n    // Source has changed\n    this.sources.addEventListener(`source-change`, event => {\n      const source = (event as CustomEvent).detail as SourceData;\n      el.notifySourceChange(source);\n    })\n\n    // Playback source video/camera has changed state\n    this.sources.addEventListener(`state-change`, (e) => {\n      const { priorState, newState } = (e as CustomEvent).detail as SourceStateChangeArgs;\n      this.log.debug(`${ priorState }->${ newState }`);\n      if (newState === `started`) {\n        // Make sure processor is running too\n        const video = el.getVideoElement();\n        if (video) {\n          this.#proc.stop();\n          this.#proc.start(video);\n        } else {\n          console.warn(`Could not start processing because not video element is found`);\n        }\n      } else if (newState === `stopped`) {\n        this.#proc.stop();\n      }\n      el.notifySourceState(newState, this.sources.currentSourceData);\n\n    })\n\n    this.sources.init();\n    if (opts.hideModelSelector) el.hideModelSelector = opts.hideModelSelector;\n  }\n\n}","import { Remote, type Options } from \"@clinth/remote\";\n\nexport type OnReceivedData = (msg: unknown) => void;\n\nexport class Client extends EventTarget {\n  #remote;\n  onData: OnReceivedData | undefined;\n\n  constructor(options: Options = {}) {\n    super();\n    options = {\n      allowNetwork: false,\n      ...options\n    }\n    this.#remote = new Remote(options);\n    this.#remote.onData = ((msg: unknown) => {\n      const asObj = typeof msg === `object` ? msg : JSON.parse(msg as string);\n      if (this.onData) this.onData(asObj);\n      this.dispatchEvent(new CustomEvent(`message`, {\n        detail: asObj\n      }))\n    });\n  }\n}"],"mappings":"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AAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,CAAC,GAAE,CAAC,GAAE,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,CAAC,GAAE,CAAC,GAAE,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,IAAG,CAAC,GAAE,CAAC,GAAE,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,GAAE,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,GAAE,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,GAAE,EAAE,GAAE,CAAC,IAAG,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,GAAE,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,CAAC,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,CAAC,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,CAAC,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,CAAC,GAAE,CAAC,GAAE,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,GAAE,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,G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","names":["value","init","customElements","global","globalThis","supportsAdoptingStyleSheets","ShadowRoot","ShadyCSS","nativeShadow","Document","prototype","CSSStyleSheet","constructionToken","Symbol","cssTagCache","WeakMap","CSSResult","cssText","strings","safeToken","this","Error","_strings","styleSheet","_styleSheet","cacheable","length","get","replaceSync","set","toString","unsafeCSS","value","String","css","values","reduce","acc","v","idx","adoptStyles","renderRoot","styles","adoptedStyleSheets","map","s","style","document","createElement","nonce","setAttribute","textContent","appendChild","getCompatibleStyle","sheet","rule","cssRules","is","defineProperty","getOwnPropertyDescriptor","getOwnPropertyNames","getOwnPropertySymbols","getPrototypeOf","Object","global","globalThis","customElements","trustedTypes","emptyStringForBooleanAttribute","emptyScript","polyfillSupport","reactiveElementPolyfillSupport","JSCompiler_renameProperty","prop","_obj","defaultConverter","value","type","Boolean","Array","JSON","stringify","fromValue","Number","parse","e","notEqual","old","defaultPropertyDeclaration","attribute","String","converter","reflect","hasChanged","Symbol","metadata","litPropertyMetadata","WeakMap","ReactiveElement","HTMLElement","initializer","this","__prepare","_initializers","push","observedAttributes","finalize","__attributeToPropertyMap","keys","name","options","state","elementProperties","set","noAccessor","key","descriptor","getPropertyDescriptor","prototype","get","v","call","oldValue","requestUpdate","configurable","enumerable","hasOwnProperty","superCtor","Map","finalized","props","properties","propKeys","p","createProperty","attr","__attributeNameForProperty","elementStyles","finalizeStyles","styles","isArray","Set","flat","Infinity","reverse","s","unshift","getCompatibleStyle","toLowerCase","constructor","super","__instanceProperties","isUpdatePending","hasUpdated","__reflectingProperty","__initialize","__updatePromise","Promise","res","enableUpdating","_$changedProperties","__saveInstanceProperties","forEach","i","controller","__controllers","add","renderRoot","isConnected","hostConnected","delete","instanceProperties","size","createRenderRoot","shadowRoot","attachShadow","shadowRootOptions","adoptStyles","connectedCallback","c","_requestedUpdate","disconnectedCallback","hostDisconnected","_old","_$attributeToProperty","attrValue","toAttribute","removeAttribute","setAttribute","ctor","propName","getPropertyOptions","fromAttribute","_$changeProperty","__enqueueUpdate","has","__reflectingProperties","reject","result","scheduleUpdate","performUpdate","wrapped","shouldUpdate","changedProperties","willUpdate","hostUpdate","update","__markUpdated","_$didUpdate","_changedProperties","hostUpdated","firstUpdated","updated","updateComplete","getUpdateComplete","__propertyToAttribute","mode","reactiveElementVersions","global","globalThis","trustedTypes","policy","createPolicy","createHTML","s","boundAttributeSuffix","marker","Math","random","toFixed","slice","markerMatch","nodeMarker","d","document","createTreeWalker","createMarker","createComment","isPrimitive","value","isArray","Array","isIterable","Symbol","iterator","SPACE_CHAR","textEndRegex","commentEndRegex","comment2EndRegex","tagEndRegex","RegExp","singleQuoteAttrEndRegex","doubleQuoteAttrEndRegex","rawTextElement","tag","type","strings","values","_$litType$","html","svg","mathml","noChange","for","nothing","templateCache","WeakMap","walker","trustFromTemplateString","tsa","stringFromTSA","hasOwnProperty","Error","getTemplateHtml","l","length","attrNames","rawTextEndRegex","regex","i","attrName","match","attrNameEndIndex","lastIndex","exec","test","end","startsWith","push","Template","constructor","options","node","this","parts","nodeIndex","attrNameIndex","partCount","el","createElement","currentNode","content","wrapper","firstChild","replaceWith","childNodes","nextNode","nodeType","hasAttributes","name","getAttributeNames","endsWith","realName","statics","getAttribute","split","m","index","ctor","PropertyPart","BooleanAttributePart","EventPart","AttributePart","removeAttribute","tagName","textContent","emptyScript","append","data","indexOf","_options","innerHTML","resolveDirective","part","parent","attributeIndex","currentDirective","__directives","__directive","nextDirectiveConstructor","_$initialize","_$resolve","TemplateInstance","template","_$parts","_$disconnectableChildren","_$template","_$parent","parentNode","_$isConnected","fragment","creationScope","importNode","partIndex","templatePart","ChildPart","nextSibling","ElementPart","_$setValue","__isConnected","startNode","endNode","_$committedValue","_$startNode","_$endNode","isConnected","directiveParent","_$clear","_commitText","_commitTemplateResult","_commitNode","_commitIterable","insertBefore","_insert","createTextNode","result","_$getTemplate","h","_update","instance","_clone","get","set","itemParts","itemPart","item","start","from","_$notifyConnectionChanged","n","remove","element","fill","String","valueIndex","noCommit","change","v","_commitValue","setAttribute","toggleAttribute","super","newListener","oldListener","shouldRemoveListener","capture","once","passive","shouldAddListener","removeEventListener","addEventListener","event","call","host","handleEvent","_$LH","_boundAttributeSuffix","_marker","_markerMatch","_HTML_RESULT","_getTemplateHtml","_TemplateInstance","_isIterable","_resolveDirective","_ChildPart","_AttributePart","_BooleanAttributePart","_EventPart","_PropertyPart","_ElementPart","polyfillSupport","litHtmlPolyfillSupport","litHtmlVersions","render","container","partOwnerNode","renderBefore","LitElement","ReactiveElement","constructor","this","renderOptions","host","__childPart","createRenderRoot","renderRoot","super","renderBefore","firstChild","changedProperties","value","render","hasUpdated","isConnected","update","connectedCallback","setConnected","disconnectedCallback","noChange","globalThis","litElementHydrateSupport","polyfillSupport","litElementPolyfillSupport","globalThis","litElementVersions","push","customElement","tagName","classOrTarget","context","addInitializer","customElements","define","defaultPropertyDeclaration","attribute","type","String","converter","defaultConverter","reflect","hasChanged","notEqual","standardProperty","options","target","context","kind","metadata","properties","globalThis","litPropertyMetadata","get","set","Map","name","v","oldValue","call","this","requestUpdate","_$changeProperty","value","Error","property","protoOrTarget","nameOrContext","proto","hasOwnProperty","constructor","createProperty","wrapped","Object","getOwnPropertyDescriptor","_ChildPart","ChildPart","_$LH","isSingleExpression","part","strings","PartType","ATTRIBUTE","CHILD","PROPERTY","BOOLEAN_ATTRIBUTE","EVENT","ELEMENT","directive","c","values","_$litDirective$","Directive","_partInfo","_$isConnected","this","_$parent","part","parent","attributeIndex","__part","__attributeIndex","props","update","_part","render","notifyChildrenConnectedChanged","parent","isConnected","children","_$disconnectableChildren","obj","removeDisconnectableFromParent","_$parent","delete","size","addDisconnectableToParent","Set","has","add","installDisconnectAPI","reparentDisconnectables","newParent","this","notifyChildPartConnectedChanged","isClearingValue","fromPartIndex","value","_$committedValue","Array","isArray","i","length","type","PartType","CHILD","_$notifyConnectionChanged","_$reparentDisconnectables","AsyncDirective","Directive","constructor","part","attributeIndex","super","_$initialize","_$isConnected","isClearingDirective","reconnected","disconnected","isSingleExpression","__part","_$setValue","newValues","__attributeIndex","createRef","Ref","lastElementForContextAndCallback","WeakMap","ref","directive","AsyncDirective","_ref","nothing","part","refChanged","this","_updateRefValue","undefined","_lastElementForRef","_element","_context","options","host","element","isConnected","context","globalThis","lastElementForCallback","get","set","call","value","disconnected","reconnected","h","first","d","event","s","t","value","n","i","point","pt","s","v","abs","dot","scale","clear","fill","line","a","b","text","x","y","m","colour","r","t","e","n","r","i","s","o","a","h","c","u","l","d","f","p","g","m","y","_","v","E","w","T","b","k","x","S","F","R","M","P","O","I","U","D","B","N","G","j","V","z","K","Y","$","rt","q","Z","Q","et","st","lt","gt","mt","yt","_t","wt","bt","Kt","$t","qt","Zt","ke","Se","Re","Oe","ii","si","map","x","d","value","s","v","x","v","value","range","r","a","b","p","v","interval","ms","value","object","a","b","__defProp","__defProp","a","map","value","isEqual","e","k","v","m","entries","r","without","del","timeout","resolve","event","type","l","chunk","between","length","chunks","c","ba","m","w","s","r","split","text","i","value","array","it","v","array","array","v","total","min","max","d","object","value","range","value","v","r","t","object","entries","minMaxAvg","x","y","v","a","b","value","s","entries","set","s","v","map","a","b","value","entries","v","map","v","k","v","value","d","interval","entries","elapsed","key","existing","m","data","type","r","k","set","a","map","b","t","ca","f","v","v","fn","t","value","resolve","_","r","count","elapsed","map","fn","value","l","defaults","_","m","v","ii","t","a","v","array","array","array","init","to","i","r","at","h","a","b","run","x","m","v","p","t","d","first","s","interval","clear","p","resolve","it","t","_","t","v","length","mutable","value","min","max","v","length","elapsed","t","value","v","f","fn","t","n","interval","value","reset","ms","r","resolve","p","_","timeout","once","wrap","length","v","run","mutable","elapsed","fn","w","h","c","_","e","capture","max","min","offset","t","f","p","c","v","fn","relative","create","ticks","time","pow","pi","x","c1","c3","c2","c4","c5","k","map","wrap","v","min","max","_a","o","a","b","v","a","clamp","immutable","scale","v","b","array","x","it","f","v","filter","find","next","repeat","some","toArray","unique","toString","value","_","r","iterator","fn","gt","a","b","max","min","count","vs","array","peek","isEmpty","isFull","add","compare","wrap","a","b","n","c","value","v","p","root","entries","t","children","d","spaces","line","asDynamicTraversable","create","depthFirst","toStringDeep","filter","f","path","r","fn","isEmpty","isFull","peek","d","elements","resolve","scale","toString","A","B","m","x","p","_","i","c","o","n","integer","last","interpolate","value","from","to","coordGrammar","type","range","clamp","min","max","d","lo","hi","first","name","adapt","util.mapRange","util.parseFunction","util.last","ε","white","coords","options","epsilon","s","XYZ_D65","get","set","object","ε3","κ","xyz_d50","f","arc","angles","a2","Lab","L","a","b","constrainAngle","π","d2r","x2","b2","G","h2","T","XYZtoLMS_M","LMStoXYZ_M","OKLab","oklab","c1","c2","l","F","Yw","v","g","ninv","c3","Xa","Ya","Za","Jzazbz","jzczhz","m1","m2","I2","T2","P2","deg2rad","h","ei","Hi","t","H","k","viewingConditions","cam16","et","p2","r","J","Q","C","M","y","j","hct","t2","util.isString","de","util.isNone","clipped","deltaE","util.clamp","E","inGamut","checkInGamut","util.serializeNumber","toXYZ_M","fromXYZ_M","abs","equals","register","Color","Y2","Y","S","R","contrast","contrastAlgorithms","X","Z","sum","steps","angles.adjust","hwb","w","Et","Et2","oklch","Luv","u","slope","lch","func","args","ret","e","colour","opacity","root","remove","value","min","a","b","c","a","b","c","v","value","children","r","sum","average","count","debounce","filter","interpolate","max","min","rank","run","sum","tally","throttle","to","toArray","wrap","manual","value","asCallback","chunks","concat","dropWhile","equals","every","fill","find","flatten","forEach","fromArray","fromIterable","map","reduce","repeat","slice","some","unique","uniqueByValue","until","zip","array","interval","v","it","f","_","iterator","fn","x","r","gt","a","b","delay","ms","toString","vs","isEmpty","value","elements","set","v","t","entries","field","event","_","compareData","a","b","entries","field","value","compareData","s","path","split","r","o","c","object","v","set","k","d","event","fn","debounce","elapsed","last","filter","interpolate","i","max","min","t","tally","p","process","average","sum","rank","annotate","x","init","st","toString","chain","throttle","repeat","clone","distance","get","priority","item","m","l","lengths","graph","ii","j","vertices","line","g","gr","from","to","edges","u","ic","f","w","toArray","resolve","_","wrap","a","w","debounce","f","filter","o","min","max","average","sum","tally","v","l","m","s","unwrapped","x","source","throttle","toArray","count","interval","offset","value","b","elements","bind","field","_","init","path","p","create","changes","d","last","pe","string","array","c","set","push","cr","remove","insertAt","r","resolve","fn","add","elapsed","relative","target","run","ss","interpolate","rank","to","transform","immutable","mutable","fn","event","set","elapsed","m","ro","entries","interval","v","height","p","isNaN","pt","isEmpty","a","b","x2","y2","remove","m","c","v","circle","p","children","line","text","center","height","g","y","x","type","w","h","o","v","every","d","steps","r","r","length","t","p","value","value","array","m","immutable","mutable","value","v","map","s","t","c","x","set","r","rr","d","line","create","k","a","b","fromPoints","init","p","v","guard","line","b","a","length","sum","x","y","z","interpolate","d","d2","l","distance","Empty","Placeholder","angleRadian","apply","bbox","divide","isEmpty","isEqual","isPlaceholder","multiply","normaliseByRect","rotate","subtract","toString","withinRange","rect","c","getPointParameter","pt","point","n","atob","dot","t","min","w2","h2","aa","array","dotProduct","max","clamp","clampMagnitude","compare","fromNumbers","invert","isNaN","normalise","quantiseEvery","random","reduce","round","toArray","wrap","fn","q","r","circle","guardPositioned","isPositioned","v2","u2","centroid","distanceFromExterior","pipeline","count","height","e2","paths","nearest","rank","center","isIntersecting","randomPoint","piPi","offset","from","arrow","multiplyScalar","toPath","value","s","area","edges","path","grid","cells","steps","cardinal","entries","mutable","g","visitor","rows","abs","cos","sin","sqrt","pow","pi","tau","mt","mt2","t2","i","f2","f3","f4","j","m","M","ds","de","ts","te","o","p2","x2","y2","p3","s2","bbox2","intersections","a2","l2","m1","m2","v1","pa","q2","phi","k","b2","c1","c2","arc","e","_","acos","S","B","E","A","last","u","C","ft","r2","R","n2","rc","d3","ls","le","segments","tlen","alen","fs","fe","bs","be","cubic","cubic2","quadraticBezier","quadratic","relativePosition","toSvgString","relative","lengths","corners","epsilon","rs","slope","Direction","w","h","scaler","sh","opacity","scale","distanceCenter","fromDegrees","toSvg","toSvgFull","toCartesian","EmptyCartesian","fromFlatArray","intersectsPoint","toFlatArray","triangle","fromCenter","perimeter","circumcircle","incircle","tt","fromA","fromB","fromC","medians","hh","angles","circle","line","makeHelper","applyOpts","draw","arc","apply","push","s","o","pop","p","c","ellipse","path","pt","point","m","pos","a","b","quadratic","d","t","corners","x","y","text","rect","Empty","l","value","clamp","v","height","r","u","event","getContext","plot","min","max","vr","subtract","h","colour","pa","w","m1","m2","paths","f","create","k","type","from","to","init","immutable","ctx","width","opacity","add","piPi","range","canvasSize","gaussian","p","a","b","randomSource","resolve","x","v","min","max","u","r","h","height","wrap","d","i","bbox","colour","k","p","typewriter","c","l","z","r","t","event","h","event","r","t","v","w","d","n","h","r","event","n","t","h","n","t","a","h","m","event","value","t","fn","d","i","n","l","c","p","v","p","v","p","v","p","v","v","d","r","s","o","d","vt","c","c","elapsed","from","e","Log","l","Log","e","b","Log","s","c","t","length","elapsed","elapsed","r","entries","k","v","a","i","e","until","t","value","Log","n","ln","s","p","i","d","r","ch","pa","c","Log","c","p","o","e","i","s","e","type","i","n","Event","type","w","event","value","type","l","delay","resolve","WebSocket","Log","m","e","c","to","n","ch","f","t","d","to","defaults","MlVision","event","r","e"]}